var a9=Object.create;var Cy=Object.defineProperty,l9=Object.defineProperties,c9=Object.getOwnPropertyDescriptor,u9=Object.getOwnPropertyDescriptors,h9=Object.getOwnPropertyNames,Hx=Object.getOwnPropertySymbols,d9=Object.getPrototypeOf,sT=Object.prototype.hasOwnProperty,cR=Object.prototype.propertyIsEnumerable;var lR=(e,t,n)=>t in e?Cy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,cn=(e,t)=>{for(var n in t||={})sT.call(t,n)&&lR(e,n,t[n]);if(Hx)for(var n of Hx(t))cR.call(t,n)&&lR(e,n,t[n]);return e},lr=(e,t)=>l9(e,u9(t));var $x=(e,t)=>{var n={};for(var s in e)sT.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&Hx)for(var s of Hx(e))t.indexOf(s)<0&&cR.call(e,s)&&(n[s]=e[s]);return n};var uR=(e,t)=>()=>(e&&(t=e(e=0)),t);var Ui=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),f9=(e,t)=>{for(var n in t)Cy(e,n,{get:t[n],enumerable:!0})},hR=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let h of h9(t))!sT.call(e,h)&&h!==n&&Cy(e,h,{get:()=>t[h],enumerable:!(s=c9(t,h))||s.enumerable});return e};var fh=(e,t,n)=>(n=e!=null?a9(d9(e)):{},hR(t||!e||!e.__esModule?Cy(n,"default",{value:e,enumerable:!0}):n,e)),p9=e=>hR(Cy({},"__esModule",{value:!0}),e);var My=(e,t,n)=>new Promise((s,h)=>{var r=F=>{try{A(n.next(F))}catch($){h($)}},w=F=>{try{A(n.throw(F))}catch($){h($)}},A=F=>F.done?s(F.value):Promise.resolve(F.value).then(r,w);A((n=n.apply(e,t)).next())});var B0=Ui((f2,p2)=>{"use strict";(function(e,t){typeof f2=="object"&&typeof p2<"u"?p2.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis<"u"?globalThis:e||self).dayjs=t()})(f2,function(){"use strict";var e=1e3,t=6e4,n=36e5,s="millisecond",h="second",r="minute",w="hour",A="day",F="week",$="month",K="quarter",se="year",le="date",ae="Invalid Date",Ze=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Ue=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,ft={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(ln){var Mt=["th","st","nd","rd"],je=ln%100;return"["+ln+(Mt[(je-20)%10]||Mt[je]||Mt[0])+"]"}},Xe=function(ln,Mt,je){var At=String(ln);return!At||At.length>=Mt?ln:""+Array(Mt+1-At.length).join(je)+ln},st={s:Xe,z:function(ln){var Mt=-ln.utcOffset(),je=Math.abs(Mt),At=Math.floor(je/60),Ke=je%60;return(Mt<=0?"+":"-")+Xe(At,2,"0")+":"+Xe(Ke,2,"0")},m:function ln(Mt,je){if(Mt.date()<je.date())return-ln(je,Mt);var At=12*(je.year()-Mt.year())+(je.month()-Mt.month()),Ke=Mt.clone().add(At,$),mt=je-Ke<0,It=Mt.clone().add(At+(mt?-1:1),$);return+(-(At+(je-Ke)/(mt?Ke-It:It-Ke))||0)},a:function(ln){return ln<0?Math.ceil(ln)||0:Math.floor(ln)},p:function(ln){return{M:$,y:se,w:F,d:A,D:le,h:w,m:r,s:h,ms:s,Q:K}[ln]||String(ln||"").toLowerCase().replace(/s$/,"")},u:function(ln){return ln===void 0}},Ut="en",Bt={};Bt[Ut]=ft;var xt="$isDayjsObject",yt=function(ln){return ln instanceof ri||!(!ln||!ln[xt])},rn=function ln(Mt,je,At){var Ke;if(!Mt)return Ut;if(typeof Mt=="string"){var mt=Mt.toLowerCase();Bt[mt]&&(Ke=mt),je&&(Bt[mt]=je,Ke=mt);var It=Mt.split("-");if(!Ke&&It.length>1)return ln(It[0])}else{var en=Mt.name;Bt[en]=Mt,Ke=en}return!At&&Ke&&(Ut=Ke),Ke||!At&&Ut},Dt=function(ln,Mt){if(yt(ln))return ln.clone();var je=typeof Mt=="object"?Mt:{};return je.date=ln,je.args=arguments,new ri(je)},Tt=st;Tt.l=rn,Tt.i=yt,Tt.w=function(ln,Mt){return Dt(ln,{locale:Mt.$L,utc:Mt.$u,x:Mt.$x,$offset:Mt.$offset})};var ri=function(){function ln(je){this.$L=rn(je.locale,null,!0),this.parse(je),this.$x=this.$x||je.x||{},this[xt]=!0}var Mt=ln.prototype;return Mt.parse=function(je){this.$d=function(At){var Ke=At.date,mt=At.utc;if(Ke===null)return new Date(NaN);if(Tt.u(Ke))return new Date;if(Ke instanceof Date)return new Date(Ke);if(typeof Ke=="string"&&!/Z$/i.test(Ke)){var It=Ke.match(Ze);if(It){var en=It[2]-1||0,dn=(It[7]||"0").substring(0,3);return mt?new Date(Date.UTC(It[1],en,It[3]||1,It[4]||0,It[5]||0,It[6]||0,dn)):new Date(It[1],en,It[3]||1,It[4]||0,It[5]||0,It[6]||0,dn)}}return new Date(Ke)}(je),this.init()},Mt.init=function(){var je=this.$d;this.$y=je.getFullYear(),this.$M=je.getMonth(),this.$D=je.getDate(),this.$W=je.getDay(),this.$H=je.getHours(),this.$m=je.getMinutes(),this.$s=je.getSeconds(),this.$ms=je.getMilliseconds()},Mt.$utils=function(){return Tt},Mt.isValid=function(){return this.$d.toString()!==ae},Mt.isSame=function(je,At){var Ke=Dt(je);return this.startOf(At)<=Ke&&Ke<=this.endOf(At)},Mt.isAfter=function(je,At){return Dt(je)<this.startOf(At)},Mt.isBefore=function(je,At){return this.endOf(At)<Dt(je)},Mt.$g=function(je,At,Ke){return Tt.u(je)?this[At]:this.set(Ke,je)},Mt.unix=function(){return Math.floor(this.valueOf()/1e3)},Mt.valueOf=function(){return this.$d.getTime()},Mt.startOf=function(je,At){var Ke=this,mt=!!Tt.u(At)||At,It=Tt.p(je),en=function(gr,Ee){var on=Tt.w(Ke.$u?Date.UTC(Ke.$y,Ee,gr):new Date(Ke.$y,Ee,gr),Ke);return mt?on:on.endOf(A)},dn=function(gr,Ee){return Tt.w(Ke.toDate()[gr].apply(Ke.toDate("s"),(mt?[0,0,0,0]:[23,59,59,999]).slice(Ee)),Ke)},Ft=this.$W,Dn=this.$M,An=this.$D,_n="set"+(this.$u?"UTC":"");switch(It){case se:return mt?en(1,0):en(31,11);case $:return mt?en(1,Dn):en(0,Dn+1);case F:var qi=this.$locale().weekStart||0,mr=(Ft<qi?Ft+7:Ft)-qi;return en(mt?An-mr:An+(6-mr),Dn);case A:case le:return dn(_n+"Hours",0);case w:return dn(_n+"Minutes",1);case r:return dn(_n+"Seconds",2);case h:return dn(_n+"Milliseconds",3);default:return this.clone()}},Mt.endOf=function(je){return this.startOf(je,!1)},Mt.$set=function(je,At){var Ke,mt=Tt.p(je),It="set"+(this.$u?"UTC":""),en=(Ke={},Ke[A]=It+"Date",Ke[le]=It+"Date",Ke[$]=It+"Month",Ke[se]=It+"FullYear",Ke[w]=It+"Hours",Ke[r]=It+"Minutes",Ke[h]=It+"Seconds",Ke[s]=It+"Milliseconds",Ke)[mt],dn=mt===A?this.$D+(At-this.$W):At;if(mt===$||mt===se){var Ft=this.clone().set(le,1);Ft.$d[en](dn),Ft.init(),this.$d=Ft.set(le,Math.min(this.$D,Ft.daysInMonth())).$d}else en&&this.$d[en](dn);return this.init(),this},Mt.set=function(je,At){return this.clone().$set(je,At)},Mt.get=function(je){return this[Tt.p(je)]()},Mt.add=function(je,At){var Ke,mt=this;je=Number(je);var It=Tt.p(At),en=function(Dn){var An=Dt(mt);return Tt.w(An.date(An.date()+Math.round(Dn*je)),mt)};if(It===$)return this.set($,this.$M+je);if(It===se)return this.set(se,this.$y+je);if(It===A)return en(1);if(It===F)return en(7);var dn=(Ke={},Ke[r]=t,Ke[w]=n,Ke[h]=e,Ke)[It]||1,Ft=this.$d.getTime()+je*dn;return Tt.w(Ft,this)},Mt.subtract=function(je,At){return this.add(-1*je,At)},Mt.format=function(je){var At=this,Ke=this.$locale();if(!this.isValid())return Ke.invalidDate||ae;var mt=je||"YYYY-MM-DDTHH:mm:ssZ",It=Tt.z(this),en=this.$H,dn=this.$m,Ft=this.$M,Dn=Ke.weekdays,An=Ke.months,_n=Ke.meridiem,qi=function(Ee,on,Zn,gi){return Ee&&(Ee[on]||Ee(At,mt))||Zn[on].slice(0,gi)},mr=function(Ee){return Tt.s(en%12||12,Ee,"0")},gr=_n||function(Ee,on,Zn){var gi=Ee<12?"AM":"PM";return Zn?gi.toLowerCase():gi};return mt.replace(Ue,function(Ee,on){return on||function(Zn){switch(Zn){case"YY":return String(At.$y).slice(-2);case"YYYY":return Tt.s(At.$y,4,"0");case"M":return Ft+1;case"MM":return Tt.s(Ft+1,2,"0");case"MMM":return qi(Ke.monthsShort,Ft,An,3);case"MMMM":return qi(An,Ft);case"D":return At.$D;case"DD":return Tt.s(At.$D,2,"0");case"d":return String(At.$W);case"dd":return qi(Ke.weekdaysMin,At.$W,Dn,2);case"ddd":return qi(Ke.weekdaysShort,At.$W,Dn,3);case"dddd":return Dn[At.$W];case"H":return String(en);case"HH":return Tt.s(en,2,"0");case"h":return mr(1);case"hh":return mr(2);case"a":return gr(en,dn,!0);case"A":return gr(en,dn,!1);case"m":return String(dn);case"mm":return Tt.s(dn,2,"0");case"s":return String(At.$s);case"ss":return Tt.s(At.$s,2,"0");case"SSS":return Tt.s(At.$ms,3,"0");case"Z":return It}return null}(Ee)||It.replace(":","")})},Mt.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},Mt.diff=function(je,At,Ke){var mt,It=this,en=Tt.p(At),dn=Dt(je),Ft=(dn.utcOffset()-this.utcOffset())*t,Dn=this-dn,An=function(){return Tt.m(It,dn)};switch(en){case se:mt=An()/12;break;case $:mt=An();break;case K:mt=An()/3;break;case F:mt=(Dn-Ft)/6048e5;break;case A:mt=(Dn-Ft)/864e5;break;case w:mt=Dn/n;break;case r:mt=Dn/t;break;case h:mt=Dn/e;break;default:mt=Dn}return Ke?mt:Tt.a(mt)},Mt.daysInMonth=function(){return this.endOf($).$D},Mt.$locale=function(){return Bt[this.$L]},Mt.locale=function(je,At){if(!je)return this.$L;var Ke=this.clone(),mt=rn(je,At,!0);return mt&&(Ke.$L=mt),Ke},Mt.clone=function(){return Tt.w(this.$d,this)},Mt.toDate=function(){return new Date(this.valueOf())},Mt.toJSON=function(){return this.isValid()?this.toISOString():null},Mt.toISOString=function(){return this.$d.toISOString()},Mt.toString=function(){return this.$d.toUTCString()},ln}(),er=ri.prototype;return Dt.prototype=er,[["$ms",s],["$s",h],["$m",r],["$H",w],["$W",A],["$M",$],["$y",se],["$D",le]].forEach(function(ln){er[ln[1]]=function(Mt){return this.$g(Mt,ln[0],ln[1])}}),Dt.extend=function(ln,Mt){return ln.$i||(ln(Mt,ri,Dt),ln.$i=!0),Dt},Dt.locale=rn,Dt.isDayjs=yt,Dt.unix=function(ln){return Dt(1e3*ln)},Dt.en=Bt[Ut],Dt.Ls=Bt,Dt.p={},Dt})});var E5=Ui((fC,T5)=>{"use strict";(function(e,t){typeof fC=="object"&&typeof T5<"u"?t(fC):typeof define=="function"&&define.amd?define(["exports"],t):(e=typeof globalThis<"u"?globalThis:e||self,t(e.leaflet={}))})(fC,function(e){"use strict";var t="1.9.4";function n(_){var S,z,Y,ne;for(z=1,Y=arguments.length;z<Y;z++){ne=arguments[z];for(S in ne)_[S]=ne[S]}return _}var s=Object.create||function(){function _(){}return function(S){return _.prototype=S,new _}}();function h(_,S){var z=Array.prototype.slice;if(_.bind)return _.bind.apply(_,z.call(arguments,1));var Y=z.call(arguments,2);return function(){return _.apply(S,Y.length?Y.concat(z.call(arguments)):arguments)}}var r=0;function w(_){return"_leaflet_id"in _||(_._leaflet_id=++r),_._leaflet_id}function A(_,S,z){var Y,ne,ye,Ge;return Ge=function(){Y=!1,ne&&(ye.apply(z,ne),ne=!1)},ye=function(){Y?ne=arguments:(_.apply(z,arguments),setTimeout(Ge,S),Y=!0)},ye}function F(_,S,z){var Y=S[1],ne=S[0],ye=Y-ne;return _===Y&&z?_:((_-ne)%ye+ye)%ye+ne}function $(){return!1}function K(_,S){if(S===!1)return _;var z=Math.pow(10,S===void 0?6:S);return Math.round(_*z)/z}function se(_){return _.trim?_.trim():_.replace(/^\s+|\s+$/g,"")}function le(_){return se(_).split(/\s+/)}function ae(_,S){Object.prototype.hasOwnProperty.call(_,"options")||(_.options=_.options?s(_.options):{});for(var z in S)_.options[z]=S[z];return _.options}function Ze(_,S,z){var Y=[];for(var ne in _)Y.push(encodeURIComponent(z?ne.toUpperCase():ne)+"="+encodeURIComponent(_[ne]));return(!S||S.indexOf("?")===-1?"?":"&")+Y.join("&")}var Ue=/\{ *([\w_ -]+) *\}/g;function ft(_,S){return _.replace(Ue,function(z,Y){var ne=S[Y];if(ne===void 0)throw new Error("No value provided for variable "+z);return typeof ne=="function"&&(ne=ne(S)),ne})}var Xe=Array.isArray||function(_){return Object.prototype.toString.call(_)==="[object Array]"};function st(_,S){for(var z=0;z<_.length;z++)if(_[z]===S)return z;return-1}var Ut="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Bt(_){return window["webkit"+_]||window["moz"+_]||window["ms"+_]}var xt=0;function yt(_){var S=+new Date,z=Math.max(0,16-(S-xt));return xt=S+z,window.setTimeout(_,z)}var rn=window.requestAnimationFrame||Bt("RequestAnimationFrame")||yt,Dt=window.cancelAnimationFrame||Bt("CancelAnimationFrame")||Bt("CancelRequestAnimationFrame")||function(_){window.clearTimeout(_)};function Tt(_,S,z){if(z&&rn===yt)_.call(S);else return rn.call(window,h(_,S))}function ri(_){_&&Dt.call(window,_)}var er={__proto__:null,extend:n,create:s,bind:h,get lastId(){return r},stamp:w,throttle:A,wrapNum:F,falseFn:$,formatNum:K,trim:se,splitWords:le,setOptions:ae,getParamString:Ze,template:ft,isArray:Xe,indexOf:st,emptyImageUrl:Ut,requestFn:rn,cancelFn:Dt,requestAnimFrame:Tt,cancelAnimFrame:ri};function ln(){}ln.extend=function(_){var S=function(){ae(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},z=S.__super__=this.prototype,Y=s(z);Y.constructor=S,S.prototype=Y;for(var ne in this)Object.prototype.hasOwnProperty.call(this,ne)&&ne!=="prototype"&&ne!=="__super__"&&(S[ne]=this[ne]);return _.statics&&n(S,_.statics),_.includes&&(Mt(_.includes),n.apply(null,[Y].concat(_.includes))),n(Y,_),delete Y.statics,delete Y.includes,Y.options&&(Y.options=z.options?s(z.options):{},n(Y.options,_.options)),Y._initHooks=[],Y.callInitHooks=function(){if(!this._initHooksCalled){z.callInitHooks&&z.callInitHooks.call(this),this._initHooksCalled=!0;for(var ye=0,Ge=Y._initHooks.length;ye<Ge;ye++)Y._initHooks[ye].call(this)}},S},ln.include=function(_){var S=this.prototype.options;return n(this.prototype,_),_.options&&(this.prototype.options=S,this.mergeOptions(_.options)),this},ln.mergeOptions=function(_){return n(this.prototype.options,_),this},ln.addInitHook=function(_){var S=Array.prototype.slice.call(arguments,1),z=typeof _=="function"?_:function(){this[_].apply(this,S)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(z),this};function Mt(_){if(!(typeof L>"u"||!L||!L.Mixin)){_=Xe(_)?_:[_];for(var S=0;S<_.length;S++)_[S]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var je={on:function(_,S,z){if(typeof _=="object")for(var Y in _)this._on(Y,_[Y],S);else{_=le(_);for(var ne=0,ye=_.length;ne<ye;ne++)this._on(_[ne],S,z)}return this},off:function(_,S,z){if(!arguments.length)delete this._events;else if(typeof _=="object")for(var Y in _)this._off(Y,_[Y],S);else{_=le(_);for(var ne=arguments.length===1,ye=0,Ge=_.length;ye<Ge;ye++)ne?this._off(_[ye]):this._off(_[ye],S,z)}return this},_on:function(_,S,z,Y){if(typeof S!="function"){console.warn("wrong listener type: "+typeof S);return}if(this._listens(_,S,z)===!1){z===this&&(z=void 0);var ne={fn:S,ctx:z};Y&&(ne.once=!0),this._events=this._events||{},this._events[_]=this._events[_]||[],this._events[_].push(ne)}},_off:function(_,S,z){var Y,ne,ye;if(this._events&&(Y=this._events[_],!!Y)){if(arguments.length===1){if(this._firingCount)for(ne=0,ye=Y.length;ne<ye;ne++)Y[ne].fn=$;delete this._events[_];return}if(typeof S!="function"){console.warn("wrong listener type: "+typeof S);return}var Ge=this._listens(_,S,z);if(Ge!==!1){var ht=Y[Ge];this._firingCount&&(ht.fn=$,this._events[_]=Y=Y.slice()),Y.splice(Ge,1)}}},fire:function(_,S,z){if(!this.listens(_,z))return this;var Y=n({},S,{type:_,target:this,sourceTarget:S&&S.sourceTarget||this});if(this._events){var ne=this._events[_];if(ne){this._firingCount=this._firingCount+1||1;for(var ye=0,Ge=ne.length;ye<Ge;ye++){var ht=ne[ye],bt=ht.fn;ht.once&&this.off(_,bt,ht.ctx),bt.call(ht.ctx||this,Y)}this._firingCount--}}return z&&this._propagateEvent(Y),this},listens:function(_,S,z,Y){typeof _!="string"&&console.warn('"string" type argument expected');var ne=S;typeof S!="function"&&(Y=!!S,ne=void 0,z=void 0);var ye=this._events&&this._events[_];if(ye&&ye.length&&this._listens(_,ne,z)!==!1)return!0;if(Y){for(var Ge in this._eventParents)if(this._eventParents[Ge].listens(_,S,z,Y))return!0}return!1},_listens:function(_,S,z){if(!this._events)return!1;var Y=this._events[_]||[];if(!S)return!!Y.length;z===this&&(z=void 0);for(var ne=0,ye=Y.length;ne<ye;ne++)if(Y[ne].fn===S&&Y[ne].ctx===z)return ne;return!1},once:function(_,S,z){if(typeof _=="object")for(var Y in _)this._on(Y,_[Y],S,!0);else{_=le(_);for(var ne=0,ye=_.length;ne<ye;ne++)this._on(_[ne],S,z,!0)}return this},addEventParent:function(_){return this._eventParents=this._eventParents||{},this._eventParents[w(_)]=_,this},removeEventParent:function(_){return this._eventParents&&delete this._eventParents[w(_)],this},_propagateEvent:function(_){for(var S in this._eventParents)this._eventParents[S].fire(_.type,n({layer:_.target,propagatedFrom:_.target},_),!0)}};je.addEventListener=je.on,je.removeEventListener=je.clearAllEventListeners=je.off,je.addOneTimeEventListener=je.once,je.fireEvent=je.fire,je.hasEventListeners=je.listens;var At=ln.extend(je);function Ke(_,S,z){this.x=z?Math.round(_):_,this.y=z?Math.round(S):S}var mt=Math.trunc||function(_){return _>0?Math.floor(_):Math.ceil(_)};Ke.prototype={clone:function(){return new Ke(this.x,this.y)},add:function(_){return this.clone()._add(It(_))},_add:function(_){return this.x+=_.x,this.y+=_.y,this},subtract:function(_){return this.clone()._subtract(It(_))},_subtract:function(_){return this.x-=_.x,this.y-=_.y,this},divideBy:function(_){return this.clone()._divideBy(_)},_divideBy:function(_){return this.x/=_,this.y/=_,this},multiplyBy:function(_){return this.clone()._multiplyBy(_)},_multiplyBy:function(_){return this.x*=_,this.y*=_,this},scaleBy:function(_){return new Ke(this.x*_.x,this.y*_.y)},unscaleBy:function(_){return new Ke(this.x/_.x,this.y/_.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=mt(this.x),this.y=mt(this.y),this},distanceTo:function(_){_=It(_);var S=_.x-this.x,z=_.y-this.y;return Math.sqrt(S*S+z*z)},equals:function(_){return _=It(_),_.x===this.x&&_.y===this.y},contains:function(_){return _=It(_),Math.abs(_.x)<=Math.abs(this.x)&&Math.abs(_.y)<=Math.abs(this.y)},toString:function(){return"Point("+K(this.x)+", "+K(this.y)+")"}};function It(_,S,z){return _ instanceof Ke?_:Xe(_)?new Ke(_[0],_[1]):_==null?_:typeof _=="object"&&"x"in _&&"y"in _?new Ke(_.x,_.y):new Ke(_,S,z)}function en(_,S){if(_)for(var z=S?[_,S]:_,Y=0,ne=z.length;Y<ne;Y++)this.extend(z[Y])}en.prototype={extend:function(_){var S,z;if(!_)return this;if(_ instanceof Ke||typeof _[0]=="number"||"x"in _)S=z=It(_);else if(_=dn(_),S=_.min,z=_.max,!S||!z)return this;return!this.min&&!this.max?(this.min=S.clone(),this.max=z.clone()):(this.min.x=Math.min(S.x,this.min.x),this.max.x=Math.max(z.x,this.max.x),this.min.y=Math.min(S.y,this.min.y),this.max.y=Math.max(z.y,this.max.y)),this},getCenter:function(_){return It((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,_)},getBottomLeft:function(){return It(this.min.x,this.max.y)},getTopRight:function(){return It(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(_){var S,z;return typeof _[0]=="number"||_ instanceof Ke?_=It(_):_=dn(_),_ instanceof en?(S=_.min,z=_.max):S=z=_,S.x>=this.min.x&&z.x<=this.max.x&&S.y>=this.min.y&&z.y<=this.max.y},intersects:function(_){_=dn(_);var S=this.min,z=this.max,Y=_.min,ne=_.max,ye=ne.x>=S.x&&Y.x<=z.x,Ge=ne.y>=S.y&&Y.y<=z.y;return ye&&Ge},overlaps:function(_){_=dn(_);var S=this.min,z=this.max,Y=_.min,ne=_.max,ye=ne.x>S.x&&Y.x<z.x,Ge=ne.y>S.y&&Y.y<z.y;return ye&&Ge},isValid:function(){return!!(this.min&&this.max)},pad:function(_){var S=this.min,z=this.max,Y=Math.abs(S.x-z.x)*_,ne=Math.abs(S.y-z.y)*_;return dn(It(S.x-Y,S.y-ne),It(z.x+Y,z.y+ne))},equals:function(_){return _?(_=dn(_),this.min.equals(_.getTopLeft())&&this.max.equals(_.getBottomRight())):!1}};function dn(_,S){return!_||_ instanceof en?_:new en(_,S)}function Ft(_,S){if(_)for(var z=S?[_,S]:_,Y=0,ne=z.length;Y<ne;Y++)this.extend(z[Y])}Ft.prototype={extend:function(_){var S=this._southWest,z=this._northEast,Y,ne;if(_ instanceof An)Y=_,ne=_;else if(_ instanceof Ft){if(Y=_._southWest,ne=_._northEast,!Y||!ne)return this}else return _?this.extend(_n(_)||Dn(_)):this;return!S&&!z?(this._southWest=new An(Y.lat,Y.lng),this._northEast=new An(ne.lat,ne.lng)):(S.lat=Math.min(Y.lat,S.lat),S.lng=Math.min(Y.lng,S.lng),z.lat=Math.max(ne.lat,z.lat),z.lng=Math.max(ne.lng,z.lng)),this},pad:function(_){var S=this._southWest,z=this._northEast,Y=Math.abs(S.lat-z.lat)*_,ne=Math.abs(S.lng-z.lng)*_;return new Ft(new An(S.lat-Y,S.lng-ne),new An(z.lat+Y,z.lng+ne))},getCenter:function(){return new An((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new An(this.getNorth(),this.getWest())},getSouthEast:function(){return new An(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(_){typeof _[0]=="number"||_ instanceof An||"lat"in _?_=_n(_):_=Dn(_);var S=this._southWest,z=this._northEast,Y,ne;return _ instanceof Ft?(Y=_.getSouthWest(),ne=_.getNorthEast()):Y=ne=_,Y.lat>=S.lat&&ne.lat<=z.lat&&Y.lng>=S.lng&&ne.lng<=z.lng},intersects:function(_){_=Dn(_);var S=this._southWest,z=this._northEast,Y=_.getSouthWest(),ne=_.getNorthEast(),ye=ne.lat>=S.lat&&Y.lat<=z.lat,Ge=ne.lng>=S.lng&&Y.lng<=z.lng;return ye&&Ge},overlaps:function(_){_=Dn(_);var S=this._southWest,z=this._northEast,Y=_.getSouthWest(),ne=_.getNorthEast(),ye=ne.lat>S.lat&&Y.lat<z.lat,Ge=ne.lng>S.lng&&Y.lng<z.lng;return ye&&Ge},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(_,S){return _?(_=Dn(_),this._southWest.equals(_.getSouthWest(),S)&&this._northEast.equals(_.getNorthEast(),S)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Dn(_,S){return _ instanceof Ft?_:new Ft(_,S)}function An(_,S,z){if(isNaN(_)||isNaN(S))throw new Error("Invalid LatLng object: ("+_+", "+S+")");this.lat=+_,this.lng=+S,z!==void 0&&(this.alt=+z)}An.prototype={equals:function(_,S){if(!_)return!1;_=_n(_);var z=Math.max(Math.abs(this.lat-_.lat),Math.abs(this.lng-_.lng));return z<=(S===void 0?1e-9:S)},toString:function(_){return"LatLng("+K(this.lat,_)+", "+K(this.lng,_)+")"},distanceTo:function(_){return mr.distance(this,_n(_))},wrap:function(){return mr.wrapLatLng(this)},toBounds:function(_){var S=180*_/40075017,z=S/Math.cos(Math.PI/180*this.lat);return Dn([this.lat-S,this.lng-z],[this.lat+S,this.lng+z])},clone:function(){return new An(this.lat,this.lng,this.alt)}};function _n(_,S,z){return _ instanceof An?_:Xe(_)&&typeof _[0]!="object"?_.length===3?new An(_[0],_[1],_[2]):_.length===2?new An(_[0],_[1]):null:_==null?_:typeof _=="object"&&"lat"in _?new An(_.lat,"lng"in _?_.lng:_.lon,_.alt):S===void 0?null:new An(_,S,z)}var qi={latLngToPoint:function(_,S){var z=this.projection.project(_),Y=this.scale(S);return this.transformation._transform(z,Y)},pointToLatLng:function(_,S){var z=this.scale(S),Y=this.transformation.untransform(_,z);return this.projection.unproject(Y)},project:function(_){return this.projection.project(_)},unproject:function(_){return this.projection.unproject(_)},scale:function(_){return 256*Math.pow(2,_)},zoom:function(_){return Math.log(_/256)/Math.LN2},getProjectedBounds:function(_){if(this.infinite)return null;var S=this.projection.bounds,z=this.scale(_),Y=this.transformation.transform(S.min,z),ne=this.transformation.transform(S.max,z);return new en(Y,ne)},infinite:!1,wrapLatLng:function(_){var S=this.wrapLng?F(_.lng,this.wrapLng,!0):_.lng,z=this.wrapLat?F(_.lat,this.wrapLat,!0):_.lat,Y=_.alt;return new An(z,S,Y)},wrapLatLngBounds:function(_){var S=_.getCenter(),z=this.wrapLatLng(S),Y=S.lat-z.lat,ne=S.lng-z.lng;if(Y===0&&ne===0)return _;var ye=_.getSouthWest(),Ge=_.getNorthEast(),ht=new An(ye.lat-Y,ye.lng-ne),bt=new An(Ge.lat-Y,Ge.lng-ne);return new Ft(ht,bt)}},mr=n({},qi,{wrapLng:[-180,180],R:6371e3,distance:function(_,S){var z=Math.PI/180,Y=_.lat*z,ne=S.lat*z,ye=Math.sin((S.lat-_.lat)*z/2),Ge=Math.sin((S.lng-_.lng)*z/2),ht=ye*ye+Math.cos(Y)*Math.cos(ne)*Ge*Ge,bt=2*Math.atan2(Math.sqrt(ht),Math.sqrt(1-ht));return this.R*bt}}),gr=6378137,Ee={R:gr,MAX_LATITUDE:85.0511287798,project:function(_){var S=Math.PI/180,z=this.MAX_LATITUDE,Y=Math.max(Math.min(z,_.lat),-z),ne=Math.sin(Y*S);return new Ke(this.R*_.lng*S,this.R*Math.log((1+ne)/(1-ne))/2)},unproject:function(_){var S=180/Math.PI;return new An((2*Math.atan(Math.exp(_.y/this.R))-Math.PI/2)*S,_.x*S/this.R)},bounds:function(){var _=gr*Math.PI;return new en([-_,-_],[_,_])}()};function on(_,S,z,Y){if(Xe(_)){this._a=_[0],this._b=_[1],this._c=_[2],this._d=_[3];return}this._a=_,this._b=S,this._c=z,this._d=Y}on.prototype={transform:function(_,S){return this._transform(_.clone(),S)},_transform:function(_,S){return S=S||1,_.x=S*(this._a*_.x+this._b),_.y=S*(this._c*_.y+this._d),_},untransform:function(_,S){return S=S||1,new Ke((_.x/S-this._b)/this._a,(_.y/S-this._d)/this._c)}};function Zn(_,S,z,Y){return new on(_,S,z,Y)}var gi=n({},mr,{code:"EPSG:3857",projection:Ee,transformation:function(){var _=.5/(Math.PI*Ee.R);return Zn(_,.5,-_,.5)}()}),We=n({},gi,{code:"EPSG:900913"});function Nr(_){return document.createElementNS("http://www.w3.org/2000/svg",_)}function hi(_,S){var z="",Y,ne,ye,Ge,ht,bt;for(Y=0,ye=_.length;Y<ye;Y++){for(ht=_[Y],ne=0,Ge=ht.length;ne<Ge;ne++)bt=ht[ne],z+=(ne?"L":"M")+bt.x+" "+bt.y;z+=S?Te.svg?"z":"x":""}return z||"M0 0"}var zr=document.documentElement.style,Cn="ActiveXObject"in window,Er=Cn&&!document.addEventListener,Xo="msLaunchUri"in navigator&&!("documentMode"in document),Ya=He("webkit"),Xa=He("android"),ec=He("android 2")||He("android 3"),Rn=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Gc=Xa&&He("Google")&&Rn<537&&!("AudioNode"in window),oa=!!window.opera,El=!Xo&&He("chrome"),Oo=He("gecko")&&!Ya&&!oa&&!Cn,Ms=!El&&He("safari"),qc=He("phantom"),Zc="OTransition"in zr,Wc=navigator.platform.indexOf("Win")===0,Da=Cn&&"transition"in zr,Ka="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ec,tc="MozPerspective"in zr,Ls=!window.L_DISABLE_3D&&(Da||Ka||tc)&&!Zc&&!qc,Ja=typeof orientation<"u"||He("mobile"),Wn=Ja&&Ya,Oa=Ja&&Ka,Fu=!window.PointerEvent&&window.MSPointerEvent,Uo=!!(window.PointerEvent||Fu),Sl="ontouchstart"in window||!!window.TouchEvent,Nu=!window.L_NO_TOUCH&&(Sl||Uo),zu=Ja&&oa,Yc=Ja&&Oo,Bu=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,tt=function(){var _=!1;try{var S=Object.defineProperty({},"passive",{get:function(){_=!0}});window.addEventListener("testPassiveEventSupport",$,S),window.removeEventListener("testPassiveEventSupport",$,S)}catch{}return _}(),oe=function(){return!!document.createElement("canvas").getContext}(),ce=!!(document.createElementNS&&Nr("svg").createSVGRect),_e=!!ce&&function(){var _=document.createElement("div");return _.innerHTML="<svg/>",(_.firstChild&&_.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),De=!ce&&function(){try{var _=document.createElement("div");_.innerHTML='<v:shape adj="1"/>';var S=_.firstChild;return S.style.behavior="url(#default#VML)",S&&typeof S.adj=="object"}catch{return!1}}(),Se=navigator.platform.indexOf("Mac")===0,Fe=navigator.platform.indexOf("Linux")===0;function He(_){return navigator.userAgent.toLowerCase().indexOf(_)>=0}var Te={ie:Cn,ielt9:Er,edge:Xo,webkit:Ya,android:Xa,android23:ec,androidStock:Gc,opera:oa,chrome:El,gecko:Oo,safari:Ms,phantom:qc,opera12:Zc,win:Wc,ie3d:Da,webkit3d:Ka,gecko3d:tc,any3d:Ls,mobile:Ja,mobileWebkit:Wn,mobileWebkit3d:Oa,msPointer:Fu,pointer:Uo,touch:Nu,touchNative:Sl,mobileOpera:zu,mobileGecko:Yc,retina:Bu,passiveEvents:tt,canvas:oe,svg:ce,vml:De,inlineSvg:_e,mac:Se,linux:Fe},Je=Te.msPointer?"MSPointerDown":"pointerdown",nt=Te.msPointer?"MSPointerMove":"pointermove",ot=Te.msPointer?"MSPointerUp":"pointerup",wt=Te.msPointer?"MSPointerCancel":"pointercancel",Vt={touchstart:Je,touchmove:nt,touchend:ot,touchcancel:wt},$t={touchstart:qr,touchmove:Si,touchend:Si,touchcancel:Si},pn={},kn=!1;function En(_,S,z){return S==="touchstart"&&Oi(),$t[S]?(z=$t[S].bind(this,z),_.addEventListener(Vt[S],z,!1),z):(console.warn("wrong event specified:",S),$)}function Mn(_,S,z){if(!Vt[S]){console.warn("wrong event specified:",S);return}_.removeEventListener(Vt[S],z,!1)}function ki(_){pn[_.pointerId]=_}function vi(_){pn[_.pointerId]&&(pn[_.pointerId]=_)}function Xn(_){delete pn[_.pointerId]}function Oi(){kn||(document.addEventListener(Je,ki,!0),document.addEventListener(nt,vi,!0),document.addEventListener(ot,Xn,!0),document.addEventListener(wt,Xn,!0),kn=!0)}function Si(_,S){if(S.pointerType!==(S.MSPOINTER_TYPE_MOUSE||"mouse")){S.touches=[];for(var z in pn)S.touches.push(pn[z]);S.changedTouches=[S],_(S)}}function qr(_,S){S.MSPOINTER_TYPE_TOUCH&&S.pointerType===S.MSPOINTER_TYPE_TOUCH&&vo(S),Si(_,S)}function Ho(_){var S={},z,Y;for(Y in _)z=_[Y],S[Y]=z&&z.bind?z.bind(_):z;return _=S,S.type="dblclick",S.detail=2,S.isTrusted=!1,S._simulated=!0,S}var _o=200;function wo(_,S){_.addEventListener("dblclick",S);var z=0,Y;function ne(ye){if(ye.detail!==1){Y=ye.detail;return}if(!(ye.pointerType==="mouse"||ye.sourceCapabilities&&!ye.sourceCapabilities.firesTouchEvents)){var Ge=Al(ye);if(!(Ge.some(function(bt){return bt instanceof HTMLLabelElement&&bt.attributes.for})&&!Ge.some(function(bt){return bt instanceof HTMLInputElement||bt instanceof HTMLSelectElement}))){var ht=Date.now();ht-z<=_o?(Y++,Y===2&&S(Ho(ye))):Y=1,z=ht}}}return _.addEventListener("click",ne),{dblclick:S,simDblclick:ne}}function nc(_,S){_.removeEventListener("dblclick",S.dblclick),_.removeEventListener("click",S.simDblclick)}var Fs=as(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ic=as(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Vu=ic==="webkitTransition"||ic==="OTransition"?ic+"End":"transitionend";function Il(_){return typeof _=="string"?document.getElementById(_):_}function Pl(_,S){var z=_.style[S]||_.currentStyle&&_.currentStyle[S];if((!z||z==="auto")&&document.defaultView){var Y=document.defaultView.getComputedStyle(_,null);z=Y?Y[S]:null}return z==="auto"?null:z}function Ni(_,S,z){var Y=document.createElement(_);return Y.className=S||"",z&&z.appendChild(Y),Y}function hr(_){var S=_.parentNode;S&&S.removeChild(_)}function Aa(_){for(;_.firstChild;)_.removeChild(_.firstChild)}function Dl(_){var S=_.parentNode;S&&S.lastChild!==_&&S.appendChild(_)}function rc(_){var S=_.parentNode;S&&S.firstChild!==_&&S.insertBefore(_,S.firstChild)}function Xc(_,S){if(_.classList!==void 0)return _.classList.contains(S);var z=$o(_);return z.length>0&&new RegExp("(^|\\s)"+S+"(\\s|$)").test(z)}function xi(_,S){if(_.classList!==void 0)for(var z=le(S),Y=0,ne=z.length;Y<ne;Y++)_.classList.add(z[Y]);else if(!Xc(_,S)){var ye=$o(_);ju(_,(ye?ye+" ":"")+S)}}function jr(_,S){_.classList!==void 0?_.classList.remove(S):ju(_,se((" "+$o(_)+" ").replace(" "+S+" "," ")))}function ju(_,S){_.className.baseVal===void 0?_.className=S:_.className.baseVal=S}function $o(_){return _.correspondingElement&&(_=_.correspondingElement),_.className.baseVal===void 0?_.className:_.className.baseVal}function Qr(_,S){"opacity"in _.style?_.style.opacity=S:"filter"in _.style&&Ns(_,S)}function Ns(_,S){var z=!1,Y="DXImageTransform.Microsoft.Alpha";try{z=_.filters.item(Y)}catch{if(S===1)return}S=Math.round(S*100),z?(z.Enabled=S!==100,z.Opacity=S):_.style.filter+=" progid:"+Y+"(opacity="+S+")"}function as(_){for(var S=document.documentElement.style,z=0;z<_.length;z++)if(_[z]in S)return _[z];return!1}function Ko(_,S,z){var Y=S||new Ke(0,0);_.style[Fs]=(Te.ie3d?"translate("+Y.x+"px,"+Y.y+"px)":"translate3d("+Y.x+"px,"+Y.y+"px,0)")+(z?" scale("+z+")":"")}function Zr(_,S){_._leaflet_pos=S,Te.any3d?Ko(_,S):(_.style.left=S.x+"px",_.style.top=S.y+"px")}function sa(_){return _._leaflet_pos||new Ke(0,0)}var zs,Bs,Kc;if("onselectstart"in document)zs=function(){_i(window,"selectstart",vo)},Bs=function(){wr(window,"selectstart",vo)};else{var oc=as(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);zs=function(){if(oc){var _=document.documentElement.style;Kc=_[oc],_[oc]="none"}},Bs=function(){oc&&(document.documentElement.style[oc]=Kc,Kc=void 0)}}function Ol(){_i(window,"dragstart",vo)}function ls(){wr(window,"dragstart",vo)}var sc,Jc;function oi(_){for(;_.tabIndex===-1;)_=_.parentNode;_.style&&(jh(),sc=_,Jc=_.style.outlineStyle,_.style.outlineStyle="none",_i(window,"keydown",jh))}function jh(){sc&&(sc.style.outlineStyle=Jc,sc=void 0,Jc=void 0,wr(window,"keydown",jh))}function gn(_){do _=_.parentNode;while((!_.offsetWidth||!_.offsetHeight)&&_!==document.body);return _}function Uu(_){var S=_.getBoundingClientRect();return{x:S.width/_.offsetWidth||1,y:S.height/_.offsetHeight||1,boundingClientRect:S}}var li={__proto__:null,TRANSFORM:Fs,TRANSITION:ic,TRANSITION_END:Vu,get:Il,getStyle:Pl,create:Ni,remove:hr,empty:Aa,toFront:Dl,toBack:rc,hasClass:Xc,addClass:xi,removeClass:jr,setClass:ju,getClass:$o,setOpacity:Qr,testProp:as,setTransform:Ko,setPosition:Zr,getPosition:sa,get disableTextSelection(){return zs},get enableTextSelection(){return Bs},disableImageDrag:Ol,enableImageDrag:ls,preventOutline:oi,restoreOutline:jh,getSizedParentNode:gn,getScale:Uu};function _i(_,S,z,Y){if(S&&typeof S=="object")for(var ne in S)di(_,ne,S[ne],z);else{S=le(S);for(var ye=0,Ge=S.length;ye<Ge;ye++)di(_,S[ye],z,Y)}return this}var oo="_leaflet_events";function wr(_,S,z,Y){if(arguments.length===1)ac(_),delete _[oo];else if(S&&typeof S=="object")for(var ne in S)ii(_,ne,S[ne],z);else if(S=le(S),arguments.length===2)ac(_,function(ht){return st(S,ht)!==-1});else for(var ye=0,Ge=S.length;ye<Ge;ye++)ii(_,S[ye],z,Y);return this}function ac(_,S){for(var z in _[oo]){var Y=z.split(/\d/)[0];(!S||S(Y))&&ii(_,Y,null,null,z)}}var Yt={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function di(_,S,z,Y){var ne=S+w(z)+(Y?"_"+w(Y):"");if(_[oo]&&_[oo][ne])return this;var ye=function(ht){return z.call(Y||_,ht||window.event)},Ge=ye;!Te.touchNative&&Te.pointer&&S.indexOf("touch")===0?ye=En(_,S,ye):Te.touch&&S==="dblclick"?ye=wo(_,ye):"addEventListener"in _?S==="touchstart"||S==="touchmove"||S==="wheel"||S==="mousewheel"?_.addEventListener(Yt[S]||S,ye,Te.passiveEvents?{passive:!1}:!1):S==="mouseenter"||S==="mouseleave"?(ye=function(ht){ht=ht||window.event,lc(_,ht)&&Ge(ht)},_.addEventListener(Yt[S],ye,!1)):_.addEventListener(S,Ge,!1):_.attachEvent("on"+S,ye),_[oo]=_[oo]||{},_[oo][ne]=ye}function ii(_,S,z,Y,ne){ne=ne||S+w(z)+(Y?"_"+w(Y):"");var ye=_[oo]&&_[oo][ne];if(!ye)return this;!Te.touchNative&&Te.pointer&&S.indexOf("touch")===0?Mn(_,S,ye):Te.touch&&S==="dblclick"?nc(_,ye):"removeEventListener"in _?_.removeEventListener(Yt[S]||S,ye,!1):_.detachEvent("on"+S,ye),_[oo][ne]=null}function yo(_){return _.stopPropagation?_.stopPropagation():_.originalEvent?_.originalEvent._stopped=!0:_.cancelBubble=!0,this}function Qa(_){return di(_,"wheel",yo),this}function Kn(_){return _i(_,"mousedown touchstart dblclick contextmenu",yo),_._leaflet_disable_click=!0,this}function vo(_){return _.preventDefault?_.preventDefault():_.returnValue=!1,this}function Jo(_){return vo(_),yo(_),this}function Al(_){if(_.composedPath)return _.composedPath();for(var S=[],z=_.target;z;)S.push(z),z=z.parentNode;return S}function Ao(_,S){if(!S)return new Ke(_.clientX,_.clientY);var z=Uu(S),Y=z.boundingClientRect;return new Ke((_.clientX-Y.left)/z.x-S.clientLeft,(_.clientY-Y.top)/z.y-S.clientTop)}var Wi=Te.linux&&Te.chrome?window.devicePixelRatio:Te.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ff(_){return Te.edge?_.wheelDeltaY/2:_.deltaY&&_.deltaMode===0?-_.deltaY/Wi:_.deltaY&&_.deltaMode===1?-_.deltaY*20:_.deltaY&&_.deltaMode===2?-_.deltaY*60:_.deltaX||_.deltaZ?0:_.wheelDelta?(_.wheelDeltaY||_.wheelDelta)/2:_.detail&&Math.abs(_.detail)<32765?-_.detail*20:_.detail?_.detail/-32765*60:0}function lc(_,S){var z=S.relatedTarget;if(!z)return!0;try{for(;z&&z!==_;)z=z.parentNode}catch{return!1}return z!==_}var Uh={__proto__:null,on:_i,off:wr,stopPropagation:yo,disableScrollPropagation:Qa,disableClickPropagation:Kn,preventDefault:vo,stop:Jo,getPropagationPath:Al,getMousePosition:Ao,getWheelDelta:ff,isExternalTarget:lc,addListener:_i,removeListener:wr},cc=At.extend({run:function(_,S,z,Y){this.stop(),this._el=_,this._inProgress=!0,this._duration=z||.25,this._easeOutPower=1/Math.max(Y||.5,.2),this._startPos=sa(_),this._offset=S.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Tt(this._animate,this),this._step()},_step:function(_){var S=+new Date-this._startTime,z=this._duration*1e3;S<z?this._runFrame(this._easeOut(S/z),_):(this._runFrame(1),this._complete())},_runFrame:function(_,S){var z=this._startPos.add(this._offset.multiplyBy(_));S&&z._round(),Zr(this._el,z),this.fire("step")},_complete:function(){ri(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(_){return 1-Math.pow(1-_,this._easeOutPower)}}),zi=At.extend({options:{crs:gi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(_,S){S=ae(this,S),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(_),this._initLayout(),this._onResize=h(this._onResize,this),this._initEvents(),S.maxBounds&&this.setMaxBounds(S.maxBounds),S.zoom!==void 0&&(this._zoom=this._limitZoom(S.zoom)),S.center&&S.zoom!==void 0&&this.setView(_n(S.center),S.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ic&&Te.any3d&&!Te.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),_i(this._proxy,Vu,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(_,S,z){if(S=S===void 0?this._zoom:this._limitZoom(S),_=this._limitCenter(_n(_),S,this.options.maxBounds),z=z||{},this._stop(),this._loaded&&!z.reset&&z!==!0){z.animate!==void 0&&(z.zoom=n({animate:z.animate},z.zoom),z.pan=n({animate:z.animate,duration:z.duration},z.pan));var Y=this._zoom!==S?this._tryAnimatedZoom&&this._tryAnimatedZoom(_,S,z.zoom):this._tryAnimatedPan(_,z.pan);if(Y)return clearTimeout(this._sizeTimer),this}return this._resetView(_,S,z.pan&&z.pan.noMoveStart),this},setZoom:function(_,S){return this._loaded?this.setView(this.getCenter(),_,{zoom:S}):(this._zoom=_,this)},zoomIn:function(_,S){return _=_||(Te.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+_,S)},zoomOut:function(_,S){return _=_||(Te.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-_,S)},setZoomAround:function(_,S,z){var Y=this.getZoomScale(S),ne=this.getSize().divideBy(2),ye=_ instanceof Ke?_:this.latLngToContainerPoint(_),Ge=ye.subtract(ne).multiplyBy(1-1/Y),ht=this.containerPointToLatLng(ne.add(Ge));return this.setView(ht,S,{zoom:z})},_getBoundsCenterZoom:function(_,S){S=S||{},_=_.getBounds?_.getBounds():Dn(_);var z=It(S.paddingTopLeft||S.padding||[0,0]),Y=It(S.paddingBottomRight||S.padding||[0,0]),ne=this.getBoundsZoom(_,!1,z.add(Y));if(ne=typeof S.maxZoom=="number"?Math.min(S.maxZoom,ne):ne,ne===1/0)return{center:_.getCenter(),zoom:ne};var ye=Y.subtract(z).divideBy(2),Ge=this.project(_.getSouthWest(),ne),ht=this.project(_.getNorthEast(),ne),bt=this.unproject(Ge.add(ht).divideBy(2).add(ye),ne);return{center:bt,zoom:ne}},fitBounds:function(_,S){if(_=Dn(_),!_.isValid())throw new Error("Bounds are not valid.");var z=this._getBoundsCenterZoom(_,S);return this.setView(z.center,z.zoom,S)},fitWorld:function(_){return this.fitBounds([[-90,-180],[90,180]],_)},panTo:function(_,S){return this.setView(_,this._zoom,{pan:S})},panBy:function(_,S){if(_=It(_).round(),S=S||{},!_.x&&!_.y)return this.fire("moveend");if(S.animate!==!0&&!this.getSize().contains(_))return this._resetView(this.unproject(this.project(this.getCenter()).add(_)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new cc,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),S.noMoveStart||this.fire("movestart"),S.animate!==!1){xi(this._mapPane,"leaflet-pan-anim");var z=this._getMapPanePos().subtract(_).round();this._panAnim.run(this._mapPane,z,S.duration||.25,S.easeLinearity)}else this._rawPanBy(_),this.fire("move").fire("moveend");return this},flyTo:function(_,S,z){if(z=z||{},z.animate===!1||!Te.any3d)return this.setView(_,S,z);this._stop();var Y=this.project(this.getCenter()),ne=this.project(_),ye=this.getSize(),Ge=this._zoom;_=_n(_),S=S===void 0?Ge:S;var ht=Math.max(ye.x,ye.y),bt=ht*this.getZoomScale(Ge,S),Zt=ne.distanceTo(Y)||1,vn=1.42,ei=vn*vn;function Pi(lo){var al=lo?-1:1,em=lo?bt:ht,Ef=bt*bt-ht*ht+al*ei*ei*Zt*Zt,Sf=2*em*ei*Zt,Fa=Ef/Sf,ll=Math.sqrt(Fa*Fa+1)-Fa,If=ll<1e-9?-18:Math.log(ll);return If}function Go(lo){return(Math.exp(lo)-Math.exp(-lo))/2}function Mo(lo){return(Math.exp(lo)+Math.exp(-lo))/2}function zo(lo){return Go(lo)/Mo(lo)}var ps=Pi(0);function su(lo){return ht*(Mo(ps)/Mo(ps+vn*lo))}function f_(lo){return ht*(Mo(ps)*zo(ps+vn*lo)-Go(ps))/ei}function p_(lo){return 1-Math.pow(1-lo,1.5)}var m_=Date.now(),ed=(Pi(1)-ps)/vn,Tf=z.duration?1e3*z.duration:1e3*ed*.8;function Qu(){var lo=(Date.now()-m_)/Tf,al=p_(lo)*ed;lo<=1?(this._flyToFrame=Tt(Qu,this),this._move(this.unproject(Y.add(ne.subtract(Y).multiplyBy(f_(al)/Zt)),Ge),this.getScaleZoom(ht/su(al),Ge),{flyTo:!0})):this._move(_,S)._moveEnd(!0)}return this._moveStart(!0,z.noMoveStart),Qu.call(this),this},flyToBounds:function(_,S){var z=this._getBoundsCenterZoom(_,S);return this.flyTo(z.center,z.zoom,S)},setMaxBounds:function(_){return _=Dn(_),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),_.isValid()?(this.options.maxBounds=_,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(_){var S=this.options.minZoom;return this.options.minZoom=_,this._loaded&&S!==_&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(_):this},setMaxZoom:function(_){var S=this.options.maxZoom;return this.options.maxZoom=_,this._loaded&&S!==_&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(_):this},panInsideBounds:function(_,S){this._enforcingBounds=!0;var z=this.getCenter(),Y=this._limitCenter(z,this._zoom,Dn(_));return z.equals(Y)||this.panTo(Y,S),this._enforcingBounds=!1,this},panInside:function(_,S){S=S||{};var z=It(S.paddingTopLeft||S.padding||[0,0]),Y=It(S.paddingBottomRight||S.padding||[0,0]),ne=this.project(this.getCenter()),ye=this.project(_),Ge=this.getPixelBounds(),ht=dn([Ge.min.add(z),Ge.max.subtract(Y)]),bt=ht.getSize();if(!ht.contains(ye)){this._enforcingBounds=!0;var Zt=ye.subtract(ht.getCenter()),vn=ht.extend(ye).getSize().subtract(bt);ne.x+=Zt.x<0?-vn.x:vn.x,ne.y+=Zt.y<0?-vn.y:vn.y,this.panTo(this.unproject(ne),S),this._enforcingBounds=!1}return this},invalidateSize:function(_){if(!this._loaded)return this;_=n({animate:!1,pan:!0},_===!0?{animate:!0}:_);var S=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var z=this.getSize(),Y=S.divideBy(2).round(),ne=z.divideBy(2).round(),ye=Y.subtract(ne);return!ye.x&&!ye.y?this:(_.animate&&_.pan?this.panBy(ye):(_.pan&&this._rawPanBy(ye),this.fire("move"),_.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(h(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:S,newSize:z}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(_){if(_=this._locateOptions=n({timeout:1e4,watch:!1},_),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var S=h(this._handleGeolocationResponse,this),z=h(this._handleGeolocationError,this);return _.watch?this._locationWatchId=navigator.geolocation.watchPosition(S,z,_):navigator.geolocation.getCurrentPosition(S,z,_),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(_){if(this._container._leaflet_id){var S=_.code,z=_.message||(S===1?"permission denied":S===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:S,message:"Geolocation error: "+z+"."})}},_handleGeolocationResponse:function(_){if(this._container._leaflet_id){var S=_.coords.latitude,z=_.coords.longitude,Y=new An(S,z),ne=Y.toBounds(_.coords.accuracy*2),ye=this._locateOptions;if(ye.setView){var Ge=this.getBoundsZoom(ne);this.setView(Y,ye.maxZoom?Math.min(Ge,ye.maxZoom):Ge)}var ht={latlng:Y,bounds:ne,timestamp:_.timestamp};for(var bt in _.coords)typeof _.coords[bt]=="number"&&(ht[bt]=_.coords[bt]);this.fire("locationfound",ht)}},addHandler:function(_,S){if(!S)return this;var z=this[_]=new S(this);return this._handlers.push(z),this.options[_]&&z.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),hr(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(ri(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var _;for(_ in this._layers)this._layers[_].remove();for(_ in this._panes)hr(this._panes[_]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(_,S){var z="leaflet-pane"+(_?" leaflet-"+_.replace("Pane","")+"-pane":""),Y=Ni("div",z,S||this._mapPane);return _&&(this._panes[_]=Y),Y},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var _=this.getPixelBounds(),S=this.unproject(_.getBottomLeft()),z=this.unproject(_.getTopRight());return new Ft(S,z)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(_,S,z){_=Dn(_),z=It(z||[0,0]);var Y=this.getZoom()||0,ne=this.getMinZoom(),ye=this.getMaxZoom(),Ge=_.getNorthWest(),ht=_.getSouthEast(),bt=this.getSize().subtract(z),Zt=dn(this.project(ht,Y),this.project(Ge,Y)).getSize(),vn=Te.any3d?this.options.zoomSnap:1,ei=bt.x/Zt.x,Pi=bt.y/Zt.y,Go=S?Math.max(ei,Pi):Math.min(ei,Pi);return Y=this.getScaleZoom(Go,Y),vn&&(Y=Math.round(Y/(vn/100))*(vn/100),Y=S?Math.ceil(Y/vn)*vn:Math.floor(Y/vn)*vn),Math.max(ne,Math.min(ye,Y))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Ke(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(_,S){var z=this._getTopLeftPoint(_,S);return new en(z,z.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(_){return this.options.crs.getProjectedBounds(_===void 0?this.getZoom():_)},getPane:function(_){return typeof _=="string"?this._panes[_]:_},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(_,S){var z=this.options.crs;return S=S===void 0?this._zoom:S,z.scale(_)/z.scale(S)},getScaleZoom:function(_,S){var z=this.options.crs;S=S===void 0?this._zoom:S;var Y=z.zoom(_*z.scale(S));return isNaN(Y)?1/0:Y},project:function(_,S){return S=S===void 0?this._zoom:S,this.options.crs.latLngToPoint(_n(_),S)},unproject:function(_,S){return S=S===void 0?this._zoom:S,this.options.crs.pointToLatLng(It(_),S)},layerPointToLatLng:function(_){var S=It(_).add(this.getPixelOrigin());return this.unproject(S)},latLngToLayerPoint:function(_){var S=this.project(_n(_))._round();return S._subtract(this.getPixelOrigin())},wrapLatLng:function(_){return this.options.crs.wrapLatLng(_n(_))},wrapLatLngBounds:function(_){return this.options.crs.wrapLatLngBounds(Dn(_))},distance:function(_,S){return this.options.crs.distance(_n(_),_n(S))},containerPointToLayerPoint:function(_){return It(_).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(_){return It(_).add(this._getMapPanePos())},containerPointToLatLng:function(_){var S=this.containerPointToLayerPoint(It(_));return this.layerPointToLatLng(S)},latLngToContainerPoint:function(_){return this.layerPointToContainerPoint(this.latLngToLayerPoint(_n(_)))},mouseEventToContainerPoint:function(_){return Ao(_,this._container)},mouseEventToLayerPoint:function(_){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(_))},mouseEventToLatLng:function(_){return this.layerPointToLatLng(this.mouseEventToLayerPoint(_))},_initContainer:function(_){var S=this._container=Il(_);if(S){if(S._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");_i(S,"scroll",this._onScroll,this),this._containerId=w(S)},_initLayout:function(){var _=this._container;this._fadeAnimated=this.options.fadeAnimation&&Te.any3d,xi(_,"leaflet-container"+(Te.touch?" leaflet-touch":"")+(Te.retina?" leaflet-retina":"")+(Te.ielt9?" leaflet-oldie":"")+(Te.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var S=Pl(_,"position");S!=="absolute"&&S!=="relative"&&S!=="fixed"&&S!=="sticky"&&(_.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var _=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Zr(this._mapPane,new Ke(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(xi(_.markerPane,"leaflet-zoom-hide"),xi(_.shadowPane,"leaflet-zoom-hide"))},_resetView:function(_,S,z){Zr(this._mapPane,new Ke(0,0));var Y=!this._loaded;this._loaded=!0,S=this._limitZoom(S),this.fire("viewprereset");var ne=this._zoom!==S;this._moveStart(ne,z)._move(_,S)._moveEnd(ne),this.fire("viewreset"),Y&&this.fire("load")},_moveStart:function(_,S){return _&&this.fire("zoomstart"),S||this.fire("movestart"),this},_move:function(_,S,z,Y){S===void 0&&(S=this._zoom);var ne=this._zoom!==S;return this._zoom=S,this._lastCenter=_,this._pixelOrigin=this._getNewPixelOrigin(_),Y?z&&z.pinch&&this.fire("zoom",z):((ne||z&&z.pinch)&&this.fire("zoom",z),this.fire("move",z)),this},_moveEnd:function(_){return _&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return ri(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(_){Zr(this._mapPane,this._getMapPanePos().subtract(_))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(_){this._targets={},this._targets[w(this._container)]=this;var S=_?wr:_i;S(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&S(window,"resize",this._onResize,this),Te.any3d&&this.options.transform3DLimit&&(_?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){ri(this._resizeRequest),this._resizeRequest=Tt(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var _=this._getMapPanePos();Math.max(Math.abs(_.x),Math.abs(_.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(_,S){for(var z=[],Y,ne=S==="mouseout"||S==="mouseover",ye=_.target||_.srcElement,Ge=!1;ye;){if(Y=this._targets[w(ye)],Y&&(S==="click"||S==="preclick")&&this._draggableMoved(Y)){Ge=!0;break}if(Y&&Y.listens(S,!0)&&(ne&&!lc(ye,_)||(z.push(Y),ne))||ye===this._container)break;ye=ye.parentNode}return!z.length&&!Ge&&!ne&&this.listens(S,!0)&&(z=[this]),z},_isClickDisabled:function(_){for(;_&&_!==this._container;){if(_._leaflet_disable_click)return!0;_=_.parentNode}},_handleDOMEvent:function(_){var S=_.target||_.srcElement;if(!(!this._loaded||S._leaflet_disable_events||_.type==="click"&&this._isClickDisabled(S))){var z=_.type;z==="mousedown"&&oi(S),this._fireDOMEvent(_,z)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(_,S,z){if(_.type==="click"){var Y=n({},_);Y.type="preclick",this._fireDOMEvent(Y,Y.type,z)}var ne=this._findEventTargets(_,S);if(z){for(var ye=[],Ge=0;Ge<z.length;Ge++)z[Ge].listens(S,!0)&&ye.push(z[Ge]);ne=ye.concat(ne)}if(ne.length){S==="contextmenu"&&vo(_);var ht=ne[0],bt={originalEvent:_};if(_.type!=="keypress"&&_.type!=="keydown"&&_.type!=="keyup"){var Zt=ht.getLatLng&&(!ht._radius||ht._radius<=10);bt.containerPoint=Zt?this.latLngToContainerPoint(ht.getLatLng()):this.mouseEventToContainerPoint(_),bt.layerPoint=this.containerPointToLayerPoint(bt.containerPoint),bt.latlng=Zt?ht.getLatLng():this.layerPointToLatLng(bt.layerPoint)}for(Ge=0;Ge<ne.length;Ge++)if(ne[Ge].fire(S,bt,!0),bt.originalEvent._stopped||ne[Ge].options.bubblingMouseEvents===!1&&st(this._mouseEvents,S)!==-1)return}},_draggableMoved:function(_){return _=_.dragging&&_.dragging.enabled()?_:this,_.dragging&&_.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var _=0,S=this._handlers.length;_<S;_++)this._handlers[_].disable()},whenReady:function(_,S){return this._loaded?_.call(S||this,{target:this}):this.on("load",_,S),this},_getMapPanePos:function(){return sa(this._mapPane)||new Ke(0,0)},_moved:function(){var _=this._getMapPanePos();return _&&!_.equals([0,0])},_getTopLeftPoint:function(_,S){var z=_&&S!==void 0?this._getNewPixelOrigin(_,S):this.getPixelOrigin();return z.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(_,S){var z=this.getSize()._divideBy(2);return this.project(_,S)._subtract(z)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(_,S,z){var Y=this._getNewPixelOrigin(z,S);return this.project(_,S)._subtract(Y)},_latLngBoundsToNewLayerBounds:function(_,S,z){var Y=this._getNewPixelOrigin(z,S);return dn([this.project(_.getSouthWest(),S)._subtract(Y),this.project(_.getNorthWest(),S)._subtract(Y),this.project(_.getSouthEast(),S)._subtract(Y),this.project(_.getNorthEast(),S)._subtract(Y)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(_){return this.latLngToLayerPoint(_).subtract(this._getCenterLayerPoint())},_limitCenter:function(_,S,z){if(!z)return _;var Y=this.project(_,S),ne=this.getSize().divideBy(2),ye=new en(Y.subtract(ne),Y.add(ne)),Ge=this._getBoundsOffset(ye,z,S);return Math.abs(Ge.x)<=1&&Math.abs(Ge.y)<=1?_:this.unproject(Y.add(Ge),S)},_limitOffset:function(_,S){if(!S)return _;var z=this.getPixelBounds(),Y=new en(z.min.add(_),z.max.add(_));return _.add(this._getBoundsOffset(Y,S))},_getBoundsOffset:function(_,S,z){var Y=dn(this.project(S.getNorthEast(),z),this.project(S.getSouthWest(),z)),ne=Y.min.subtract(_.min),ye=Y.max.subtract(_.max),Ge=this._rebound(ne.x,-ye.x),ht=this._rebound(ne.y,-ye.y);return new Ke(Ge,ht)},_rebound:function(_,S){return _+S>0?Math.round(_-S)/2:Math.max(0,Math.ceil(_))-Math.max(0,Math.floor(S))},_limitZoom:function(_){var S=this.getMinZoom(),z=this.getMaxZoom(),Y=Te.any3d?this.options.zoomSnap:1;return Y&&(_=Math.round(_/Y)*Y),Math.max(S,Math.min(z,_))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){jr(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(_,S){var z=this._getCenterOffset(_)._trunc();return(S&&S.animate)!==!0&&!this.getSize().contains(z)?!1:(this.panBy(z,S),!0)},_createAnimProxy:function(){var _=this._proxy=Ni("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(_),this.on("zoomanim",function(S){var z=Fs,Y=this._proxy.style[z];Ko(this._proxy,this.project(S.center,S.zoom),this.getZoomScale(S.zoom,1)),Y===this._proxy.style[z]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){hr(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var _=this.getCenter(),S=this.getZoom();Ko(this._proxy,this.project(_,S),this.getZoomScale(S,1))},_catchTransitionEnd:function(_){this._animatingZoom&&_.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(_,S,z){if(this._animatingZoom)return!0;if(z=z||{},!this._zoomAnimated||z.animate===!1||this._nothingToAnimate()||Math.abs(S-this._zoom)>this.options.zoomAnimationThreshold)return!1;var Y=this.getZoomScale(S),ne=this._getCenterOffset(_)._divideBy(1-1/Y);return z.animate!==!0&&!this.getSize().contains(ne)?!1:(Tt(function(){this._moveStart(!0,z.noMoveStart||!1)._animateZoom(_,S,!0)},this),!0)},_animateZoom:function(_,S,z,Y){this._mapPane&&(z&&(this._animatingZoom=!0,this._animateToCenter=_,this._animateToZoom=S,xi(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:_,zoom:S,noUpdate:Y}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(h(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&jr(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Hu(_,S){return new zi(_,S)}var Sr=ln.extend({options:{position:"topright"},initialize:function(_){ae(this,_)},getPosition:function(){return this.options.position},setPosition:function(_){var S=this._map;return S&&S.removeControl(this),this.options.position=_,S&&S.addControl(this),this},getContainer:function(){return this._container},addTo:function(_){this.remove(),this._map=_;var S=this._container=this.onAdd(_),z=this.getPosition(),Y=_._controlCorners[z];return xi(S,"leaflet-control"),z.indexOf("bottom")!==-1?Y.insertBefore(S,Y.firstChild):Y.appendChild(S),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(hr(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(_){this._map&&_&&_.screenX>0&&_.screenY>0&&this._map.getContainer().focus()}}),cs=function(_){return new Sr(_)};zi.include({addControl:function(_){return _.addTo(this),this},removeControl:function(_){return _.remove(),this},_initControlPos:function(){var _=this._controlCorners={},S="leaflet-",z=this._controlContainer=Ni("div",S+"control-container",this._container);function Y(ne,ye){var Ge=S+ne+" "+S+ye;_[ne+ye]=Ni("div",Ge,z)}Y("top","left"),Y("top","right"),Y("bottom","left"),Y("bottom","right")},_clearControlPos:function(){for(var _ in this._controlCorners)hr(this._controlCorners[_]);hr(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var so=Sr.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(_,S,z,Y){return z<Y?-1:Y<z?1:0}},initialize:function(_,S,z){ae(this,z),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var Y in _)this._addLayer(_[Y],Y);for(Y in S)this._addLayer(S[Y],Y,!0)},onAdd:function(_){this._initLayout(),this._update(),this._map=_,_.on("zoomend",this._checkDisabledLayers,this);for(var S=0;S<this._layers.length;S++)this._layers[S].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(_){return Sr.prototype.addTo.call(this,_),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var _=0;_<this._layers.length;_++)this._layers[_].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(_,S){return this._addLayer(_,S),this._map?this._update():this},addOverlay:function(_,S){return this._addLayer(_,S,!0),this._map?this._update():this},removeLayer:function(_){_.off("add remove",this._onLayerChange,this);var S=this._getLayer(w(_));return S&&this._layers.splice(this._layers.indexOf(S),1),this._map?this._update():this},expand:function(){xi(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var _=this._map.getSize().y-(this._container.offsetTop+50);return _<this._section.clientHeight?(xi(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=_+"px"):jr(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return jr(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var _="leaflet-control-layers",S=this._container=Ni("div",_),z=this.options.collapsed;S.setAttribute("aria-haspopup",!0),Kn(S),Qa(S);var Y=this._section=Ni("section",_+"-list");z&&(this._map.on("click",this.collapse,this),_i(S,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var ne=this._layersLink=Ni("a",_+"-toggle",S);ne.href="#",ne.title="Layers",ne.setAttribute("role","button"),_i(ne,{keydown:function(ye){ye.keyCode===13&&this._expandSafely()},click:function(ye){vo(ye),this._expandSafely()}},this),z||this.expand(),this._baseLayersList=Ni("div",_+"-base",Y),this._separator=Ni("div",_+"-separator",Y),this._overlaysList=Ni("div",_+"-overlays",Y),S.appendChild(Y)},_getLayer:function(_){for(var S=0;S<this._layers.length;S++)if(this._layers[S]&&w(this._layers[S].layer)===_)return this._layers[S]},_addLayer:function(_,S,z){this._map&&_.on("add remove",this._onLayerChange,this),this._layers.push({layer:_,name:S,overlay:z}),this.options.sortLayers&&this._layers.sort(h(function(Y,ne){return this.options.sortFunction(Y.layer,ne.layer,Y.name,ne.name)},this)),this.options.autoZIndex&&_.setZIndex&&(this._lastZIndex++,_.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Aa(this._baseLayersList),Aa(this._overlaysList),this._layerControlInputs=[];var _,S,z,Y,ne=0;for(z=0;z<this._layers.length;z++)Y=this._layers[z],this._addItem(Y),S=S||Y.overlay,_=_||!Y.overlay,ne+=Y.overlay?0:1;return this.options.hideSingleBase&&(_=_&&ne>1,this._baseLayersList.style.display=_?"":"none"),this._separator.style.display=S&&_?"":"none",this},_onLayerChange:function(_){this._handlingClick||this._update();var S=this._getLayer(w(_.target)),z=S.overlay?_.type==="add"?"overlayadd":"overlayremove":_.type==="add"?"baselayerchange":null;z&&this._map.fire(z,S)},_createRadioElement:function(_,S){var z='<input type="radio" class="leaflet-control-layers-selector" name="'+_+'"'+(S?' checked="checked"':"")+"/>",Y=document.createElement("div");return Y.innerHTML=z,Y.firstChild},_addItem:function(_){var S=document.createElement("label"),z=this._map.hasLayer(_.layer),Y;_.overlay?(Y=document.createElement("input"),Y.type="checkbox",Y.className="leaflet-control-layers-selector",Y.defaultChecked=z):Y=this._createRadioElement("leaflet-base-layers_"+w(this),z),this._layerControlInputs.push(Y),Y.layerId=w(_.layer),_i(Y,"click",this._onInputClick,this);var ne=document.createElement("span");ne.innerHTML=" "+_.name;var ye=document.createElement("span");S.appendChild(ye),ye.appendChild(Y),ye.appendChild(ne);var Ge=_.overlay?this._overlaysList:this._baseLayersList;return Ge.appendChild(S),this._checkDisabledLayers(),S},_onInputClick:function(){if(!this._preventClick){var _=this._layerControlInputs,S,z,Y=[],ne=[];this._handlingClick=!0;for(var ye=_.length-1;ye>=0;ye--)S=_[ye],z=this._getLayer(S.layerId).layer,S.checked?Y.push(z):S.checked||ne.push(z);for(ye=0;ye<ne.length;ye++)this._map.hasLayer(ne[ye])&&this._map.removeLayer(ne[ye]);for(ye=0;ye<Y.length;ye++)this._map.hasLayer(Y[ye])||this._map.addLayer(Y[ye]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var _=this._layerControlInputs,S,z,Y=this._map.getZoom(),ne=_.length-1;ne>=0;ne--)S=_[ne],z=this._getLayer(S.layerId).layer,S.disabled=z.options.minZoom!==void 0&&Y<z.options.minZoom||z.options.maxZoom!==void 0&&Y>z.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var _=this._section;this._preventClick=!0,_i(_,"click",vo),this.expand();var S=this;setTimeout(function(){wr(_,"click",vo),S._preventClick=!1})}}),uc=function(_,S,z){return new so(_,S,z)},el=Sr.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(_){var S="leaflet-control-zoom",z=Ni("div",S+" leaflet-bar"),Y=this.options;return this._zoomInButton=this._createButton(Y.zoomInText,Y.zoomInTitle,S+"-in",z,this._zoomIn),this._zoomOutButton=this._createButton(Y.zoomOutText,Y.zoomOutTitle,S+"-out",z,this._zoomOut),this._updateDisabled(),_.on("zoomend zoomlevelschange",this._updateDisabled,this),z},onRemove:function(_){_.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(_){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(_.shiftKey?3:1))},_zoomOut:function(_){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(_.shiftKey?3:1))},_createButton:function(_,S,z,Y,ne){var ye=Ni("a",z,Y);return ye.innerHTML=_,ye.href="#",ye.title=S,ye.setAttribute("role","button"),ye.setAttribute("aria-label",S),Kn(ye),_i(ye,"click",Jo),_i(ye,"click",ne,this),_i(ye,"click",this._refocusOnMap,this),ye},_updateDisabled:function(){var _=this._map,S="leaflet-disabled";jr(this._zoomInButton,S),jr(this._zoomOutButton,S),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||_._zoom===_.getMinZoom())&&(xi(this._zoomOutButton,S),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||_._zoom===_.getMaxZoom())&&(xi(this._zoomInButton,S),this._zoomInButton.setAttribute("aria-disabled","true"))}});zi.mergeOptions({zoomControl:!0}),zi.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new el,this.addControl(this.zoomControl))});var dr=function(_){return new el(_)},Vs=Sr.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(_){var S="leaflet-control-scale",z=Ni("div",S),Y=this.options;return this._addScales(Y,S+"-line",z),_.on(Y.updateWhenIdle?"moveend":"move",this._update,this),_.whenReady(this._update,this),z},onRemove:function(_){_.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(_,S,z){_.metric&&(this._mScale=Ni("div",S,z)),_.imperial&&(this._iScale=Ni("div",S,z))},_update:function(){var _=this._map,S=_.getSize().y/2,z=_.distance(_.containerPointToLatLng([0,S]),_.containerPointToLatLng([this.options.maxWidth,S]));this._updateScales(z)},_updateScales:function(_){this.options.metric&&_&&this._updateMetric(_),this.options.imperial&&_&&this._updateImperial(_)},_updateMetric:function(_){var S=this._getRoundNum(_),z=S<1e3?S+" m":S/1e3+" km";this._updateScale(this._mScale,z,S/_)},_updateImperial:function(_){var S=_*3.2808399,z,Y,ne;S>5280?(z=S/5280,Y=this._getRoundNum(z),this._updateScale(this._iScale,Y+" mi",Y/z)):(ne=this._getRoundNum(S),this._updateScale(this._iScale,ne+" ft",ne/S))},_updateScale:function(_,S,z){_.style.width=Math.round(this.options.maxWidth*z)+"px",_.innerHTML=S},_getRoundNum:function(_){var S=Math.pow(10,(Math.floor(_)+"").length-1),z=_/S;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:1,S*z}}),js=function(_){return new Vs(_)},Ur='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',hc=Sr.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Te.inlineSvg?Ur+" ":"")+"Leaflet</a>"},initialize:function(_){ae(this,_),this._attributions={}},onAdd:function(_){_.attributionControl=this,this._container=Ni("div","leaflet-control-attribution"),Kn(this._container);for(var S in _._layers)_._layers[S].getAttribution&&this.addAttribution(_._layers[S].getAttribution());return this._update(),_.on("layeradd",this._addAttribution,this),this._container},onRemove:function(_){_.off("layeradd",this._addAttribution,this)},_addAttribution:function(_){_.layer.getAttribution&&(this.addAttribution(_.layer.getAttribution()),_.layer.once("remove",function(){this.removeAttribution(_.layer.getAttribution())},this))},setPrefix:function(_){return this.options.prefix=_,this._update(),this},addAttribution:function(_){return _?(this._attributions[_]||(this._attributions[_]=0),this._attributions[_]++,this._update(),this):this},removeAttribution:function(_){return _?(this._attributions[_]&&(this._attributions[_]--,this._update()),this):this},_update:function(){if(this._map){var _=[];for(var S in this._attributions)this._attributions[S]&&_.push(S);var z=[];this.options.prefix&&z.push(this.options.prefix),_.length&&z.push(_.join(", ")),this._container.innerHTML=z.join(' <span aria-hidden="true">|</span> ')}}});zi.mergeOptions({attributionControl:!0}),zi.addInitHook(function(){this.options.attributionControl&&new hc().addTo(this)});var Us=function(_){return new hc(_)};Sr.Layers=so,Sr.Zoom=el,Sr.Scale=Vs,Sr.Attribution=hc,cs.layers=uc,cs.zoom=dr,cs.scale=js,cs.attribution=Us;var Ro=ln.extend({initialize:function(_){this._map=_},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ro.addTo=function(_,S){return _.addHandler(S,this),this};var Qc={Events:je},Rl=Te.touch?"touchstart mousedown":"mousedown",kl=At.extend({options:{clickTolerance:3},initialize:function(_,S,z,Y){ae(this,Y),this._element=_,this._dragStartTarget=S||_,this._preventOutline=z},enable:function(){this._enabled||(_i(this._dragStartTarget,Rl,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(kl._dragging===this&&this.finishDrag(!0),wr(this._dragStartTarget,Rl,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(_){if(this._enabled&&(this._moved=!1,!Xc(this._element,"leaflet-zoom-anim"))){if(_.touches&&_.touches.length!==1){kl._dragging===this&&this.finishDrag();return}if(!(kl._dragging||_.shiftKey||_.which!==1&&_.button!==1&&!_.touches)&&(kl._dragging=this,this._preventOutline&&oi(this._element),Ol(),zs(),!this._moving)){this.fire("down");var S=_.touches?_.touches[0]:_,z=gn(this._element);this._startPoint=new Ke(S.clientX,S.clientY),this._startPos=sa(this._element),this._parentScale=Uu(z);var Y=_.type==="mousedown";_i(document,Y?"mousemove":"touchmove",this._onMove,this),_i(document,Y?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(_){if(this._enabled){if(_.touches&&_.touches.length>1){this._moved=!0;return}var S=_.touches&&_.touches.length===1?_.touches[0]:_,z=new Ke(S.clientX,S.clientY)._subtract(this._startPoint);!z.x&&!z.y||Math.abs(z.x)+Math.abs(z.y)<this.options.clickTolerance||(z.x/=this._parentScale.x,z.y/=this._parentScale.y,vo(_),this._moved||(this.fire("dragstart"),this._moved=!0,xi(document.body,"leaflet-dragging"),this._lastTarget=_.target||_.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),xi(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(z),this._moving=!0,this._lastEvent=_,this._updatePosition())}},_updatePosition:function(){var _={originalEvent:this._lastEvent};this.fire("predrag",_),Zr(this._element,this._newPos),this.fire("drag",_)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(_){jr(document.body,"leaflet-dragging"),this._lastTarget&&(jr(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),wr(document,"mousemove touchmove",this._onMove,this),wr(document,"mouseup touchend touchcancel",this._onUp,this),ls(),Bs();var S=this._moved&&this._moving;this._moving=!1,kl._dragging=!1,S&&this.fire("dragend",{noInertia:_,distance:this._newPos.distanceTo(this._startPos)})}});function Ra(_,S,z){var Y,ne=[1,4,2,8],ye,Ge,ht,bt,Zt,vn,ei,Pi;for(ye=0,vn=_.length;ye<vn;ye++)_[ye]._code=Fo(_[ye],S);for(ht=0;ht<4;ht++){for(ei=ne[ht],Y=[],ye=0,vn=_.length,Ge=vn-1;ye<vn;Ge=ye++)bt=_[ye],Zt=_[Ge],bt._code&ei?Zt._code&ei||(Pi=Zu(Zt,bt,ei,S,z),Pi._code=Fo(Pi,S),Y.push(Pi)):(Zt._code&ei&&(Pi=Zu(Zt,bt,ei,S,z),Pi._code=Fo(Pi,S),Y.push(Pi)),Y.push(bt));_=Y}return _}function pf(_,S){var z,Y,ne,ye,Ge,ht,bt,Zt,vn;if(!_||_.length===0)throw new Error("latlngs not passed");ao(_)||(console.warn("latlngs are not flat! Only the first ring will be used"),_=_[0]);var ei=_n([0,0]),Pi=Dn(_),Go=Pi.getNorthWest().distanceTo(Pi.getSouthWest())*Pi.getNorthEast().distanceTo(Pi.getNorthWest());Go<1700&&(ei=eu(_));var Mo=_.length,zo=[];for(z=0;z<Mo;z++){var ps=_n(_[z]);zo.push(S.project(_n([ps.lat-ei.lat,ps.lng-ei.lng])))}for(ht=bt=Zt=0,z=0,Y=Mo-1;z<Mo;Y=z++)ne=zo[z],ye=zo[Y],Ge=ne.y*ye.x-ye.y*ne.x,bt+=(ne.x+ye.x)*Ge,Zt+=(ne.y+ye.y)*Ge,ht+=Ge*3;ht===0?vn=zo[0]:vn=[bt/ht,Zt/ht];var su=S.unproject(It(vn));return _n([su.lat+ei.lat,su.lng+ei.lng])}function eu(_){for(var S=0,z=0,Y=0,ne=0;ne<_.length;ne++){var ye=_n(_[ne]);S+=ye.lat,z+=ye.lng,Y++}return _n([S/Y,z/Y])}var us={__proto__:null,clipPolygon:Ra,polygonCenter:pf,centroid:eu};function $u(_,S){if(!S||!_.length)return _.slice();var z=S*S;return _=c_(_,z),_=qu(_,z),_}function Gu(_,S,z){return Math.sqrt(Ll(_,S,z,!0))}function $p(_,S,z){return Ll(_,S,z)}function qu(_,S){var z=_.length,Y=typeof Uint8Array<"u"?Uint8Array:Array,ne=new Y(z);ne[0]=ne[z-1]=1,mf(_,ne,S,0,z-1);var ye,Ge=[];for(ye=0;ye<z;ye++)ne[ye]&&Ge.push(_[ye]);return Ge}function mf(_,S,z,Y,ne){var ye=0,Ge,ht,bt;for(ht=Y+1;ht<=ne-1;ht++)bt=Ll(_[ht],_[Y],_[ne],!0),bt>ye&&(Ge=ht,ye=bt);ye>z&&(S[Ge]=1,mf(_,S,z,Y,Ge),mf(_,S,z,Ge,ne))}function c_(_,S){for(var z=[_[0]],Y=1,ne=0,ye=_.length;Y<ye;Y++)Gp(_[Y],_[ne])>S&&(z.push(_[Y]),ne=Y);return ne<ye-1&&z.push(_[ye-1]),z}var tu;function nu(_,S,z,Y,ne){var ye=Y?tu:Fo(_,z),Ge=Fo(S,z),ht,bt,Zt;for(tu=Ge;;){if(!(ye|Ge))return[_,S];if(ye&Ge)return!1;ht=ye||Ge,bt=Zu(_,S,ht,z,ne),Zt=Fo(bt,z),ht===ye?(_=bt,ye=Zt):(S=bt,Ge=Zt)}}function Zu(_,S,z,Y,ne){var ye=S.x-_.x,Ge=S.y-_.y,ht=Y.min,bt=Y.max,Zt,vn;return z&8?(Zt=_.x+ye*(bt.y-_.y)/Ge,vn=bt.y):z&4?(Zt=_.x+ye*(ht.y-_.y)/Ge,vn=ht.y):z&2?(Zt=bt.x,vn=_.y+Ge*(bt.x-_.x)/ye):z&1&&(Zt=ht.x,vn=_.y+Ge*(ht.x-_.x)/ye),new Ke(Zt,vn,ne)}function Fo(_,S){var z=0;return _.x<S.min.x?z|=1:_.x>S.max.x&&(z|=2),_.y<S.min.y?z|=4:_.y>S.max.y&&(z|=8),z}function Gp(_,S){var z=S.x-_.x,Y=S.y-_.y;return z*z+Y*Y}function Ll(_,S,z,Y){var ne=S.x,ye=S.y,Ge=z.x-ne,ht=z.y-ye,bt=Ge*Ge+ht*ht,Zt;return bt>0&&(Zt=((_.x-ne)*Ge+(_.y-ye)*ht)/bt,Zt>1?(ne=z.x,ye=z.y):Zt>0&&(ne+=Ge*Zt,ye+=ht*Zt)),Ge=_.x-ne,ht=_.y-ye,Y?Ge*Ge+ht*ht:new Ke(ne,ye)}function ao(_){return!Xe(_[0])||typeof _[0][0]!="object"&&typeof _[0][0]<"u"}function qp(_){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ao(_)}function Zp(_,S){var z,Y,ne,ye,Ge,ht,bt,Zt;if(!_||_.length===0)throw new Error("latlngs not passed");ao(_)||(console.warn("latlngs are not flat! Only the first ring will be used"),_=_[0]);var vn=_n([0,0]),ei=Dn(_),Pi=ei.getNorthWest().distanceTo(ei.getSouthWest())*ei.getNorthEast().distanceTo(ei.getNorthWest());Pi<1700&&(vn=eu(_));var Go=_.length,Mo=[];for(z=0;z<Go;z++){var zo=_n(_[z]);Mo.push(S.project(_n([zo.lat-vn.lat,zo.lng-vn.lng])))}for(z=0,Y=0;z<Go-1;z++)Y+=Mo[z].distanceTo(Mo[z+1])/2;if(Y===0)Zt=Mo[0];else for(z=0,ye=0;z<Go-1;z++)if(Ge=Mo[z],ht=Mo[z+1],ne=Ge.distanceTo(ht),ye+=ne,ye>Y){bt=(ye-Y)/ne,Zt=[ht.x-bt*(ht.x-Ge.x),ht.y-bt*(ht.y-Ge.y)];break}var ps=S.unproject(It(Zt));return _n([ps.lat+vn.lat,ps.lng+vn.lng])}var u_={__proto__:null,simplify:$u,pointToSegmentDistance:Gu,closestPointOnSegment:$p,clipSegment:nu,_getEdgeIntersection:Zu,_getBitCode:Fo,_sqClosestPointOnSegment:Ll,isFlat:ao,_flat:qp,polylineCenter:Zp},Hh={project:function(_){return new Ke(_.lng,_.lat)},unproject:function(_){return new An(_.y,_.x)},bounds:new en([-180,-90],[180,90])},Fl={R:6378137,R_MINOR:6356752314245179e-9,bounds:new en([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(_){var S=Math.PI/180,z=this.R,Y=_.lat*S,ne=this.R_MINOR/z,ye=Math.sqrt(1-ne*ne),Ge=ye*Math.sin(Y),ht=Math.tan(Math.PI/4-Y/2)/Math.pow((1-Ge)/(1+Ge),ye/2);return Y=-z*Math.log(Math.max(ht,1e-10)),new Ke(_.lng*S*z,Y)},unproject:function(_){for(var S=180/Math.PI,z=this.R,Y=this.R_MINOR/z,ne=Math.sqrt(1-Y*Y),ye=Math.exp(-_.y/z),Ge=Math.PI/2-2*Math.atan(ye),ht=0,bt=.1,Zt;ht<15&&Math.abs(bt)>1e-7;ht++)Zt=ne*Math.sin(Ge),Zt=Math.pow((1-Zt)/(1+Zt),ne/2),bt=Math.PI/2-2*Math.atan(ye*Zt)-Ge,Ge+=bt;return new An(Ge*S,_.x*S/z)}},$n={__proto__:null,LonLat:Hh,Mercator:Fl,SphericalMercator:Ee},an=n({},mr,{code:"EPSG:3395",projection:Fl,transformation:function(){var _=.5/(Math.PI*Fl.R);return Zn(_,.5,-_,.5)}()}),Wu=n({},mr,{code:"EPSG:4326",projection:Hh,transformation:Zn(1/180,1,-1/180,.5)}),Sn=n({},qi,{projection:Hh,transformation:Zn(1,0,-1,0),scale:function(_){return Math.pow(2,_)},zoom:function(_){return Math.log(_)/Math.LN2},distance:function(_,S){var z=S.lng-_.lng,Y=S.lat-_.lat;return Math.sqrt(z*z+Y*Y)},infinite:!0});qi.Earth=mr,qi.EPSG3395=an,qi.EPSG3857=gi,qi.EPSG900913=We,qi.EPSG4326=Wu,qi.Simple=Sn;var hs=At.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(_){return _.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(_){return _&&_.removeLayer(this),this},getPane:function(_){return this._map.getPane(_?this.options[_]||_:this.options.pane)},addInteractiveTarget:function(_){return this._map._targets[w(_)]=this,this},removeInteractiveTarget:function(_){return delete this._map._targets[w(_)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(_){var S=_.target;if(S.hasLayer(this)){if(this._map=S,this._zoomAnimated=S._zoomAnimated,this.getEvents){var z=this.getEvents();S.on(z,this),this.once("remove",function(){S.off(z,this)},this)}this.onAdd(S),this.fire("add"),S.fire("layeradd",{layer:this})}}});zi.include({addLayer:function(_){if(!_._layerAdd)throw new Error("The provided object is not a Layer.");var S=w(_);return this._layers[S]?this:(this._layers[S]=_,_._mapToAdd=this,_.beforeAdd&&_.beforeAdd(this),this.whenReady(_._layerAdd,_),this)},removeLayer:function(_){var S=w(_);return this._layers[S]?(this._loaded&&_.onRemove(this),delete this._layers[S],this._loaded&&(this.fire("layerremove",{layer:_}),_.fire("remove")),_._map=_._mapToAdd=null,this):this},hasLayer:function(_){return w(_)in this._layers},eachLayer:function(_,S){for(var z in this._layers)_.call(S,this._layers[z]);return this},_addLayers:function(_){_=_?Xe(_)?_:[_]:[];for(var S=0,z=_.length;S<z;S++)this.addLayer(_[S])},_addZoomLimit:function(_){(!isNaN(_.options.maxZoom)||!isNaN(_.options.minZoom))&&(this._zoomBoundLayers[w(_)]=_,this._updateZoomLevels())},_removeZoomLimit:function(_){var S=w(_);this._zoomBoundLayers[S]&&(delete this._zoomBoundLayers[S],this._updateZoomLevels())},_updateZoomLevels:function(){var _=1/0,S=-1/0,z=this._getZoomSpan();for(var Y in this._zoomBoundLayers){var ne=this._zoomBoundLayers[Y].options;_=ne.minZoom===void 0?_:Math.min(_,ne.minZoom),S=ne.maxZoom===void 0?S:Math.max(S,ne.maxZoom)}this._layersMaxZoom=S===-1/0?void 0:S,this._layersMinZoom=_===1/0?void 0:_,z!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ds=hs.extend({initialize:function(_,S){ae(this,S),this._layers={};var z,Y;if(_)for(z=0,Y=_.length;z<Y;z++)this.addLayer(_[z])},addLayer:function(_){var S=this.getLayerId(_);return this._layers[S]=_,this._map&&this._map.addLayer(_),this},removeLayer:function(_){var S=_ in this._layers?_:this.getLayerId(_);return this._map&&this._layers[S]&&this._map.removeLayer(this._layers[S]),delete this._layers[S],this},hasLayer:function(_){var S=typeof _=="number"?_:this.getLayerId(_);return S in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(_){var S=Array.prototype.slice.call(arguments,1),z,Y;for(z in this._layers)Y=this._layers[z],Y[_]&&Y[_].apply(Y,S);return this},onAdd:function(_){this.eachLayer(_.addLayer,_)},onRemove:function(_){this.eachLayer(_.removeLayer,_)},eachLayer:function(_,S){for(var z in this._layers)_.call(S,this._layers[z]);return this},getLayer:function(_){return this._layers[_]},getLayers:function(){var _=[];return this.eachLayer(_.push,_),_},setZIndex:function(_){return this.invoke("setZIndex",_)},getLayerId:function(_){return w(_)}}),yn=function(_,S){return new ds(_,S)},aa=ds.extend({addLayer:function(_){return this.hasLayer(_)?this:(_.addEventParent(this),ds.prototype.addLayer.call(this,_),this.fire("layeradd",{layer:_}))},removeLayer:function(_){return this.hasLayer(_)?(_ in this._layers&&(_=this._layers[_]),_.removeEventParent(this),ds.prototype.removeLayer.call(this,_),this.fire("layerremove",{layer:_})):this},setStyle:function(_){return this.invoke("setStyle",_)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var _=new Ft;for(var S in this._layers){var z=this._layers[S];_.extend(z.getBounds?z.getBounds():z.getLatLng())}return _}}),$h=function(_,S){return new aa(_,S)},la=ln.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(_){ae(this,_)},createIcon:function(_){return this._createIcon("icon",_)},createShadow:function(_){return this._createIcon("shadow",_)},_createIcon:function(_,S){var z=this._getIconUrl(_);if(!z){if(_==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var Y=this._createImg(z,S&&S.tagName==="IMG"?S:null);return this._setIconStyles(Y,_),(this.options.crossOrigin||this.options.crossOrigin==="")&&(Y.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),Y},_setIconStyles:function(_,S){var z=this.options,Y=z[S+"Size"];typeof Y=="number"&&(Y=[Y,Y]);var ne=It(Y),ye=It(S==="shadow"&&z.shadowAnchor||z.iconAnchor||ne&&ne.divideBy(2,!0));_.className="leaflet-marker-"+S+" "+(z.className||""),ye&&(_.style.marginLeft=-ye.x+"px",_.style.marginTop=-ye.y+"px"),ne&&(_.style.width=ne.x+"px",_.style.height=ne.y+"px")},_createImg:function(_,S){return S=S||document.createElement("img"),S.src=_,S},_getIconUrl:function(_){return Te.retina&&this.options[_+"RetinaUrl"]||this.options[_+"Url"]}});function iu(_){return new la(_)}var tl=la.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(_){return typeof tl.imagePath!="string"&&(tl.imagePath=this._detectIconPath()),(this.options.imagePath||tl.imagePath)+la.prototype._getIconUrl.call(this,_)},_stripUrl:function(_){var S=function(z,Y,ne){var ye=Y.exec(z);return ye&&ye[ne]};return _=S(_,/^url\((['"])?(.+)\1\)$/,2),_&&S(_,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var _=Ni("div","leaflet-default-icon-path",document.body),S=Pl(_,"background-image")||Pl(_,"backgroundImage");if(document.body.removeChild(_),S=this._stripUrl(S),S)return S;var z=document.querySelector('link[href$="leaflet.css"]');return z?z.href.substring(0,z.href.length-11-1):""}}),Co=Ro.extend({initialize:function(_){this._marker=_},addHooks:function(){var _=this._marker._icon;this._draggable||(this._draggable=new kl(_,_,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),xi(_,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&jr(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(_){var S=this._marker,z=S._map,Y=this._marker.options.autoPanSpeed,ne=this._marker.options.autoPanPadding,ye=sa(S._icon),Ge=z.getPixelBounds(),ht=z.getPixelOrigin(),bt=dn(Ge.min._subtract(ht).add(ne),Ge.max._subtract(ht).subtract(ne));if(!bt.contains(ye)){var Zt=It((Math.max(bt.max.x,ye.x)-bt.max.x)/(Ge.max.x-bt.max.x)-(Math.min(bt.min.x,ye.x)-bt.min.x)/(Ge.min.x-bt.min.x),(Math.max(bt.max.y,ye.y)-bt.max.y)/(Ge.max.y-bt.max.y)-(Math.min(bt.min.y,ye.y)-bt.min.y)/(Ge.min.y-bt.min.y)).multiplyBy(Y);z.panBy(Zt,{animate:!1}),this._draggable._newPos._add(Zt),this._draggable._startPos._add(Zt),Zr(S._icon,this._draggable._newPos),this._onDrag(_),this._panRequest=Tt(this._adjustPan.bind(this,_))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(_){this._marker.options.autoPan&&(ri(this._panRequest),this._panRequest=Tt(this._adjustPan.bind(this,_)))},_onDrag:function(_){var S=this._marker,z=S._shadow,Y=sa(S._icon),ne=S._map.layerPointToLatLng(Y);z&&Zr(z,Y),S._latlng=ne,_.latlng=ne,_.oldLatLng=this._oldLatLng,S.fire("move",_).fire("drag",_)},_onDragEnd:function(_){ri(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",_)}}),No=hs.extend({options:{icon:new tl,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(_,S){ae(this,S),this._latlng=_n(_)},onAdd:function(_){this._zoomAnimated=this._zoomAnimated&&_.options.markerZoomAnimation,this._zoomAnimated&&_.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(_){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&_.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(_){var S=this._latlng;return this._latlng=_n(_),this.update(),this.fire("move",{oldLatLng:S,latlng:this._latlng})},setZIndexOffset:function(_){return this.options.zIndexOffset=_,this.update()},getIcon:function(){return this.options.icon},setIcon:function(_){return this.options.icon=_,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var _=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(_)}return this},_initIcon:function(){var _=this.options,S="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),z=_.icon.createIcon(this._icon),Y=!1;z!==this._icon&&(this._icon&&this._removeIcon(),Y=!0,_.title&&(z.title=_.title),z.tagName==="IMG"&&(z.alt=_.alt||"")),xi(z,S),_.keyboard&&(z.tabIndex="0",z.setAttribute("role","button")),this._icon=z,_.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&_i(z,"focus",this._panOnFocus,this);var ne=_.icon.createShadow(this._shadow),ye=!1;ne!==this._shadow&&(this._removeShadow(),ye=!0),ne&&(xi(ne,S),ne.alt=""),this._shadow=ne,_.opacity<1&&this._updateOpacity(),Y&&this.getPane().appendChild(this._icon),this._initInteraction(),ne&&ye&&this.getPane(_.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&wr(this._icon,"focus",this._panOnFocus,this),hr(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&hr(this._shadow),this._shadow=null},_setPos:function(_){this._icon&&Zr(this._icon,_),this._shadow&&Zr(this._shadow,_),this._zIndex=_.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(_){this._icon&&(this._icon.style.zIndex=this._zIndex+_)},_animateZoom:function(_){var S=this._map._latLngToNewLayerPoint(this._latlng,_.zoom,_.center).round();this._setPos(S)},_initInteraction:function(){if(this.options.interactive&&(xi(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Co)){var _=this.options.draggable;this.dragging&&(_=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Co(this),_&&this.dragging.enable()}},setOpacity:function(_){return this.options.opacity=_,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var _=this.options.opacity;this._icon&&Qr(this._icon,_),this._shadow&&Qr(this._shadow,_)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var _=this._map;if(_){var S=this.options.icon.options,z=S.iconSize?It(S.iconSize):It(0,0),Y=S.iconAnchor?It(S.iconAnchor):It(0,0);_.panInside(this._latlng,{paddingTopLeft:Y,paddingBottomRight:z.subtract(Y)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Gh(_,S){return new No(_,S)}var Ot=hs.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(_){this._renderer=_.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(_){return ae(this,_),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&_&&Object.prototype.hasOwnProperty.call(_,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),dc=Ot.extend({options:{fill:!0,radius:10},initialize:function(_,S){ae(this,S),this._latlng=_n(_),this._radius=this.options.radius},setLatLng:function(_){var S=this._latlng;return this._latlng=_n(_),this.redraw(),this.fire("move",{oldLatLng:S,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(_){return this.options.radius=this._radius=_,this.redraw()},getRadius:function(){return this._radius},setStyle:function(_){var S=_&&_.radius||this._radius;return Ot.prototype.setStyle.call(this,_),this.setRadius(S),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var _=this._radius,S=this._radiusY||_,z=this._clickTolerance(),Y=[_+z,S+z];this._pxBounds=new en(this._point.subtract(Y),this._point.add(Y))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(_){return _.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function nl(_,S){return new dc(_,S)}var xo=dc.extend({initialize:function(_,S,z){if(typeof S=="number"&&(S=n({},z,{radius:S})),ae(this,S),this._latlng=_n(_),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(_){return this._mRadius=_,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var _=[this._radius,this._radiusY||this._radius];return new Ft(this._map.layerPointToLatLng(this._point.subtract(_)),this._map.layerPointToLatLng(this._point.add(_)))},setStyle:Ot.prototype.setStyle,_project:function(){var _=this._latlng.lng,S=this._latlng.lat,z=this._map,Y=z.options.crs;if(Y.distance===mr.distance){var ne=Math.PI/180,ye=this._mRadius/mr.R/ne,Ge=z.project([S+ye,_]),ht=z.project([S-ye,_]),bt=Ge.add(ht).divideBy(2),Zt=z.unproject(bt).lat,vn=Math.acos((Math.cos(ye*ne)-Math.sin(S*ne)*Math.sin(Zt*ne))/(Math.cos(S*ne)*Math.cos(Zt*ne)))/ne;(isNaN(vn)||vn===0)&&(vn=ye/Math.cos(Math.PI/180*S)),this._point=bt.subtract(z.getPixelOrigin()),this._radius=isNaN(vn)?0:bt.x-z.project([Zt,_-vn]).x,this._radiusY=bt.y-Ge.y}else{var ei=Y.unproject(Y.project(this._latlng).subtract([this._mRadius,0]));this._point=z.latLngToLayerPoint(this._latlng),this._radius=this._point.x-z.latLngToLayerPoint(ei).x}this._updateBounds()}});function Wp(_,S,z){return new xo(_,S,z)}var Hs=Ot.extend({options:{smoothFactor:1,noClip:!1},initialize:function(_,S){ae(this,S),this._setLatLngs(_)},getLatLngs:function(){return this._latlngs},setLatLngs:function(_){return this._setLatLngs(_),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(_){for(var S=1/0,z=null,Y=Ll,ne,ye,Ge=0,ht=this._parts.length;Ge<ht;Ge++)for(var bt=this._parts[Ge],Zt=1,vn=bt.length;Zt<vn;Zt++){ne=bt[Zt-1],ye=bt[Zt];var ei=Y(_,ne,ye,!0);ei<S&&(S=ei,z=Y(_,ne,ye))}return z&&(z.distance=Math.sqrt(S)),z},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Zp(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(_,S){return S=S||this._defaultShape(),_=_n(_),S.push(_),this._bounds.extend(_),this.redraw()},_setLatLngs:function(_){this._bounds=new Ft,this._latlngs=this._convertLatLngs(_)},_defaultShape:function(){return ao(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(_){for(var S=[],z=ao(_),Y=0,ne=_.length;Y<ne;Y++)z?(S[Y]=_n(_[Y]),this._bounds.extend(S[Y])):S[Y]=this._convertLatLngs(_[Y]);return S},_project:function(){var _=new en;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,_),this._bounds.isValid()&&_.isValid()&&(this._rawPxBounds=_,this._updateBounds())},_updateBounds:function(){var _=this._clickTolerance(),S=new Ke(_,_);this._rawPxBounds&&(this._pxBounds=new en([this._rawPxBounds.min.subtract(S),this._rawPxBounds.max.add(S)]))},_projectLatlngs:function(_,S,z){var Y=_[0]instanceof An,ne=_.length,ye,Ge;if(Y){for(Ge=[],ye=0;ye<ne;ye++)Ge[ye]=this._map.latLngToLayerPoint(_[ye]),z.extend(Ge[ye]);S.push(Ge)}else for(ye=0;ye<ne;ye++)this._projectLatlngs(_[ye],S,z)},_clipPoints:function(){var _=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(_))){if(this.options.noClip){this._parts=this._rings;return}var S=this._parts,z,Y,ne,ye,Ge,ht,bt;for(z=0,ne=0,ye=this._rings.length;z<ye;z++)for(bt=this._rings[z],Y=0,Ge=bt.length;Y<Ge-1;Y++)ht=nu(bt[Y],bt[Y+1],_,Y,!0),ht&&(S[ne]=S[ne]||[],S[ne].push(ht[0]),(ht[1]!==bt[Y+1]||Y===Ge-2)&&(S[ne].push(ht[1]),ne++))}},_simplifyPoints:function(){for(var _=this._parts,S=this.options.smoothFactor,z=0,Y=_.length;z<Y;z++)_[z]=$u(_[z],S)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(_,S){var z,Y,ne,ye,Ge,ht,bt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(_))return!1;for(z=0,ye=this._parts.length;z<ye;z++)for(ht=this._parts[z],Y=0,Ge=ht.length,ne=Ge-1;Y<Ge;ne=Y++)if(!(!S&&Y===0)&&Gu(_,ht[ne],ht[Y])<=bt)return!0;return!1}});function il(_,S){return new Hs(_,S)}Hs._flat=qp;var ca=Hs.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return pf(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(_){var S=Hs.prototype._convertLatLngs.call(this,_),z=S.length;return z>=2&&S[0]instanceof An&&S[0].equals(S[z-1])&&S.pop(),S},_setLatLngs:function(_){Hs.prototype._setLatLngs.call(this,_),ao(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ao(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var _=this._renderer._bounds,S=this.options.weight,z=new Ke(S,S);if(_=new en(_.min.subtract(z),_.max.add(z)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(_))){if(this.options.noClip){this._parts=this._rings;return}for(var Y=0,ne=this._rings.length,ye;Y<ne;Y++)ye=Ra(this._rings[Y],_,!0),ye.length&&this._parts.push(ye)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(_){var S=!1,z,Y,ne,ye,Ge,ht,bt,Zt;if(!this._pxBounds||!this._pxBounds.contains(_))return!1;for(ye=0,bt=this._parts.length;ye<bt;ye++)for(z=this._parts[ye],Ge=0,Zt=z.length,ht=Zt-1;Ge<Zt;ht=Ge++)Y=z[Ge],ne=z[ht],Y.y>_.y!=ne.y>_.y&&_.x<(ne.x-Y.x)*(_.y-Y.y)/(ne.y-Y.y)+Y.x&&(S=!S);return S||Hs.prototype._containsPoint.call(this,_,!0)}});function Nl(_,S){return new ca(_,S)}var fs=aa.extend({initialize:function(_,S){ae(this,S),this._layers={},_&&this.addData(_)},addData:function(_){var S=Xe(_)?_:_.features,z,Y,ne;if(S){for(z=0,Y=S.length;z<Y;z++)ne=S[z],(ne.geometries||ne.geometry||ne.features||ne.coordinates)&&this.addData(ne);return this}var ye=this.options;if(ye.filter&&!ye.filter(_))return this;var Ge=rl(_,ye);return Ge?(Ge.feature=$s(_),Ge.defaultOptions=Ge.options,this.resetStyle(Ge),ye.onEachFeature&&ye.onEachFeature(_,Ge),this.addLayer(Ge)):this},resetStyle:function(_){return _===void 0?this.eachLayer(this.resetStyle,this):(_.options=n({},_.defaultOptions),this._setLayerStyle(_,this.options.style),this)},setStyle:function(_){return this.eachLayer(function(S){this._setLayerStyle(S,_)},this)},_setLayerStyle:function(_,S){_.setStyle&&(typeof S=="function"&&(S=S(_.feature)),_.setStyle(S))}});function rl(_,S){var z=_.type==="Feature"?_.geometry:_,Y=z?z.coordinates:null,ne=[],ye=S&&S.pointToLayer,Ge=S&&S.coordsToLatLng||gf,ht,bt,Zt,vn;if(!Y&&!z)return null;switch(z.type){case"Point":return ht=Ge(Y),Yp(ye,_,ht,S);case"MultiPoint":for(Zt=0,vn=Y.length;Zt<vn;Zt++)ht=Ge(Y[Zt]),ne.push(Yp(ye,_,ht,S));return new aa(ne);case"LineString":case"MultiLineString":return bt=ru(Y,z.type==="LineString"?0:1,Ge),new Hs(bt,S);case"Polygon":case"MultiPolygon":return bt=ru(Y,z.type==="Polygon"?1:2,Ge),new ca(bt,S);case"GeometryCollection":for(Zt=0,vn=z.geometries.length;Zt<vn;Zt++){var ei=rl({geometry:z.geometries[Zt],type:"Feature",properties:_.properties},S);ei&&ne.push(ei)}return new aa(ne);case"FeatureCollection":for(Zt=0,vn=z.features.length;Zt<vn;Zt++){var Pi=rl(z.features[Zt],S);Pi&&ne.push(Pi)}return new aa(ne);default:throw new Error("Invalid GeoJSON object.")}}function Yp(_,S,z,Y){return _?_(S,z):new No(z,Y&&Y.markersInheritOptions&&Y)}function gf(_){return new An(_[1],_[0],_[2])}function ru(_,S,z){for(var Y=[],ne=0,ye=_.length,Ge;ne<ye;ne++)Ge=S?ru(_[ne],S-1,z):(z||gf)(_[ne]),Y.push(Ge);return Y}function qh(_,S){return _=_n(_),_.alt!==void 0?[K(_.lng,S),K(_.lat,S),K(_.alt,S)]:[K(_.lng,S),K(_.lat,S)]}function Yu(_,S,z,Y){for(var ne=[],ye=0,Ge=_.length;ye<Ge;ye++)ne.push(S?Yu(_[ye],ao(_[ye])?0:S-1,z,Y):qh(_[ye],Y));return!S&&z&&ne.length>0&&ne.push(ne[0].slice()),ne}function fc(_,S){return _.feature?n({},_.feature,{geometry:S}):$s(S)}function $s(_){return _.type==="Feature"||_.type==="FeatureCollection"?_:{type:"Feature",properties:{},geometry:_}}var _f={toGeoJSON:function(_){return fc(this,{type:"Point",coordinates:qh(this.getLatLng(),_)})}};No.include(_f),xo.include(_f),dc.include(_f),Hs.include({toGeoJSON:function(_){var S=!ao(this._latlngs),z=Yu(this._latlngs,S?1:0,!1,_);return fc(this,{type:(S?"Multi":"")+"LineString",coordinates:z})}}),ca.include({toGeoJSON:function(_){var S=!ao(this._latlngs),z=S&&!ao(this._latlngs[0]),Y=Yu(this._latlngs,z?2:S?1:0,!0,_);return S||(Y=[Y]),fc(this,{type:(z?"Multi":"")+"Polygon",coordinates:Y})}}),ds.include({toMultiPoint:function(_){var S=[];return this.eachLayer(function(z){S.push(z.toGeoJSON(_).geometry.coordinates)}),fc(this,{type:"MultiPoint",coordinates:S})},toGeoJSON:function(_){var S=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(S==="MultiPoint")return this.toMultiPoint(_);var z=S==="GeometryCollection",Y=[];return this.eachLayer(function(ne){if(ne.toGeoJSON){var ye=ne.toGeoJSON(_);if(z)Y.push(ye.geometry);else{var Ge=$s(ye);Ge.type==="FeatureCollection"?Y.push.apply(Y,Ge.features):Y.push(Ge)}}}),z?fc(this,{geometries:Y,type:"GeometryCollection"}):{type:"FeatureCollection",features:Y}}});function Xp(_,S){return new fs(_,S)}var yf=Xp,Xu=hs.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(_,S,z){this._url=_,this._bounds=Dn(S),ae(this,z)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(xi(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){hr(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(_){return this.options.opacity=_,this._image&&this._updateOpacity(),this},setStyle:function(_){return _.opacity&&this.setOpacity(_.opacity),this},bringToFront:function(){return this._map&&Dl(this._image),this},bringToBack:function(){return this._map&&rc(this._image),this},setUrl:function(_){return this._url=_,this._image&&(this._image.src=_),this},setBounds:function(_){return this._bounds=Dn(_),this._map&&this._reset(),this},getEvents:function(){var _={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(_.zoomanim=this._animateZoom),_},setZIndex:function(_){return this.options.zIndex=_,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var _=this._url.tagName==="IMG",S=this._image=_?this._url:Ni("img");if(xi(S,"leaflet-image-layer"),this._zoomAnimated&&xi(S,"leaflet-zoom-animated"),this.options.className&&xi(S,this.options.className),S.onselectstart=$,S.onmousemove=$,S.onload=h(this.fire,this,"load"),S.onerror=h(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(S.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),_){this._url=S.src;return}S.src=this._url,S.alt=this.options.alt},_animateZoom:function(_){var S=this._map.getZoomScale(_.zoom),z=this._map._latLngBoundsToNewLayerBounds(this._bounds,_.zoom,_.center).min;Ko(this._image,z,S)},_reset:function(){var _=this._image,S=new en(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),z=S.getSize();Zr(_,S.min),_.style.width=z.x+"px",_.style.height=z.y+"px"},_updateOpacity:function(){Qr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var _=this.options.errorOverlayUrl;_&&this._url!==_&&(this._url=_,this._image.src=_)},getCenter:function(){return this._bounds.getCenter()}}),vf=function(_,S,z){return new Xu(_,S,z)},Gs=Xu.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var _=this._url.tagName==="VIDEO",S=this._image=_?this._url:Ni("video");if(xi(S,"leaflet-image-layer"),this._zoomAnimated&&xi(S,"leaflet-zoom-animated"),this.options.className&&xi(S,this.options.className),S.onselectstart=$,S.onmousemove=$,S.onloadeddata=h(this.fire,this,"load"),_){for(var z=S.getElementsByTagName("source"),Y=[],ne=0;ne<z.length;ne++)Y.push(z[ne].src);this._url=z.length>0?Y:[S.src];return}Xe(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(S.style,"objectFit")&&(S.style.objectFit="fill"),S.autoplay=!!this.options.autoplay,S.loop=!!this.options.loop,S.muted=!!this.options.muted,S.playsInline=!!this.options.playsInline;for(var ye=0;ye<this._url.length;ye++){var Ge=Ni("source");Ge.src=this._url[ye],S.appendChild(Ge)}}});function Ku(_,S,z){return new Gs(_,S,z)}var xf=Xu.extend({_initImage:function(){var _=this._image=this._url;xi(_,"leaflet-image-layer"),this._zoomAnimated&&xi(_,"leaflet-zoom-animated"),this.options.className&&xi(_,this.options.className),_.onselectstart=$,_.onmousemove=$}});function bf(_,S,z){return new xf(_,S,z)}var Ts=hs.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(_,S){_&&(_ instanceof An||Xe(_))?(this._latlng=_n(_),ae(this,S)):(ae(this,_),this._source=S),this.options.content&&(this._content=this.options.content)},openOn:function(_){return _=arguments.length?_:this._source._map,_.hasLayer(this)||_.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(_){return this._map?this.close():(arguments.length?this._source=_:_=this._source,this._prepareOpen(),this.openOn(_._map)),this},onAdd:function(_){this._zoomAnimated=_._zoomAnimated,this._container||this._initLayout(),_._fadeAnimated&&Qr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),_._fadeAnimated&&Qr(this._container,1),this.bringToFront(),this.options.interactive&&(xi(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(_){_._fadeAnimated?(Qr(this._container,0),this._removeTimeout=setTimeout(h(hr,void 0,this._container),200)):hr(this._container),this.options.interactive&&(jr(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(_){return this._latlng=_n(_),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(_){return this._content=_,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var _={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(_.zoomanim=this._animateZoom),_},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Dl(this._container),this},bringToBack:function(){return this._map&&rc(this._container),this},_prepareOpen:function(_){var S=this._source;if(!S._map)return!1;if(S instanceof aa){S=null;var z=this._source._layers;for(var Y in z)if(z[Y]._map){S=z[Y];break}if(!S)return!1;this._source=S}if(!_)if(S.getCenter)_=S.getCenter();else if(S.getLatLng)_=S.getLatLng();else if(S.getBounds)_=S.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(_),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var _=this._contentNode,S=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof S=="string")_.innerHTML=S;else{for(;_.hasChildNodes();)_.removeChild(_.firstChild);_.appendChild(S)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var _=this._map.latLngToLayerPoint(this._latlng),S=It(this.options.offset),z=this._getAnchor();this._zoomAnimated?Zr(this._container,_.add(z)):S=S.add(_).add(z);var Y=this._containerBottom=-S.y,ne=this._containerLeft=-Math.round(this._containerWidth/2)+S.x;this._container.style.bottom=Y+"px",this._container.style.left=ne+"px"}},_getAnchor:function(){return[0,0]}});zi.include({_initOverlay:function(_,S,z,Y){var ne=S;return ne instanceof _||(ne=new _(Y).setContent(S)),z&&ne.setLatLng(z),ne}}),hs.include({_initOverlay:function(_,S,z,Y){var ne=z;return ne instanceof _?(ae(ne,Y),ne._source=this):(ne=S&&!Y?S:new _(Y,this),ne.setContent(z)),ne}});var zl=Ts.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(_){return _=arguments.length?_:this._source._map,!_.hasLayer(this)&&_._popup&&_._popup.options.autoClose&&_.removeLayer(_._popup),_._popup=this,Ts.prototype.openOn.call(this,_)},onAdd:function(_){Ts.prototype.onAdd.call(this,_),_.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ot||this._source.on("preclick",yo))},onRemove:function(_){Ts.prototype.onRemove.call(this,_),_.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ot||this._source.off("preclick",yo))},getEvents:function(){var _=Ts.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(_.preclick=this.close),this.options.keepInView&&(_.moveend=this._adjustPan),_},_initLayout:function(){var _="leaflet-popup",S=this._container=Ni("div",_+" "+(this.options.className||"")+" leaflet-zoom-animated"),z=this._wrapper=Ni("div",_+"-content-wrapper",S);if(this._contentNode=Ni("div",_+"-content",z),Kn(S),Qa(this._contentNode),_i(S,"contextmenu",yo),this._tipContainer=Ni("div",_+"-tip-container",S),this._tip=Ni("div",_+"-tip",this._tipContainer),this.options.closeButton){var Y=this._closeButton=Ni("a",_+"-close-button",S);Y.setAttribute("role","button"),Y.setAttribute("aria-label","Close popup"),Y.href="#close",Y.innerHTML='<span aria-hidden="true">&#215;</span>',_i(Y,"click",function(ne){vo(ne),this.close()},this)}},_updateLayout:function(){var _=this._contentNode,S=_.style;S.width="",S.whiteSpace="nowrap";var z=_.offsetWidth;z=Math.min(z,this.options.maxWidth),z=Math.max(z,this.options.minWidth),S.width=z+1+"px",S.whiteSpace="",S.height="";var Y=_.offsetHeight,ne=this.options.maxHeight,ye="leaflet-popup-scrolled";ne&&Y>ne?(S.height=ne+"px",xi(_,ye)):jr(_,ye),this._containerWidth=this._container.offsetWidth},_animateZoom:function(_){var S=this._map._latLngToNewLayerPoint(this._latlng,_.zoom,_.center),z=this._getAnchor();Zr(this._container,S.add(z))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var _=this._map,S=parseInt(Pl(this._container,"marginBottom"),10)||0,z=this._container.offsetHeight+S,Y=this._containerWidth,ne=new Ke(this._containerLeft,-z-this._containerBottom);ne._add(sa(this._container));var ye=_.layerPointToContainerPoint(ne),Ge=It(this.options.autoPanPadding),ht=It(this.options.autoPanPaddingTopLeft||Ge),bt=It(this.options.autoPanPaddingBottomRight||Ge),Zt=_.getSize(),vn=0,ei=0;ye.x+Y+bt.x>Zt.x&&(vn=ye.x+Y-Zt.x+bt.x),ye.x-vn-ht.x<0&&(vn=ye.x-ht.x),ye.y+z+bt.y>Zt.y&&(ei=ye.y+z-Zt.y+bt.y),ye.y-ei-ht.y<0&&(ei=ye.y-ht.y),(vn||ei)&&(this.options.keepInView&&(this._autopanning=!0),_.fire("autopanstart").panBy([vn,ei]))}},_getAnchor:function(){return It(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Zh=function(_,S){return new zl(_,S)};zi.mergeOptions({closePopupOnClick:!0}),zi.include({openPopup:function(_,S,z){return this._initOverlay(zl,_,S,z).openOn(this),this},closePopup:function(_){return _=arguments.length?_:this._popup,_&&_.close(),this}}),hs.include({bindPopup:function(_,S){return this._popup=this._initOverlay(zl,this._popup,_,S),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(_){return this._popup&&(this instanceof aa||(this._popup._source=this),this._popup._prepareOpen(_||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(_){return this._popup&&this._popup.setContent(_),this},getPopup:function(){return this._popup},_openPopup:function(_){if(!(!this._popup||!this._map)){Jo(_);var S=_.layer||_.target;if(this._popup._source===S&&!(S instanceof Ot)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(_.latlng);return}this._popup._source=S,this.openPopup(_.latlng)}},_movePopup:function(_){this._popup.setLatLng(_.latlng)},_onKeyPress:function(_){_.originalEvent.keyCode===13&&this._openPopup(_)}});var ua=Ts.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(_){Ts.prototype.onAdd.call(this,_),this.setOpacity(this.options.opacity),_.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(_){Ts.prototype.onRemove.call(this,_),_.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var _=Ts.prototype.getEvents.call(this);return this.options.permanent||(_.preclick=this.close),_},_initLayout:function(){var _="leaflet-tooltip",S=_+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ni("div",S),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+w(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(_){var S,z,Y=this._map,ne=this._container,ye=Y.latLngToContainerPoint(Y.getCenter()),Ge=Y.layerPointToContainerPoint(_),ht=this.options.direction,bt=ne.offsetWidth,Zt=ne.offsetHeight,vn=It(this.options.offset),ei=this._getAnchor();ht==="top"?(S=bt/2,z=Zt):ht==="bottom"?(S=bt/2,z=0):ht==="center"?(S=bt/2,z=Zt/2):ht==="right"?(S=0,z=Zt/2):ht==="left"?(S=bt,z=Zt/2):Ge.x<ye.x?(ht="right",S=0,z=Zt/2):(ht="left",S=bt+(vn.x+ei.x)*2,z=Zt/2),_=_.subtract(It(S,z,!0)).add(vn).add(ei),jr(ne,"leaflet-tooltip-right"),jr(ne,"leaflet-tooltip-left"),jr(ne,"leaflet-tooltip-top"),jr(ne,"leaflet-tooltip-bottom"),xi(ne,"leaflet-tooltip-"+ht),Zr(ne,_)},_updatePosition:function(){var _=this._map.latLngToLayerPoint(this._latlng);this._setPosition(_)},setOpacity:function(_){this.options.opacity=_,this._container&&Qr(this._container,_)},_animateZoom:function(_){var S=this._map._latLngToNewLayerPoint(this._latlng,_.zoom,_.center);this._setPosition(S)},_getAnchor:function(){return It(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Wh=function(_,S){return new ua(_,S)};zi.include({openTooltip:function(_,S,z){return this._initOverlay(ua,_,S,z).openOn(this),this},closeTooltip:function(_){return _.close(),this}}),hs.include({bindTooltip:function(_,S){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(ua,this._tooltip,_,S),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(_){if(!(!_&&this._tooltipHandlersAdded)){var S=_?"off":"on",z={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?z.add=this._openTooltip:(z.mouseover=this._openTooltip,z.mouseout=this.closeTooltip,z.click=this._openTooltip,this._map?this._addFocusListeners():z.add=this._addFocusListeners),this._tooltip.options.sticky&&(z.mousemove=this._moveTooltip),this[S](z),this._tooltipHandlersAdded=!_}},openTooltip:function(_){return this._tooltip&&(this instanceof aa||(this._tooltip._source=this),this._tooltip._prepareOpen(_)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(_){return this._tooltip&&this._tooltip.setContent(_),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(_){var S=typeof _.getElement=="function"&&_.getElement();S&&(_i(S,"focus",function(){this._tooltip._source=_,this.openTooltip()},this),_i(S,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(_){var S=typeof _.getElement=="function"&&_.getElement();S&&S.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(_){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var S=this;this._map.once("moveend",function(){S._openOnceFlag=!1,S._openTooltip(_)});return}this._tooltip._source=_.layer||_.target,this.openTooltip(this._tooltip.options.sticky?_.latlng:void 0)}},_moveTooltip:function(_){var S=_.latlng,z,Y;this._tooltip.options.sticky&&_.originalEvent&&(z=this._map.mouseEventToContainerPoint(_.originalEvent),Y=this._map.containerPointToLayerPoint(z),S=this._map.layerPointToLatLng(Y)),this._tooltip.setLatLng(S)}});var Yh=la.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(_){var S=_&&_.tagName==="DIV"?_:document.createElement("div"),z=this.options;if(z.html instanceof Element?(Aa(S),S.appendChild(z.html)):S.innerHTML=z.html!==!1?z.html:"",z.bgPos){var Y=It(z.bgPos);S.style.backgroundPosition=-Y.x+"px "+-Y.y+"px"}return this._setIconStyles(S,"icon"),S},createShadow:function(){return null}});function pc(_){return new Yh(_)}la.Default=tl;var ka=hs.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Te.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(_){ae(this,_)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(_){_._addZoomLimit(this)},onRemove:function(_){this._removeAllTiles(),hr(this._container),_._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Dl(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(rc(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(_){return this.options.opacity=_,this._updateOpacity(),this},setZIndex:function(_){return this.options.zIndex=_,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var _=this._clampZoom(this._map.getZoom());_!==this._tileZoom&&(this._tileZoom=_,this._updateLevels()),this._update()}return this},getEvents:function(){var _={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=A(this._onMoveEnd,this.options.updateInterval,this)),_.move=this._onMove),this._zoomAnimated&&(_.zoomanim=this._animateZoom),_},createTile:function(){return document.createElement("div")},getTileSize:function(){var _=this.options.tileSize;return _ instanceof Ke?_:new Ke(_,_)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(_){for(var S=this.getPane().children,z=-_(-1/0,1/0),Y=0,ne=S.length,ye;Y<ne;Y++)ye=S[Y].style.zIndex,S[Y]!==this._container&&ye&&(z=_(z,+ye));isFinite(z)&&(this.options.zIndex=z+_(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Te.ielt9){Qr(this._container,this.options.opacity);var _=+new Date,S=!1,z=!1;for(var Y in this._tiles){var ne=this._tiles[Y];if(!(!ne.current||!ne.loaded)){var ye=Math.min(1,(_-ne.loaded)/200);Qr(ne.el,ye),ye<1?S=!0:(ne.active?z=!0:this._onOpaqueTile(ne),ne.active=!0)}}z&&!this._noPrune&&this._pruneTiles(),S&&(ri(this._fadeFrame),this._fadeFrame=Tt(this._updateOpacity,this))}},_onOpaqueTile:$,_initContainer:function(){this._container||(this._container=Ni("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var _=this._tileZoom,S=this.options.maxZoom;if(_!==void 0){for(var z in this._levels)z=Number(z),this._levels[z].el.children.length||z===_?(this._levels[z].el.style.zIndex=S-Math.abs(_-z),this._onUpdateLevel(z)):(hr(this._levels[z].el),this._removeTilesAtZoom(z),this._onRemoveLevel(z),delete this._levels[z]);var Y=this._levels[_],ne=this._map;return Y||(Y=this._levels[_]={},Y.el=Ni("div","leaflet-tile-container leaflet-zoom-animated",this._container),Y.el.style.zIndex=S,Y.origin=ne.project(ne.unproject(ne.getPixelOrigin()),_).round(),Y.zoom=_,this._setZoomTransform(Y,ne.getCenter(),ne.getZoom()),$(Y.el.offsetWidth),this._onCreateLevel(Y)),this._level=Y,Y}},_onUpdateLevel:$,_onRemoveLevel:$,_onCreateLevel:$,_pruneTiles:function(){if(this._map){var _,S,z=this._map.getZoom();if(z>this.options.maxZoom||z<this.options.minZoom){this._removeAllTiles();return}for(_ in this._tiles)S=this._tiles[_],S.retain=S.current;for(_ in this._tiles)if(S=this._tiles[_],S.current&&!S.active){var Y=S.coords;this._retainParent(Y.x,Y.y,Y.z,Y.z-5)||this._retainChildren(Y.x,Y.y,Y.z,Y.z+2)}for(_ in this._tiles)this._tiles[_].retain||this._removeTile(_)}},_removeTilesAtZoom:function(_){for(var S in this._tiles)this._tiles[S].coords.z===_&&this._removeTile(S)},_removeAllTiles:function(){for(var _ in this._tiles)this._removeTile(_)},_invalidateAll:function(){for(var _ in this._levels)hr(this._levels[_].el),this._onRemoveLevel(Number(_)),delete this._levels[_];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(_,S,z,Y){var ne=Math.floor(_/2),ye=Math.floor(S/2),Ge=z-1,ht=new Ke(+ne,+ye);ht.z=+Ge;var bt=this._tileCoordsToKey(ht),Zt=this._tiles[bt];return Zt&&Zt.active?(Zt.retain=!0,!0):(Zt&&Zt.loaded&&(Zt.retain=!0),Ge>Y?this._retainParent(ne,ye,Ge,Y):!1)},_retainChildren:function(_,S,z,Y){for(var ne=2*_;ne<2*_+2;ne++)for(var ye=2*S;ye<2*S+2;ye++){var Ge=new Ke(ne,ye);Ge.z=z+1;var ht=this._tileCoordsToKey(Ge),bt=this._tiles[ht];if(bt&&bt.active){bt.retain=!0;continue}else bt&&bt.loaded&&(bt.retain=!0);z+1<Y&&this._retainChildren(ne,ye,z+1,Y)}},_resetView:function(_){var S=_&&(_.pinch||_.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),S,S)},_animateZoom:function(_){this._setView(_.center,_.zoom,!0,_.noUpdate)},_clampZoom:function(_){var S=this.options;return S.minNativeZoom!==void 0&&_<S.minNativeZoom?S.minNativeZoom:S.maxNativeZoom!==void 0&&S.maxNativeZoom<_?S.maxNativeZoom:_},_setView:function(_,S,z,Y){var ne=Math.round(S);this.options.maxZoom!==void 0&&ne>this.options.maxZoom||this.options.minZoom!==void 0&&ne<this.options.minZoom?ne=void 0:ne=this._clampZoom(ne);var ye=this.options.updateWhenZooming&&ne!==this._tileZoom;(!Y||ye)&&(this._tileZoom=ne,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),ne!==void 0&&this._update(_),z||this._pruneTiles(),this._noPrune=!!z),this._setZoomTransforms(_,S)},_setZoomTransforms:function(_,S){for(var z in this._levels)this._setZoomTransform(this._levels[z],_,S)},_setZoomTransform:function(_,S,z){var Y=this._map.getZoomScale(z,_.zoom),ne=_.origin.multiplyBy(Y).subtract(this._map._getNewPixelOrigin(S,z)).round();Te.any3d?Ko(_.el,ne,Y):Zr(_.el,ne)},_resetGrid:function(){var _=this._map,S=_.options.crs,z=this._tileSize=this.getTileSize(),Y=this._tileZoom,ne=this._map.getPixelWorldBounds(this._tileZoom);ne&&(this._globalTileRange=this._pxBoundsToTileRange(ne)),this._wrapX=S.wrapLng&&!this.options.noWrap&&[Math.floor(_.project([0,S.wrapLng[0]],Y).x/z.x),Math.ceil(_.project([0,S.wrapLng[1]],Y).x/z.y)],this._wrapY=S.wrapLat&&!this.options.noWrap&&[Math.floor(_.project([S.wrapLat[0],0],Y).y/z.x),Math.ceil(_.project([S.wrapLat[1],0],Y).y/z.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(_){var S=this._map,z=S._animatingZoom?Math.max(S._animateToZoom,S.getZoom()):S.getZoom(),Y=S.getZoomScale(z,this._tileZoom),ne=S.project(_,this._tileZoom).floor(),ye=S.getSize().divideBy(Y*2);return new en(ne.subtract(ye),ne.add(ye))},_update:function(_){var S=this._map;if(S){var z=this._clampZoom(S.getZoom());if(_===void 0&&(_=S.getCenter()),this._tileZoom!==void 0){var Y=this._getTiledPixelBounds(_),ne=this._pxBoundsToTileRange(Y),ye=ne.getCenter(),Ge=[],ht=this.options.keepBuffer,bt=new en(ne.getBottomLeft().subtract([ht,-ht]),ne.getTopRight().add([ht,-ht]));if(!(isFinite(ne.min.x)&&isFinite(ne.min.y)&&isFinite(ne.max.x)&&isFinite(ne.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Zt in this._tiles){var vn=this._tiles[Zt].coords;(vn.z!==this._tileZoom||!bt.contains(new Ke(vn.x,vn.y)))&&(this._tiles[Zt].current=!1)}if(Math.abs(z-this._tileZoom)>1){this._setView(_,z);return}for(var ei=ne.min.y;ei<=ne.max.y;ei++)for(var Pi=ne.min.x;Pi<=ne.max.x;Pi++){var Go=new Ke(Pi,ei);if(Go.z=this._tileZoom,!!this._isValidTile(Go)){var Mo=this._tiles[this._tileCoordsToKey(Go)];Mo?Mo.current=!0:Ge.push(Go)}}if(Ge.sort(function(ps,su){return ps.distanceTo(ye)-su.distanceTo(ye)}),Ge.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var zo=document.createDocumentFragment();for(Pi=0;Pi<Ge.length;Pi++)this._addTile(Ge[Pi],zo);this._level.el.appendChild(zo)}}}},_isValidTile:function(_){var S=this._map.options.crs;if(!S.infinite){var z=this._globalTileRange;if(!S.wrapLng&&(_.x<z.min.x||_.x>z.max.x)||!S.wrapLat&&(_.y<z.min.y||_.y>z.max.y))return!1}if(!this.options.bounds)return!0;var Y=this._tileCoordsToBounds(_);return Dn(this.options.bounds).overlaps(Y)},_keyToBounds:function(_){return this._tileCoordsToBounds(this._keyToTileCoords(_))},_tileCoordsToNwSe:function(_){var S=this._map,z=this.getTileSize(),Y=_.scaleBy(z),ne=Y.add(z),ye=S.unproject(Y,_.z),Ge=S.unproject(ne,_.z);return[ye,Ge]},_tileCoordsToBounds:function(_){var S=this._tileCoordsToNwSe(_),z=new Ft(S[0],S[1]);return this.options.noWrap||(z=this._map.wrapLatLngBounds(z)),z},_tileCoordsToKey:function(_){return _.x+":"+_.y+":"+_.z},_keyToTileCoords:function(_){var S=_.split(":"),z=new Ke(+S[0],+S[1]);return z.z=+S[2],z},_removeTile:function(_){var S=this._tiles[_];S&&(hr(S.el),delete this._tiles[_],this.fire("tileunload",{tile:S.el,coords:this._keyToTileCoords(_)}))},_initTile:function(_){xi(_,"leaflet-tile");var S=this.getTileSize();_.style.width=S.x+"px",_.style.height=S.y+"px",_.onselectstart=$,_.onmousemove=$,Te.ielt9&&this.options.opacity<1&&Qr(_,this.options.opacity)},_addTile:function(_,S){var z=this._getTilePos(_),Y=this._tileCoordsToKey(_),ne=this.createTile(this._wrapCoords(_),h(this._tileReady,this,_));this._initTile(ne),this.createTile.length<2&&Tt(h(this._tileReady,this,_,null,ne)),Zr(ne,z),this._tiles[Y]={el:ne,coords:_,current:!0},S.appendChild(ne),this.fire("tileloadstart",{tile:ne,coords:_})},_tileReady:function(_,S,z){S&&this.fire("tileerror",{error:S,tile:z,coords:_});var Y=this._tileCoordsToKey(_);z=this._tiles[Y],z&&(z.loaded=+new Date,this._map._fadeAnimated?(Qr(z.el,0),ri(this._fadeFrame),this._fadeFrame=Tt(this._updateOpacity,this)):(z.active=!0,this._pruneTiles()),S||(xi(z.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:z.el,coords:_})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Te.ielt9||!this._map._fadeAnimated?Tt(this._pruneTiles,this):setTimeout(h(this._pruneTiles,this),250)))},_getTilePos:function(_){return _.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(_){var S=new Ke(this._wrapX?F(_.x,this._wrapX):_.x,this._wrapY?F(_.y,this._wrapY):_.y);return S.z=_.z,S},_pxBoundsToTileRange:function(_){var S=this.getTileSize();return new en(_.min.unscaleBy(S).floor(),_.max.unscaleBy(S).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var _ in this._tiles)if(!this._tiles[_].loaded)return!1;return!0}});function mc(_){return new ka(_)}var qs=ka.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(_,S){this._url=_,S=ae(this,S),S.detectRetina&&Te.retina&&S.maxZoom>0?(S.tileSize=Math.floor(S.tileSize/2),S.zoomReverse?(S.zoomOffset--,S.minZoom=Math.min(S.maxZoom,S.minZoom+1)):(S.zoomOffset++,S.maxZoom=Math.max(S.minZoom,S.maxZoom-1)),S.minZoom=Math.max(0,S.minZoom)):S.zoomReverse?S.minZoom=Math.min(S.maxZoom,S.minZoom):S.maxZoom=Math.max(S.minZoom,S.maxZoom),typeof S.subdomains=="string"&&(S.subdomains=S.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(_,S){return this._url===_&&S===void 0&&(S=!0),this._url=_,S||this.redraw(),this},createTile:function(_,S){var z=document.createElement("img");return _i(z,"load",h(this._tileOnLoad,this,S,z)),_i(z,"error",h(this._tileOnError,this,S,z)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(z.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(z.referrerPolicy=this.options.referrerPolicy),z.alt="",z.src=this.getTileUrl(_),z},getTileUrl:function(_){var S={r:Te.retina?"@2x":"",s:this._getSubdomain(_),x:_.x,y:_.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var z=this._globalTileRange.max.y-_.y;this.options.tms&&(S.y=z),S["-y"]=z}return ft(this._url,n(S,this.options))},_tileOnLoad:function(_,S){Te.ielt9?setTimeout(h(_,this,null,S),0):_(null,S)},_tileOnError:function(_,S,z){var Y=this.options.errorTileUrl;Y&&S.getAttribute("src")!==Y&&(S.src=Y),_(z,S)},_onTileRemove:function(_){_.tile.onload=null},_getZoomForUrl:function(){var _=this._tileZoom,S=this.options.maxZoom,z=this.options.zoomReverse,Y=this.options.zoomOffset;return z&&(_=S-_),_+Y},_getSubdomain:function(_){var S=Math.abs(_.x+_.y)%this.options.subdomains.length;return this.options.subdomains[S]},_abortLoading:function(){var _,S;for(_ in this._tiles)if(this._tiles[_].coords.z!==this._tileZoom&&(S=this._tiles[_].el,S.onload=$,S.onerror=$,!S.complete)){S.src=Ut;var z=this._tiles[_].coords;hr(S),delete this._tiles[_],this.fire("tileabort",{tile:S,coords:z})}},_removeTile:function(_){var S=this._tiles[_];if(S)return S.el.setAttribute("src",Ut),ka.prototype._removeTile.call(this,_)},_tileReady:function(_,S,z){if(!(!this._map||z&&z.getAttribute("src")===Ut))return ka.prototype._tileReady.call(this,_,S,z)}});function La(_,S){return new qs(_,S)}var ou=qs.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(_,S){this._url=_;var z=n({},this.defaultWmsParams);for(var Y in S)Y in this.options||(z[Y]=S[Y]);S=ae(this,S);var ne=S.detectRetina&&Te.retina?2:1,ye=this.getTileSize();z.width=ye.x*ne,z.height=ye.y*ne,this.wmsParams=z},onAdd:function(_){this._crs=this.options.crs||_.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var S=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[S]=this._crs.code,qs.prototype.onAdd.call(this,_)},getTileUrl:function(_){var S=this._tileCoordsToNwSe(_),z=this._crs,Y=dn(z.project(S[0]),z.project(S[1])),ne=Y.min,ye=Y.max,Ge=(this._wmsVersion>=1.3&&this._crs===Wu?[ne.y,ne.x,ye.y,ye.x]:[ne.x,ne.y,ye.x,ye.y]).join(","),ht=qs.prototype.getTileUrl.call(this,_);return ht+Ze(this.wmsParams,ht,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Ge},setParams:function(_,S){return n(this.wmsParams,_),S||this.redraw(),this}});function Xh(_,S){return new ou(_,S)}qs.WMS=ou,La.wms=Xh;var ha=hs.extend({options:{padding:.1},initialize:function(_){ae(this,_),w(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),xi(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var _={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(_.zoomanim=this._onAnimZoom),_},_onAnimZoom:function(_){this._updateTransform(_.center,_.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(_,S){var z=this._map.getZoomScale(S,this._zoom),Y=this._map.getSize().multiplyBy(.5+this.options.padding),ne=this._map.project(this._center,S),ye=Y.multiplyBy(-z).add(ne).subtract(this._map._getNewPixelOrigin(_,S));Te.any3d?Ko(this._container,ye,z):Zr(this._container,ye)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var _ in this._layers)this._layers[_]._reset()},_onZoomEnd:function(){for(var _ in this._layers)this._layers[_]._project()},_updatePaths:function(){for(var _ in this._layers)this._layers[_]._update()},_update:function(){var _=this.options.padding,S=this._map.getSize(),z=this._map.containerPointToLayerPoint(S.multiplyBy(-_)).round();this._bounds=new en(z,z.add(S.multiplyBy(1+_*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ol=ha.extend({options:{tolerance:0},getEvents:function(){var _=ha.prototype.getEvents.call(this);return _.viewprereset=this._onViewPreReset,_},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ha.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var _=this._container=document.createElement("canvas");_i(_,"mousemove",this._onMouseMove,this),_i(_,"click dblclick mousedown mouseup contextmenu",this._onClick,this),_i(_,"mouseout",this._handleMouseOut,this),_._leaflet_disable_events=!0,this._ctx=_.getContext("2d")},_destroyContainer:function(){ri(this._redrawRequest),delete this._ctx,hr(this._container),wr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var _;this._redrawBounds=null;for(var S in this._layers)_=this._layers[S],_._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ha.prototype._update.call(this);var _=this._bounds,S=this._container,z=_.getSize(),Y=Te.retina?2:1;Zr(S,_.min),S.width=Y*z.x,S.height=Y*z.y,S.style.width=z.x+"px",S.style.height=z.y+"px",Te.retina&&this._ctx.scale(2,2),this._ctx.translate(-_.min.x,-_.min.y),this.fire("update")}},_reset:function(){ha.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(_){this._updateDashArray(_),this._layers[w(_)]=_;var S=_._order={layer:_,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=S),this._drawLast=S,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(_){this._requestRedraw(_)},_removePath:function(_){var S=_._order,z=S.next,Y=S.prev;z?z.prev=Y:this._drawLast=Y,Y?Y.next=z:this._drawFirst=z,delete _._order,delete this._layers[w(_)],this._requestRedraw(_)},_updatePath:function(_){this._extendRedrawBounds(_),_._project(),_._update(),this._requestRedraw(_)},_updateStyle:function(_){this._updateDashArray(_),this._requestRedraw(_)},_updateDashArray:function(_){if(typeof _.options.dashArray=="string"){var S=_.options.dashArray.split(/[, ]+/),z=[],Y,ne;for(ne=0;ne<S.length;ne++){if(Y=Number(S[ne]),isNaN(Y))return;z.push(Y)}_.options._dashArray=z}else _.options._dashArray=_.options.dashArray},_requestRedraw:function(_){this._map&&(this._extendRedrawBounds(_),this._redrawRequest=this._redrawRequest||Tt(this._redraw,this))},_extendRedrawBounds:function(_){if(_._pxBounds){var S=(_.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new en,this._redrawBounds.extend(_._pxBounds.min.subtract([S,S])),this._redrawBounds.extend(_._pxBounds.max.add([S,S]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var _=this._redrawBounds;if(_){var S=_.getSize();this._ctx.clearRect(_.min.x,_.min.y,S.x,S.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var _,S=this._redrawBounds;if(this._ctx.save(),S){var z=S.getSize();this._ctx.beginPath(),this._ctx.rect(S.min.x,S.min.y,z.x,z.y),this._ctx.clip()}this._drawing=!0;for(var Y=this._drawFirst;Y;Y=Y.next)_=Y.layer,(!S||_._pxBounds&&_._pxBounds.intersects(S))&&_._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(_,S){if(this._drawing){var z,Y,ne,ye,Ge=_._parts,ht=Ge.length,bt=this._ctx;if(ht){for(bt.beginPath(),z=0;z<ht;z++){for(Y=0,ne=Ge[z].length;Y<ne;Y++)ye=Ge[z][Y],bt[Y?"lineTo":"moveTo"](ye.x,ye.y);S&&bt.closePath()}this._fillStroke(bt,_)}}},_updateCircle:function(_){if(!(!this._drawing||_._empty())){var S=_._point,z=this._ctx,Y=Math.max(Math.round(_._radius),1),ne=(Math.max(Math.round(_._radiusY),1)||Y)/Y;ne!==1&&(z.save(),z.scale(1,ne)),z.beginPath(),z.arc(S.x,S.y/ne,Y,0,Math.PI*2,!1),ne!==1&&z.restore(),this._fillStroke(z,_)}},_fillStroke:function(_,S){var z=S.options;z.fill&&(_.globalAlpha=z.fillOpacity,_.fillStyle=z.fillColor||z.color,_.fill(z.fillRule||"evenodd")),z.stroke&&z.weight!==0&&(_.setLineDash&&_.setLineDash(S.options&&S.options._dashArray||[]),_.globalAlpha=z.opacity,_.lineWidth=z.weight,_.strokeStyle=z.color,_.lineCap=z.lineCap,_.lineJoin=z.lineJoin,_.stroke())},_onClick:function(_){for(var S=this._map.mouseEventToLayerPoint(_),z,Y,ne=this._drawFirst;ne;ne=ne.next)z=ne.layer,z.options.interactive&&z._containsPoint(S)&&(!(_.type==="click"||_.type==="preclick")||!this._map._draggableMoved(z))&&(Y=z);this._fireEvent(Y?[Y]:!1,_)},_onMouseMove:function(_){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var S=this._map.mouseEventToLayerPoint(_);this._handleMouseHover(_,S)}},_handleMouseOut:function(_){var S=this._hoveredLayer;S&&(jr(this._container,"leaflet-interactive"),this._fireEvent([S],_,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(_,S){if(!this._mouseHoverThrottled){for(var z,Y,ne=this._drawFirst;ne;ne=ne.next)z=ne.layer,z.options.interactive&&z._containsPoint(S)&&(Y=z);Y!==this._hoveredLayer&&(this._handleMouseOut(_),Y&&(xi(this._container,"leaflet-interactive"),this._fireEvent([Y],_,"mouseover"),this._hoveredLayer=Y)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,_),this._mouseHoverThrottled=!0,setTimeout(h(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(_,S,z){this._map._fireDOMEvent(S,z||S.type,_)},_bringToFront:function(_){var S=_._order;if(S){var z=S.next,Y=S.prev;if(z)z.prev=Y;else return;Y?Y.next=z:z&&(this._drawFirst=z),S.prev=this._drawLast,this._drawLast.next=S,S.next=null,this._drawLast=S,this._requestRedraw(_)}},_bringToBack:function(_){var S=_._order;if(S){var z=S.next,Y=S.prev;if(Y)Y.next=z;else return;z?z.prev=Y:Y&&(this._drawLast=Y),S.prev=null,S.next=this._drawFirst,this._drawFirst.prev=S,this._drawFirst=S,this._requestRedraw(_)}}});function Qn(_){return Te.canvas?new ol(_):null}var sl=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(_){return document.createElement("<lvml:"+_+' class="lvml">')}}catch{}return function(_){return document.createElement("<"+_+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Kp={_initContainer:function(){this._container=Ni("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ha.prototype._update.call(this),this.fire("update"))},_initPath:function(_){var S=_._container=sl("shape");xi(S,"leaflet-vml-shape "+(this.options.className||"")),S.coordsize="1 1",_._path=sl("path"),S.appendChild(_._path),this._updateStyle(_),this._layers[w(_)]=_},_addPath:function(_){var S=_._container;this._container.appendChild(S),_.options.interactive&&_.addInteractiveTarget(S)},_removePath:function(_){var S=_._container;hr(S),_.removeInteractiveTarget(S),delete this._layers[w(_)]},_updateStyle:function(_){var S=_._stroke,z=_._fill,Y=_.options,ne=_._container;ne.stroked=!!Y.stroke,ne.filled=!!Y.fill,Y.stroke?(S||(S=_._stroke=sl("stroke")),ne.appendChild(S),S.weight=Y.weight+"px",S.color=Y.color,S.opacity=Y.opacity,Y.dashArray?S.dashStyle=Xe(Y.dashArray)?Y.dashArray.join(" "):Y.dashArray.replace(/( *, *)/g," "):S.dashStyle="",S.endcap=Y.lineCap.replace("butt","flat"),S.joinstyle=Y.lineJoin):S&&(ne.removeChild(S),_._stroke=null),Y.fill?(z||(z=_._fill=sl("fill")),ne.appendChild(z),z.color=Y.fillColor||Y.color,z.opacity=Y.fillOpacity):z&&(ne.removeChild(z),_._fill=null)},_updateCircle:function(_){var S=_._point.round(),z=Math.round(_._radius),Y=Math.round(_._radiusY||z);this._setPath(_,_._empty()?"M0 0":"AL "+S.x+","+S.y+" "+z+","+Y+" 0,"+65535*360)},_setPath:function(_,S){_._path.v=S},_bringToFront:function(_){Dl(_._container)},_bringToBack:function(_){rc(_._container)}},Ju=Te.vml?sl:Nr,gc=ha.extend({_initContainer:function(){this._container=Ju("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ju("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){hr(this._container),wr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ha.prototype._update.call(this);var _=this._bounds,S=_.getSize(),z=this._container;(!this._svgSize||!this._svgSize.equals(S))&&(this._svgSize=S,z.setAttribute("width",S.x),z.setAttribute("height",S.y)),Zr(z,_.min),z.setAttribute("viewBox",[_.min.x,_.min.y,S.x,S.y].join(" ")),this.fire("update")}},_initPath:function(_){var S=_._path=Ju("path");_.options.className&&xi(S,_.options.className),_.options.interactive&&xi(S,"leaflet-interactive"),this._updateStyle(_),this._layers[w(_)]=_},_addPath:function(_){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(_._path),_.addInteractiveTarget(_._path)},_removePath:function(_){hr(_._path),_.removeInteractiveTarget(_._path),delete this._layers[w(_)]},_updatePath:function(_){_._project(),_._update()},_updateStyle:function(_){var S=_._path,z=_.options;S&&(z.stroke?(S.setAttribute("stroke",z.color),S.setAttribute("stroke-opacity",z.opacity),S.setAttribute("stroke-width",z.weight),S.setAttribute("stroke-linecap",z.lineCap),S.setAttribute("stroke-linejoin",z.lineJoin),z.dashArray?S.setAttribute("stroke-dasharray",z.dashArray):S.removeAttribute("stroke-dasharray"),z.dashOffset?S.setAttribute("stroke-dashoffset",z.dashOffset):S.removeAttribute("stroke-dashoffset")):S.setAttribute("stroke","none"),z.fill?(S.setAttribute("fill",z.fillColor||z.color),S.setAttribute("fill-opacity",z.fillOpacity),S.setAttribute("fill-rule",z.fillRule||"evenodd")):S.setAttribute("fill","none"))},_updatePoly:function(_,S){this._setPath(_,hi(_._parts,S))},_updateCircle:function(_){var S=_._point,z=Math.max(Math.round(_._radius),1),Y=Math.max(Math.round(_._radiusY),1)||z,ne="a"+z+","+Y+" 0 1,0 ",ye=_._empty()?"M0 0":"M"+(S.x-z)+","+S.y+ne+z*2+",0 "+ne+-z*2+",0 ";this._setPath(_,ye)},_setPath:function(_,S){_._path.setAttribute("d",S)},_bringToFront:function(_){Dl(_._path)},_bringToBack:function(_){rc(_._path)}});Te.vml&&gc.include(Kp);function _c(_){return Te.svg||Te.vml?new gc(_):null}zi.include({getRenderer:function(_){var S=_.options.renderer||this._getPaneRenderer(_.options.pane)||this.options.renderer||this._renderer;return S||(S=this._renderer=this._createRenderer()),this.hasLayer(S)||this.addLayer(S),S},_getPaneRenderer:function(_){if(_==="overlayPane"||_===void 0)return!1;var S=this._paneRenderers[_];return S===void 0&&(S=this._createRenderer({pane:_}),this._paneRenderers[_]=S),S},_createRenderer:function(_){return this.options.preferCanvas&&Qn(_)||_c(_)}});var Yi=ca.extend({initialize:function(_,S){ca.prototype.initialize.call(this,this._boundsToLatLngs(_),S)},setBounds:function(_){return this.setLatLngs(this._boundsToLatLngs(_))},_boundsToLatLngs:function(_){return _=Dn(_),[_.getSouthWest(),_.getNorthWest(),_.getNorthEast(),_.getSouthEast()]}});function h_(_,S){return new Yi(_,S)}gc.create=Ju,gc.pointsToPath=hi,fs.geometryToLayer=rl,fs.coordsToLatLng=gf,fs.coordsToLatLngs=ru,fs.latLngToCoords=qh,fs.latLngsToCoords=Yu,fs.getFeature=fc,fs.asFeature=$s,zi.mergeOptions({boxZoom:!0});var Jp=Ro.extend({initialize:function(_){this._map=_,this._container=_._container,this._pane=_._panes.overlayPane,this._resetStateTimeout=0,_.on("unload",this._destroy,this)},addHooks:function(){_i(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){wr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){hr(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(_){if(!_.shiftKey||_.which!==1&&_.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),zs(),Ol(),this._startPoint=this._map.mouseEventToContainerPoint(_),_i(document,{contextmenu:Jo,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(_){this._moved||(this._moved=!0,this._box=Ni("div","leaflet-zoom-box",this._container),xi(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(_);var S=new en(this._point,this._startPoint),z=S.getSize();Zr(this._box,S.min),this._box.style.width=z.x+"px",this._box.style.height=z.y+"px"},_finish:function(){this._moved&&(hr(this._box),jr(this._container,"leaflet-crosshair")),Bs(),ls(),wr(document,{contextmenu:Jo,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(_){if(!(_.which!==1&&_.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(h(this._resetState,this),0);var S=new Ft(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(S).fire("boxzoomend",{boxZoomBounds:S})}},_onKeyDown:function(_){_.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});zi.addInitHook("addHandler","boxZoom",Jp),zi.mergeOptions({doubleClickZoom:!0});var Qp=Ro.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(_){var S=this._map,z=S.getZoom(),Y=S.options.zoomDelta,ne=_.originalEvent.shiftKey?z-Y:z+Y;S.options.doubleClickZoom==="center"?S.setZoom(ne):S.setZoomAround(_.containerPoint,ne)}});zi.addInitHook("addHandler","doubleClickZoom",Qp),zi.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Kh=Ro.extend({addHooks:function(){if(!this._draggable){var _=this._map;this._draggable=new kl(_._mapPane,_._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),_.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),_.on("zoomend",this._onZoomEnd,this),_.whenReady(this._onZoomEnd,this))}xi(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){jr(this._map._container,"leaflet-grab"),jr(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var _=this._map;if(_._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var S=Dn(this._map.options.maxBounds);this._offsetLimit=dn(this._map.latLngToContainerPoint(S.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(S.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;_.fire("movestart").fire("dragstart"),_.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(_){if(this._map.options.inertia){var S=this._lastTime=+new Date,z=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(z),this._times.push(S),this._prunePositions(S)}this._map.fire("move",_).fire("drag",_)},_prunePositions:function(_){for(;this._positions.length>1&&_-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var _=this._map.getSize().divideBy(2),S=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=S.subtract(_).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(_,S){return _-(_-S)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var _=this._draggable._newPos.subtract(this._draggable._startPos),S=this._offsetLimit;_.x<S.min.x&&(_.x=this._viscousLimit(_.x,S.min.x)),_.y<S.min.y&&(_.y=this._viscousLimit(_.y,S.min.y)),_.x>S.max.x&&(_.x=this._viscousLimit(_.x,S.max.x)),_.y>S.max.y&&(_.y=this._viscousLimit(_.y,S.max.y)),this._draggable._newPos=this._draggable._startPos.add(_)}},_onPreDragWrap:function(){var _=this._worldWidth,S=Math.round(_/2),z=this._initialWorldOffset,Y=this._draggable._newPos.x,ne=(Y-S+z)%_+S-z,ye=(Y+S+z)%_-S-z,Ge=Math.abs(ne+z)<Math.abs(ye+z)?ne:ye;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Ge},_onDragEnd:function(_){var S=this._map,z=S.options,Y=!z.inertia||_.noInertia||this._times.length<2;if(S.fire("dragend",_),Y)S.fire("moveend");else{this._prunePositions(+new Date);var ne=this._lastPos.subtract(this._positions[0]),ye=(this._lastTime-this._times[0])/1e3,Ge=z.easeLinearity,ht=ne.multiplyBy(Ge/ye),bt=ht.distanceTo([0,0]),Zt=Math.min(z.inertiaMaxSpeed,bt),vn=ht.multiplyBy(Zt/bt),ei=Zt/(z.inertiaDeceleration*Ge),Pi=vn.multiplyBy(-ei/2).round();!Pi.x&&!Pi.y?S.fire("moveend"):(Pi=S._limitOffset(Pi,S.options.maxBounds),Tt(function(){S.panBy(Pi,{duration:ei,easeLinearity:Ge,noMoveStart:!0,animate:!0})}))}}});zi.addInitHook("addHandler","dragging",Kh),zi.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Jh=Ro.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(_){this._map=_,this._setPanDelta(_.options.keyboardPanDelta),this._setZoomDelta(_.options.zoomDelta)},addHooks:function(){var _=this._map._container;_.tabIndex<=0&&(_.tabIndex="0"),_i(_,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),wr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var _=document.body,S=document.documentElement,z=_.scrollTop||S.scrollTop,Y=_.scrollLeft||S.scrollLeft;this._map._container.focus(),window.scrollTo(Y,z)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(_){var S=this._panKeys={},z=this.keyCodes,Y,ne;for(Y=0,ne=z.left.length;Y<ne;Y++)S[z.left[Y]]=[-1*_,0];for(Y=0,ne=z.right.length;Y<ne;Y++)S[z.right[Y]]=[_,0];for(Y=0,ne=z.down.length;Y<ne;Y++)S[z.down[Y]]=[0,_];for(Y=0,ne=z.up.length;Y<ne;Y++)S[z.up[Y]]=[0,-1*_]},_setZoomDelta:function(_){var S=this._zoomKeys={},z=this.keyCodes,Y,ne;for(Y=0,ne=z.zoomIn.length;Y<ne;Y++)S[z.zoomIn[Y]]=_;for(Y=0,ne=z.zoomOut.length;Y<ne;Y++)S[z.zoomOut[Y]]=-_},_addHooks:function(){_i(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){wr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(_){if(!(_.altKey||_.ctrlKey||_.metaKey)){var S=_.keyCode,z=this._map,Y;if(S in this._panKeys){if(!z._panAnim||!z._panAnim._inProgress)if(Y=this._panKeys[S],_.shiftKey&&(Y=It(Y).multiplyBy(3)),z.options.maxBounds&&(Y=z._limitOffset(It(Y),z.options.maxBounds)),z.options.worldCopyJump){var ne=z.wrapLatLng(z.unproject(z.project(z.getCenter()).add(Y)));z.panTo(ne)}else z.panBy(Y)}else if(S in this._zoomKeys)z.setZoom(z.getZoom()+(_.shiftKey?3:1)*this._zoomKeys[S]);else if(S===27&&z._popup&&z._popup.options.closeOnEscapeKey)z.closePopup();else return;Jo(_)}}});zi.addInitHook("addHandler","keyboard",Jh),zi.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Qh=Ro.extend({addHooks:function(){_i(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){wr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(_){var S=ff(_),z=this._map.options.wheelDebounceTime;this._delta+=S,this._lastMousePos=this._map.mouseEventToContainerPoint(_),this._startTime||(this._startTime=+new Date);var Y=Math.max(z-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(h(this._performZoom,this),Y),Jo(_)},_performZoom:function(){var _=this._map,S=_.getZoom(),z=this._map.options.zoomSnap||0;_._stop();var Y=this._delta/(this._map.options.wheelPxPerZoomLevel*4),ne=4*Math.log(2/(1+Math.exp(-Math.abs(Y))))/Math.LN2,ye=z?Math.ceil(ne/z)*z:ne,Ge=_._limitZoom(S+(this._delta>0?ye:-ye))-S;this._delta=0,this._startTime=null,Ge&&(_.options.scrollWheelZoom==="center"?_.setZoom(S+Ge):_.setZoomAround(this._lastMousePos,S+Ge))}});zi.addInitHook("addHandler","scrollWheelZoom",Qh);var wf=600;zi.mergeOptions({tapHold:Te.touchNative&&Te.safari&&Te.mobile,tapTolerance:15});var Cf=Ro.extend({addHooks:function(){_i(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){wr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(_){if(clearTimeout(this._holdTimeout),_.touches.length===1){var S=_.touches[0];this._startPos=this._newPos=new Ke(S.clientX,S.clientY),this._holdTimeout=setTimeout(h(function(){this._cancel(),this._isTapValid()&&(_i(document,"touchend",vo),_i(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",S))},this),wf),_i(document,"touchend touchcancel contextmenu",this._cancel,this),_i(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function _(){wr(document,"touchend",vo),wr(document,"touchend touchcancel",_)},_cancel:function(){clearTimeout(this._holdTimeout),wr(document,"touchend touchcancel contextmenu",this._cancel,this),wr(document,"touchmove",this._onMove,this)},_onMove:function(_){var S=_.touches[0];this._newPos=new Ke(S.clientX,S.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(_,S){var z=new MouseEvent(_,{bubbles:!0,cancelable:!0,view:window,screenX:S.screenX,screenY:S.screenY,clientX:S.clientX,clientY:S.clientY});z._simulated=!0,S.target.dispatchEvent(z)}});zi.addInitHook("addHandler","tapHold",Cf),zi.mergeOptions({touchZoom:Te.touch,bounceAtZoomLimits:!0});var Mf=Ro.extend({addHooks:function(){xi(this._map._container,"leaflet-touch-zoom"),_i(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){jr(this._map._container,"leaflet-touch-zoom"),wr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(_){var S=this._map;if(!(!_.touches||_.touches.length!==2||S._animatingZoom||this._zooming)){var z=S.mouseEventToContainerPoint(_.touches[0]),Y=S.mouseEventToContainerPoint(_.touches[1]);this._centerPoint=S.getSize()._divideBy(2),this._startLatLng=S.containerPointToLatLng(this._centerPoint),S.options.touchZoom!=="center"&&(this._pinchStartLatLng=S.containerPointToLatLng(z.add(Y)._divideBy(2))),this._startDist=z.distanceTo(Y),this._startZoom=S.getZoom(),this._moved=!1,this._zooming=!0,S._stop(),_i(document,"touchmove",this._onTouchMove,this),_i(document,"touchend touchcancel",this._onTouchEnd,this),vo(_)}},_onTouchMove:function(_){if(!(!_.touches||_.touches.length!==2||!this._zooming)){var S=this._map,z=S.mouseEventToContainerPoint(_.touches[0]),Y=S.mouseEventToContainerPoint(_.touches[1]),ne=z.distanceTo(Y)/this._startDist;if(this._zoom=S.getScaleZoom(ne,this._startZoom),!S.options.bounceAtZoomLimits&&(this._zoom<S.getMinZoom()&&ne<1||this._zoom>S.getMaxZoom()&&ne>1)&&(this._zoom=S._limitZoom(this._zoom)),S.options.touchZoom==="center"){if(this._center=this._startLatLng,ne===1)return}else{var ye=z._add(Y)._divideBy(2)._subtract(this._centerPoint);if(ne===1&&ye.x===0&&ye.y===0)return;this._center=S.unproject(S.project(this._pinchStartLatLng,this._zoom).subtract(ye),this._zoom)}this._moved||(S._moveStart(!0,!1),this._moved=!0),ri(this._animRequest);var Ge=h(S._move,S,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Tt(Ge,this,!0),vo(_)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,ri(this._animRequest),wr(document,"touchmove",this._onTouchMove,this),wr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});zi.addInitHook("addHandler","touchZoom",Mf),zi.BoxZoom=Jp,zi.DoubleClickZoom=Qp,zi.Drag=Kh,zi.Keyboard=Jh,zi.ScrollWheelZoom=Qh,zi.TapHold=Cf,zi.TouchZoom=Mf,e.Bounds=en,e.Browser=Te,e.CRS=qi,e.Canvas=ol,e.Circle=xo,e.CircleMarker=dc,e.Class=ln,e.Control=Sr,e.DivIcon=Yh,e.DivOverlay=Ts,e.DomEvent=Uh,e.DomUtil=li,e.Draggable=kl,e.Evented=At,e.FeatureGroup=aa,e.GeoJSON=fs,e.GridLayer=ka,e.Handler=Ro,e.Icon=la,e.ImageOverlay=Xu,e.LatLng=An,e.LatLngBounds=Ft,e.Layer=hs,e.LayerGroup=ds,e.LineUtil=u_,e.Map=zi,e.Marker=No,e.Mixin=Qc,e.Path=Ot,e.Point=Ke,e.PolyUtil=us,e.Polygon=ca,e.Polyline=Hs,e.Popup=zl,e.PosAnimation=cc,e.Projection=$n,e.Rectangle=Yi,e.Renderer=ha,e.SVG=gc,e.SVGOverlay=xf,e.TileLayer=qs,e.Tooltip=ua,e.Transformation=on,e.Util=er,e.VideoOverlay=Gs,e.bind=h,e.bounds=dn,e.canvas=Qn,e.circle=Wp,e.circleMarker=nl,e.control=cs,e.divIcon=pc,e.extend=n,e.featureGroup=$h,e.geoJSON=Xp,e.geoJson=yf,e.gridLayer=mc,e.icon=iu,e.imageOverlay=vf,e.latLng=_n,e.latLngBounds=Dn,e.layerGroup=yn,e.map=Hu,e.marker=Gh,e.point=It,e.polygon=Nl,e.polyline=il,e.popup=Zh,e.rectangle=h_,e.setOptions=ae,e.stamp=w,e.svg=_c,e.svgOverlay=bf,e.tileLayer=La,e.tooltip=Wh,e.transformation=Zn,e.version=t,e.videoOverlay=Ku;var d_=window.L;e.noConflict=function(){return window.L=d_,this},window.L=e})});var Vp=Ui((Pbe,S5)=>{"use strict";S5.exports=Ute;var jte=Object.prototype.hasOwnProperty;function Ute(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var s in n)jte.call(n,s)&&(e[s]=n[s])}return e}});var D5=Ui((I5,P5)=>{"use strict";(function(){var e=this,t={};typeof I5<"u"?P5.exports=t:e.fuzzy=t,t.simpleFilter=function(n,s){return s.filter(function(h){return t.test(n,h)})},t.test=function(n,s){return t.match(n,s)!==null},t.match=function(n,s,h){h=h||{};var r=0,w=[],A=s.length,F=0,$=0,K=h.pre||"",se=h.post||"",le=h.caseSensitive&&s||s.toLowerCase(),ae;n=h.caseSensitive&&n||n.toLowerCase();for(var Ze=0;Ze<A;Ze++)ae=s[Ze],le[Ze]===n[r]?(ae=K+ae+se,r+=1,$+=1+$):$=0,F+=$,w[w.length]=ae;return r===n.length?(F=le===n?1/0:F,{rendered:w.join(""),score:F}):null},t.filter=function(n,s,h){return!s||s.length===0?[]:typeof n!="string"?s:(h=h||{},s.reduce(function(r,w,A,F){var $=w;h.extract&&($=h.extract(w));var K=t.match(n,$,h);return K!=null&&(r[r.length]={string:K.rendered,score:K.score,index:A,original:w}),r},[]).sort(function(r,w){var A=w.score-r.score;return A||r.index-w.index}))}})()});var A5=Ui((Dbe,O5)=>{"use strict";var Wa=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};Wa.prototype.show=function(){this.element.style.display="block"};Wa.prototype.hide=function(){this.element.style.display="none"};Wa.prototype.add=function(e){this.items.push(e)};Wa.prototype.clear=function(){this.items=[],this.active=0};Wa.prototype.isEmpty=function(){return!this.items.length};Wa.prototype.isVisible=function(){return this.element.style.display==="block"};Wa.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};Wa.prototype.drawItem=function(e,t){var n=document.createElement("li"),s=document.createElement("a");t&&(n.className+=" active"),s.innerHTML=e.string,n.appendChild(s),this.element.appendChild(n),n.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),n.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))};Wa.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};Wa.prototype.move=function(e){this.active=e,this.draw()};Wa.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Wa.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Wa.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};O5.exports=Wa});var k5=Ui((Obe,R5)=>{"use strict";var Hte=Vp(),$te=D5(),Gte=A5(),ia=function(e,t,n){return n=n||{},this.options=Hte({minLength:2,limit:5,filter:!0,hideOnBlur:!0},n),this.el=e,this.data=t||[],this.list=new Gte(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(s){this.handleKeyUp(s.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(s){this.handleKeyDown(s)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(s){this.handlePaste(s)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};ia.prototype.handleKeyUp=function(e){e===40||e===38||e===27||e===13||e===9||this.handleInputChange(this.el.value)};ia.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};ia.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};ia.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(e.target.value)},100)}};ia.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(t){for(var n=0;n<t.length&&(this.list.add(t[n]),n!==this.options.limit-1);n++);this.list.draw()}.bind(this))};ia.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};ia.prototype.update=function(e){this.data=e,this.handleKeyUp()};ia.prototype.clear=function(){this.data=[],this.list.clear()};ia.prototype.normalize=function(e){return e=e.toLowerCase(),e};ia.prototype.match=function(e,t){return e.indexOf(t)>-1};ia.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};ia.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:function(s){return this.getItemValue(s)}.bind(this)},n;this.options.filter?(n=$te.filter(this.query,this.data,t),n=n.map(function(s){return{original:s.original,string:this.render(s.original,s.string)}}.bind(this))):n=this.data.map(function(s){var h=this.render(s);return{original:s,string:h}}.bind(this)),e(n)};ia.prototype.getItemValue=function(e){return e};ia.prototype.render=function(e,t){if(t)return t;for(var n=e.original?this.getItemValue(e.original):this.getItemValue(e),s=this.normalize(n),h=s.lastIndexOf(this.query);h>-1;){var r=h+this.query.length;n=n.slice(0,h)+"<strong>"+n.slice(h,r)+"</strong>"+n.slice(r),h=s.slice(0,h).lastIndexOf(this.query)}return n};ia.prototype.renderError=function(e){this.list.drawError(e)};R5.exports=ia});var N5=Ui((Abe,F5)=>{"use strict";var L5=k5();F5.exports=L5;typeof window<"u"&&(window.Suggestions=L5)});var j5=Ui((Rbe,V5)=>{"use strict";var qte="Expected a function",z5=NaN,Zte="[object Symbol]",Wte=/^\s+|\s+$/g,Yte=/^[-+]0x[0-9a-f]+$/i,Xte=/^0b[01]+$/i,Kte=/^0o[0-7]+$/i,Jte=parseInt,Qte=typeof global=="object"&&global&&global.Object===Object&&global,ene=typeof self=="object"&&self&&self.Object===Object&&self,tne=Qte||ene||Function("return this")(),nne=Object.prototype,ine=nne.toString,rne=Math.max,one=Math.min,cP=function(){return tne.Date.now()};function sne(e,t,n){var s,h,r,w,A,F,$=0,K=!1,se=!1,le=!0;if(typeof e!="function")throw new TypeError(qte);t=B5(t)||0,uP(n)&&(K=!!n.leading,se="maxWait"in n,r=se?rne(B5(n.maxWait)||0,t):r,le="trailing"in n?!!n.trailing:le);function ae(yt){var rn=s,Dt=h;return s=h=void 0,$=yt,w=e.apply(Dt,rn),w}function Ze(yt){return $=yt,A=setTimeout(Xe,t),K?ae(yt):w}function Ue(yt){var rn=yt-F,Dt=yt-$,Tt=t-rn;return se?one(Tt,r-Dt):Tt}function ft(yt){var rn=yt-F,Dt=yt-$;return F===void 0||rn>=t||rn<0||se&&Dt>=r}function Xe(){var yt=cP();if(ft(yt))return st(yt);A=setTimeout(Xe,Ue(yt))}function st(yt){return A=void 0,le&&s?ae(yt):(s=h=void 0,w)}function Ut(){A!==void 0&&clearTimeout(A),$=0,s=F=h=A=void 0}function Bt(){return A===void 0?w:st(cP())}function xt(){var yt=cP(),rn=ft(yt);if(s=arguments,h=this,F=yt,rn){if(A===void 0)return Ze(F);if(se)return A=setTimeout(Xe,t),ae(F)}return A===void 0&&(A=setTimeout(Xe,t)),w}return xt.cancel=Ut,xt.flush=Bt,xt}function uP(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function ane(e){return!!e&&typeof e=="object"}function lne(e){return typeof e=="symbol"||ane(e)&&ine.call(e)==Zte}function B5(e){if(typeof e=="number")return e;if(lne(e))return z5;if(uP(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=uP(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(Wte,"");var n=Xte.test(e);return n||Kte.test(e)?Jte(e.slice(2),n?2:8):Yte.test(e)?z5:+e}V5.exports=sne});var J5=Ui((kbe,hP)=>{"use strict";var o_=typeof Reflect=="object"?Reflect:null,U5=o_&&typeof o_.apply=="function"?o_.apply:function(t,n,s){return Function.prototype.apply.call(t,n,s)},mC;o_&&typeof o_.ownKeys=="function"?mC=o_.ownKeys:Object.getOwnPropertySymbols?mC=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:mC=function(t){return Object.getOwnPropertyNames(t)};function cne(e){console&&console.warn&&console.warn(e)}var $5=Number.isNaN||function(t){return t!==t};function Gr(){Gr.init.call(this)}hP.exports=Gr;hP.exports.once=fne;Gr.EventEmitter=Gr;Gr.prototype._events=void 0;Gr.prototype._eventsCount=0;Gr.prototype._maxListeners=void 0;var H5=10;function gC(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(Gr,"defaultMaxListeners",{enumerable:!0,get:function(){return H5},set:function(e){if(typeof e!="number"||e<0||$5(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");H5=e}});Gr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Gr.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||$5(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function G5(e){return e._maxListeners===void 0?Gr.defaultMaxListeners:e._maxListeners}Gr.prototype.getMaxListeners=function(){return G5(this)};Gr.prototype.emit=function(t){for(var n=[],s=1;s<arguments.length;s++)n.push(arguments[s]);var h=t==="error",r=this._events;if(r!==void 0)h=h&&r.error===void 0;else if(!h)return!1;if(h){var w;if(n.length>0&&(w=n[0]),w instanceof Error)throw w;var A=new Error("Unhandled error."+(w?" ("+w.message+")":""));throw A.context=w,A}var F=r[t];if(F===void 0)return!1;if(typeof F=="function")U5(F,this,n);else for(var $=F.length,K=X5(F,$),s=0;s<$;++s)U5(K[s],this,n);return!0};function q5(e,t,n,s){var h,r,w;if(gC(n),r=e._events,r===void 0?(r=e._events=Object.create(null),e._eventsCount=0):(r.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),w=r[t]),w===void 0)w=r[t]=n,++e._eventsCount;else if(typeof w=="function"?w=r[t]=s?[n,w]:[w,n]:s?w.unshift(n):w.push(n),h=G5(e),h>0&&w.length>h&&!w.warned){w.warned=!0;var A=new Error("Possible EventEmitter memory leak detected. "+w.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");A.name="MaxListenersExceededWarning",A.emitter=e,A.type=t,A.count=w.length,cne(A)}return e}Gr.prototype.addListener=function(t,n){return q5(this,t,n,!1)};Gr.prototype.on=Gr.prototype.addListener;Gr.prototype.prependListener=function(t,n){return q5(this,t,n,!0)};function une(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Z5(e,t,n){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},h=une.bind(s);return h.listener=n,s.wrapFn=h,h}Gr.prototype.once=function(t,n){return gC(n),this.on(t,Z5(this,t,n)),this};Gr.prototype.prependOnceListener=function(t,n){return gC(n),this.prependListener(t,Z5(this,t,n)),this};Gr.prototype.removeListener=function(t,n){var s,h,r,w,A;if(gC(n),h=this._events,h===void 0)return this;if(s=h[t],s===void 0)return this;if(s===n||s.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete h[t],h.removeListener&&this.emit("removeListener",t,s.listener||n));else if(typeof s!="function"){for(r=-1,w=s.length-1;w>=0;w--)if(s[w]===n||s[w].listener===n){A=s[w].listener,r=w;break}if(r<0)return this;r===0?s.shift():hne(s,r),s.length===1&&(h[t]=s[0]),h.removeListener!==void 0&&this.emit("removeListener",t,A||n)}return this};Gr.prototype.off=Gr.prototype.removeListener;Gr.prototype.removeAllListeners=function(t){var n,s,h;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var r=Object.keys(s),w;for(h=0;h<r.length;++h)w=r[h],w!=="removeListener"&&this.removeAllListeners(w);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=s[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(h=n.length-1;h>=0;h--)this.removeListener(t,n[h]);return this};function W5(e,t,n){var s=e._events;if(s===void 0)return[];var h=s[t];return h===void 0?[]:typeof h=="function"?n?[h.listener||h]:[h]:n?dne(h):X5(h,h.length)}Gr.prototype.listeners=function(t){return W5(this,t,!0)};Gr.prototype.rawListeners=function(t){return W5(this,t,!1)};Gr.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):Y5.call(e,t)};Gr.prototype.listenerCount=Y5;function Y5(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Gr.prototype.eventNames=function(){return this._eventsCount>0?mC(this._events):[]};function X5(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e[s];return n}function hne(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function dne(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function fne(e,t){return new Promise(function(n,s){function h(w){e.removeListener(t,r),s(w)}function r(){typeof e.removeListener=="function"&&e.removeListener("error",h),n([].slice.call(arguments))}K5(e,t,r,{once:!0}),t!=="error"&&pne(e,h,{once:!0})})}function pne(e,t,n){typeof e.on=="function"&&K5(e,"error",t,n)}function K5(e,t,n,s){if(typeof e.on=="function")s.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function h(r){s.once&&e.removeEventListener(t,h),n(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}});var eV=Ui((Lbe,Q5)=>{"use strict";Q5.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}});var nV=Ui((Fbe,tV)=>{"use strict";function mne(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function gne(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var n=t[1],s=t[2].split(";"),h=null,r=s.reduce(function(w,A){var F=mne(A);return F?F.key==="rel"?(h||(h=F.value),w):(w[F.key]=F.value,w):w},{});return h?{url:n,rel:h,params:r}:null}function _ne(e){return e?e.split(/,\s*</).reduce(function(t,n){var s=gne(n);if(!s)return t;var h=s.rel.split(/\s+/);return h.forEach(function(r){t[r]||(t[r]={url:s.url,params:s.params})}),t},{}):{}}tV.exports=_ne});var rV=Ui((Nbe,iV)=>{"use strict";var yne=nV();function dP(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=yne(this.headers.link)}dP.prototype.hasNextPage=function(){return!!this.links.next};dP.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};iV.exports=dP});var dv=Ui((zbe,oV)=>{"use strict";oV.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}});var lV=Ui((Bbe,aV)=>{"use strict";var sV=dv();function vne(e){var t=e.type||sV.ERROR_HTTP,n;if(e.body)try{n=JSON.parse(e.body)}catch{n=e.body}else n=null;var s=e.message||null;s||(typeof n=="string"?s=n:n&&typeof n.message=="string"?s=n.message:t===sV.ERROR_REQUEST_ABORTED&&(s="Request aborted")),this.message=s,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=n}aV.exports=vne});var uV=Ui((Vbe,cV)=>{"use strict";function xne(e){var t=e.indexOf(":"),n=e.substring(0,t).trim().toLowerCase(),s=e.substring(t+1).trim();return{name:n,value:s}}function bne(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(n){var s=xne(n);t[s.name]=s.value}),t}cV.exports=bne});var gV=Ui((jbe,mV)=>{"use strict";var wne=rV(),hV=lV(),fP=dv(),Cne=uV(),_C={};function Mne(e){var t=_C[e.id];t&&(t.abort(),delete _C[e.id])}function Tne(e,t){return new wne(e,{body:t.response,headers:Cne(t.getAllResponseHeaders()),statusCode:t.status})}function dV(e){var t=e.total,n=e.loaded,s=100*n/t;return{total:t,transferred:n,percent:s}}function fV(e,t){return new Promise(function(n,s){t.onprogress=function(w){e.emitter.emit(fP.EVENT_PROGRESS_DOWNLOAD,dV(w))};var h=e.file;h&&(t.upload.onprogress=function(w){e.emitter.emit(fP.EVENT_PROGRESS_UPLOAD,dV(w))}),t.onerror=function(w){s(w)},t.onabort=function(){var w=new hV({request:e,type:fP.ERROR_REQUEST_ABORTED});s(w)},t.onload=function(){if(delete _C[e.id],t.status<200||t.status>=400){var w=new hV({request:e,body:t.response,statusCode:t.status});s(w);return}n(t)};var r=e.body;typeof r=="string"?t.send(r):r?t.send(JSON.stringify(r)):h?t.send(h):t.send(),_C[e.id]=t}).then(function(n){return Tne(e,n)})}function pV(e,t){var n=e.url(t),s=new window.XMLHttpRequest;return s.open(e.method,n),Object.keys(e.headers).forEach(function(h){s.setRequestHeader(h,e.headers[h])}),s}function Ene(e){return Promise.resolve().then(function(){var t=pV(e,e.client.accessToken);return fV(e,t)})}mV.exports={browserAbort:Mne,sendRequestXhr:fV,browserSend:Ene,createRequestXhr:pV}});var _V=Ui((yC,fv)=>{"use strict";(function(e){var t=typeof yC=="object"&&yC,n=typeof fv=="object"&&fv&&fv.exports==t&&fv,s=typeof global=="object"&&global;(s.global===s||s.window===s)&&(e=s);var h=function(le){this.message=le};h.prototype=new Error,h.prototype.name="InvalidCharacterError";var r=function(le){throw new h(le)},w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A=/[\t\n\f\r ]/g,F=function(le){le=String(le).replace(A,"");var ae=le.length;ae%4==0&&(le=le.replace(/==?$/,""),ae=le.length),(ae%4==1||/[^+a-zA-Z0-9/]/.test(le))&&r("Invalid character: the string to be decoded is not correctly encoded.");for(var Ze=0,Ue,ft,Xe="",st=-1;++st<ae;)ft=w.indexOf(le.charAt(st)),Ue=Ze%4?Ue*64+ft:ft,Ze++%4&&(Xe+=String.fromCharCode(255&Ue>>(-2*Ze&6)));return Xe},$=function(le){le=String(le),/[^\0-\xFF]/.test(le)&&r("The string to be encoded contains characters outside of the Latin1 range.");for(var ae=le.length%3,Ze="",Ue=-1,ft,Xe,st,Ut,Bt,xt=le.length-ae;++Ue<xt;)ft=le.charCodeAt(Ue)<<16,Xe=le.charCodeAt(++Ue)<<8,st=le.charCodeAt(++Ue),Bt=ft+Xe+st,Ze+=w.charAt(Bt>>18&63)+w.charAt(Bt>>12&63)+w.charAt(Bt>>6&63)+w.charAt(Bt&63);return ae==2?(ft=le.charCodeAt(Ue)<<8,Xe=le.charCodeAt(++Ue),Bt=ft+Xe,Ze+=w.charAt(Bt>>10)+w.charAt(Bt>>4&63)+w.charAt(Bt<<2&63)+"="):ae==1&&(Bt=le.charCodeAt(Ue),Ze+=w.charAt(Bt>>2)+w.charAt(Bt<<4&63)+"=="),Ze},K={encode:$,decode:F,version:"0.1.0"};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd)define(function(){return K});else if(t&&!t.nodeType)if(n)n.exports=K;else for(var se in K)K.hasOwnProperty(se)&&(t[se]=K[se]);else e.base64=K})(yC)});var mP=Ui((Ube,yV)=>{"use strict";var Sne=_V(),pP={};function Ine(e){if(pP[e])return pP[e];var t=e.split("."),n=t[0],s=t[1];if(!s)throw new Error("Invalid token");var h=Pne(s),r={usage:n,user:h.u};return jp(h,"a")&&(r.authorization=h.a),jp(h,"exp")&&(r.expires=h.exp*1e3),jp(h,"iat")&&(r.created=h.iat*1e3),jp(h,"scopes")&&(r.scopes=h.scopes),jp(h,"client")&&(r.client=h.client),jp(h,"ll")&&(r.lastLogin=h.ll),jp(h,"iu")&&(r.impersonator=h.iu),pP[e]=r,r}function Pne(e){try{return JSON.parse(Sne.decode(e))}catch{throw new Error("Invalid token")}}function jp(e,t){return Object.prototype.hasOwnProperty.call(e,t)}yV.exports=Ine});var xV=Ui((Hbe,gP)=>{"use strict";var Dne=Object.prototype.hasOwnProperty,Ia="~";function pv(){}Object.create&&(pv.prototype=Object.create(null),new pv().__proto__||(Ia=!1));function One(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function vV(e,t,n,s,h){if(typeof n!="function")throw new TypeError("The listener must be a function");var r=new One(n,s||e,h),w=Ia?Ia+t:t;return e._events[w]?e._events[w].fn?e._events[w]=[e._events[w],r]:e._events[w].push(r):(e._events[w]=r,e._eventsCount++),e}function vC(e,t){--e._eventsCount===0?e._events=new pv:delete e._events[t]}function ra(){this._events=new pv,this._eventsCount=0}ra.prototype.eventNames=function(){var t=[],n,s;if(this._eventsCount===0)return t;for(s in n=this._events)Dne.call(n,s)&&t.push(Ia?s.slice(1):s);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(n)):t};ra.prototype.listeners=function(t){var n=Ia?Ia+t:t,s=this._events[n];if(!s)return[];if(s.fn)return[s.fn];for(var h=0,r=s.length,w=new Array(r);h<r;h++)w[h]=s[h].fn;return w};ra.prototype.listenerCount=function(t){var n=Ia?Ia+t:t,s=this._events[n];return s?s.fn?1:s.length:0};ra.prototype.emit=function(t,n,s,h,r,w){var A=Ia?Ia+t:t;if(!this._events[A])return!1;var F=this._events[A],$=arguments.length,K,se;if(F.fn){switch(F.once&&this.removeListener(t,F.fn,void 0,!0),$){case 1:return F.fn.call(F.context),!0;case 2:return F.fn.call(F.context,n),!0;case 3:return F.fn.call(F.context,n,s),!0;case 4:return F.fn.call(F.context,n,s,h),!0;case 5:return F.fn.call(F.context,n,s,h,r),!0;case 6:return F.fn.call(F.context,n,s,h,r,w),!0}for(se=1,K=new Array($-1);se<$;se++)K[se-1]=arguments[se];F.fn.apply(F.context,K)}else{var le=F.length,ae;for(se=0;se<le;se++)switch(F[se].once&&this.removeListener(t,F[se].fn,void 0,!0),$){case 1:F[se].fn.call(F[se].context);break;case 2:F[se].fn.call(F[se].context,n);break;case 3:F[se].fn.call(F[se].context,n,s);break;case 4:F[se].fn.call(F[se].context,n,s,h);break;default:if(!K)for(ae=1,K=new Array($-1);ae<$;ae++)K[ae-1]=arguments[ae];F[se].fn.apply(F[se].context,K)}}return!0};ra.prototype.on=function(t,n,s){return vV(this,t,n,s,!1)};ra.prototype.once=function(t,n,s){return vV(this,t,n,s,!0)};ra.prototype.removeListener=function(t,n,s,h){var r=Ia?Ia+t:t;if(!this._events[r])return this;if(!n)return vC(this,r),this;var w=this._events[r];if(w.fn)w.fn===n&&(!h||w.once)&&(!s||w.context===s)&&vC(this,r);else{for(var A=0,F=[],$=w.length;A<$;A++)(w[A].fn!==n||h&&!w[A].once||s&&w[A].context!==s)&&F.push(w[A]);F.length?this._events[r]=F.length===1?F[0]:F:vC(this,r)}return this};ra.prototype.removeAllListeners=function(t){var n;return t?(n=Ia?Ia+t:t,this._events[n]&&vC(this,n)):(this._events=new pv,this._eventsCount=0),this};ra.prototype.off=ra.prototype.removeListener;ra.prototype.addListener=ra.prototype.on;ra.prefixed=Ia;ra.EventEmitter=ra;typeof gP<"u"&&(gP.exports=ra)});var MV=Ui(($be,CV)=>{"use strict";function Ane(e){return e.map(encodeURIComponent).join(",")}function bV(e){return Array.isArray(e)?Ane(e):encodeURIComponent(String(e))}function wV(e,t,n){if(n===!1||n===null)return e;var s=/\?/.test(e)?"&":"?",h=encodeURIComponent(t);return n!==void 0&&n!==""&&n!==!0&&(h+="="+bV(n)),""+e+s+h}function Rne(e,t){if(!t)return e;var n=e;return Object.keys(t).forEach(function(s){var h=t[s];h!==void 0&&(Array.isArray(h)&&(h=h.filter(function(r){return r!=null}).join(",")),n=wV(n,s,h))}),n}function kne(e,t){if(!t||e.slice(0,4)==="http")return e;var n=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+n+e}function Lne(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(n,s){var h=t[s];if(h===void 0)throw new Error("Unspecified route parameter "+s);var r=bV(h);return"/"+r}):e}CV.exports={appendQueryObject:Rne,appendQueryParam:wV,prependOrigin:kne,interpolateRouteParams:Lne}});var SV=Ui((Gbe,EV)=>{"use strict";var Fne=mP(),_P=Vp(),Nne=xV(),xC=MV(),TV=dv(),zne=1;function uf(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var n={};t.body&&(n["content-type"]="application/json");var s=_P(n,t.headers),h=Object.keys(s).reduce(function(r,w){return r[w.toLowerCase()]=s[w],r},{});this.id=zne++,this._options=t,this.emitter=new Nne,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=h}uf.prototype.url=function(t){var n=xC.prependOrigin(this.path,this.origin);n=xC.appendQueryObject(n,this.query);var s=this.params,h=t??this.client.accessToken;if(h){n=xC.appendQueryParam(n,"access_token",h);var r=Fne(h).user;s=_P({ownerId:r},s)}return n=xC.interpolateRouteParams(n,s),n};uf.prototype.send=function(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(n){return t.response=n,t.emitter.emit(TV.EVENT_RESPONSE,n),n},function(n){throw t.error=n,t.emitter.emit(TV.EVENT_ERROR,n),n})};uf.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};uf.prototype.eachPage=function(t){var n=this;function s(w){function A(){delete n._nextPageRequest;var F=w.nextPage();F&&(n._nextPageRequest=F,r(F))}t(null,w,A)}function h(w){t(w,null,function(){})}function r(w){w.send().then(s,h)}r(this)};uf.prototype.clone=function(){return this._extend()};uf.prototype._extend=function(t){var n=_P(this._options,t);return new uf(this.client,n)};EV.exports=uf});var yP=Ui((qbe,PV)=>{"use strict";var Bne=mP(),Vne=SV(),jne=dv();function IV(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");Bne(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||jne.API_ORIGIN}IV.prototype.createRequest=function(t){return new Vne(this,t)};PV.exports=IV});var vP=Ui((Zbe,AV)=>{"use strict";var DV=gV(),OV=yP();function s_(e){OV.call(this,e)}s_.prototype=Object.create(OV.prototype);s_.prototype.constructor=s_;s_.prototype.sendRequest=DV.browserSend;s_.prototype.abortRequest=DV.browserAbort;function Une(e){return new s_(e)}AV.exports=Une});var kV=Ui((Wbe,RV)=>{"use strict";var Hne=vP();RV.exports=Hne});var FV=Ui((Ybe,LV)=>{"use strict";var $ne=Object.prototype.toString;LV.exports=function(e){var t;return $ne.call(e)==="[object Object]"&&(t=Object.getPrototypeOf(e),t===null||t===Object.getPrototypeOf({}))}});var UV=Ui((Xbe,jV)=>{"use strict";var Gne=FV(),qne=Vp(),NV="value",xP=`
  `,ro={};ro.assert=function(e,t){return t=t||{},function(n){var s=hf(e,n);if(s){var h=bP(s,t);throw t.apiName&&(h=t.apiName+": "+h),new Error(h)}}};ro.shape=function(t){var n=Xne(t);return function(h){var r=hf(ro.plainObject,h);if(r)return r;for(var w,A,F=[],$=0;$<n.length;$++)w=n[$].key,A=n[$].value,r=hf(A,h[w]),r&&F.push([w].concat(r));return F.length<2?F[0]:function(K){F=F.map(function(ae){var Ze=ae[0],Ue=bP(ae,K).split(`
`).join(xP);return"- "+Ze+": "+Ue});var se=K.path.join("."),le=se===NV?"":" of "+se;return"The following properties"+le+" have invalid values:"+xP+F.join(xP)}}};ro.strictShape=function(t){var n=ro.shape(t);return function(h){var r=n(h);if(r)return r;var w=Object.keys(h).reduce(function(A,F){return t[F]===void 0&&A.push(F),A},[]);if(w.length!==0)return function(){return"The following keys are invalid: "+w.join(", ")}}};ro.arrayOf=function(t){return zV(t)};ro.tuple=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return zV(t)};function zV(e){var t=Array.isArray(e),n=function(s){return t?e[s]:e};return function(h){var r=hf(ro.plainArray,h);if(r)return r;if(t&&h.length!==e.length)return"an array with "+e.length+" items";for(var w=0;w<h.length;w++)if(r=hf(n(w),h[w]),r)return[w].concat(r)}}ro.required=function(t){function n(s){return s==null?function(h){return BV(h,VV(h.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return n.__required=!0,n};ro.oneOfType=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(s){var h=t.map(function(r){return hf(r,s)}).filter(Boolean);if(h.length===t.length)return h.every(function(r){return r.length===1&&typeof r[0]=="string"})?Zne(h.map(function(r){return r[0]})):h.reduce(function(r,w){return w.length>r.length?w:r})}};ro.equal=function(t){return function(s){if(s!==t)return JSON.stringify(t)}};ro.oneOf=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),n=t.map(function(s){return ro.equal(s)});return ro.oneOfType.apply(this,n)};ro.range=function(t){var n=t[0],s=t[1];return function(r){var w=hf(ro.number,r);if(w||r<n||r>s)return"number between "+n+" & "+s+" (inclusive)"}};ro.any=function(){};ro.boolean=function(t){if(typeof t!="boolean")return"boolean"};ro.number=function(t){if(typeof t!="number")return"number"};ro.plainArray=function(t){if(!Array.isArray(t))return"array"};ro.plainObject=function(t){if(!Gne(t))return"object"};ro.string=function(t){if(typeof t!="string")return"string"};ro.func=function(t){if(typeof t!="function")return"function"};function hf(e,t){if(!(t==null&&!e.hasOwnProperty("__required"))){var n=e(t);if(n)return Array.isArray(n)?n:[n]}}function bP(e,t){var n=e.length,s=e[n-1],h=e.slice(0,n-1);return h.length===0&&(h=[NV]),t=qne(t,{path:h}),typeof s=="function"?s(t):BV(t,Wne(s))}function Zne(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function Wne(e){return"must be "+Yne(e)+"."}function Yne(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function BV(e,t){var n=VV(e.path),s=e.path.join(".")+" "+t,h=n?"Item at position ":"";return h+s}function VV(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function Xne(e){return Object.keys(e||{}).map(function(t){return{key:t,value:e[t]}})}ro.validate=hf;ro.processMessage=bP;jV.exports=ro});var $V=Ui((Kbe,HV)=>{"use strict";var Kne=Vp(),a_=UV();function Jne(e){if(typeof window<"u")return e instanceof global.Blob||e instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function Qne(e,t){return a_.assert(a_.strictShape(e),t)}function eie(e){var t="date";if(typeof e=="boolean")return t;try{var n=new Date(e);if(n.getTime&&isNaN(n.getTime()))return t}catch{return t}}function tie(e){return a_.tuple(a_.number,a_.number)(e)}HV.exports=Kne(a_,{file:Jne,date:eie,coordinates:tie,assertShape:Qne})});var qV=Ui((Jbe,GV)=>{"use strict";function nie(e,t){var n=function(s,h){return t.indexOf(s)!==-1&&h!==void 0};return typeof t=="function"&&(n=t),Object.keys(e).filter(function(s){return n(s,e[s])}).reduce(function(s,h){return s[h]=e[h],s},{})}GV.exports=nie});var WV=Ui((Qbe,ZV)=>{"use strict";function iie(e,t){return Object.keys(e).reduce(function(n,s){return n[s]=t(s,e[s]),n},{})}ZV.exports=iie});var XV=Ui((ewe,YV)=>{"use strict";var rie=WV();function oie(e){return rie(e,function(t,n){return typeof n=="boolean"?JSON.stringify(n):n})}YV.exports=oie});var JV=Ui((twe,KV)=>{"use strict";var sie=yP(),aie=vP();function lie(e){return function(t){var n;sie.prototype.isPrototypeOf(t)?n=t:n=aie(t);var s=Object.create(e);return s.client=n,s}}KV.exports=lie});var i6=Ui((nwe,n6)=>{"use strict";var QV=Vp(),or=$V(),bC=qV(),e6=XV(),cie=JV(),wP={},t6=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];wP.forwardGeocode=function(e){or.assertShape({query:or.required(or.string),mode:or.oneOf("mapbox.places","mapbox.places-permanent"),countries:or.arrayOf(or.string),proximity:or.oneOf(or.coordinates,"ip"),types:or.arrayOf(or.oneOf(t6)),autocomplete:or.boolean,bbox:or.arrayOf(or.number),limit:or.number,language:or.arrayOf(or.string),routing:or.boolean,fuzzyMatch:or.boolean,worldview:or.string,session_token:or.string})(e),e.mode=e.mode||"mapbox.places";var t=e6(QV({country:e.countries},bC(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:bC(e,["mode","query"]),query:t})};wP.reverseGeocode=function(e){or.assertShape({query:or.required(or.coordinates),mode:or.oneOf("mapbox.places","mapbox.places-permanent"),countries:or.arrayOf(or.string),types:or.arrayOf(or.oneOf(t6)),bbox:or.arrayOf(or.number),limit:or.number,language:or.arrayOf(or.string),reverseMode:or.oneOf("distance","score"),routing:or.boolean,worldview:or.string,session_token:or.string})(e),e.mode=e.mode||"mapbox.places";var t=e6(QV({country:e.countries},bC(e,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:bC(e,["mode","query"]),query:t})};n6.exports=cie(wP)});var r6,o6=uR(()=>{"use strict";r6="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"});var l6={};f9(l6,{customAlphabet:()=>uie,customRandom:()=>a6,nanoid:()=>hie,random:()=>s6,urlAlphabet:()=>r6});var s6,a6,uie,hie,c6=uR(()=>{"use strict";o6();s6=e=>crypto.getRandomValues(new Uint8Array(e)),a6=(e,t,n)=>{let s=(2<<Math.log(e.length-1)/Math.LN2)-1,h=-~(1.6*s*t/e.length);return(r=t)=>{let w="";for(;;){let A=n(h),F=h;for(;F--;)if(w+=e[A[F]&s]||"",w.length===r)return w}}},uie=(e,t=21)=>a6(e,t,s6),hie=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"")});var d6=Ui((owe,h6)=>{"use strict";var die=(c6(),p9(l6)).nanoid;function u6(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}u6.prototype={select:function(e,t){var n=this.getEventPayload("search.select",t,{selectedFeature:e});if(n&&!(n.resultIndex===this.lastSentIndex&&n.queryString===this.lastSentInput||n.resultIndex==-1))return this.lastSentIndex=n.resultIndex,this.lastSentInput=n.queryString,this.push(n)},start:function(e){var t=this.getEventPayload("search.start",e);if(t)return this.push(t)},keyevent:function(e,t){if(e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var n=this.getEventPayload("search.keystroke",t,{key:e.key});if(n)return this.push(n)}},send:function(e,t){if(!this.enableEventLogging)return t?t():void 0;var n=this.getRequestOptions(e);this.request(n,function(s){if(s)return this.handleError(s,t);if(t)return t()}.bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var t={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return t},getEventPayload:function(e,t,n={}){if(e==="search.select"&&!n.selectedFeature||e==="search.keystroke"&&!n.key)return null;var s;if(!t.options.proximity)s=null;else if(typeof t.options.proximity=="object")s=[t.options.proximity.longitude,t.options.proximity.latitude];else if(t.options.proximity==="ip"){var h=t._headers?t._headers["ip-proximity"]:null;h&&typeof h=="string"?s=h.split(",").map(parseFloat):s=[999,999]}else s=t.options.proximity;var r=t._map?t._map.getZoom():void 0,w={event:e,version:this.getEventSchemaVersion(e),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:s,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:r,keyboardLocale:this.locale};if(e==="search.select"?w.queryString=t.inputString:e!="search.select"&&t._inputEl?w.queryString=t._inputEl.value:w.queryString=t.inputString,["search.keystroke","search.select"].includes(e)&&(w.path="geocoding/v5/mapbox.places"),e==="search.keystroke"&&n.key)w.lastAction=n.key;else if(e==="search.select"&&n.selectedFeature){var A=n.selectedFeature,F=this.getSelectedIndex(A,t);if(w.resultIndex=F,w.resultPlaceName=A.place_name,w.resultId=A.id,A.properties&&(w.resultMapboxId=A.properties.mapbox_id),t._typeahead){var $=t._typeahead.data;$&&$.length>0&&(w.suggestionIds=this.getSuggestionIds($),w.suggestionNames=this.getSuggestionNames($),w.suggestionTypes=this.getSuggestionTypes($),w.suggestionSources=this.getSuggestionSources($))}}return this.validatePayload(w)?w:null},request:function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(this.readyState==4)return this.status==204?t(null):t(this.statusText)},n.open(e.method,e.host+"/"+e.path,!0);for(var s in e.headers){var h=e.headers[s];n.setRequestHeader(s,h)}n.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return die()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead){var n=t._typeahead.data,s=e.id,h=n.map(function(w){return w.id}),r=h.indexOf(s);return r}},getSuggestionIds:function(e){return e.map(function(t){return t.properties?t.properties.mapbox_id||"":t.id||""})},getSuggestionNames:function(e){return e.map(function(t){return t.place_name||""})},getSuggestionTypes:function(e){return e.map(function(t){return t.place_type&&Array.isArray(t.place_type)&&t.place_type[0]||""})},getSuggestionSources:function(e){return e.map(function(t){return t._source||""})},getEventSchemaVersion:function(e){return["search.keystroke","search.select"].includes(e)?"2.2":"2.0"},validatePayload:function(e){if(!e||!e.event)return!1;var t=["event","created","sessionIdentifier","queryString"],n=["event","created","sessionIdentifier","queryString","lastAction"],s=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],h=e.event;return h==="search.start"?this.objectHasRequiredProps(e,t):h==="search.keystroke"?this.objectHasRequiredProps(e,n):h==="search.select"?this.objectHasRequiredProps(e,s):!0},objectHasRequiredProps:function(e,t){return t.every(function(n){return n==="queryString"?typeof e[n]=="string"&&e[n].length>0:e[n]!==void 0})},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};h6.exports=u6});var p6=Ui((swe,f6)=>{"use strict";var fie={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"};f6.exports={placeholder:fie}});var g6=Ui((m6,wC)=>{"use strict";(function(e,t,n){typeof wC<"u"&&wC.exports?wC.exports=n():e[t]=n()})(m6,"subtag",function(){var e="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(A){return A.match(t)||[]}function s(A){return n(A).filter(function(F,$){return F&&$})}function h(A){return A=n(A),{language:A[1]||e,extlang:A[2]||e,script:A[3]||e,region:A[4]||e}}function r(A,F,$){Object.defineProperty(A,F,{value:$,enumerable:!0})}function w(A,F,$){function K(se){return n(se)[A]||e}r(K,"pattern",F),r(h,$,K)}return w(1,/^[a-zA-Z]{2,3}$/,"language"),w(2,/^[a-zA-Z]{3}$/,"extlang"),w(3,/^[a-zA-Z]{4}$/,"script"),w(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),r(h,"split",s),h})});var v6=Ui((awe,y6)=>{"use strict";function _6(){}_6.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){let e={enableHighAccuracy:!0};return new Promise(function(t,n){window.navigator.geolocation.getCurrentPosition(t,n,e)})}};y6.exports=_6});var w6=Ui((lwe,b6)=>{"use strict";function pie(e,t){let n=x6(e),s=["address","street","place","country"];var h;if(typeof t=="function")return t(n);let r=s.indexOf(t);return r===-1?h=s:h=s.slice(r),h.reduce(function(w,A){return n[A]?(w!==""&&(w=w+", "),w+n[A]):w},"")}function x6(e){let t=e.address||"",n=e.text||"",s=e.place_name||"",r={address:s.split(",")[0],houseNumber:t,street:n,placeName:s};return e.context.forEach(function(w){let A=w.id.split(".")[0];r[A]=w.text}),r}var mie=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;b6.exports={transformFeatureToGeolocationText:pie,getAddressInfo:x6,REVERSE_GEOCODE_COORD_RGX:mie}});var S6=Ui((cwe,E6)=>{"use strict";var gie=N5(),_ie=j5(),Up=Vp(),yie=J5().EventEmitter,C6=eV(),CP=kV(),MP=i6(),vie=d6(),xie=p6(),bie=g6(),wie=v6(),M6=w6(),df={FORWARD:0,LOCAL:1,REVERSE:2};function Cie(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function T6(e){this._eventEmitter=new yie,this.options=Up({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new wie}T6.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},_headers:{},addTo:function(e){function t(n,s){if(!document.body.contains(s))throw new Error("Element provided to #addTo() exists, but is not in the DOM");let h=n.onAdd();s.appendChild(h)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){let n=document.querySelectorAll(e);if(n.length===0)throw new Error("Element ",e,"not found.");if(n.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,n[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=MP(CP({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new vie(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",_ie(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function($){this.eventManager.keyevent($,this)}.bind(this));var s=document.createElement("div");s.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var h=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(h),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),s.appendChild(this._clearEl),s.appendChild(this._loadingEl),t.appendChild(n),t.appendChild(this._inputEl),t.appendChild(s),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var r=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(r),s.appendChild(this._geolocateEl),this._showGeolocateButton()}var w=this._typeahead=new gie(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),w.getItemValue=this.options.getItemValue;var A=w.list.draw,F=this._footerNode=Cie();return w.list.draw=function(){A.call(this),F.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),F.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(F)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(e){this._hideLoadingIcon();let t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;let n={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){let s=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(s),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(n).send().then(function(s){let h=s.body.features[0];if(h){let r=M6.transformFeatureToGeolocationText(h,this.options.addressAccuracy);this._setInputValue(r),h.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:h})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),n.setAttribute("viewBox","0 0 18 18"),n.setAttribute("xml:space","preserve"),n.setAttribute("width",18),n.setAttribute("height",18),n.innerHTML=t,n},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){var t=27,n=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var s=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,h=s?s.value:"";if(!h)return this.fresh=!0,e.keyCode!==n&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[n,t,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&s.value.length>=this.options.minLength&&this._geocode(s.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&C6[e.properties.short_code])t=Up({},this.options.flyTo),this._map&&this._map.fitBounds(C6[e.properties.short_code].bbox,t);else if(e.bbox){var n=e.bbox;t=Up({},this.options.flyTo),this._map&&this._map.fitBounds([[n[0],n[1]],[n[2],n[3]]],t)}else{var s={zoom:this.options.zoom};t=Up({},s,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){var n;return e.localGeocoderOnly?n=df.LOCAL:e.reverseGeocode&&M6.REVERSE_GEOCODE_COORD_RGX.test(t)?n=df.REVERSE:n=df.FORWARD,n},_setupConfig:function(e,t){let n=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],s=/[\s,]+/;var h=this,r=n.reduce(function(A,F){if(h.options[F]===void 0||h.options[F]===null)return A;["countries","types","language"].indexOf(F)>-1?A[F]=h.options[F].split(s):A[F]=h.options[F];let $=typeof h.options[F].longitude=="number"&&typeof h.options[F].latitude=="number";if(F==="proximity"&&$){let K=h.options[F].longitude,se=h.options[F].latitude;A[F]=[K,se]}return A},{});switch(e){case df.REVERSE:{var w=t.split(s).map(function(A){return parseFloat(A,10)});h.options.flipCoordinates||w.reverse(),r.types&&r.types[0],r=Up(r,{query:w,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(A){A in r&&delete r[A]})}break;case df.FORWARD:{let A=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(A)&&(t=t.replace(/,/g," ")),r=Up(r,{query:t})}break}return r.session_token=this.eventManager.getSessionId(),r},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});let t=this._requestType(this.options,e),n=this._setupConfig(t,e);var s;switch(t){case df.LOCAL:s=Promise.resolve();break;case df.FORWARD:s=this.geocoderService.forwardGeocode(n).send();break;case df.REVERSE:s=this.geocoderService.reverseGeocode(n).send();break}var h=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],r=[],w=null;return s.catch(function(A){w=A}.bind(this)).then(function(A){this._hideLoadingIcon();var F={};return A?A.statusCode=="200"&&(F=A.body,F.request=A.request,F.headers=A.headers,this._headers=A.headers):F={type:"FeatureCollection",features:[]},F.config=n,this.fresh&&(this.eventManager.start(this),this.fresh=!1),F.features&&F.features.length&&F.features.map(function($){$._source="mapbox"}),F.features=F.features?h.concat(F.features):h,this.options.externalGeocoder?(r=this.options.externalGeocoder(e,F.features)||Promise.resolve([]),r.then(function($){return F.features=F.features?$.concat(F.features):$,F},function(){return F})):F}.bind(this)).then(function(A){if(w)throw w;this.options.filter&&A.features.length&&(A.features=A.features.filter(this.options.filter)),A.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",A),this._typeahead.update(A.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",A))}.bind(this)).catch(function(A){this._hideLoadingIcon(),this._hideAttribution(),h.length&&this.options.localGeocoder||r.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(h)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:h}),this._eventEmitter.emit("error",{error:A})}.bind(this)),s},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(t.features.length){var n=t.features[0];this._typeahead.selected=n,this._inputEl.value=n.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=bie.language(e),n=xie.placeholder[t];if(n)return n}return"Search"},setInput:function(e,t){return t===void 0&&(t=!1),this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&(t?this._geocode(e):this._onChange()),this},setProximity:function(e,t=!0){return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.options.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=MP(CP({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=MP(CP({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var t={color:"#4668F2"},n=Up({},t,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(n),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}};E6.exports=T6});var P6=Ui((TP,EP)=>{"use strict";(function(e,t){typeof TP=="object"&&typeof EP<"u"?EP.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis<"u"?globalThis:e||self,e.mapboxgl=t())})(TP,function(){"use strict";var e,t,n;function s(r,w){if(!e)e=w;else if(!t)t=w;else{var A="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",F={};e(F),n=w(F),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}s(["exports"],function(r){function w(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var A,F={},$={};function K(){if(A)return $;A=1,Object.defineProperty($,"__esModule",{value:!0}),$.setMatrixArrayType=function(m){$.ARRAY_TYPE=i=m},$.toRadian=function(m){return m*u},$.equals=function(m,d){return Math.abs(m-d)<=c*Math.max(1,Math.abs(m),Math.abs(d))},$.RANDOM=$.ARRAY_TYPE=$.EPSILON=void 0;var c=1e-6;$.EPSILON=c;var i=typeof Float32Array<"u"?Float32Array:Array;$.ARRAY_TYPE=i;var a=Math.random;$.RANDOM=a;var u=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var m=0,d=arguments.length;d--;)m+=arguments[d]*arguments[d];return Math.sqrt(m)}),$}var se,le={};function ae(){if(se)return le;function c(d){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(d)}se=1,Object.defineProperty(le,"__esModule",{value:!0}),le.create=function(){var d=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d},le.clone=function(d){var g=new i.ARRAY_TYPE(4);return g[0]=d[0],g[1]=d[1],g[2]=d[2],g[3]=d[3],g},le.copy=function(d,g){return d[0]=g[0],d[1]=g[1],d[2]=g[2],d[3]=g[3],d},le.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d},le.fromValues=function(d,g,b,T){var O=new i.ARRAY_TYPE(4);return O[0]=d,O[1]=g,O[2]=b,O[3]=T,O},le.set=function(d,g,b,T,O){return d[0]=g,d[1]=b,d[2]=T,d[3]=O,d},le.transpose=function(d,g){if(d===g){var b=g[1];d[1]=g[2],d[2]=b}else d[0]=g[0],d[1]=g[2],d[2]=g[1],d[3]=g[3];return d},le.invert=function(d,g){var b=g[0],T=g[1],O=g[2],x=g[3],E=b*x-O*T;return E?(d[0]=x*(E=1/E),d[1]=-T*E,d[2]=-O*E,d[3]=b*E,d):null},le.adjoint=function(d,g){var b=g[0];return d[0]=g[3],d[1]=-g[1],d[2]=-g[2],d[3]=b,d},le.determinant=function(d){return d[0]*d[3]-d[2]*d[1]},le.multiply=u,le.rotate=function(d,g,b){var T=g[0],O=g[1],x=g[2],E=g[3],P=Math.sin(b),M=Math.cos(b);return d[0]=T*M+x*P,d[1]=O*M+E*P,d[2]=T*-P+x*M,d[3]=O*-P+E*M,d},le.scale=function(d,g,b){var T=g[1],O=g[2],x=g[3],E=b[0],P=b[1];return d[0]=g[0]*E,d[1]=T*E,d[2]=O*P,d[3]=x*P,d},le.fromRotation=function(d,g){var b=Math.sin(g),T=Math.cos(g);return d[0]=T,d[1]=b,d[2]=-b,d[3]=T,d},le.fromScaling=function(d,g){return d[0]=g[0],d[1]=0,d[2]=0,d[3]=g[1],d},le.str=function(d){return"mat2("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")"},le.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3])},le.LDU=function(d,g,b,T){return d[2]=T[2]/T[0],b[0]=T[0],b[1]=T[1],b[3]=T[3]-d[2]*b[1],[d,g,b]},le.add=function(d,g,b){return d[0]=g[0]+b[0],d[1]=g[1]+b[1],d[2]=g[2]+b[2],d[3]=g[3]+b[3],d},le.subtract=m,le.exactEquals=function(d,g){return d[0]===g[0]&&d[1]===g[1]&&d[2]===g[2]&&d[3]===g[3]},le.equals=function(d,g){var b=d[0],T=d[1],O=d[2],x=d[3],E=g[0],P=g[1],M=g[2],I=g[3];return Math.abs(b-E)<=i.EPSILON*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(T-P)<=i.EPSILON*Math.max(1,Math.abs(T),Math.abs(P))&&Math.abs(O-M)<=i.EPSILON*Math.max(1,Math.abs(O),Math.abs(M))&&Math.abs(x-I)<=i.EPSILON*Math.max(1,Math.abs(x),Math.abs(I))},le.multiplyScalar=function(d,g,b){return d[0]=g[0]*b,d[1]=g[1]*b,d[2]=g[2]*b,d[3]=g[3]*b,d},le.multiplyScalarAndAdd=function(d,g,b,T){return d[0]=g[0]+b[0]*T,d[1]=g[1]+b[1]*T,d[2]=g[2]+b[2]*T,d[3]=g[3]+b[3]*T,d},le.sub=le.mul=void 0;var i=function(d,g){if(d&&d.__esModule)return d;if(d===null||c(d)!=="object"&&typeof d!="function")return{default:d};var b=a(void 0);if(b&&b.has(d))return b.get(d);var T={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in d)if(x!=="default"&&Object.prototype.hasOwnProperty.call(d,x)){var E=O?Object.getOwnPropertyDescriptor(d,x):null;E&&(E.get||E.set)?Object.defineProperty(T,x,E):T[x]=d[x]}return T.default=d,b&&b.set(d,T),T}(K());function a(d){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(a=function(T){return T?b:g})(d)}function u(d,g,b){var T=g[0],O=g[1],x=g[2],E=g[3],P=b[0],M=b[1],I=b[2],R=b[3];return d[0]=T*P+x*M,d[1]=O*P+E*M,d[2]=T*I+x*R,d[3]=O*I+E*R,d}function m(d,g,b){return d[0]=g[0]-b[0],d[1]=g[1]-b[1],d[2]=g[2]-b[2],d[3]=g[3]-b[3],d}return le.mul=u,le.sub=m,le}var Ze,Ue={};function ft(){if(Ze)return Ue;function c(d){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(d)}Ze=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.create=function(){var d=new i.ARRAY_TYPE(6);return i.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0,d[4]=0,d[5]=0),d[0]=1,d[3]=1,d},Ue.clone=function(d){var g=new i.ARRAY_TYPE(6);return g[0]=d[0],g[1]=d[1],g[2]=d[2],g[3]=d[3],g[4]=d[4],g[5]=d[5],g},Ue.copy=function(d,g){return d[0]=g[0],d[1]=g[1],d[2]=g[2],d[3]=g[3],d[4]=g[4],d[5]=g[5],d},Ue.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d[4]=0,d[5]=0,d},Ue.fromValues=function(d,g,b,T,O,x){var E=new i.ARRAY_TYPE(6);return E[0]=d,E[1]=g,E[2]=b,E[3]=T,E[4]=O,E[5]=x,E},Ue.set=function(d,g,b,T,O,x,E){return d[0]=g,d[1]=b,d[2]=T,d[3]=O,d[4]=x,d[5]=E,d},Ue.invert=function(d,g){var b=g[0],T=g[1],O=g[2],x=g[3],E=g[4],P=g[5],M=b*x-T*O;return M?(d[0]=x*(M=1/M),d[1]=-T*M,d[2]=-O*M,d[3]=b*M,d[4]=(O*P-x*E)*M,d[5]=(T*E-b*P)*M,d):null},Ue.determinant=function(d){return d[0]*d[3]-d[1]*d[2]},Ue.multiply=u,Ue.rotate=function(d,g,b){var T=g[0],O=g[1],x=g[2],E=g[3],P=g[4],M=g[5],I=Math.sin(b),R=Math.cos(b);return d[0]=T*R+x*I,d[1]=O*R+E*I,d[2]=T*-I+x*R,d[3]=O*-I+E*R,d[4]=P,d[5]=M,d},Ue.scale=function(d,g,b){var T=g[1],O=g[2],x=g[3],E=g[4],P=g[5],M=b[0],I=b[1];return d[0]=g[0]*M,d[1]=T*M,d[2]=O*I,d[3]=x*I,d[4]=E,d[5]=P,d},Ue.translate=function(d,g,b){var T=g[0],O=g[1],x=g[2],E=g[3],P=g[4],M=g[5],I=b[0],R=b[1];return d[0]=T,d[1]=O,d[2]=x,d[3]=E,d[4]=T*I+x*R+P,d[5]=O*I+E*R+M,d},Ue.fromRotation=function(d,g){var b=Math.sin(g),T=Math.cos(g);return d[0]=T,d[1]=b,d[2]=-b,d[3]=T,d[4]=0,d[5]=0,d},Ue.fromScaling=function(d,g){return d[0]=g[0],d[1]=0,d[2]=0,d[3]=g[1],d[4]=0,d[5]=0,d},Ue.fromTranslation=function(d,g){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d[4]=g[0],d[5]=g[1],d},Ue.str=function(d){return"mat2d("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+")"},Ue.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3],d[4],d[5],1)},Ue.add=function(d,g,b){return d[0]=g[0]+b[0],d[1]=g[1]+b[1],d[2]=g[2]+b[2],d[3]=g[3]+b[3],d[4]=g[4]+b[4],d[5]=g[5]+b[5],d},Ue.subtract=m,Ue.multiplyScalar=function(d,g,b){return d[0]=g[0]*b,d[1]=g[1]*b,d[2]=g[2]*b,d[3]=g[3]*b,d[4]=g[4]*b,d[5]=g[5]*b,d},Ue.multiplyScalarAndAdd=function(d,g,b,T){return d[0]=g[0]+b[0]*T,d[1]=g[1]+b[1]*T,d[2]=g[2]+b[2]*T,d[3]=g[3]+b[3]*T,d[4]=g[4]+b[4]*T,d[5]=g[5]+b[5]*T,d},Ue.exactEquals=function(d,g){return d[0]===g[0]&&d[1]===g[1]&&d[2]===g[2]&&d[3]===g[3]&&d[4]===g[4]&&d[5]===g[5]},Ue.equals=function(d,g){var b=d[0],T=d[1],O=d[2],x=d[3],E=d[4],P=d[5],M=g[0],I=g[1],R=g[2],V=g[3],j=g[4],Z=g[5];return Math.abs(b-M)<=i.EPSILON*Math.max(1,Math.abs(b),Math.abs(M))&&Math.abs(T-I)<=i.EPSILON*Math.max(1,Math.abs(T),Math.abs(I))&&Math.abs(O-R)<=i.EPSILON*Math.max(1,Math.abs(O),Math.abs(R))&&Math.abs(x-V)<=i.EPSILON*Math.max(1,Math.abs(x),Math.abs(V))&&Math.abs(E-j)<=i.EPSILON*Math.max(1,Math.abs(E),Math.abs(j))&&Math.abs(P-Z)<=i.EPSILON*Math.max(1,Math.abs(P),Math.abs(Z))},Ue.sub=Ue.mul=void 0;var i=function(d,g){if(d&&d.__esModule)return d;if(d===null||c(d)!=="object"&&typeof d!="function")return{default:d};var b=a(void 0);if(b&&b.has(d))return b.get(d);var T={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in d)if(x!=="default"&&Object.prototype.hasOwnProperty.call(d,x)){var E=O?Object.getOwnPropertyDescriptor(d,x):null;E&&(E.get||E.set)?Object.defineProperty(T,x,E):T[x]=d[x]}return T.default=d,b&&b.set(d,T),T}(K());function a(d){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(a=function(T){return T?b:g})(d)}function u(d,g,b){var T=g[0],O=g[1],x=g[2],E=g[3],P=g[4],M=g[5],I=b[0],R=b[1],V=b[2],j=b[3],Z=b[4],W=b[5];return d[0]=T*I+x*R,d[1]=O*I+E*R,d[2]=T*V+x*j,d[3]=O*V+E*j,d[4]=T*Z+x*W+P,d[5]=O*Z+E*W+M,d}function m(d,g,b){return d[0]=g[0]-b[0],d[1]=g[1]-b[1],d[2]=g[2]-b[2],d[3]=g[3]-b[3],d[4]=g[4]-b[4],d[5]=g[5]-b[5],d}return Ue.mul=u,Ue.sub=m,Ue}var Xe,st={};function Ut(){if(Xe)return st;function c(d){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(d)}Xe=1,Object.defineProperty(st,"__esModule",{value:!0}),st.create=function(){var d=new i.ARRAY_TYPE(9);return i.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,d},st.fromMat4=function(d,g){return d[0]=g[0],d[1]=g[1],d[2]=g[2],d[3]=g[4],d[4]=g[5],d[5]=g[6],d[6]=g[8],d[7]=g[9],d[8]=g[10],d},st.clone=function(d){var g=new i.ARRAY_TYPE(9);return g[0]=d[0],g[1]=d[1],g[2]=d[2],g[3]=d[3],g[4]=d[4],g[5]=d[5],g[6]=d[6],g[7]=d[7],g[8]=d[8],g},st.copy=function(d,g){return d[0]=g[0],d[1]=g[1],d[2]=g[2],d[3]=g[3],d[4]=g[4],d[5]=g[5],d[6]=g[6],d[7]=g[7],d[8]=g[8],d},st.fromValues=function(d,g,b,T,O,x,E,P,M){var I=new i.ARRAY_TYPE(9);return I[0]=d,I[1]=g,I[2]=b,I[3]=T,I[4]=O,I[5]=x,I[6]=E,I[7]=P,I[8]=M,I},st.set=function(d,g,b,T,O,x,E,P,M,I){return d[0]=g,d[1]=b,d[2]=T,d[3]=O,d[4]=x,d[5]=E,d[6]=P,d[7]=M,d[8]=I,d},st.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},st.transpose=function(d,g){if(d===g){var b=g[1],T=g[2],O=g[5];d[1]=g[3],d[2]=g[6],d[3]=b,d[5]=g[7],d[6]=T,d[7]=O}else d[0]=g[0],d[1]=g[3],d[2]=g[6],d[3]=g[1],d[4]=g[4],d[5]=g[7],d[6]=g[2],d[7]=g[5],d[8]=g[8];return d},st.invert=function(d,g){var b=g[0],T=g[1],O=g[2],x=g[3],E=g[4],P=g[5],M=g[6],I=g[7],R=g[8],V=R*E-P*I,j=-R*x+P*M,Z=I*x-E*M,W=b*V+T*j+O*Z;return W?(d[0]=V*(W=1/W),d[1]=(-R*T+O*I)*W,d[2]=(P*T-O*E)*W,d[3]=j*W,d[4]=(R*b-O*M)*W,d[5]=(-P*b+O*x)*W,d[6]=Z*W,d[7]=(-I*b+T*M)*W,d[8]=(E*b-T*x)*W,d):null},st.adjoint=function(d,g){var b=g[0],T=g[1],O=g[2],x=g[3],E=g[4],P=g[5],M=g[6],I=g[7],R=g[8];return d[0]=E*R-P*I,d[1]=O*I-T*R,d[2]=T*P-O*E,d[3]=P*M-x*R,d[4]=b*R-O*M,d[5]=O*x-b*P,d[6]=x*I-E*M,d[7]=T*M-b*I,d[8]=b*E-T*x,d},st.determinant=function(d){var g=d[3],b=d[4],T=d[5],O=d[6],x=d[7],E=d[8];return d[0]*(E*b-T*x)+d[1]*(-E*g+T*O)+d[2]*(x*g-b*O)},st.multiply=u,st.translate=function(d,g,b){var T=g[0],O=g[1],x=g[2],E=g[3],P=g[4],M=g[5],I=g[6],R=g[7],V=g[8],j=b[0],Z=b[1];return d[0]=T,d[1]=O,d[2]=x,d[3]=E,d[4]=P,d[5]=M,d[6]=j*T+Z*E+I,d[7]=j*O+Z*P+R,d[8]=j*x+Z*M+V,d},st.rotate=function(d,g,b){var T=g[0],O=g[1],x=g[2],E=g[3],P=g[4],M=g[5],I=g[6],R=g[7],V=g[8],j=Math.sin(b),Z=Math.cos(b);return d[0]=Z*T+j*E,d[1]=Z*O+j*P,d[2]=Z*x+j*M,d[3]=Z*E-j*T,d[4]=Z*P-j*O,d[5]=Z*M-j*x,d[6]=I,d[7]=R,d[8]=V,d},st.scale=function(d,g,b){var T=b[0],O=b[1];return d[0]=T*g[0],d[1]=T*g[1],d[2]=T*g[2],d[3]=O*g[3],d[4]=O*g[4],d[5]=O*g[5],d[6]=g[6],d[7]=g[7],d[8]=g[8],d},st.fromTranslation=function(d,g){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=g[0],d[7]=g[1],d[8]=1,d},st.fromRotation=function(d,g){var b=Math.sin(g),T=Math.cos(g);return d[0]=T,d[1]=b,d[2]=0,d[3]=-b,d[4]=T,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},st.fromScaling=function(d,g){return d[0]=g[0],d[1]=0,d[2]=0,d[3]=0,d[4]=g[1],d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},st.fromMat2d=function(d,g){return d[0]=g[0],d[1]=g[1],d[2]=0,d[3]=g[2],d[4]=g[3],d[5]=0,d[6]=g[4],d[7]=g[5],d[8]=1,d},st.fromQuat=function(d,g){var b=g[0],T=g[1],O=g[2],x=g[3],E=b+b,P=T+T,M=O+O,I=b*E,R=T*E,V=T*P,j=O*E,Z=O*P,W=O*M,G=x*E,X=x*P,J=x*M;return d[0]=1-V-W,d[3]=R-J,d[6]=j+X,d[1]=R+J,d[4]=1-I-W,d[7]=Z-G,d[2]=j-X,d[5]=Z+G,d[8]=1-I-V,d},st.normalFromMat4=function(d,g){var b=g[0],T=g[1],O=g[2],x=g[3],E=g[4],P=g[5],M=g[6],I=g[7],R=g[8],V=g[9],j=g[10],Z=g[11],W=g[12],G=g[13],X=g[14],J=g[15],te=b*P-T*E,fe=b*M-O*E,de=b*I-x*E,he=T*M-O*P,Ce=T*I-x*P,me=O*I-x*M,Me=R*G-V*W,Oe=R*X-j*W,Pe=R*J-Z*W,ke=V*X-j*G,Ne=V*J-Z*G,Be=j*J-Z*X,Le=te*Be-fe*Ne+de*ke+he*Pe-Ce*Oe+me*Me;return Le?(d[0]=(P*Be-M*Ne+I*ke)*(Le=1/Le),d[1]=(M*Pe-E*Be-I*Oe)*Le,d[2]=(E*Ne-P*Pe+I*Me)*Le,d[3]=(O*Ne-T*Be-x*ke)*Le,d[4]=(b*Be-O*Pe+x*Oe)*Le,d[5]=(T*Pe-b*Ne-x*Me)*Le,d[6]=(G*me-X*Ce+J*he)*Le,d[7]=(X*de-W*me-J*fe)*Le,d[8]=(W*Ce-G*de+J*te)*Le,d):null},st.projection=function(d,g,b){return d[0]=2/g,d[1]=0,d[2]=0,d[3]=0,d[4]=-2/b,d[5]=0,d[6]=-1,d[7]=1,d[8]=1,d},st.str=function(d){return"mat3("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+", "+d[6]+", "+d[7]+", "+d[8]+")"},st.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8])},st.add=function(d,g,b){return d[0]=g[0]+b[0],d[1]=g[1]+b[1],d[2]=g[2]+b[2],d[3]=g[3]+b[3],d[4]=g[4]+b[4],d[5]=g[5]+b[5],d[6]=g[6]+b[6],d[7]=g[7]+b[7],d[8]=g[8]+b[8],d},st.subtract=m,st.multiplyScalar=function(d,g,b){return d[0]=g[0]*b,d[1]=g[1]*b,d[2]=g[2]*b,d[3]=g[3]*b,d[4]=g[4]*b,d[5]=g[5]*b,d[6]=g[6]*b,d[7]=g[7]*b,d[8]=g[8]*b,d},st.multiplyScalarAndAdd=function(d,g,b,T){return d[0]=g[0]+b[0]*T,d[1]=g[1]+b[1]*T,d[2]=g[2]+b[2]*T,d[3]=g[3]+b[3]*T,d[4]=g[4]+b[4]*T,d[5]=g[5]+b[5]*T,d[6]=g[6]+b[6]*T,d[7]=g[7]+b[7]*T,d[8]=g[8]+b[8]*T,d},st.exactEquals=function(d,g){return d[0]===g[0]&&d[1]===g[1]&&d[2]===g[2]&&d[3]===g[3]&&d[4]===g[4]&&d[5]===g[5]&&d[6]===g[6]&&d[7]===g[7]&&d[8]===g[8]},st.equals=function(d,g){var b=d[0],T=d[1],O=d[2],x=d[3],E=d[4],P=d[5],M=d[6],I=d[7],R=d[8],V=g[0],j=g[1],Z=g[2],W=g[3],G=g[4],X=g[5],J=g[6],te=g[7],fe=g[8];return Math.abs(b-V)<=i.EPSILON*Math.max(1,Math.abs(b),Math.abs(V))&&Math.abs(T-j)<=i.EPSILON*Math.max(1,Math.abs(T),Math.abs(j))&&Math.abs(O-Z)<=i.EPSILON*Math.max(1,Math.abs(O),Math.abs(Z))&&Math.abs(x-W)<=i.EPSILON*Math.max(1,Math.abs(x),Math.abs(W))&&Math.abs(E-G)<=i.EPSILON*Math.max(1,Math.abs(E),Math.abs(G))&&Math.abs(P-X)<=i.EPSILON*Math.max(1,Math.abs(P),Math.abs(X))&&Math.abs(M-J)<=i.EPSILON*Math.max(1,Math.abs(M),Math.abs(J))&&Math.abs(I-te)<=i.EPSILON*Math.max(1,Math.abs(I),Math.abs(te))&&Math.abs(R-fe)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(fe))},st.sub=st.mul=void 0;var i=function(d,g){if(d&&d.__esModule)return d;if(d===null||c(d)!=="object"&&typeof d!="function")return{default:d};var b=a(void 0);if(b&&b.has(d))return b.get(d);var T={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in d)if(x!=="default"&&Object.prototype.hasOwnProperty.call(d,x)){var E=O?Object.getOwnPropertyDescriptor(d,x):null;E&&(E.get||E.set)?Object.defineProperty(T,x,E):T[x]=d[x]}return T.default=d,b&&b.set(d,T),T}(K());function a(d){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(a=function(T){return T?b:g})(d)}function u(d,g,b){var T=g[0],O=g[1],x=g[2],E=g[3],P=g[4],M=g[5],I=g[6],R=g[7],V=g[8],j=b[0],Z=b[1],W=b[2],G=b[3],X=b[4],J=b[5],te=b[6],fe=b[7],de=b[8];return d[0]=j*T+Z*E+W*I,d[1]=j*O+Z*P+W*R,d[2]=j*x+Z*M+W*V,d[3]=G*T+X*E+J*I,d[4]=G*O+X*P+J*R,d[5]=G*x+X*M+J*V,d[6]=te*T+fe*E+de*I,d[7]=te*O+fe*P+de*R,d[8]=te*x+fe*M+de*V,d}function m(d,g,b){return d[0]=g[0]-b[0],d[1]=g[1]-b[1],d[2]=g[2]-b[2],d[3]=g[3]-b[3],d[4]=g[4]-b[4],d[5]=g[5]-b[5],d[6]=g[6]-b[6],d[7]=g[7]-b[7],d[8]=g[8]-b[8],d}return st.mul=u,st.sub=m,st}var Bt,xt={};function yt(){if(Bt)return xt;function c(x){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},c(x)}Bt=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.create=function(){var x=new i.ARRAY_TYPE(16);return i.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},xt.clone=function(x){var E=new i.ARRAY_TYPE(16);return E[0]=x[0],E[1]=x[1],E[2]=x[2],E[3]=x[3],E[4]=x[4],E[5]=x[5],E[6]=x[6],E[7]=x[7],E[8]=x[8],E[9]=x[9],E[10]=x[10],E[11]=x[11],E[12]=x[12],E[13]=x[13],E[14]=x[14],E[15]=x[15],E},xt.copy=function(x,E){return x[0]=E[0],x[1]=E[1],x[2]=E[2],x[3]=E[3],x[4]=E[4],x[5]=E[5],x[6]=E[6],x[7]=E[7],x[8]=E[8],x[9]=E[9],x[10]=E[10],x[11]=E[11],x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15],x},xt.fromValues=function(x,E,P,M,I,R,V,j,Z,W,G,X,J,te,fe,de){var he=new i.ARRAY_TYPE(16);return he[0]=x,he[1]=E,he[2]=P,he[3]=M,he[4]=I,he[5]=R,he[6]=V,he[7]=j,he[8]=Z,he[9]=W,he[10]=G,he[11]=X,he[12]=J,he[13]=te,he[14]=fe,he[15]=de,he},xt.set=function(x,E,P,M,I,R,V,j,Z,W,G,X,J,te,fe,de,he){return x[0]=E,x[1]=P,x[2]=M,x[3]=I,x[4]=R,x[5]=V,x[6]=j,x[7]=Z,x[8]=W,x[9]=G,x[10]=X,x[11]=J,x[12]=te,x[13]=fe,x[14]=de,x[15]=he,x},xt.identity=u,xt.transpose=function(x,E){if(x===E){var P=E[1],M=E[2],I=E[3],R=E[6],V=E[7],j=E[11];x[1]=E[4],x[2]=E[8],x[3]=E[12],x[4]=P,x[6]=E[9],x[7]=E[13],x[8]=M,x[9]=R,x[11]=E[14],x[12]=I,x[13]=V,x[14]=j}else x[0]=E[0],x[1]=E[4],x[2]=E[8],x[3]=E[12],x[4]=E[1],x[5]=E[5],x[6]=E[9],x[7]=E[13],x[8]=E[2],x[9]=E[6],x[10]=E[10],x[11]=E[14],x[12]=E[3],x[13]=E[7],x[14]=E[11],x[15]=E[15];return x},xt.invert=function(x,E){var P=E[0],M=E[1],I=E[2],R=E[3],V=E[4],j=E[5],Z=E[6],W=E[7],G=E[8],X=E[9],J=E[10],te=E[11],fe=E[12],de=E[13],he=E[14],Ce=E[15],me=P*j-M*V,Me=P*Z-I*V,Oe=P*W-R*V,Pe=M*Z-I*j,ke=M*W-R*j,Ne=I*W-R*Z,Be=G*de-X*fe,Le=G*he-J*fe,it=G*Ce-te*fe,vt=X*he-J*de,rt=X*Ce-te*de,Rt=J*Ce-te*he,Pt=me*Rt-Me*rt+Oe*vt+Pe*it-ke*Le+Ne*Be;return Pt?(x[0]=(j*Rt-Z*rt+W*vt)*(Pt=1/Pt),x[1]=(I*rt-M*Rt-R*vt)*Pt,x[2]=(de*Ne-he*ke+Ce*Pe)*Pt,x[3]=(J*ke-X*Ne-te*Pe)*Pt,x[4]=(Z*it-V*Rt-W*Le)*Pt,x[5]=(P*Rt-I*it+R*Le)*Pt,x[6]=(he*Oe-fe*Ne-Ce*Me)*Pt,x[7]=(G*Ne-J*Oe+te*Me)*Pt,x[8]=(V*rt-j*it+W*Be)*Pt,x[9]=(M*it-P*rt-R*Be)*Pt,x[10]=(fe*ke-de*Oe+Ce*me)*Pt,x[11]=(X*Oe-G*ke-te*me)*Pt,x[12]=(j*Le-V*vt-Z*Be)*Pt,x[13]=(P*vt-M*Le+I*Be)*Pt,x[14]=(de*Me-fe*Pe-he*me)*Pt,x[15]=(G*Pe-X*Me+J*me)*Pt,x):null},xt.adjoint=function(x,E){var P=E[0],M=E[1],I=E[2],R=E[3],V=E[4],j=E[5],Z=E[6],W=E[7],G=E[8],X=E[9],J=E[10],te=E[11],fe=E[12],de=E[13],he=E[14],Ce=E[15];return x[0]=j*(J*Ce-te*he)-X*(Z*Ce-W*he)+de*(Z*te-W*J),x[1]=-(M*(J*Ce-te*he)-X*(I*Ce-R*he)+de*(I*te-R*J)),x[2]=M*(Z*Ce-W*he)-j*(I*Ce-R*he)+de*(I*W-R*Z),x[3]=-(M*(Z*te-W*J)-j*(I*te-R*J)+X*(I*W-R*Z)),x[4]=-(V*(J*Ce-te*he)-G*(Z*Ce-W*he)+fe*(Z*te-W*J)),x[5]=P*(J*Ce-te*he)-G*(I*Ce-R*he)+fe*(I*te-R*J),x[6]=-(P*(Z*Ce-W*he)-V*(I*Ce-R*he)+fe*(I*W-R*Z)),x[7]=P*(Z*te-W*J)-V*(I*te-R*J)+G*(I*W-R*Z),x[8]=V*(X*Ce-te*de)-G*(j*Ce-W*de)+fe*(j*te-W*X),x[9]=-(P*(X*Ce-te*de)-G*(M*Ce-R*de)+fe*(M*te-R*X)),x[10]=P*(j*Ce-W*de)-V*(M*Ce-R*de)+fe*(M*W-R*j),x[11]=-(P*(j*te-W*X)-V*(M*te-R*X)+G*(M*W-R*j)),x[12]=-(V*(X*he-J*de)-G*(j*he-Z*de)+fe*(j*J-Z*X)),x[13]=P*(X*he-J*de)-G*(M*he-I*de)+fe*(M*J-I*X),x[14]=-(P*(j*he-Z*de)-V*(M*he-I*de)+fe*(M*Z-I*j)),x[15]=P*(j*J-Z*X)-V*(M*J-I*X)+G*(M*Z-I*j),x},xt.determinant=function(x){var E=x[0],P=x[1],M=x[2],I=x[3],R=x[4],V=x[5],j=x[6],Z=x[7],W=x[8],G=x[9],X=x[10],J=x[11],te=x[12],fe=x[13],de=x[14],he=x[15];return(E*V-P*R)*(X*he-J*de)-(E*j-M*R)*(G*he-J*fe)+(E*Z-I*R)*(G*de-X*fe)+(P*j-M*V)*(W*he-J*te)-(P*Z-I*V)*(W*de-X*te)+(M*Z-I*j)*(W*fe-G*te)},xt.multiply=m,xt.translate=function(x,E,P){var M,I,R,V,j,Z,W,G,X,J,te,fe,de=P[0],he=P[1],Ce=P[2];return E===x?(x[12]=E[0]*de+E[4]*he+E[8]*Ce+E[12],x[13]=E[1]*de+E[5]*he+E[9]*Ce+E[13],x[14]=E[2]*de+E[6]*he+E[10]*Ce+E[14],x[15]=E[3]*de+E[7]*he+E[11]*Ce+E[15]):(I=E[1],R=E[2],V=E[3],j=E[4],Z=E[5],W=E[6],G=E[7],X=E[8],J=E[9],te=E[10],fe=E[11],x[0]=M=E[0],x[1]=I,x[2]=R,x[3]=V,x[4]=j,x[5]=Z,x[6]=W,x[7]=G,x[8]=X,x[9]=J,x[10]=te,x[11]=fe,x[12]=M*de+j*he+X*Ce+E[12],x[13]=I*de+Z*he+J*Ce+E[13],x[14]=R*de+W*he+te*Ce+E[14],x[15]=V*de+G*he+fe*Ce+E[15]),x},xt.scale=function(x,E,P){var M=P[0],I=P[1],R=P[2];return x[0]=E[0]*M,x[1]=E[1]*M,x[2]=E[2]*M,x[3]=E[3]*M,x[4]=E[4]*I,x[5]=E[5]*I,x[6]=E[6]*I,x[7]=E[7]*I,x[8]=E[8]*R,x[9]=E[9]*R,x[10]=E[10]*R,x[11]=E[11]*R,x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15],x},xt.rotate=function(x,E,P,M){var I,R,V,j,Z,W,G,X,J,te,fe,de,he,Ce,me,Me,Oe,Pe,ke,Ne,Be,Le,it,vt,rt=M[0],Rt=M[1],Pt=M[2],zt=Math.hypot(rt,Rt,Pt);return zt<i.EPSILON?null:(rt*=zt=1/zt,Rt*=zt,Pt*=zt,I=Math.sin(P),R=Math.cos(P),Z=E[1],W=E[2],G=E[3],J=E[5],te=E[6],fe=E[7],he=E[9],Ce=E[10],me=E[11],Me=rt*rt*(V=1-R)+R,ke=rt*Rt*V-Pt*I,Ne=Rt*Rt*V+R,Be=Pt*Rt*V+rt*I,Le=rt*Pt*V+Rt*I,it=Rt*Pt*V-rt*I,vt=Pt*Pt*V+R,x[0]=(j=E[0])*Me+(X=E[4])*(Oe=Rt*rt*V+Pt*I)+(de=E[8])*(Pe=Pt*rt*V-Rt*I),x[1]=Z*Me+J*Oe+he*Pe,x[2]=W*Me+te*Oe+Ce*Pe,x[3]=G*Me+fe*Oe+me*Pe,x[4]=j*ke+X*Ne+de*Be,x[5]=Z*ke+J*Ne+he*Be,x[6]=W*ke+te*Ne+Ce*Be,x[7]=G*ke+fe*Ne+me*Be,x[8]=j*Le+X*it+de*vt,x[9]=Z*Le+J*it+he*vt,x[10]=W*Le+te*it+Ce*vt,x[11]=G*Le+fe*it+me*vt,E!==x&&(x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15]),x)},xt.rotateX=function(x,E,P){var M=Math.sin(P),I=Math.cos(P),R=E[4],V=E[5],j=E[6],Z=E[7],W=E[8],G=E[9],X=E[10],J=E[11];return E!==x&&(x[0]=E[0],x[1]=E[1],x[2]=E[2],x[3]=E[3],x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15]),x[4]=R*I+W*M,x[5]=V*I+G*M,x[6]=j*I+X*M,x[7]=Z*I+J*M,x[8]=W*I-R*M,x[9]=G*I-V*M,x[10]=X*I-j*M,x[11]=J*I-Z*M,x},xt.rotateY=function(x,E,P){var M=Math.sin(P),I=Math.cos(P),R=E[0],V=E[1],j=E[2],Z=E[3],W=E[8],G=E[9],X=E[10],J=E[11];return E!==x&&(x[4]=E[4],x[5]=E[5],x[6]=E[6],x[7]=E[7],x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15]),x[0]=R*I-W*M,x[1]=V*I-G*M,x[2]=j*I-X*M,x[3]=Z*I-J*M,x[8]=R*M+W*I,x[9]=V*M+G*I,x[10]=j*M+X*I,x[11]=Z*M+J*I,x},xt.rotateZ=function(x,E,P){var M=Math.sin(P),I=Math.cos(P),R=E[0],V=E[1],j=E[2],Z=E[3],W=E[4],G=E[5],X=E[6],J=E[7];return E!==x&&(x[8]=E[8],x[9]=E[9],x[10]=E[10],x[11]=E[11],x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15]),x[0]=R*I+W*M,x[1]=V*I+G*M,x[2]=j*I+X*M,x[3]=Z*I+J*M,x[4]=W*I-R*M,x[5]=G*I-V*M,x[6]=X*I-j*M,x[7]=J*I-Z*M,x},xt.fromTranslation=function(x,E){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=E[0],x[13]=E[1],x[14]=E[2],x[15]=1,x},xt.fromScaling=function(x,E){return x[0]=E[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=E[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=E[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},xt.fromRotation=function(x,E,P){var M,I,R,V=P[0],j=P[1],Z=P[2],W=Math.hypot(V,j,Z);return W<i.EPSILON?null:(V*=W=1/W,j*=W,Z*=W,M=Math.sin(E),I=Math.cos(E),x[0]=V*V*(R=1-I)+I,x[1]=j*V*R+Z*M,x[2]=Z*V*R-j*M,x[3]=0,x[4]=V*j*R-Z*M,x[5]=j*j*R+I,x[6]=Z*j*R+V*M,x[7]=0,x[8]=V*Z*R+j*M,x[9]=j*Z*R-V*M,x[10]=Z*Z*R+I,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},xt.fromXRotation=function(x,E){var P=Math.sin(E),M=Math.cos(E);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=M,x[6]=P,x[7]=0,x[8]=0,x[9]=-P,x[10]=M,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},xt.fromYRotation=function(x,E){var P=Math.sin(E),M=Math.cos(E);return x[0]=M,x[1]=0,x[2]=-P,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=P,x[9]=0,x[10]=M,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},xt.fromZRotation=function(x,E){var P=Math.sin(E),M=Math.cos(E);return x[0]=M,x[1]=P,x[2]=0,x[3]=0,x[4]=-P,x[5]=M,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},xt.fromRotationTranslation=d,xt.fromQuat2=function(x,E){var P=new i.ARRAY_TYPE(3),M=-E[0],I=-E[1],R=-E[2],V=E[3],j=E[4],Z=E[5],W=E[6],G=E[7],X=M*M+I*I+R*R+V*V;return X>0?(P[0]=2*(j*V+G*M+Z*R-W*I)/X,P[1]=2*(Z*V+G*I+W*M-j*R)/X,P[2]=2*(W*V+G*R+j*I-Z*M)/X):(P[0]=2*(j*V+G*M+Z*R-W*I),P[1]=2*(Z*V+G*I+W*M-j*R),P[2]=2*(W*V+G*R+j*I-Z*M)),d(x,E,P),x},xt.getTranslation=function(x,E){return x[0]=E[12],x[1]=E[13],x[2]=E[14],x},xt.getScaling=g,xt.getRotation=function(x,E){var P=new i.ARRAY_TYPE(3);g(P,E);var M=1/P[0],I=1/P[1],R=1/P[2],V=E[0]*M,j=E[1]*I,Z=E[2]*R,W=E[4]*M,G=E[5]*I,X=E[6]*R,J=E[8]*M,te=E[9]*I,fe=E[10]*R,de=V+G+fe,he=0;return de>0?(he=2*Math.sqrt(de+1),x[3]=.25*he,x[0]=(X-te)/he,x[1]=(J-Z)/he,x[2]=(j-W)/he):V>G&&V>fe?(he=2*Math.sqrt(1+V-G-fe),x[3]=(X-te)/he,x[0]=.25*he,x[1]=(j+W)/he,x[2]=(J+Z)/he):G>fe?(he=2*Math.sqrt(1+G-V-fe),x[3]=(J-Z)/he,x[0]=(j+W)/he,x[1]=.25*he,x[2]=(X+te)/he):(he=2*Math.sqrt(1+fe-V-G),x[3]=(j-W)/he,x[0]=(J+Z)/he,x[1]=(X+te)/he,x[2]=.25*he),x},xt.fromRotationTranslationScale=function(x,E,P,M){var I=E[0],R=E[1],V=E[2],j=E[3],Z=I+I,W=R+R,G=V+V,X=I*Z,J=I*W,te=I*G,fe=R*W,de=R*G,he=V*G,Ce=j*Z,me=j*W,Me=j*G,Oe=M[0],Pe=M[1],ke=M[2];return x[0]=(1-(fe+he))*Oe,x[1]=(J+Me)*Oe,x[2]=(te-me)*Oe,x[3]=0,x[4]=(J-Me)*Pe,x[5]=(1-(X+he))*Pe,x[6]=(de+Ce)*Pe,x[7]=0,x[8]=(te+me)*ke,x[9]=(de-Ce)*ke,x[10]=(1-(X+fe))*ke,x[11]=0,x[12]=P[0],x[13]=P[1],x[14]=P[2],x[15]=1,x},xt.fromRotationTranslationScaleOrigin=function(x,E,P,M,I){var R=E[0],V=E[1],j=E[2],Z=E[3],W=R+R,G=V+V,X=j+j,J=R*W,te=R*G,fe=R*X,de=V*G,he=V*X,Ce=j*X,me=Z*W,Me=Z*G,Oe=Z*X,Pe=M[0],ke=M[1],Ne=M[2],Be=I[0],Le=I[1],it=I[2],vt=(1-(de+Ce))*Pe,rt=(te+Oe)*Pe,Rt=(fe-Me)*Pe,Pt=(te-Oe)*ke,zt=(1-(J+Ce))*ke,ct=(he+me)*ke,tn=(fe+Me)*Ne,kt=(he-me)*Ne,Jt=(1-(J+de))*Ne;return x[0]=vt,x[1]=rt,x[2]=Rt,x[3]=0,x[4]=Pt,x[5]=zt,x[6]=ct,x[7]=0,x[8]=tn,x[9]=kt,x[10]=Jt,x[11]=0,x[12]=P[0]+Be-(vt*Be+Pt*Le+tn*it),x[13]=P[1]+Le-(rt*Be+zt*Le+kt*it),x[14]=P[2]+it-(Rt*Be+ct*Le+Jt*it),x[15]=1,x},xt.fromQuat=function(x,E){var P=E[0],M=E[1],I=E[2],R=E[3],V=P+P,j=M+M,Z=I+I,W=P*V,G=M*V,X=M*j,J=I*V,te=I*j,fe=I*Z,de=R*V,he=R*j,Ce=R*Z;return x[0]=1-X-fe,x[1]=G+Ce,x[2]=J-he,x[3]=0,x[4]=G-Ce,x[5]=1-W-fe,x[6]=te+de,x[7]=0,x[8]=J+he,x[9]=te-de,x[10]=1-W-X,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},xt.frustum=function(x,E,P,M,I,R,V){var j=1/(P-E),Z=1/(I-M),W=1/(R-V);return x[0]=2*R*j,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*R*Z,x[6]=0,x[7]=0,x[8]=(P+E)*j,x[9]=(I+M)*Z,x[10]=(V+R)*W,x[11]=-1,x[12]=0,x[13]=0,x[14]=V*R*2*W,x[15]=0,x},xt.perspectiveNO=b,xt.perspectiveZO=function(x,E,P,M,I){var R,V=1/Math.tan(E/2);return x[0]=V/P,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=V,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,I!=null&&I!==1/0?(x[10]=I*(R=1/(M-I)),x[14]=I*M*R):(x[10]=-1,x[14]=-M),x},xt.perspectiveFromFieldOfView=function(x,E,P,M){var I=Math.tan(E.upDegrees*Math.PI/180),R=Math.tan(E.downDegrees*Math.PI/180),V=Math.tan(E.leftDegrees*Math.PI/180),j=Math.tan(E.rightDegrees*Math.PI/180),Z=2/(V+j),W=2/(I+R);return x[0]=Z,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=W,x[6]=0,x[7]=0,x[8]=-(V-j)*Z*.5,x[9]=(I-R)*W*.5,x[10]=M/(P-M),x[11]=-1,x[12]=0,x[13]=0,x[14]=M*P/(P-M),x[15]=0,x},xt.orthoNO=T,xt.orthoZO=function(x,E,P,M,I,R,V){var j=1/(E-P),Z=1/(M-I),W=1/(R-V);return x[0]=-2*j,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*Z,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=W,x[11]=0,x[12]=(E+P)*j,x[13]=(I+M)*Z,x[14]=R*W,x[15]=1,x},xt.lookAt=function(x,E,P,M){var I,R,V,j,Z,W,G,X,J,te,fe=E[0],de=E[1],he=E[2],Ce=M[0],me=M[1],Me=M[2],Oe=P[0],Pe=P[1],ke=P[2];return Math.abs(fe-Oe)<i.EPSILON&&Math.abs(de-Pe)<i.EPSILON&&Math.abs(he-ke)<i.EPSILON?u(x):(G=fe-Oe,X=de-Pe,J=he-ke,I=me*(J*=te=1/Math.hypot(G,X,J))-Me*(X*=te),R=Me*(G*=te)-Ce*J,V=Ce*X-me*G,(te=Math.hypot(I,R,V))?(I*=te=1/te,R*=te,V*=te):(I=0,R=0,V=0),j=X*V-J*R,Z=J*I-G*V,W=G*R-X*I,(te=Math.hypot(j,Z,W))?(j*=te=1/te,Z*=te,W*=te):(j=0,Z=0,W=0),x[0]=I,x[1]=j,x[2]=G,x[3]=0,x[4]=R,x[5]=Z,x[6]=X,x[7]=0,x[8]=V,x[9]=W,x[10]=J,x[11]=0,x[12]=-(I*fe+R*de+V*he),x[13]=-(j*fe+Z*de+W*he),x[14]=-(G*fe+X*de+J*he),x[15]=1,x)},xt.targetTo=function(x,E,P,M){var I=E[0],R=E[1],V=E[2],j=M[0],Z=M[1],W=M[2],G=I-P[0],X=R-P[1],J=V-P[2],te=G*G+X*X+J*J;te>0&&(G*=te=1/Math.sqrt(te),X*=te,J*=te);var fe=Z*J-W*X,de=W*G-j*J,he=j*X-Z*G;return(te=fe*fe+de*de+he*he)>0&&(fe*=te=1/Math.sqrt(te),de*=te,he*=te),x[0]=fe,x[1]=de,x[2]=he,x[3]=0,x[4]=X*he-J*de,x[5]=J*fe-G*he,x[6]=G*de-X*fe,x[7]=0,x[8]=G,x[9]=X,x[10]=J,x[11]=0,x[12]=I,x[13]=R,x[14]=V,x[15]=1,x},xt.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},xt.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},xt.add=function(x,E,P){return x[0]=E[0]+P[0],x[1]=E[1]+P[1],x[2]=E[2]+P[2],x[3]=E[3]+P[3],x[4]=E[4]+P[4],x[5]=E[5]+P[5],x[6]=E[6]+P[6],x[7]=E[7]+P[7],x[8]=E[8]+P[8],x[9]=E[9]+P[9],x[10]=E[10]+P[10],x[11]=E[11]+P[11],x[12]=E[12]+P[12],x[13]=E[13]+P[13],x[14]=E[14]+P[14],x[15]=E[15]+P[15],x},xt.subtract=O,xt.multiplyScalar=function(x,E,P){return x[0]=E[0]*P,x[1]=E[1]*P,x[2]=E[2]*P,x[3]=E[3]*P,x[4]=E[4]*P,x[5]=E[5]*P,x[6]=E[6]*P,x[7]=E[7]*P,x[8]=E[8]*P,x[9]=E[9]*P,x[10]=E[10]*P,x[11]=E[11]*P,x[12]=E[12]*P,x[13]=E[13]*P,x[14]=E[14]*P,x[15]=E[15]*P,x},xt.multiplyScalarAndAdd=function(x,E,P,M){return x[0]=E[0]+P[0]*M,x[1]=E[1]+P[1]*M,x[2]=E[2]+P[2]*M,x[3]=E[3]+P[3]*M,x[4]=E[4]+P[4]*M,x[5]=E[5]+P[5]*M,x[6]=E[6]+P[6]*M,x[7]=E[7]+P[7]*M,x[8]=E[8]+P[8]*M,x[9]=E[9]+P[9]*M,x[10]=E[10]+P[10]*M,x[11]=E[11]+P[11]*M,x[12]=E[12]+P[12]*M,x[13]=E[13]+P[13]*M,x[14]=E[14]+P[14]*M,x[15]=E[15]+P[15]*M,x},xt.exactEquals=function(x,E){return x[0]===E[0]&&x[1]===E[1]&&x[2]===E[2]&&x[3]===E[3]&&x[4]===E[4]&&x[5]===E[5]&&x[6]===E[6]&&x[7]===E[7]&&x[8]===E[8]&&x[9]===E[9]&&x[10]===E[10]&&x[11]===E[11]&&x[12]===E[12]&&x[13]===E[13]&&x[14]===E[14]&&x[15]===E[15]},xt.equals=function(x,E){var P=x[0],M=x[1],I=x[2],R=x[3],V=x[4],j=x[5],Z=x[6],W=x[7],G=x[8],X=x[9],J=x[10],te=x[11],fe=x[12],de=x[13],he=x[14],Ce=x[15],me=E[0],Me=E[1],Oe=E[2],Pe=E[3],ke=E[4],Ne=E[5],Be=E[6],Le=E[7],it=E[8],vt=E[9],rt=E[10],Rt=E[11],Pt=E[12],zt=E[13],ct=E[14],tn=E[15];return Math.abs(P-me)<=i.EPSILON*Math.max(1,Math.abs(P),Math.abs(me))&&Math.abs(M-Me)<=i.EPSILON*Math.max(1,Math.abs(M),Math.abs(Me))&&Math.abs(I-Oe)<=i.EPSILON*Math.max(1,Math.abs(I),Math.abs(Oe))&&Math.abs(R-Pe)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(Pe))&&Math.abs(V-ke)<=i.EPSILON*Math.max(1,Math.abs(V),Math.abs(ke))&&Math.abs(j-Ne)<=i.EPSILON*Math.max(1,Math.abs(j),Math.abs(Ne))&&Math.abs(Z-Be)<=i.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Be))&&Math.abs(W-Le)<=i.EPSILON*Math.max(1,Math.abs(W),Math.abs(Le))&&Math.abs(G-it)<=i.EPSILON*Math.max(1,Math.abs(G),Math.abs(it))&&Math.abs(X-vt)<=i.EPSILON*Math.max(1,Math.abs(X),Math.abs(vt))&&Math.abs(J-rt)<=i.EPSILON*Math.max(1,Math.abs(J),Math.abs(rt))&&Math.abs(te-Rt)<=i.EPSILON*Math.max(1,Math.abs(te),Math.abs(Rt))&&Math.abs(fe-Pt)<=i.EPSILON*Math.max(1,Math.abs(fe),Math.abs(Pt))&&Math.abs(de-zt)<=i.EPSILON*Math.max(1,Math.abs(de),Math.abs(zt))&&Math.abs(he-ct)<=i.EPSILON*Math.max(1,Math.abs(he),Math.abs(ct))&&Math.abs(Ce-tn)<=i.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(tn))},xt.sub=xt.mul=xt.ortho=xt.perspective=void 0;var i=function(x,E){if(x&&x.__esModule)return x;if(x===null||c(x)!=="object"&&typeof x!="function")return{default:x};var P=a(void 0);if(P&&P.has(x))return P.get(x);var M={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in x)if(R!=="default"&&Object.prototype.hasOwnProperty.call(x,R)){var V=I?Object.getOwnPropertyDescriptor(x,R):null;V&&(V.get||V.set)?Object.defineProperty(M,R,V):M[R]=x[R]}return M.default=x,P&&P.set(x,M),M}(K());function a(x){if(typeof WeakMap!="function")return null;var E=new WeakMap,P=new WeakMap;return(a=function(M){return M?P:E})(x)}function u(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function m(x,E,P){var M=E[0],I=E[1],R=E[2],V=E[3],j=E[4],Z=E[5],W=E[6],G=E[7],X=E[8],J=E[9],te=E[10],fe=E[11],de=E[12],he=E[13],Ce=E[14],me=E[15],Me=P[0],Oe=P[1],Pe=P[2],ke=P[3];return x[0]=Me*M+Oe*j+Pe*X+ke*de,x[1]=Me*I+Oe*Z+Pe*J+ke*he,x[2]=Me*R+Oe*W+Pe*te+ke*Ce,x[3]=Me*V+Oe*G+Pe*fe+ke*me,x[4]=(Me=P[4])*M+(Oe=P[5])*j+(Pe=P[6])*X+(ke=P[7])*de,x[5]=Me*I+Oe*Z+Pe*J+ke*he,x[6]=Me*R+Oe*W+Pe*te+ke*Ce,x[7]=Me*V+Oe*G+Pe*fe+ke*me,x[8]=(Me=P[8])*M+(Oe=P[9])*j+(Pe=P[10])*X+(ke=P[11])*de,x[9]=Me*I+Oe*Z+Pe*J+ke*he,x[10]=Me*R+Oe*W+Pe*te+ke*Ce,x[11]=Me*V+Oe*G+Pe*fe+ke*me,x[12]=(Me=P[12])*M+(Oe=P[13])*j+(Pe=P[14])*X+(ke=P[15])*de,x[13]=Me*I+Oe*Z+Pe*J+ke*he,x[14]=Me*R+Oe*W+Pe*te+ke*Ce,x[15]=Me*V+Oe*G+Pe*fe+ke*me,x}function d(x,E,P){var M=E[0],I=E[1],R=E[2],V=E[3],j=M+M,Z=I+I,W=R+R,G=M*j,X=M*Z,J=M*W,te=I*Z,fe=I*W,de=R*W,he=V*j,Ce=V*Z,me=V*W;return x[0]=1-(te+de),x[1]=X+me,x[2]=J-Ce,x[3]=0,x[4]=X-me,x[5]=1-(G+de),x[6]=fe+he,x[7]=0,x[8]=J+Ce,x[9]=fe-he,x[10]=1-(G+te),x[11]=0,x[12]=P[0],x[13]=P[1],x[14]=P[2],x[15]=1,x}function g(x,E){var P=E[4],M=E[5],I=E[6],R=E[8],V=E[9],j=E[10];return x[0]=Math.hypot(E[0],E[1],E[2]),x[1]=Math.hypot(P,M,I),x[2]=Math.hypot(R,V,j),x}function b(x,E,P,M,I){var R,V=1/Math.tan(E/2);return x[0]=V/P,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=V,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,I!=null&&I!==1/0?(x[10]=(I+M)*(R=1/(M-I)),x[14]=2*I*M*R):(x[10]=-1,x[14]=-2*M),x}function T(x,E,P,M,I,R,V){var j=1/(E-P),Z=1/(M-I),W=1/(R-V);return x[0]=-2*j,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*Z,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*W,x[11]=0,x[12]=(E+P)*j,x[13]=(I+M)*Z,x[14]=(V+R)*W,x[15]=1,x}function O(x,E,P){return x[0]=E[0]-P[0],x[1]=E[1]-P[1],x[2]=E[2]-P[2],x[3]=E[3]-P[3],x[4]=E[4]-P[4],x[5]=E[5]-P[5],x[6]=E[6]-P[6],x[7]=E[7]-P[7],x[8]=E[8]-P[8],x[9]=E[9]-P[9],x[10]=E[10]-P[10],x[11]=E[11]-P[11],x[12]=E[12]-P[12],x[13]=E[13]-P[13],x[14]=E[14]-P[14],x[15]=E[15]-P[15],x}return xt.perspective=b,xt.ortho=T,xt.mul=m,xt.sub=O,xt}var rn,Dt={},Tt={};function ri(){if(rn)return Tt;function c(I){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},c(I)}rn=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.create=u,Tt.clone=function(I){var R=new i.ARRAY_TYPE(3);return R[0]=I[0],R[1]=I[1],R[2]=I[2],R},Tt.length=m,Tt.fromValues=function(I,R,V){var j=new i.ARRAY_TYPE(3);return j[0]=I,j[1]=R,j[2]=V,j},Tt.copy=function(I,R){return I[0]=R[0],I[1]=R[1],I[2]=R[2],I},Tt.set=function(I,R,V,j){return I[0]=R,I[1]=V,I[2]=j,I},Tt.add=function(I,R,V){return I[0]=R[0]+V[0],I[1]=R[1]+V[1],I[2]=R[2]+V[2],I},Tt.subtract=d,Tt.multiply=g,Tt.divide=b,Tt.ceil=function(I,R){return I[0]=Math.ceil(R[0]),I[1]=Math.ceil(R[1]),I[2]=Math.ceil(R[2]),I},Tt.floor=function(I,R){return I[0]=Math.floor(R[0]),I[1]=Math.floor(R[1]),I[2]=Math.floor(R[2]),I},Tt.min=function(I,R,V){return I[0]=Math.min(R[0],V[0]),I[1]=Math.min(R[1],V[1]),I[2]=Math.min(R[2],V[2]),I},Tt.max=function(I,R,V){return I[0]=Math.max(R[0],V[0]),I[1]=Math.max(R[1],V[1]),I[2]=Math.max(R[2],V[2]),I},Tt.round=function(I,R){return I[0]=Math.round(R[0]),I[1]=Math.round(R[1]),I[2]=Math.round(R[2]),I},Tt.scale=function(I,R,V){return I[0]=R[0]*V,I[1]=R[1]*V,I[2]=R[2]*V,I},Tt.scaleAndAdd=function(I,R,V,j){return I[0]=R[0]+V[0]*j,I[1]=R[1]+V[1]*j,I[2]=R[2]+V[2]*j,I},Tt.distance=T,Tt.squaredDistance=O,Tt.squaredLength=x,Tt.negate=function(I,R){return I[0]=-R[0],I[1]=-R[1],I[2]=-R[2],I},Tt.inverse=function(I,R){return I[0]=1/R[0],I[1]=1/R[1],I[2]=1/R[2],I},Tt.normalize=function(I,R){var V=R[0],j=R[1],Z=R[2],W=V*V+j*j+Z*Z;return W>0&&(W=1/Math.sqrt(W)),I[0]=R[0]*W,I[1]=R[1]*W,I[2]=R[2]*W,I},Tt.dot=E,Tt.cross=function(I,R,V){var j=R[0],Z=R[1],W=R[2],G=V[0],X=V[1],J=V[2];return I[0]=Z*J-W*X,I[1]=W*G-j*J,I[2]=j*X-Z*G,I},Tt.lerp=function(I,R,V,j){var Z=R[0],W=R[1],G=R[2];return I[0]=Z+j*(V[0]-Z),I[1]=W+j*(V[1]-W),I[2]=G+j*(V[2]-G),I},Tt.hermite=function(I,R,V,j,Z,W){var G=W*W,X=G*(2*W-3)+1,J=G*(W-2)+W,te=G*(W-1),fe=G*(3-2*W);return I[0]=R[0]*X+V[0]*J+j[0]*te+Z[0]*fe,I[1]=R[1]*X+V[1]*J+j[1]*te+Z[1]*fe,I[2]=R[2]*X+V[2]*J+j[2]*te+Z[2]*fe,I},Tt.bezier=function(I,R,V,j,Z,W){var G=1-W,X=G*G,J=W*W,te=X*G,fe=3*W*X,de=3*J*G,he=J*W;return I[0]=R[0]*te+V[0]*fe+j[0]*de+Z[0]*he,I[1]=R[1]*te+V[1]*fe+j[1]*de+Z[1]*he,I[2]=R[2]*te+V[2]*fe+j[2]*de+Z[2]*he,I},Tt.random=function(I,R){R=R||1;var V=2*i.RANDOM()*Math.PI,j=2*i.RANDOM()-1,Z=Math.sqrt(1-j*j)*R;return I[0]=Math.cos(V)*Z,I[1]=Math.sin(V)*Z,I[2]=j*R,I},Tt.transformMat4=function(I,R,V){var j=R[0],Z=R[1],W=R[2],G=V[3]*j+V[7]*Z+V[11]*W+V[15];return I[0]=(V[0]*j+V[4]*Z+V[8]*W+V[12])/(G=G||1),I[1]=(V[1]*j+V[5]*Z+V[9]*W+V[13])/G,I[2]=(V[2]*j+V[6]*Z+V[10]*W+V[14])/G,I},Tt.transformMat3=function(I,R,V){var j=R[0],Z=R[1],W=R[2];return I[0]=j*V[0]+Z*V[3]+W*V[6],I[1]=j*V[1]+Z*V[4]+W*V[7],I[2]=j*V[2]+Z*V[5]+W*V[8],I},Tt.transformQuat=function(I,R,V){var j=V[0],Z=V[1],W=V[2],G=R[0],X=R[1],J=R[2],te=Z*J-W*X,fe=W*G-j*J,de=j*X-Z*G,he=Z*de-W*fe,Ce=W*te-j*de,me=j*fe-Z*te,Me=2*V[3];return fe*=Me,de*=Me,Ce*=2,me*=2,I[0]=G+(te*=Me)+(he*=2),I[1]=X+fe+Ce,I[2]=J+de+me,I},Tt.rotateX=function(I,R,V,j){var Z=[],W=[];return Z[0]=R[0]-V[0],Z[1]=R[1]-V[1],Z[2]=R[2]-V[2],W[0]=Z[0],W[1]=Z[1]*Math.cos(j)-Z[2]*Math.sin(j),W[2]=Z[1]*Math.sin(j)+Z[2]*Math.cos(j),I[0]=W[0]+V[0],I[1]=W[1]+V[1],I[2]=W[2]+V[2],I},Tt.rotateY=function(I,R,V,j){var Z=[],W=[];return Z[0]=R[0]-V[0],Z[1]=R[1]-V[1],Z[2]=R[2]-V[2],W[0]=Z[2]*Math.sin(j)+Z[0]*Math.cos(j),W[1]=Z[1],W[2]=Z[2]*Math.cos(j)-Z[0]*Math.sin(j),I[0]=W[0]+V[0],I[1]=W[1]+V[1],I[2]=W[2]+V[2],I},Tt.rotateZ=function(I,R,V,j){var Z=[],W=[];return Z[0]=R[0]-V[0],Z[1]=R[1]-V[1],Z[2]=R[2]-V[2],W[0]=Z[0]*Math.cos(j)-Z[1]*Math.sin(j),W[1]=Z[0]*Math.sin(j)+Z[1]*Math.cos(j),W[2]=Z[2],I[0]=W[0]+V[0],I[1]=W[1]+V[1],I[2]=W[2]+V[2],I},Tt.angle=function(I,R){var V=I[0],j=I[1],Z=I[2],W=R[0],G=R[1],X=R[2],J=Math.sqrt(V*V+j*j+Z*Z)*Math.sqrt(W*W+G*G+X*X),te=J&&E(I,R)/J;return Math.acos(Math.min(Math.max(te,-1),1))},Tt.zero=function(I){return I[0]=0,I[1]=0,I[2]=0,I},Tt.str=function(I){return"vec3("+I[0]+", "+I[1]+", "+I[2]+")"},Tt.exactEquals=function(I,R){return I[0]===R[0]&&I[1]===R[1]&&I[2]===R[2]},Tt.equals=function(I,R){var V=I[0],j=I[1],Z=I[2],W=R[0],G=R[1],X=R[2];return Math.abs(V-W)<=i.EPSILON*Math.max(1,Math.abs(V),Math.abs(W))&&Math.abs(j-G)<=i.EPSILON*Math.max(1,Math.abs(j),Math.abs(G))&&Math.abs(Z-X)<=i.EPSILON*Math.max(1,Math.abs(Z),Math.abs(X))},Tt.forEach=Tt.sqrLen=Tt.len=Tt.sqrDist=Tt.dist=Tt.div=Tt.mul=Tt.sub=void 0;var i=function(I,R){if(I&&I.__esModule)return I;if(I===null||c(I)!=="object"&&typeof I!="function")return{default:I};var V=a(void 0);if(V&&V.has(I))return V.get(I);var j={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in I)if(W!=="default"&&Object.prototype.hasOwnProperty.call(I,W)){var G=Z?Object.getOwnPropertyDescriptor(I,W):null;G&&(G.get||G.set)?Object.defineProperty(j,W,G):j[W]=I[W]}return j.default=I,V&&V.set(I,j),j}(K());function a(I){if(typeof WeakMap!="function")return null;var R=new WeakMap,V=new WeakMap;return(a=function(j){return j?V:R})(I)}function u(){var I=new i.ARRAY_TYPE(3);return i.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0),I}function m(I){return Math.hypot(I[0],I[1],I[2])}function d(I,R,V){return I[0]=R[0]-V[0],I[1]=R[1]-V[1],I[2]=R[2]-V[2],I}function g(I,R,V){return I[0]=R[0]*V[0],I[1]=R[1]*V[1],I[2]=R[2]*V[2],I}function b(I,R,V){return I[0]=R[0]/V[0],I[1]=R[1]/V[1],I[2]=R[2]/V[2],I}function T(I,R){return Math.hypot(R[0]-I[0],R[1]-I[1],R[2]-I[2])}function O(I,R){var V=R[0]-I[0],j=R[1]-I[1],Z=R[2]-I[2];return V*V+j*j+Z*Z}function x(I){var R=I[0],V=I[1],j=I[2];return R*R+V*V+j*j}function E(I,R){return I[0]*R[0]+I[1]*R[1]+I[2]*R[2]}Tt.sub=d,Tt.mul=g,Tt.div=b,Tt.dist=T,Tt.sqrDist=O,Tt.len=m,Tt.sqrLen=x;var P,M=(P=u(),function(I,R,V,j,Z,W){var G,X;for(R||(R=3),V||(V=0),X=j?Math.min(j*R+V,I.length):I.length,G=V;G<X;G+=R)P[0]=I[G],P[1]=I[G+1],P[2]=I[G+2],Z(P,P,W),I[G]=P[0],I[G+1]=P[1],I[G+2]=P[2];return I});return Tt.forEach=M,Tt}var er,ln,Mt={};function je(){if(er)return Mt;function c(M){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},c(M)}er=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=u,Mt.clone=function(M){var I=new i.ARRAY_TYPE(4);return I[0]=M[0],I[1]=M[1],I[2]=M[2],I[3]=M[3],I},Mt.fromValues=function(M,I,R,V){var j=new i.ARRAY_TYPE(4);return j[0]=M,j[1]=I,j[2]=R,j[3]=V,j},Mt.copy=function(M,I){return M[0]=I[0],M[1]=I[1],M[2]=I[2],M[3]=I[3],M},Mt.set=function(M,I,R,V,j){return M[0]=I,M[1]=R,M[2]=V,M[3]=j,M},Mt.add=function(M,I,R){return M[0]=I[0]+R[0],M[1]=I[1]+R[1],M[2]=I[2]+R[2],M[3]=I[3]+R[3],M},Mt.subtract=m,Mt.multiply=d,Mt.divide=g,Mt.ceil=function(M,I){return M[0]=Math.ceil(I[0]),M[1]=Math.ceil(I[1]),M[2]=Math.ceil(I[2]),M[3]=Math.ceil(I[3]),M},Mt.floor=function(M,I){return M[0]=Math.floor(I[0]),M[1]=Math.floor(I[1]),M[2]=Math.floor(I[2]),M[3]=Math.floor(I[3]),M},Mt.min=function(M,I,R){return M[0]=Math.min(I[0],R[0]),M[1]=Math.min(I[1],R[1]),M[2]=Math.min(I[2],R[2]),M[3]=Math.min(I[3],R[3]),M},Mt.max=function(M,I,R){return M[0]=Math.max(I[0],R[0]),M[1]=Math.max(I[1],R[1]),M[2]=Math.max(I[2],R[2]),M[3]=Math.max(I[3],R[3]),M},Mt.round=function(M,I){return M[0]=Math.round(I[0]),M[1]=Math.round(I[1]),M[2]=Math.round(I[2]),M[3]=Math.round(I[3]),M},Mt.scale=function(M,I,R){return M[0]=I[0]*R,M[1]=I[1]*R,M[2]=I[2]*R,M[3]=I[3]*R,M},Mt.scaleAndAdd=function(M,I,R,V){return M[0]=I[0]+R[0]*V,M[1]=I[1]+R[1]*V,M[2]=I[2]+R[2]*V,M[3]=I[3]+R[3]*V,M},Mt.distance=b,Mt.squaredDistance=T,Mt.length=O,Mt.squaredLength=x,Mt.negate=function(M,I){return M[0]=-I[0],M[1]=-I[1],M[2]=-I[2],M[3]=-I[3],M},Mt.inverse=function(M,I){return M[0]=1/I[0],M[1]=1/I[1],M[2]=1/I[2],M[3]=1/I[3],M},Mt.normalize=function(M,I){var R=I[0],V=I[1],j=I[2],Z=I[3],W=R*R+V*V+j*j+Z*Z;return W>0&&(W=1/Math.sqrt(W)),M[0]=R*W,M[1]=V*W,M[2]=j*W,M[3]=Z*W,M},Mt.dot=function(M,I){return M[0]*I[0]+M[1]*I[1]+M[2]*I[2]+M[3]*I[3]},Mt.cross=function(M,I,R,V){var j=R[0]*V[1]-R[1]*V[0],Z=R[0]*V[2]-R[2]*V[0],W=R[0]*V[3]-R[3]*V[0],G=R[1]*V[2]-R[2]*V[1],X=R[1]*V[3]-R[3]*V[1],J=R[2]*V[3]-R[3]*V[2],te=I[0],fe=I[1],de=I[2],he=I[3];return M[0]=fe*J-de*X+he*G,M[1]=-te*J+de*W-he*Z,M[2]=te*X-fe*W+he*j,M[3]=-te*G+fe*Z-de*j,M},Mt.lerp=function(M,I,R,V){var j=I[0],Z=I[1],W=I[2],G=I[3];return M[0]=j+V*(R[0]-j),M[1]=Z+V*(R[1]-Z),M[2]=W+V*(R[2]-W),M[3]=G+V*(R[3]-G),M},Mt.random=function(M,I){var R,V,j,Z,W,G;I=I||1;do W=(R=2*i.RANDOM()-1)*R+(V=2*i.RANDOM()-1)*V;while(W>=1);do G=(j=2*i.RANDOM()-1)*j+(Z=2*i.RANDOM()-1)*Z;while(G>=1);var X=Math.sqrt((1-W)/G);return M[0]=I*R,M[1]=I*V,M[2]=I*j*X,M[3]=I*Z*X,M},Mt.transformMat4=function(M,I,R){var V=I[0],j=I[1],Z=I[2],W=I[3];return M[0]=R[0]*V+R[4]*j+R[8]*Z+R[12]*W,M[1]=R[1]*V+R[5]*j+R[9]*Z+R[13]*W,M[2]=R[2]*V+R[6]*j+R[10]*Z+R[14]*W,M[3]=R[3]*V+R[7]*j+R[11]*Z+R[15]*W,M},Mt.transformQuat=function(M,I,R){var V=I[0],j=I[1],Z=I[2],W=R[0],G=R[1],X=R[2],J=R[3],te=J*V+G*Z-X*j,fe=J*j+X*V-W*Z,de=J*Z+W*j-G*V,he=-W*V-G*j-X*Z;return M[0]=te*J+he*-W+fe*-X-de*-G,M[1]=fe*J+he*-G+de*-W-te*-X,M[2]=de*J+he*-X+te*-G-fe*-W,M[3]=I[3],M},Mt.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M[3]=0,M},Mt.str=function(M){return"vec4("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+")"},Mt.exactEquals=function(M,I){return M[0]===I[0]&&M[1]===I[1]&&M[2]===I[2]&&M[3]===I[3]},Mt.equals=function(M,I){var R=M[0],V=M[1],j=M[2],Z=M[3],W=I[0],G=I[1],X=I[2],J=I[3];return Math.abs(R-W)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(W))&&Math.abs(V-G)<=i.EPSILON*Math.max(1,Math.abs(V),Math.abs(G))&&Math.abs(j-X)<=i.EPSILON*Math.max(1,Math.abs(j),Math.abs(X))&&Math.abs(Z-J)<=i.EPSILON*Math.max(1,Math.abs(Z),Math.abs(J))},Mt.forEach=Mt.sqrLen=Mt.len=Mt.sqrDist=Mt.dist=Mt.div=Mt.mul=Mt.sub=void 0;var i=function(M,I){if(M&&M.__esModule)return M;if(M===null||c(M)!=="object"&&typeof M!="function")return{default:M};var R=a(void 0);if(R&&R.has(M))return R.get(M);var V={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in M)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(M,Z)){var W=j?Object.getOwnPropertyDescriptor(M,Z):null;W&&(W.get||W.set)?Object.defineProperty(V,Z,W):V[Z]=M[Z]}return V.default=M,R&&R.set(M,V),V}(K());function a(M){if(typeof WeakMap!="function")return null;var I=new WeakMap,R=new WeakMap;return(a=function(V){return V?R:I})(M)}function u(){var M=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0,M[3]=0),M}function m(M,I,R){return M[0]=I[0]-R[0],M[1]=I[1]-R[1],M[2]=I[2]-R[2],M[3]=I[3]-R[3],M}function d(M,I,R){return M[0]=I[0]*R[0],M[1]=I[1]*R[1],M[2]=I[2]*R[2],M[3]=I[3]*R[3],M}function g(M,I,R){return M[0]=I[0]/R[0],M[1]=I[1]/R[1],M[2]=I[2]/R[2],M[3]=I[3]/R[3],M}function b(M,I){return Math.hypot(I[0]-M[0],I[1]-M[1],I[2]-M[2],I[3]-M[3])}function T(M,I){var R=I[0]-M[0],V=I[1]-M[1],j=I[2]-M[2],Z=I[3]-M[3];return R*R+V*V+j*j+Z*Z}function O(M){return Math.hypot(M[0],M[1],M[2],M[3])}function x(M){var I=M[0],R=M[1],V=M[2],j=M[3];return I*I+R*R+V*V+j*j}Mt.sub=m,Mt.mul=d,Mt.div=g,Mt.dist=b,Mt.sqrDist=T,Mt.len=O,Mt.sqrLen=x;var E,P=(E=u(),function(M,I,R,V,j,Z){var W,G;for(I||(I=4),R||(R=0),G=V?Math.min(V*I+R,M.length):M.length,W=R;W<G;W+=I)E[0]=M[W],E[1]=M[W+1],E[2]=M[W+2],E[3]=M[W+3],j(E,E,Z),M[W]=E[0],M[W+1]=E[1],M[W+2]=E[2],M[W+3]=E[3];return M});return Mt.forEach=P,Mt}function At(){if(ln)return Dt;function c(me){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Me){return typeof Me}:function(Me){return Me&&typeof Symbol=="function"&&Me.constructor===Symbol&&Me!==Symbol.prototype?"symbol":typeof Me},c(me)}ln=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.create=b,Dt.identity=function(me){return me[0]=0,me[1]=0,me[2]=0,me[3]=1,me},Dt.setAxisAngle=T,Dt.getAxisAngle=function(me,Me){var Oe=2*Math.acos(Me[3]),Pe=Math.sin(Oe/2);return Pe>i.EPSILON?(me[0]=Me[0]/Pe,me[1]=Me[1]/Pe,me[2]=Me[2]/Pe):(me[0]=1,me[1]=0,me[2]=0),Oe},Dt.getAngle=function(me,Me){var Oe=R(me,Me);return Math.acos(2*Oe*Oe-1)},Dt.multiply=O,Dt.rotateX=function(me,Me,Oe){Oe*=.5;var Pe=Me[0],ke=Me[1],Ne=Me[2],Be=Me[3],Le=Math.sin(Oe),it=Math.cos(Oe);return me[0]=Pe*it+Be*Le,me[1]=ke*it+Ne*Le,me[2]=Ne*it-ke*Le,me[3]=Be*it-Pe*Le,me},Dt.rotateY=function(me,Me,Oe){Oe*=.5;var Pe=Me[0],ke=Me[1],Ne=Me[2],Be=Me[3],Le=Math.sin(Oe),it=Math.cos(Oe);return me[0]=Pe*it-Ne*Le,me[1]=ke*it+Be*Le,me[2]=Ne*it+Pe*Le,me[3]=Be*it-ke*Le,me},Dt.rotateZ=function(me,Me,Oe){Oe*=.5;var Pe=Me[0],ke=Me[1],Ne=Me[2],Be=Me[3],Le=Math.sin(Oe),it=Math.cos(Oe);return me[0]=Pe*it+ke*Le,me[1]=ke*it-Pe*Le,me[2]=Ne*it+Be*Le,me[3]=Be*it-Ne*Le,me},Dt.calculateW=function(me,Me){var Oe=Me[0],Pe=Me[1],ke=Me[2];return me[0]=Oe,me[1]=Pe,me[2]=ke,me[3]=Math.sqrt(Math.abs(1-Oe*Oe-Pe*Pe-ke*ke)),me},Dt.exp=x,Dt.ln=E,Dt.pow=function(me,Me,Oe){return E(me,Me),I(me,me,Oe),x(me,me),me},Dt.slerp=P,Dt.random=function(me){var Me=i.RANDOM(),Oe=i.RANDOM(),Pe=i.RANDOM(),ke=Math.sqrt(1-Me),Ne=Math.sqrt(Me);return me[0]=ke*Math.sin(2*Math.PI*Oe),me[1]=ke*Math.cos(2*Math.PI*Oe),me[2]=Ne*Math.sin(2*Math.PI*Pe),me[3]=Ne*Math.cos(2*Math.PI*Pe),me},Dt.invert=function(me,Me){var Oe=Me[0],Pe=Me[1],ke=Me[2],Ne=Me[3],Be=Oe*Oe+Pe*Pe+ke*ke+Ne*Ne,Le=Be?1/Be:0;return me[0]=-Oe*Le,me[1]=-Pe*Le,me[2]=-ke*Le,me[3]=Ne*Le,me},Dt.conjugate=function(me,Me){return me[0]=-Me[0],me[1]=-Me[1],me[2]=-Me[2],me[3]=Me[3],me},Dt.fromMat3=M,Dt.fromEuler=function(me,Me,Oe,Pe){var ke=.5*Math.PI/180;Me*=ke,Oe*=ke,Pe*=ke;var Ne=Math.sin(Me),Be=Math.cos(Me),Le=Math.sin(Oe),it=Math.cos(Oe),vt=Math.sin(Pe),rt=Math.cos(Pe);return me[0]=Ne*it*rt-Be*Le*vt,me[1]=Be*Le*rt+Ne*it*vt,me[2]=Be*it*vt-Ne*Le*rt,me[3]=Be*it*rt+Ne*Le*vt,me},Dt.str=function(me){return"quat("+me[0]+", "+me[1]+", "+me[2]+", "+me[3]+")"},Dt.setAxes=Dt.sqlerp=Dt.rotationTo=Dt.equals=Dt.exactEquals=Dt.normalize=Dt.sqrLen=Dt.squaredLength=Dt.len=Dt.length=Dt.lerp=Dt.dot=Dt.scale=Dt.mul=Dt.add=Dt.set=Dt.copy=Dt.fromValues=Dt.clone=void 0;var i=g(K()),a=g(Ut()),u=g(ri()),m=g(je());function d(me){if(typeof WeakMap!="function")return null;var Me=new WeakMap,Oe=new WeakMap;return(d=function(Pe){return Pe?Oe:Me})(me)}function g(me,Me){if(me&&me.__esModule)return me;if(me===null||c(me)!=="object"&&typeof me!="function")return{default:me};var Oe=d(Me);if(Oe&&Oe.has(me))return Oe.get(me);var Pe={},ke=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ne in me)if(Ne!=="default"&&Object.prototype.hasOwnProperty.call(me,Ne)){var Be=ke?Object.getOwnPropertyDescriptor(me,Ne):null;Be&&(Be.get||Be.set)?Object.defineProperty(Pe,Ne,Be):Pe[Ne]=me[Ne]}return Pe.default=me,Oe&&Oe.set(me,Pe),Pe}function b(){var me=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(me[0]=0,me[1]=0,me[2]=0),me[3]=1,me}function T(me,Me,Oe){Oe*=.5;var Pe=Math.sin(Oe);return me[0]=Pe*Me[0],me[1]=Pe*Me[1],me[2]=Pe*Me[2],me[3]=Math.cos(Oe),me}function O(me,Me,Oe){var Pe=Me[0],ke=Me[1],Ne=Me[2],Be=Me[3],Le=Oe[0],it=Oe[1],vt=Oe[2],rt=Oe[3];return me[0]=Pe*rt+Be*Le+ke*vt-Ne*it,me[1]=ke*rt+Be*it+Ne*Le-Pe*vt,me[2]=Ne*rt+Be*vt+Pe*it-ke*Le,me[3]=Be*rt-Pe*Le-ke*it-Ne*vt,me}function x(me,Me){var Oe=Me[0],Pe=Me[1],ke=Me[2],Ne=Me[3],Be=Math.sqrt(Oe*Oe+Pe*Pe+ke*ke),Le=Math.exp(Ne),it=Be>0?Le*Math.sin(Be)/Be:0;return me[0]=Oe*it,me[1]=Pe*it,me[2]=ke*it,me[3]=Le*Math.cos(Be),me}function E(me,Me){var Oe=Me[0],Pe=Me[1],ke=Me[2],Ne=Me[3],Be=Math.sqrt(Oe*Oe+Pe*Pe+ke*ke),Le=Be>0?Math.atan2(Be,Ne)/Be:0;return me[0]=Oe*Le,me[1]=Pe*Le,me[2]=ke*Le,me[3]=.5*Math.log(Oe*Oe+Pe*Pe+ke*ke+Ne*Ne),me}function P(me,Me,Oe,Pe){var ke,Ne,Be,Le,it,vt=Me[0],rt=Me[1],Rt=Me[2],Pt=Me[3],zt=Oe[0],ct=Oe[1],tn=Oe[2],kt=Oe[3];return(Ne=vt*zt+rt*ct+Rt*tn+Pt*kt)<0&&(Ne=-Ne,zt=-zt,ct=-ct,tn=-tn,kt=-kt),1-Ne>i.EPSILON?(ke=Math.acos(Ne),Be=Math.sin(ke),Le=Math.sin((1-Pe)*ke)/Be,it=Math.sin(Pe*ke)/Be):(Le=1-Pe,it=Pe),me[0]=Le*vt+it*zt,me[1]=Le*rt+it*ct,me[2]=Le*Rt+it*tn,me[3]=Le*Pt+it*kt,me}function M(me,Me){var Oe,Pe=Me[0]+Me[4]+Me[8];if(Pe>0)Oe=Math.sqrt(Pe+1),me[3]=.5*Oe,me[0]=(Me[5]-Me[7])*(Oe=.5/Oe),me[1]=(Me[6]-Me[2])*Oe,me[2]=(Me[1]-Me[3])*Oe;else{var ke=0;Me[4]>Me[0]&&(ke=1),Me[8]>Me[3*ke+ke]&&(ke=2);var Ne=(ke+1)%3,Be=(ke+2)%3;Oe=Math.sqrt(Me[3*ke+ke]-Me[3*Ne+Ne]-Me[3*Be+Be]+1),me[ke]=.5*Oe,me[3]=(Me[3*Ne+Be]-Me[3*Be+Ne])*(Oe=.5/Oe),me[Ne]=(Me[3*Ne+ke]+Me[3*ke+Ne])*Oe,me[Be]=(Me[3*Be+ke]+Me[3*ke+Be])*Oe}return me}Dt.clone=m.clone,Dt.fromValues=m.fromValues,Dt.copy=m.copy,Dt.set=m.set,Dt.add=m.add,Dt.mul=O;var I=m.scale;Dt.scale=I;var R=m.dot;Dt.dot=R,Dt.lerp=m.lerp;var V=m.length;Dt.length=V,Dt.len=V;var j=m.squaredLength;Dt.squaredLength=j,Dt.sqrLen=j;var Z=m.normalize;Dt.normalize=Z,Dt.exactEquals=m.exactEquals,Dt.equals=m.equals;var W,G,X,J=(W=u.create(),G=u.fromValues(1,0,0),X=u.fromValues(0,1,0),function(me,Me,Oe){var Pe=u.dot(Me,Oe);return Pe<-.999999?(u.cross(W,G,Me),u.len(W)<1e-6&&u.cross(W,X,Me),u.normalize(W,W),T(me,W,Math.PI),me):Pe>.999999?(me[0]=0,me[1]=0,me[2]=0,me[3]=1,me):(u.cross(W,Me,Oe),me[0]=W[0],me[1]=W[1],me[2]=W[2],me[3]=1+Pe,Z(me,me))});Dt.rotationTo=J;var te,fe,de=(te=b(),fe=b(),function(me,Me,Oe,Pe,ke,Ne){return P(te,Me,ke,Ne),P(fe,Oe,Pe,Ne),P(me,te,fe,2*Ne*(1-Ne)),me});Dt.sqlerp=de;var he,Ce=(he=a.create(),function(me,Me,Oe,Pe){return he[0]=Oe[0],he[3]=Oe[1],he[6]=Oe[2],he[1]=Pe[0],he[4]=Pe[1],he[7]=Pe[2],he[2]=-Me[0],he[5]=-Me[1],he[8]=-Me[2],Z(me,M(me,he))});return Dt.setAxes=Ce,Dt}var Ke,mt={};function It(){if(Ke)return mt;function c(P){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(P)}Ke=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=function(){var P=new i.ARRAY_TYPE(8);return i.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0,P[4]=0,P[5]=0,P[6]=0,P[7]=0),P[3]=1,P},mt.clone=function(P){var M=new i.ARRAY_TYPE(8);return M[0]=P[0],M[1]=P[1],M[2]=P[2],M[3]=P[3],M[4]=P[4],M[5]=P[5],M[6]=P[6],M[7]=P[7],M},mt.fromValues=function(P,M,I,R,V,j,Z,W){var G=new i.ARRAY_TYPE(8);return G[0]=P,G[1]=M,G[2]=I,G[3]=R,G[4]=V,G[5]=j,G[6]=Z,G[7]=W,G},mt.fromRotationTranslationValues=function(P,M,I,R,V,j,Z){var W=new i.ARRAY_TYPE(8);W[0]=P,W[1]=M,W[2]=I,W[3]=R;var G=.5*V,X=.5*j,J=.5*Z;return W[4]=G*R+X*I-J*M,W[5]=X*R+J*P-G*I,W[6]=J*R+G*M-X*P,W[7]=-G*P-X*M-J*I,W},mt.fromRotationTranslation=g,mt.fromTranslation=function(P,M){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=.5*M[0],P[5]=.5*M[1],P[6]=.5*M[2],P[7]=0,P},mt.fromRotation=function(P,M){return P[0]=M[0],P[1]=M[1],P[2]=M[2],P[3]=M[3],P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},mt.fromMat4=function(P,M){var I=a.create();u.getRotation(I,M);var R=new i.ARRAY_TYPE(3);return u.getTranslation(R,M),g(P,I,R),P},mt.copy=b,mt.identity=function(P){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},mt.set=function(P,M,I,R,V,j,Z,W,G){return P[0]=M,P[1]=I,P[2]=R,P[3]=V,P[4]=j,P[5]=Z,P[6]=W,P[7]=G,P},mt.getDual=function(P,M){return P[0]=M[4],P[1]=M[5],P[2]=M[6],P[3]=M[7],P},mt.setDual=function(P,M){return P[4]=M[0],P[5]=M[1],P[6]=M[2],P[7]=M[3],P},mt.getTranslation=function(P,M){var I=M[4],R=M[5],V=M[6],j=M[7],Z=-M[0],W=-M[1],G=-M[2],X=M[3];return P[0]=2*(I*X+j*Z+R*G-V*W),P[1]=2*(R*X+j*W+V*Z-I*G),P[2]=2*(V*X+j*G+I*W-R*Z),P},mt.translate=function(P,M,I){var R=M[0],V=M[1],j=M[2],Z=M[3],W=.5*I[0],G=.5*I[1],X=.5*I[2],J=M[4],te=M[5],fe=M[6],de=M[7];return P[0]=R,P[1]=V,P[2]=j,P[3]=Z,P[4]=Z*W+V*X-j*G+J,P[5]=Z*G+j*W-R*X+te,P[6]=Z*X+R*G-V*W+fe,P[7]=-R*W-V*G-j*X+de,P},mt.rotateX=function(P,M,I){var R=-M[0],V=-M[1],j=-M[2],Z=M[3],W=M[4],G=M[5],X=M[6],J=M[7],te=W*Z+J*R+G*j-X*V,fe=G*Z+J*V+X*R-W*j,de=X*Z+J*j+W*V-G*R,he=J*Z-W*R-G*V-X*j;return a.rotateX(P,M,I),P[4]=te*(Z=P[3])+he*(R=P[0])+fe*(j=P[2])-de*(V=P[1]),P[5]=fe*Z+he*V+de*R-te*j,P[6]=de*Z+he*j+te*V-fe*R,P[7]=he*Z-te*R-fe*V-de*j,P},mt.rotateY=function(P,M,I){var R=-M[0],V=-M[1],j=-M[2],Z=M[3],W=M[4],G=M[5],X=M[6],J=M[7],te=W*Z+J*R+G*j-X*V,fe=G*Z+J*V+X*R-W*j,de=X*Z+J*j+W*V-G*R,he=J*Z-W*R-G*V-X*j;return a.rotateY(P,M,I),P[4]=te*(Z=P[3])+he*(R=P[0])+fe*(j=P[2])-de*(V=P[1]),P[5]=fe*Z+he*V+de*R-te*j,P[6]=de*Z+he*j+te*V-fe*R,P[7]=he*Z-te*R-fe*V-de*j,P},mt.rotateZ=function(P,M,I){var R=-M[0],V=-M[1],j=-M[2],Z=M[3],W=M[4],G=M[5],X=M[6],J=M[7],te=W*Z+J*R+G*j-X*V,fe=G*Z+J*V+X*R-W*j,de=X*Z+J*j+W*V-G*R,he=J*Z-W*R-G*V-X*j;return a.rotateZ(P,M,I),P[4]=te*(Z=P[3])+he*(R=P[0])+fe*(j=P[2])-de*(V=P[1]),P[5]=fe*Z+he*V+de*R-te*j,P[6]=de*Z+he*j+te*V-fe*R,P[7]=he*Z-te*R-fe*V-de*j,P},mt.rotateByQuatAppend=function(P,M,I){var R=I[0],V=I[1],j=I[2],Z=I[3],W=M[0],G=M[1],X=M[2],J=M[3];return P[0]=W*Z+J*R+G*j-X*V,P[1]=G*Z+J*V+X*R-W*j,P[2]=X*Z+J*j+W*V-G*R,P[3]=J*Z-W*R-G*V-X*j,P[4]=(W=M[4])*Z+(J=M[7])*R+(G=M[5])*j-(X=M[6])*V,P[5]=G*Z+J*V+X*R-W*j,P[6]=X*Z+J*j+W*V-G*R,P[7]=J*Z-W*R-G*V-X*j,P},mt.rotateByQuatPrepend=function(P,M,I){var R=M[0],V=M[1],j=M[2],Z=M[3],W=I[0],G=I[1],X=I[2],J=I[3];return P[0]=R*J+Z*W+V*X-j*G,P[1]=V*J+Z*G+j*W-R*X,P[2]=j*J+Z*X+R*G-V*W,P[3]=Z*J-R*W-V*G-j*X,P[4]=R*(J=I[7])+Z*(W=I[4])+V*(X=I[6])-j*(G=I[5]),P[5]=V*J+Z*G+j*W-R*X,P[6]=j*J+Z*X+R*G-V*W,P[7]=Z*J-R*W-V*G-j*X,P},mt.rotateAroundAxis=function(P,M,I,R){if(Math.abs(R)<i.EPSILON)return b(P,M);var V=Math.hypot(I[0],I[1],I[2]);R*=.5;var j=Math.sin(R),Z=j*I[0]/V,W=j*I[1]/V,G=j*I[2]/V,X=Math.cos(R),J=M[0],te=M[1],fe=M[2],de=M[3];P[0]=J*X+de*Z+te*G-fe*W,P[1]=te*X+de*W+fe*Z-J*G,P[2]=fe*X+de*G+J*W-te*Z,P[3]=de*X-J*Z-te*W-fe*G;var he=M[4],Ce=M[5],me=M[6],Me=M[7];return P[4]=he*X+Me*Z+Ce*G-me*W,P[5]=Ce*X+Me*W+me*Z-he*G,P[6]=me*X+Me*G+he*W-Ce*Z,P[7]=Me*X-he*Z-Ce*W-me*G,P},mt.add=function(P,M,I){return P[0]=M[0]+I[0],P[1]=M[1]+I[1],P[2]=M[2]+I[2],P[3]=M[3]+I[3],P[4]=M[4]+I[4],P[5]=M[5]+I[5],P[6]=M[6]+I[6],P[7]=M[7]+I[7],P},mt.multiply=T,mt.scale=function(P,M,I){return P[0]=M[0]*I,P[1]=M[1]*I,P[2]=M[2]*I,P[3]=M[3]*I,P[4]=M[4]*I,P[5]=M[5]*I,P[6]=M[6]*I,P[7]=M[7]*I,P},mt.lerp=function(P,M,I,R){var V=1-R;return O(M,I)<0&&(R=-R),P[0]=M[0]*V+I[0]*R,P[1]=M[1]*V+I[1]*R,P[2]=M[2]*V+I[2]*R,P[3]=M[3]*V+I[3]*R,P[4]=M[4]*V+I[4]*R,P[5]=M[5]*V+I[5]*R,P[6]=M[6]*V+I[6]*R,P[7]=M[7]*V+I[7]*R,P},mt.invert=function(P,M){var I=E(M);return P[0]=-M[0]/I,P[1]=-M[1]/I,P[2]=-M[2]/I,P[3]=M[3]/I,P[4]=-M[4]/I,P[5]=-M[5]/I,P[6]=-M[6]/I,P[7]=M[7]/I,P},mt.conjugate=function(P,M){return P[0]=-M[0],P[1]=-M[1],P[2]=-M[2],P[3]=M[3],P[4]=-M[4],P[5]=-M[5],P[6]=-M[6],P[7]=M[7],P},mt.normalize=function(P,M){var I=E(M);if(I>0){I=Math.sqrt(I);var R=M[0]/I,V=M[1]/I,j=M[2]/I,Z=M[3]/I,W=M[4],G=M[5],X=M[6],J=M[7],te=R*W+V*G+j*X+Z*J;P[0]=R,P[1]=V,P[2]=j,P[3]=Z,P[4]=(W-R*te)/I,P[5]=(G-V*te)/I,P[6]=(X-j*te)/I,P[7]=(J-Z*te)/I}return P},mt.str=function(P){return"quat2("+P[0]+", "+P[1]+", "+P[2]+", "+P[3]+", "+P[4]+", "+P[5]+", "+P[6]+", "+P[7]+")"},mt.exactEquals=function(P,M){return P[0]===M[0]&&P[1]===M[1]&&P[2]===M[2]&&P[3]===M[3]&&P[4]===M[4]&&P[5]===M[5]&&P[6]===M[6]&&P[7]===M[7]},mt.equals=function(P,M){var I=P[0],R=P[1],V=P[2],j=P[3],Z=P[4],W=P[5],G=P[6],X=P[7],J=M[0],te=M[1],fe=M[2],de=M[3],he=M[4],Ce=M[5],me=M[6],Me=M[7];return Math.abs(I-J)<=i.EPSILON*Math.max(1,Math.abs(I),Math.abs(J))&&Math.abs(R-te)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(te))&&Math.abs(V-fe)<=i.EPSILON*Math.max(1,Math.abs(V),Math.abs(fe))&&Math.abs(j-de)<=i.EPSILON*Math.max(1,Math.abs(j),Math.abs(de))&&Math.abs(Z-he)<=i.EPSILON*Math.max(1,Math.abs(Z),Math.abs(he))&&Math.abs(W-Ce)<=i.EPSILON*Math.max(1,Math.abs(W),Math.abs(Ce))&&Math.abs(G-me)<=i.EPSILON*Math.max(1,Math.abs(G),Math.abs(me))&&Math.abs(X-Me)<=i.EPSILON*Math.max(1,Math.abs(X),Math.abs(Me))},mt.sqrLen=mt.squaredLength=mt.len=mt.length=mt.dot=mt.mul=mt.setReal=mt.getReal=void 0;var i=d(K()),a=d(At()),u=d(yt());function m(P){if(typeof WeakMap!="function")return null;var M=new WeakMap,I=new WeakMap;return(m=function(R){return R?I:M})(P)}function d(P,M){if(P&&P.__esModule)return P;if(P===null||c(P)!=="object"&&typeof P!="function")return{default:P};var I=m(M);if(I&&I.has(P))return I.get(P);var R={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in P)if(j!=="default"&&Object.prototype.hasOwnProperty.call(P,j)){var Z=V?Object.getOwnPropertyDescriptor(P,j):null;Z&&(Z.get||Z.set)?Object.defineProperty(R,j,Z):R[j]=P[j]}return R.default=P,I&&I.set(P,R),R}function g(P,M,I){var R=.5*I[0],V=.5*I[1],j=.5*I[2],Z=M[0],W=M[1],G=M[2],X=M[3];return P[0]=Z,P[1]=W,P[2]=G,P[3]=X,P[4]=R*X+V*G-j*W,P[5]=V*X+j*Z-R*G,P[6]=j*X+R*W-V*Z,P[7]=-R*Z-V*W-j*G,P}function b(P,M){return P[0]=M[0],P[1]=M[1],P[2]=M[2],P[3]=M[3],P[4]=M[4],P[5]=M[5],P[6]=M[6],P[7]=M[7],P}function T(P,M,I){var R=M[0],V=M[1],j=M[2],Z=M[3],W=I[4],G=I[5],X=I[6],J=I[7],te=M[4],fe=M[5],de=M[6],he=M[7],Ce=I[0],me=I[1],Me=I[2],Oe=I[3];return P[0]=R*Oe+Z*Ce+V*Me-j*me,P[1]=V*Oe+Z*me+j*Ce-R*Me,P[2]=j*Oe+Z*Me+R*me-V*Ce,P[3]=Z*Oe-R*Ce-V*me-j*Me,P[4]=R*J+Z*W+V*X-j*G+te*Oe+he*Ce+fe*Me-de*me,P[5]=V*J+Z*G+j*W-R*X+fe*Oe+he*me+de*Ce-te*Me,P[6]=j*J+Z*X+R*G-V*W+de*Oe+he*Me+te*me-fe*Ce,P[7]=Z*J-R*W-V*G-j*X+he*Oe-te*Ce-fe*me-de*Me,P}mt.getReal=a.copy,mt.setReal=a.copy,mt.mul=T;var O=a.dot;mt.dot=O;var x=a.length;mt.length=x,mt.len=x;var E=a.squaredLength;return mt.squaredLength=E,mt.sqrLen=E,mt}var en,dn,Ft={};function Dn(){if(en)return Ft;function c(M){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},c(M)}en=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.create=u,Ft.clone=function(M){var I=new i.ARRAY_TYPE(2);return I[0]=M[0],I[1]=M[1],I},Ft.fromValues=function(M,I){var R=new i.ARRAY_TYPE(2);return R[0]=M,R[1]=I,R},Ft.copy=function(M,I){return M[0]=I[0],M[1]=I[1],M},Ft.set=function(M,I,R){return M[0]=I,M[1]=R,M},Ft.add=function(M,I,R){return M[0]=I[0]+R[0],M[1]=I[1]+R[1],M},Ft.subtract=m,Ft.multiply=d,Ft.divide=g,Ft.ceil=function(M,I){return M[0]=Math.ceil(I[0]),M[1]=Math.ceil(I[1]),M},Ft.floor=function(M,I){return M[0]=Math.floor(I[0]),M[1]=Math.floor(I[1]),M},Ft.min=function(M,I,R){return M[0]=Math.min(I[0],R[0]),M[1]=Math.min(I[1],R[1]),M},Ft.max=function(M,I,R){return M[0]=Math.max(I[0],R[0]),M[1]=Math.max(I[1],R[1]),M},Ft.round=function(M,I){return M[0]=Math.round(I[0]),M[1]=Math.round(I[1]),M},Ft.scale=function(M,I,R){return M[0]=I[0]*R,M[1]=I[1]*R,M},Ft.scaleAndAdd=function(M,I,R,V){return M[0]=I[0]+R[0]*V,M[1]=I[1]+R[1]*V,M},Ft.distance=b,Ft.squaredDistance=T,Ft.length=O,Ft.squaredLength=x,Ft.negate=function(M,I){return M[0]=-I[0],M[1]=-I[1],M},Ft.inverse=function(M,I){return M[0]=1/I[0],M[1]=1/I[1],M},Ft.normalize=function(M,I){var R=I[0],V=I[1],j=R*R+V*V;return j>0&&(j=1/Math.sqrt(j)),M[0]=I[0]*j,M[1]=I[1]*j,M},Ft.dot=function(M,I){return M[0]*I[0]+M[1]*I[1]},Ft.cross=function(M,I,R){var V=I[0]*R[1]-I[1]*R[0];return M[0]=M[1]=0,M[2]=V,M},Ft.lerp=function(M,I,R,V){var j=I[0],Z=I[1];return M[0]=j+V*(R[0]-j),M[1]=Z+V*(R[1]-Z),M},Ft.random=function(M,I){I=I||1;var R=2*i.RANDOM()*Math.PI;return M[0]=Math.cos(R)*I,M[1]=Math.sin(R)*I,M},Ft.transformMat2=function(M,I,R){var V=I[0],j=I[1];return M[0]=R[0]*V+R[2]*j,M[1]=R[1]*V+R[3]*j,M},Ft.transformMat2d=function(M,I,R){var V=I[0],j=I[1];return M[0]=R[0]*V+R[2]*j+R[4],M[1]=R[1]*V+R[3]*j+R[5],M},Ft.transformMat3=function(M,I,R){var V=I[0],j=I[1];return M[0]=R[0]*V+R[3]*j+R[6],M[1]=R[1]*V+R[4]*j+R[7],M},Ft.transformMat4=function(M,I,R){var V=I[0],j=I[1];return M[0]=R[0]*V+R[4]*j+R[12],M[1]=R[1]*V+R[5]*j+R[13],M},Ft.rotate=function(M,I,R,V){var j=I[0]-R[0],Z=I[1]-R[1],W=Math.sin(V),G=Math.cos(V);return M[0]=j*G-Z*W+R[0],M[1]=j*W+Z*G+R[1],M},Ft.angle=function(M,I){var R=M[0],V=M[1],j=I[0],Z=I[1],W=Math.sqrt(R*R+V*V)*Math.sqrt(j*j+Z*Z);return Math.acos(Math.min(Math.max(W&&(R*j+V*Z)/W,-1),1))},Ft.zero=function(M){return M[0]=0,M[1]=0,M},Ft.str=function(M){return"vec2("+M[0]+", "+M[1]+")"},Ft.exactEquals=function(M,I){return M[0]===I[0]&&M[1]===I[1]},Ft.equals=function(M,I){var R=M[0],V=M[1],j=I[0],Z=I[1];return Math.abs(R-j)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(j))&&Math.abs(V-Z)<=i.EPSILON*Math.max(1,Math.abs(V),Math.abs(Z))},Ft.forEach=Ft.sqrLen=Ft.sqrDist=Ft.dist=Ft.div=Ft.mul=Ft.sub=Ft.len=void 0;var i=function(M,I){if(M&&M.__esModule)return M;if(M===null||c(M)!=="object"&&typeof M!="function")return{default:M};var R=a(void 0);if(R&&R.has(M))return R.get(M);var V={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in M)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(M,Z)){var W=j?Object.getOwnPropertyDescriptor(M,Z):null;W&&(W.get||W.set)?Object.defineProperty(V,Z,W):V[Z]=M[Z]}return V.default=M,R&&R.set(M,V),V}(K());function a(M){if(typeof WeakMap!="function")return null;var I=new WeakMap,R=new WeakMap;return(a=function(V){return V?R:I})(M)}function u(){var M=new i.ARRAY_TYPE(2);return i.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0),M}function m(M,I,R){return M[0]=I[0]-R[0],M[1]=I[1]-R[1],M}function d(M,I,R){return M[0]=I[0]*R[0],M[1]=I[1]*R[1],M}function g(M,I,R){return M[0]=I[0]/R[0],M[1]=I[1]/R[1],M}function b(M,I){return Math.hypot(I[0]-M[0],I[1]-M[1])}function T(M,I){var R=I[0]-M[0],V=I[1]-M[1];return R*R+V*V}function O(M){return Math.hypot(M[0],M[1])}function x(M){var I=M[0],R=M[1];return I*I+R*R}Ft.len=O,Ft.sub=m,Ft.mul=d,Ft.div=g,Ft.dist=b,Ft.sqrDist=T,Ft.sqrLen=x;var E,P=(E=u(),function(M,I,R,V,j,Z){var W,G;for(I||(I=2),R||(R=0),G=V?Math.min(V*I+R,M.length):M.length,W=R;W<G;W+=I)E[0]=M[W],E[1]=M[W+1],j(E,E,Z),M[W]=E[0],M[W+1]=E[1];return M});return Ft.forEach=P,Ft}function An(){if(dn)return F;function c(M){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},c(M)}dn=1,Object.defineProperty(F,"__esModule",{value:!0}),F.vec4=F.vec3=F.vec2=F.quat2=F.quat=F.mat4=F.mat3=F.mat2d=F.mat2=F.glMatrix=void 0;var i=P(K());F.glMatrix=i;var a=P(ae());F.mat2=a;var u=P(ft());F.mat2d=u;var m=P(Ut());F.mat3=m;var d=P(yt());F.mat4=d;var g=P(At());F.quat=g;var b=P(It());F.quat2=b;var T=P(Dn());F.vec2=T;var O=P(ri());F.vec3=O;var x=P(je());function E(M){if(typeof WeakMap!="function")return null;var I=new WeakMap,R=new WeakMap;return(E=function(V){return V?R:I})(M)}function P(M,I){if(M&&M.__esModule)return M;if(M===null||c(M)!=="object"&&typeof M!="function")return{default:M};var R=E(I);if(R&&R.has(M))return R.get(M);var V={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in M)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(M,Z)){var W=j?Object.getOwnPropertyDescriptor(M,Z):null;W&&(W.get||W.set)?Object.defineProperty(V,Z,W):V[Z]=M[Z]}return V.default=M,R&&R.set(M,V),V}return F.vec4=x,F}var _n,qi,mr,gr,Ee=An(),on=function(){if(qi)return _n;function c(i,a,u,m){this.cx=3*i,this.bx=3*(u-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=a,this.p2x=u,this.p2y=m}return qi=1,_n=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,a){if(a===void 0&&(a=1e-6),i<0)return 0;if(i>1)return 1;for(var u=i,m=0;m<8;m++){var d=this.sampleCurveX(u)-i;if(Math.abs(d)<a)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=d/g}var b=0,T=1;for(u=i,m=0;m<20&&(d=this.sampleCurveX(u),!(Math.abs(d-i)<a));m++)i>d?b=u:T=u,u=.5*(T-b)+b;return u},solve:function(i,a){return this.sampleCurveY(this.solveCurveX(i,a))}},_n}(),Zn=w(on);function gi(){if(gr)return mr;function c(i,a){this.x=i,this.y=a}return gr=1,mr=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,a){return this.clone()._rotateAround(i,a)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var a=i.x-this.x,u=i.y-this.y;return a*a+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,a){return Math.atan2(this.x*a-this.y*i,this.x*i+this.y*a)},_matMult:function(i){var a=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=a,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var a=Math.cos(i),u=Math.sin(i),m=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=m,this},_rotateAround:function(i,a){var u=Math.cos(i),m=Math.sin(i),d=a.y+m*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-m*(this.y-a.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(i){return i instanceof c?i:Array.isArray(i)?new c(i[0],i[1]):i},mr}var We=w(gi());function Nr(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(!Nr(c[a],i[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(let a in c)if(!Nr(c[a],i[a]))return!1;return!0}return c===i}let hi=Math.PI/180,zr=180/Math.PI;function Cn(c){return c*hi}function Er(c){return c*zr}let Xo=[[0,0],[1,0],[1,1],[0,1]];function Ya(c){if(c<=0)return 0;if(c>=1)return 1;let i=c*c,a=i*c;return 4*(c<.5?a:3*(c-i)+a-.75)}function Xa(c,i,a,u){let m=new Zn(c,i,a,u);return function(d){return m.solve(d)}}let ec=Xa(.25,.1,.25,1);function Rn(c,i,a){return Math.min(a,Math.max(i,c))}function Gc(c,i,a){return(a=Rn((a-c)/(i-c),0,1))*a*(3-2*a)}function oa(c,i,a){let u=a-i,m=((c-i)%u+u)%u+i;return m===i?a:m}function El(c,i,a){if(!c.length)return a(null,[]);let u=c.length,m=new Array(c.length),d=null;c.forEach((g,b)=>{i(g,(T,O)=>{T&&(d=T),m[b]=O,--u==0&&a(d,m)})})}function Oo(c,...i){for(let a of i)for(let u in a)c[u]=a[u];return c}let Ms=1;function qc(){return Ms++}function Zc(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Wc(c,i){c.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function Da(c,i){return c.indexOf(i,c.length-i.length)!==-1}function Ka(c,i,a){let u={};for(let m in c)u[m]=i.call(this,c[m],m,c);return u}function tc(c,i,a){let u={};for(let m in c)i.call(this,c[m],m,c)&&(u[m]=c[m]);return u}function Ls(c){return Array.isArray(c)?c.map(Ls):typeof c=="object"&&c?Ka(c,Ls):c}let Ja={};function Wn(c){Ja[c]||(typeof console<"u"&&console.warn(c),Ja[c]=!0)}function Oa(c,i,a){return(a.y-c.y)*(i.x-c.x)>(i.y-c.y)*(a.x-c.x)}function Fu(c){let i=0;for(let a,u,m=0,d=c.length,g=d-1;m<d;g=m++)a=c[m],u=c[g],i+=(u.x-a.x)*(a.y+u.y);return i}function Uo([c,i,a]){let u=Cn(i+90),m=Cn(a);return{x:c*Math.cos(u)*Math.sin(m),y:c*Math.sin(u)*Math.sin(m),z:c*Math.cos(m),azimuthal:i,polar:a}}function Sl(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Nu(c){let i={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,m,d)=>{let g=m||d;return i[u]=!g||g.toLowerCase(),""}),i["max-age"]){let a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let zu=null;function Yc(c,i){return[c[4*i],c[4*i+1],c[4*i+2],c[4*i+3]]}function Bu(c,i,a,u){for(;i<a;){let m=i+a>>1;c[m]<u?i=m+1:a=m}return i}function tt(c,i,a,u){for(;i<a;){let m=i+a>>1;c[m]<=u?i=m+1:a=m}return i}function oe(c){return c>0?1/(1.001-c):1+c}function ce(c){return c>0?1-1/(1.001-c):-c}let _e={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!_e.API_URL)return null;try{let c=new URL(_e.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function De(c){return _e.API_URL_REGEX.test(c)}function Se(c){return _e.API_SPRITE_REGEX.test(c)}let Fe,He,Te,Je,nt,ot;function wt(){return Fe==null&&(Fe=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Fe}let Vt={now:()=>Je!==void 0?Je:performance.now(),setNow(c){Je=c},restoreNow(){Je=void 0},frame(c){let i=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(c,i=0){let{width:a,height:u}=c;nt||(nt=document.createElement("canvas"));let m=nt.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(a>nt.width||u>nt.height)&&(nt.width=a,nt.height=u),m.clearRect(-i,-i,a+2*i,u+2*i),m.drawImage(c,0,0,a,u),m.getImageData(-i,-i,a+2*i,u+2*i)},resolveURL:c=>(He||(He=document.createElement("a")),He.href=c,He.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Te==null&&(Te=window.matchMedia("(prefers-reduced-motion: reduce)")),Te.matches)},hasCanvasFingerprintNoise(){if(ot!==void 0)return ot;if(!wt())return ot=!1,!1;let c=new OffscreenCanvas(85,1),i=c.getContext("2d",{willReadFrequently:!0}),a=0;for(let m=0;m<c.width;++m)i.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,i.fillRect(m,0,1,1);let u=i.getImageData(0,0,c.width,c.height);a=0;for(let m=0;m<u.data.length;++m)if(m%4!=3&&a++!==u.data[m])return ot=!0,!0;return ot=!1,!1}};function $t(c,i){let a=c.indexOf("?");if(a<0)return`${c}?${new URLSearchParams(i).toString()}`;let u=new URLSearchParams(c.slice(a));for(let m in i)u.set(m,i[m]);return`${c.slice(0,a)}?${u.toString()}`}function pn(c,i={persistentParams:[]}){let a=c.indexOf("?");if(a<0)return c;let u=new URLSearchParams,m=new URLSearchParams(c.slice(a));for(let g of i.persistentParams){let b=m.get(g);b&&u.set(g,b)}let d=u.toString();return`${c.slice(0,a)}${d.length>0?`?${d}`:""}`}let kn="mapbox-tiles",En=500,Mn=50,ki=["language","worldview","jobid"],vi,Xn;function Oi(){try{return caches}catch{}}function Si(){let c=Oi();c&&vi==null&&(vi=c.open(kn))}let qr=1/0,Ho={supported:!1,testSupport:function(c){!nc&&wo&&(Fs?Vu(c):_o=c)}},_o,wo,nc=!1,Fs=!1,ic=typeof self<"u"?self:{};function Vu(c){let i=c.createTexture();c.bindTexture(c.TEXTURE_2D,i);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,wo),c.isContextLost())return;Ho.supported=!0}catch{}c.deleteTexture(i),nc=!0}ic.document&&(wo=ic.document.createElement("img"),wo.onload=function(){_o&&Vu(_o),_o=null,Fs=!0},wo.onerror=function(){nc=!0,_o=null},wo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Il={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Il);class Pl extends Error{constructor(i,a,u){a===401&&De(u)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Ni=Sl()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,hr=function(c,i){if(!(/^file:/.test(a=c.url)||/^file:/.test(Ni())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,m){let d=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Ni(),referrerPolicy:u.referrerPolicy,signal:d.signal}),b=!1,T=!1,O=(x=g.url).indexOf("sku=")>0&&De(x);var x;u.type==="json"&&g.headers.set("Accept","application/json");let E=(M,I,R)=>{if(T)return;if(M&&M.message!=="SecurityError"&&Wn(M.toString()),I&&R)return P(I);let V=Date.now();fetch(g).then(j=>{if(j.ok){let Z=O?j.clone():null;return P(j,Z,V)}return m(new Pl(j.statusText,j.status,u.url))}).catch(j=>{j.name!=="AbortError"&&m(new Error(`${j.message} ${u.url}`))})},P=(M,I,R)=>{(u.type==="arrayBuffer"?M.arrayBuffer():u.type==="json"?M.json():M.text()).then(V=>{T||(I&&R&&function(j,Z,W){if(Si(),vi==null)return;let G=Nu(Z.headers.get("Cache-Control")||"");if(G["no-store"])return;let X={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((fe,de)=>X.headers.set(de,fe)),G["max-age"]&&X.headers.set("Expires",new Date(W+1e3*G["max-age"]).toUTCString());let J=X.headers.get("Expires");if(!J||new Date(J).getTime()-W<42e4)return;let te=pn(j.url,{persistentParams:ki});if(Z.status===206){let fe=j.headers.get("Range");if(!fe)return;X.status=200,te=$t(te,{range:fe})}(function(fe,de){if(Xn===void 0)try{new Response(new ReadableStream),Xn=!0}catch{Xn=!1}Xn?de(fe.body):fe.blob().then(de)})(Z,fe=>{let de=new Response((he=Z.status)!==200&&he!==404&&[101,103,204,205,304].includes(he)?null:fe,X);var he;Si(),vi?.then(Ce=>Ce.put(te,de)).catch(Ce=>Wn(Ce.message))})}(g,I,R),b=!0,m(null,V,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch(V=>{T||m(new Error(V.message))})};return O?function(M,I){if(Si(),vi==null)return I(null);vi.then(R=>{let V=pn(M.url,{persistentParams:ki}),j=M.headers.get("Range");j&&(V=$t(V,{range:j})),R.match(V).then(Z=>{let W=function(G){if(!G)return!1;let X=new Date(G.headers.get("Expires")||0),J=Nu(G.headers.get("Cache-Control")||"");return X>Date.now()&&!J["no-cache"]}(Z);R.delete(V),W&&R.put(V,Z.clone()),I(null,Z,W)}).catch(I)}).catch(I)}(g,E):E(null,null),{cancel:()=>{T=!0,b||d.abort()}}}(c,i);if(Sl()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,i,void 0,!0)}var a;return function(u,m){let d=new XMLHttpRequest;d.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(let g in u.headers)d.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=u.credentials==="include",d.onerror=()=>{m(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let g=d.response;if(u.type==="json")try{g=JSON.parse(d.response)}catch(b){return m(b)}m(null,g,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else m(new Pl(d.statusText,d.status,u.url))},d.send(u.body),{cancel:()=>d.abort()}}(c,i)},Aa=function(c,i){return hr(Oo(c,{type:"arrayBuffer"}),i)};function Dl(c){let i=document.createElement("a");return i.href=c,i.protocol===location.protocol&&i.host===location.host}let rc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Xc,xi;Xc=[],xi=0;let jr=function(c,i){if(Ho.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),xi>=_e.MAX_PARALLEL_IMAGE_REQUESTS){let d={requestParameters:c,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Xc.push(d),d}xi++;let a=!1,u=()=>{if(!a)for(a=!0,xi--;Xc.length&&xi<_e.MAX_PARALLEL_IMAGE_REQUESTS;){let d=Xc.shift(),{requestParameters:g,callback:b,cancelled:T}=d;T||(d.cancel=jr(g,b).cancel)}},m=Aa(c,(d,g,b,T)=>{u(),d?i(d):g&&(self.createImageBitmap?function(O,x){let E=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(E).then(P=>{x(null,P)}).catch(P=>{x(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(O,x)=>i(O,x,b,T)):function(O,x){let E=new Image;E.onload=()=>{x(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=rc})},E.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let P=new Blob([new Uint8Array(O)],{type:"image/png"});E.src=O.byteLength?URL.createObjectURL(P):rc}(g,(O,x)=>i(O,x,b,T)))});return{cancel:()=>{m.cancel(),u()}}};var ju,$o,Qr,Ns={exports:{}},as={exports:{}},Ko={exports:{}},Zr=function(){if(Qr)return Ns.exports;Qr=1;var c=(ju||(ju=1,as.exports=function(a,u){var m,d,g,b,T,O,x,E;for(d=a.length-(m=3&a.length),g=u,T=3432918353,O=461845907,E=0;E<d;)x=255&a.charCodeAt(E)|(255&a.charCodeAt(++E))<<8|(255&a.charCodeAt(++E))<<16|(255&a.charCodeAt(++E))<<24,++E,g=27492+(65535&(b=5*(65535&(g=(g^=x=(65535&(x=(x=(65535&x)*T+(((x>>>16)*T&65535)<<16)&4294967295)<<15|x>>>17))*O+(((x>>>16)*O&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(x=0,m){case 3:x^=(255&a.charCodeAt(E+2))<<16;case 2:x^=(255&a.charCodeAt(E+1))<<8;case 1:g^=x=(65535&(x=(x=(65535&(x^=255&a.charCodeAt(E)))*T+(((x>>>16)*T&65535)<<16)&4294967295)<<15|x>>>17))*O+(((x>>>16)*O&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),as.exports),i=($o||($o=1,Ko.exports=function(a,u){for(var m,d=a.length,g=u^d,b=0;d>=4;)m=1540483477*(65535&(m=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(m>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),d-=4,++b;switch(d){case 3:g^=(255&a.charCodeAt(b+2))<<16;case 2:g^=(255&a.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),Ko.exports);return Ns.exports=c,Ns.exports.murmur3=c,Ns.exports.murmur2=i,Ns.exports}(),sa=w(Zr);class zs{constructor(i,...a){Oo(this,a[0]||{}),this.type=i}}class Bs extends zs{constructor(i,a={}){super("error",Oo({error:i},a))}}function Kc(c,i,a){a[c]&&a[c].indexOf(i)!==-1||(a[c]=a[c]||[],a[c].push(i))}function oc(c,i,a){if(a&&a[c]){let u=a[c].indexOf(i);u!==-1&&a[c].splice(u,1)}}class Ol{on(i,a){return this._listeners=this._listeners||{},Kc(i,a,this._listeners),this}off(i,a){return oc(i,a,this._listeners),oc(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Kc(i,a,this._oneTimeListeners),this):new Promise(u=>this.once(i,u))}fire(i,a){let u=typeof i=="string"?new zs(i,a):i,m=u.type;if(this.listens(m)){u.target=this;let d=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(let T of d)T.call(this,u);let g=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(let T of g)oc(m,T,this._oneTimeListeners),T.call(this,u);let b=this._eventedParent;b&&(Oo(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(u))}else u instanceof Bs&&console.error(u.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}var ls,sc={},Jc=function(){if(ls)return sc;ls=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(d){return(d=Math.round(d))<0?0:d>255?255:d}function a(d){return i(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function u(d){return(g=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:g>1?1:g;var g}function m(d,g,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?d+(g-d)*b*6:2*b<1?g:3*b<2?d+(g-d)*(2/3-b)*6:d}try{sc.parseCSSColor=function(d){var g,b=d.replace(/ /g,"").toLowerCase();if(b in c)return c[b].slice();if(b[0]==="#")return b.length===4?(g=parseInt(b.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:b.length===7&&(g=parseInt(b.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var T=b.indexOf("("),O=b.indexOf(")");if(T!==-1&&O+1===b.length){var x=b.substr(0,T),E=b.substr(T+1,O-(T+1)).split(","),P=1;switch(x){case"rgba":if(E.length!==4)return null;P=u(E.pop());case"rgb":return E.length!==3?null:[a(E[0]),a(E[1]),a(E[2]),P];case"hsla":if(E.length!==4)return null;P=u(E.pop());case"hsl":if(E.length!==3)return null;var M=(parseFloat(E[0])%360+360)%360/360,I=u(E[1]),R=u(E[2]),V=R<=.5?R*(I+1):R+I-R*I,j=2*R-V;return[i(255*m(j,V,M+1/3)),i(255*m(j,V,M)),i(255*m(j,V,M-1/3)),P];default:return null}}return null}}catch{}return sc}();class oi{constructor(i,a,u,m=1){this.r=i,this.g=a,this.b=u,this.a=m}static parse(i){if(!i)return;if(i instanceof oi)return i;if(typeof i!="string")return;let a=Jc.parseCSSColor(i);return a?new oi(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toStringPremultipliedAlpha(){let[i,a,u,m]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(i)},${Math.round(a)},${Math.round(u)},${m})`}toString(){let[i,a,u,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*a)},${Math.round(255*u)},${m})`}toRenderColor(i){let{r:a,g:u,b:m,a:d}=this;return new jh(i,a,u,m,d)}clone(){return new oi(this.r,this.g,this.b,this.a)}}class jh{constructor(i,a,u,m,d){if(i){let g=i.image.height,b=g*g;a=d===0?0:a/d*(g-1),u=d===0?0:u/d*(g-1),m=d===0?0:m/d*(g-1);let T=Math.floor(a),O=Math.floor(u),x=Math.floor(m),E=Math.ceil(a),P=Math.ceil(u),M=Math.ceil(m),I=a-T,R=u-O,V=m-x,j=i.image.data,Z=4*(T+O*b+x*g),W=4*(T+O*b+M*g),G=4*(T+P*b+x*g),X=4*(T+P*b+M*g),J=4*(E+O*b+x*g),te=4*(E+O*b+M*g),fe=4*(E+P*b+x*g),de=4*(E+P*b+M*g);if(Z<0||de>=j.length)throw new Error("out of range");this.r=gn(gn(gn(j[Z],j[W],V),gn(j[G],j[X],V),R),gn(gn(j[J],j[te],V),gn(j[fe],j[de],V),R),I)/255*d,this.g=gn(gn(gn(j[Z+1],j[W+1],V),gn(j[G+1],j[X+1],V),R),gn(gn(j[J+1],j[te+1],V),gn(j[fe+1],j[de+1],V),R),I)/255*d,this.b=gn(gn(gn(j[Z+2],j[W+2],V),gn(j[G+2],j[X+2],V),R),gn(gn(j[J+2],j[te+2],V),gn(j[fe+2],j[de+2],V),R),I)/255*d,this.a=d}else this.r=a,this.g=u,this.b=m,this.a=d}toArray(){let{r:i,g:a,b:u,a:m}=this;return m===0?[0,0,0,0]:[255*i/m,255*a/m,255*u/m,m]}toHslaArray(){if(this.a===0)return[0,0,0,0];let{r:i,g:a,b:u,a:m}=this,d=Math.min(Math.max(i/m,0),1),g=Math.min(Math.max(a/m,0),1),b=Math.min(Math.max(u/m,0),1),T=Math.min(d,g,b),O=Math.max(d,g,b),x=(T+O)/2;if(T===O)return[0,0,100*x,m];let E=O-T,P=x>.5?E/(2-O-T):E/(O+T),M=0;return O===d?M=(g-b)/E+(g<b?6:0):O===g?M=(b-d)/E+2:O===b&&(M=(d-g)/E+4),M*=60,[Math.min(Math.max(M,0),360),Math.min(Math.max(100*P,0),100),Math.min(Math.max(100*x,0),100),m]}toArray01(){let{r:i,g:a,b:u,a:m}=this;return m===0?[0,0,0,0]:[i/m,a/m,u/m,m]}toArray01Scaled(i){let{r:a,g:u,b:m,a:d}=this;return d===0?[0,0,0]:[a/d*i,u/d*i,m/d*i]}toArray01PremultipliedAlpha(){let{r:i,g:a,b:u,a:m}=this;return[i,a,u,m]}toArray01Linear(){let{r:i,g:a,b:u,a:m}=this;return m===0?[0,0,0,0]:[Math.pow(i/m,2.2),Math.pow(a/m,2.2),Math.pow(u/m,2.2),m]}}function gn(c,i,a){return c*(1-a)+i*a}function Uu(c,i,a){return c.map((u,m)=>gn(u,i[m],a))}oi.black=new oi(0,0,0,1),oi.white=new oi(1,1,1,1),oi.transparent=new oi(0,0,0,0),oi.red=new oi(1,0,0,1),oi.blue=new oi(0,0,1,1);var li=Object.freeze({__proto__:null,array:Uu,color:function(c,i,a){return new oi(gn(c.r,i.r,a),gn(c.g,i.g,a),gn(c.b,i.b,a),gn(c.a,i.a,a))},number:gn});function _i(c,...i){for(let a of i)for(let u in a)c[u]=a[u];return c}class oo extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}class wr{constructor(i,a=[]){this.parent=i,this.bindings={};for(let[u,m]of a)this.bindings[u]=m}concat(i){return new wr(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}let ac={kind:"null"},Yt={kind:"number"},di={kind:"string"},ii={kind:"boolean"},yo={kind:"color"},Qa={kind:"object"},Kn={kind:"value"},vo={kind:"collator"},Jo={kind:"formatted"},Al={kind:"resolvedImage"};function Ao(c,i){return{kind:"array",itemType:c,N:i}}function Wi(c){if(c.kind==="array"){let i=Wi(c.itemType);return typeof c.N=="number"?`array<${i}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${i}>`}return c.kind}let ff=[ac,Yt,di,ii,yo,Jo,Qa,Ao(Kn),Al];function lc(c,i){if(i.kind==="error")return null;if(c.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!lc(c.itemType,i.itemType))&&(typeof c.N!="number"||c.N===i.N))return null}else{if(c.kind===i.kind)return null;if(c.kind==="value"){for(let a of ff)if(!lc(a,i))return null}}return`Expected ${Wi(c)} but found ${Wi(i)} instead.`}function Uh(c,i){return i.some(a=>a.kind===c.kind)}function cc(c,i){return i.some(a=>a==="null"?c===null:a==="array"?Array.isArray(c):a==="object"?c&&!Array.isArray(c)&&typeof c=="object":a===typeof c)}class zi{constructor(i,a,u){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hu{constructor(i,a,u,m,d){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=u,this.fontStack=m,this.textColor=d}}class Sr{constructor(i){this.sections=i}static fromString(i){return new Sr([new Hu(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.namePrimary)}static factory(i){return i instanceof Sr?i:Sr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){let i=["format"];for(let a of this.sections){if(a.image){i.push(["image",a.image.namePrimary]);continue}i.push(a.text);let u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toRenderColor(null).toArray())),i.push(u)}return i}}class cs{constructor(i,a){if(this.id=i,this.options=a||{params:{}},this.options.transform){let{a:u,b:m,c:d,d:g,e:b,f:T}=this.options.transform;this.options.transform=new DOMMatrix([u,m,d,g,b,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(i){return JSON.parse(i).id}static deserializeFromString(i){let a=JSON.parse(i),{a:u,b:m,c:d,d:g,e:b,f:T}=a.options.transform;return new DOMMatrix([u,m,d,g,b,T]),new cs(a.id,a.options)}scaleSelf(i){return this.options.transform=this.options.transform.scale(i),this}serialize(){let i={id:this.id};this.options&&(i.options=this.options);let{a,b:u,c:m,d,e:g,f:b}=this.options.transform;return i.options.transform={a,b:u,c:m,d,e:g,f:b},JSON.stringify(i)}}class so{constructor(i){this.namePrimary=i.namePrimary,i.nameSecondary&&(this.nameSecondary=i.nameSecondary),i.optionsPrimary&&(this.optionsPrimary=i.optionsPrimary),i.optionsSecondary&&(this.optionsSecondary=i.optionsSecondary),this.available=i.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new cs(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new cs(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(i){return typeof i=="string"?so.build(i):i}static build(i,a,u,m){return i?new so({namePrimary:i,nameSecondary:a,optionsPrimary:u,optionsSecondary:m,available:!1}):null}}function uc(c,i,a,u){return typeof c=="number"&&c>=0&&c<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[c,i,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[c,i,a,u]:[c,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function el(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof oi||c instanceof zi||c instanceof Sr||c instanceof so)return!0;if(Array.isArray(c)){for(let i of c)if(!el(i))return!1;return!0}if(typeof c=="object"){for(let i in c)if(!el(c[i]))return!1;return!0}return!1}function dr(c){if(c===null)return ac;if(typeof c=="string")return di;if(typeof c=="boolean")return ii;if(typeof c=="number")return Yt;if(c instanceof oi)return yo;if(c instanceof zi)return vo;if(c instanceof Sr)return Jo;if(c instanceof so)return Al;if(Array.isArray(c)){let i=c.length,a;for(let u of c){let m=dr(u);if(a){if(a===m)continue;a=Kn;break}a=m}return Ao(a||Kn,i)}return Qa}function Vs(c){let i=typeof c;return c===null?"":i==="string"||i==="number"||i==="boolean"?String(c):c instanceof oi?c.toStringPremultipliedAlpha():c instanceof Sr||c instanceof so?c.toString():JSON.stringify(c)}class js{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(i.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!el(i[1]))return a.error("invalid value");let u=i[1],m=dr(u),d=a.expectedType;return m.kind!=="array"||m.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(m=d),new js(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof oi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Sr?this.value.serialize():this.value}}class Ur{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}let hc={string:di,number:Yt,boolean:ii,object:Qa};class Us{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let u,m=1,d=i[0];if(d==="array"){let b,T;if(i.length>2){let O=i[1];if(typeof O!="string"||!(O in hc)||O==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=hc[O],m++}else b=Kn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);T=i[2],m++}u=Ao(b,T)}else u=hc[d];let g=[];for(;m<i.length;m++){let b=a.parse(i[m],m,Kn);if(!b)return null;g.push(b)}return new Us(u,g)}evaluate(i){for(let a=0;a<this.args.length;a++){let u=this.args[a].evaluate(i);if(!lc(this.type,dr(u)))return u;if(a===this.args.length-1)throw new Ur(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Wi(dr(u))} but was expected to be of type ${Wi(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){let i=this.type,a=[i.kind];if(i.kind==="array"){let u=i.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);let m=i.N;(typeof m=="number"||this.args.length>1)&&a.push(m)}}return a.concat(this.args.map(u=>u.serialize()))}}class Ro{constructor(i){this.type=Jo,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let u=i[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");let m=[],d=!1;for(let g=1;g<=i.length-1;++g){let b=i[g];if(d&&typeof b=="object"&&!Array.isArray(b)){d=!1;let T=null;if(b["font-scale"]&&(T=a.parseObjectValue(b["font-scale"],g,"font-scale",Yt),!T))return null;let O=null;if(b["text-font"]&&(O=a.parseObjectValue(b["text-font"],g,"text-font",Ao(di)),!O))return null;let x=null;if(b["text-color"]&&(x=a.parseObjectValue(b["text-color"],g,"text-color",yo),!x))return null;let E=m[m.length-1];E.scale=T,E.font=O,E.textColor=x}else{let T=a.parse(i[g],g,Kn);if(!T)return null;let O=T.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,m.push({content:T,scale:null,font:null,textColor:null})}}return new Ro(m)}evaluate(i){return new Sr(this.sections.map(a=>{let u=a.content.evaluate(i);return dr(u)===Al?new Hu("",u,null,null,null):new Hu(Vs(u),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(let a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){let i=["format"];for(let a of this.sections){i.push(a.content.serialize());let u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),i.push(u)}return i}}class Qc{constructor(i,a,u,m){this._imageWarnHistory={},this.type=Al,this.inputPrimary=i,this.inputSecondary=a,this.inputPrimaryParams=u,this.inputSecondaryParams=m}static parse(i,a){if(i.length<2)return a.error("Expected two or more arguments.");let u=1,m=[];function d(){if(u<i.length){let b=a.parse(i[u],u++,di);return b?(m.push({image:b,options:void 0}),!0):(a.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(u<i.length){if((b=i[u])===null||typeof b!="object"||Array.isArray(b))return!0;let T=i[u].params,O=a.concat(u);if(!T)return u++,!0;if(typeof T!="object"||T.constructor!==Object)return O.error('Image options "params" should be an object'),!1;let x={},E=O.concat(void 0,"params");for(let P in T){if(!P)return E.error("Image parameter name should be non-empty"),!1;let M=E.concat(void 0,P).parse(T[P],void 0,yo,void 0,{typeAnnotation:"coerce"});if(!M)return!1;x[P]=M}return m[m.length-1].options=x,u++,!0}var b;return!0}for(let b=0;b<2;b++)if(!d()||!g())return;return new Qc(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(i,a){let u={};if(a){for(let m in a)if(a[m])try{let d=a[m].evaluate(i),g=`Ignoring image parameter "${m}" with semi-transparent color ${d.toString()}`;if(d.a!==1){this._imageWarnHistory[g]||(console.warn(g),this._imageWarnHistory[g]=!0);continue}u[m]=d}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(i){let a=so.build(this.inputPrimary.evaluate(i),this.inputSecondary?this.inputSecondary.evaluate(i):void 0,this.inputPrimaryParams?this.evaluateParams(i,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(i,this.inputSecondaryParams):void 0);return a&&i.availableImages&&(a.available=i.availableImages.indexOf(a.namePrimary)>-1,a.nameSecondary&&a.available&&i.availableImages&&(a.available=i.availableImages.indexOf(a.nameSecondary)>-1)),a}eachChild(i){if(i(this.inputPrimary),this.inputPrimaryParams)for(let a in this.inputPrimaryParams)this.inputPrimaryParams[a]&&i(this.inputPrimaryParams[a]);if(this.inputSecondary&&(i(this.inputSecondary),this.inputSecondaryParams))for(let a in this.inputSecondaryParams)this.inputSecondaryParams[a]&&i(this.inputSecondaryParams[a])}outputDefined(){return!1}serializeParams(i){let a={};if(i){for(let u in i)i[u]&&(a[u]=i[u].serialize());return{params:a}}}serialize(){let i=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&i.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(i.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&i.push(this.serializeParams(this.inputSecondaryParams))),i}}function Rl(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}let kl={"to-boolean":ii,"to-color":yo,"to-number":Yt,"to-string":di};class Ra{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let u=i[0],m=[],d=ac;if(u==="to-array"){if(!Array.isArray(i[1]))return null;let g=i[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);d=Ao(a.expectedType.itemType,g)}else{if(!(g>0&&el(i[1][0])))return null;d=Ao(dr(i[1][0]),g)}for(let b=0;b<g;b++){let T=i[1][b],O;if(Rl(T)==="array")O=a.parse(T,void 0,d.itemType);else{let x=Rl(T);if(x!==d.itemType.kind)return a.error(`Expected ${d.itemType.kind} but found ${x}.`);O=a.registry.literal.parse(["literal",T===void 0?null:T],a)}if(!O)return null;m.push(O)}}else{if((u==="to-boolean"||u==="to-string")&&i.length!==2)return a.error("Expected one argument.");d=kl[u];for(let g=1;g<i.length;g++){let b=a.parse(i[g],g,Kn);if(!b)return null;m.push(b)}}return new Ra(d,m)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let a,u;for(let m of this.args){if(a=m.evaluate(i),u=null,a instanceof oi)return a;if(typeof a=="string"){let d=i.parseColor(a);if(d)return d}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:uc(a[0],a[1],a[2],a[3]),!u))return new oi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ur(u||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(let u of this.args){if(a=u.evaluate(i),a===null)return 0;let m=Number(a);if(!isNaN(m))return m}throw new Ur(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Sr.fromString(Vs(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?so.build(Vs(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(a=>a.evaluate(i)):Vs(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ro([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Qc(this.args[0]).serialize();let i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}let pf=["Unknown","Point","LineString","Polygon"];class eu{constructor(i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?pf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let i=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:u,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*a-i[0])+this.featureDistanceData.bearing[1]*(m*a-i[1])}return 0}parseColor(i){let a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=oi.parse(i)),a}getConfig(i){return this.options?this.options.get(i):null}}class us{constructor(i,a,u,m,d){this.name=i,this.type=a,this._evaluate=u,this.args=m,this._overloadIndex=d}evaluate(i){if(!this._evaluate){let a=us.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){let u=i[0],m=us.definitions[u];if(!m)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);let d=Array.isArray(m)?m[0]:m.type,g=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,b=[],T=null,O=-1;for(let[x,E]of g){if(Array.isArray(x)&&x.length!==i.length-1)continue;b.push(x),O++,T=new ha(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);let P=[],M=!1;for(let I=1;I<i.length;I++){let R=i[I],V=Array.isArray(x)?x[I-1]:x.type,j=T.parse(R,1+P.length,V);if(!j){M=!0;break}P.push(j)}if(!M)if(Array.isArray(x)&&x.length!==P.length)T.error(`Expected ${x.length} arguments, but found ${P.length} instead.`);else{for(let I=0;I<P.length;I++){let R=Array.isArray(x)?x[I]:x.type,V=P[I];T.concat(I+1).checkSubtype(R,V.type)}if(T.errors.length===0)return new us(u,d,E,P,O)}}if(b.length===1)a.errors.push(...T.errors);else{let x=(b.length?b:g.map(([P])=>P)).map($u).join(" | "),E=[];for(let P=1;P<i.length;P++){let M=a.parse(i[P],1+E.length);if(!M)return null;E.push(Wi(M.type))}a.error(`Expected arguments of type ${x}, but found (${E.join(", ")}) instead.`)}return null}static register(i,a){us.definitions=a;for(let u in a)i[u]=us}}function $u(c){return Array.isArray(c)?`(${c.map(Wi).join(", ")})`:`(${Wi(c.type)}...)`}class Gu{constructor(i,a,u){this.type=vo,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(i.length!==2)return a.error("Expected one argument.");let u=i[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");let m=u["case-sensitive"]===void 0?a.parse(!1,1,ii):a.parseObjectValue(u["case-sensitive"],1,"case-sensitive",ii);if(!m)return null;let d=u["diacritic-sensitive"]===void 0?a.parse(!1,1,ii):a.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",ii);if(!d)return null;let g=null;return u.locale&&(g=a.parseObjectValue(u.locale,1,"locale",di),!g)?null:new Gu(m,d,g)}evaluate(i){return new zi(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){let i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function $p(c,i,a=0,u=c.length-1,m=mf){for(;u>a;){if(u-a>600){let T=u-a+1,O=i-a+1,x=Math.log(T),E=.5*Math.exp(2*x/3),P=.5*Math.sqrt(x*E*(T-E)/T)*(O-T/2<0?-1:1);$p(c,i,Math.max(a,Math.floor(i-O*E/T+P)),Math.min(u,Math.floor(i+(T-O)*E/T+P)),m)}let d=c[i],g=a,b=u;for(qu(c,a,i),m(c[u],d)>0&&qu(c,a,u);g<b;){for(qu(c,g,b),g++,b--;m(c[g],d)<0;)g++;for(;m(c[b],d)>0;)b--}m(c[a],d)===0?qu(c,a,b):(b++,qu(c,b,u)),b<=i&&(a=b+1),i<=b&&(u=b-1)}}function qu(c,i,a){let u=c[i];c[i]=c[a],c[a]=u}function mf(c,i){return c<i?-1:c>i?1:0}function c_(c){let i=0;for(let a,u,m=0,d=c.length,g=d-1;m<d;g=m++)a=c[m],u=c[g],i+=(u.x-a.x)*(a.y+u.y);return i}function tu(c,i){c[0]=Math.min(c[0],i[0]),c[1]=Math.min(c[1],i[1]),c[2]=Math.max(c[2],i[0]),c[3]=Math.max(c[3],i[1])}function nu(c,i){return!(c[0]<=i[0]||c[2]>=i[2]||c[1]<=i[1]||c[3]>=i[3])}function Zu(c,i,a){let u=c[0]-i[0],m=c[1]-i[1],d=c[0]-a[0],g=c[1]-a[1];return u*g-d*m==0&&u*d<=0&&m*g<=0}function Fo(c,i,a=!1){let u=!1;for(let b=0,T=i.length;b<T;b++){let O=i[b];for(let x=0,E=O.length,P=E-1;x<E;P=x++){let M=O[P],I=O[x];if(Zu(c,M,I))return a;(d=M)[1]>(m=c)[1]!=(g=I)[1]>m[1]&&m[0]<(g[0]-d[0])*(m[1]-d[1])/(g[1]-d[1])+d[0]&&(u=!u)}}var m,d,g;return u}function Gp(c,i,a,u){let m=u[0]-a[0],d=u[1]-a[1],g=(c[0]-a[0])*d-m*(c[1]-a[1]),b=(i[0]-a[0])*d-m*(i[1]-a[1]);return g>0&&b<0||g<0&&b>0}function Ll(c,i,a,u){return(m=[u[0]-a[0],u[1]-a[1]])[0]*(d=[i[0]-c[0],i[1]-c[1]])[1]-m[1]*d[0]!=0&&!(!Gp(c,i,a,u)||!Gp(a,u,c,i));var m,d}let ao=8192;function qp(c,i){let a=(180+c[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,m=Math.pow(2,i.z);return[Math.round(a*m*ao),Math.round(u*m*ao)]}function Zp(c,i){for(let a=0;a<i.length;a++)if(Fo(c,i[a]))return!0;return!1}function u_(c,i,a){for(let u of a)for(let m=0,d=u.length,g=d-1;m<d;g=m++)if(Ll(c,i,u[g],u[m]))return!0;return!1}function Hh(c,i){for(let a=0;a<c.length;++a)if(!Fo(c[a],i))return!1;for(let a=0;a<c.length-1;++a)if(u_(c[a],c[a+1],i))return!1;return!0}function Fl(c,i){for(let a=0;a<i.length;a++)if(Hh(c,i[a]))return!0;return!1}function $n(c,i,a){let u=[];for(let m=0;m<c.length;m++){let d=[];for(let g=0;g<c[m].length;g++){let b=qp(c[m][g],a);tu(i,b),d.push(b)}u.push(d)}return u}function an(c,i,a){let u=[];for(let m=0;m<c.length;m++){let d=$n(c[m],i,a);u.push(d)}return u}function Wu(c,i,a,u){if(c[0]<a[0]||c[0]>a[2]){let m=.5*u,d=c[0]-a[0]>m?-u:a[0]-c[0]>m?u:0;d===0&&(d=c[0]-a[2]>m?-u:a[2]-c[0]>m?u:0),c[0]+=d}tu(i,c)}function Sn(c,i,a,u){let m=Math.pow(2,u.z)*ao,d=[u.x*ao,u.y*ao],g=[];if(!c)return g;for(let b of c)for(let T of b){let O=[T.x+d[0],T.y+d[1]];Wu(O,i,a,m),g.push(O)}return g}function hs(c,i,a,u){let m=Math.pow(2,u.z)*ao,d=[u.x*ao,u.y*ao],g=[];if(!c)return g;for(let T of c){let O=[];for(let x of T){let E=[x.x+d[0],x.y+d[1]];tu(i,E),O.push(E)}g.push(O)}if(i[2]-i[0]<=m/2){(b=i)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(let T of g)for(let O of T)Wu(O,i,a,m)}var b;return g}class ds{constructor(i,a){this.type=ii,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(el(i[1])){let u=i[1];if(u.type==="FeatureCollection")for(let m=0;m<u.features.length;++m){let d=u.features[m].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ds(u,u.features[m].geometry)}else if(u.type==="Feature"){let m=u.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ds(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new ds(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(a,u){let m=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(!g)return!1;if(u.type==="Polygon"){let b=$n(u.coordinates,d,g),T=Sn(a.geometry(),m,d,g);if(!nu(m,d))return!1;for(let O of T)if(!Fo(O,b))return!1}if(u.type==="MultiPolygon"){let b=an(u.coordinates,d,g),T=Sn(a.geometry(),m,d,g);if(!nu(m,d))return!1;for(let O of T)if(!Zp(O,b))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(a,u){let m=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(!g)return!1;if(u.type==="Polygon"){let b=$n(u.coordinates,d,g),T=hs(a.geometry(),m,d,g);if(!nu(m,d))return!1;for(let O of T)if(!Hh(O,b))return!1}if(u.type==="MultiPolygon"){let b=an(u.coordinates,d,g),T=hs(a.geometry(),m,d,g);if(!nu(m,d))return!1;for(let O of T)if(!Fl(O,b))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let yn={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},aa=1/298.257223563,$h=aa*(2-aa),la=Math.PI/180;class iu{static fromTile(i,a,u){let m=Math.PI*(1-2*(i+.5)/Math.pow(2,a)),d=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/la;return new iu(d,u)}static get units(){return yn}constructor(i,a){if(i===void 0)throw new Error("No latitude given.");if(a&&!yn[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(yn).join(", ")}`);let u=6378.137*la*(a?yn[a]:1),m=Math.cos(i*la),d=1/(1-$h*(1-m*m)),g=Math.sqrt(d);this.kx=u*g*m,this.ky=u*g*d*(1-$h)}distance(i,a){let u=No(i[0]-a[0])*this.kx,m=(i[1]-a[1])*this.ky;return Math.sqrt(u*u+m*m)}bearing(i,a){let u=No(a[0]-i[0])*this.kx;return Math.atan2(u,(a[1]-i[1])*this.ky)/la}destination(i,a,u){let m=u*la;return this.offset(i,Math.sin(m)*a,Math.cos(m)*a)}offset(i,a,u){return[i[0]+a/this.kx,i[1]+u/this.ky]}lineDistance(i){let a=0;for(let u=0;u<i.length-1;u++)a+=this.distance(i[u],i[u+1]);return a}area(i){let a=0;for(let u=0;u<i.length;u++){let m=i[u];for(let d=0,g=m.length,b=g-1;d<g;b=d++)a+=No(m[d][0]-m[b][0])*(m[d][1]+m[b][1])*(u?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(i,a){let u=0;if(a<=0)return i[0];for(let m=0;m<i.length-1;m++){let d=i[m],g=i[m+1],b=this.distance(d,g);if(u+=b,u>a)return Co(d,g,(a-(u-b))/b)}return i[i.length-1]}pointToSegmentDistance(i,a,u){let[m,d]=a,g=No(u[0]-m)*this.kx,b=(u[1]-d)*this.ky;if(g!==0||b!==0){let T=(No(i[0]-m)*this.kx*g+(i[1]-d)*this.ky*b)/(g*g+b*b);T>1?(m=u[0],d=u[1]):T>0&&(m+=g/this.kx*T,d+=b/this.ky*T)}return g=No(i[0]-m)*this.kx,b=(i[1]-d)*this.ky,Math.sqrt(g*g+b*b)}pointOnLine(i,a){let u=1/0,m=i[0][0],d=i[0][1],g=0,b=0;for(let T=0;T<i.length-1;T++){let O=i[T][0],x=i[T][1],E=No(i[T+1][0]-O)*this.kx,P=(i[T+1][1]-x)*this.ky,M=0;E===0&&P===0||(M=(No(a[0]-O)*this.kx*E+(a[1]-x)*this.ky*P)/(E*E+P*P),M>1?(O=i[T+1][0],x=i[T+1][1]):M>0&&(O+=E/this.kx*M,x+=P/this.ky*M)),E=No(a[0]-O)*this.kx,P=(a[1]-x)*this.ky;let I=E*E+P*P;I<u&&(u=I,m=O,d=x,g=T,b=M)}return{point:[m,d],index:g,t:Math.max(0,Math.min(1,b))}}lineSlice(i,a,u){let m=this.pointOnLine(u,i),d=this.pointOnLine(u,a);if(m.index>d.index||m.index===d.index&&m.t>d.t){let O=m;m=d,d=O}let g=[m.point],b=m.index+1,T=d.index;!tl(u[b],g[0])&&b<=T&&g.push(u[b]);for(let O=b+1;O<=T;O++)g.push(u[O]);return tl(u[T],d.point)||g.push(d.point),g}lineSliceAlong(i,a,u){let m=0,d=[];for(let g=0;g<u.length-1;g++){let b=u[g],T=u[g+1],O=this.distance(b,T);if(m+=O,m>i&&d.length===0&&d.push(Co(b,T,(i-(m-O))/O)),m>=a)return d.push(Co(b,T,(a-(m-O))/O)),d;m>i&&d.push(T)}return d}bufferPoint(i,a){let u=a/this.ky,m=a/this.kx;return[i[0]-m,i[1]-u,i[0]+m,i[1]+u]}bufferBBox(i,a){let u=a/this.ky,m=a/this.kx;return[i[0]-m,i[1]-u,i[2]+m,i[3]+u]}insideBBox(i,a){return No(i[0]-a[0])>=0&&No(i[0]-a[2])<=0&&i[1]>=a[1]&&i[1]<=a[3]}}function tl(c,i){return c[0]===i[0]&&c[1]===i[1]}function Co(c,i,a){let u=No(i[0]-c[0]);return[c[0]+u*a,c[1]+(i[1]-c[1])*a]}function No(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class Gh{constructor(i=[],a=(u,m)=>u<m?-1:u>m?1:0){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;let i=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:a,compare:u}=this,m=a[i];for(;i>0;){let d=i-1>>1,g=a[d];if(u(m,g)>=0)break;a[i]=g,i=d}a[i]=m}_down(i){let{data:a,compare:u}=this,m=this.length>>1,d=a[i];for(;i<m;){let g=1+(i<<1),b=g+1;if(b<this.length&&u(a[b],a[g])<0&&(g=b),u(a[g],d)>=0)break;a[i]=a[g],i=g}a[i]=d}}var Ot=8192;function dc(c,i){return i.dist-c.dist}let nl=100,xo=50;function Wp(c){let i=[1/0,1/0,-1/0,-1/0];if(i.length!==c.length)return!1;for(let a=0;a<i.length;a++)if(i[a]!==c[a])return!1;return!0}function Hs(c){return c[1]-c[0]+1}function il(c,i){let a=c[1]>=c[0]&&c[1]<i;return a||console.warn("Distance Expression: Index is out of range"),a}function ca(c,i){if(c[0]>c[1])return[null,null];let a=Hs(c);if(i){if(a===2)return[c,null];let u=Math.floor(a/2);return[[c[0],c[0]+u],[c[0]+u,c[1]]]}{if(a===1)return[c,null];let u=Math.floor(a/2)-1;return[[c[0],c[0]+u],[c[0]+u+1,c[1]]]}}function Nl(c,i){let a=[1/0,1/0,-1/0,-1/0];if(!il(i,c.length))return a;for(let u=i[0];u<=i[1];++u)tu(a,c[u]);return a}function fs(c){let i=[1/0,1/0,-1/0,-1/0];for(let a=0;a<c.length;++a)for(let u=0;u<c[a].length;++u)tu(i,c[a][u]);return i}function rl(c,i,a){if(Wp(c)||Wp(i))return NaN;let u=0,m=0;return c[2]<i[0]&&(u=i[0]-c[2]),c[0]>i[2]&&(u=c[0]-i[2]),c[1]>i[3]&&(m=c[1]-i[3]),c[3]<i[1]&&(m=i[1]-c[3]),a.distance([0,0],[u,m])}function Yp(c){return 360*c-180}function gf(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function ru(c,i){let a=Math.pow(2,i.z),u=(c.y/Ot+i.y)/a;return[Yp((c.x/Ot+i.x)/a),gf(u)]}function qh(c,i){let a=[];for(let u=0;u<c.length;++u)a.push(ru(c[u],i));return a}function Yu(c,i,a){let u=a.pointOnLine(i,c).point;return a.distance(c,u)}function fc(c,i,a,u,m){let d=a.slice(u[0],u[1]+1),g=1/0;for(let b=i[0];b<=i[1];++b)if((g=Math.min(g,Yu(c[b],d,m)))===0)return 0;return g}function $s(c,i,a,u,m){let d=Math.min(m.pointToSegmentDistance(c,a,u),m.pointToSegmentDistance(i,a,u)),g=Math.min(m.pointToSegmentDistance(a,c,i),m.pointToSegmentDistance(u,c,i));return Math.min(d,g)}function _f(c,i,a,u,m){if(!il(i,c.length)||!il(u,a.length))return NaN;let d=1/0;for(let g=i[0];g<i[1];++g)for(let b=u[0];b<u[1];++b){if(Ll(c[g],c[g+1],a[b],a[b+1]))return 0;d=Math.min(d,$s(c[g],c[g+1],a[b],a[b+1],m))}return d}function Xp(c,i,a,u,m){if(!il(i,c.length)||!il(u,a.length))return NaN;let d=1/0;for(let g=i[0];g<=i[1];++g)for(let b=u[0];b<=u[1];++b)if((d=Math.min(d,m.distance(c[g],a[b])))===0)return d;return d}function yf(c,i,a){if(Fo(c,i,!0))return 0;let u=1/0;for(let m of i){let d=m.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[d-1]&&(u=Math.min(u,a.pointToSegmentDistance(c,m[d-1],m[0])))===0||(u=Math.min(u,Yu(c,m,a)))===0)return u}return u}function Xu(c,i,a,u){if(!il(i,c.length))return NaN;for(let d=i[0];d<=i[1];++d)if(Fo(c[d],a,!0))return 0;let m=1/0;for(let d=i[0];d<i[1];++d)for(let g of a)for(let b=0,T=g.length,O=T-1;b<T;O=b++){if(Ll(c[d],c[d+1],g[O],g[b]))return 0;m=Math.min(m,$s(c[d],c[d+1],g[O],g[b],u))}return m}function vf(c,i){for(let a of c)for(let u=0;u<=a.length-1;++u)if(Fo(a[u],i,!0))return!0;return!1}function Gs(c,i,a,u=1/0){let m=fs(c),d=fs(i);if(u!==1/0&&rl(m,d,a)>=u)return u;if(nu(m,d)){if(vf(c,i))return 0}else if(vf(i,c))return 0;let g=u;for(let b of c)for(let T=0,O=b.length,x=O-1;T<O;x=T++)for(let E of i)for(let P=0,M=E.length,I=M-1;P<M;I=P++){if(Ll(b[x],b[T],E[I],E[P]))return 0;g=Math.min(g,$s(b[x],b[T],E[I],E[P],a))}return g}function Ku(c,i,a,u,m,d,g){if(d===null||g===null)return;let b=rl(Nl(u,d),Nl(m,g),a);b<i&&c.push({dist:b,range1:d,range2:g})}function xf(c,i,a,u,m=1/0){let d=Math.min(u.distance(c[0],a[0][0]),m);if(d===0)return d;let g=new Gh([{dist:0,range1:[0,c.length-1],range2:[0,0]}],dc),b=i?xo:nl,T=fs(a);for(;g.length;){let O=g.pop();if(O.dist>=d)continue;let x=O.range1;if(Hs(x)<=b){if(!il(x,c.length))return NaN;if(i){let E=Xu(c,x,a,u);if((d=Math.min(d,E))===0)return d}else for(let E=x[0];E<=x[1];++E){let P=yf(c[E],a,u);if((d=Math.min(d,P))===0)return d}}else{let E=ca(x,i);if(E[0]!==null){let P=rl(Nl(c,E[0]),T,u);P<d&&g.push({dist:P,range1:E[0],range2:[0,0]})}if(E[1]!==null){let P=rl(Nl(c,E[1]),T,u);P<d&&g.push({dist:P,range1:E[1],range2:[0,0]})}}}return d}function bf(c,i,a,u,m,d=1/0){let g=Math.min(d,m.distance(c[0],a[0]));if(g===0)return g;let b=new Gh([{dist:0,range1:[0,c.length-1],range2:[0,a.length-1]}],dc),T=i?xo:nl,O=u?xo:nl;for(;b.length;){let x=b.pop();if(x.dist>=g)continue;let E=x.range1,P=x.range2;if(Hs(E)<=T&&Hs(P)<=O){if(!il(E,c.length)||!il(P,a.length))return NaN;if(i&&u?g=Math.min(g,_f(c,E,a,P,m)):i||u?i&&!u?g=Math.min(g,fc(a,P,c,E,m)):!i&&u&&(g=Math.min(g,fc(c,E,a,P,m))):g=Math.min(g,Xp(c,E,a,P,m)),g===0)return g}else{let M=ca(E,i),I=ca(P,u);Ku(b,g,m,c,a,M[0],I[0]),Ku(b,g,m,c,a,M[0],I[1]),Ku(b,g,m,c,a,M[1],I[0]),Ku(b,g,m,c,a,M[1],I[1])}}return g}function Ts(c,i,a,u,m=1/0){let d=m,g=Nl(c,[0,c.length-1]);for(let b of a)if(!(d!==1/0&&rl(g,Nl(b,[0,b.length-1]),u)>=d)&&(d=Math.min(d,bf(c,i,b,!0,u,d)),d===0))return d;return d}function zl(c,i,a,u,m=1/0){let d=m,g=Nl(c,[0,c.length-1]);for(let b of a){if(d!==1/0&&rl(g,fs(b),u)>=d)continue;let T=xf(c,i,b,u,d);if(isNaN(T))return T;if((d=Math.min(d,T))===0)return d}return d}function Zh(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class ua{constructor(i,a){this.type=Yt,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(el(i[1])){let u=i[1];if(u.type==="FeatureCollection"){for(let m=0;m<u.features.length;++m)if(Zh(u.features[m].geometry.type))return new ua(u,u.features[m].geometry)}else if(u.type==="Feature"){if(Zh(u.geometry.type))return new ua(u,u.geometry)}else if(Zh(u.type))return new ua(u,u)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){let a=i.geometry(),u=i.canonicalID();if(a!=null&&u!=null){if(i.geometryType()==="Point")return function(m,d,g){let b=[];for(let O of m)for(let x of O)b.push(ru(x,d));let T=new iu(b[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?bf(b,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",T):g.type==="MultiLineString"?Ts(b,!1,g.coordinates,T):g.type==="Polygon"||g.type==="MultiPolygon"?zl(b,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,T):null}(a,u,this.geometries);if(i.geometryType()==="LineString")return function(m,d,g){let b=[];for(let O of m){let x=[];for(let E of O)x.push(ru(E,d));b.push(x)}let T=new iu(b[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Ts(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,T);if(g.type==="MultiLineString"){let O=1/0;for(let x=0;x<g.coordinates.length;x++){let E=Ts(g.coordinates[x],!0,b,T,O);if(isNaN(E))return E;if((O=Math.min(O,E))===0)return O}return O}if(g.type==="Polygon"||g.type==="MultiPolygon"){let O=1/0;for(let x=0;x<b.length;x++){let E=zl(b[x],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,T,O);if(isNaN(E))return E;if((O=Math.min(O,E))===0)return O}return O}return null}(a,u,this.geometries);if(i.geometryType()==="Polygon")return function(m,d,g){let b=[];for(let O of function(x,E){let P=x.length;if(P<=1)return[x];let M=[],I,R;for(let V=0;V<P;V++){let j=c_(x[V]);j!==0&&(x[V].area=Math.abs(j),R===void 0&&(R=j<0),R===j<0?(I&&M.push(I),I=[x[V]]):I.push(x[V]))}return I&&M.push(I),M}(m)){let x=[];for(let E=0;E<O.length;++E)x.push(qh(O[E],d));b.push(x)}let T=new iu(b[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return zl(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,T);if(g.type==="MultiLineString"){let O=1/0;for(let x=0;x<g.coordinates.length;x++){let E=zl(g.coordinates[x],!0,b,T,O);if(isNaN(E))return E;if((O=Math.min(O,E))===0)return O}return O}return g.type==="Polygon"||g.type==="MultiPolygon"?function(O,x,E){let P=1/0;for(let M of O)for(let I of x){let R=Gs(M,I,E,P);if(isNaN(R))return R;if((P=Math.min(P,R))===0)return P}return P}(g.type==="Polygon"?[g.coordinates]:g.coordinates,b,T):null}(a,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Wh(c,i){switch(c){case"string":return Vs(i);case"number":return+i;case"boolean":return!!i;case"color":return oi.parse(i);case"formatted":return Sr.fromString(Vs(i));case"resolvedImage":return so.build(Vs(i))}return i}function Yh(c,i,a,u){return u!==void 0&&(c=u*Math.round(c/u)),i!==void 0&&c<i&&(c=i),a!==void 0&&c>a&&(c=a),c}class pc{constructor(i,a,u){this.type=i,this.key=a,this.scope=u}static parse(i,a){let u=a.expectedType;if(u==null&&(u=Kn),i.length<2||i.length>3)return a.error("Invalid number of arguments for 'config' expression.");let m=a.parse(i[1],1);if(!(m instanceof js))return a.error("Key name of 'config' expression must be a string literal.");if(i.length>=3){let d=a.parse(i[2],2);return d instanceof js?new pc(u,Vs(m.value),Vs(d.value)):a.error("Scope of 'config' expression must be a string literal.")}return new pc(u,Vs(m.value))}evaluate(i){let a=[this.key,this.scope,i.scope].filter(Boolean).join(""),u=i.getConfig(a);if(!u)return null;let{type:m,value:d,values:g,minValue:b,maxValue:T,stepValue:O}=u,x=u.default.evaluate(i),E=x;if(d){let P=i.scope;i.scope=(P||"").split("").slice(1).join(""),E=d.evaluate(i),i.scope=P}return m&&(E=Wh(m,E)),E===void 0||b===void 0&&T===void 0&&O===void 0||(typeof E=="number"?E=Yh(E,b,T,O):Array.isArray(E)&&(E=E.map(P=>typeof P=="number"?Yh(P,b,T,O):P))),d!==void 0&&E!==void 0&&g&&!g.includes(E)&&(E=x,m&&(E=Wh(m,E))),(m&&m!==this.type||E!==void 0&&dr(E)!==this.type)&&(E=Wh(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){let i=["config",this.key];return this.scope&&i.concat(this.key),i}}function ka(c){if(c instanceof us&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof ds||c instanceof ua)return!1;let i=!0;return c.eachChild(a=>{i&&!ka(a)&&(i=!1)}),i}function mc(c){if(c instanceof us&&c.name==="feature-state")return!1;let i=!0;return c.eachChild(a=>{i&&!mc(a)&&(i=!1)}),i}function qs(c){if(c instanceof pc)return new Set([c.key]);let i=new Set;return c.eachChild(a=>{i=new Set([...i,...qs(a)])}),i}function La(c,i){if(c instanceof us&&i.indexOf(c.name)>=0)return!1;let a=!0;return c.eachChild(u=>{a&&!La(u,i)&&(a=!1)}),a}class ou{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");let u=i[1];return a.scope.has(u)?new ou(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Xh{constructor(i,a=[],u,m=new wr,d=[],g,b){this.registry=i,this.path=a,this.key=a.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=m,this.errors=d,this.expectedType=u,this._scope=g,this.options=b}parse(i,a,u,m,d={}){return a||u?this.concat(a,null,u,m)._parse(i,d):this._parse(i,d)}parseObjectValue(i,a,u,m,d,g={}){return this.concat(a,u,m,d)._parse(i,g)}_parse(i,a){function u(m,d,g){return g==="assert"?new Us(d,[m]):g==="coerce"?new Ra(d,[m]):m}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let m=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(m){let d=m.parse(i,this);if(!d)return null;if(this.expectedType){let g=this.expectedType,b=d.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(g,b))return null}else d=u(d,g,a.typeAnnotation||"coerce");else d=u(d,g,a.typeAnnotation||"assert")}if(!(d instanceof js)&&d.type.kind!=="resolvedImage"&&ol(d)){let g=new eu(this._scope,this.options);try{d=new js(d.type,d.evaluate(g))}catch(b){return this.error(b.message),null}}return d}return Ra.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,u,m){let d=typeof i=="number"?this.path.concat(i):this.path;d=typeof a=="string"?d.concat(a):d;let g=m?this.scope.concat(m):this.scope;return new Xh(this.registry,d,u||null,g,this.errors,this._scope,this.options)}error(i,...a){let u=`${this.key}${a.map(m=>`[${m}]`).join("")}`;this.errors.push(new oo(u,i))}checkSubtype(i,a){let u=lc(i,a);return u&&this.error(u),u}}var ha=Xh;function ol(c){if(c instanceof ou)return ol(c.boundExpression);if(c instanceof us&&c.name==="error"||c instanceof Gu||c instanceof ds||c instanceof ua||c instanceof pc)return!1;let i=c instanceof Ra||c instanceof Us,a=!0;return c.eachChild(u=>{a=i?a&&ol(u):a&&u instanceof js}),!!a&&ka(c)&&La(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Qn(c,i){let a=c.length-1,u,m,d=0,g=a,b=0;for(;d<=g;)if(b=Math.floor((d+g)/2),u=c[b],m=c[b+1],u<=i){if(b===a||i<m)return b;d=b+1}else{if(!(u>i))throw new Ur("Input is not a number.");g=b-1}return 0}class sl{constructor(i,a,u){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(let[m,d]of u)this.labels.push(m),this.outputs.push(d)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");let u=a.parse(i[1],1,Yt);if(!u)return null;let m=[],d=null;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);for(let g=1;g<i.length;g+=2){let b=g===1?-1/0:i[g],T=i[g+1],O=g,x=g+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(m.length&&m[m.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);let E=a.parse(T,x,d);if(!E)return null;d=d||E.type,m.push([b,E])}return new sl(d,u,m)}evaluate(i){let a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(i);let m=this.input.evaluate(i);if(m<=a[0])return u[0].evaluate(i);let d=a.length;return m>=a[d-1]?u[d-1].evaluate(i):u[Qn(a,m)].evaluate(i)}eachChild(i){i(this.input);for(let a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}let Kp=.95047,Ju=1.08883,gc=4/29,_c=6/29,Yi=3*_c*_c,h_=_c*_c*_c,Jp=Math.PI/180,Qp=180/Math.PI;function Kh(c){return c>h_?Math.pow(c,1/3):c/Yi+gc}function Jh(c){return c>_c?c*c*c:Yi*(c-gc)}function Qh(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function wf(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Cf(c){let i=wf(c.r),a=wf(c.g),u=wf(c.b),m=Kh((.4124564*i+.3575761*a+.1804375*u)/Kp),d=Kh((.2126729*i+.7151522*a+.072175*u)/1);return{l:116*d-16,a:500*(m-d),b:200*(d-Kh((.0193339*i+.119192*a+.9503041*u)/Ju)),alpha:c.a}}function Mf(c){let i=(c.l+16)/116,a=isNaN(c.a)?i:i+c.a/500,u=isNaN(c.b)?i:i-c.b/200;return i=1*Jh(i),a=Kp*Jh(a),u=Ju*Jh(u),new oi(Qh(3.2404542*a-1.5371385*i-.4985314*u),Qh(-.969266*a+1.8760108*i+.041556*u),Qh(.0556434*a-.2040259*i+1.0572252*u),c.alpha)}function d_(c,i,a){let u=i-c;return c+a*(u>180||u<-180?u-360*Math.round(u/360):u)}let _={forward:Cf,reverse:Mf,interpolate:function(c,i,a){return{l:gn(c.l,i.l,a),a:gn(c.a,i.a,a),b:gn(c.b,i.b,a),alpha:gn(c.alpha,i.alpha,a)}}},S={forward:function(c){let{l:i,a,b:u}=Cf(c),m=Math.atan2(u,a)*Qp;return{h:m<0?m+360:m,c:Math.sqrt(a*a+u*u),l:i,alpha:c.a}},reverse:function(c){let i=c.h*Jp,a=c.c;return Mf({l:c.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:c.alpha})},interpolate:function(c,i,a){return{h:d_(c.h,i.h,a),c:gn(c.c,i.c,a),l:gn(c.l,i.l,a),alpha:gn(c.alpha,i.alpha,a)}}};var z=Object.freeze({__proto__:null,hcl:S,lab:_});class Y{constructor(i,a,u,m,d,g){this.type=i,this.operator=a,this.interpolation=u,this.input=m,this.dynamicStops=d,this.labels=[],this.outputs=[];for(let[b,T]of g)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(i,a,u,m){let d=0;if(i.name==="exponential")d=ne(a,i.base,u,m);else if(i.name==="linear")d=ne(a,1,u,m);else if(i.name==="cubic-bezier"){let g=i.controlPoints;d=new Zn(g[0],g[1],g[2],g[3]).solve(ne(a,1,u,m))}return d}static parse(i,a){let[u,m,d,...g]=i;if(!Array.isArray(m)||m.length===0)return a.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){let O=m[1];if(typeof O!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:O}}else{if(m[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(m[0])}`,1,0);{let O=m.slice(1);if(O.length!==4||O.some(x=>typeof x!="number"||x<0||x>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:O}}}if(i.length-1<3)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(d=a.parse(d,2,Yt),!d)return null;let b=[],T=null;if(u==="interpolate-hcl"||u==="interpolate-lab"?T=yo:a.expectedType&&a.expectedType.kind!=="value"&&(T=a.expectedType),i.length-1==3){let O=a.parse(g[0],3,Kn);return O?new Y(T,u,m,d,O,b):null}for(let O=0;O<g.length;O+=2){let x=g[O],E=g[O+1],P=O+3,M=O+4;if(typeof x!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(b.length&&b[b.length-1][0]>=x)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);let I=a.parse(E,M,T);if(!I)return null;T=T||I.type,b.push([x,I])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new Y(T,u,m,d,null,b):a.error(`Type ${Wi(T)} is not interpolatable.`)}evaluate(i){let a=this.labels,u=this.outputs;if(this.dynamicStops){let x=this.dynamicStops.evaluate(i);if(x.length%2!=0)throw new Ur("Expected an even number of arguments.");a=[],u=[];for(let E=0;E<x.length;E+=2){let P=x[E],M=new js(Yt,x[E+1]);if(typeof P!="number")throw new Ur('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(a.length&&a[a.length-1]>=P)throw new Ur('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');a.push(P),u.push(M)}if(a.length===0)throw new Ur("Expected at least one input/output pair.")}if(a.length===1)return u[0].evaluate(i);let m=this.input.evaluate(i);if(m<=a[0])return u[0].evaluate(i);let d=a.length;if(m>=a[d-1])return u[d-1].evaluate(i);let g=Qn(a,m),b=Y.interpolationFactor(this.interpolation,m,a[g],a[g+1]),T=u[g].evaluate(i),O=u[g+1].evaluate(i);return this.operator==="interpolate"?li[this.type.kind.toLowerCase()](T,O,b):this.operator==="interpolate-hcl"?S.reverse(S.interpolate(S.forward(T),S.forward(O),b)):_.reverse(_.interpolate(_.forward(T),_.forward(O),b))}eachChild(i){i(this.input);for(let a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let a=[this.operator,i,this.input.serialize()];if(this.dynamicStops)a.push(this.dynamicStops.serialize());else for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function ne(c,i,a,u){let m=u-a,d=c-a;return m===0?0:i===1?d/m:(Math.pow(i,d)-1)/(Math.pow(i,m)-1)}class ye{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let u=null,m=a.expectedType;m&&m.kind!=="value"&&(u=m);let d=[];for(let b of i.slice(1)){let T=a.parse(b,1+d.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,d.push(T)}let g=m&&d.some(b=>lc(m,b.type));return new ye(g?Kn:u,d)}evaluate(i){let a,u=null,m=0;for(let d of this.args){if(m++,u=d.evaluate(i),u&&u instanceof so&&!u.available&&(a||(a=u),u=null,m===this.args.length))return a;if(u!==null)break}return u}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){let i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class Ge{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(let a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);let u=[];for(let d=1;d<i.length-1;d+=2){let g=i[d];if(typeof g!="string")return a.error(`Expected string, but found ${typeof g} instead.`,d);if(/[^a-zA-Z0-9_]/.test(g))return a.error("Variable names must contain only alphanumeric characters or '_'.",d);let b=a.parse(i[d+1],d+1);if(!b)return null;u.push([g,b])}let m=a.parse(i[i.length-1],i.length-1,a.expectedType,u);return m?new Ge(u,m):null}outputDefined(){return this.result.outputDefined()}serialize(){let i=["let"];for(let[a,u]of this.bindings)i.push(a,u.serialize());return i.push(this.result.serialize()),i}}class ht{constructor(i,a,u){this.type=i,this.index=a,this.input=u}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let u=a.parse(i[1],1,Yt),m=a.parse(i[2],2,Ao(a.expectedType||Kn));return u&&m?new ht(m.type.itemType,u,m):null}evaluate(i){let a=this.index.evaluate(i),u=this.input.evaluate(i);if(a<0)throw new Ur(`Array index out of bounds: ${a} < 0.`);if(a>u.length-1)throw new Ur(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a===Math.floor(a))return u[a];let m=Math.floor(a),d=Math.ceil(a),g=u[m],b=u[d];if(typeof g!="number"||typeof b!="number")throw new Ur(`Cannot interpolate between non-number values at index ${a}.`);let T=a-m;return g*(1-T)+b*T}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class bt{constructor(i,a){this.type=ii,this.needle=i,this.haystack=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let u=a.parse(i[1],1,Kn),m=a.parse(i[2],2,Kn);return u&&m?Uh(u.type,[ii,di,Yt,ac,Kn])?new bt(u,m):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(u.type)} instead`):null}evaluate(i){let a=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(u==null)return!1;if(!cc(a,["boolean","string","number","null"]))throw new Ur(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(dr(a))} instead.`);if(!cc(u,["string","array"]))throw new Ur(`Expected second argument to be of type array or string, but found ${Wi(dr(u))} instead.`);return u.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Zt{constructor(i,a,u){this.type=Yt,this.needle=i,this.haystack=a,this.fromIndex=u}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);let u=a.parse(i[1],1,Kn),m=a.parse(i[2],2,Kn);if(!u||!m)return null;if(!Uh(u.type,[ii,di,Yt,ac,Kn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(u.type)} instead`);if(i.length===4){let d=a.parse(i[3],3,Yt);return d?new Zt(u,m,d):null}return new Zt(u,m)}evaluate(i){let a=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!cc(a,["boolean","string","number","null"]))throw new Ur(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(dr(a))} instead.`);if(!cc(u,["string","array"]))throw new Ur(`Expected second argument to be of type array or string, but found ${Wi(dr(u))} instead.`);if(this.fromIndex){let m=this.fromIndex.evaluate(i);return u.indexOf(a,m)}return u.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class vn{constructor(i,a,u,m,d,g){this.inputType=i,this.type=a,this.input=u,this.cases=m,this.outputs=d,this.otherwise=g}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let u,m;a.expectedType&&a.expectedType.kind!=="value"&&(m=a.expectedType);let d={},g=[];for(let O=2;O<i.length-1;O+=2){let x=i[O],E=i[O+1];Array.isArray(x)||(x=[x]);let P=a.concat(O);if(x.length===0)return P.error("Expected at least one branch label.");for(let I of x){if(typeof I!="number"&&typeof I!="string")return P.error("Branch labels must be numbers or strings.");if(typeof I=="number"&&Math.abs(I)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof I=="number"&&Math.floor(I)!==I)return P.error("Numeric branch labels must be integer values.");if(u){if(P.checkSubtype(u,dr(I)))return null}else u=dr(I);if(d[String(I)]!==void 0)return P.error("Branch labels must be unique.");d[String(I)]=g.length}let M=a.parse(E,O,m);if(!M)return null;m=m||M.type,g.push(M)}let b=a.parse(i[1],1,Kn);if(!b)return null;let T=a.parse(i[i.length-1],i.length-1,m);return T?b.type.kind!=="value"&&a.concat(1).checkSubtype(u,b.type)?null:new vn(u,m,b,d,g,T):null}evaluate(i){let a=this.input.evaluate(i);return(dr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],m={};for(let g of a){let b=m[this.cases[g]];b===void 0?(m[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[b][1].push(g)}let d=g=>this.inputType.kind==="number"?Number(g):g;for(let[g,b]of u)i.push(b.length===1?d(b[0]):b.map(d)),i.push(this.outputs[g].serialize());return i.push(this.otherwise.serialize()),i}}class ei{constructor(i,a,u){this.type=i,this.branches=a,this.otherwise=u}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);let m=[];for(let g=1;g<i.length-1;g+=2){let b=a.parse(i[g],g,ii);if(!b)return null;let T=a.parse(i[g+1],g+1,u);if(!T)return null;m.push([b,T]),u=u||T.type}let d=a.parse(i[i.length-1],i.length-1,u);return d?new ei(u,m,d):null}evaluate(i){for(let[a,u]of this.branches)if(a.evaluate(i))return u.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(let[a,u]of this.branches)i(a),i(u);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){let i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class Pi{constructor(i,a,u,m){this.type=i,this.input=a,this.beginIndex=u,this.endIndex=m}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);let u=a.parse(i[1],1,Kn),m=a.parse(i[2],2,Yt);if(!u||!m)return null;if(!Uh(u.type,[Ao(Kn),di,Kn]))return a.error(`Expected first argument to be of type array or string, but found ${Wi(u.type)} instead`);if(i.length===4){let d=a.parse(i[3],3,Yt);return d?new Pi(u.type,u,m,d):null}return new Pi(u.type,u,m)}evaluate(i){let a=this.input.evaluate(i),u=this.beginIndex.evaluate(i);if(!cc(a,["string","array"]))throw new Ur(`Expected first argument to be of type array or string, but found ${Wi(dr(a))} instead.`);if(this.endIndex){let m=this.endIndex.evaluate(i);return a.slice(u,m)}return a.slice(u)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Go(c,i){return c==="=="||c==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Mo(c,i,a,u){return u.compare(i,a)===0}function zo(c,i,a){let u=c!=="=="&&c!=="!=";return class I6{constructor(d,g,b){this.type=ii,this.lhs=d,this.rhs=g,this.collator=b,this.hasUntypedArgument=d.type.kind==="value"||g.type.kind==="value"}static parse(d,g){if(d.length!==3&&d.length!==4)return g.error("Expected two or three arguments.");let b=d[0],T=g.parse(d[1],1,Kn);if(!T)return null;if(!Go(b,T.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${Wi(T.type)}'.`);let O=g.parse(d[2],2,Kn);if(!O)return null;if(!Go(b,O.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${Wi(O.type)}'.`);if(T.type.kind!==O.type.kind&&T.type.kind!=="value"&&O.type.kind!=="value")return g.error(`Cannot compare types '${Wi(T.type)}' and '${Wi(O.type)}'.`);u&&(T.type.kind==="value"&&O.type.kind!=="value"?T=new Us(O.type,[T]):T.type.kind!=="value"&&O.type.kind==="value"&&(O=new Us(T.type,[O])));let x=null;if(d.length===4){if(T.type.kind!=="string"&&O.type.kind!=="string"&&T.type.kind!=="value"&&O.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(x=g.parse(d[3],3,vo),!x)return null}return new I6(T,O,x)}evaluate(d){let g=this.lhs.evaluate(d),b=this.rhs.evaluate(d);if(u&&this.hasUntypedArgument){let T=dr(g),O=dr(b);if(T.kind!==O.kind||T.kind!=="string"&&T.kind!=="number")throw new Ur(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${T.kind}, ${O.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){let T=dr(g),O=dr(b);if(T.kind!=="string"||O.kind!=="string")return i(d,g,b)}return this.collator?a(d,g,b,this.collator.evaluate(d)):i(d,g,b)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){let d=[c];return this.eachChild(g=>{d.push(g.serialize())}),d}}}let ps=zo("==",function(c,i,a){return i===a},Mo),su=zo("!=",function(c,i,a){return i!==a},function(c,i,a,u){return!Mo(0,i,a,u)}),f_=zo("<",function(c,i,a){return i<a},function(c,i,a,u){return u.compare(i,a)<0}),p_=zo(">",function(c,i,a){return i>a},function(c,i,a,u){return u.compare(i,a)>0}),m_=zo("<=",function(c,i,a){return i<=a},function(c,i,a,u){return u.compare(i,a)<=0}),ed=zo(">=",function(c,i,a){return i>=a},function(c,i,a,u){return u.compare(i,a)>=0});class Tf{constructor(i,a,u,m,d,g){this.type=di,this.number=i,this.locale=a,this.currency=u,this.unit=m,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(i,a){if(i.length!==3)return a.error("Expected two arguments.");let u=a.parse(i[1],1,Yt);if(!u)return null;let m=i[2];if(typeof m!="object"||Array.isArray(m))return a.error("NumberFormat options argument must be an object.");let d=null;if(m.locale&&(d=a.parseObjectValue(m.locale,2,"locale",di),!d))return null;let g=null;if(m.currency&&(g=a.parseObjectValue(m.currency,2,"currency",di),!g))return null;let b=null;if(m.unit&&(b=a.parseObjectValue(m.unit,2,"unit",di),!b))return null;let T=null;if(m["min-fraction-digits"]&&(T=a.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",Yt),!T))return null;let O=null;return m["max-fraction-digits"]&&(O=a.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",Yt),!O)?null:new Tf(u,d,g,b,T,O)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Qu{constructor(i){this.type=Yt,this.input=i}static parse(i,a){if(i.length!==2)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);let u=a.parse(i[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Wi(u.type)} instead.`):new Qu(u):null}evaluate(i){let a=this.input.evaluate(i);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Ur(`Expected value to be of type string or array, but found ${Wi(dr(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){let i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}function lo(c){return function(){c=1831565813+(c|=0)|0;let i=Math.imul(c^c>>>15,1|c);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}let al={"==":ps,"!=":su,">":p_,"<":f_,">=":ed,"<=":m_,array:Us,at:ht,boolean:Us,case:ei,coalesce:ye,collator:Gu,format:Ro,image:Qc,in:bt,"index-of":Zt,interpolate:Y,"interpolate-hcl":Y,"interpolate-lab":Y,length:Qu,let:Ge,literal:js,match:vn,number:Us,"number-format":Tf,object:Us,slice:Pi,step:sl,string:Us,"to-boolean":Ra,"to-color":Ra,"to-number":Ra,"to-string":Ra,var:ou,within:ds,distance:ua,config:pc};function em(c,[i,a,u,m]){i=i.evaluate(c),a=a.evaluate(c),u=u.evaluate(c);let d=m?m.evaluate(c):1,g=uc(i,a,u,d);if(g)throw new Ur(g);return new oi(i/255*d,a/255*d,u/255*d,d)}function Ef(c,[i,a,u,m]){i=i.evaluate(c),a=a.evaluate(c),u=u.evaluate(c);let d=m?m.evaluate(c):1,g=function(O,x,E,P){return typeof O=="number"&&O>=0&&O<=360?typeof x=="number"&&x>=0&&x<=100&&typeof E=="number"&&E>=0&&E<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[O,x,E,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[O,x,E,P]:[O,x,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[O,x,E,P]:[O,x,E]).join(", ")}]: 'h' must be between 0 and 360.`}(i,a,u,d);if(g)throw new Ur(g);let b=`hsla(${i}, ${a}%, ${u}%, ${d})`,T=oi.parse(b);if(!T)throw new Ur(`Failed to parse HSLA color: ${b}`);return T}function Sf(c,i){return c in i}function Fa(c,i){let a=i[c];return a===void 0?null:a}function ll(c){return{type:c}}function If(c){return{result:"success",value:c}}function au(c){return{result:"error",value:c}}function Pf(c,i){return!!c&&!!c.parameters&&c.parameters.indexOf(i)>-1}function td(c){return c["property-type"]==="data-driven"}function yv(c){return Pf(c.expression,"measure-light")}function vv(c){return Pf(c.expression,"zoom")}function tm(c){return!!c.expression&&c.expression.interpolated}function nm(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function DC(c){return c}function xv(c,i){let a=i.type==="color",u=c.stops&&typeof c.stops[0][0]=="object",m=u||!(u||c.property!==void 0),d=c.type||(tm(i)?"exponential":"interval");if(a&&((c=_i({},c)).stops&&(c.stops=c.stops.map(O=>[O[0],oi.parse(O[1])])),c.default=oi.parse(c.default?c.default:i.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!z[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let g,b,T;if(d==="exponential")g=Of;else if(d==="interval")g=wv;else if(d==="categorical"){g=bv,b=Object.create(null);for(let O of c.stops)b[O[0]]=O[1];T=typeof c.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);g=OC}if(u){let O={},x=[];for(let M=0;M<c.stops.length;M++){let I=c.stops[M],R=I[0].zoom;O[R]===void 0&&(O[R]={zoom:R,type:c.type,property:c.property,default:c.default,stops:[]},x.push(R)),O[R].stops.push([I[0].value,I[1]])}let E=[];for(let M of x)E.push([O[M].zoom,xv(O[M],i)]);let P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Y.interpolationFactor.bind(void 0,P),zoomStops:E.map(M=>M[0]),evaluate:({zoom:M},I)=>Of({stops:E,base:c.base},i,M).evaluate(M,I)}}if(m){let O=d==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:Y.interpolationFactor.bind(void 0,O),zoomStops:c.stops.map(x=>x[0]),evaluate:({zoom:x})=>g(c,i,x,b,T)}}return{kind:"source",evaluate(O,x){let E=x&&x.properties?x.properties[c.property]:void 0;return E===void 0?Df(c.default,i.default):g(c,i,E,b,T)}}}function Df(c,i,a){return c!==void 0?c:i!==void 0?i:a!==void 0?a:void 0}function bv(c,i,a,u,m){return Df(typeof a===m?u[a]:void 0,c.default,i.default)}function wv(c,i,a){if(Rl(a)!=="number")return Df(c.default,i.default);let u=c.stops.length;if(u===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[u-1][0])return c.stops[u-1][1];let m=Qn(c.stops.map(d=>d[0]),a);return c.stops[m][1]}function Of(c,i,a){let u=c.base!==void 0?c.base:1;if(Rl(a)!=="number")return Df(c.default,i.default);let m=c.stops.length;if(m===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[m-1][0])return c.stops[m-1][1];let d=Qn(c.stops.map(x=>x[0]),a),g=function(x,E,P,M){let I=M-P,R=x-P;return I===0?0:E===1?R/I:(Math.pow(E,R)-1)/(Math.pow(E,I)-1)}(a,u,c.stops[d][0],c.stops[d+1][0]),b=c.stops[d][1],T=c.stops[d+1][1],O=li[i.type]||DC;if(c.colorSpace&&c.colorSpace!=="rgb"){let x=z[c.colorSpace];O=(E,P)=>x.reverse(x.interpolate(x.forward(E),x.forward(P),g))}return typeof b.evaluate=="function"?{evaluate(...x){let E=b.evaluate.apply(void 0,x),P=T.evaluate.apply(void 0,x);if(E!==void 0&&P!==void 0)return O(E,P,g)}}:O(b,T,g)}function OC(c,i,a){return i.type==="color"?a=oi.parse(a):i.type==="formatted"?a=Sr.fromString(a.toString()):i.type==="resolvedImage"?a=so.build(a.toString()):Rl(a)===i.type||i.type==="enum"&&i.values[a]||(a=void 0),Df(a,c.default,i.default)}us.register(al,{error:[{kind:"error"},[di],(c,[i])=>{throw new Ur(i.evaluate(c))}],typeof:[di,[Kn],(c,[i])=>Wi(dr(i.evaluate(c)))],"to-rgba":[Ao(Yt,4),[yo],(c,[i])=>i.evaluate(c).toRenderColor(null).toArray()],"to-hsla":[Ao(Yt,4),[yo],(c,[i])=>i.evaluate(c).toRenderColor(null).toHslaArray()],rgb:[yo,[Yt,Yt,Yt],em],rgba:[yo,[Yt,Yt,Yt,Yt],em],hsl:[yo,[Yt,Yt,Yt],Ef],hsla:[yo,[Yt,Yt,Yt,Yt],Ef],has:{type:ii,overloads:[[[di],(c,[i])=>Sf(i.evaluate(c),c.properties())],[[di,Qa],(c,[i,a])=>Sf(i.evaluate(c),a.evaluate(c))]]},get:{type:Kn,overloads:[[[di],(c,[i])=>Fa(i.evaluate(c),c.properties())],[[di,Qa],(c,[i,a])=>Fa(i.evaluate(c),a.evaluate(c))]]},"feature-state":[Kn,[di],(c,[i])=>Fa(i.evaluate(c),c.featureState||{})],properties:[Qa,[],c=>c.properties()],"geometry-type":[di,[],c=>c.geometryType()],id:[Kn,[],c=>c.id()],zoom:[Yt,[],c=>c.globals.zoom],pitch:[Yt,[],c=>c.globals.pitch||0],"distance-from-center":[Yt,[],c=>c.distanceFromCenter()],"measure-light":[Yt,[di],(c,[i])=>c.measureLight(i.evaluate(c))],"heatmap-density":[Yt,[],c=>c.globals.heatmapDensity||0],"line-progress":[Yt,[],c=>c.globals.lineProgress||0],"raster-value":[Yt,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[Yt,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[Yt,[],c=>c.globals.skyRadialProgress||0],accumulated:[Kn,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Yt,ll(Yt),(c,i)=>{let a=0;for(let u of i)a+=u.evaluate(c);return a}],"*":[Yt,ll(Yt),(c,i)=>{let a=1;for(let u of i)a*=u.evaluate(c);return a}],"-":{type:Yt,overloads:[[[Yt,Yt],(c,[i,a])=>i.evaluate(c)-a.evaluate(c)],[[Yt],(c,[i])=>-i.evaluate(c)]]},"/":[Yt,[Yt,Yt],(c,[i,a])=>i.evaluate(c)/a.evaluate(c)],"%":[Yt,[Yt,Yt],(c,[i,a])=>i.evaluate(c)%a.evaluate(c)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(c,[i,a])=>Math.pow(i.evaluate(c),a.evaluate(c))],sqrt:[Yt,[Yt],(c,[i])=>Math.sqrt(i.evaluate(c))],log10:[Yt,[Yt],(c,[i])=>Math.log(i.evaluate(c))/Math.LN10],ln:[Yt,[Yt],(c,[i])=>Math.log(i.evaluate(c))],log2:[Yt,[Yt],(c,[i])=>Math.log(i.evaluate(c))/Math.LN2],sin:[Yt,[Yt],(c,[i])=>Math.sin(i.evaluate(c))],cos:[Yt,[Yt],(c,[i])=>Math.cos(i.evaluate(c))],tan:[Yt,[Yt],(c,[i])=>Math.tan(i.evaluate(c))],asin:[Yt,[Yt],(c,[i])=>Math.asin(i.evaluate(c))],acos:[Yt,[Yt],(c,[i])=>Math.acos(i.evaluate(c))],atan:[Yt,[Yt],(c,[i])=>Math.atan(i.evaluate(c))],min:[Yt,ll(Yt),(c,i)=>Math.min(...i.map(a=>a.evaluate(c)))],max:[Yt,ll(Yt),(c,i)=>Math.max(...i.map(a=>a.evaluate(c)))],abs:[Yt,[Yt],(c,[i])=>Math.abs(i.evaluate(c))],round:[Yt,[Yt],(c,[i])=>{let a=i.evaluate(c);return a<0?-Math.round(-a):Math.round(a)}],floor:[Yt,[Yt],(c,[i])=>Math.floor(i.evaluate(c))],ceil:[Yt,[Yt],(c,[i])=>Math.ceil(i.evaluate(c))],"filter-==":[ii,[di,Kn],(c,[i,a])=>c.properties()[i.value]===a.value],"filter-id-==":[ii,[Kn],(c,[i])=>c.id()===i.value],"filter-type-==":[ii,[di],(c,[i])=>c.geometryType()===i.value],"filter-<":[ii,[di,Kn],(c,[i,a])=>{let u=c.properties()[i.value],m=a.value;return typeof u==typeof m&&u<m}],"filter-id-<":[ii,[Kn],(c,[i])=>{let a=c.id(),u=i.value;return typeof a==typeof u&&a<u}],"filter->":[ii,[di,Kn],(c,[i,a])=>{let u=c.properties()[i.value],m=a.value;return typeof u==typeof m&&u>m}],"filter-id->":[ii,[Kn],(c,[i])=>{let a=c.id(),u=i.value;return typeof a==typeof u&&a>u}],"filter-<=":[ii,[di,Kn],(c,[i,a])=>{let u=c.properties()[i.value],m=a.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[ii,[Kn],(c,[i])=>{let a=c.id(),u=i.value;return typeof a==typeof u&&a<=u}],"filter->=":[ii,[di,Kn],(c,[i,a])=>{let u=c.properties()[i.value],m=a.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[ii,[Kn],(c,[i])=>{let a=c.id(),u=i.value;return typeof a==typeof u&&a>=u}],"filter-has":[ii,[Kn],(c,[i])=>i.value in c.properties()],"filter-has-id":[ii,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[ii,[Ao(di)],(c,[i])=>i.value.indexOf(c.geometryType())>=0],"filter-id-in":[ii,[Ao(Kn)],(c,[i])=>i.value.indexOf(c.id())>=0],"filter-in-small":[ii,[di,Ao(Kn)],(c,[i,a])=>a.value.indexOf(c.properties()[i.value])>=0],"filter-in-large":[ii,[di,Ao(Kn)],(c,[i,a])=>function(u,m,d,g){for(;d<=g;){let b=d+g>>1;if(m[b]===u)return!0;m[b]>u?g=b-1:d=b+1}return!1}(c.properties()[i.value],a.value,0,a.value.length-1)],all:{type:ii,overloads:[[[ii,ii],(c,[i,a])=>i.evaluate(c)&&a.evaluate(c)],[ll(ii),(c,i)=>{for(let a of i)if(!a.evaluate(c))return!1;return!0}]]},any:{type:ii,overloads:[[[ii,ii],(c,[i,a])=>i.evaluate(c)||a.evaluate(c)],[ll(ii),(c,i)=>{for(let a of i)if(a.evaluate(c))return!0;return!1}]]},"!":[ii,[ii],(c,[i])=>!i.evaluate(c)],"is-supported-script":[ii,[di],(c,[i])=>{let a=c.globals&&c.globals.isSupportedScript;return!a||a(i.evaluate(c))}],upcase:[di,[di],(c,[i])=>i.evaluate(c).toUpperCase()],downcase:[di,[di],(c,[i])=>i.evaluate(c).toLowerCase()],concat:[di,ll(Kn),(c,i)=>i.map(a=>Vs(a.evaluate(c))).join("")],"resolved-locale":[di,[vo],(c,[i])=>i.evaluate(c).resolvedLocale()],random:[Yt,[Yt,Yt,Kn],(c,i)=>{let[a,u,m]=i.map(g=>g.evaluate(c));if(a>u||a===u)return a;let d;if(typeof m=="string")d=function(g){let b=0;if(g.length===0)return b;for(let T=0;T<g.length;T++)b=(b<<5)-b+g.charCodeAt(T),b|=0;return b}(m);else{if(typeof m!="number")throw new Ur(`Invalid seed input: ${m}`);d=m}return a+lo(d)()*(u-a)}]});class im{constructor(i,a,u,m){this.expression=i,this._warningHistory={},this._evaluator=new eu(u,m),this._defaultValue=a?function(d){return d.type==="color"&&(nm(d.default)||Array.isArray(d.default))?new oi(0,0,0,0):d.type==="color"?oi.parse(d.default)||null:d.default===void 0?null:d.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=qs(i)}evaluateWithoutErrorHandling(i,a,u,m,d,g,b,T){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=m||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,u,m,d,g,b,T){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null;try{let O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new Ur(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${O.message}`)),this._defaultValue}}}function g_(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in al}function Af(c,i,a,u){let m=new ha(al,[],i?function(g){let b={color:yo,string:di,number:Yt,enum:di,boolean:ii,formatted:Jo,resolvedImage:Al};return g.type==="array"?Ao(b[g.value]||Kn,g.length):b[g.type]}(i):void 0,void 0,void 0,a,u),d=m.parse(c,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?If(new im(d,i,a,u)):au(m.errors)}class rm{constructor(i,a,u,m){this.kind=i,this._styleExpression=a,this.isLightConstant=u,this.isLineProgressConstant=m,this.isStateDependent=i!=="constant"&&!mc(a.expression),this.configDependencies=qs(a.expression)}evaluateWithoutErrorHandling(i,a,u,m,d,g){return this._styleExpression.evaluateWithoutErrorHandling(i,a,u,m,d,g)}evaluate(i,a,u,m,d,g){return this._styleExpression.evaluate(i,a,u,m,d,g)}}class nd{constructor(i,a,u,m,d,g){this.kind=i,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!mc(a.expression),this.isLightConstant=d,this.isLineProgressConstant=g,this.configDependencies=qs(a.expression),this.interpolationType=m}evaluateWithoutErrorHandling(i,a,u,m,d,g){return this._styleExpression.evaluateWithoutErrorHandling(i,a,u,m,d,g)}evaluate(i,a,u,m,d,g){return this._styleExpression.evaluate(i,a,u,m,d,g)}interpolationFactor(i,a,u){return this.interpolationType?Y.interpolationFactor(this.interpolationType,i,a,u):0}}function Cv(c,i,a,u){if((c=Af(c,i,a,u)).result==="error")return c;let m=c.value.expression,d=ka(m);if(!d&&!td(i))return au([new oo("","data expressions not supported")]);let g=La(m,["zoom","pitch","distance-from-center"]);if(!g&&!vv(i))return au([new oo("","zoom expressions not supported")]);let b=La(m,["measure-light"]);if(!b&&!yv(i))return au([new oo("","measure-light expression not supported")]);let T=La(m,["line-progress"]);if(!T&&!function(E){return Pf(E.expression,"line-progress")}(i))return au([new oo("","line-progress expression not supported")]);let O=i.expression&&i.expression.relaxZoomRestriction,x=sm(m);return x||g||O?x instanceof oo?au([x]):x instanceof Y&&!tm(i)?au([new oo("",'"interpolate" expressions cannot be used with this property')]):If(x?new nd(d&&T?"camera":"composite",c.value,x.labels,x instanceof Y?x.interpolation:void 0,b,T):new rm(d&&T?"constant":"source",c.value,b,T)):au([new oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class om{constructor(i,a){this._parameters=i,this._specification=a,_i(this,xv(this._parameters,this._specification))}static deserialize(i){return new om(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function sm(c){let i=null;if(c instanceof Ge)i=sm(c.result);else if(c instanceof ye){for(let a of c.args)if(i=sm(a),i)break}else(c instanceof sl||c instanceof Y)&&c.input instanceof us&&c.input.name==="zoom"&&(i=c);return i instanceof oo||c.eachChild(a=>{let u=sm(a);u instanceof oo?i=u:i&&u&&i!==u&&(i=new oo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var am,Mv,AC=function(){if(Mv)return am;Mv=1,am=i;var c=3;function i(a,u,m){var d=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var g=new Int32Array(this.arrayBuffer);a=g[0],this.d=(u=g[1])+2*(m=g[2]);for(var b=0;b<this.d*this.d;b++){var T=g[c+b],O=g[c+b+1];d.push(T===O?null:g.subarray(T,O))}var x=g[c+d.length+1];this.keys=g.subarray(g[c+d.length],x),this.bboxes=g.subarray(x),this.insert=this._insertReadonly}else{this.d=u+2*m;for(var E=0;E<this.d*this.d;E++)d.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=m,this.scale=u/a,this.uid=0;var P=m/u*a;this.min=-P,this.max=a+P}return i.prototype.insert=function(a,u,m,d,g){this._forEachCell(u,m,d,g,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(d),this.bboxes.push(g)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(a,u,m,d,g,b){this.cells[g].push(b)},i.prototype.query=function(a,u,m,d,g){var b=this.min,T=this.max;if(a<=b&&u<=b&&T<=m&&T<=d&&!g)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(a,u,m,d,this._queryCell,O,{},g),O},i.prototype._queryCell=function(a,u,m,d,g,b,T,O){var x=this.cells[g];if(x!==null)for(var E=this.keys,P=this.bboxes,M=0;M<x.length;M++){var I=x[M];if(T[I]===void 0){var R=4*I;(O?O(P[R+0],P[R+1],P[R+2],P[R+3]):a<=P[R+2]&&u<=P[R+3]&&m>=P[R+0]&&d>=P[R+1])?(T[I]=!0,b.push(E[I])):T[I]=!1}}},i.prototype._forEachCell=function(a,u,m,d,g,b,T,O){for(var x=this._convertToCellCoord(a),E=this._convertToCellCoord(u),P=this._convertToCellCoord(m),M=this._convertToCellCoord(d),I=x;I<=P;I++)for(var R=E;R<=M;R++){var V=this.d*R+I;if((!O||O(this._convertFromCellCoord(I),this._convertFromCellCoord(R),this._convertFromCellCoord(I+1),this._convertFromCellCoord(R+1)))&&g.call(this,a,u,m,d,V,b,T,O))return}},i.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},i.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=c+this.cells.length+1+1,m=0,d=0;d<this.cells.length;d++)m+=this.cells[d].length;var g=new Int32Array(u+m+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var b=u,T=0;T<a.length;T++){var O=a[T];g[c+T]=b,g.set(O,b),b+=O.length}return g[c+a.length]=b,g.set(this.keys,b),g[c+a.length+1]=b+=this.keys.length,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer},am}(),eh=w(AC);let Rf={};function Xt(c,i,a={}){Object.defineProperty(c,"_classRegistryKey",{value:i,writable:!1}),Rf[i]={klass:c,omit:a.omit||[]}}Xt(Object,"Object"),eh.serialize=function(c,i){let a=c.toArrayBuffer();return i&&i.add(a),{buffer:a}},eh.deserialize=function(c){return new eh(c.buffer)},Object.defineProperty(eh,"name",{value:"Grid"}),Xt(eh,"Grid"),typeof DOMMatrix<"u"&&Xt(DOMMatrix,"DOMMatrix"),Xt(oi,"Color"),Xt(Error,"Error"),Xt(Sr,"Formatted"),Xt(Hu,"FormattedSection"),Xt(Pl,"AJAXError"),Xt(so,"ResolvedImage"),Xt(om,"StylePropertyFunction"),Xt(im,"StyleExpression",{omit:["_evaluator"]}),Xt(cs,"ImageIdWithOptions"),Xt(nd,"ZoomDependentExpression"),Xt(rm,"ZoomConstantExpression"),Xt(us,"CompoundExpression",{omit:["_evaluate"]});for(let c in al)Rf[al[c]._classRegistryKey]||Xt(al[c],`Expression${c}`);function Tv(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function th(c){return self.ImageBitmap&&c instanceof ImageBitmap}function nh(c,i){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(Tv(c)||th(c))return i&&i.add(c),c;if(ArrayBuffer.isView(c))return i&&i.add(c.buffer),c;if(c instanceof ImageData)return i&&i.add(c.data.buffer),c;if(Array.isArray(c)){let a=[];for(let u of c)a.push(nh(u,i));return a}if(c instanceof Map){let a={$name:"Map"};for(let[u,m]of c.entries())a[u]=nh(m);return a}if(c instanceof Set){let a={$name:"Set"},u=0;for(let m of c.values())a[++u]=nh(m);return a}if(typeof c=="object"){let a=c.constructor,u=a._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${u}".`);let m=a.serialize?a.serialize(c,i):{};if(!a.serialize){for(let d in c)c.hasOwnProperty(d)&&(Rf[u].omit.indexOf(d)>=0||(m[d]=nh(c[d],i)));c instanceof Error&&(m.message=c.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof c)}function ih(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||Tv(c)||th(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(ih);if(typeof c=="object"){let i=c.$name||"Object";if(i==="Map"){let m=new Map;for(let d of Object.keys(c))d!=="$name"&&m.set(d,ih(c[d]));return m}if(i==="Set"){let m=new Set;for(let d of Object.keys(c))d!=="$name"&&m.add(ih(c[d]));return m}let{klass:a}=Rf[i];if(!a)throw new Error(`Can't deserialize unregistered class "${i}".`);if(a.deserialize)return a.deserialize(c);let u=Object.create(a.prototype);for(let m of Object.keys(c))m!=="$name"&&(u[m]=ih(c[m]));return u}throw new Error("can't deserialize object of type "+typeof c)}let sn={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function lm(c){for(let i of c)if(cm(i.charCodeAt(0)))return!0;return!1}function Ev(c){for(let i of c)if(!Sv(i.charCodeAt(0)))return!1;return!0}function Sv(c){return!(sn.Arabic(c)||sn["Arabic Supplement"](c)||sn["Arabic Extended-A"](c)||sn["Arabic Presentation Forms-A"](c)||sn["Arabic Presentation Forms-B"](c))}function cm(c){return!(c!==746&&c!==747&&(c<4352||!(sn["Bopomofo Extended"](c)||sn.Bopomofo(c)||sn["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||sn["CJK Compatibility Ideographs"](c)||sn["CJK Compatibility"](c)||sn["CJK Radicals Supplement"](c)||sn["CJK Strokes"](c)||!(!sn["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||sn["CJK Unified Ideographs Extension A"](c)||sn["CJK Unified Ideographs"](c)||sn["Enclosed CJK Letters and Months"](c)||sn["Hangul Compatibility Jamo"](c)||sn["Hangul Jamo Extended-A"](c)||sn["Hangul Jamo Extended-B"](c)||sn["Hangul Jamo"](c)||sn["Hangul Syllables"](c)||sn.Hiragana(c)||sn["Ideographic Description Characters"](c)||sn.Kanbun(c)||sn["Kangxi Radicals"](c)||sn["Katakana Phonetic Extensions"](c)||sn.Katakana(c)&&c!==12540||!(!sn["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!sn["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||sn["Unified Canadian Aboriginal Syllabics"](c)||sn["Unified Canadian Aboriginal Syllabics Extended"](c)||sn["Vertical Forms"](c)||sn["Yijing Hexagram Symbols"](c)||sn["Yi Syllables"](c)||sn["Yi Radicals"](c))))}function um(c){return!(cm(c)||function(i){return!!(sn["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||sn["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||sn["Letterlike Symbols"](i)||sn["Number Forms"](i)||sn["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||sn["Control Pictures"](i)&&i!==9251||sn["Optical Character Recognition"](i)||sn["Enclosed Alphanumerics"](i)||sn["Geometric Shapes"](i)||sn["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||sn["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||sn["CJK Symbols and Punctuation"](i)||sn.Katakana(i)||sn["Private Use Area"](i)||sn["CJK Compatibility Forms"](i)||sn["Small Form Variants"](i)||sn["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(c))}function hm(c){return c>=1424&&c<=2303||sn["Arabic Presentation Forms-A"](c)||sn["Arabic Presentation Forms-B"](c)}function Iv(c,i){return!(!i&&hm(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||sn.Khmer(c))}function RC(c){for(let i of c)if(hm(i.charCodeAt(0)))return!0;return!1}let dm="deferred",__="loading",y_="loaded",fm=null,Zs="unavailable",cl=null,v_=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Zs="error"),fm&&fm(c)};function id(){pm.fire(new zs("pluginStateChange",{pluginStatus:Zs,pluginURL:cl}))}let pm=new Ol,x_=function(){return Zs},Pv=function(){if(Zs!==dm||!cl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Zs=__,id(),cl&&Aa({url:cl},c=>{c?v_(c):(Zs=y_,id())})},Ws={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Zs===y_||Ws.applyArabicShaping!=null,isLoading:()=>Zs===__,setState(c){Zs=c.pluginStatus,cl=c.pluginURL},isParsed:()=>Ws.applyArabicShaping!=null&&Ws.processBidirectionalText!=null&&Ws.processStyledBidirectionalText!=null,getPluginURL:()=>cl};class _r{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(a,u){for(let m of a)if(!Iv(m.charCodeAt(0),u))return!1;return!0}(i,Ws.isLoaded())}}class kf{constructor(i,a,u,m){this.property=i,this.value=a,this.expression=function(d,g,b,T){if(nm(d))return new om(d,g);if(g_(d)||Array.isArray(d)&&d.length>0){let O=Cv(d,g,b,T);if(O.result==="error")throw new Error(O.value.map(x=>`${x.key}: ${x.message}`).join(", "));return O.value}{let O=d;return typeof d=="string"&&g.type==="color"&&(O=oi.parse(d)),{kind:"constant",configDependencies:new Set,evaluate:()=>O}}}(a===void 0?i.specification.default:a,i.specification,u,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,a,u){return this.property.possiblyEvaluate(this,i,a,u)}}class rd{constructor(i,a,u){this.property=i,this.value=new kf(i,void 0,a,u)}transitioned(i,a){return new Dv(this.property,this.value,a,Oo({},i.transition,this.transition),i.now)}untransitioned(){return new Dv(this.property,this.value,null,{},0)}}class rh{constructor(i,a,u){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=a,this._options=u,this.configDependencies=new Set}getValue(i){return Ls(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new rd(this._values[i].property,this._scope,this._options)),this._values[i].value=new kf(this._values[i].property,a===null?void 0:Ls(a),this._scope,this._options),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,a){a&&(this._options=a);let u=this._properties.properties;if(i)for(let m in i){let d=i[m];if(Da(m,"-transition")){let g=m.slice(0,-11);u[g]&&this.setTransition(g,d)}else u.hasOwnProperty(m)&&this.setValue(m,d)}}getTransition(i){return Ls(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new rd(this._values[i].property)),this._values[i].transition=Ls(a)||void 0}serialize(){let i={};for(let a of Object.keys(this._values)){let u=this.getValue(a);u!==void 0&&(i[a]=u);let m=this.getTransition(a);m!==void 0&&(i[`${a}-transition`]=m)}return i}transitioned(i,a){let u=new Ov(this._properties);for(let m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(i,a._values[m]);return u}untransitioned(){let i=new Ov(this._properties);for(let a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}}class Dv{constructor(i,a,u,m,d){let g=m.delay||0,b=m.duration||0;d=d||0,this.property=i,this.value=a,this.begin=d+g,this.end=this.begin+b,i.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(i,a,u){let m=i.now||0,d=this.value.possiblyEvaluate(i,a,u),g=this.prior;if(g){if(m>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(m<this.begin)return g.possiblyEvaluate(i,a,u);{let b=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(i,a,u),d,Ya(b))}}return d}}class Ov{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,u){let m=new sd(this._properties);for(let d of Object.keys(this._values))m._values[d]=this._values[d].possiblyEvaluate(i,a,u);return m}hasTransition(){for(let i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class kC{constructor(i,a,u){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=a,this._options=u,this.configDependencies=new Set}getValue(i){return Ls(this._values[i].value)}setValue(i,a){this._values[i]=new kf(this._values[i].property,a===null?void 0:Ls(a),this._scope,this._options),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){let i={};for(let a of Object.keys(this._values)){let u=this.getValue(a);u!==void 0&&(i[a]=u)}return i}possiblyEvaluate(i,a,u){let m=new sd(this._properties);for(let d of Object.keys(this._values))m._values[d]=this._values[d].possiblyEvaluate(i,a,u);return m}}class od{constructor(i,a,u){this.property=i,this.value=a,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,a,u,m){return this.property.evaluate(this.value,this.parameters,i,a,u,m)}}class sd{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Et{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,u){let m=li[this.specification.type];return m?m(i,a,u):i}}class Gt{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,u,m){return new od(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(a,null,{},u,m)}:i.expression,a)}interpolate(i,a,u){if(i.value.kind!=="constant"||a.value.kind!=="constant")return i;if(i.value.value===void 0||a.value.value===void 0)return new od(this,{kind:"constant",value:void 0},i.parameters);let m=li[this.specification.type];return m?new od(this,{kind:"constant",value:m(i.value.value,a.value.value,u)},i.parameters):i}evaluate(i,a,u,m,d,g){return i.kind==="constant"?i.value:i.evaluate(a,u,m,d,g)}}class ad{constructor(i){this.specification=i}possiblyEvaluate(i,a,u,m){return!!i.expression.evaluate(a,null,{},u,m)}interpolate(){return!1}}class Ar{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let a=new _r(0,{});for(let u in i){let m=i[u];m.specification.overridable&&this.overridableProperties.push(u);let d=this.defaultPropertyValues[u]=new kf(m,void 0),g=this.defaultTransitionablePropertyValues[u]=new rd(m);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=d.possiblyEvaluate(a)}}}Xt(Gt,"DataDrivenProperty"),Xt(Et,"DataConstantProperty"),Xt(ad,"ColorRampProperty");var qe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Av(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function mm(c){if(Array.isArray(c))return c.map(mm);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){let i={};for(let a in c)i[a]=mm(c[a]);return i}return Av(c)}function b_(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(let i of c.slice(1))if(!b_(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function Rv(c,i="",a=null,u="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};b_(c)||(c=Lf(c));let m=c,d=!0;try{d=function(x){if(!ld(x))return x;let E=mm(x);return Lv(E),E=kv(E),E}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}let g=null,b=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){b=qe[`filter_${u}`];let x=Af(d,b,i,a);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,P,M)=>x.value.evaluate(E,P,{},M)}let T=null,O=null;if(d!==m){let x=Af(m,b,i,a);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));T=(E,P,M,I,R)=>x.value.evaluate(E,P,{},M,void 0,void 0,I,R),O=!ka(x.value.expression)}return{filter:g,dynamicFilter:T||void 0,needGeometry:w_(d),needFeature:!!O}}function kv(c){if(!Array.isArray(c))return c;let i=function(a){if(LC.has(a[0])){for(let u=1;u<a.length;u++)if(ld(a[u]))return!0}return a}(c);return i===!0?i:i.map(a=>kv(a))}function Lv(c){let i=!1,a=[];if(c[0]==="case"){for(let u=1;u<c.length-1;u+=2)i=i||ld(c[u]),a.push(c[u+1]);a.push(c[c.length-1])}else if(c[0]==="match"){i=i||ld(c[1]);for(let u=2;u<c.length-1;u+=2)a.push(c[u+1]);a.push(c[c.length-1])}else if(c[0]==="step"){i=i||ld(c[1]);for(let u=1;u<c.length-1;u+=2)a.push(c[u+1])}i&&(c.length=0,c.push("any",...a));for(let u=1;u<c.length;u++)Lv(c[u])}function ld(c){if(!Array.isArray(c))return!1;if((i=c[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let a=1;a<c.length;a++)if(ld(c[a]))return!0;return!1}let LC=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function cd(c,i){return c<i?-1:c>i?1:0}function w_(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let i=1;i<c.length;i++)if(w_(c[i]))return!0;return!1}function Lf(c){if(!c)return!0;let i=c[0];return c.length<=1?i!=="any":i==="=="?ud(c[1],c[2],"=="):i==="!="?ul(ud(c[1],c[2],"==")):i==="<"||i===">"||i==="<="||i===">="?ud(c[1],c[2],i):i==="any"?(a=c.slice(1),["any"].concat(a.map(Lf))):i==="all"?["all"].concat(c.slice(1).map(Lf)):i==="none"?["all"].concat(c.slice(1).map(Lf).map(ul)):i==="in"?Fv(c[1],c.slice(2)):i==="!in"?ul(Fv(c[1],c.slice(2))):i==="has"?Nv(c[1]):i!=="!has"||ul(Nv(c[1]));var a}function ud(c,i,a){switch(c){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,c,i]}}function Fv(c,i){if(i.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",c,["literal",i.sort(cd)]]:["filter-in-small",c,["literal",i]]}}function Nv(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function ul(c){return["!",c]}let Ff="";function Es(c,i){return i?`${c}${Ff}${i}`:c}let zv="-transition",FC=new Set(["fill","line","background","hillshade","raster"]);class Ss extends Ol{constructor(i,a,u,m,d){if(super(),this.id=i.id,this.fqid=Es(this.id,u),this.type=i.type,this.scope=u,this.lut=m,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;let g=Af(this.filter,qe[`filter_${i.type}`]);g.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...g.value.configDependencies]))}if(i.slot&&(this.slot=i.slot),a.layout&&(this._unevaluatedLayout=new kC(a.layout,this.scope,d),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new rh(a.paint,this.scope,d);for(let g in i.paint)this.setPaintProperty(g,i.paint[g]);for(let g in i.layout)this.setLayoutProperty(g,i.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new sd(a.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D()&&FC.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a){if(this.type==="custom"&&i==="visibility")return void(this.visibility=a);let u=this._unevaluatedLayout;u._properties.properties[i]&&(u.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),i==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return Da(i,zv)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,a){let u=this._transitionablePaint,m=u._properties.properties;if(Da(i,zv)){let E=i.slice(0,-11);return m[E]&&u.setTransition(E,a||void 0),!1}if(!m[i])return!1;let d=u._values[i],g=d.value.isDataDriven(),b=d.value;u.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);let T=u._values[i].value,O=T.isDataDriven(),x=Da(i,"pattern")||i==="line-dasharray";return O||g||x||this._handleOverridablePaintPropertyUpdate(i,b,T)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,a,u){return null}_handleOverridablePaintPropertyUpdate(i,a,u){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){return tc({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let i in this.paint._values){let a=this.paint.get(i);if(a instanceof od&&td(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=Rv(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(i){}queryIntersectsFeature(i,a,u,m,d,g,b,T,O){}}let NC={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Nf{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&(i.isTransferred=!0,a.add(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){let a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ti(c,i=1){let a=0,u=0;return{members:c.map(m=>{let d=NC[m.type].BYTES_PER_ELEMENT,g=a=zf(a,Math.max(i,d)),b=m.components||1;return u=Math.max(u,d),a+=d*b,{name:m.name,type:m.type,components:b,offset:g}}),size:zf(a,Math.max(u,i)),alignment:i}}function zf(c,i){return Math.ceil(c/i)*i}class yc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){let u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){let m=2*i;return this.int16[m+0]=a,this.int16[m+1]=u,i}}yc.prototype.bytesPerElement=4,Xt(yc,"StructArrayLayout2i4");class hd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u){let m=this.length;return this.resize(m+1),this.emplace(m,i,a,u)}emplace(i,a,u,m){let d=3*i;return this.int16[d+0]=a,this.int16[d+1]=u,this.int16[d+2]=m,i}}hd.prototype.bytesPerElement=6,Xt(hd,"StructArrayLayout3i6");class dd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,m){let d=this.length;return this.resize(d+1),this.emplace(d,i,a,u,m)}emplace(i,a,u,m,d){let g=4*i;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=m,this.int16[g+3]=d,i}}dd.prototype.bytesPerElement=8,Xt(dd,"StructArrayLayout4i8");class Na extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d){let g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,m,d)}emplace(i,a,u,m,d,g){let b=5*i;return this.int16[b+0]=a,this.int16[b+1]=u,this.int16[b+2]=m,this.int16[b+3]=d,this.int16[b+4]=g,i}}Na.prototype.bytesPerElement=10,Xt(Na,"StructArrayLayout5i10");class C_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b){let T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,m,d,g,b)}emplace(i,a,u,m,d,g,b,T){let O=6*i,x=12*i,E=3*i;return this.int16[O+0]=a,this.int16[O+1]=u,this.uint8[x+4]=m,this.uint8[x+5]=d,this.uint8[x+6]=g,this.uint8[x+7]=b,this.float32[E+2]=T,i}}C_.prototype.bytesPerElement=12,Xt(C_,"StructArrayLayout2i4ub1f12");class vc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m){let d=this.length;return this.resize(d+1),this.emplace(d,i,a,u,m)}emplace(i,a,u,m,d){let g=4*i;return this.float32[g+0]=a,this.float32[g+1]=u,this.float32[g+2]=m,this.float32[g+3]=d,i}}vc.prototype.bytesPerElement=16,Xt(vc,"StructArrayLayout4f16");class lu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u){let m=this.length;return this.resize(m+1),this.emplace(m,i,a,u)}emplace(i,a,u,m){let d=3*i;return this.float32[d+0]=a,this.float32[d+1]=u,this.float32[d+2]=m,i}}lu.prototype.bytesPerElement=12,Xt(lu,"StructArrayLayout3f12");class cu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d){let g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,m,d)}emplace(i,a,u,m,d,g){let b=6*i,T=3*i;return this.uint16[b+0]=a,this.uint16[b+1]=u,this.uint16[b+2]=m,this.uint16[b+3]=d,this.float32[T+2]=g,i}}cu.prototype.bytesPerElement=12,Xt(cu,"StructArrayLayout4ui1f12");class gm extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,m){let d=this.length;return this.resize(d+1),this.emplace(d,i,a,u,m)}emplace(i,a,u,m,d){let g=4*i;return this.uint16[g+0]=a,this.uint16[g+1]=u,this.uint16[g+2]=m,this.uint16[g+3]=d,i}}gm.prototype.bytesPerElement=8,Xt(gm,"StructArrayLayout4ui8");class _m extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g){let b=this.length;return this.resize(b+1),this.emplace(b,i,a,u,m,d,g)}emplace(i,a,u,m,d,g,b){let T=6*i;return this.int16[T+0]=a,this.int16[T+1]=u,this.int16[T+2]=m,this.int16[T+3]=d,this.int16[T+4]=g,this.int16[T+5]=b,i}}_m.prototype.bytesPerElement=12,Xt(_m,"StructArrayLayout6i12");class M_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b,T,O,x,E,P){let M=this.length;return this.resize(M+1),this.emplace(M,i,a,u,m,d,g,b,T,O,x,E,P)}emplace(i,a,u,m,d,g,b,T,O,x,E,P,M){let I=12*i;return this.int16[I+0]=a,this.int16[I+1]=u,this.int16[I+2]=m,this.int16[I+3]=d,this.uint16[I+4]=g,this.uint16[I+5]=b,this.uint16[I+6]=T,this.uint16[I+7]=O,this.int16[I+8]=x,this.int16[I+9]=E,this.int16[I+10]=P,this.int16[I+11]=M,i}}M_.prototype.bytesPerElement=24,Xt(M_,"StructArrayLayout4i4ui4i24");class T_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g){let b=this.length;return this.resize(b+1),this.emplace(b,i,a,u,m,d,g)}emplace(i,a,u,m,d,g,b){let T=10*i,O=5*i;return this.int16[T+0]=a,this.int16[T+1]=u,this.int16[T+2]=m,this.float32[O+2]=d,this.float32[O+3]=g,this.float32[O+4]=b,i}}T_.prototype.bytesPerElement=20,Xt(T_,"StructArrayLayout3i3f20");class E_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){let a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}E_.prototype.bytesPerElement=4,Xt(E_,"StructArrayLayout1ul4");class uu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){let u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){let m=2*i;return this.uint16[m+0]=a,this.uint16[m+1]=u,i}}uu.prototype.bytesPerElement=4,Xt(uu,"StructArrayLayout2ui4");class S_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b,T,O,x,E,P,M){let I=this.length;return this.resize(I+1),this.emplace(I,i,a,u,m,d,g,b,T,O,x,E,P,M)}emplace(i,a,u,m,d,g,b,T,O,x,E,P,M,I){let R=20*i,V=10*i;return this.int16[R+0]=a,this.int16[R+1]=u,this.int16[R+2]=m,this.int16[R+3]=d,this.int16[R+4]=g,this.float32[V+3]=b,this.float32[V+4]=T,this.float32[V+5]=O,this.float32[V+6]=x,this.int16[R+14]=E,this.uint32[V+8]=P,this.uint16[R+18]=M,this.uint16[R+19]=I,i}}S_.prototype.bytesPerElement=40,Xt(S_,"StructArrayLayout5i4f1i1ul2ui40");class Bf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b){let T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,m,d,g,b)}emplace(i,a,u,m,d,g,b,T){let O=8*i;return this.int16[O+0]=a,this.int16[O+1]=u,this.int16[O+2]=m,this.int16[O+4]=d,this.int16[O+5]=g,this.int16[O+6]=b,this.int16[O+7]=T,i}}Bf.prototype.bytesPerElement=16,Xt(Bf,"StructArrayLayout3i2i2i16");class I_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d){let g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,m,d)}emplace(i,a,u,m,d,g){let b=4*i,T=8*i;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=m,this.int16[T+6]=d,this.int16[T+7]=g,i}}I_.prototype.bytesPerElement=16,Xt(I_,"StructArrayLayout2f1f2i16");class P_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g){let b=this.length;return this.resize(b+1),this.emplace(b,i,a,u,m,d,g)}emplace(i,a,u,m,d,g,b){let T=20*i,O=5*i;return this.uint8[T+0]=a,this.uint8[T+1]=u,this.float32[O+1]=m,this.float32[O+2]=d,this.float32[O+3]=g,this.float32[O+4]=b,i}}P_.prototype.bytesPerElement=20,Xt(P_,"StructArrayLayout2ub4f20");class qo extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u){let m=this.length;return this.resize(m+1),this.emplace(m,i,a,u)}emplace(i,a,u,m){let d=3*i;return this.uint16[d+0]=a,this.uint16[d+1]=u,this.uint16[d+2]=m,i}}qo.prototype.bytesPerElement=6,Xt(qo,"StructArrayLayout3ui6");class ym extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V,j,Z,W,G,X){let J=this.length;return this.resize(J+1),this.emplace(J,i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V,j,Z,W,G,X)}emplace(i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V,j,Z,W,G,X,J){let te=30*i,fe=15*i,de=60*i;return this.int16[te+0]=a,this.int16[te+1]=u,this.int16[te+2]=m,this.float32[fe+2]=d,this.float32[fe+3]=g,this.uint16[te+8]=b,this.uint16[te+9]=T,this.uint32[fe+5]=O,this.uint32[fe+6]=x,this.uint32[fe+7]=E,this.uint16[te+16]=P,this.uint16[te+17]=M,this.uint16[te+18]=I,this.float32[fe+10]=R,this.float32[fe+11]=V,this.uint8[de+48]=j,this.uint8[de+49]=Z,this.uint8[de+50]=W,this.uint32[fe+13]=G,this.int16[te+28]=X,this.uint8[de+58]=J,i}}ym.prototype.bytesPerElement=60,Xt(ym,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class vm extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V,j,Z,W,G,X,J,te,fe,de,he,Ce,me,Me,Oe,Pe,ke){let Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V,j,Z,W,G,X,J,te,fe,de,he,Ce,me,Me,Oe,Pe,ke)}emplace(i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V,j,Z,W,G,X,J,te,fe,de,he,Ce,me,Me,Oe,Pe,ke,Ne){let Be=20*i,Le=40*i,it=80*i;return this.float32[Be+0]=a,this.float32[Be+1]=u,this.int16[Le+4]=m,this.int16[Le+5]=d,this.int16[Le+6]=g,this.int16[Le+7]=b,this.int16[Le+8]=T,this.int16[Le+9]=O,this.int16[Le+10]=x,this.int16[Le+11]=E,this.int16[Le+12]=P,this.uint16[Le+13]=M,this.uint16[Le+14]=I,this.uint16[Le+15]=R,this.uint16[Le+16]=V,this.uint16[Le+17]=j,this.uint16[Le+18]=Z,this.uint16[Le+19]=W,this.uint16[Le+20]=G,this.uint16[Le+21]=X,this.uint16[Le+22]=J,this.uint16[Le+23]=te,this.uint16[Le+24]=fe,this.uint16[Le+25]=de,this.uint16[Le+26]=he,this.uint16[Le+27]=Ce,this.uint32[Be+14]=me,this.float32[Be+15]=Me,this.float32[Be+16]=Oe,this.float32[Be+17]=Pe,this.float32[Be+18]=ke,this.uint8[it+76]=Ne,i}}vm.prototype.bytesPerElement=80,Xt(vm,"StructArrayLayout2f9i15ui1ul4f1ub80");class za extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){let a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}za.prototype.bytesPerElement=4,Xt(za,"StructArrayLayout1f4");class hu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d){let g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,m,d)}emplace(i,a,u,m,d,g){let b=5*i;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=m,this.float32[b+3]=d,this.float32[b+4]=g,i}}hu.prototype.bytesPerElement=20,Xt(hu,"StructArrayLayout5f20");class D_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b){let T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,m,d,g,b)}emplace(i,a,u,m,d,g,b,T){let O=7*i;return this.float32[O+0]=a,this.float32[O+1]=u,this.float32[O+2]=m,this.float32[O+3]=d,this.float32[O+4]=g,this.float32[O+5]=b,this.float32[O+6]=T,i}}D_.prototype.bytesPerElement=28,Xt(D_,"StructArrayLayout7f28");class O_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b,T,O,x,E){let P=this.length;return this.resize(P+1),this.emplace(P,i,a,u,m,d,g,b,T,O,x,E)}emplace(i,a,u,m,d,g,b,T,O,x,E,P){let M=11*i;return this.float32[M+0]=a,this.float32[M+1]=u,this.float32[M+2]=m,this.float32[M+3]=d,this.float32[M+4]=g,this.float32[M+5]=b,this.float32[M+6]=T,this.float32[M+7]=O,this.float32[M+8]=x,this.float32[M+9]=E,this.float32[M+10]=P,i}}O_.prototype.bytesPerElement=44,Xt(O_,"StructArrayLayout11f44");class A_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b,T,O){let x=this.length;return this.resize(x+1),this.emplace(x,i,a,u,m,d,g,b,T,O)}emplace(i,a,u,m,d,g,b,T,O,x){let E=9*i;return this.float32[E+0]=a,this.float32[E+1]=u,this.float32[E+2]=m,this.float32[E+3]=d,this.float32[E+4]=g,this.float32[E+5]=b,this.float32[E+6]=T,this.float32[E+7]=O,this.float32[E+8]=x,i}}A_.prototype.bytesPerElement=36,Xt(A_,"StructArrayLayout9f36");class xc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){let u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){let m=2*i;return this.float32[m+0]=a,this.float32[m+1]=u,i}}xc.prototype.bytesPerElement=8,Xt(xc,"StructArrayLayout2f8");class xm extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,m){let d=this.length;return this.resize(d+1),this.emplace(d,i,a,u,m)}emplace(i,a,u,m,d){let g=6*i;return this.uint32[3*i+0]=a,this.uint16[g+2]=u,this.uint16[g+3]=m,this.uint16[g+4]=d,i}}xm.prototype.bytesPerElement=12,Xt(xm,"StructArrayLayout1ul3ui12");class R_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){let a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}R_.prototype.bytesPerElement=2,Xt(R_,"StructArrayLayout1ui2");class bm extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V){let j=this.length;return this.resize(j+1),this.emplace(j,i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V)}emplace(i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V,j){let Z=16*i;return this.float32[Z+0]=a,this.float32[Z+1]=u,this.float32[Z+2]=m,this.float32[Z+3]=d,this.float32[Z+4]=g,this.float32[Z+5]=b,this.float32[Z+6]=T,this.float32[Z+7]=O,this.float32[Z+8]=x,this.float32[Z+9]=E,this.float32[Z+10]=P,this.float32[Z+11]=M,this.float32[Z+12]=I,this.float32[Z+13]=R,this.float32[Z+14]=V,this.float32[Z+15]=j,i}}bm.prototype.bytesPerElement=64,Xt(bm,"StructArrayLayout16f64");class wm extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,d,g,b){let T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,m,d,g,b)}emplace(i,a,u,m,d,g,b,T){let O=10*i,x=5*i;return this.uint16[O+0]=a,this.uint16[O+1]=u,this.uint16[O+2]=m,this.uint16[O+3]=d,this.float32[x+2]=g,this.float32[x+3]=b,this.float32[x+4]=T,i}}wm.prototype.bytesPerElement=20,Xt(wm,"StructArrayLayout4ui3f20");class Cm extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){let a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.int16[1*i+0]=a,i}}Cm.prototype.bytesPerElement=2,Xt(Cm,"StructArrayLayout1i2");class fd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){let a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint8[1*i+0]=a,i}}fd.prototype.bytesPerElement=1,Xt(fd,"StructArrayLayout1ub1");class Bv extends Nf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Bv.prototype.size=40;class Vv extends S_{get(i){return new Bv(this,i)}}Xt(Vv,"CollisionBoxArray");class jv extends Nf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}jv.prototype.size=60;class Uv extends ym{get(i){return new jv(this,i)}}Xt(Uv,"PlacedSymbolArray");class Hv extends Nf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Hv.prototype.size=80;class Vf extends vm{get(i){return new Hv(this,i)}}Xt(Vf,"SymbolInstanceArray");class jf extends za{getoffsetX(i){return this.float32[1*i+0]}}Xt(jf,"GlyphOffsetArray");class Ys extends yc{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Xt(Ys,"SymbolLineVertexArray");class Uf extends Nf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Uf.prototype.size=12;class $v extends xm{get(i){return new Uf(this,i)}}Xt($v,"FeatureIndexArray");class Gv extends uu{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Xt(Gv,"FillExtrusionCentroidArray");class qv extends Nf{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}qv.prototype.size=6;class Zv extends hd{get(i){return new qv(this,i)}}Xt(Zv,"FillExtrusionWallArray");let k_=Ti([{name:"a_pos",components:2,type:"Int16"}],4),zC=Ti([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Rr{constructor(i=[]){this.segments=i}_prepareSegment(i,a,u,m){let d=this.segments[this.segments.length-1];return i>Rr.MAX_VERTEX_ARRAY_LENGTH&&Wn(`Max vertices per segment is ${Rr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!d||d.vertexLength+i>Rr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==m)&&(d={vertexOffset:a,primitiveOffset:u,vertexLength:0,primitiveLength:0},m!==void 0&&(d.sortKey=m),this.segments.push(d)),d}prepareSegment(i,a,u,m){return this._prepareSegment(i,a.length,u.length,m)}get(){return this.segments}destroy(){for(let i of this.segments)for(let a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,u,m){return new Rr([{vertexOffset:i,primitiveOffset:a,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function Wv(c,i){return 256*(c=Rn(Math.floor(c),0,255))+Rn(Math.floor(i),0,255)}Rr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xt(Rr,"SegmentVector");let BC=Ti([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),L_=Ti([{name:"a_dash",components:4,type:"Uint16"}]);class Hf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,a,u,m){this.ids.push(F_(i)),this.positions.push(a,u,m)}eachPosition(i,a){let u=F_(i),m=0,d=this.ids.length-1;for(;m<d;){let g=m+d>>1;this.ids[g]>=u?d=g:m=g+1}for(;this.ids[m]===u;)a(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(i,a){let u=new Float64Array(i.ids),m=new Uint32Array(i.positions);return Mm(u,m,0,u.length-1),a&&(a.add(u.buffer),a.add(m.buffer)),{ids:u,positions:m}}static deserialize(i){let a=new Hf,u;a.ids=i.ids,a.positions=i.positions;for(let m of a.ids)m!==u&&a.uniqueIds.push(m),u=m;return a.indexed=!0,a}}function F_(c){let i=+c;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:sa(String(c))}function Mm(c,i,a,u){for(;a<u;){let m=c[a+u>>1],d=a-1,g=u+1;for(;;){do d++;while(c[d]<m);do g--;while(c[g]>m);if(d>=g)break;Tm(c,d,g),Tm(i,3*d,3*g),Tm(i,3*d+1,3*g+1),Tm(i,3*d+2,3*g+2)}g-a<u-g?(Mm(c,i,a,g),a=g+1):(Mm(c,i,g+1,u),u=g)}}function Tm(c,i,a){let u=c[i];c[i]=c[a],c[a]=u}Xt(Hf,"FeaturePositionMap");class hl{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}set(i,a,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class oh extends hl{constructor(i){super(i),this.current=0}set(i,a,u){this.fetchUniformLocation(i,a)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Hr extends hl{constructor(i){super(i),this.current=0}set(i,a,u){this.fetchUniformLocation(i,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Bl extends hl{constructor(i){super(i),this.current=[0,0]}set(i,a,u){this.fetchUniformLocation(i,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Em extends hl{constructor(i){super(i),this.current=[0,0,0]}set(i,a,u){this.fetchUniformLocation(i,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Sm extends hl{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,u){this.fetchUniformLocation(i,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Im extends hl{constructor(i){super(i),this.current=oi.transparent.toRenderColor(null)}set(i,a,u){this.fetchUniformLocation(i,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}let VC=new Float32Array(16);class $f extends hl{constructor(i){super(i),this.current=VC}set(i,a,u){if(this.fetchUniformLocation(i,a)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let m=1;m<16;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}let jC=new Float32Array(9),UC=new Float32Array(4);class Pm extends hl{constructor(i){super(i),this.current=UC}set(i,a,u){if(this.fetchUniformLocation(i,a)){for(let m=0;m<4;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function N_(c){return[Wv(255*c.r,255*c.g),Wv(255*c.b,255*c.a)]}class pd{constructor(i,a,u,m){this.value=i,this.uniformNames=a.map(d=>`u_${d}`),this.type=u,this.context=m}setUniform(i,a,u,m,d){let g=m.constantOr(this.value);a.set(i,d,g instanceof oi?g.toRenderColor(this.ignoreLut?null:this.context.lut):g)}getBinding(i,a){return this.type==="color"?new Im(i):new Hr(i)}}class md{constructor(i,a){this.uniformNames=a.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,a,u,m,d){let g=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;g&&a.set(i,d,g)}getBinding(i,a){return a==="u_pattern"||a==="u_dash"?new Sm(i):new Hr(i)}}class bc{constructor(i,a,u,m){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(d=>({name:`a_${d}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(i,a,u,m,d,g,b){let T=this.paintVertexArray.length,O=this.expression.evaluate(new _r(0,{brightness:g}),a,{},d,m,b);this.paintVertexArray.resize(i),this._setPaintValue(T,i,O,this.context)}updatePaintArray(i,a,u,m,d,g,b){let T=this.expression.evaluate({zoom:0,brightness:b},u,m,void 0,d);this._setPaintValue(i,a,T,this.context)}_setPaintValue(i,a,u,m){if(this.type==="color"){let d=N_(u.toRenderColor(this.ignoreLut?null:m.lut));for(let g=i;g<a;g++)this.paintVertexArray.emplace(g,d[0],d[1])}else{for(let d=i;d<a;d++)this.paintVertexArray.emplace(d,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dl{constructor(i,a,u,m,d,g){this.expression=i,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=m,this.context=d,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,a,u,m,d,g,b){let T=this.expression.evaluate(new _r(this.context.zoom,{brightness:g}),a,{},d,m,b),O=this.expression.evaluate(new _r(this.context.zoom+1,{brightness:g}),a,{},d,m,b),x=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(x,i,T,O,this.context)}updatePaintArray(i,a,u,m,d,g,b){let T=this.expression.evaluate({zoom:this.context.zoom,brightness:b},u,m,void 0,d),O=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},u,m,void 0,d);this._setPaintValue(i,a,T,O,this.context)}_setPaintValue(i,a,u,m,d){if(this.type==="color"){let g=N_(u.toRenderColor(this.ignoreLut?null:d.lut)),b=N_(u.toRenderColor(this.ignoreLut?null:d.lut));for(let T=i;T<a;T++)this.paintVertexArray.emplace(T,g[0],g[1],b[0],b[1])}else{for(let g=i;g<a;g++)this.paintVertexArray.emplace(g,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,u,m,d){let g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=Rn(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);a.set(i,d,b)}getBinding(i,a){return new Hr(i)}}class du{constructor(i,a,u,m,d){this.expression=i,this.layerId=d,this.paintVertexAttributes=(u==="array"?L_:BC).members;for(let g=0;g<a.length;++g);this.paintVertexArray=new m}populatePaintArray(i,a,u,m){let d=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(d,i,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(i,a,u,m,d,g,b){this._setPaintValues(i,a,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(i,a,u,m){if(!m||!u)return;let d=m[u];if(!d)return;let{tl:g,br:b,pixelRatio:T}=d;for(let O=i;O<a;O++)this.paintVertexArray.emplace(O,g[0],g[1],b[0],b[1],T)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sh{constructor(i,a,u=()=>!0){this.binders={},this._buffers=[],this.context=a;let m=[];for(let d in i.paint._values){let g=i.paint.get(d),b=i.paint.get(`${d}-use-theme`);if(d.endsWith("-use-theme")||!u(d)||!(g instanceof od&&td(g.property.specification)))continue;let T=HC(d,i.type),O=g.value,x=g.property.specification.type,E=!!g.property.useIntegerZoom,P=d==="line-dasharray"||d.endsWith("pattern"),M=d==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant";if(O.kind!=="constant"||M)if(O.kind==="source"||M||P){let I=Yv(d,x,"source");this.binders[d]=P?new du(O,T,x,I,i.id):new bc(O,T,x,I),m.push(`/a_${d}`)}else{let I=Yv(d,x,"composite");this.binders[d]=new dl(O,T,x,E,a,I),m.push(`/z_${d}`)}else this.binders[d]=P?new md(O.value,T):new pd(O.value,T,x,a),m.push(`/u_${d}`);b&&(this.binders[d].ignoreLut=b.constantOr("default")==="none",this.binders[d].checkUseTheme=!0)}this.cacheKey=m.sort().join("")}getMaxValue(i){let a=this.binders[i];return a instanceof bc||a instanceof dl?a.maxValue:0}populatePaintArrays(i,a,u,m,d,g,b){for(let T in this.binders){let O=this.binders[T];O.context=this.context,(O instanceof bc||O instanceof dl||O instanceof du)&&O.populatePaintArray(i,a,u,m,d,g,b)}}setConstantPatternPositions(i){for(let a in this.binders){let u=this.binders[a];u instanceof md&&u.setConstantPatternPositions(i)}}updatePaintArrays(i,a,u,m,d,g,b,T,O){let x=!1,E=Object.keys(i),P=E.length!==0&&!T,M=P?E:a.uniqueIds;this.context.lut=d.lut;for(let I in this.binders){let R=this.binders[I];if(R.context=this.context,(R instanceof bc||R instanceof dl||R instanceof du)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let V=d.paint.get(I);R.expression=V.value;for(let j of M){let Z=i[j.toString()];a.eachPosition(j,(W,G,X)=>{let J=m.feature(W);R.updatePaintArray(G,X,J,Z,g,b,O)})}if(!P)for(let j of u.uniqueIds){let Z=i[j.toString()];u.eachPosition(j,(W,G,X)=>{let J=m.feature(W);R.updatePaintArray(G,X,J,Z,g,b,O)})}x=!0}}return x}defines(){let i=[];for(let a in this.binders){let u=this.binders[a];(u instanceof pd||u instanceof md)&&i.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return i}getBinderAttributes(){let i=[];for(let a in this.binders){let u=this.binders[a];if(u instanceof bc||u instanceof dl||u instanceof du)for(let m=0;m<u.paintVertexAttributes.length;m++)i.push(u.paintVertexAttributes[m].name)}return i}getBinderUniforms(){let i=[];for(let a in this.binders){let u=this.binders[a];if(u instanceof pd||u instanceof md||u instanceof dl)for(let m of u.uniformNames)i.push(m)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){let a=[];for(let u in this.binders){let m=this.binders[u];if(m instanceof pd||m instanceof md||m instanceof dl)for(let d of m.uniformNames)a.push({name:d,property:u,binding:m.getBinding(i,d)})}return a}setUniforms(i,a,u,m,d){for(let{name:g,property:b,binding:T}of u){if(this.binders[b].checkUseTheme&&this.binders[b]instanceof pd){let O=m.get(`${b}-use-theme`);O.isConstant()&&(this.binders[b].ignoreLut=O.constantOr("default")==="none")}this.binders[b].setUniform(i,T,d,m.get(b),g)}}updatePaintBuffers(){this._buffers=[];for(let i in this.binders){let a=this.binders[i];(a instanceof bc||a instanceof dl||a instanceof du)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(i){for(let a in this.binders){let u=this.binders[a];(u instanceof bc||u instanceof dl||u instanceof du)&&u.upload(i)}this.updatePaintBuffers()}destroy(){for(let i in this.binders){let a=this.binders[i];(a instanceof bc||a instanceof dl||a instanceof du)&&a.destroy()}}}class fu{constructor(i,a,u=()=>!0){this.programConfigurations={};for(let m of i)this.programConfigurations[m.id]=new sh(m,a,u);this.needsUpload=!1,this._featureMap=new Hf,this._featureMapWithoutIds=new Hf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,a,u,m,d,g,b,T){for(let O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(i,a,m,d,g,b,T);a.id!==void 0?this._featureMap.add(a.id,u,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,u,m,d,g,b){for(let T of u)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,a,T,m,d,g,b||0)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(let a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(let i in this.programConfigurations)this.programConfigurations[i].destroy()}}let Dm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function HC(c,i){return Dm[c]||[c.replace(`${i}-`,"").replace(/-/g,"_")]}let $C={"line-pattern":{source:cu,composite:cu},"fill-pattern":{source:cu,composite:cu},"fill-extrusion-pattern":{source:cu,composite:cu},"line-dasharray":{source:gm,composite:gm}},Om={color:{source:xc,composite:vc},number:{source:za,composite:xc}};function Yv(c,i,a){let u=$C[c];return u&&u[a]||Om[i][a]}Xt(pd,"ConstantBinder"),Xt(md,"PatternConstantBinder"),Xt(bc,"SourceExpressionBinder"),Xt(du,"PatternCompositeBinder"),Xt(dl,"CompositeExpressionBinder"),Xt(sh,"ProgramConfiguration",{omit:["_buffers"]}),Xt(fu,"ProgramConfigurationSet");let Qo=Ot/Math.PI/2,z_=5,B_=6,Xv=16383,ah=64,V_=[ah,32,16],Ba=-Qo,Va=Qo;function lh(c,i,a,u=Qo){return a=Cn(a),[c*Math.sin(a)*u,-i*u,c*Math.cos(a)*u]}function ch(c,i,a){return lh(Math.cos(Cn(c)),Math.sin(Cn(c)),i,a)}let gd=63710088e-1,j_=2*Math.PI*gd;class bi{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new bi(oa(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){let a=Math.PI/180,u=this.lat*a,m=i.lat*a,d=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((i.lng-this.lng)*a);return gd*Math.acos(Math.min(d,1))}toBounds(i=0){let a=360*i/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new pu({lng:this.lng-u,lat:this.lat-a},{lng:this.lng+u,lat:this.lat+a})}toEcef(i){return ch(this.lat,this.lng,Qo+i*Qo/gd)}static convert(i){if(i instanceof bi)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new bi(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new bi(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class pu{constructor(i,a){if(i)if(a)this.setSouthWest(i).setNorthEast(a);else if(i.length===4){let u=i;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{let u=i;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(i){return this._ne=i instanceof bi?new bi(i.lng,i.lat):bi.convert(i),this}setSouthWest(i){return this._sw=i instanceof bi?new bi(i.lng,i.lat):bi.convert(i),this}extend(i){let a=this._sw,u=this._ne,m,d;if(i instanceof bi)m=i,d=i;else{if(!(i instanceof pu))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(pu.convert(i)):this.extend(bi.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(bi.convert(i)):this;if(m=i._sw,d=i._ne,!m||!d)return this}return a||u?(a.lng=Math.min(m.lng,a.lng),a.lat=Math.min(m.lat,a.lat),u.lng=Math.max(d.lng,u.lng),u.lat=Math.max(d.lat,u.lat)):(this._sw=new bi(m.lng,m.lat),this._ne=new bi(d.lng,d.lat)),this}getCenter(){return new bi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new bi(this.getWest(),this.getNorth())}getSouthEast(){return new bi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){let{lng:a,lat:u}=bi.convert(i),m=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&m}static convert(i){if(i)return i instanceof pu?i:new pu(i)}}let Kv=0,U_=25.5;function Gf(c){return j_*Math.cos(c*Math.PI/180)}function mu(c){return(180+c)/360}function wc(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function ms(c,i){return c/Gf(i)}function Xs(c){return 360*c-180}function Bo(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function H_(c,i){return c*Gf(Bo(i))}let Wr=85.051129;function f(c){return Math.cos(Cn(Rn(c,-Wr,Wr)))}function o(c,i){let a=Rn(i,Kv,U_),u=Math.pow(2,a);return f(c)*j_/(512*u)}function l(c){return 1/Math.cos(c*Math.PI/180)}function p(c,i=0){let a=Math.exp(Math.PI*(1-(c.y+i/Ot)/(1<<c.z)*2));return 80150034*a/(a*a+1)/Ot/(1<<c.z)}class y{constructor(i,a,u=0){this.x=+i,this.y=+a,this.z=+u}static fromLngLat(i,a=0){let u=bi.convert(i);return new y(mu(u.lng),wc(u.lat),ms(a,u.lat))}toLngLat(){return new bi(Xs(this.x),Bo(this.y))}toAltitude(){return H_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/j_*l(Bo(this.y))}}function v(c,i,a,u,m,d,g,b,T){let O=(i+u)/2,x=(a+m)/2,E=new We(O,x);b(E),function(P,M,I,R,V,j){let Z=I-V,W=R-j;return Math.abs((R-M)*Z-(I-P)*W)/Math.hypot(Z,W)}(E.x,E.y,d.x,d.y,g.x,g.y)>=T?(v(c,i,a,O,x,d,E,b,T),v(c,O,x,u,m,E,g,b,T)):c.push(g)}function C(c,i,a){let u=c[0],m=u.x,d=u.y;i(u);let g=[u];for(let b=1;b<c.length;b++){let T=c[b],{x:O,y:x}=T;i(T),v(g,m,d,O,x,u,T,i,a),m=O,d=x,u=T}return g}function D(c,i,a,u){if(u(i,a)){let m=i.add(a)._mult(.5);D(c,i,m,u),D(c,m,a,u)}else c.push(a)}function k(c,i){let a=c[0],u=[a];for(let m=1;m<c.length;m++){let d=c[m];D(u,a,d,i),a=d}return u}let N=Math.pow(2,14)-1,B=-N-1;function H(c,i){let a=Math.round(c.x*i),u=Math.round(c.y*i);return c.x=Rn(a,B,N),c.y=Rn(u,B,N),(a<c.x||a>c.x+1||u<c.y||u>c.y+1)&&Wn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function U(c,i,a){let u=c.loadGeometry(),m=c.extent,d=Ot/m;if(i&&a&&a.projection.isReprojectedInTileSpace){let g=1<<i.z,{scale:b,x:T,y:O,projection:x}=a,E=P=>{let M=Xs((i.x+P.x/m)/g),I=Bo((i.y+P.y/m)/g),R=x.project(M,I);P.x=(R.x*b-T)*m,P.y=(R.y*b-O)*m};for(let P=0;P<u.length;P++)if(c.type!==1)u[P]=C(u[P],E,1);else{let M=[];for(let I of u[P])I.x<0||I.x>=m||I.y<0||I.y>=m||(E(I),M.push(I));u[P]=M}}for(let g of u)for(let b of g)H(b,d);return u}function q(c,i){return{type:c.type,id:c.id,properties:c.properties,geometry:i?U(c):[]}}function ee(c,i,a,u,m){c.emplaceBack(2*i+(u+1)/2,2*a+(m+1)/2)}function Q(c,i,a){c.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class ie{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new yc,this.indexArray=new qo,this.segments=new Rr,this.programConfigurations=new fu(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}updateFootprints(i,a){}populate(i,a,u,m){let d=this.layers[0],g=[],b=null;d.type==="circle"&&(b=d.layout.get("circle-sort-key"));for(let{feature:O,id:x,index:E,sourceLayerIndex:P}of i){let M=this.layers[0]._featureFilter.needGeometry,I=q(O,M);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),I,u))continue;let R=b?b.evaluate(I,{},u):void 0,V={id:x,properties:O.properties,type:O.type,sourceLayerIndex:P,index:E,geometry:M?I.geometry:U(O,u,m),patterns:{},sortKey:R};g.push(V)}b&&g.sort((O,x)=>O.sortKey-x.sortKey);let T=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new _m,T=m.projection);for(let O of g){let{geometry:x,index:E,sourceLayerIndex:P}=O,M=i[E].feature;this.addFeature(O,x,E,a.availableImages,u,T,a.brightness),a.featureIndex.insert(M,x,E,P,this.index)}}update(i,a,u,m,d,g,b){this.programConfigurations.updatePaintArrays(i,a,d,u,m,g,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,k_.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,zC.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,a,u,m,d,g,b){for(let T of a)for(let O of T){let x=O.x,E=O.y;if(x<0||x>=Ot||E<0||E>=Ot)continue;if(g){let I=g.projectTilePoint(x,E,d),R=g.upVector(d,x,E),V=this.globeExtVertexArray;Q(V,I,R),Q(V,I,R),Q(V,I,R),Q(V,I,R)}let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),M=P.vertexLength;ee(this.layoutVertexArray,x,E,-1,-1),ee(this.layoutVertexArray,x,E,1,-1),ee(this.layoutVertexArray,x,E,1,1),ee(this.layoutVertexArray,x,E,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},m,d,b)}}function re(c,i){for(let a=0;a<c.length;a++)if(Re(i,c[a]))return!0;for(let a=0;a<i.length;a++)if(Re(c,i[a]))return!0;return!!we(c,i)}function ue(c,i,a){return!!Re(c,i)||!!be(i,c,a)}function ge(c,i){if(c.length===1)return Ie(i,c[0]);for(let a=0;a<i.length;a++){let u=i[a];for(let m=0;m<u.length;m++)if(Re(c,u[m]))return!0}for(let a=0;a<c.length;a++)if(Ie(i,c[a]))return!0;for(let a=0;a<i.length;a++)if(we(c,i[a]))return!0;return!1}function pe(c,i,a){if(c.length>1){if(we(c,i))return!0;for(let u=0;u<i.length;u++)if(be(i[u],c,a))return!0}for(let u=0;u<c.length;u++)if(be(c[u],i,a))return!0;return!1}function we(c,i){if(c.length===0||i.length===0)return!1;for(let a=0;a<c.length-1;a++){let u=c[a],m=c[a+1];for(let d=0;d<i.length-1;d++)if(xe(u,m,i[d],i[d+1]))return!0}return!1}function xe(c,i,a,u){return Oa(c,a,u)!==Oa(i,a,u)&&Oa(c,i,a)!==Oa(c,i,u)}function be(c,i,a){let u=a*a;if(i.length===1)return c.distSqr(i[0])<u;for(let m=1;m<i.length;m++)if(ve(c,i[m-1],i[m])<u)return!0;return!1}function ve(c,i,a){let u=i.distSqr(a);if(u===0)return c.distSqr(i);let m=((c.x-i.x)*(a.x-i.x)+(c.y-i.y)*(a.y-i.y))/u;return c.distSqr(m<0?i:m>1?a:a.sub(i)._mult(m)._add(i))}function Ie(c,i){let a,u,m,d=!1;for(let g=0;g<c.length;g++){a=c[g];for(let b=0,T=a.length-1;b<a.length;T=b++)u=a[b],m=a[T],u.y>i.y!=m.y>i.y&&i.x<(m.x-u.x)*(i.y-u.y)/(m.y-u.y)+u.x&&(d=!d)}return d}function Re(c,i){let a=!1;for(let u=0,m=c.length-1;u<c.length;m=u++){let d=c[u],g=c[m];d.y>i.y!=g.y>i.y&&i.x<(g.x-d.x)*(i.y-d.y)/(g.y-d.y)+d.x&&(a=!a)}return a}function Ye(c,i,a,u,m){for(let g of c)if(i<=g.x&&a<=g.y&&u>=g.x&&m>=g.y)return!0;let d=[new We(i,a),new We(i,m),new We(u,m),new We(u,a)];if(c.length>2){for(let g of d)if(Re(c,g))return!0}for(let g=0;g<c.length-1;g++)if($e(c[g],c[g+1],d))return!0;return!1}function $e(c,i,a){let u=a[0],m=a[2];if(c.x<u.x&&i.x<u.x||c.x>m.x&&i.x>m.x||c.y<u.y&&i.y<u.y||c.y>m.y&&i.y>m.y)return!1;let d=Oa(c,i,a[0]);return d!==Oa(c,i,a[1])||d!==Oa(c,i,a[2])||d!==Oa(c,i,a[3])}function Ae(c,i,a,u,m,d){let g=i.y-c.y,b=c.x-i.x;if(d=d||0){let T=g*g+b*b;if(T===0)return!0;let O=Math.sqrt(T);g/=O,b/=O}return!((a.x-c.x)*g+(a.y-c.y)*b-d<0||(u.x-c.x)*g+(u.y-c.y)*b-d<0||(m.x-c.x)*g+(m.y-c.y)*b-d<0)}function ze(c,i,a,u,m,d,g){return!(Ae(c,i,u,m,d,g)||Ae(i,a,u,m,d,g)||Ae(a,c,u,m,d,g)||Ae(u,m,c,i,a,g)||Ae(m,d,c,i,a,g)||Ae(d,u,c,i,a,g))}function at(c,i,a){let u=i.paint.get(c).value;return u.kind==="constant"?u.value:a.programConfigurations.get(i.id).getMaxValue(c)}function gt(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function St(c,i,a,u,m){if(!i[0]&&!i[1])return c;let d=We.convert(i)._mult(m);a==="viewport"&&d._rotate(-u);let g=[];for(let b=0;b<c.length;b++)g.push(c[b].sub(d));return g}function Ve(c,i,a,u){let m=We.convert(c)._mult(u);return i==="viewport"&&m._rotate(-a),m}let dt,et;Xt(ie,"CircleBucket",{omit:["layers"]});var Ct,pt={exports:{}},lt=(Ct||(Ct=1,function(c,i){(function(a){function u(d,g,b){var T=m(256*d,256*(g=Math.pow(2,b)-g-1),b),O=m(256*(d+1),256*(g+1),b);return T[0]+","+T[1]+","+O[0]+","+O[1]}function m(d,g,b){var T=2*Math.PI*6378137/256/Math.pow(2,b);return[d*T-2*Math.PI*6378137/2,g*T-2*Math.PI*6378137/2]}a.getURL=function(d,g,b,T,O,x){return x=x||{},d+"?"+["bbox="+u(b,T,O),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+g].join("&")},a.getTileBBox=u,a.getMercCoords=m,Object.defineProperty(a,"__esModule",{value:!0})})(i)}(0,pt.exports)),pt.exports);class Nt{constructor(i,a,u){this.z=i,this.x=a,this.y=u,this.key=Wt(0,i,i,a,u)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,a){let u=lt.getTileBBox(this.x,this.y,this.z),m=function(d,g,b){let T,O="";for(let x=d;x>0;x--)T=1<<x-1,O+=(g&T?1:0)+(b&T?2:0);return O}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ht{constructor(i,a){this.wrap=i,this.canonical=a,this.key=Wt(i,a.z,a.z,a.x,a.y)}}class Lt{constructor(i,a,u,m,d){this.overscaledZ=i,this.wrap=a,this.canonical=new Nt(u,+m,+d),this.key=a===0&&i===u?this.canonical.key:Wt(a,i,u,m,d)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){let a=this.canonical.z-i;return i>this.canonical.z?new Lt(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Lt(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return Wt(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{let u=this.canonical.z-i;return Wt(this.wrap*+a,i,i,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;let a=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new Lt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let a=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new Lt(a,this.wrap,a,u,m),new Lt(a,this.wrap,a,u+1,m),new Lt(a,this.wrap,a,u,m+1),new Lt(a,this.wrap,a,u+1,m+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Lt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Lt(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ht(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Wt(c,i,a,u,m){let d=1<<Math.min(a,22),g=d*(m%d)+u%d;return c&&a<22&&(g+=d*d*((c<0?-2*c-1:2*c)%(1<<2*(22-a)))),16*(32*g+a)+(i-a)}let Tn=[c=>{let i=c.canonical.x-1,a=c.wrap;return i<0&&(i=(1<<c.canonical.z)-1,a--),new Lt(c.overscaledZ,a,c.canonical.z,i,c.canonical.y)},c=>{let i=c.canonical.x+1,a=c.wrap;return i===1<<c.canonical.z&&(i=0,a++),new Lt(c.overscaledZ,a,c.canonical.z,i,c.canonical.y)},c=>new Lt(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new Lt(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];Xt(Nt,"CanonicalTileID"),Xt(Lt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let hn=Ti([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:un}=hn,In=Ti([{name:"a_pos_3",components:3,type:"Int16"}]);var si=Ti([{name:"a_pos",type:"Int16",components:2}]);class Gn{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,u){let m=Ee.vec3.dot(a,this.dir);if(Math.abs(m)<1e-6)return!1;let d=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/m;return u[0]=this.pos[0]+this.dir[0]*d,u[1]=this.pos[1]+this.dir[1]*d,u[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(i,a,u){if(Ee.vec3.equals(this.pos,i)||a===0)return u[0]=u[1]=u[2]=0,!1;let[m,d,g]=this.dir,b=this.pos[0]-i[0],T=this.pos[1]-i[1],O=this.pos[2]-i[2],x=m*m+d*d+g*g,E=2*(b*m+T*d+O*g),P=E*E-4*x*(b*b+T*T+O*O-a*a);if(P<0){let M=Math.max(-E/2,0),I=b+m*M,R=T+d*M,V=O+g*M,j=Math.hypot(I,R,V);return u[0]=I*a/j,u[1]=R*a/j,u[2]=V*a/j,!1}{let M=(-E-Math.sqrt(P))/(2*x);if(M<0){let I=Math.hypot(b,T,O);return u[0]=b*a/I,u[1]=T*a/I,u[2]=O*a/I,!1}return u[0]=b+m*M,u[1]=T+d*M,u[2]=O+g*M,!0}}}class fr{constructor(i,a,u,m,d){this.TL=i,this.TR=a,this.BR=u,this.BL=m,this.horizon=d}static fromInvProjectionMatrix(i,a,u){let m=[-1,1,1],d=[1,1,1],g=[1,-1,1],b=[-1,-1,1],T=Ee.vec3.transformMat4(m,m,i),O=Ee.vec3.transformMat4(d,d,i),x=Ee.vec3.transformMat4(g,g,i),E=Ee.vec3.transformMat4(b,b,i);return new fr(T,O,x,E,a/u)}}function tr(c,i,a){let u=1/0,m=-1/0,d=[];for(let g of c){Ee.vec3.sub(d,g,i);let b=Ee.vec3.dot(d,a);u=Math.min(u,b),m=Math.max(m,b)}return[u,m]}function Ai(c,i){let a=!0;for(let u=0;u<c.planes.length;u++){let m=c.planes[u],d=0;for(let g=0;g<i.length;g++)d+=Ee.vec3.dot(m,i[g])+m[3]>=0;if(d===0)return 0;d!==i.length&&(a=!1)}return a?2:1}function Bi(c,i){for(let a of c.projections){let u=tr(i,c.points[0],a.axis);if(a.projection[1]<u[0]||a.projection[0]>u[1])return 0}return 1}function qn(c,i){let a=0,u=[0,0,0,0];for(let m=0;m<c.length;m++)u[0]=c[m][0],u[1]=c[m][1],u[2]=c[m][2],u[3]=1,Ee.vec4.dot(u,i)>=0&&a++;return a}class ci{constructor(i,a){this.points=i||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=bn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ee.vec3.sub([],this.points[2],this.points[3]),Ee.vec3.sub([],this.points[0],this.points[3]),Ee.vec3.sub([],this.points[4],this.points[0]),Ee.vec3.sub([],this.points[5],this.points[1]),Ee.vec3.sub([],this.points[6],this.points[2]),Ee.vec3.sub([],this.points[7],this.points[3])];for(let u of this.frustumEdges){let m=[0,-u[2],u[1]],d=[u[2],0,-u[0]];this.projections.push({axis:m,projection:tr(this.points,this.points[0],m)}),this.projections.push({axis:d,projection:tr(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(i,a,u,m){let d=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>{let x=Ee.vec4.transformMat4([],O,i),E=1/x[3]/a*d;return Ee.vec4.mul(x,x,[E,E,m?1/x[3]:E,E])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(O=>{let x=Ee.vec3.sub([],g[O[0]],g[O[1]]),E=Ee.vec3.sub([],g[O[2]],g[O[1]]),P=Ee.vec3.normalize([],Ee.vec3.cross([],x,E)),M=-Ee.vec3.dot(P,g[O[1]]);return P.concat(M)}),T=[];for(let O=0;O<g.length;O++)T.push([g[O][0],g[O][1],g[O][2]]);return new ci(T,b)}intersectsPrecise(i,a,u){for(let m=0;m<a.length;m++)if(!qn(i,a[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!qn(i,this.planes[m]))return 0;for(let m of u)for(let d of this.frustumEdges){let g=Ee.vec3.cross([],m,d),b=Ee.vec3.length(g);if(b===0)continue;Ee.vec3.scale(g,g,1/b);let T=tr(this.points,this.points[0],g),O=tr(i,this.points[0],g);if(T[0]>O[1]||O[0]>T[1])return 0}return 1}containsPoint(i){for(let a of this.planes){let u=a[3];if(Ee.vec3.dot([a[0],a[1],a[2]],i)+u<0)return!1}return!0}}class bn{static fromPoints(i){let a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(let m of i)Ee.vec3.min(a,a,m),Ee.vec3.max(u,u,m);return new bn(a,u)}static fromTileIdAndHeight(i,a,u){let m=1<<i.canonical.z,d=i.canonical.x,g=i.canonical.y;return new bn([d/m,g/m,a],[(d+1)/m,(g+1)/m,u])}static applyTransform(i,a){let u=i.getCorners();for(let m=0;m<u.length;++m)Ee.vec3.transformMat4(u[m],u[m],a);return bn.fromPoints(u)}static applyTransformFast(i,a){let u=[a[12],a[13],a[14]],m=[...u];for(let d=0;d<3;d++)for(let g=0;g<3;g++){let b=a[4*g+d],T=b*i.min[g],O=b*i.max[g];u[d]+=Math.min(T,O),m[d]+=Math.max(T,O)}return new bn(u,m)}static projectAabbCorners(i,a){let u=i.getCorners();for(let m=0;m<u.length;++m)Ee.vec3.transformMat4(u[m],u[m],a);return u}constructor(i,a){this.min=i,this.max=a,this.center=Ee.vec3.scale([],Ee.vec3.add([],this.min,this.max),.5)}quadrant(i){let a=[i%2==0,i<2],u=Ee.vec3.clone(this.min),m=Ee.vec3.clone(this.max);for(let d=0;d<a.length;d++)u[d]=a[d]?this.min[d]:this.center[d],m[d]=a[d]?this.center[d]:this.max[d];return m[2]=this.max[2],new bn(u,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){let i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?Ai(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?Ai(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,a){return a||this.intersects(i)?Bi(i,this.getCorners()):0}intersectsPreciseFlat(i,a){return a||this.intersectsFlat(i)?Bi(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let a=0;a<3;++a)if(this.min[a]>i.max[a]||i.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i.min[a]),this.max[a]=Math.max(this.max[a],i.max[a])}encapsulatePoint(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i[a]),this.max[a]=Math.max(this.max[a],i[a])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}function Ei(c){return c*Qo/gd}Xt(bn,"Aabb");let Ir=[new bn([Ba,Ba,Ba],[Va,Va,Va]),new bn([Ba,Ba,Ba],[0,0,Va]),new bn([0,Ba,Ba],[Va,0,Va]),new bn([Ba,0,Ba],[0,Va,Va]),new bn([0,0,Ba],[Va,Va,Va])];function ko(c,i,a,u=!0){let m=Ee.vec3.scale([],c._camera.position,c.worldSize),d=[i,a,1,1];Ee.vec4.transformMat4(d,d,c.pixelMatrixInverse),Ee.vec4.scale(d,d,1/d[3]);let g=Ee.vec3.sub([],d,m),b=Ee.vec3.normalize([],g),T=c.globeMatrix,O=[T[12],T[13],T[14]],x=Ee.vec3.sub([],O,m),E=Ee.vec3.length(x),P=Ee.vec3.normalize([],x),M=c.worldSize/(2*Math.PI),I=Ee.vec3.dot(P,b),R=Math.asin(M/E);if(R<Math.acos(I)){if(!u)return null;let Ce=[],me=[];Ee.vec3.scale(Ce,b,E/I),Ee.vec3.normalize(me,Ee.vec3.sub(me,Ce,x)),Ee.vec3.normalize(b,Ee.vec3.add(b,x,Ee.vec3.scale(b,me,Math.tan(R)*E)))}let V=[];new Gn(m,b).closestPointOnSphere(O,M,V);let j=Ee.vec3.normalize([],Yc(T,0)),Z=Ee.vec3.normalize([],Yc(T,1)),W=Ee.vec3.normalize([],Yc(T,2)),G=Ee.vec3.dot(j,V),X=Ee.vec3.dot(Z,V),J=Ee.vec3.dot(W,V),te=Er(Math.asin(-X/M)),fe=Er(Math.atan2(G,J));fe=c.center.lng+function(Ce,me){let Me=(me-Ce+180)%360-180;return Me<-180?Me+360:Me}(c.center.lng,fe);let de=mu(fe),he=Rn(wc(te),0,1);return new y(de,he)}class Ks{constructor(i,a,u){this.a=Ee.vec3.sub([],i,u),this.b=Ee.vec3.sub([],a,u),this.center=u;let m=Ee.vec3.normalize([],this.a),d=Ee.vec3.normalize([],this.b);this.angle=Math.acos(Ee.vec3.dot(m,d))}}function es(c,i){if(c.angle===0)return null;let a;return a=c.a[i]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[i]/c.a[i]/Math.sin(c.angle)-1/Math.tan(c.angle)),a<0||a>1?null:function(u,m,d,g){let b=Math.sin(d);return u*(Math.sin((1-g)*d)/b)+m*(Math.sin(g*d)/b)}(c.a[i],c.b[i],c.angle,Rn(a,0,1))+c.center[i]}function To(c){if(c.z<=1)return Ir[c.z+2*c.y+c.x];let i=fi(Xi(c));return bn.fromPoints(i)}function eo(c,i,a){return Ee.vec3.scale(c,c,1-a),Ee.vec3.scaleAndAdd(c,c,i,a)}function Br(c,i,a){for(let u of c)Ee.vec3.transformMat4(u,u,i),Ee.vec3.scale(u,u,a)}function ar(c,i,a,u){let m=i/c.worldSize,d=c.globeMatrix;if(a.z<=1){let de=To(a).getCorners();return Br(de,d,m),bn.fromPoints(de)}let g=Xi(a,u),b=fi(g,Qo+Ei(c._tileCoverLift));Br(b,d,m);let T=Number.MAX_VALUE,O=[-T,-T,-T],x=[T,T,T];if(g.contains(c.center)){for(let Ce of b)Ee.vec3.min(x,x,Ce),Ee.vec3.max(O,O,Ce);O[2]=0;let de=c.point,he=[de.x*m,de.y*m,0];return Ee.vec3.min(x,x,he),Ee.vec3.max(O,O,he),new bn(x,O)}if(c._tileCoverLift>0){for(let de of b)Ee.vec3.min(x,x,de),Ee.vec3.max(O,O,de);return new bn(x,O)}let E=[d[12]*m,d[13]*m,d[14]*m],P=g.getCenter(),M=Rn(c.center.lat,-Wr,Wr),I=Rn(P.lat,-Wr,Wr),R=mu(c.center.lng),V=wc(M),j=R-mu(P.lng),Z=V-wc(I);j>.5?j-=1:j<-.5&&(j+=1);let W=0;if(Math.abs(j)>Math.abs(Z))W=j>=0?1:3;else{W=Z>=0?0:2;let de=[d[4]*m,d[5]*m,d[6]*m],he=-Math.sin(Cn(Z>=0?g.getSouth():g.getNorth()))*Qo;Ee.vec3.scaleAndAdd(E,E,de,he)}let G=b[W],X=b[(W+1)%4],J=new Ks(G,X,E),te=[es(J,0)||G[0],es(J,1)||G[1],es(J,2)||G[2]],fe=ts(c.zoom);if(fe>0){let de=function({x:Ce,y:me,z:Me},Oe,Pe,ke,Ne){let Be=1/(1<<Me),Le=Ce*Be,it=Le+Be,vt=me*Be,rt=vt+Be,Rt=0,Pt=(Le+it)/2-ke;return Pt>.5?Rt=-1:Pt<-.5&&(Rt=1),Le=((Le+Rt)*Oe-(ke*=Oe))*Pe+ke,it=((it+Rt)*Oe-ke)*Pe+ke,vt=(vt*Oe-(Ne*=Oe))*Pe+Ne,rt=(rt*Oe-Ne)*Pe+Ne,[[Le,rt,0],[it,rt,0],[it,vt,0],[Le,vt,0]]}(a,i,c._pixelsPerMercatorPixel,R,V);for(let Ce=0;Ce<b.length;Ce++)eo(b[Ce],de[Ce],fe);let he=Ee.vec3.add([],de[W],de[(W+1)%4]);Ee.vec3.scale(he,he,.5),eo(te,he,fe)}for(let de of b)Ee.vec3.min(x,x,de),Ee.vec3.max(O,O,de);return x[2]=Math.min(G[2],X[2]),Ee.vec3.min(x,x,te),Ee.vec3.max(O,O,te),new bn(x,O)}function Xi({x:c,y:i,z:a},u=!1){let m=1/(1<<a),d=new bi(Xs(c*m),i===(1<<a)-1&&u?-90:Bo((i+1)*m)),g=new bi(Xs((c+1)*m),i===0&&u?90:Bo(i*m));return new pu(d,g)}function fi(c,i=Qo){let a=Cn(c.getNorth()),u=Cn(c.getSouth()),m=Math.cos(a),d=Math.cos(u),g=Math.sin(a),b=Math.sin(u),T=c.getWest(),O=c.getEast();return[lh(d,b,T,i),lh(d,b,O,i),lh(m,g,O,i),lh(m,g,T,i)]}function kr(c,i,a,u){let m=1<<a.z,d=(c/Ot+a.x)/m;return ch(Bo((i/Ot+a.y)/m),Xs(d),u)}function Eo({min:c,max:i}){return Xv/Math.max(i[0]-c[0],i[1]-c[1],i[2]-c[2])}let nr=new Float64Array(16);function Zo(c){let i=Eo(c),a=Ee.mat4.fromScaling(nr,[i,i,i]);return Ee.mat4.translate(a,a,Ee.vec3.negate([],c.min))}function da(c){let i=Ee.mat4.fromTranslation(nr,c.min),a=1/Eo(c);return Ee.mat4.scale(i,i,[a,a,a])}function Is(c){let i=Ot/(2*Math.PI);return c/(2*Math.PI)/i}function Cc(c,i){return Ot/(512*Math.pow(2,c))*Eo(To(i))}function Vl(c,i,a,u,m){let d=Is(a),g=[c,i,-a/(2*Math.PI)],b=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.translate(b,b,g),Ee.mat4.scale(b,b,[d,d,d]),Ee.mat4.rotateX(b,b,Cn(-m)),Ee.mat4.rotateY(b,b,Cn(-u)),b}function ts(c){return Gc(z_,B_,c)}function fa(c,i){let a=ch(i.lat,i.lng),u=function(d){let g=ch(d._center.lat,d._center.lng),b=Ee.vec3.fromValues(0,1,0),T=Ee.vec3.cross([],b,g),O=Ee.mat4.fromRotation([],-d.angle,g);T=Ee.vec3.transformMat4(T,T,O),Ee.mat4.fromRotation(O,-d._pitch,T);let x=Ee.vec3.normalize([],g);return Ee.vec3.scale(x,x,Ei(d.cameraToCenterDistance/d.pixelsPerMeter)),Ee.vec3.transformMat4(x,x,O),Ee.vec3.add([],g,x)}(c),m=Ee.vec3.subtract([],u,a);return Ee.vec3.angle(m,a)}function Mc(c,i){return fa(c,i)>Math.PI/2*1.01}let fl=Cn(85),uh=Math.cos(fl),qf=Math.sin(fl),$_=Ee.mat4.create(),Am=c=>{let i=[];return c.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function NP(c,i,a,u,m,d,g,b,T){if(d&&c.queryGeometry.isAboveHorizon)return!1;d&&(T*=c.pixelToTileUnitsFactor);let O=c.tileID.canonical,x=a.projection.upVectorScale(O,a.center.lat,a.worldSize).metersToTile;for(let E of i)for(let P of E){let M=P.add(b),I=m&&a.elevation?a.elevation.exaggeration()*m.getElevationAt(M.x,M.y,!0):0,R=a.projection.projectTilePoint(M.x,M.y,O);if(I>0){let W=a.projection.upVector(O,M.x,M.y);R.x+=W[0]*x*I,R.y+=W[1]*x*I,R.z+=W[2]*x*I}let V=d?M:pj(R.x,R.y,R.z,u),j=d?c.tilespaceRays.map(W=>gj(W,I)):c.queryGeometry.screenGeometry,Z=Ee.vec4.transformMat4([],[R.x,R.y,R.z,1],u);if(!g&&d?T*=Z[3]/a.cameraToCenterDistance:g&&!d&&(T*=a.cameraToCenterDistance/Z[3]),d){let W=Bo((P.y/Ot+O.y)/(1<<O.z));T/=a.projection.pixelsPerMeter(W,1)/ms(1,W)}if(ue(j,V,T))return!0}return!1}function pj(c,i,a,u){let m=Ee.vec4.transformMat4([],[c,i,a,1],u);return new We(m[0]/m[3],m[1]/m[3])}let zP=Ee.vec3.fromValues(0,0,0),mj=Ee.vec3.fromValues(0,0,1);function gj(c,i){let a=Ee.vec3.create();return zP[2]=i,c.intersectsPlane(zP,mj,a),new We(a[0],a[1])}class BP extends ie{}let VP,jP,UP,HP;function $P(c,{width:i,height:a},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==i*a*u)throw new RangeError("mismatched image size")}else m=new Uint8Array(i*a*u);return c.width=i,c.height=a,c.data=m,c}function GP(c,i,a){let{width:u,height:m}=i;u===c.width&&m===c.height||(GC(c,i,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,u),height:Math.min(c.height,m)},a,null),c.width=u,c.height=m,c.data=i.data)}function GC(c,i,a,u,m,d,g,b){if(m.width===0||m.height===0)return i;if(m.width>c.width||m.height>c.height||a.x>c.width-m.width||a.y>c.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>i.width||m.height>i.height||u.x>i.width-m.width||u.y>i.height-m.height)throw new RangeError("out of range destination coordinates for image copy");let T=c.data,O=i.data,x=d===4&&b;for(let E=0;E<m.height;E++){let P=((a.y+E)*c.width+a.x)*d,M=((u.y+E)*i.width+u.x)*d;if(x)for(let I=0;I<m.width;I++){let R=P+I*d+3,V=M+I*d;O[V+0]=255,O[V+1]=255,O[V+2]=255,O[V+3]=T[R]}else if(g)for(let I=0;I<m.width;I++){let R=P+I*d,V=M+I*d,j=T[R+3],Z=new oi(T[R+0]/255*j,T[R+1]/255*j,T[R+2]/255*j,j).toRenderColor(g).toArray();O[V+0]=Z[0],O[V+1]=Z[1],O[V+2]=Z[2],O[V+3]=Z[3]}else for(let I=0;I<m.width*d;I++)O[M+I]=T[P+I]}return i}Xt(BP,"HeatmapBucket",{omit:["layers"]});class _d{constructor(i,a){$P(this,i,1,a)}resize(i){GP(this,new _d(i),1)}clone(){return new _d({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,u,m,d){GC(i,a,u,m,d,1,null)}}class gs{constructor(i,a){$P(this,i,4,a)}resize(i){GP(this,new gs(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new gs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,u,m,d,g,b){GC(i,a,u,m,d,4,g,b)}}class qP{constructor(i,a){this.width=i.width,this.height=i.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function G_(c){let i={},a=c.resolution||256,u=c.clips?c.clips.length:1,m=c.image||new gs({width:a,height:u}),d=(g,b,T)=>{i[c.evaluationKey]=T;let O=c.expression.evaluate(i);O&&(m.data[g+b+0]=Math.floor(255*O.r/O.a),m.data[g+b+1]=Math.floor(255*O.g/O.a),m.data[g+b+2]=Math.floor(255*O.b/O.a),m.data[g+b+3]=Math.floor(255*O.a))};if(c.clips)for(let g=0,b=0;g<u;++g,b+=4*a)for(let T=0,O=0;T<a;T++,O+=4){let x=T/(a-1),{start:E,end:P}=c.clips[g];d(b,O,E*(1-x)+P*x)}else for(let g=0,b=0;g<a;g++,b+=4)d(0,b,g/(a-1));return m}Xt(_d,"AlphaImage"),Xt(gs,"RGBAImage");let _j=Ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:yj}=_j;function q_(c,i,a=2){let u=i&&i.length,m=u?i[0]*a:c.length,d=ZP(c,0,m,a,!0),g=[];if(!d||d.next===d.prev)return g;let b,T,O;if(u&&(d=function(x,E,P,M){let I=[];for(let R=0,V=E.length;R<V;R++){let j=ZP(x,E[R]*M,R<V-1?E[R+1]*M:x.length,M,!1);j===j.next&&(j.steiner=!0),I.push(Ej(j))}I.sort(Cj);for(let R=0;R<I.length;R++)P=Mj(I[R],P);return P}(c,i,d,a)),c.length>80*a){b=1/0,T=1/0;let x=-1/0,E=-1/0;for(let P=a;P<m;P+=a){let M=c[P],I=c[P+1];M<b&&(b=M),I<T&&(T=I),M>x&&(x=M),I>E&&(E=I)}O=Math.max(x-b,E-T),O=O!==0?32767/O:0}return Z_(d,g,a,b,T,O,0),g}function ZP(c,i,a,u,m){let d;if(m===function(g,b,T,O){let x=0;for(let E=b,P=T-O;E<T;E+=O)x+=(g[P]-g[E])*(g[E+1]+g[P+1]),P=E;return x}(c,i,a,u)>0)for(let g=i;g<a;g+=u)d=XP(g/u|0,c[g],c[g+1],d);else for(let g=a-u;g>=i;g-=u)d=XP(g/u|0,c[g],c[g+1],d);return d&&Jv(d,d.next)&&(Y_(d),d=d.next),d}function Zf(c,i){if(!c)return c;i||(i=c);let a,u=c;do if(a=!1,u.steiner||!Jv(u,u.next)&&So(u.prev,u,u.next)!==0)u=u.next;else{if(Y_(u),u=i=u.prev,u===u.next)break;a=!0}while(a||u!==i);return i}function Z_(c,i,a,u,m,d,g){if(!c)return;!g&&d&&function(T,O,x,E){let P=T;do P.z===0&&(P.z=qC(P.x,P.y,O,x,E)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==T);P.prevZ.nextZ=null,P.prevZ=null,function(M){let I,R=1;do{let V,j=M;M=null;let Z=null;for(I=0;j;){I++;let W=j,G=0;for(let J=0;J<R&&(G++,W=W.nextZ,W);J++);let X=R;for(;G>0||X>0&&W;)G!==0&&(X===0||!W||j.z<=W.z)?(V=j,j=j.nextZ,G--):(V=W,W=W.nextZ,X--),Z?Z.nextZ=V:M=V,V.prevZ=Z,Z=V;j=W}Z.nextZ=null,R*=2}while(I>1)}(P)}(c,u,m,d);let b=c;for(;c.prev!==c.next;){let T=c.prev,O=c.next;if(d?xj(c,u,m,d):vj(c))i.push(T.i,c.i,O.i),Y_(c),c=O.next,b=O.next;else if((c=O)===b){g?g===1?Z_(c=bj(Zf(c),i),i,a,u,m,d,2):g===2&&wj(c,i,a,u,m,d):Z_(Zf(c),i,a,u,m,d,1);break}}}function vj(c){let i=c.prev,a=c,u=c.next;if(So(i,a,u)>=0)return!1;let m=i.x,d=a.x,g=u.x,b=i.y,T=a.y,O=u.y,x=m<d?m<g?m:g:d<g?d:g,E=b<T?b<O?b:O:T<O?T:O,P=m>d?m>g?m:g:d>g?d:g,M=b>T?b>O?b:O:T>O?T:O,I=u.next;for(;I!==i;){if(I.x>=x&&I.x<=P&&I.y>=E&&I.y<=M&&Rm(m,b,d,T,g,O,I.x,I.y)&&So(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function xj(c,i,a,u){let m=c.prev,d=c,g=c.next;if(So(m,d,g)>=0)return!1;let b=m.x,T=d.x,O=g.x,x=m.y,E=d.y,P=g.y,M=b<T?b<O?b:O:T<O?T:O,I=x<E?x<P?x:P:E<P?E:P,R=b>T?b>O?b:O:T>O?T:O,V=x>E?x>P?x:P:E>P?E:P,j=qC(M,I,i,a,u),Z=qC(R,V,i,a,u),W=c.prevZ,G=c.nextZ;for(;W&&W.z>=j&&G&&G.z<=Z;){if(W.x>=M&&W.x<=R&&W.y>=I&&W.y<=V&&W!==m&&W!==g&&Rm(b,x,T,E,O,P,W.x,W.y)&&So(W.prev,W,W.next)>=0||(W=W.prevZ,G.x>=M&&G.x<=R&&G.y>=I&&G.y<=V&&G!==m&&G!==g&&Rm(b,x,T,E,O,P,G.x,G.y)&&So(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;W&&W.z>=j;){if(W.x>=M&&W.x<=R&&W.y>=I&&W.y<=V&&W!==m&&W!==g&&Rm(b,x,T,E,O,P,W.x,W.y)&&So(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;G&&G.z<=Z;){if(G.x>=M&&G.x<=R&&G.y>=I&&G.y<=V&&G!==m&&G!==g&&Rm(b,x,T,E,O,P,G.x,G.y)&&So(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function bj(c,i){let a=c;do{let u=a.prev,m=a.next.next;!Jv(u,m)&&WP(u,a,a.next,m)&&W_(u,m)&&W_(m,u)&&(i.push(u.i,a.i,m.i),Y_(a),Y_(a.next),a=c=m),a=a.next}while(a!==c);return Zf(a)}function wj(c,i,a,u,m,d){let g=c;do{let b=g.next.next;for(;b!==g.prev;){if(g.i!==b.i&&Sj(g,b)){let T=YP(g,b);return g=Zf(g,g.next),T=Zf(T,T.next),Z_(g,i,a,u,m,d,0),void Z_(T,i,a,u,m,d,0)}b=b.next}g=g.next}while(g!==c)}function Cj(c,i){return c.x-i.x}function Mj(c,i){let a=function(m,d){let g=d,b=m.x,T=m.y,O,x=-1/0;do{if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){let R=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(R<=b&&R>x&&(x=R,O=g.x<g.next.x?g:g.next,R===b))return O}g=g.next}while(g!==d);if(!O)return null;let E=O,P=O.x,M=O.y,I=1/0;g=O;do{if(b>=g.x&&g.x>=P&&b!==g.x&&Rm(T<M?b:x,T,P,M,T<M?x:b,T,g.x,g.y)){let R=Math.abs(T-g.y)/(b-g.x);W_(g,m)&&(R<I||R===I&&(g.x>O.x||g.x===O.x&&Tj(O,g)))&&(O=g,I=R)}g=g.next}while(g!==E);return O}(c,i);if(!a)return i;let u=YP(a,c);return Zf(u,u.next),Zf(a,a.next)}function Tj(c,i){return So(c.prev,c,i.prev)<0&&So(i.next,c,c.next)<0}function qC(c,i,a,u,m){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-a)*m|0)|c<<8))|c<<4))|c<<2))|c<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-u)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Ej(c){let i=c,a=c;do(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next;while(i!==c);return a}function Rm(c,i,a,u,m,d,g,b){return(m-g)*(i-b)>=(c-g)*(d-b)&&(c-g)*(u-b)>=(a-g)*(i-b)&&(a-g)*(d-b)>=(m-g)*(u-b)}function Sj(c,i){return c.next.i!==i.i&&c.prev.i!==i.i&&!function(a,u){let m=a;do{if(m.i!==a.i&&m.next.i!==a.i&&m.i!==u.i&&m.next.i!==u.i&&WP(m,m.next,a,u))return!0;m=m.next}while(m!==a);return!1}(c,i)&&(W_(c,i)&&W_(i,c)&&function(a,u){let m=a,d=!1,g=(a.x+u.x)/2,b=(a.y+u.y)/2;do m.y>b!=m.next.y>b&&m.next.y!==m.y&&g<(m.next.x-m.x)*(b-m.y)/(m.next.y-m.y)+m.x&&(d=!d),m=m.next;while(m!==a);return d}(c,i)&&(So(c.prev,c,i.prev)||So(c,i.prev,i))||Jv(c,i)&&So(c.prev,c,c.next)>0&&So(i.prev,i,i.next)>0)}function So(c,i,a){return(i.y-c.y)*(a.x-i.x)-(i.x-c.x)*(a.y-i.y)}function Jv(c,i){return c.x===i.x&&c.y===i.y}function WP(c,i,a,u){let m=ex(So(c,i,a)),d=ex(So(c,i,u)),g=ex(So(a,u,c)),b=ex(So(a,u,i));return m!==d&&g!==b||!(m!==0||!Qv(c,a,i))||!(d!==0||!Qv(c,u,i))||!(g!==0||!Qv(a,c,u))||!(b!==0||!Qv(a,i,u))}function Qv(c,i,a){return i.x<=Math.max(c.x,a.x)&&i.x>=Math.min(c.x,a.x)&&i.y<=Math.max(c.y,a.y)&&i.y>=Math.min(c.y,a.y)}function ex(c){return c>0?1:c<0?-1:0}function W_(c,i){return So(c.prev,c,c.next)<0?So(c,i,c.next)>=0&&So(c,c.prev,i)>=0:So(c,i,c.prev)<0||So(c,c.next,i)<0}function YP(c,i){let a=ZC(c.i,c.x,c.y),u=ZC(i.i,i.x,i.y),m=c.next,d=i.prev;return c.next=i,i.prev=c,a.next=m,m.prev=a,u.next=a,a.prev=u,d.next=u,u.prev=d,u}function XP(c,i,a,u){let m=ZC(c,i,a);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function Y_(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function ZC(c,i,a){return{i:c,x:i,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function tx(c,i){let a=c.length;if(a<=1)return[c];let u=[],m,d;for(let g=0;g<a;g++){let b=Fu(c[g]);b!==0&&(c[g].area=Math.abs(b),d===void 0&&(d=b<0),d===b<0?(m&&u.push(m),m=[c[g]]):m.push(c[g]))}if(m&&u.push(m),i>1)for(let g=0;g<u.length;g++)u[g].length<=i||($p(u[g],i,1,u[g].length-1,Ij),u[g]=u[g].slice(0,i));return u}function Ij(c,i){return i.area-c.area}function KP(c,i){if(!c)return null;let a=typeof c=="string"?c:c.getPrimary().id;i[a]||(i[a]=[]);let u=so.from(c).getPrimary();return i[a].push(u),u.serialize()}function WC(c,i,a){let u=a.patternDependencies,m=!1;for(let d of i){let g=d.paint.get(`${c}-pattern`);g.isConstant()||(m=!0),KP(g.constantOr(null),u)&&(m=!0)}return m}function YC(c,i,a,u,m){let d=m.patternDependencies;for(let g of i){let b=g.paint.get(`${c}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:u},a,{},m.availableImages);T=T&&T.name?T.name:T;let O=KP(T,d);O&&(a.patterns[g.id]=O)}}return a}class XC{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new yc,this.indexArray=new qo,this.indexArray2=new uu,this.programConfigurations=new fu(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new Rr,this.segments2=new Rr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection}updateFootprints(i,a){}populate(i,a,u,m){this.hasPattern=WC("fill",this.layers,a);let d=this.layers[0].layout.get("fill-sort-key"),g=[];for(let{feature:b,id:T,index:O,sourceLayerIndex:x}of i){let E=this.layers[0]._featureFilter.needGeometry,P=q(b,E);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),P,u))continue;let M=d?d.evaluate(P,{},u,a.availableImages):void 0,I={id:T,properties:b.properties,type:b.type,sourceLayerIndex:x,index:O,geometry:E?P.geometry:U(b,u,m),patterns:{},sortKey:M};g.push(I)}d&&g.sort((b,T)=>b.sortKey-T.sortKey);for(let b of g){let{geometry:T,index:O,sourceLayerIndex:x}=b;if(this.hasPattern){let E=YC("fill",this.layers,b,this.zoom,a);this.patternFeatures.push(E)}else this.addFeature(b,T,O,u,{},a.availableImages,a.brightness);a.featureIndex.insert(i[O].feature,T,O,x,this.index)}}update(i,a,u,m,d,g,b){this.programConfigurations.updatePaintArrays(i,a,d,u,m,g,b)}addFeatures(i,a,u,m,d,g){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,u,m,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,yj),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,a,u,m,d,g=[],b){for(let T of tx(a,500)){let O=0;for(let R of T)O+=R.length;let x=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray),E=x.vertexLength,P=[],M=[];for(let R of T){if(R.length===0)continue;R!==T[0]&&M.push(P.length/2);let V=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),j=V.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(j+R.length-1,j),P.push(R[0].x),P.push(R[0].y);for(let Z=1;Z<R.length;Z++)this.layoutVertexArray.emplaceBack(R[Z].x,R[Z].y),this.indexArray2.emplaceBack(j+Z-1,j+Z),P.push(R[Z].x),P.push(R[Z].y);V.vertexLength+=R.length,V.primitiveLength+=R.length}let I=q_(P,M);for(let R=0;R<I.length;R+=3)this.indexArray.emplaceBack(E+I[R],E+I[R+1],E+I[R+2]);x.vertexLength+=O,x.primitiveLength+=I.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,d,g,m,b)}}let JP,QP,eD,tD;Xt(XC,"FillBucket",{omit:["layers","patternFeatures"]});class KC{constructor(i,a,u,m){if(this.triangleCount=a.length/3,this.min=new We(0,0),this.max=new We(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;let[d,g]=[i[0].clone(),i[0].clone()];for(let E=1;E<i.length;++E){let P=i[E];d.x=Math.min(d.x,P.x),d.y=Math.min(d.y,P.y),g.x=Math.max(g.x,P.x),g.y=Math.max(g.y,P.y)}if(m){let E=Math.ceil(Math.max(g.x-d.x,g.y-d.y)/m);u=Math.max(u,E)}if(u===0)return;this.min=d,this.max=g;let b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);let T=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/T)),this.cellsY=Math.max(1,Math.ceil(b.y/T)),this.xScale=1/T,this.yScale=1/T;let O=[];for(let E=0;E<this.triangleCount;E++){let P=i[a[3*E+0]].sub(this.min),M=i[a[3*E+1]].sub(this.min),I=i[a[3*E+2]].sub(this.min),R=gu(Math.floor(Math.min(P.x,M.x,I.x)),this.xScale,this.cellsX),V=gu(Math.floor(Math.max(P.x,M.x,I.x)),this.xScale,this.cellsX),j=gu(Math.floor(Math.min(P.y,M.y,I.y)),this.yScale,this.cellsY),Z=gu(Math.floor(Math.max(P.y,M.y,I.y)),this.yScale,this.cellsY),W=new We(0,0),G=new We(0,0),X=new We(0,0),J=new We(0,0);for(let te=j;te<=Z;++te){W.y=G.y=te*T,X.y=J.y=(te+1)*T;for(let fe=R;fe<=V;++fe)W.x=X.x=fe*T,G.x=J.x=(fe+1)*T,(ze(P,M,I,W,G,J)||ze(P,M,I,W,J,X))&&O.push({cellIdx:te*this.cellsX+fe,triIdx:E})}}if(O.length===0)return;O.sort((E,P)=>E.cellIdx-P.cellIdx||E.triIdx-P.triIdx);let x=0;for(;x<O.length;){let E=O[x].cellIdx,P={start:this.payload.length,len:0};for(;x<O.length&&O[x].cellIdx===E;)++P.len,this.payload.push(O[x++].triIdx);this.cells[E]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,a){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;let u=gu(i.x-this.min.x,this.xScale,this.cellsX),m=gu(i.y-this.min.y,this.yScale,this.cellsY),d=this.cells[m*this.cellsX+u];if(d){this._lazyInitLookup();for(let g=0;g<d.len;g++){let b=this.payload[d.start+g],T=Math.floor(b/8),O=1<<b%8;if(!(this.lookup[T]&O)&&(this.lookup[T]|=O,a.push(b),a.length===this.triangleCount))return}}}query(i,a,u){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>a.x||i.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();let m=gu(i.x-this.min.x,this.xScale,this.cellsX),d=gu(a.x-this.min.x,this.xScale,this.cellsX),g=gu(i.y-this.min.y,this.yScale,this.cellsY),b=gu(a.y-this.min.y,this.yScale,this.cellsY);for(let T=g;T<=b;T++)for(let O=m;O<=d;O++){let x=this.cells[T*this.cellsX+O];if(x)for(let E=0;E<x.len;E++){let P=this.payload[x.start+E],M=Math.floor(P/8),I=1<<P%8;if(!(this.lookup[M]&I)&&(this.lookup[M]|=I,u.push(P),u.length===this.triangleCount))return}}}}function gu(c,i,a){return Math.max(0,Math.min(a-1,Math.floor(c*i)))}Xt(KC,"TriangleGridIndex");class nD{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[]}updateFootprints(i,a){for(let u of this.footprints)a.push({footprint:u,id:i})}populate(i,a,u,m){let d=[];for(let{feature:g,id:b,index:T,sourceLayerIndex:O}of i){let x=this.layers[0]._featureFilter.needGeometry,E=q(g,x);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),E,u))continue;let P={id:b,properties:g.properties,type:g.type,sourceLayerIndex:O,index:T,geometry:x?E.geometry:U(g,u,m),patterns:{}};d.push(P)}for(let g of d){let{geometry:b,index:T,sourceLayerIndex:O}=g;this.addFeature(g,b,T,u,{},a.availableImages,a.brightness),a.featureIndex.insert(i[T].feature,b,T,O,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,a,u,m,d,g,b){}destroy(){}addFeature(i,a,u,m,d,g=[],b){for(let T of tx(a,2)){let O=[],x=[],E=[],P=new We(1/0,1/0),M=new We(-1/0,-1/0);for(let V of T)if(V.length!==0){V!==T[0]&&E.push(x.length/2);for(let j=0;j<V.length;j++)x.push(V[j].x),x.push(V[j].y),O.push(V[j]),P.x=Math.min(P.x,V[j].x),P.y=Math.min(P.y,V[j].y),M.x=Math.max(M.x,V[j].x),M.y=Math.max(M.y,V[j].y)}let I=q_(x,E),R=new KC(O,I,8,256);this.footprints.push({vertices:O,indices:I,grid:R,min:P,max:M})}}}Xt(nD,"ClipBucket",{omit:["layers"]});let Pj=Ti([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Dj=Ti([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Oj=Ti([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Aj=Ti([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Rj=Ti([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),kj=Ti([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Lj}=Pj;var JC,iD,QC,rD,eM,oD,sD,nx={};function aD(){if(iD)return JC;iD=1;var c=gi();function i(m,d,g,b,T){this.properties={},this.extent=g,this.type=0,this._pbf=m,this._geometry=-1,this._keys=b,this._values=T,m.readFields(a,this,d)}function a(m,d,g){m==1?d.id=g.readVarint():m==2?function(b,T){for(var O=b.readVarint()+b.pos;b.pos<O;){var x=T._keys[b.readVarint()],E=T._values[b.readVarint()];T.properties[x]=E}}(g,d):m==3?d.type=g.readVarint():m==4&&(d._geometry=g.pos)}function u(m){for(var d,g,b=0,T=0,O=m.length,x=O-1;T<O;x=T++)b+=((g=m[x]).x-(d=m[T]).x)*(d.y+g.y);return b}return JC=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var d,g=m.readVarint()+m.pos,b=1,T=0,O=0,x=0,E=[];m.pos<g;){if(T<=0){var P=m.readVarint();b=7&P,T=P>>3}if(T--,b===1||b===2)O+=m.readSVarint(),x+=m.readSVarint(),b===1&&(d&&E.push(d),d=[]),d.push(new c(O,x));else{if(b!==7)throw new Error("unknown command "+b);d&&d.push(d[0].clone())}}return d&&E.push(d),E},i.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var d=m.readVarint()+m.pos,g=1,b=0,T=0,O=0,x=1/0,E=-1/0,P=1/0,M=-1/0;m.pos<d;){if(b<=0){var I=m.readVarint();g=7&I,b=I>>3}if(b--,g===1||g===2)(T+=m.readSVarint())<x&&(x=T),T>E&&(E=T),(O+=m.readSVarint())<P&&(P=O),O>M&&(M=O);else if(g!==7)throw new Error("unknown command "+g)}return[x,P,E,M]},i.prototype.toGeoJSON=function(m,d,g){var b,T,O=this.extent*Math.pow(2,g),x=this.extent*m,E=this.extent*d,P=this.loadGeometry(),M=i.types[this.type];function I(j){for(var Z=0;Z<j.length;Z++){var W=j[Z];j[Z]=[360*(W.x+x)/O-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+E)/O)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(b=0;b<P.length;b++)R[b]=P[b][0];I(P=R);break;case 2:for(b=0;b<P.length;b++)I(P[b]);break;case 3:for(P=function(j){var Z=j.length;if(Z<=1)return[j];for(var W,G,X=[],J=0;J<Z;J++){var te=u(j[J]);te!==0&&(G===void 0&&(G=te<0),G===te<0?(W&&X.push(W),W=[j[J]]):W.push(j[J]))}return W&&X.push(W),X}(P),b=0;b<P.length;b++)for(T=0;T<P[b].length;T++)I(P[b][T])}P.length===1?P=P[0]:M="Multi"+M;var V={type:"Feature",geometry:{type:M,coordinates:P},properties:this.properties};return"id"in this&&(V.id=this.id),V},JC}function lD(){if(rD)return QC;rD=1;var c=aD();function i(u,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(a,this,m),this.length=this._features.length}function a(u,m,d){u===15?m.version=d.readVarint():u===1?m.name=d.readString():u===5?m.extent=d.readVarint():u===2?m._features.push(d.pos):u===3?m._keys.push(d.readString()):u===4&&m._values.push(function(g){for(var b=null,T=g.readVarint()+g.pos;g.pos<T;){var O=g.readVarint()>>3;b=O===1?g.readString():O===2?g.readFloat():O===3?g.readDouble():O===4?g.readVarint64():O===5?g.readVarint():O===6?g.readSVarint():O===7?g.readBoolean():null}return b}(d))}return QC=i,i.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var m=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,m,this.extent,this._keys,this._values)},QC}function cD(){return sD||(sD=1,nx.VectorTile=function(){if(oD)return eM;oD=1;var c=lD();function i(a,u,m){if(a===3){var d=new c(m,m.readVarint()+m.pos);d.length&&(u[d.name]=d)}}return eM=function(a,u){this.layers=a.readFields(i,{},u)},eM}(),nx.VectorTileFeature=aD(),nx.VectorTileLayer=lD()),nx}var km=cD();class Wf extends We{constructor(i,a,u){super(i,a),this.z=u}}class uD extends Wf{constructor(i,a,u,m){super(i,a,u),this.w=m}}function ix(c,i,a,u){let m=[],d=u===0?(g,b,T,O,x,E)=>{g.push(new We(E,T+(E-b)/(O-b)*(x-T)))}:(g,b,T,O,x,E)=>{g.push(new We(b+(E-T)/(x-T)*(O-b),E))};for(let g of c){let b=[];for(let T of g){if(T.length<=2)continue;let O=[];for(let P=0;P<T.length-1;P++){let M=T[P].x,I=T[P].y,R=T[P+1].x,V=T[P+1].y,j=u===0?M:I,Z=u===0?R:V;j<i?Z>i&&d(O,M,I,R,V,i):j>a?Z<a&&d(O,M,I,R,V,a):O.push(T[P]),Z<i&&j>=i&&d(O,M,I,R,V,i),Z>a&&j<=a&&d(O,M,I,R,V,a)}let x=T[T.length-1],E=u===0?x.x:x.y;E>=i&&E<=a&&O.push(x),O.length&&(x=O[O.length-1],O[0].x===x.x&&O[0].y===x.y||O.push(O[0]),b.push(O))}b.length&&m.push(b)}return m}function hD(c,i,a,u){let m=a==="x"?"y":"x",d=(u-c[a])/(i[a]-c[a]);c[m]=c[m]+(i[m]-c[m])*d,c[a]=u,c.hasOwnProperty("z")&&(c.z=gn(c.z,i.z,d)),c.hasOwnProperty("w")&&(c.w=gn(c.w,i.w,d))}function dD(c,i,a,u){let m=a,d=u;for(let g of["x","y"]){let b=c,T=i;b[g]>=T[g]&&(b=i,T=c),b[g]<m&&T[g]>m&&hD(b,T,g,m),b[g]<d&&T[g]>d&&hD(T,b,g,d)}}let rx=Number.MAX_SAFE_INTEGER;function fD(c,i,a,u){return c.order<i||c.order===rx||!(c.clipMask&a)||function(m,d){return d.length!==0&&d.find(g=>g===m)===void 0}(u,c.clipScope)}function ox(c,i){return c.x-i.x||c.y-i.y}function pD(c,i){return ox(c.min,i.min)===0&&ox(c.max,i.max)===0}function tM(c,i){return!(c.min.x>i.max.x||c.max.x<i.min.x||c.min.y>i.max.y||c.max.y<i.min.y)}function nM(c,i){if(c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(c[a].sourceId!==i[a].sourceId||!pD(c[a],i[a])||c[a].order!==i[a].order||c[a].clipMask!==i[a].clipMask||!Nr(c[a].clipScope,i[a].clipScope))return!1;return!0}function mD(c,i,a){let u=1/Ot,m=1/(1<<a.canonical.z),d=(i.x*u+a.canonical.x)*m+a.wrap,g=(i.y*u+a.canonical.y)*m;return{min:new We((c.x*u+a.canonical.x)*m+a.wrap,(c.y*u+a.canonical.y)*m),max:new We(d,g)}}function Fj(c,i,a){let u=1<<a.canonical.z,m=((i.x-a.wrap)*u-a.canonical.x)*Ot,d=(i.y*u-a.canonical.y)*Ot;return{min:new We(((c.x-a.wrap)*u-a.canonical.x)*Ot,(c.y*u-a.canonical.y)*Ot),max:new We(m,d)}}function gD(c,i,a,u,m,d,g){let b=c.indices,T=c.vertices,O=[];for(let x=u;x<u+m;x+=3){let E=i[a[x+0]+d],P=i[a[x+1]+d],M=i[a[x+2]+d],I=Math.min(E.x,P.x,M.x),R=Math.max(E.x,P.x,M.x),V=Math.min(E.y,P.y,M.y),j=Math.max(E.y,P.y,M.y);O.length=0,c.grid.query(new We(I,V),new We(R,j),O);for(let Z=0;Z<O.length;Z++){let W=O[Z];if(ze(T[b[3*W+0]],T[b[3*W+1]],T[b[3*W+2]],E,P,M,g))return!0}}return!1}function _D(c,i,a,u){if(!c||!a)return!1;let m=c.vertices;if(!i.canonical.equals(u.canonical)||i.wrap!==u.wrap){if(a.vertices.length<c.vertices.length)return _D(a,u,c,i);let d=i.canonical,g=u.canonical,b=Math.pow(2,g.z-d.z);m=c.vertices.map(T=>new We((T.x+d.x*Ot)*b-g.x*Ot,(T.y+d.y*Ot)*b-g.y*Ot))}return gD(a,m,c.indices,0,c.indices.length,0,0)}function yD(c,i,a,u){let m=Math.pow(2,u.z-a.z);return new We((c+a.x*Ot)*m-u.x*Ot,(i+a.y*Ot)*m-u.y*Ot)}function vD(c,i){let a=[];i.grid.queryPoint(c,a);let u=i.indices,m=i.vertices;for(let d=0;d<a.length;d++){let g=a[d];if(Re([m[u[3*g+0]],m[u[3*g+1]],m[u[3*g+2]]],c))return!0}return!1}let iM=[new We(0,0),new We(Ot,0),new We(Ot,Ot),new We(0,Ot)];function xD(c,i){let a=[],u=[];if(!i||c.length<2)return[c];if(c.length===2)return $e(c[0],c[1],iM)?[c]:[];for(let m=0;m<c.length+2;m++){let d=c[m%c.length],g=c[(m+1)%c.length],b=$e(m===0?c[c.length-1]:c[(m-1)%c.length],d,iM),T=$e(d,g,iM),O=b||T;O&&u.push(d),O&&T||u.length>0&&(u.length>1&&a.push(u),u=[])}return u.length>1&&a.push(u),a}let rM=km.VectorTileFeature.types,Nj=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],zj=["fill-extrusion-flood-light-ground-radius"],Bj=Math.pow(2,13),Vj=Math.pow(2,15)-1,bD=new We(0,1),yd=2147483648;function X_(c,i,a,u,m,d,g,b){c.emplaceBack((i<<1)+g,(a<<1)+d,(Math.floor(u*Bj)<<1)+m,Math.round(b))}function K_(c,i,a){c.emplaceBack(i.x*Ot,i.y*Ot,a?1:0)}function sx(c,i,a,u,m,d){c.emplaceBack(i.x,i.y,(a.x<<1)+u,(a.y<<1)+m,d)}function J_(c,i,a){c.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class wD{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class CD{constructor(){this.centroidXY=new We(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new We(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new We(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new We(this.max.x-this.min.x,this.max.y-this.min.y)}}class MD{constructor(){this.acc=new We(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,a){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=a.x,i.min.y=i.max.y=a.y)}appendEdge(i,a,u){this.accCount++,this.acc._add(a);let m=!!this.borders;a.x<i.min.x?(i.min.x=a.x,m=!0):a.x>i.max.x&&(i.max.x=a.x,m=!0),a.y<i.min.y?(i.min.y=a.y,m=!0):a.y>i.max.y&&(i.max.y=a.y,m=!0),((a.x===0||a.x===Ot)&&a.x===u.x)!=((a.y===0||a.y===Ot)&&a.y===u.y)&&this.processBorderOverlap(a,u),m&&this.checkBorderIntersection(a,u)}checkBorderIntersection(i,a){a.x<0!=i.x<0&&this.addBorderIntersection(0,gn(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>Ot!=i.x>Ot&&this.addBorderIntersection(1,gn(a.y,i.y,(Ot-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,gn(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>Ot!=i.y>Ot&&this.addBorderIntersection(3,gn(a.x,i.x,(Ot-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let u=this.borders[i];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;let u=i.x===0?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,i.y)}else{let u=i.y===0?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,i.x)}}centroid(){return this.accCount===0?new We(0,0):new We(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0):0}}function TD(c,i){let a=c.add(i)._unit(),u=Rn(c.x*a.x+c.y*a.y,-1,1);var m,d,g;return g=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(g)))/4*Vj*((m=c).x*(d=i).y-m.y*d.x<0?-1:1)}let jj=[c=>c.x<0,c=>c.x>Ot,c=>c.y<0,c=>c.y>Ot];function Uj(c,i,a,u){let m=[4];if(u===0)return m;a._mult(u);let d=c.sub(a),g=i.sub(a),b=[c,i,d,g];for(let T=0;T<4;T++)for(let O of b)if(jj[T](O)){m.push(T);break}return m}class ED{constructor(i){this.vertexArray=new Na,this.indexArray=new qo,this.programConfigurations=new fu(i.layers,{zoom:i.zoom,lut:i.lut},a=>zj.includes(a)),this._segments=new Rr,this.hiddenByLandmarkVertexArray=new fd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Rr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,a,u,m=!1){let d=i.length;if(d>2){let g=Math.max(0,this._segments.get().length-1),b=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[g].length),T;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{let O=i[0],x=i[1];T=TD(O.sub(i[d-1])._perp()._unit(),x.sub(O)._perp()._unit())}for(let O=0;O<d;O++){let x=O===d-1?0:O+1,E=i[O],P=i[x],M=i[x===d-1?0:x+1],I=P.sub(E)._perp()._unit(),R=TD(I,M.sub(P)._perp()._unit()),V=T,j=R;if(oM(E,P,a)||m&&PD(E,a)&&PD(P,a)){T=R;continue}let Z=b.vertexLength;sx(this.vertexArray,E,P,1,1,V),sx(this.vertexArray,E,P,1,0,V),sx(this.vertexArray,E,P,0,1,j),sx(this.vertexArray,E,P,0,0,j),b.vertexLength+=4;let W=Uj(E,P,I,u);for(let G of W)this._segmentToGroundQuads[g].push({id:Z,region:G}),this._segmentToRegionTriCounts[g][G]+=2,b.primitiveLength+=2;T=R}}}prepareBorderSegments(){if(!this.hasData())return;let i=this._segments.get(),a=i.length;for(let u=0;u<a;u++)this._segmentToGroundQuads[u].sort((m,d)=>m.region-d.region);for(let u=0;u<a;u++){let m=this._segmentToGroundQuads[u],d=i[u],g=this._segmentToRegionTriCounts[u];g.reduce((T,O)=>T+O,0);let b=0;for(let T=0;T<=4;T++){let O=g[T];if(O!==0){let x=this.regionSegments[T];x||(x=this.regionSegments[T]=new Rr);let E={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+b,vertexLength:d.vertexLength,primitiveLength:O};x.get().push(E)}b+=O}for(let T=0;T<m.length;T++){let O=m[T].id;this.indexArray.emplaceBack(O,O+1,O+3),this.indexArray.emplaceBack(O,O+3,O+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,a,u,m,d,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,a,u,m,d,g)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Dj.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,a,u,m,d,g,b){this.hasData()&&this.programConfigurations.updatePaintArrays(i,a,u,m,d,g,b)}updateHiddenByLandmark(i){if(!this.hasData())return;let a=i.groundVertexCount+i.groundVertexArrayOffset;if(i.groundVertexCount===0)return;let u=i.flags&yd?1:0;for(let m=i.groundVertexArrayOffset;m<a;++m)this.hiddenByLandmarkVertexArray.emplace(m,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,Rj.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){let a=this.regionSegments[i];a&&a.destroy()}}}}class ax{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qo,this.footprintVertices=new yc,this.footprintSegments=[],this.layoutVertexArray=new dd,this.centroidVertexArray=new Gv,this.wallVertexArray=new Zv,this.indexArray=new qo,this.programConfigurations=new fu(i.layers,{zoom:i.zoom,lut:i.lut},a=>Nj.includes(a)),this.segments=new Rr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new ED(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(i,a){}populate(i,a,u,m){this.features=[],this.hasPattern=WC("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=p(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:d,id:g,index:b,sourceLayerIndex:T}of i){let O=this.layers[0]._featureFilter.needGeometry,x=q(d,O);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),x,u))continue;let E={id:g,sourceLayerIndex:T,index:b,geometry:O?x.geometry:U(d,u,m),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length,M=rM[E.type]==="Polygon";if(this.hasPattern)this.features.push(YC("fill-extrusion",this.layers,E,this.zoom,a));else if(this.wallMode)for(let I of E.geometry)for(let R of xD(I,M))this.addFeature(E,[R],b,u,{},a.availableImages,m,a.brightness);else this.addFeature(E,E.geometry,b,u,{},a.availableImages,m,a.brightness);a.featureIndex.insert(d,E.geometry,b,T,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,a,u,m,d,g){for(let b of this.features){let T=rM[b.type]==="Polygon",{geometry:O}=b;if(this.wallMode)for(let x of O)for(let E of xD(x,T))this.addFeature(b,[E],b.index,a,u,m,d,g);else this.addFeature(b,O,b.index,a,u,m,d,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,a,u,m,d,g,b){this.programConfigurations.updatePaintArrays(i,a,d,u,m,g,b),this.groundEffect.update(i,a,d,u,m,g,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Lj),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,Aj.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,kj.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Oj.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,u,m,d,g,b,T){let O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,x=[new We(0,0),new We(Ot,Ot)],E=b.projection,P=E.name==="globe",M=this.wallMode||rM[i.type]==="Polygon",I=new MD;I.centroidDataIndex=this.centroidData.length;let R=new CD,V=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},m)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},m),Z;if(R.height=j,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new _m),this.wallMode){if(P)return void Wn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;Z=function(he){let Ce=he[0].x===he[he.length-1].x&&he[0].y===he[he.length-1].y;(function(zt){let ct=0,tn=zt.length;for(let kt=0;kt<tn;kt++)ct+=(zt[(kt+1)%tn].x-zt[kt].x)*(zt[(kt+1)%tn].y+zt[kt].y);return ct>=0})(he)||(he=he.reverse());let Me={geometry:[],joinNormals:[],indices:[]},Oe=[],Pe=[],ke=[],Ne=he.length;for(;Ne>=2&&he[Ne-1].equals(he[Ne-2]);)Ne--;if(Ne<(Ce?3:2))return Me;let Be,Le,it,vt,rt,Rt=0;for(;Rt<Ne-1&&he[Rt].equals(he[Rt+1]);)Rt++;Ce&&(Be=he[Ne-2],rt=he[Rt].sub(Be)._unit()._perp());for(let zt=Rt;zt<Ne;zt++){if(it=zt===Ne-1?Ce?he[Rt+1]:void 0:he[zt+1],it&&he[zt].equals(it))continue;rt&&(vt=rt),Be&&(Le=Be),Be=he[zt],rt=it?it.sub(Be)._unit()._perp():vt,vt=vt||rt;let ct=vt.add(rt);ct.x===0&&ct.y===0||ct._unit();let tn=ct.x*rt.x+ct.y*rt.y,kt=tn!==0?1/tn:1/0,Jt=vt.x*rt.y-vt.y*rt.x>0,mn="miter",zn=2;mn==="miter"&&kt>zn&&(mn="bevel"),mn==="bevel"&&(kt>100&&(mn="flipbevel"),kt<zn&&(mn="miter"));let Vn=(Jn,jn,ni,Ki)=>{let Vi=new We(Jn.x,Jn.y),Pn=new We(Jn.x,Jn.y);Vi.x+=jn.x*Ki,Vi.y+=jn.y*Ki,Pn.x-=jn.x*Math.max(ni,1),Pn.y-=jn.y*Math.max(ni,1),ke.push(jn),Oe.push(Vi),Pe.push(Pn)};if(mn==="miter")ct._mult(kt),Vn(Be,ct,0,0);else if(mn==="flipbevel")ct=rt.mult(-1),Vn(Be,ct,0,0),Vn(Be,ct.mult(-1),0,0);else{let Jn=-Math.sqrt(kt*kt-1),jn=Jt?Jn:0,ni=Jt?0:Jn;Le&&Vn(Be,vt,jn,ni),it&&Vn(Be,rt,jn,ni)}}Me.geometry=[...Oe,...Pe.reverse(),Oe[0]],Me.joinNormals=[...ke,...ke.reverse(),ke[ke.length-1]];let Pt=Me.geometry.length-1;for(let zt=0;zt<Pt/2;zt++)if(zt+1<Pt/2){let ct=zt,tn=zt+1,kt=Pt-1-zt,Jt=Pt-2-zt;ct=ct===0?Pt-1:ct-1,tn=tn===0?Pt-1:tn-1,kt=kt===0?Pt-1:kt-1,Jt=Jt===0?Pt-1:Jt-1,Me.indices.push(kt),Me.indices.push(tn),Me.indices.push(ct),Me.indices.push(kt),Me.indices.push(Jt),Me.indices.push(tn)}return Me}(a[0]),a=[Z.geometry]}let W=(he,Ce)=>he<(Ce.length-1)/2||he===Ce.length-1,G=this.wallMode?[a]:tx(a,500);for(let he=G.length-1;he>=0;he--){let Ce=G[he];(Ce.length===0||(X=Ce[0]).every(me=>me.x<=0)||X.every(me=>me.x>=Ot)||X.every(me=>me.y<=0)||X.every(me=>me.y>=Ot))&&G.splice(he,1)}var X;let J;if(P)J=RD(G,x,m);else{J=[];for(let he of G)J.push({polygon:he,bounds:x})}let te=M?this.edgeRadius:0,fe=te>0&&this.zoom<17,de=(he,Ce)=>{if(he.length===0)return!1;let me=he[he.length-1];return Ce.x===me.x&&Ce.y===me.y};for(let{polygon:he,bounds:Ce}of J){let me=0,Me=0;for(let Ne of he)M&&!Ne[0].equals(Ne[Ne.length-1])&&Ne.push(Ne[0]),Me+=M?Ne.length-1:Ne.length;let Oe=this.segments.prepareSegment((M?5:4)*Me,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);let Pe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ke=new wD;if(ke.vertexOffset=this.footprintVertices.length,ke.indexOffset=3*this.footprintIndices.length,ke.ringIndices=[],M){let Ne=[],Be=[];me=Oe.vertexLength;for(let it=0;it<he.length;it++){let vt=he[it];vt.length&&it!==0&&Be.push(Ne.length/2);let rt=[],Rt,Pt;Rt=vt[1].sub(vt[0])._perp()._unit(),ke.ringIndices.push(vt.length-1);for(let zt=1;zt<vt.length;zt++){let ct=vt[zt],tn=vt[zt===vt.length-1?1:zt+1],kt=ct.clone();if(te){Pt=tn.sub(ct)._perp()._unit();let Jt=Rt.add(Pt)._unit(),mn=te*Math.min(4,1/(Rt.x*Jt.x+Rt.y*Jt.y));kt.x+=mn*Jt.x,kt.y+=mn*Jt.y,kt.x=Math.round(kt.x),kt.y=Math.round(kt.y),Rt=Pt}if(!V||te!==0&&!fe||de(rt,kt)||rt.push(kt),X_(this.layoutVertexArray,kt.x,kt.y,0,0,1,1,0),this.wallMode){let Jt=W(zt,vt);K_(this.wallVertexArray,Z.joinNormals[zt],!Jt)}Oe.vertexLength++,this.footprintVertices.emplaceBack(ct.x,ct.y),Ne.push(ct.x,ct.y),P&&J_(this.layoutVertexExtArray,E.projectTilePoint(kt.x,kt.y,m),E.upVector(m,kt.x,kt.y))}V&&(te===0||fe)&&(rt.length!==0&&de(rt,rt[0])&&rt.pop(),this.groundEffect.addData(rt,Ce,O))}let Le=this.wallMode?Z.indices:q_(Ne,Be);for(let it=0;it<Le.length;it+=3)this.footprintIndices.emplaceBack(ke.vertexOffset+Le[it+0],ke.vertexOffset+Le[it+1],ke.vertexOffset+Le[it+2]),this.indexArray.emplaceBack(me+Le[it],me+Le[it+2],me+Le[it+1]),Oe.primitiveLength++;ke.indexCount+=Le.length,ke.vertexCount+=this.footprintVertices.length-ke.vertexOffset}for(let Ne=0;Ne<he.length;Ne++){let Be=he[Ne];I.startRing(R,Be[0]);let Le=Be.length>4&&DD(Be[Be.length-2],Be[0],Be[1]),it=te?Hj(Be[Be.length-2],Be[0],Be[1],te):0,vt=[],rt,Rt,Pt;Rt=Be[1].sub(Be[0])._perp()._unit();let zt=!0;for(let ct=1,tn=0;ct<Be.length;ct++){let kt=Be[ct-1],Jt=Be[ct],mn=Be[ct===Be.length-1?1:ct+1];if(I.appendEdge(R,Jt,kt),oM(Jt,kt,Ce)){te&&(Rt=mn.sub(Jt)._perp()._unit(),zt=!zt);continue}let zn=Jt.sub(kt)._perp(),Vn=zn.x/(Math.abs(zn.x)+Math.abs(zn.y)),Jn=zn.y>0?1:0,jn=kt.dist(Jt);if(tn+jn>32768&&(tn=0),te){Pt=mn.sub(Jt)._perp()._unit();let Pn=ID(kt,Jt,mn,SD(Rt,Pt),te);isNaN(Pn)&&(Pn=0);let ji=Jt.sub(kt)._unit();kt=kt.add(ji.mult(it))._round(),Jt=Jt.add(ji.mult(-Pn))._round(),it=Pn,Rt=Pt,V&&this.zoom>=17&&(de(vt,kt)||vt.push(kt),de(vt,Jt)||vt.push(Jt))}let ni=Oe.vertexLength,Ki=Be.length>4&&DD(kt,Jt,mn),Vi=OD(tn,Le,zt);if(X_(this.layoutVertexArray,kt.x,kt.y,Vn,Jn,0,0,Vi),X_(this.layoutVertexArray,kt.x,kt.y,Vn,Jn,0,1,Vi),this.wallMode){let Pn=W(ct-1,Be),ji=Z.joinNormals[ct-1];K_(this.wallVertexArray,ji,Pn),K_(this.wallVertexArray,ji,Pn)}if(tn+=jn,Vi=OD(tn,Ki,!zt),Le=Ki,X_(this.layoutVertexArray,Jt.x,Jt.y,Vn,Jn,0,0,Vi),X_(this.layoutVertexArray,Jt.x,Jt.y,Vn,Jn,0,1,Vi),this.wallMode){let Pn=W(ct,Be),ji=Z.joinNormals[ct];K_(this.wallVertexArray,ji,Pn),K_(this.wallVertexArray,ji,Pn)}if(Oe.vertexLength+=4,this.indexArray.emplaceBack(ni+0,ni+1,ni+2),this.indexArray.emplaceBack(ni+1,ni+3,ni+2),Oe.primitiveLength+=2,te){let Pn=me+(ct===1?Be.length-2:ct-2),ji=ct===1?me:Pn+1;if(this.indexArray.emplaceBack(ni+1,Pn,ni+3),this.indexArray.emplaceBack(Pn,ji,ni+3),Oe.primitiveLength+=2,rt===void 0&&(rt=ni),!oM(mn,Be[ct],Ce)){let Li=ct===Be.length-1?rt:Oe.vertexLength;this.indexArray.emplaceBack(ni+2,ni+3,Li),this.indexArray.emplaceBack(ni+3,Li+1,Li),this.indexArray.emplaceBack(ni+3,ji,Li+1),Oe.primitiveLength+=3}zt=!zt}if(P){let Pn=this.layoutVertexExtArray,ji=E.projectTilePoint(kt.x,kt.y,m),Li=E.projectTilePoint(Jt.x,Jt.y,m),Ji=E.upVector(m,kt.x,kt.y),uo=E.upVector(m,Jt.x,Jt.y);J_(Pn,ji,Ji),J_(Pn,ji,Ji),J_(Pn,Li,uo),J_(Pn,Li,uo)}}M&&(me+=Be.length-1),V&&te&&this.zoom>=17&&(vt.length!==0&&de(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,Ce,O,te>0))}this.footprintSegments.push(ke),Pe.triangleCount=this.indexArray.length-Pe.triangleArrayOffset,this.polygonSegments.push(Pe),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=I.borders?bD:this.encodeCentroid(I,R),this.centroidData.push(R),I.borders){this.featuresOnBorder.push(I);let he=this.featuresOnBorder.length-1;for(let Ce=0;Ce<I.borders.length;Ce++)I.borders[Ce][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ce].push(he)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,d,g,m,T),this.groundEffect.addPaintPropertiesData(i,u,d,g,m,T),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((a,u)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[u].borders[i][0])}splitToSubtiles(){let i=[];for(let b=0;b<this.centroidData.length;b++){let T=this.centroidData[b],O=+(T.min.y+T.max.y>Ot),x=2*O+(+(T.min.x+T.max.x>Ot)^O);for(let E=0;E<T.polygonSegLen;E++){let P=T.polygonSegIdx+E;i.push({centroidIdx:b,subtile:x,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}let a=new qo;i.sort((b,T)=>b.triangleSegmentIdx===T.triangleSegmentIdx?b.subtile-T.subtile:b.triangleSegmentIdx-T.triangleSegmentIdx);let u=0,m=0,d=0;for(let b of i){if(b.triangleSegmentIdx!==u)break;d++}let g=i.length;for(;m!==i.length;){u=i[m].triangleSegmentIdx;let b=0,T=m,O=m;for(let x=T;x<d&&i[x].subtile===b;x++)O++;for(;T!==d;){let x=i[T];b=x.subtile;let E=this.centroidData[x.centroidIdx].min.clone(),P=this.centroidData[x.centroidIdx].max.clone(),M={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let I=T;I<O;I++){let R=i[I],V=this.polygonSegments[R.polygonSegmentIdx],j=this.centroidData[R.centroidIdx].min,Z=this.centroidData[R.centroidIdx].max,W=this.indexArray.uint16;for(let G=V.triangleArrayOffset;G<V.triangleArrayOffset+V.triangleCount;G++)a.emplaceBack(W[3*G],W[3*G+1],W[3*G+2]);M.primitiveLength+=V.triangleCount,E.x=Math.min(E.x,j.x),E.y=Math.min(E.y,j.y),P.x=Math.max(P.x,Z.x),P.y=Math.max(P.y,Z.y)}M.primitiveLength>0&&this.triangleSubSegments.push({segment:M,min:E,max:P}),T=O;for(let I=T;I<d&&i[I].subtile===i[T].subtile;I++)O++}m=d;for(let x=m;x<g&&i[x].triangleSegmentIdx===i[m].triangleSegmentIdx;x++)d++}a._trim(),this.indexArray=a}getVisibleSegments(i,a,u){let m=new Rr;if(this.wallMode){for(let R of this.triangleSubSegments)m.segments.push(R.segment);return m}let d=0,g=0,b=1<<i.canonical.z;if(a){let R=a.getMinMaxForTile(i);R&&(d=R.min,g=R.max)}g+=this.maxHeight;let T=i.toUnwrapped(),O,x=[T.canonical.x/b+T.wrap,T.canonical.y/b],E=[(T.canonical.x+1)/b+T.wrap,(T.canonical.y+1)/b],P=(R,V,j)=>[R[0]*(1-j[0])+V[0]*j[0],R[1]*(1-j[1])+V[1]*j[1]],M=[],I=[];for(let R of this.triangleSubSegments){M[0]=R.min.x/Ot,M[1]=R.min.y/Ot,I[0]=R.max.x/Ot,I[1]=R.max.y/Ot;let V=P(x,E,M),j=P(x,E,I);if(new bn([V[0],V[1],d],[j[0],j[1],g]).intersectsPrecise(u)===0){O&&(m.segments.push(O),O=void 0);continue}let Z=R.segment;O&&O.vertexOffset!==Z.vertexOffset&&(m.segments.push(O),O=void 0),O?(O.vertexLength+=Z.vertexLength,O.primitiveLength+=Z.primitiveLength):O={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return O&&m.segments.push(O),m}encodeCentroid(i,a){let u=i.centroid(),m=a.span(),d=Math.min(7,Math.round(m.x*this.tileToMeter/10)),g=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new We(Rn(u.x,1,Ot-1)<<3|d,Rn(u.y,1,Ot-1)<<3|g)}encodeBorderCentroid(i){if(!i.borders)return new We(0,0);let a=i.borders,u=Number.MAX_VALUE;if(a[0][0]!==u||a[1][0]!==u){let m=a[0][0]!==u?0:1;return new We(6|(a[0][0]!==u?0:65528),(a[m][0]+a[m][1])/2<<3|6)}{let m=a[2][0]!==u?2:3;return new We((a[m][0]+a[m][1])/2<<3|6,6|(a[2][0]!==u?0:65528))}}showCentroid(i){let a=this.centroidData[i.centroidDataIndex];a.flags&=yd,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);let a=i.vertexArrayOffset,u=i.vertexCount+i.vertexArrayOffset,m=i.flags&yd?bD:i.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==m.y||d!==m.x){for(let g=a;g<u;++g)this.centroidVertexArray.emplace(g,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;let m=a.getReplacementRegionsForTile(i.toUnwrapped());if(nM(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let g of this.centroidData)g.flags&=2147483647;let d=[];for(let g of this.activeReplacements){if(g.order<u)continue;let b=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-i.canonical.z));for(let T of this.centroidData)if(!(T.flags&yd||g.min.x>T.max.x||T.min.x>g.max.x||g.min.y>T.max.y||T.min.y>g.max.y))for(let O=0;O<T.footprintSegLen;O++){let x=this.footprintSegments[T.footprintSegIdx+O];if(d.length=0,$j(this.footprintVertices,x.vertexOffset,x.vertexCount,g.footprintTileId.canonical,i.canonical,d),gD(g.footprint,d,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-b)){T.flags|=yd;break}}}for(let g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,a,u){let m=!1;for(let d=0;d<u.footprintSegLen;d++){let g=this.footprintSegments[u.footprintSegIdx+d],b=0;for(let T of g.ringIndices){for(let O=b,x=T+b-1;O<T+b;x=O++){let E=this.footprintVertices.int16[2*(O+g.vertexOffset)+0],P=this.footprintVertices.int16[2*(O+g.vertexOffset)+1],M=this.footprintVertices.int16[2*(x+g.vertexOffset)+1];P>a!=M>a&&i<(this.footprintVertices.int16[2*(x+g.vertexOffset)+0]-E)*(a-P)/(M-P)+E&&(m=!m)}b=T}}return m}getHeightAtTileCoord(i,a){let u=Number.NEGATIVE_INFINITY,m=!0,d=4*(i+Ot)*Ot+(a+Ot);if(this.partLookup.hasOwnProperty(d)){let g=this.partLookup[d];return g?{height:g.height,hidden:!!(g.flags&yd)}:void 0}for(let g of this.centroidData)i>g.max.x||g.min.x>i||a>g.max.y||g.min.y>a||this.footprintContainsPoint(i,a,g)&&g&&g.height>u&&(u=g.height,this.partLookup[d]=g,m=!!(g.flags&yd));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:m};this.partLookup[d]=void 0}}function SD(c,i){let a=c.add(i)._unit();return c.x*a.x+c.y*a.y}function Hj(c,i,a,u){let m=i.sub(c)._perp()._unit(),d=a.sub(i)._perp()._unit();return ID(c,i,a,SD(m,d),u)}function ID(c,i,a,u,m){let d=Math.sqrt(1-u*u);return Math.min(c.dist(i)/3,i.dist(a)/3,m*d/u)}function oM(c,i,a){return c.x<a[0].x&&i.x<a[0].x||c.x>a[1].x&&i.x>a[1].x||c.y<a[0].y&&i.y<a[0].y||c.y>a[1].y&&i.y>a[1].y}function PD(c,i){return c.x<i[0].x||c.x>i[1].x||c.y<i[0].y||c.y>i[1].y}function DD(c,i,a){if(c.x<0||c.x>=Ot||i.x<0||i.x>=Ot||a.x<0||a.x>=Ot)return!1;let u=a.sub(i),m=u.perp(),d=c.sub(i);return(u.x*d.x+u.y*d.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(d.x*d.x+d.y*d.y))>-.866&&m.x*d.x+m.y*d.y<0}function OD(c,i,a){let u=i?2|c:-3&c;return a?1|u:-2&u}function AD(){let c=Math.PI/32,i=Math.tan(c),a=gd;return a*Math.sqrt(1+2*i*i)-a}function RD(c,i,a){let u=1<<a.z,m=Xs(a.x/u),d=Xs((a.x+1)/u),g=Bo(a.y/u),b=Bo((a.y+1)/u);return function(T,O,x,E,P=0,M){let I=[];if(!T.length||!x||!E)return I;let R=(J,te)=>{for(let fe of J)I.push({polygon:fe,bounds:te})},V=Math.ceil(Math.log2(x)),j=Math.ceil(Math.log2(E)),Z=V-j,W=[];for(let J=0;J<Math.abs(Z);J++)W.push(Z>0?0:1);for(let J=0;J<Math.min(V,j);J++)W.push(0),W.push(1);let G=T;if(G=ix(G,O[0].y-P,O[1].y+P,1),G=ix(G,O[0].x-P,O[1].x+P,0),!G.length)return I;let X=[];for(W.length?X.push({polygons:G,bounds:O,depth:0}):R(G,O);X.length;){let J=X.pop(),te=J.depth,fe=W[te],de=J.bounds[0],he=J.bounds[1],Ce=fe===0?de.x:de.y,me=fe===0?he.x:he.y,Me=M?M(fe,Ce,me):.5*(Ce+me),Oe=ix(J.polygons,Ce-P,Me+P,fe),Pe=ix(J.polygons,Me-P,me+P,fe);if(Oe.length){let ke=[de,new We(fe===0?Me:he.x,fe===1?Me:he.y)];W.length>te+1?X.push({polygons:Oe,bounds:ke,depth:te+1}):R(Oe,ke)}if(Pe.length){let ke=[new We(fe===0?Me:de.x,fe===1?Me:de.y),he];W.length>te+1?X.push({polygons:Pe,bounds:ke,depth:te+1}):R(Pe,ke)}}return I}(c,i,Math.ceil((d-m)/11.25),Math.ceil((g-b)/11.25),1,(T,O,x)=>{if(T===0)return .5*(O+x);{let E=Bo((a.y+O/Ot)/u);return(wc(.5*(Bo((a.y+x/Ot)/u)+E))*u-a.y)*Ot}})}function $j(c,i,a,u,m,d){let g=Math.pow(2,u.z-m.z);for(let b=0;b<a;b++){let T=c.int16[2*(b+i)+0],O=c.int16[2*(b+i)+1];T=(T+m.x*Ot)*g-u.x*Ot,O=(O+m.y*Ot)*g-u.y*Ot,d.push(new We(T,O))}}let kD,LD;function Q_(c,i){return c.x*i.x+c.y*i.y}function FD(c,i){if(c.length===1){let a=0,u=i[a++],m;for(;!m||u.equals(m);)if(m=i[a++],!m)return 1/0;for(;a<i.length;a++){let d=i[a],g=c[0],b=m.sub(u),T=d.sub(u),O=g.sub(u),x=Q_(b,b),E=Q_(b,T),P=Q_(T,T),M=Q_(O,b),I=Q_(O,T),R=x*P-E*E,V=(P*M-E*I)/R,j=(x*I-E*M)/R,Z=u.z*(1-V-j)+m.z*V+d.z*j;if(isFinite(Z))return Z}return 1/0}{let a=1/0;for(let u of i)a=Math.min(a,u.z);return a}}function ND(c,i,a,u,m,d,g,b){let T=g*m.getElevationAt(c,i,!0,!0),O=d[0]!==0,x=O?d[1]===0?g*(d[0]/7-450):g*function(E,P,M){let I=Math.floor(P[0]/8),R=Math.floor(P[1]/8),V=10*(P[0]-8*I),j=10*(P[1]-8*R),Z=E.getElevationAt(I,R,!0,!0),W=E.getMeterToDEM(M),G=Math.floor(.5*(V*W-1)),X=Math.floor(.5*(j*W-1)),J=E.tileCoordToPixel(I,R),te=2*G+1,fe=2*X+1,de=function(Pe,ke,Ne,Be,Le){return[Pe.getElevationAtPixel(ke,Ne,!0),Pe.getElevationAtPixel(ke+Le,Ne,!0),Pe.getElevationAtPixel(ke,Ne+Le,!0),Pe.getElevationAtPixel(ke+Be,Ne+Le,!0)]}(E,J.x-G,J.y-X,te,fe),he=Math.abs(de[0]-de[1]),Ce=Math.abs(de[2]-de[3]),me=Math.abs(de[0]-de[2])+Math.abs(de[1]-de[3]),Me=Math.min(.25,.5*W*(he+Ce)/te),Oe=Math.min(.25,.5*W*me/fe);return Z+Math.max(Me*V,Oe*j)}(m,d,b):T;return{base:T+(a===0?-1:a),top:O?Math.max(x+u,T+a+2):T+u}}Xt(ax,"FillExtrusionBucket",{omit:["layers","features"]}),Xt(CD,"PartData"),Xt(wD,"FootprintSegment"),Xt(MD,"BorderCentroidData"),Xt(ED,"GroundEffect");let Gj=Ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),qj=Ti([{name:"a_z_offset_width",components:2,type:"Float32"}],4),{members:Zj}=Gj,Wj=Ti([{name:"a_packed",components:4,type:"Float32"}]),{members:Yj}=Wj,Xj=Ti([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Kj}=Xj;class zD{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new _d({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){let u=this.getKey(i,a);return this.positions[u]}trim(){let i=this.width,a=this.height=Zc(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,u){let m=[],d=i.length%2==1?-i[i.length-1]*u:0,g=i[0]*u,b=!0;m.push({left:d,right:g,isDash:b,zeroLength:i[0]===0});let T=i[0];for(let O=1;O<i.length;O++){b=!b;let x=i[O];d=T*u,T+=x,g=T*u,m.push({left:d,right:g,isDash:b,zeroLength:x===0})}return m}addRoundDash(i,a,u){let m=a/2;for(let d=-u;d<=u;d++){let g=this.width*(this.nextRow+u+d),b=0,T=i[b];for(let O=0;O<this.width;O++){O/T.right>1&&(T=i[++b]);let x=Math.abs(O-T.left),E=Math.abs(O-T.right),P=Math.min(x,E),M,I=d/u*(m+1);if(T.isDash){let R=m-Math.abs(I);M=Math.sqrt(P*P+R*R)}else M=m-Math.sqrt(P*P+I*I);this.image.data[g+O]=Math.max(0,Math.min(255,M+128))}}}addRegularDash(i,a){for(let T=i.length-1;T>=0;--T){let O=i[T],x=i[T+1];O.zeroLength?i.splice(T,1):x&&x.isDash===O.isDash&&(x.left=O.left,i.splice(T,1))}let u=i[0],m=i[i.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);let d=this.width*this.nextRow,g=0,b=i[g];for(let T=0;T<this.width;T++){T/b.right>1&&(b=i[++g]);let O=Math.abs(T-b.left),x=Math.abs(T-b.right),E=Math.min(O,x);this.image.data[d+T]=Math.max(0,Math.min(255,(b.isDash?E:-E)+a+128))}}addDash(i,a){let u=this.getKey(i,a);if(this.positions[u])return this.positions[u];let m=a==="round",d=m?7:0,g=2*d+1;if(this.nextRow+g>this.height)return Wn("LineAtlas out of space"),null;i.length===0&&i.push(1);let b=0;for(let x=0;x<i.length;x++)i[x]<0&&(Wn("Negative value is found in line dasharray, replacing values with 0"),i[x]=0),b+=i[x];if(b!==0){let x=this.width/b,E=this.getDashRanges(i,this.width,x);m?this.addRoundDash(E,x,d):this.addRegularDash(E,a==="square"?.5*x:0)}let T=this.nextRow+d;this.nextRow+=g;let O={tl:[T,d],br:[b,0]};return this.positions[u]=O,O}}Xt(zD,"LineAtlas");let Jj=km.VectorTileFeature.types,Qj=Math.cos(Math.PI/180*37.5),eU=Math.cos(Math.PI/180*5);class sM{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new C_,this.layoutVertexArray2=new vc,this.patternVertexArray=new lu,this.indexArray=new qo,this.programConfigurations=new fu(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new Rr,this.maxLineLength=0,this.zOffsetVertexArray=new xc,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:Ot/64}updateFootprints(i,a){}populate(i,a,u,m){this.hasPattern=WC("line",this.layers,a);let d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=p(u),this.hasZOffset=!this.layers[0].isDraped();let g=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&g==="none"&&Wn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);let b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&b!==void 0;let T=[];for(let{feature:P,id:M,index:I,sourceLayerIndex:R}of i){let V=this.layers[0]._featureFilter.needGeometry,j=q(P,V);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),j,u))continue;let Z=d?d.evaluate(j,{},u):void 0,W={id:M,properties:P.properties,type:P.type,sourceLayerIndex:R,index:I,geometry:V?j.geometry:U(P,u,m),patterns:{},sortKey:Z};T.push(W)}d&&T.sort((P,M)=>P.sortKey-M.sortKey);let{lineAtlas:O,featureIndex:x}=a,E=this.addConstantDashes(O);for(let P of T){let{geometry:M,index:I,sourceLayerIndex:R}=P;if(E&&this.addFeatureDashes(P,O),this.hasPattern){let V=YC("line",this.layers,P,this.zoom,a);this.patternFeatures.push(V)}else this.addFeature(P,M,I,u,O.positions,a.availableImages,a.brightness);x.insert(i[I].feature,M,I,R,this.index)}}addConstantDashes(i){let a=!1;for(let u of this.layers){let m=u.paint.get("line-dasharray").value,d=u.layout.get("line-cap").value;if(m.kind!=="constant"||d.kind!=="constant")a=!0;else{let g=d.value,b=m.value;if(!b)continue;i.addDash(b,g)}}return a}addFeatureDashes(i,a){let u=this.zoom;for(let m of this.layers){let d=m.paint.get("line-dasharray").value,g=m.layout.get("line-cap").value;if(d.kind==="constant"&&g.kind==="constant")continue;let b,T;if(d.kind==="constant"){if(b=d.value,!b)continue}else b=d.evaluate({zoom:u},i);T=g.kind==="constant"?g.value:g.evaluate({zoom:u},i),a.addDash(b,T),i.patterns[m.id]=a.getKey(b,T)}}update(i,a,u,m,d,g,b){this.programConfigurations.updatePaintArrays(i,a,d,u,m,g,b)}addFeatures(i,a,u,m,d,g){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,u,m,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Yj)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,Kj)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,qj.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Zj),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,a,u,m,d,g,b){let T=this.layers[0].layout,O=T.get("line-join").evaluate(i,{}),x=T.get("line-cap").evaluate(i,{}),E=T.get("line-miter-limit"),P=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i,this.zOffsetValue=T.get("line-z-offset").value;let M=this.layers[0].paint.get("line-width").value;M.kind!=="constant"&&M.isLineProgressConstant===!1&&(this.variableWidthValue=M);for(let I of a)this.addLine(I,i,m,O,x,E,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,d,g,m,b)}addLine(i,a,u,m,d,g,b){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;let T=m==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let W=0;W<i.length-1;W++)this.totalDistance+=i[W].dist(i[W+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let O=Jj[a.type]==="Polygon",x=i.length;for(;x>=2&&i[x-1].equals(i[x-2]);)x--;let E=0;for(;E<x-1&&i[E].equals(i[E+1]);)E++;if(x<(O?3:2))return;m==="bevel"&&(g=1.05);let P=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray),M,I,R,V,j,Z;this.e1=this.e2=-1,O&&(M=i[x-2],j=i[E].sub(M)._unit()._perp());for(let W=E;W<x;W++){if(R=W===x-1?O?i[E+1]:void 0:i[W+1],R&&i[W].equals(R))continue;j&&(V=j),M&&(I=M),M=i[W],Z=this.evaluateLineProgressFeatures(I?I.dist(M):0),j=R?R.sub(M)._unit()._perp():V,V=V||j;let G=I&&R,X=G?m:O||T?"butt":d,J=V.x*j.x+V.y*j.y;if(T){let Oe=function(Pe){if(Pe.patternJoinNone){let ke=Pe.segmentPoints.length/2,Ne=Pe.lineSoFar-Pe.segmentStart;for(let Be=0;Be<ke;++Be){let Le=Pe.segmentPoints[2*Be+1],it=Math.round(Pe.segmentPoints[2*Be])+.5+.25*Le;Pe.patternVertexArray.emplaceBack(it,Ne,Pe.segmentStart),Pe.patternVertexArray.emplaceBack(it,Ne,Pe.segmentStart)}Pe.segmentPoints.length=0}Pe.e1=Pe.e2=-1};if(G&&J<eU){this.updateDistance(I,M),this.addCurrentVertex(M,V,1,1,P,Z),Oe(this),this.addCurrentVertex(M,j,-1,-1,P,Z);continue}if(I){if(!R){this.updateDistance(I,M),this.addCurrentVertex(M,V,1,1,P,Z),Oe(this);continue}X="miter"}}let te=V.add(j);te.x===0&&te.y===0||te._unit();let fe=te.x*j.x+te.y*j.y,de=fe!==0?1/fe:1/0,he=2*Math.sqrt(2-2*fe),Ce=fe<Qj&&I&&R,me=V.x*j.y-V.y*j.x>0,Me=this.overscaling<=16?15*Ot/(512*this.overscaling):0;if(G&&X==="round"){if(de<b)X="miter";else if(de<=2){let Oe=aM(M,-10,Ot+10);X=this.hasZOffset&&(Oe||this.hasCrossSlope)?"miter":"fakeround"}}if(X==="miter"&&de>g&&(X="bevel"),X==="bevel"&&(de>2&&(X="flipbevel"),de<g&&(X="miter")),I&&!(X==="miter"&&Ce)&&this.updateDistance(I,M),X==="miter")if(Ce){let Oe=M.dist(I);if(Oe>2*Me){let ke=M.sub(M.sub(I)._mult(Me/Oe)._round());this.updateDistance(I,ke),this.addCurrentVertex(ke,V,0,0,P,Z),I=ke}this.updateDistance(I,M),te._mult(de),this.addCurrentVertex(M,te,0,0,P,Z);let Pe=M.dist(R);if(Pe>2*Me){let ke=M.add(R.sub(M)._mult(Me/Pe)._round());this.updateDistance(M,ke),this.addCurrentVertex(ke,j,0,0,P,Z),M=ke}}else te._mult(de),this.addCurrentVertex(M,te,0,0,P,Z);else if(X==="flipbevel"){if(de>100)te=j.mult(-1);else{let Oe=de*V.add(j).mag()/V.sub(j).mag();te._perp()._mult(Oe*(me?-1:1))}this.addCurrentVertex(M,te,0,0,P,Z),this.addCurrentVertex(M,te.mult(-1),0,0,P,Z)}else if(X==="bevel"||X==="fakeround"){Z!=null&&I&&this.addCurrentVertex(M,V,-1,-1,P,Z);let Oe=M.dist(I)<=2*Me&&X!=="bevel",Pe=te.mult(me?1:-1);Pe._mult(de);let ke=j.mult(me?-1:1),Ne=V.mult(me?-1:1),Be=this.evaluateLineProgressFeatures(this.distance);if(Z==null&&(this.addHalfVertex(M,Pe.x,Pe.y,!1,!me,0,P,Be),Oe||this.addHalfVertex(M,Pe.x+2*Ne.x,Pe.y+2*Ne.y,!1,me,0,P,Be)),X==="fakeround"){let Le=Math.round(180*he/Math.PI/20);this.addHalfVertex(M,Ne.x,Ne.y,!1,me,0,P,Be);for(let it=0;it<Le;it++){let vt=it/Le;if(vt!==.5){let Rt=vt-.5;vt+=vt*Rt*(vt-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*Rt*Rt+(.848013+J*(.215638*J-1.06021)))}let rt=ke.sub(Ne)._mult(vt)._add(Ne)._unit();this.addHalfVertex(M,rt.x,rt.y,!1,me,0,P,Be)}this.addHalfVertex(M,ke.x,ke.y,!1,me,0,P,Be)}Oe||Z!=null||this.addHalfVertex(M,Pe.x+2*ke.x,Pe.y+2*ke.y,!1,me,0,P,Be),Z!=null&&R&&this.addCurrentVertex(M,j,1,1,P,Z)}else X==="butt"?this.addCurrentVertex(M,te,0,0,P,Z):X==="square"?(I||this.addCurrentVertex(M,te,-1,-1,P,Z),this.addCurrentVertex(M,te,0,0,P,Z),I&&this.addCurrentVertex(M,te,1,1,P,Z)):X==="round"&&(I&&(this.addCurrentVertex(M,V,0,0,P,Z),this.addCurrentVertex(M,V,1,1,P,Z,!0)),R&&(this.addCurrentVertex(M,j,-1,-1,P,Z,!0),this.addCurrentVertex(M,j,0,0,P,Z)))}}addVerticesTo(i,a,u,m,d,g,b,T,O,x){let E=(a.w-i.w)/this.tessellationStep|0,P=0,M=this.scaledDistance;if(E>1){this.lineSoFar=i.w;let R=(a.x-i.x)/E,V=(a.y-i.y)/E,j=(a.z-i.z)/E,Z=(a.w-i.w)/E;for(let W=1;W<E;++W){i.x+=R,i.y+=V,i.z+=j,this.lineSoFar+=Z,P+=Z;let G=this.evaluateLineProgressFeatures(this.prevDistance+P);this.scaledDistance=(this.prevDistance+P)/this.totalDistance,this.addHalfVertex(i,u,m,x,!1,b,O,G),this.addHalfVertex(i,d,g,x,!0,-T,O,G)}}this.lineSoFar=a.w,this.scaledDistance=M;let I=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,u,m,x,!1,b,O,I),this.addHalfVertex(a,d,g,x,!0,-T,O,I)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):Wn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}:{zOffset:0,variableWidth:a}}addCurrentVertex(i,a,u,m,d,g,b=!1){let T=a.x+a.y*u,O=a.y-a.x*u,x=a.y*m-a.x,E=-a.y-a.x*m;if(g!=null){let P=this.hasZOffset,M=-10,I=Ot+10,R=g.zOffset,V=new uD(i.x,i.y,R,this.lineSoFar),j=!!P&&aM(i,M,I),Z=this.lineSoFar,W=this.distance;if(this.currentVertex)if(j){let G=this.currentVertexIsOutside,X=this.currentVertex,J=new uD(i.x,i.y,R,this.lineSoFar);if(dD(X,J,M,I),!aM(J,M,I)){if(G){this.e1=this.e2=-1,this.distance-=X.dist(V),this.lineSoFar=X.w;let te=this.evaluateLineProgressFeatures(X.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(X,T,O,b,!1,u,d,te),this.addHalfVertex(X,x,E,b,!0,-m,d,te),this.prevDistance=this.distance}this.distance=this.prevDistance+X.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(X,J,T,O,x,E,u,m,d,b),this.distance=W,this.scaledDistance=this.distance/this.totalDistance}}else{let G=this.currentVertex;if(this.currentVertexIsOutside){dD(G,V,M,I),this.e1=this.e2=-1,this.distance-=G.dist(V),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=G.w;let X=this.evaluateLineProgressFeatures(G.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(G,T,O,b,!1,u,d,X),this.addHalfVertex(G,x,E,b,!0,-m,d,X),this.prevDistance=this.distance,this.distance=W,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(G,V,T,O,x,E,u,m,d,b)}else j||(this.addHalfVertex(i,T,O,b,!1,u,d,g),this.addHalfVertex(i,x,E,b,!0,-m,d,g));this.currentVertex=V,this.currentVertexIsOutside=j,this.lineSoFar=Z}else this.addHalfVertex(i,T,O,b,!1,u,d,g),this.addHalfVertex(i,x,E,b,!0,-m,d,g)}addHalfVertex({x:i,y:a},u,m,d,g,b,T,O){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((i<<1)+(d?1:0),(a<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let x=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),T.primitiveLength++),g?this.e2=x:this.e1=x,O!=null&&this.zOffsetVertexArray.emplaceBack(O.zOffset,O.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,a){this.prevDistance=this.distance,this.distance+=i.dist(a),this.updateScaledDistance()}}function aM(c,i,a){return c.x<i||c.x>a||c.y<i||c.y>a}let BD,VD;function jD(c,i,a){return i*(Ot/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}Xt(sM,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let UD=(c,i,a)=>(1-a)*c+a*i;function HD(c,i){return 1/jD(c,1,i.tileZoom)}function $D(c,i,a,u){return c.translatePosMatrix(u||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}let GD=c=>{let i=[];qD(c)&&i.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");let a=c.paint.get("line-trim-offset");a[0]===0&&a[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");let u=c.layout.get("line-join").constantOr("miter")==="none",m=!!c.paint.get("line-pattern").constantOr(1);return u&&m&&i.push("LINE_JOIN_NONE"),i};function qD(c){let i=c.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}let lM,ZD=()=>lM||(lM={layout:BD||(BD=new Ar({"line-cap":new Gt(qe.layout_line["line-cap"]),"line-join":new Gt(qe.layout_line["line-join"]),"line-miter-limit":new Et(qe.layout_line["line-miter-limit"]),"line-round-limit":new Et(qe.layout_line["line-round-limit"]),"line-sort-key":new Gt(qe.layout_line["line-sort-key"]),"line-z-offset":new Gt(qe.layout_line["line-z-offset"]),"line-elevation-reference":new Et(qe.layout_line["line-elevation-reference"]),"line-cross-slope":new Et(qe.layout_line["line-cross-slope"]),visibility:new Et(qe.layout_line.visibility),"line-width-unit":new Et(qe.layout_line["line-width-unit"])})),paint:VD||(VD=new Ar({"line-opacity":new Gt(qe.paint_line["line-opacity"]),"line-color":new Gt(qe.paint_line["line-color"]),"line-translate":new Et(qe.paint_line["line-translate"]),"line-translate-anchor":new Et(qe.paint_line["line-translate-anchor"]),"line-width":new Gt(qe.paint_line["line-width"]),"line-gap-width":new Gt(qe.paint_line["line-gap-width"]),"line-offset":new Gt(qe.paint_line["line-offset"]),"line-blur":new Gt(qe.paint_line["line-blur"]),"line-dasharray":new Gt(qe.paint_line["line-dasharray"]),"line-pattern":new Gt(qe.paint_line["line-pattern"]),"line-gradient":new ad(qe.paint_line["line-gradient"]),"line-trim-offset":new Et(qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Et(qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Et(qe.paint_line["line-trim-color"]),"line-emissive-strength":new Et(qe.paint_line["line-emissive-strength"]),"line-border-width":new Gt(qe.paint_line["line-border-width"]),"line-border-color":new Gt(qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Et(qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},lM);class tU extends Gt{possiblyEvaluate(i,a){return a=new _r(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition}),super.possiblyEvaluate(i,a)}evaluate(i,a,u,m){return a=Oo({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(i,a,u,m)}}let ey;function WD(c,i){return i>0?i+2*c:c}let nU=Ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iU=Ti([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),rU=Ti([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let oU=Ti([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),sU=Ti([{name:"a_texb",components:2,type:"Uint16"}]),aU=Ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),lU=Ti([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ti([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let YD=Ti([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cU=Ti([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ti([{name:"triangle",components:3,type:"Uint16"}]),Ti([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ti([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ti([{type:"Float32",name:"offsetX"}]),Ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ns=24;let Tc=128;function lx(c,i,a,u,m){if(c.kind==="camera")return c.maxSize;if(c.kind==="composite"){let d=i.possiblyEvaluate(new _r(c.maxZoom),a).evaluate(m,{},a),g=i.possiblyEvaluate(new _r(c.minZoom),a).evaluate(m,{},a);return Math.max(d,g)}return i.possiblyEvaluate(new _r(u)).evaluate(m,{},a)}function cM(c,i){let{expression:a}=i;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new _r(c+1))};if(a.kind==="source")return{kind:"source"};{let{zoomStops:u,interpolationType:m}=a,d=0;for(;d<u.length&&u[d]<=c;)d++;d=Math.max(0,d-1);let g=d;for(;g<u.length&&u[g]<c+1;)g++;g=Math.min(u.length-1,g);let b=u[d],T=u[g];return a.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:m}:{kind:"camera",minZoom:b,maxZoom:T,minSize:a.evaluate(new _r(b)),maxSize:a.evaluate(new _r(T)),interpolationType:m}}}function cx(c,{uSize:i,uSizeT:a},{lowerSize:u,upperSize:m}){return c.kind==="source"?u/Tc:c.kind==="composite"?gn(u/Tc,m/Tc,a):i}function Lm(c,i,a=1){let u=0,m=0;if(c.kind==="constant")m=c.layoutSize*a;else if(c.kind!=="source"){let{interpolationType:d,minZoom:g,maxZoom:b}=c,T=d?Rn(Y.interpolationFactor(d,i,g,b),0,1):0;c.kind==="camera"?m=gn(c.minSize,c.maxSize,T)*a:u=T*a}return{uSizeT:u,uSize:m}}var uU=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Tc,evaluateSizeForFeature:cx,evaluateSizeForZoom:Lm,getRasterizedIconSize:lx,getSizeData:cM});function hU(c,i,a){return c.sections.forEach(u=>{u.text=function(m,d,g){let b=d.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?m=m.toLocaleUpperCase():b==="lowercase"&&(m=m.toLocaleLowerCase()),Ws.applyArabicShaping&&(m=Ws.applyArabicShaping(m)),m}(u.text,i,a)}),c}let ty={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function dU(c){return c==="\uFE36"||c==="\uFE48"||c==="\uFE38"||c==="\uFE44"||c==="\uFE42"||c==="\uFE3E"||c==="\uFE3C"||c==="\uFE3A"||c==="\uFE18"||c==="\uFE40"||c==="\uFE10"||c==="\uFE13"||c==="\uFE14"||c==="\uFF40"||c==="\uFFE3"||c==="\uFE11"||c==="\uFE12"}function fU(c){return c==="\uFE35"||c==="\uFE47"||c==="\uFE37"||c==="\uFE43"||c==="\uFE41"||c==="\uFE3D"||c==="\uFE3B"||c==="\uFE39"||c==="\uFE17"||c==="\uFE3F"}var XD,uM,KD,hM={};function pU(){return XD||(XD=1,hM.read=function(c,i,a,u,m){var d,g,b=8*m-u-1,T=(1<<b)-1,O=T>>1,x=-7,E=a?m-1:0,P=a?-1:1,M=c[i+E];for(E+=P,d=M&(1<<-x)-1,M>>=-x,x+=b;x>0;d=256*d+c[i+E],E+=P,x-=8);for(g=d&(1<<-x)-1,d>>=-x,x+=u;x>0;g=256*g+c[i+E],E+=P,x-=8);if(d===0)d=1-O;else{if(d===T)return g?NaN:1/0*(M?-1:1);g+=Math.pow(2,u),d-=O}return(M?-1:1)*g*Math.pow(2,d-u)},hM.write=function(c,i,a,u,m,d){var g,b,T,O=8*d-m-1,x=(1<<O)-1,E=x>>1,P=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=u?0:d-1,I=u?1:-1,R=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(b=isNaN(i)?1:0,g=x):(g=Math.floor(Math.log(i)/Math.LN2),i*(T=Math.pow(2,-g))<1&&(g--,T*=2),(i+=g+E>=1?P/T:P*Math.pow(2,1-E))*T>=2&&(g++,T/=2),g+E>=x?(b=0,g=x):g+E>=1?(b=(i*T-1)*Math.pow(2,m),g+=E):(b=i*Math.pow(2,E-1)*Math.pow(2,m),g=0));m>=8;c[a+M]=255&b,M+=I,b/=256,m-=8);for(g=g<<m|b,O+=m;O>0;c[a+M]=255&g,M+=I,g/=256,O-=8);c[a+M-I]|=128*R}),hM}function JD(){if(KD)return uM;KD=1,uM=i;var c=pU();function i(G){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(G)?G:new Uint8Array(G||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var a=4294967296,u=1/a,m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function d(G){return G.type===i.Bytes?G.readVarint()+G.pos:G.pos+1}function g(G,X,J){return J?4294967296*X+(G>>>0):4294967296*(X>>>0)+(G>>>0)}function b(G,X,J){var te=X<=16383?1:X<=2097151?2:X<=268435455?3:Math.floor(Math.log(X)/(7*Math.LN2));J.realloc(te);for(var fe=J.pos-1;fe>=G;fe--)J.buf[fe+te]=J.buf[fe]}function T(G,X){for(var J=0;J<G.length;J++)X.writeVarint(G[J])}function O(G,X){for(var J=0;J<G.length;J++)X.writeSVarint(G[J])}function x(G,X){for(var J=0;J<G.length;J++)X.writeFloat(G[J])}function E(G,X){for(var J=0;J<G.length;J++)X.writeDouble(G[J])}function P(G,X){for(var J=0;J<G.length;J++)X.writeBoolean(G[J])}function M(G,X){for(var J=0;J<G.length;J++)X.writeFixed32(G[J])}function I(G,X){for(var J=0;J<G.length;J++)X.writeSFixed32(G[J])}function R(G,X){for(var J=0;J<G.length;J++)X.writeFixed64(G[J])}function V(G,X){for(var J=0;J<G.length;J++)X.writeSFixed64(G[J])}function j(G,X){return(G[X]|G[X+1]<<8|G[X+2]<<16)+16777216*G[X+3]}function Z(G,X,J){G[J]=X,G[J+1]=X>>>8,G[J+2]=X>>>16,G[J+3]=X>>>24}function W(G,X){return(G[X]|G[X+1]<<8|G[X+2]<<16)+(G[X+3]<<24)}return i.prototype={destroy:function(){this.buf=null},readFields:function(G,X,J){for(J=J||this.length;this.pos<J;){var te=this.readVarint(),fe=te>>3,de=this.pos;this.type=7&te,G(fe,X,this),this.pos===de&&this.skip(te)}return X},readMessage:function(G,X){return this.readFields(G,X,this.readVarint()+this.pos)},readFixed32:function(){var G=j(this.buf,this.pos);return this.pos+=4,G},readSFixed32:function(){var G=W(this.buf,this.pos);return this.pos+=4,G},readFixed64:function(){var G=j(this.buf,this.pos)+j(this.buf,this.pos+4)*a;return this.pos+=8,G},readSFixed64:function(){var G=j(this.buf,this.pos)+W(this.buf,this.pos+4)*a;return this.pos+=8,G},readFloat:function(){var G=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,G},readDouble:function(){var G=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,G},readVarint:function(G){var X,J,te=this.buf;return X=127&(J=te[this.pos++]),J<128?X:(X|=(127&(J=te[this.pos++]))<<7,J<128?X:(X|=(127&(J=te[this.pos++]))<<14,J<128?X:(X|=(127&(J=te[this.pos++]))<<21,J<128?X:function(fe,de,he){var Ce,me,Me=he.buf;if(Ce=(112&(me=Me[he.pos++]))>>4,me<128||(Ce|=(127&(me=Me[he.pos++]))<<3,me<128)||(Ce|=(127&(me=Me[he.pos++]))<<10,me<128)||(Ce|=(127&(me=Me[he.pos++]))<<17,me<128)||(Ce|=(127&(me=Me[he.pos++]))<<24,me<128)||(Ce|=(1&(me=Me[he.pos++]))<<31,me<128))return g(fe,Ce,de);throw new Error("Expected varint not more than 10 bytes")}(X|=(15&(J=te[this.pos]))<<28,G,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var G=this.readVarint();return G%2==1?(G+1)/-2:G/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var G=this.readVarint()+this.pos,X=this.pos;return this.pos=G,G-X>=12&&m?function(J,te,fe){return m.decode(J.subarray(te,fe))}(this.buf,X,G):function(J,te,fe){for(var de="",he=te;he<fe;){var Ce,me,Me,Oe=J[he],Pe=null,ke=Oe>239?4:Oe>223?3:Oe>191?2:1;if(he+ke>fe)break;ke===1?Oe<128&&(Pe=Oe):ke===2?(192&(Ce=J[he+1]))==128&&(Pe=(31&Oe)<<6|63&Ce)<=127&&(Pe=null):ke===3?(me=J[he+2],(192&(Ce=J[he+1]))==128&&(192&me)==128&&((Pe=(15&Oe)<<12|(63&Ce)<<6|63&me)<=2047||Pe>=55296&&Pe<=57343)&&(Pe=null)):ke===4&&(me=J[he+2],Me=J[he+3],(192&(Ce=J[he+1]))==128&&(192&me)==128&&(192&Me)==128&&((Pe=(15&Oe)<<18|(63&Ce)<<12|(63&me)<<6|63&Me)<=65535||Pe>=1114112)&&(Pe=null)),Pe===null?(Pe=65533,ke=1):Pe>65535&&(Pe-=65536,de+=String.fromCharCode(Pe>>>10&1023|55296),Pe=56320|1023&Pe),de+=String.fromCharCode(Pe),he+=ke}return de}(this.buf,X,G)},readBytes:function(){var G=this.readVarint()+this.pos,X=this.buf.subarray(this.pos,G);return this.pos=G,X},readPackedVarint:function(G,X){if(this.type!==i.Bytes)return G.push(this.readVarint(X));var J=d(this);for(G=G||[];this.pos<J;)G.push(this.readVarint(X));return G},readPackedSVarint:function(G){if(this.type!==i.Bytes)return G.push(this.readSVarint());var X=d(this);for(G=G||[];this.pos<X;)G.push(this.readSVarint());return G},readPackedBoolean:function(G){if(this.type!==i.Bytes)return G.push(this.readBoolean());var X=d(this);for(G=G||[];this.pos<X;)G.push(this.readBoolean());return G},readPackedFloat:function(G){if(this.type!==i.Bytes)return G.push(this.readFloat());var X=d(this);for(G=G||[];this.pos<X;)G.push(this.readFloat());return G},readPackedDouble:function(G){if(this.type!==i.Bytes)return G.push(this.readDouble());var X=d(this);for(G=G||[];this.pos<X;)G.push(this.readDouble());return G},readPackedFixed32:function(G){if(this.type!==i.Bytes)return G.push(this.readFixed32());var X=d(this);for(G=G||[];this.pos<X;)G.push(this.readFixed32());return G},readPackedSFixed32:function(G){if(this.type!==i.Bytes)return G.push(this.readSFixed32());var X=d(this);for(G=G||[];this.pos<X;)G.push(this.readSFixed32());return G},readPackedFixed64:function(G){if(this.type!==i.Bytes)return G.push(this.readFixed64());var X=d(this);for(G=G||[];this.pos<X;)G.push(this.readFixed64());return G},readPackedSFixed64:function(G){if(this.type!==i.Bytes)return G.push(this.readSFixed64());var X=d(this);for(G=G||[];this.pos<X;)G.push(this.readSFixed64());return G},skip:function(G){var X=7&G;if(X===i.Varint)for(;this.buf[this.pos++]>127;);else if(X===i.Bytes)this.pos=this.readVarint()+this.pos;else if(X===i.Fixed32)this.pos+=4;else{if(X!==i.Fixed64)throw new Error("Unimplemented type: "+X);this.pos+=8}},writeTag:function(G,X){this.writeVarint(G<<3|X)},realloc:function(G){for(var X=this.length||16;X<this.pos+G;)X*=2;if(X!==this.length){var J=new Uint8Array(X);J.set(this.buf),this.buf=J,this.length=X}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(G){this.realloc(4),Z(this.buf,G,this.pos),this.pos+=4},writeSFixed32:function(G){this.realloc(4),Z(this.buf,G,this.pos),this.pos+=4},writeFixed64:function(G){this.realloc(8),Z(this.buf,-1&G,this.pos),Z(this.buf,Math.floor(G*u),this.pos+4),this.pos+=8},writeSFixed64:function(G){this.realloc(8),Z(this.buf,-1&G,this.pos),Z(this.buf,Math.floor(G*u),this.pos+4),this.pos+=8},writeVarint:function(G){(G=+G||0)>268435455||G<0?function(X,J){var te,fe;if(X>=0?(te=X%4294967296|0,fe=X/4294967296|0):(fe=~(-X/4294967296),4294967295^(te=~(-X%4294967296))?te=te+1|0:(te=0,fe=fe+1|0)),X>=18446744073709552e3||X<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");J.realloc(10),function(de,he,Ce){Ce.buf[Ce.pos++]=127&de|128,de>>>=7,Ce.buf[Ce.pos++]=127&de|128,de>>>=7,Ce.buf[Ce.pos++]=127&de|128,de>>>=7,Ce.buf[Ce.pos++]=127&de|128,Ce.buf[Ce.pos]=127&(de>>>=7)}(te,0,J),function(de,he){var Ce=(7&de)<<4;he.buf[he.pos++]|=Ce|((de>>>=3)?128:0),de&&(he.buf[he.pos++]=127&de|((de>>>=7)?128:0),de&&(he.buf[he.pos++]=127&de|((de>>>=7)?128:0),de&&(he.buf[he.pos++]=127&de|((de>>>=7)?128:0),de&&(he.buf[he.pos++]=127&de|((de>>>=7)?128:0),de&&(he.buf[he.pos++]=127&de)))))}(fe,J)}(G,this):(this.realloc(4),this.buf[this.pos++]=127&G|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=G>>>7&127))))},writeSVarint:function(G){this.writeVarint(G<0?2*-G-1:2*G)},writeBoolean:function(G){this.writeVarint(!!G)},writeString:function(G){G=String(G),this.realloc(4*G.length),this.pos++;var X=this.pos;this.pos=function(te,fe,de){for(var he,Ce,me=0;me<fe.length;me++){if((he=fe.charCodeAt(me))>55295&&he<57344){if(!Ce){he>56319||me+1===fe.length?(te[de++]=239,te[de++]=191,te[de++]=189):Ce=he;continue}if(he<56320){te[de++]=239,te[de++]=191,te[de++]=189,Ce=he;continue}he=Ce-55296<<10|he-56320|65536,Ce=null}else Ce&&(te[de++]=239,te[de++]=191,te[de++]=189,Ce=null);he<128?te[de++]=he:(he<2048?te[de++]=he>>6|192:(he<65536?te[de++]=he>>12|224:(te[de++]=he>>18|240,te[de++]=he>>12&63|128),te[de++]=he>>6&63|128),te[de++]=63&he|128)}return de}(this.buf,G,this.pos);var J=this.pos-X;J>=128&&b(X,J,this),this.pos=X-1,this.writeVarint(J),this.pos+=J},writeFloat:function(G){this.realloc(4),c.write(this.buf,G,this.pos,!0,23,4),this.pos+=4},writeDouble:function(G){this.realloc(8),c.write(this.buf,G,this.pos,!0,52,8),this.pos+=8},writeBytes:function(G){var X=G.length;this.writeVarint(X),this.realloc(X);for(var J=0;J<X;J++)this.buf[this.pos++]=G[J]},writeRawMessage:function(G,X){this.pos++;var J=this.pos;G(X,this);var te=this.pos-J;te>=128&&b(J,te,this),this.pos=J-1,this.writeVarint(te),this.pos+=te},writeMessage:function(G,X,J){this.writeTag(G,i.Bytes),this.writeRawMessage(X,J)},writePackedVarint:function(G,X){X.length&&this.writeMessage(G,T,X)},writePackedSVarint:function(G,X){X.length&&this.writeMessage(G,O,X)},writePackedBoolean:function(G,X){X.length&&this.writeMessage(G,P,X)},writePackedFloat:function(G,X){X.length&&this.writeMessage(G,x,X)},writePackedDouble:function(G,X){X.length&&this.writeMessage(G,E,X)},writePackedFixed32:function(G,X){X.length&&this.writeMessage(G,M,X)},writePackedSFixed32:function(G,X){X.length&&this.writeMessage(G,I,X)},writePackedFixed64:function(G,X){X.length&&this.writeMessage(G,R,X)},writePackedSFixed64:function(G,X){X.length&&this.writeMessage(G,V,X)},writeBytesField:function(G,X){this.writeTag(G,i.Bytes),this.writeBytes(X)},writeFixed32Field:function(G,X){this.writeTag(G,i.Fixed32),this.writeFixed32(X)},writeSFixed32Field:function(G,X){this.writeTag(G,i.Fixed32),this.writeSFixed32(X)},writeFixed64Field:function(G,X){this.writeTag(G,i.Fixed64),this.writeFixed64(X)},writeSFixed64Field:function(G,X){this.writeTag(G,i.Fixed64),this.writeSFixed64(X)},writeVarintField:function(G,X){this.writeTag(G,i.Varint),this.writeVarint(X)},writeSVarintField:function(G,X){this.writeTag(G,i.Varint),this.writeSVarint(X)},writeStringField:function(G,X){this.writeTag(G,i.Bytes),this.writeString(X)},writeFloatField:function(G,X){this.writeTag(G,i.Fixed32),this.writeFloat(X)},writeDoubleField:function(G,X){this.writeTag(G,i.Fixed64),this.writeDouble(X)},writeBooleanField:function(G,X){this.writeVarintField(G,!!X)}},uM}var ux=w(JD());let dM=3;function mU(c,i,a){i.glyphs=[],c===1&&a.readMessage(gU,i)}function gU(c,i,a){if(c===3){let{id:u,bitmap:m,width:d,height:g,left:b,top:T,advance:O}=a.readMessage(_U,{});i.glyphs.push({id:u,bitmap:new _d({width:d+2*dM,height:g+2*dM},m),metrics:{width:d,height:g,left:b,top:T,advance:O}})}else c===4?i.ascender=a.readSVarint():c===5&&(i.descender=a.readSVarint())}function _U(c,i,a){c===1?i.id=a.readVarint():c===2?i.bitmap=a.readBytes():c===3?i.width=a.readVarint():c===4?i.height=a.readVarint():c===5?i.left=a.readSVarint():c===6?i.top=a.readSVarint():c===7&&(i.advance=a.readVarint())}let QD=dM,pl={horizontal:1,vertical:2,horizontalOnly:3};class ny{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,a){let u=new ny;return u.scale=i||1,u.fontStack=a,u}static forImage(i){let a=new ny;return a.image=i,a}}class Fm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a){let u=new Fm;for(let m=0;m<i.sections.length;m++){let d=i.sections[m];d.image?u.addImageSection(d):u.addTextSection(d,a)}return u}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(a,u){let m="";for(let d=0;d<a.length;d++){let g=a.charCodeAt(d+1)||null,b=a.charCodeAt(d-1)||null;m+=!u&&(g&&um(g)&&!ty[a[d+1]]||b&&um(b)&&!ty[a[d-1]])||!ty[a[d]]?a[d]:ty[a[d]]}return m}(this.text,i)}trim(){let i=0;for(let u=0;u<this.text.length&&hx[this.text.charCodeAt(u)];u++)i++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=i&&hx[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){let u=new Fm;return u.text=this.text.substring(i,a),u.sectionIndex=this.sectionIndex.slice(i,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(ny.forText(i.scale,i.fontStack||a));let u=this.sections.length-1;for(let m=0;m<i.text.length;++m)this.sectionIndex.push(u)}addImageSection(i){let a=i.image&&i.image.namePrimary?i.image.getPrimary():null;if(!a)return void Wn("Can't add FormattedSection with an empty image.");let u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(ny.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Wn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fM(c,i,a,u,m,d,g,b,T,O,x,E,P,M,I){let R=Fm.fromFeature(c,m);E===pl.vertical&&R.verticalizePunctuation(P);let V=[],j=function(J,te,fe,de,he,Ce){if(!J)return[];let me=[],Me=function(Ne,Be,Le,it,vt,rt){let Rt=0;for(let Pt=0;Pt<Ne.length();Pt++){let zt=Ne.getSection(Pt);Rt+=eO(Ne.getCodePoint(Pt),zt,it,vt,Be,rt)}return Rt/Math.max(1,Math.ceil(Rt/Le))}(J,te,fe,de,he,Ce),Oe=J.text.indexOf("\u200B")>=0,Pe=0;for(let Ne=0;Ne<J.length();Ne++){let Be=J.getSection(Ne),Le=J.getCodePoint(Ne);if(hx[Le]||(Pe+=eO(Le,Be,de,he,te,Ce)),Ne<J.length()-1){let it=!((ke=Le)<11904||!(sn["Bopomofo Extended"](ke)||sn.Bopomofo(ke)||sn["CJK Compatibility Forms"](ke)||sn["CJK Compatibility Ideographs"](ke)||sn["CJK Compatibility"](ke)||sn["CJK Radicals Supplement"](ke)||sn["CJK Strokes"](ke)||sn["CJK Symbols and Punctuation"](ke)||sn["CJK Unified Ideographs Extension A"](ke)||sn["CJK Unified Ideographs"](ke)||sn["Enclosed CJK Letters and Months"](ke)||sn["Halfwidth and Fullwidth Forms"](ke)||sn.Hiragana(ke)||sn["Ideographic Description Characters"](ke)||sn["Kangxi Radicals"](ke)||sn["Katakana Phonetic Extensions"](ke)||sn.Katakana(ke)||sn["Vertical Forms"](ke)||sn["Yi Radicals"](ke)||sn["Yi Syllables"](ke)));(yU[Le]||it||Be.image)&&me.push(nO(Ne+1,Pe,Me,me,vU(Le,J.getCodePoint(Ne+1),it&&Oe),!1))}}var ke;return iO(nO(J.length(),Pe,Me,me,0,!0))}(R,O,d,i,u,M),{processBidirectionalText:Z,processStyledBidirectionalText:W}=Ws;if(Z&&R.sections.length===1){let J=Z(R.toString(),j);for(let te of J){let fe=new Fm;fe.text=te,fe.sections=R.sections;for(let de=0;de<te.length;de++)fe.sectionIndex.push(0);V.push(fe)}}else if(W){let J=W(R.text,R.sectionIndex,j);for(let te of J){let fe=new Fm;fe.text=te[0],fe.sectionIndex=te[1],fe.sections=R.sections,V.push(fe)}}else V=function(J,te){let fe=[],de=J.text,he=0;for(let Ce of te)fe.push(J.substring(he,Ce)),he=Ce;return he<de.length&&fe.push(J.substring(he,de.length)),fe}(R,j);let G=[],X={positionedLines:G,text:R.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(J,te,fe,de,he,Ce,me,Me,Oe,Pe,ke,Ne){let Be=0,Le=0,it=0,vt=Me==="right"?1:Me==="left"?0:.5,rt=!1;for(let kt of he){let Jt=kt.getSections();for(let mn of Jt){if(mn.image)continue;let zn=te[mn.fontStack];if(zn&&(rt=zn.ascender!==void 0&&zn.descender!==void 0,!rt))break}if(!rt)break}let Rt=0;for(let kt of he){kt.trim();let Jt=kt.getMaxScale(),mn=(Jt-1)*ns,zn={positionedGlyphs:[],lineOffset:0};J.positionedLines[Rt]=zn;let Vn=zn.positionedGlyphs,Jn=0;if(!kt.length()){Le+=Ce,++Rt;continue}let jn=0,ni=0;for(let Vi=0;Vi<kt.length();Vi++){let Pn=kt.getSection(Vi),ji=kt.getSectionIndex(Vi),Li=kt.getCodePoint(Vi),Ji=Pn.scale,uo=null,ho=null,Yr=null,Js=ns,vr=0,Cr=!(Oe===pl.horizontal||!ke&&!cm(Li)||ke&&(hx[Li]||(Pt=Li,sn.Arabic(Pt)||sn["Arabic Supplement"](Pt)||sn["Arabic Extended-A"](Pt)||sn["Arabic Presentation Forms-A"](Pt)||sn["Arabic Presentation Forms-B"](Pt))));if(Pn.image){let Ps=de[Pn.image.serialize()];if(!Ps)continue;Yr=Pn.image.id,J.iconsInText=J.iconsInText||!0,ho=Ps.paddedRect;let fo=Ps.displaySize;Ji=Ji*ns/Ne,uo={width:fo[0],height:fo[1],left:0,top:-QD,advance:Cr?fo[1]:fo[0],localGlyph:!1},vr=rt?-uo.height*Ji:Jt*ns-17-fo[1]*Ji,Js=uo.advance;let pa=(Cr?fo[0]:fo[1])*Ji-ns*Jt;pa>0&&pa>Jn&&(Jn=pa)}else{let Ps=fe[Pn.fontStack];if(!Ps)continue;Ps[Li]&&(ho=Ps[Li]);let fo=te[Pn.fontStack];if(!fo)continue;let pa=fo.glyphs[Li];if(!pa)continue;if(uo=pa.metrics,Js=Li!==8203?ns:0,rt){let Io=fo.ascender!==void 0?Math.abs(fo.ascender):0,_u=fo.descender!==void 0?Math.abs(fo.descender):0,Md=(Io+_u)*Ji;jn<Md&&(jn=Md,ni=(Io-_u)/2*Ji),vr=-Io*Ji}else vr=(Jt-Ji)*ns-17}Cr?(J.verticalizable=!0,Vn.push({glyph:Li,imageName:Yr,x:Be,y:Le+vr,vertical:Cr,scale:Ji,localGlyph:uo.localGlyph,fontStack:Pn.fontStack,sectionIndex:ji,metrics:uo,rect:ho}),Be+=Js*Ji+Pe):(Vn.push({glyph:Li,imageName:Yr,x:Be,y:Le+vr,vertical:Cr,scale:Ji,localGlyph:uo.localGlyph,fontStack:Pn.fontStack,sectionIndex:ji,metrics:uo,rect:ho}),Be+=uo.advance*Ji+Pe)}Vn.length!==0&&(it=Math.max(Be-Pe,it),rt?rO(Vn,vt,Jn,ni,Ce*Jt/2):rO(Vn,vt,Jn,0,Ce/2)),Be=0;let Ki=Ce*Jt+Jn;zn.lineOffset=Math.max(Jn,mn),Le+=Ki,++Rt}var Pt;let zt=Le,{horizontalAlign:ct,verticalAlign:tn}=pM(me);(function(kt,Jt,mn,zn,Vn,Jn){let jn=(Jt-mn)*Vn,ni=-Jn*zn;for(let Ki of kt)for(let Vi of Ki.positionedGlyphs)Vi.x+=jn,Vi.y+=ni})(J.positionedLines,vt,ct,tn,it,zt),J.top+=-tn*zt,J.bottom=J.top+zt,J.left+=-ct*it,J.right=J.left+it,J.hasBaseline=rt}(X,i,a,u,V,g,b,T,E,O,P,I),!function(J){for(let te of J)if(te.positionedGlyphs.length!==0)return!1;return!0}(G)&&X}let hx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yU={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function eO(c,i,a,u,m,d){if(i.image){let g=u[i.image.serialize()];return g?g.displaySize[0]*i.scale*ns/d+m:0}{let g=a[i.fontStack],b=g&&g.glyphs[c];return b?b.metrics.advance*i.scale+m:0}}function tO(c,i,a,u){let m=Math.pow(c-i,2);return u?c<i?m/2:2*m:m+Math.abs(a)*a}function vU(c,i,a){let u=0;return c===10&&(u-=1e4),a&&(u+=150),c!==40&&c!==65288||(u+=50),i!==41&&i!==65289||(u+=50),u}function nO(c,i,a,u,m,d){let g=null,b=tO(i,a,m,d);for(let T of u){let O=tO(i-T.x,a,m,d)+T.badness;O<=b&&(g=T,b=O)}return{index:c,x:i,priorBreak:g,badness:b}}function iO(c){return c?iO(c.priorBreak).concat(c.index):[]}function pM(c){let i=.5,a=.5;switch(c){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function rO(c,i,a,u,m){if(!(i||a||u||m))return;let d=c.length-1,g=c[d],b=(g.x+g.metrics.advance*g.scale)*i;for(let T=0;T<=d;T++)c[T].x-=b,c[T].y+=a+u+m}function xU(c,i,a,u){let{horizontalAlign:m,verticalAlign:d}=pM(u),g=a[0]-c.displaySize[0]*m,b=a[1]-c.displaySize[1]*d;return{imagePrimary:c,imageSecondary:i,top:b,bottom:b+c.displaySize[1],left:g,right:g+c.displaySize[0]}}function oO(c,i,a,u,m,d){let g=c.imagePrimary,b;if(g.content){let V=g.content,j=g.pixelRatio||1;b=[V[0]/j,V[1]/j,g.displaySize[0]-V[2]/j,g.displaySize[1]-V[3]/j]}let T=i.left*d,O=i.right*d,x,E,P,M;a==="width"||a==="both"?(M=m[0]+T-u[3],E=m[0]+O+u[1]):(M=m[0]+(T+O-g.displaySize[0])/2,E=M+g.displaySize[0]);let I=i.top*d,R=i.bottom*d;return a==="height"||a==="both"?(x=m[1]+I-u[0],P=m[1]+R+u[2]):(x=m[1]+(I+R-g.displaySize[1])/2,P=x+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:x,right:E,bottom:P,left:M,collisionPadding:b}}class hh extends We{constructor(i,a,u,m,d){super(i,a),this.angle=m,this.z=u,d!==void 0&&(this.segment=d)}clone(){return new hh(this.x,this.y,this.z,this.angle,this.segment)}}function sO(c,i,a,u,m){if(i.segment===void 0)return!0;let d=i,g=i.segment+1,b=0;for(;b>-a/2;){if(g--,g<0)return!1;b-=c[g].dist(d),d=c[g]}b+=c[g].dist(c[g+1]),g++;let T=[],O=0;for(;b<a/2;){let x=c[g],E=c[g+1];if(!E)return!1;let P=c[g-1].angleTo(x)-x.angleTo(E);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:P}),O+=P;b-T[0].distance>u;)O-=T.shift().angleDelta;if(O>m)return!1;g++,b+=x.dist(E)}return!0}function aO(c){let i=0;for(let a=0;a<c.length-1;a++)i+=c[a].dist(c[a+1]);return i}function lO(c,i,a){return c?.6*i*a:0}function cO(c,i){return Math.max(c?c.right-c.left:0,i?i.right-i.left:0)}function bU(c,i,a,u,m,d){let g=lO(a,m,d),b=cO(a,u)*d,T=0,O=aO(c)/2;for(let x=0;x<c.length-1;x++){let E=c[x],P=c[x+1],M=E.dist(P);if(T+M>O){let I=(O-T)/M,R=gn(E.x,P.x,I),V=gn(E.y,P.y,I),j=new hh(R,V,0,P.angleTo(E),x);return!g||sO(c,j,b,g,i)?j:void 0}T+=M}}function wU(c,i,a,u,m,d,g,b,T){let O=lO(u,d,g),x=cO(u,m),E=x*g,P=c[0].x===0||c[0].x===T||c[0].y===0||c[0].y===T;return i-E<i/4&&(i=E+i/4),uO(c,P?i/2*b%i:(x/2+2*d)*g*b%i,i,O,a,E,P,!1,T)}function uO(c,i,a,u,m,d,g,b,T){let O=d/2,x=aO(c),E=0,P=i-a,M=[];for(let I=0;I<c.length-1;I++){let R=c[I],V=c[I+1],j=R.dist(V),Z=V.angleTo(R);for(;P+a<E+j;){P+=a;let W=(P-E)/j,G=gn(R.x,V.x,W),X=gn(R.y,V.y,W);if(G>=0&&G<T&&X>=0&&X<T&&P-O>=0&&P+O<=x){let J=new hh(G,X,0,Z,I);u&&!sO(c,J,d,u,m)||M.push(J)}}E+=j}return b||M.length||g||(M=uO(c,E/2,a,u,m,d,g,!0,T)),M}function hO(c,i,a,u,m){let d=[];for(let g=0;g<c.length;g++){let b=c[g],T;for(let O=0;O<b.length-1;O++){let x=b[O],E=b[O+1];x.x<i&&E.x<i||(x.x<i?x=new We(i,x.y+(i-x.x)/(E.x-x.x)*(E.y-x.y))._round():E.x<i&&(E=new We(i,x.y+(i-x.x)/(E.x-x.x)*(E.y-x.y))._round()),x.y<a&&E.y<a||(x.y<a?x=new We(x.x+(a-x.y)/(E.y-x.y)*(E.x-x.x),a)._round():E.y<a&&(E=new We(x.x+(a-x.y)/(E.y-x.y)*(E.x-x.x),a)._round()),x.x>=u&&E.x>=u||(x.x>=u?x=new We(u,x.y+(u-x.x)/(E.x-x.x)*(E.y-x.y))._round():E.x>=u&&(E=new We(u,x.y+(u-x.x)/(E.x-x.x)*(E.y-x.y))._round()),x.y>=m&&E.y>=m||(x.y>=m?x=new We(x.x+(m-x.y)/(E.y-x.y)*(E.x-x.x),m)._round():E.y>=m&&(E=new We(x.x+(m-x.y)/(E.y-x.y)*(E.x-x.x),m)._round()),T&&x.equals(T[T.length-1])||(T=[x],d.push(T)),T.push(E)))))}}return d}function dO(c){let i=0,a=0;for(let g of c)i+=g.w*g.h,a=Math.max(a,g.w);c.sort((g,b)=>b.h-g.h);let u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}],m=0,d=0;for(let g of c)for(let b=u.length-1;b>=0;b--){let T=u[b];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,d=Math.max(d,g.y+g.h),m=Math.max(m,g.x+g.w),g.w===T.w&&g.h===T.h){let O=u.pop();b<u.length&&(u[b]=O)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(u.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:m,h:d,fill:i/(m*d)||0}}Xt(hh,"Anchor");let iy=1;class mM{constructor(i,{pixelRatio:a,version:u,stretchX:m,stretchY:d,content:g},b){this.paddedRect=i,this.pixelRatio=a,this.stretchX=m,this.stretchY=d,this.content=g,this.version=u,this.padding=b}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class fO{constructor(i,a,u){let m={},d={};this.haveRenderCallbacks=[];let g=[];this.addImages(i,m,iy,g),this.addImages(a,d,2,g);let{w:b,h:T}=dO(g),O=new gs({width:b||1,height:T||1});for(let x in i){let E=i[x],P=m[x].paddedRect;gs.copy(E.data,O,{x:0,y:0},{x:P.x+iy,y:P.y+iy},E.data,u,E.sdf)}for(let x in a){let E=a[x],P=d[x].paddedRect,M=d[x].padding,I=P.x+M,R=P.y+M,V=E.data.width,j=E.data.height;M=M>1?M-1:M,gs.copy(E.data,O,{x:0,y:0},{x:I,y:R},E.data,u),gs.copy(E.data,O,{x:0,y:j-M},{x:I,y:R-M},{width:V,height:M},u),gs.copy(E.data,O,{x:0,y:0},{x:I,y:R+j},{width:V,height:M},u),gs.copy(E.data,O,{x:V-M,y:0},{x:I-M,y:R},{width:M,height:j},u),gs.copy(E.data,O,{x:0,y:0},{x:I+V,y:R},{width:M,height:j},u),gs.copy(E.data,O,{x:V-M,y:j-M},{x:I-M,y:R-M},{width:M,height:M},u),gs.copy(E.data,O,{x:0,y:j-M},{x:I+V,y:R-M},{width:M,height:M},u),gs.copy(E.data,O,{x:0,y:0},{x:I+V,y:R+j},{width:M,height:M},u),gs.copy(E.data,O,{x:V-M,y:0},{x:I-M,y:R+j},{width:M,height:M},u)}this.image=O,this.iconPositions=m,this.patternPositions=d}addImages(i,a,u,m){for(let d in i){let g=i[d],b={x:0,y:0,w:g.data.width+2*u,h:g.data.height+2*u};m.push(b),a[d]=new mM(b,g,u),g.hasRenderCallback&&this.haveRenderCallbacks.push(cs.deserializeId(d))}}patchUpdatedImages(i,a,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>i.hasImage(m,u)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(let m in i.getUpdatedImages(u)){for(let d of Object.keys(this.iconPositions))cs.deserializeId(d)===m&&this.patchUpdatedImage(this.iconPositions[d],i.getImage(m,u),a);for(let d of Object.keys(this.patternPositions))cs.deserializeId(d)===m&&this.patchUpdatedImage(this.patternPositions[d],i.getImage(m,u),a)}}patchUpdatedImage(i,a,u){if(!i||!a||i.version===a.version)return;i.version=a.version;let[m,d]=i.tl;u.update(a.data,{position:{x:m,y:d}})}}Xt(mM,"ImagePosition"),Xt(fO,"ImageAtlas");let ry=1e20;function pO(c,i,a,u,m,d,g,b,T){for(let O=i;O<i+u;O++)mO(c,a*d+O,d,m,g,b,T);for(let O=a;O<a+m;O++)mO(c,O*d+i,1,u,g,b,T)}function mO(c,i,a,u,m,d,g){d[0]=0,g[0]=-ry,g[1]=ry,m[0]=c[i];for(let b=1,T=0,O=0;b<u;b++){m[b]=c[i+b*a];let x=b*b;do{let E=d[T];O=(m[b]-m[E]+x-E*E)/(b-E)/2}while(O<=g[T]&&--T>-1);T++,d[T]=b,g[T]=O,g[T+1]=ry}for(let b=0,T=0;b<u;b++){for(;g[T+1]<b;)T++;let O=d[T],x=b-O;c[i+b*a]=m[O]+x*x}}let Ec=2,gM={none:0,ideographs:1,all:2};class Nm{constructor(i,a,u){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i,a){this.urls[a]=i}getGlyphs(i,a,u){let m=[],d=this.urls[a]||_e.GLYPHS_URL;for(let g in i)for(let b of i[g])m.push({stack:g,id:b});El(m,({stack:g,id:b},T)=>{let O=this.entries[g];O||(O=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=O.glyphs[b];if(x!==void 0)return void T(null,{stack:g,id:b,glyph:x});if(x=this._tinySDF(O,g,b),x)return O.glyphs[b]=x,void T(null,{stack:g,id:b,glyph:x});let E=Math.floor(b/256);if(256*E>65535)return Wn("glyphs > 65535 not supported"),void T(null,{stack:g,id:b,glyph:x});if(O.ranges[E])return void T(null,{stack:g,id:b,glyph:x});let P=O.requests[E];P||(P=O.requests[E]=[],Nm.loadGlyphRange(g,E,d,this.requestManager,(M,I)=>{if(I){O.ascender=I.ascender,O.descender=I.descender;for(let R in I.glyphs)this._doesCharSupportLocalGlyph(+R)||(O.glyphs[+R]=I.glyphs[+R]);O.ranges[E]=!0}for(let R of P)R(M,I);delete O.requests[E]})),P.push((M,I)=>{M?T(M):I&&T(null,{stack:g,id:b,glyph:I.glyphs[b]||null})})},(g,b)=>{if(g)u(g);else if(b){let T={};for(let{stack:O,id:x,glyph:E}of b)T[O]===void 0&&(T[O]={}),T[O].glyphs===void 0&&(T[O].glyphs={}),T[O].glyphs[x]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},T[O].ascender=this.entries[O].ascender,T[O].descender=this.entries[O].descender;u(null,T)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==gM.none&&(this.localGlyphMode===gM.all?!!this.localFontFamily:!!this.localFontFamily&&(sn["CJK Unified Ideographs"](i)||sn["Hangul Syllables"](i)||sn.Hiragana(i)||sn.Katakana(i)||sn["CJK Symbols and Punctuation"](i)||sn["CJK Unified Ideographs Extension A"](i)||sn["CJK Unified Ideographs Extension B"](i)||sn.Osage(i)))}_tinySDF(i,a,u){let m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let d=i.tinySDF;if(!d){let R="400";/bold/i.test(a)?R="900":/medium/i.test(a)?R="500":/light/i.test(a)&&(R="200"),d=i.tinySDF=new Nm.TinySDF({fontFamily:m,fontWeight:R,fontSize:24*Ec,buffer:3*Ec,radius:8*Ec}),d.fontWeight=R}if(this.localGlyphs[d.fontWeight][u])return this.localGlyphs[d.fontWeight][u];let g=String.fromCodePoint(u),{data:b,width:T,height:O,glyphWidth:x,glyphHeight:E,glyphLeft:P,glyphTop:M,glyphAdvance:I}=d.draw(g);return this.localGlyphs[d.fontWeight][u]={id:u,bitmap:new _d({width:T,height:O},b),metrics:{width:x/Ec,height:E/Ec,left:P/Ec,top:M/Ec-27,advance:I/Ec,localGlyph:!0}}}}Nm.loadGlyphRange=function(c,i,a,u,m){let d=256*i,g=d+255,b=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",c).replace("{range}",`${d}-${g}`),Il.Glyphs);Aa(b,(T,O)=>{if(T)m(T);else if(O){let x={},E=function(P){return new ux(P).readFields(mU,{})}(O);for(let P of E.glyphs)x[P.id]=P;m(null,{glyphs:x,ascender:E.ascender,descender:E.descender})}})},Nm.TinySDF=class{constructor({fontSize:c=24,buffer:i=3,radius:a=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=i,this.cutoff=u,this.radius=a;let b=this.size=c+4*i,T=this._createCanvas(b),O=this.ctx=T.getContext("2d",{willReadFrequently:!0});O.font=`${g} ${d} ${c}px ${m}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(c){let i=document.createElement("canvas");return i.width=i.height=c,i}draw(c){let{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:d}=this.ctx.measureText(c),g=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-m))),T=Math.min(this.size-this.buffer,g+Math.ceil(u)),O=b+2*this.buffer,x=T+2*this.buffer,E=Math.max(O*x,0),P=new Uint8ClampedArray(E),M={data:P,width:O,height:x,glyphWidth:b,glyphHeight:T,glyphTop:g,glyphLeft:0,glyphAdvance:i};if(b===0||T===0)return M;let{ctx:I,buffer:R,gridInner:V,gridOuter:j}=this;I.clearRect(R,R,b,T),I.fillText(c,R,R+g);let Z=I.getImageData(R,R,b,T);j.fill(ry,0,E),V.fill(0,0,E);for(let W=0;W<T;W++)for(let G=0;G<b;G++){let X=Z.data[4*(W*b+G)+3]/255;if(X===0)continue;let J=(W+R)*O+G+R;if(X===1)j[J]=0,V[J]=ry;else{let te=.5-X;j[J]=te>0?te*te:0,V[J]=te<0?te*te:0}}pO(j,0,0,O,x,O,this.f,this.v,this.z),pO(V,R,R,b,T,O,this.f,this.v,this.z);for(let W=0;W<E;W++){let G=Math.sqrt(j[W])-Math.sqrt(V[W]);P[W]=Math.round(255-255*(G/this.radius+this.cutoff))}return M}};let vd=iy;function gO(c,i){return c+i[1]-i[0]}function _O(c,i,a,u,m=1){let d=[],g=c.imagePrimary,b=g.pixelRatio,T=g.paddedRect.w-2*vd,O=g.paddedRect.h-2*vd,x=(c.right-c.left)*m,E=(c.bottom-c.top)*m,P=g.stretchX||[[0,T]],M=g.stretchY||[[0,O]],I=P.reduce(gO,0),R=M.reduce(gO,0),V=T-I,j=O-R,Z=0,W=I,G=0,X=R,J=0,te=V,fe=0,de=j;if(g.content&&u){let Ce=g.content;Z=dx(P,0,Ce[0]),G=dx(M,0,Ce[1]),W=dx(P,Ce[0],Ce[2]),X=dx(M,Ce[1],Ce[3]),J=Ce[0]-Z,fe=Ce[1]-G,te=Ce[2]-Ce[0]-W,de=Ce[3]-Ce[1]-X}let he=(Ce,me,Me,Oe)=>{let Pe=fx(Ce.stretch-Z,W,x,c.left*m),ke=px(Ce.fixed-J,te,Ce.stretch,I),Ne=fx(me.stretch-G,X,E,c.top*m),Be=px(me.fixed-fe,de,me.stretch,R),Le=fx(Me.stretch-Z,W,x,c.left*m),it=px(Me.fixed-J,te,Me.stretch,I),vt=fx(Oe.stretch-G,X,E,c.top*m),rt=px(Oe.fixed-fe,de,Oe.stretch,R),Rt=new We(Pe,Ne),Pt=new We(Le,Ne),zt=new We(Le,vt),ct=new We(Pe,vt),tn=new We(ke/b,Be/b),kt=new We(it/b,rt/b),Jt=i*Math.PI/180;if(Jt){let ni=Math.sin(Jt),Ki=Math.cos(Jt),Vi=[Ki,-ni,ni,Ki];Rt._matMult(Vi),Pt._matMult(Vi),ct._matMult(Vi),zt._matMult(Vi)}let mn=Ce.stretch+Ce.fixed,zn=Me.stretch+Me.fixed,Vn=me.stretch+me.fixed,Jn=Oe.stretch+Oe.fixed,jn=c.imageSecondary;return{tl:Rt,tr:Pt,bl:ct,br:zt,texPrimary:{x:g.paddedRect.x+vd+mn,y:g.paddedRect.y+vd+Vn,w:zn-mn,h:Jn-Vn},texSecondary:jn?{x:jn.paddedRect.x+vd+mn,y:jn.paddedRect.y+vd+Vn,w:zn-mn,h:Jn-Vn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:tn,pixelOffsetBR:kt,minFontScaleX:te/b/x,minFontScaleY:de/b/E,isSDF:a}};if(u&&(g.stretchX||g.stretchY)){let Ce=yO(P,V,I),me=yO(M,j,R);for(let Me=0;Me<Ce.length-1;Me++){let Oe=Ce[Me],Pe=Ce[Me+1];for(let ke=0;ke<me.length-1;ke++)d.push(he(Oe,me[ke],Pe,me[ke+1]))}}else d.push(he({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:O+1}));return d}function dx(c,i,a){let u=0;for(let m of c)u+=Math.max(i,Math.min(a,m[1]))-Math.max(i,Math.min(a,m[0]));return u}function yO(c,i,a){let u=[{fixed:-vd,stretch:0}];for(let[m,d]of c){let g=u[u.length-1];u.push({fixed:m-g.stretch,stretch:g.stretch}),u.push({fixed:m-g.stretch,stretch:g.stretch+(d-m)})}return u.push({fixed:i+vd,stretch:a}),u}function fx(c,i,a,u){return c/i*a+u}function px(c,i,a,u){return c-i*a/u}function CU(c,i,a,u){let m=i+c.positionedLines[u].lineOffset;return u===0?a+m/2:a+(m+(i+c.positionedLines[u-1].lineOffset))/2}function MU(c,i=1,a=!1){let u=1/0,m=1/0,d=-1/0,g=-1/0,b=c[0];for(let M=0;M<b.length;M++){let I=b[M];(!M||I.x<u)&&(u=I.x),(!M||I.y<m)&&(m=I.y),(!M||I.x>d)&&(d=I.x),(!M||I.y>g)&&(g=I.y)}let T=Math.min(d-u,g-m),O=T/2,x=new Gh([],TU);if(T===0)return new We(u,m);for(let M=u;M<d;M+=T)for(let I=m;I<g;I+=T)x.push(new zm(M+O,I+O,O,c));let E=function(M){let I=0,R=0,V=0,j=M[0];for(let Z=0,W=j.length,G=W-1;Z<W;G=Z++){let X=j[Z],J=j[G],te=X.x*J.y-J.x*X.y;R+=(X.x+J.x)*te,V+=(X.y+J.y)*te,I+=3*te}return new zm(R/I,V/I,0,M)}(c),P=x.length;for(;x.length;){let M=x.pop();(M.d>E.d||!E.d)&&(E=M,a&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,P)),M.max-E.d<=i||(O=M.h/2,x.push(new zm(M.p.x-O,M.p.y-O,O,c)),x.push(new zm(M.p.x+O,M.p.y-O,O,c)),x.push(new zm(M.p.x-O,M.p.y+O,O,c)),x.push(new zm(M.p.x+O,M.p.y+O,O,c)),P+=4)}return a&&(console.log(`num probes: ${P}`),console.log(`best distance: ${E.d}`)),E.p}function TU(c,i){return i.max-c.max}class zm{constructor(i,a,u,m){this.p=new We(i,a),this.h=u,this.d=function(d,g){let b=!1,T=1/0;for(let O=0;O<g.length;O++){let x=g[O];for(let E=0,P=x.length,M=P-1;E<P;M=E++){let I=x[E],R=x[M];I.y>d.y!=R.y>d.y&&d.x<(R.x-I.x)*(d.y-I.y)/(R.y-I.y)+I.x&&(b=!b),T=Math.min(T,ve(d,I,R))}}return(b?1:-1)*Math.sqrt(T)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}let _M=Number.POSITIVE_INFINITY,EU=Math.sqrt(2);function vO(c,[i,a]){let u=0,m=0;if(a===_M){i<0&&(i=0);let d=i/EU;switch(c){case"top-right":case"top-left":m=d-7;break;case"bottom-right":case"bottom-left":m=7-d;break;case"bottom":m=7-i;break;case"top":m=i-7}switch(c){case"top-right":case"bottom-right":u=-d;break;case"top-left":case"bottom-left":u=d;break;case"left":u=i;break;case"right":u=-i}}else{switch(i=Math.abs(i),a=Math.abs(a),c){case"top-right":case"top-left":case"top":m=a-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-a}switch(c){case"top-right":case"bottom-right":case"right":u=-i;break;case"top-left":case"bottom-left":case"left":u=i}}return[u,m]}function yM(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function SU(c,i,a,u,m,d,g,b,T,O,x,E,P,M,I,R){let V=d.textMaxSize.evaluate(i,{},P);V===void 0?V=g*d.textScaleFactor:V*=d.textScaleFactor;let j=c.layers[0].layout,Z=j.get("icon-offset").evaluate(i,{},P),W=bO(a.horizontal)||a.vertical,G=M.name==="globe",X=ns,J=g*d.textScaleFactor/X,te=c.tilePixelRatio*V/X,fe=(ke=c.overscaling,c.zoom>18&&ke>2&&(ke>>=1),Math.max(Ot/(512*ke),1)*j.get("symbol-spacing")),de=j.get("text-padding")*c.tilePixelRatio,he=j.get("icon-padding")*c.tilePixelRatio,Ce=Cn(j.get("text-max-angle")),me=j.get("text-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Me=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Oe=j.get("symbol-placement"),Pe=fe/2;var ke;let Ne=j.get("icon-text-fit").evaluate(i,{},P),Be=j.get("icon-text-fit-padding").evaluate(i,{},P),Le=Ne!=="none",it;c.hasAnyIconTextFit===!1&&Le&&(c.hasAnyIconTextFit=!0),u&&Le&&(c.allowVerticalPlacement&&a.vertical&&(it=oO(u,a.vertical,Ne,Be,Z,J)),W&&(u=oO(u,W,Ne,Be,Z,J)));let vt=(rt,Rt,Pt)=>{if(Rt.x<0||Rt.x>=Ot||Rt.y<0||Rt.y>=Ot)return;let zt=null;if(G){let{x:ct,y:tn,z:kt}=M.projectTilePoint(Rt.x,Rt.y,Pt);zt={anchor:new hh(ct,tn,kt,0,void 0),up:M.upVector(Pt,Rt.x,Rt.y)}}(function(ct,tn,kt,Jt,mn,zn,Vn,Jn,jn,ni,Ki,Vi,Pn,ji,Li,Ji,uo,ho,Yr,Js,vr,Cr,Ps,fo,pa,Io,_u,Md){let Td=ct.addToLineVertexArray(tn,Jt),dh,Ed,Sd,Ux,QA,eR,tR,nR=0,iR=0,rR=0,oR=0,QM=-1,eT=-1,yu={},sR=sa(""),Jf=kt?kt.anchor:tn,tT=jn.layout.get("icon-text-fit").evaluate(vr,{},Io)!=="none",nT=0,iT=0;if(jn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[nT,iT]=jn.layout.get("text-offset").evaluate(vr,{},Io).map(gl=>gl*ns):(nT=jn.layout.get("text-radial-offset").evaluate(vr,{},Io)*ns,iT=_M),ct.allowVerticalPlacement&&mn.vertical){let gl=mn.vertical;if(Li)eR=vM(gl),Jn&&(tR=vM(Jn));else{let ja=jn.layout.get("text-rotate").evaluate(vr,{},Io)+90;Sd=mx(ni,Jf,tn,Ki,Vi,Pn,gl,ji,ja,Ji),Jn&&(Ux=mx(ni,Jf,tn,Ki,Vi,Pn,Jn,ho,ja))}}if(zn){let gl=ct.iconSizeData,ja=fo?lx(ct.iconSizeData,ct.layers[0]._unevaluatedLayout._values["icon-size"],Io,ct.zoom,vr):1,Ym=jn.layout.get("icon-rotate").evaluate(vr,{},Io),aR=_O(zn,Ym,Ps,tT,fo?1/ja:Cr.iconScaleFactor),oT=Jn?_O(Jn,Ym,Ps,tT,Cr.iconScaleFactor):void 0;Ed=mx(ni,Jf,tn,Ki,Vi,Pn,zn,ho,Ym,null,fo?Cr.iconScaleFactor*ja:1),nR=4*aR.length;let Qf=null;gl.kind==="source"?(Qf=[Tc*jn.layout.get("icon-size").evaluate(vr,{},Io)*Cr.iconScaleFactor],Qf[0]>xd&&Wn(`${ct.layerIds[0]}: Value for "icon-size" is >= ${oy}. Reduce your "icon-size".`)):gl.kind==="composite"&&(Qf=[Tc*Cr.compositeIconSizes[0].evaluate(vr,{},Io)*Cr.iconScaleFactor,Tc*Cr.compositeIconSizes[1].evaluate(vr,{},Io)*Cr.iconScaleFactor],(Qf[0]>xd||Qf[1]>xd)&&Wn(`${ct.layerIds[0]}: Value for "icon-size" is >= ${oy}. Reduce your "icon-size".`)),ct.addSymbols(ct.icon,aR,Qf,Js,Yr,vr,!1,kt,tn,Td.lineStartIndex,Td.lineLength,-1,pa,Io,_u,Md),QM=ct.icon.placedSymbolArray.length-1,oT&&(iR=4*oT.length,ct.addSymbols(ct.icon,oT,Qf,Js,Yr,vr,pl.vertical,kt,tn,Td.lineStartIndex,Td.lineLength,-1,pa,Io,_u,Md),eT=ct.icon.placedSymbolArray.length-1)}for(let gl in mn.horizontal){let ja=mn.horizontal[gl];dh||(sR=sa(ja.text),Li?QA=vM(ja):dh=mx(ni,Jf,tn,Ki,Vi,Pn,ja,ji,jn.layout.get("text-rotate").evaluate(vr,{},Io),Ji));let Ym=ja.positionedLines.length===1;if(rR+=xO(ct,kt,tn,ja,Vn,jn,Li,vr,Ji,Td,mn.vertical?pl.horizontal:pl.horizontalOnly,Ym?Object.keys(mn.horizontal):[gl],yu,QM,Cr,pa,Io,_u),Ym)break}mn.vertical&&(oR+=xO(ct,kt,tn,mn.vertical,Vn,jn,Li,vr,Ji,Td,pl.vertical,["vertical"],yu,eT,Cr,pa,Io,_u));let Id=-1,rT=(gl,ja)=>gl?Math.max(gl,ja):ja;Id=rT(QA,Id),Id=rT(eR,Id),Id=rT(tR,Id);let s9=Id>-1?1:0;ct.glyphOffsetArray.length>=65535&&Wn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vr.sortKey!==void 0&&ct.addToSortKeyRanges(ct.symbolInstances.length,vr.sortKey),ct.symbolInstances.emplaceBack(tn.x,tn.y,Jf.x,Jf.y,Jf.z,yu.right>=0?yu.right:-1,yu.center>=0?yu.center:-1,yu.left>=0?yu.left:-1,yu.vertical>=0?yu.vertical:-1,QM,eT,sR,dh!==void 0?dh:ct.collisionBoxArray.length,dh!==void 0?dh+1:ct.collisionBoxArray.length,Sd!==void 0?Sd:ct.collisionBoxArray.length,Sd!==void 0?Sd+1:ct.collisionBoxArray.length,Ed!==void 0?Ed:ct.collisionBoxArray.length,Ed!==void 0?Ed+1:ct.collisionBoxArray.length,Ux||ct.collisionBoxArray.length,Ux?Ux+1:ct.collisionBoxArray.length,Ki,rR,oR,nR,iR,s9,0,nT,iT,Id,0,tT?1:0)})(c,Rt,zt,rt,a,u,m,it,c.layers[0],c.collisionBoxArray,i.index,i.sourceLayerIndex,c.index,de,me,T,0,he,Me,Z,i,d,O,x,E,P,I,R)};if(Oe==="line")for(let rt of hO(i.geometry,0,0,Ot,Ot)){let Rt=wU(rt,fe,Ce,a.vertical||W,u,X,te,c.overscaling,Ot);for(let Pt of Rt)W&&IU(c,W.text,Pe,Pt)||vt(rt,Pt,P)}else if(Oe==="line-center"){for(let rt of i.geometry)if(rt.length>1){let Rt=bU(rt,Ce,a.vertical||W,u,X,te);Rt&&vt(rt,Rt,P)}}else if(i.type==="Polygon")for(let rt of tx(i.geometry,0)){let Rt=MU(rt,16);vt(rt[0],new hh(Rt.x,Rt.y,0,0,void 0),P)}else if(i.type==="LineString")for(let rt of i.geometry)vt(rt,new hh(rt[0].x,rt[0].y,0,0,void 0),P);else if(i.type==="Point")for(let rt of i.geometry)for(let Rt of rt)vt([Rt],new hh(Rt.x,Rt.y,0,0,void 0),P)}let oy=255,xd=oy*Tc;function xO(c,i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V,j){let Z=function(X,J,te,fe,de,he,Ce,me){let Me=[];if(J.positionedLines.length===0)return Me;let Oe=fe.layout.get("text-rotate").evaluate(he,{})*Math.PI/180,Pe=function(it){let vt=it[0],rt=it[1],Rt=vt*rt;return Rt>0?[vt,-rt]:Rt<0?[-vt,rt]:vt===0?[rt,vt]:[rt,-vt]}(te),ke=Math.abs(J.top-J.bottom);for(let it of J.positionedLines)ke-=it.lineOffset;let Ne=J.positionedLines.length,Be=ke/Ne,Le=J.top-te[1];for(let it=0;it<Ne;++it){let vt=J.positionedLines[it];Le=CU(J,Be,Le,it);for(let rt of vt.positionedGlyphs){if(!rt.rect)continue;let Rt=rt.rect||{},Pt=QD+1,zt=!0,ct=1,tn=0;if(rt.imageName){let Yr=Ce[so.build(rt.imageName).getSerializedPrimary()];if(!Yr)continue;if(Yr.sdf){Wn("SDF images are not supported in formatted text and will be ignored.");continue}zt=!1,ct=Yr.pixelRatio,Pt=iy/ct}let kt=(de||me)&&rt.vertical,Jt=rt.metrics.advance*rt.scale/2,mn=rt.metrics,zn=rt.rect;if(zn===null)continue;me&&J.verticalizable&&(tn=rt.imageName?Jt-rt.metrics.width*rt.scale/2:0);let Vn=de?[rt.x+Jt,rt.y]:[0,0],Jn=[0,0],jn=[0,0],ni=!1;de||(kt?(jn=[rt.x+Jt+Pe[0],rt.y+Pe[1]-tn],ni=!0):Jn=[rt.x+Jt+te[0],rt.y+te[1]-tn]);let Ki=zn.w*rt.scale/(ct*(rt.localGlyph?Ec:1)),Vi=zn.h*rt.scale/(ct*(rt.localGlyph?Ec:1)),Pn,ji,Li,Ji;if(kt){let Yr=rt.y-Le,Js=new We(-Jt,Jt-Yr),vr=-Math.PI/2,Cr=new We(...jn);Pn=new We(-Jt+Jn[0],Jn[1]),Pn._rotateAround(vr,Js)._add(Cr),Pn.x+=-Yr+Jt,Pn.y-=(mn.left-Pt)*rt.scale;let Ps=rt.imageName?mn.advance*rt.scale:ns*rt.scale,fo=String.fromCodePoint(rt.glyph);dU(fo)?Pn.x+=(1-Pt)*rt.scale:fU(fo)?Pn.x+=Ps-mn.height*rt.scale+(-Pt-1)*rt.scale:Pn.x+=rt.imageName||mn.width+2*Pt===zn.w&&mn.height+2*Pt===zn.h?(Ps-Vi)/2:(Ps-(mn.height+2*Pt)*rt.scale)/2,ji=new We(Pn.x,Pn.y-Ki),Li=new We(Pn.x+Vi,Pn.y),Ji=new We(Pn.x+Vi,Pn.y-Ki)}else{let Yr=(mn.left-Pt)*rt.scale-Jt+Jn[0],Js=(-mn.top-Pt)*rt.scale+Jn[1],vr=Yr+Ki,Cr=Js+Vi;Pn=new We(Yr,Js),ji=new We(vr,Js),Li=new We(Yr,Cr),Ji=new We(vr,Cr)}if(Oe){let Yr;Yr=de?new We(0,0):ni?new We(Pe[0],Pe[1]):new We(te[0],te[1]),Pn._rotateAround(Oe,Yr),ji._rotateAround(Oe,Yr),Li._rotateAround(Oe,Yr),Ji._rotateAround(Oe,Yr)}let uo=new We(0,0),ho=new We(0,0);Me.push({tl:Pn,tr:ji,bl:Li,br:Ji,texPrimary:Rt,texSecondary:void 0,writingMode:J.writingMode,glyphOffset:Vn,sectionIndex:rt.sectionIndex,isSDF:zt,pixelOffsetTL:uo,pixelOffsetBR:ho,minFontScaleX:0,minFontScaleY:0})}}return Me}(0,u,T,d,g,b,m,c.allowVerticalPlacement),W=c.textSizeData,G=null;W.kind==="source"?(G=[Tc*d.layout.get("text-size").evaluate(b,{},V)*I.textScaleFactor],G[0]>xd&&Wn(`${c.layerIds[0]}: Value for "text-size" is >= ${oy}. Reduce your "text-size".`)):W.kind==="composite"&&(G=[Tc*I.compositeTextSizes[0].evaluate(b,{},V)*I.textScaleFactor,Tc*I.compositeTextSizes[1].evaluate(b,{},V)*I.textScaleFactor],(G[0]>xd||G[1]>xd)&&Wn(`${c.layerIds[0]}: Value for "text-size" is >= ${oy}. Reduce your "text-size".`)),c.addSymbols(c.text,Z,G,T,g,b,x,i,a,O.lineStartIndex,O.lineLength,M,R,V,j,!1);for(let X of E)P[X]=c.text.placedSymbolArray.length-1;return 4*Z.length}function bO(c){for(let i in c)return c[i];return null}function mx(c,i,a,u,m,d,g,b,T,O,x=1){let E=g.top/x,P=g.bottom/x,M=g.left/x,I=g.right/x,R=g.collisionPadding;if(R&&(M-=R[0],E-=R[1],I+=R[2],P+=R[3]),T){let V=new We(M,E),j=new We(I,E),Z=new We(M,P),W=new We(I,P),G=Cn(T),X=new We(0,0);O&&(X=new We(O[0],O[1])),V._rotateAround(G,X),j._rotateAround(G,X),Z._rotateAround(G,X),W._rotateAround(G,X),M=Math.min(V.x,j.x,Z.x,W.x),I=Math.max(V.x,j.x,Z.x,W.x),E=Math.min(V.y,j.y,Z.y,W.y),P=Math.max(V.y,j.y,Z.y,W.y)}return c.emplaceBack(i.x,i.y,i.z,a.x,a.y,M,E,I,P,b,u,m,d),c.length-1}function vM(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);let i=c.bottom-c.top;return i>0?Math.max(10,i):null}function IU(c,i,a,u){let m=c.compareText;if(i in m){let d=m[i];for(let g=d.length-1;g>=0;g--)if(u.dist(d[g])<a)return!0}else m[i]=[];return m[i].push(u),!1}function wO(c,i){let a=c.fovAboveCenter,u=c.elevation?c.elevation.getMinElevationBelowMSL()*i:0,m=(c._camera.position[2]*c.worldSize-u)/Math.cos(c._pitch),d=Math.sin(a)*m/Math.sin(Math.max(Math.PI/2-c._pitch-a,.01)),g=Math.sin(c._pitch)*d+m,b=m*(1/c._horizonShift);return c.elevation&&c.elevation.exaggeration()!==0||(g*=1+Math.max(c.zoom-17,0)),Math.min(1.01*g,b)}function sy(c,i){if(!i.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:i};let a=Math.pow(2,-c.z),u=c.x*a,m=(c.x+1)*a,d=c.y*a,g=(c.y+1)*a,b=Xs(u),T=Xs(m),O=Bo(d),x=Bo(g),E=i.project(b,O),P=i.project(T,O),M=i.project(T,x),I=i.project(b,x),R=Math.min(E.x,P.x,M.x,I.x),V=Math.min(E.y,P.y,M.y,I.y),j=Math.max(E.x,P.x,M.x,I.x),Z=Math.max(E.y,P.y,M.y,I.y),W=a/16;function G(J,te,fe,de,he,Ce){let me=(fe+he)/2,Me=(de+Ce)/2,Oe=i.project(Xs(me),Bo(Me)),Pe=Math.max(0,R-Oe.x,V-Oe.y,Oe.x-j,Oe.y-Z);R=Math.min(R,Oe.x),j=Math.max(j,Oe.x),V=Math.min(V,Oe.y),Z=Math.max(Z,Oe.y),Pe>W&&(G(J,Oe,fe,de,me,Me),G(Oe,te,me,Me,he,Ce))}G(E,P,u,d,m,d),G(P,M,m,d,m,g),G(M,I,m,g,u,g),G(I,E,u,g,u,d),R-=W,V-=W,j+=W,Z+=W;let X=1/Math.max(j-R,Z-V);return{scale:X,x:R*X,y:V*X,x2:j*X,y2:Z*X,projection:i}}function CO(c,{x:i,y:a},u=0){return new We(((i-u)*c.scale-c.x)*Ot,(a*c.scale-c.y)*Ot)}let PU=Ee.mat4.identity(new Float32Array(16));class bd{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new bi(0,0)}projectTilePoint(i,a,u){return{x:i,y:a,z:0}}locationPoint(i,a,u=!0){return i._coordinatePoint(i.locationCoordinate(a),u)}pixelsPerMeter(i,a){return ms(1,i)*a}pixelSpaceConversion(i,a,u){return 1}farthestPixelDistance(i){return wO(i,i.pixelsPerMeter)}pointCoordinate(i,a,u,m){let d=i.horizonLineFromTop(!1),g=new We(a,Math.max(d,u));return i.rayIntersectionCoordinate(i.pointRayIntersection(g,m))}pointCoordinate3D(i,a,u){let m=new We(a,u);if(i.elevation)return i.elevation.pointCoordinate(m);{let d=this.pointCoordinate(i,m.x,m.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(i,a){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,a.x,a.y);let u=i.horizonLineFromTop();return a.y<u}createInversionMatrix(i,a){return PU}createTileMatrix(i,a,u){let m,d,g,b=u.canonical,T=Ee.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let O=sy(b,this);m=1,d=O.x+u.wrap*O.scale,g=O.y,Ee.mat4.scale(T,T,[m/O.scale,m/O.scale,i.pixelsPerMeter/a])}else m=a/i.zoomScale(b.z),d=(b.x+Math.pow(2,b.z)*u.wrap)*m,g=b.y*m;return Ee.mat4.translate(T,T,[d,g,0]),Ee.mat4.scale(T,T,[m/Ot,m/Ot,1]),T}upVector(i,a,u){return[0,0,1]}upVectorScale(i,a,u){return{metersToTile:1}}}class DU extends bd{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];let[a,u]=this.parallels=i.parallels||[29.5,45.5],m=Math.sin(Cn(a));this.n=(m+Math.sin(Cn(u)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(i,a){let{n:u,c:m,r0:d}=this,g=Cn(i-this.center[0]),b=Cn(a),T=Math.sqrt(m-2*u*Math.sin(b))/u;return{x:T*Math.sin(g*u),y:T*Math.cos(g*u)-d,z:0}}unproject(i,a){let{n:u,c:m,r0:d}=this,g=d+a,b=Math.atan2(i,Math.abs(g))*Math.sign(g);g*u<0&&(b-=Math.PI*Math.sign(i)*Math.sign(g));let T=Cn(this.center[0])*u;b=oa(b,-Math.PI-T,Math.PI-T);let O=Rn(Er(b/u)+this.center[0],-180,180),x=Math.asin(Rn((m-(i*i+g*g)*u*u)/(2*u),-1,1)),E=Rn(Er(x),-Wr,Wr);return new bi(O,E)}}let ay=1.340264,ly=-.081106,cy=893e-6,uy=.003796,gx=Math.sqrt(3)/2;class OU extends bd{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;let u=Math.asin(gx*Math.sin(a)),m=u*u,d=m*m*m;return{x:.5*(i*Math.cos(u)/(gx*(ay+3*ly*m+d*(7*cy+9*uy*m)))/Math.PI+.5),y:1-.5*(u*(ay+ly*m+d*(cy+uy*m))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,m=u*u,d=m*m*m;for(let x,E,P,M=0;M<12&&(E=u*(ay+ly*m+d*(cy+uy*m))-a,P=ay+3*ly*m+d*(7*cy+9*uy*m),x=E/P,u=Rn(u-x,-Math.PI/3,Math.PI/3),m=u*u,d=m*m*m,!(Math.abs(x)<1e-12));++M);let g=gx*i*(ay+3*ly*m+d*(7*cy+9*uy*m))/Math.cos(u),b=Math.asin(Math.sin(u)/gx),T=Rn(180*g/Math.PI,-180,180),O=Rn(180*b/Math.PI,-Wr,Wr);return new bi(T,O)}}class AU extends bd{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){let u=360*(i-.5),m=Rn(360*(.5-a),-Wr,Wr);return new bi(u,m)}}let Bm=Math.PI/2;function _x(c){return Math.tan((Bm+c)/2)}class RU extends bd{constructor(i){super(i),this.center=i.center||[0,30];let[a,u]=this.parallels=i.parallels||[30,30],m=Cn(a),d=Cn(u);this.southernCenter=m+d<0,this.southernCenter&&(m=-m,d=-d);let g=Math.cos(m),b=_x(m);this.n=m===d?Math.sin(m):Math.log(g/Math.cos(d))/Math.log(_x(d)/b),this.f=g*Math.pow(_x(m),this.n)/this.n}project(i,a){a=Cn(a),this.southernCenter&&(a=-a),i=Cn(i-this.center[0]);let u=1e-6,{n:m,f:d}=this;d>0?a<-Bm+u&&(a=-Bm+u):a>Bm-u&&(a=Bm-u);let g=d/Math.pow(_x(a),m),b=g*Math.sin(m*i),T=d-g*Math.cos(m*i);return b=.5*(b/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:b,y:this.southernCenter?T:1-T,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;let{n:u,f:m}=this,d=m-a,g=Math.sign(d),b=Math.sign(u)*Math.sqrt(i*i+d*d),T=Math.atan2(i,Math.abs(d))*g;d*u<0&&(T-=Math.PI*Math.sign(i)*g);let O=Rn(Er(T/u)+this.center[0],-180,180),x=Rn(Er(2*Math.atan(Math.pow(m/b,1/u))-Bm),-Wr,Wr);return new bi(O,this.southernCenter?-x:x)}}class MO extends bd{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:mu(i),y:wc(a),z:0}}unproject(i,a){let u=Xs(i),m=Bo(a);return new bi(u,m)}}let TO=Cn(Wr);class kU extends bd{project(i,a){let u=(a=Cn(a))*a,m=u*u;return{x:.5*((i=Cn(i))*(.8707-.131979*u+m*(m*(.003971*u-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+m*(.028874*u-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,m=25,d=0,g=u*u;do{g=u*u;let O=g*g;d=(u*(1.007226+g*(.015085+O*(.028874*g-.044475-.005916*O)))-a)/(1.007226+g*(.045255+O*(.259866*g-.311325-.005916*11*O))),u=Rn(u-d,-TO,TO)}while(Math.abs(d)>1e-6&&--m>0);g=u*u;let b=Rn(Er(i/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),T=Er(u);return new bi(b,T)}}let EO=Cn(Wr);class LU extends bd{project(i,a){a=Cn(a),i=Cn(i);let u=Math.cos(a),m=2/Math.PI,d=Math.acos(u*Math.cos(i/2)),g=Math.sin(d)/d,b=.5*(i*m+2*u*Math.sin(i/2)/g)||0,T=.5*(a+Math.sin(a)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(i,a){let u=i=(2*i-.5)*Math.PI,m=a=(2*(1-a)-1)*Math.PI,d=25,g=1e-6,b=0,T=0;do{let O=Math.cos(m),x=Math.sin(m),E=2*x*O,P=x*x,M=O*O,I=Math.cos(u/2),R=Math.sin(u/2),V=2*I*R,j=R*R,Z=1-M*I*I,W=Z?1/Z:0,G=Z?Math.acos(O*I)*Math.sqrt(1/Z):0,X=.5*(2*G*O*R+2*u/Math.PI)-i,J=.5*(G*x+m)-a,te=.5*W*(M*j+G*O*I*P)+1/Math.PI,fe=W*(V*E/4-G*x*R),de=.125*W*(E*R-G*x*M*V),he=.5*W*(P*I+G*j*O)+.5,Ce=fe*de-he*te;b=(J*fe-X*he)/Ce,T=(X*de-J*te)/Ce,u=Rn(u-b,-Math.PI,Math.PI),m=Rn(m-T,-EO,EO)}while((Math.abs(b)>g||Math.abs(T)>g)&&--d>0);return new bi(Er(u),Er(m))}}class SO extends bd{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Cn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){let{scale:u,cosPhi:m}=this;return{x:Cn(i)*m*u+.5,y:-Math.sin(Cn(a))/m*u+.5,z:0}}unproject(i,a){let{scale:u,cosPhi:m}=this,d=-(a-.5)/u,g=Rn(Er((i-.5)/u)/m,-180,180),b=Math.asin(Rn(d*m,-1,1)),T=Rn(Er(b),-Wr,Wr);return new bi(g,T)}}class FU extends MO{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,a,u){let m=kr(i,a,u),d=Zo(To(u));return Ee.vec3.transformMat4(m,m,d),{x:m[0],y:m[1],z:m[2]}}locationPoint(i,a){let u=ch(a.lat,a.lng),m=Ee.vec3.normalize([],u),d=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude,g=ms(1,0)*Ot*d;Ee.vec3.scaleAndAdd(u,u,m,g);let b=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.multiply(b,i.pixelMatrix,i.globeMatrix),Ee.vec3.transformMat4(u,u,b),new We(u[0],u[1])}pixelsPerMeter(i,a){return ms(1,0)*a}pixelSpaceConversion(i,a,u){let m=ms(1,i)*a,d=gn(ms(1,45)*a,m,u);return this.pixelsPerMeter(i,a)/d}createTileMatrix(i,a,u){let m=da(To(u.canonical));return Ee.mat4.multiply(new Float64Array(16),i.globeMatrix,m)}createInversionMatrix(i,a){let{center:u}=i,m=Zo(To(a));return Ee.mat4.rotateY(m,m,Cn(u.lng)),Ee.mat4.rotateX(m,m,Cn(u.lat)),Ee.mat4.scale(m,m,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(i,a,u,m){return ko(i,a,u,!0)||new y(0,0)}pointCoordinate3D(i,a,u){let m=this.pointCoordinate(i,a,u,0);return[m.x,m.y,m.z]}isPointAboveHorizon(i,a){return!ko(i,a.x,a.y,!1)}farthestPixelDistance(i){let a=function(m,d){let g=m.cameraToCenterDistance,b=m._centerAltitude*d,T=m._camera,O=m._camera.forward(),x=Ee.vec3.add([],Ee.vec3.scale([],O,-g),[0,0,b]),E=m.worldSize/(2*Math.PI),P=[0,0,-E],M=m.width/m.height,I=Math.tan(m.fovAboveCenter),R=Ee.vec3.scale([],T.up(),I),V=Ee.vec3.scale([],T.right(),I*M),j=Ee.vec3.normalize([],Ee.vec3.add([],Ee.vec3.add([],O,R),V)),Z=[],W;if(new Gn(x,j).closestPointOnSphere(P,E,Z)){let G=Ee.vec3.add([],Z,P),X=Ee.vec3.sub([],G,x);W=Math.cos(m.fovAboveCenter)*Ee.vec3.length(X)}else{let G=Ee.vec3.sub([],x,P),X=Ee.vec3.sub([],P,x);Ee.vec3.normalize(X,X);let J=Ee.vec3.length(G)-E;W=Math.sqrt(J*(J+2*E));let te=Math.acos(W/(E+J))-Math.acos(Ee.vec3.dot(O,X));W*=Math.cos(te)}return 1.01*W}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),u=ts(i.zoom);if(u>0){let m=wO(i,ms(1,i.center.lat)*i.worldSize),d=i.worldSize/(2*Math.PI),g=Math.max(i.width,i.height)/i.worldSize*Math.PI;return gn(a,m+d*(1-Math.cos(g)),Math.pow(u,10))}return a}upVector(i,a,u){return kr(a,u,i,1)}upVectorScale(i){return{metersToTile:Ei(Eo(To(i)))}}}function IO(c){let i=c.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(c.name){case"mercator":return new MO(c);case"equirectangular":return new AU(c);case"naturalEarth":return new kU(c);case"equalEarth":return new OU(c);case"winkelTripel":return new LU(c);case"albers":return a?new SO(c):new DU(c);case"lambertConformalConic":return a?new SO(c):new RU(c);case"globe":return new FU(c)}throw new Error(`Invalid projection name: ${c.name}`)}let NU=km.VectorTileFeature.types,zU=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yx(c,i,a,u,m,d,g,b,T,O,x,E,P){let M=b?Math.min(xd,Math.round(b[0])):0,I=b?Math.min(xd,Math.round(b[1])):0;c.emplaceBack(i,a,Math.round(32*u),Math.round(32*m),d,g,(M<<1)+(T?1:0),I,16*O,16*x,256*E,256*P)}function vx(c,i,a){c.emplaceBack(i,a)}function xx(c,i,a,u,m,d,g){c.emplaceBack(i,a,u,m,d,g)}function bx(c,i,a,u,m){c.emplaceBack(i,a,u,m),c.emplaceBack(i,a,u,m),c.emplaceBack(i,a,u,m),c.emplaceBack(i,a,u,m)}function BU(c){for(let i of c.sections)if(RC(i.text))return!0;return!1}class xM{constructor(i){this.layoutVertexArray=new M_,this.indexArray=new qo,this.programConfigurations=i,this.segments=new Rr,this.dynamicLayoutVertexArray=new vc,this.opacityVertexArray=new E_,this.placedSymbolArray=new Uv,this.iconTransitioningVertexArray=new uu,this.globeExtVertexArray=new T_,this.zOffsetVertexArray=new za}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(i,a,u,m,d){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,nU.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,rU.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,zU,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,sU.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,iU.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,oU.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Xt(xM,"SymbolBuffers");class bM{constructor(i,a,u){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new u,this.segments=new Rr,this.collisionVertexArray=new P_,this.collisionVertexArrayExt=new vc}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,aU.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,lU.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xt(bM,"CollisionBuffers");class wx{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.lut=i.lut,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ee.mat4.identity([]),this.placementViewportMatrix=Ee.mat4.identity([]);let a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cM(this.zoom,a["text-size"]),this.iconSizeData=cM(this.zoom,a["icon-size"]);let u=this.layers[0].layout,m=u.get("symbol-sort-key"),d=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>pl[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new xM(new fu(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new xM(new fu(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new jf,this.lineVertexArray=new Ys,this.symbolInstances=new Vf}calculateGlyphDependencies(i,a,u,m,d){for(let g of i){let b=g.codePointAt(0);if(b===void 0)break;if(a[b]=!0,m&&d&&b<=65535){let T=ty[g];T&&(a[T.charCodeAt(0)]=!0)}}}updateFootprints(i,a){}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;let u=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!nM(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(i,a,u,m){let d=this.layers[0],g=d.layout,b=this.projection.name==="globe",T=g.get("text-font"),O=g.get("text-field"),x=g.get("icon-image"),[E,P]=g.get("icon-size-scale-range"),M=Rn(a.scaleFactor||1,E,P),I=(O.value.kind!=="constant"||O.value.value instanceof Sr&&!O.value.value.isEmpty()||O.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),R=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,V=g.get("symbol-sort-key");if(this.features=[],!I&&!R)return;let j=a.iconDependencies,Z=a.glyphDependencies,W=a.availableImages,G=new _r(this.zoom);for(let{feature:X,id:J,index:te,sourceLayerIndex:fe}of i){let de=d._featureFilter.needGeometry,he=q(X,de);if(!d._featureFilter.filter(G,he,u))continue;if(de||(he.geometry=U(X,u,m)),b&&X.type!==1&&u.z<=5){let Pe=he.geometry,ke=.98078528056,Ne=(Be,Le)=>{let it=kr(Be.x,Be.y,u,1),vt=kr(Le.x,Le.y,u,1);return Ee.vec3.dot(it,vt)<ke};for(let Be=0;Be<Pe.length;Be++)Pe[Be]=k(Pe[Be],Ne)}let Ce,me;if(I){let Pe=d.getValueAndResolveTokens("text-field",he,u,W),ke=Sr.factory(Pe);BU(ke)&&(this.hasRTLText=!0),(!this.hasRTLText||x_()==="unavailable"||this.hasRTLText&&Ws.isParsed())&&(Ce=hU(ke,d,he))}if(R){let Pe=d.getValueAndResolveTokens("icon-image",he,u,W);me=Pe instanceof so?Pe:so.build(Pe)}if(!Ce&&!me)continue;let Me=this.sortFeaturesByKey?V.evaluate(he,{},u):void 0,Oe={id:J,text:Ce,icon:me,index:te,sourceLayerIndex:fe,geometry:he.geometry,properties:X.properties,type:NU[X.type],sortKey:Me};if(this.features.push(Oe),me){let Pe=lx(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],u,this.zoom,Oe)*M*this.pixelRatio,ke=me.getPrimary().scaleSelf(Pe);if(j[ke.id]=j[ke.id]||[],j[ke.id].push(ke),me.nameSecondary){let Ne=me.getSecondary().scaleSelf(Pe);j[Ne.id]=j[Ne.id]||[],j[Ne.id].push(Ne)}}if(Ce){let Pe=T.evaluate(he,{},u).join(","),ke=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(pl.vertical)>=0;for(let Ne of Ce.sections)if(Ne.image){let Be=Ne.image.getPrimary().scaleSelf(this.pixelRatio);j[Be.id]=j[Be.id]||[],j[Be.id].push(Be)}else{let Be=lm(Ce.toString()),Le=Ne.fontStack||Pe,it=Z[Le]=Z[Le]||{};this.calculateGlyphDependencies(Ne.text,it,ke,this.allowVerticalPlacement,Be)}}}g.get("symbol-placement")==="line"&&(this.features=function(X){let J={},te={},fe=[],de=0;function he(Oe){fe.push(X[Oe]),de++}function Ce(Oe,Pe,ke){let Ne=te[Oe];return delete te[Oe],te[Pe]=Ne,fe[Ne].geometry[0].pop(),fe[Ne].geometry[0]=fe[Ne].geometry[0].concat(ke[0]),Ne}function me(Oe,Pe,ke){let Ne=J[Pe];return delete J[Pe],J[Oe]=Ne,fe[Ne].geometry[0].shift(),fe[Ne].geometry[0]=ke[0].concat(fe[Ne].geometry[0]),Ne}function Me(Oe,Pe,ke){let Ne=ke?Pe[0][Pe[0].length-1]:Pe[0][0];return`${Oe}:${Ne.x}:${Ne.y}`}for(let Oe=0;Oe<X.length;Oe++){let Pe=X[Oe],ke=Pe.geometry,Ne=Pe.text?Pe.text.toString():null;if(!Ne){he(Oe);continue}let Be=Me(Ne,ke),Le=Me(Ne,ke,!0);if(Be in te&&Le in J&&te[Be]!==J[Le]){let it=me(Be,Le,ke),vt=Ce(Be,Le,fe[it].geometry);delete J[Be],delete te[Le],te[Me(Ne,fe[vt].geometry,!0)]=vt,fe[it].geometry=null}else Be in te?Ce(Be,Le,ke):Le in J?me(Be,Le,ke):(he(Oe),J[Be]=de-1,te[Le]=de-1)}return fe.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,J)=>X.sortKey-J.sortKey)}update(i,a,u,m,d,g,b){this.text.programConfigurations.updatePaintArrays(i,a,d,u,m,g,b),this.icon.programConfigurations.updatePaintArrays(i,a,d,u,m,g,b)}updateZOffset(){let i=(d,g,b)=>{u+=g,u>d.length&&d.resize(u);for(let T=-g;T<0;T++)d.emplace(T+u,b)},a=(d,g,b)=>{m+=g,m>d.length&&d.resize(m);for(let T=-g;T<0;T++)d.emplace(T+m,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,m=0;for(let d=0;d<this.symbolInstances.length;d++){let g=this.symbolInstances.get(d),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:T,numIconVertices:O}=g,x=g.zOffset,E=O>0;if((b>0||T>0)&&(i(this.text.zOffsetVertexArray,b,x),i(this.text.zOffsetVertexArray,T,x)),E){let{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:M}=g;P>=0&&a(this.icon.zOffsetVertexArray,O,x),M>=0&&a(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=IO(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){let u=this.lineVertexArray.length;if(i.segment!==void 0)for(let{x:m,y:d}of a)this.lineVertexArray.emplaceBack(m,d);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(i,a,u,m,d,g,b,T,O,x,E,P,M,I,R,V){let j=i.indexArray,Z=i.layoutVertexArray,W=i.globeExtVertexArray,G=i.segments.prepareSegment(4*a.length,Z,j,this.canOverlap?g.sortKey:void 0),X=this.glyphOffsetArray.length,J=G.vertexLength,te=this.allowVerticalPlacement&&b===pl.vertical?Math.PI/2:0,fe=g.text&&g.text.sections;for(let he=0;he<a.length;he++){let{tl:Ce,tr:me,bl:Me,br:Oe,texPrimary:Pe,texSecondary:ke,pixelOffsetTL:Ne,pixelOffsetBR:Be,minFontScaleX:Le,minFontScaleY:it,glyphOffset:vt,isSDF:rt,sectionIndex:Rt}=a[he],Pt=G.vertexLength,zt=vt[1];if(yx(Z,O.x,O.y,Ce.x,zt+Ce.y,Pe.x,Pe.y,u,rt,Ne.x,Ne.y,Le,it),yx(Z,O.x,O.y,me.x,zt+me.y,Pe.x+Pe.w,Pe.y,u,rt,Be.x,Ne.y,Le,it),yx(Z,O.x,O.y,Me.x,zt+Me.y,Pe.x,Pe.y+Pe.h,u,rt,Ne.x,Be.y,Le,it),yx(Z,O.x,O.y,Oe.x,zt+Oe.y,Pe.x+Pe.w,Pe.y+Pe.h,u,rt,Be.x,Be.y,Le,it),T){let{x:ct,y:tn,z:kt}=T.anchor,[Jt,mn,zn]=T.up;xx(W,ct,tn,kt,Jt,mn,zn),xx(W,ct,tn,kt,Jt,mn,zn),xx(W,ct,tn,kt,Jt,mn,zn),xx(W,ct,tn,kt,Jt,mn,zn),bx(i.dynamicLayoutVertexArray,ct,tn,kt,te)}else bx(i.dynamicLayoutVertexArray,O.x,O.y,O.z,te);if(V){let ct=ke||Pe;vx(i.iconTransitioningVertexArray,ct.x,ct.y),vx(i.iconTransitioningVertexArray,ct.x+ct.w,ct.y),vx(i.iconTransitioningVertexArray,ct.x,ct.y+ct.h),vx(i.iconTransitioningVertexArray,ct.x+ct.w,ct.y+ct.h)}j.emplaceBack(Pt,Pt+1,Pt+2),j.emplaceBack(Pt+1,Pt+2,Pt+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(vt[0]),he!==a.length-1&&Rt===a[he+1].sectionIndex||i.programConfigurations.populatePaintArrays(Z.length,g,g.index,{},M,I,R,fe&&fe[Rt])}let de=T?T.anchor:O;i.placedSymbolArray.emplaceBack(de.x,de.y,de.z,O.x,O.y,X,this.glyphOffsetArray.length-X,J,x,E,O.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],b,0,!1,0,P,0)}_commitLayoutVertex(i,a,u,m,d,g,b){i.emplaceBack(a,u,m,d,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(i,a,u,m,d,g,b){let T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),O=T.vertexLength,x=b.tileAnchorX,E=b.tileAnchorY;for(let M=0;M<4;M++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,a,i.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,m,d,g,x,E,new We(i.x1,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,d,g,x,E,new We(i.x2,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,d,g,x,E,new We(i.x2,i.y2)),this._commitLayoutVertex(u.layoutVertexArray,m,d,g,x,E,new We(i.x1,i.y2)),T.vertexLength+=4;let P=u.indexArray;P.emplaceBack(O,O+1),P.emplaceBack(O+1,O+2),P.emplaceBack(O+2,O+3),P.emplaceBack(O+3,O),T.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,u,m,d,g){for(let b=m;b<d;b++){let T=u.get(b),O=this.getSymbolInstanceTextSize(i,g,a,b);this._addCollisionDebugVertices(T,O,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(i,a,u,m,d,g){for(let b=m;b<d;b++){let T=u.get(b),O=this.getSymbolInstanceIconSize(i,a,g.placedIconSymbolIndex);this._addCollisionDebugVertices(T,O,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,g)}}generateCollisionDebugBuffers(i,a,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bM(Bf,YD.members,uu),this.iconCollisionBox=new bM(Bf,YD.members,uu);let m=Lm(this.iconSizeData,i),d=Lm(this.textSizeData,i,u);for(let g=0;g<this.symbolInstances.length;g++){let b=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(d,i,a,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(d,i,a,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(m,i,a,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(m,i,a,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(i,a,u,m){let d=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:m),g=cx(this.textSizeData,i,d)/ns;return this.tilePixelRatio*g}getSymbolInstanceIconSize(i,a,u){let m=this.icon.placedSymbolArray.get(u),d=cx(this.iconSizeData,i,m);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(i,a,u,m){i.emplaceBack(a,-u,-u,m),i.emplaceBack(a,u,-u,m),i.emplaceBack(a,u,u,m),i.emplaceBack(a,-u,u,m)}_updateTextDebugCollisionBoxes(i,a,u,m,d,g,b){for(let T=m;T<d;T++){let O=u.get(T),x=this.getSymbolInstanceTextSize(i,g,a,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,O.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(i,a,u,m,d,g,b){for(let T=m;T<d;T++){let O=u.get(T),x=this.getSymbolInstanceIconSize(i,a,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,O.padding,g.zOffset)}}updateCollisionDebugBuffers(i,a,u,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let d=Lm(this.iconSizeData,i,m),g=Lm(this.textSizeData,i,u);for(let b=0;b<this.symbolInstances.length;b++){let T=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(g,i,a,T.textBoxStartIndex,T.textBoxEndIndex,T,u),this._updateTextDebugCollisionBoxes(g,i,a,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,u),this._updateIconDebugCollisionBoxes(d,i,a,T.iconBoxStartIndex,T.iconBoxEndIndex,T,m),this._updateIconDebugCollisionBoxes(d,i,a,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,u,m,d,g,b,T,O){let x={};if(a<u){let{x1:E,y1:P,x2:M,y2:I,padding:R,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G,featureIndex:X}=i.get(a);x.textBox={x1:E,y1:P,x2:M,y2:I,padding:R,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G},x.textFeatureIndex=X}if(m<d){let{x1:E,y1:P,x2:M,y2:I,padding:R,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G,featureIndex:X}=i.get(m);x.verticalTextBox={x1:E,y1:P,x2:M,y2:I,padding:R,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G},x.verticalTextFeatureIndex=X}if(g<b){let{x1:E,y1:P,x2:M,y2:I,padding:R,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G,featureIndex:X}=i.get(g);x.iconBox={x1:E,y1:P,x2:M,y2:I,padding:R,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G},x.iconFeatureIndex=X}if(T<O){let{x1:E,y1:P,x2:M,y2:I,padding:R,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G,featureIndex:X}=i.get(T);x.verticalIconBox={x1:E,y1:P,x2:M,y2:I,padding:R,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G},x.verticalIconFeatureIndex=X}return x}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){let u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,a){let u=i.placedSymbolArray.get(a),m=u.vertexStartIndex+4*u.numGlyphs;for(let d=u.vertexStartIndex;d<m;d+=4)i.indexArray.emplaceBack(d,d+1,d+2),i.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let a=Math.sin(i),u=Math.cos(i),m=[],d=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);let T=this.symbolInstances.get(b);m.push(0|Math.round(a*T.tileAnchorX+u*T.tileAnchorY)),d.push(T.featureIndex)}return g.sort((b,T)=>m[b]-m[T]||d[T]-d[b]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,a){let u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let a of this.symbolInstanceIndexes){let u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);let{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:O}=u;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),d>=0&&d!==m&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&g!==m&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),O>=0&&this.addIndicesForPlacedSymbol(this.icon,O)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let PO,DO,wM;Xt(wx,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),wx.addDynamicAttributes=bx;class OO{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:ac,this.defaultValue=i}evaluate(i){if(i.formattedSection){let a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xt(OO,"FormatSectionOverride",{omit:["defaultValue"]});let CM=()=>wM||(wM={layout:PO||(PO=new Ar({"symbol-placement":new Et(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Et(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Et(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Et(qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Et(qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Et(qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Et(qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Et(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Et(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Et(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(qe.layout_symbol["icon-size"]),"icon-size-scale-range":new Et(qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Gt(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(qe.layout_symbol["icon-image"]),"icon-rotate":new Gt(qe.layout_symbol["icon-rotate"]),"icon-padding":new Et(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Et(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(qe.layout_symbol["icon-offset"]),"icon-anchor":new Gt(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Et(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Et(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Et(qe.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(qe.layout_symbol["text-field"]),"text-font":new Gt(qe.layout_symbol["text-font"]),"text-size":new Gt(qe.layout_symbol["text-size"]),"text-size-scale-range":new Et(qe.layout_symbol["text-size-scale-range"]),"text-max-width":new Gt(qe.layout_symbol["text-max-width"]),"text-line-height":new Gt(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(qe.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(qe.layout_symbol["text-justify"]),"text-radial-offset":new Gt(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Et(qe.layout_symbol["text-variable-anchor"]),"text-anchor":new Gt(qe.layout_symbol["text-anchor"]),"text-max-angle":new Et(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Et(qe.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(qe.layout_symbol["text-rotate"]),"text-padding":new Et(qe.layout_symbol["text-padding"]),"text-keep-upright":new Et(qe.layout_symbol["text-keep-upright"]),"text-transform":new Gt(qe.layout_symbol["text-transform"]),"text-offset":new Gt(qe.layout_symbol["text-offset"]),"text-allow-overlap":new Et(qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Et(qe.layout_symbol["text-ignore-placement"]),"text-optional":new Et(qe.layout_symbol["text-optional"]),visibility:new Et(qe.layout_symbol.visibility)})),paint:DO||(DO=new Ar({"icon-opacity":new Gt(qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Gt(qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Gt(qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Gt(qe.paint_symbol["text-emissive-strength"]),"icon-color":new Gt(qe.paint_symbol["icon-color"]),"icon-halo-color":new Gt(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Et(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Et(qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Gt(qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Gt(qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Gt(qe.paint_symbol["text-occlusion-opacity"]),"text-color":new Gt(qe.paint_symbol["text-color"],{runtimeType:yo,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Gt(qe.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(qe.paint_symbol["text-halo-blur"]),"text-translate":new Et(qe.paint_symbol["text-translate"]),"text-translate-anchor":new Et(qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Et(qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Et(qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Et(qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Et(qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Gt(qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},wM);class Cx extends Ss{constructor(i,a,u,m){super(i,CM(),a,u,m),this._colorAdjustmentMatrix=Ee.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}recalculate(i,a){super.recalculate(i,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let u=this.layout.get("text-writing-mode");if(u){let m=[];for(let d of u)m.indexOf(d)<0&&m.push(d);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,a,u,m){return this._saturation===i&&this._contrast===a&&this._brightnessMin===u&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(d,g,b,T){d=ce(d),g=oe(g);let O=Ee.mat4.create(),x=d/3,E=1-2*x,P=[E,x,x,0,x,E,x,0,x,x,E,0,0,0,0,1],M=.5-.5*g,I=T-b;return Ee.mat4.multiply(O,[I,0,0,0,0,I,0,0,0,0,I,0,b,b,b,1],[g,0,0,0,0,g,0,0,0,0,g,0,M,M,M,1]),Ee.mat4.multiply(O,O,P),O}(i,a,u,m),this._saturation=i,this._contrast=a,this._brightnessMin=u,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,a,u,m){let d=this.layout.get(i).evaluate(a,{},u,m),g=this._unevaluatedLayout._values[i];return g.isDataDriven()||g_(g.value)||!d?d:function(b,T){return T.replace(/{([^{}]+)}/g,(O,x)=>x in b?String(b[x]):"")}(a.properties,d)}createBucket(i){return new wx(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let i of CM().paint.overridableProperties){if(!Cx.hasPaintOverride(this.layout,i))continue;let a=this.paint.get(i),u=new OO(a),m=new im(u,a.property.specification,this.scope,this.options),d=null;d=a.value.kind==="constant"||a.value.kind==="source"?new rm("source",m):new nd("composite",m,a.value.zoomStops,a.value._interpolationType),this.paint._values[i]=new od(a.property,d,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&Cx.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){let u=i.get("text-field"),m=CM().paint.properties[a],d=!1,g=b=>{for(let T of b)if(m.overrides&&m.overrides.hasOverride(T))return void(d=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Sr)g(u.value.value.sections);else if(u.value.kind==="source"){let b=O=>{d||(O instanceof js&&dr(O.value)===Jo?g(O.value.sections):O instanceof Ro?g(O.sections):O.eachChild(b))},T=u.value;T._styleExpression&&b(T._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,a,u){return{config:new sh(this,{zoom:a,lut:u}),overrideFog:!1}}}let AO,RO,kO,LO;var MM=Ti([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function TM(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function EM(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class SM{constructor(i,a,u,m){this.context=i,this.format=u,this.useMipmap=m&&m.useMipmap,this.texture=i.gl.createTexture(),this.update(a,{premultiply:m&&m.premultiply})}update(i,a){let u=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,m=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:d}=this,{gl:g}=d,{x:b,y:T}=a&&a.position?a.position:{x:0,y:0},O=Math.max(b+u,this.size?this.size[0]:0),x=Math.max(T+m,this.size?this.size[1]:0);!this.size||this.size[0]===O&&this.size[1]===x||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!a||a.premultiply!==!1));let E=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&O>0&&x>0){let P=this.useMipmap?Math.floor(Math.log2(Math.max(O,x)))+1:1;g.texStorage2D(g.TEXTURE_2D,P,this.format,O,x),this.size=[O,x]}if(this.size)if(E)g.texSubImage2D(g.TEXTURE_2D,0,b,T,TM(this.format),EM(this.format),i);else{let P=i.data;P&&g.texSubImage2D(g.TEXTURE_2D,0,b,T,u,m,TM(this.format),EM(this.format),P)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(i,a,u=!1){let{context:m}=this,{gl:d}=m;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!u?i===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),a!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(i,a,u,m){let{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),a!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,a),this.magFilter=a),i!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?i===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),u!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,u),this.wrapS=u),m!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,m),this.wrapT=m)}destroy(){let{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Mx{constructor(i,a){this.context=i,this.texture=a}bind(i,a){let{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,i),this.minFilter=i),a!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrapS=a)}}function Tx(c,i,a,u,m,d,g,b){let T=[c,i,1,a,u,1,m,d,1],O=[g,b,1],x=Ee.mat3.adjoint([],T),[E,P,M]=Ee.vec3.transformMat3(O,O,x);return Ee.mat3.multiply(T,T,[E,0,0,0,P,0,0,0,M])}function FO(c,i,a,u,m,d,g,b){let T=function(O,x,E,P,M,I,R,V){let j=Tx(0,0,1,0,1,1,0,1),Z=Tx(O,x,E,P,M,I,R,V),W=Ee.mat3.adjoint([],j);return Ee.mat3.multiply(Z,Z,W)}(c,i,a,u,m,d,g,b);return[T[2]/T[8]/Ot,T[5]/T[8]/Ot]}function Ex(c){return[c[0],Math.min(Math.max(c[1],-Wr),Wr)]}class NO extends Ol{constructor(i,a,u,m){super(),this.id=i,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=a,this._dirty=!1}load(i,a){if(this._loaded=a||!1,this.fire(new zs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=jr(this.map._requestManager.transformRequest(this.url,Il.Image),(u,m)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Bs(u)):m&&(this.image=m instanceof HTMLImageElement?Vt.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Mx(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new zs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Mx||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=i[0][1],u=i[0][1];for(let d of i)d[1]>u&&(u=d[1]),d[1]<a&&(a=d[1]);let m=(u+a)/2;if(m>Wr?this.onNorthPole=!0:m<-Wr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let d=i.map(y.fromLngLat);this.tileID=function(g){let b=1/0,T=1/0,O=-1/0,x=-1/0;for(let R of g)b=Math.min(b,R.x),T=Math.min(T,R.y),O=Math.max(O,R.x),x=Math.max(x,R.y);let E=Math.max(O-b,x-T),P=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),M=Math.pow(2,P),I=Math.floor((b+O)/2*M);return I>1&&(I-=1),new Nt(P,I,Math.floor((T+x)/2*M))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new zs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(let j in this.tiles){let Z=this.tiles[j];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let a=sy(new Nt(0,0,0),this.map.transform.projection),u=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){let Z=j[1].x-j[0].x,W=j[1].y-j[0].y,G=j[2].x-j[1].x,X=j[2].y-j[1].y,J=j[3].x-j[2].x,te=j[3].y-j[2].y,fe=j[0].x-j[3].x,de=j[0].y-j[3].y,he=Z*X-G*W,Ce=G*te-J*X,me=J*de-fe*te,Me=fe*W-Z*de;return he>0&&Ce>0&&me>0&&Me>0||he<0&&Ce<0&&me<0&&Me<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let m=sy(this.tileID,this.map.transform.projection),[d,g,b,T]=this.coordinates.map(j=>{let Z=m.projection.project(j[0],j[1]);return CO(m,Z)._round()});this.perspectiveTransform=FO(d.x,d.y,g.x,g.y,b.x,b.y,T.x,T.y);let O=this._boundsArray=new dd;O.emplaceBack(d.x,d.y,0,0),O.emplaceBack(g.x,g.y,Ot,0),O.emplaceBack(T.x,T.y,0,Ot),O.emplaceBack(b.x,b.y,Ot,Ot),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(O,MM.members),this.boundsSegments=Rr.simpleSegment(0,0,4,2);let x=[],E=[Ex((P=this.coordinates)[0]),Ex(P[1]),Ex(P[2]),Ex(P[3])];var P;let[M,I,R,V]=function(j){let Z=j[0][0],W=Z,G=j[0][1],X=G;for(let J=1;J<j.length;J++)j[J][0]<Z?Z=j[J][0]:j[J][0]>W&&(W=j[J][0]),j[J][1]<G?G=j[J][1]:j[J][1]>X&&(X=j[J][1]);return[Z,G,W-Z,X-G]}(E);{let j=new dd,[Z,W,G,X]=function(Ne){let Be=Ne[0].x,Le=Be,it=Ne[0].y,vt=it;for(let rt=1;rt<Ne.length;rt++)Ne[rt].x<Be?Be=Ne[rt].x:Ne[rt].x>Le&&(Le=Ne[rt].x),Ne[rt].y<it?it=Ne[rt].y:Ne[rt].y>vt&&(vt=Ne[rt].y);return[Be,it,Le-Be,vt-it]}(u),J=Ne=>[(Ne.x-Z)/G,(Ne.y-W)/X],[te,fe,de,he]=u.map(J),Ce=function(Ne,Be,Le,it,vt,rt,Rt,Pt){let zt=Tx(0,0,1,0,1,1,0,1),ct=Tx(Ne,Be,Le,it,vt,rt,Rt,Pt),tn=Ee.mat3.adjoint([],ct);return Ee.mat3.multiply(zt,zt,tn)}(te[0],te[1],fe[0],fe[1],de[0],de[1],he[0],he[1]);this.elevatedGlobePerspectiveTransform=FO(te[0],te[1],fe[0],fe[1],de[0],de[1],he[0],he[1]);let me=(Ne,Be)=>{x.push(Ne.lng);let Le=Math.round((Ne.lng-M)/R*Ot),it=Math.round((Ne.lat-I)/V*Ot),vt=J(Be),rt=Ee.vec3.transformMat3([],[vt[0],vt[1],1],Ce),Rt=Math.round(rt[0]/rt[2]*Ot),Pt=Math.round(rt[1]/rt[2]*Ot);j.emplaceBack(Le,it,Rt,Pt)},Me=u[3].x-u[0].x,Oe=u[3].y-u[0].y,Pe=u[2].x-u[1].x,ke=u[2].y-u[1].y;for(let Ne=0;Ne<65;Ne++){let Be=Ne/64,Le=[u[0].x+Be*Me,u[0].y+Be*Oe],it=[u[1].x+Be*Pe,u[1].y+Be*ke],vt=it[0]-Le[0],rt=it[1]-Le[1];for(let Rt=0;Rt<65;Rt++){let Pt=Rt/64,zt={x:Le[0]+vt*Pt,y:Le[1]+rt*Pt,z:0};me(a.projection.unproject(zt.x,zt.y),zt)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(j,MM.members)}{this.maxLongitudeTriangleSize=0;let j=[],Z=new qo,W=(G,X,J)=>{Z.emplaceBack(G,X,J);let te=x[G],fe=x[X],de=x[J],he=Math.min(Math.min(te,fe),de),Ce=Math.max(Math.max(te,fe),de)-he;Ce>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ce),j.push(he+Ce/2)};for(let G=0;G<64;G++)for(let X=0;X<64;X++){let J=65*G+X,te=J+1,fe=J+65,de=fe+1;W(J,fe,te),W(te,fe,de)}[j,Z]=function(G,X){let J=Array.from({length:G.length},(de,he)=>he);J.sort((de,he)=>G[de]-G[he]);let te=[],fe=new qo;for(let de=0;de<J.length;de++){let he=J[de];te.push(G[he]);let Ce=3*he,me=Ce+1;fe.emplaceBack(X.uint16[Ce],X.uint16[me],X.uint16[me+1])}return[te,fe]}(j,Z),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(Z)}this.elevatedGlobeSegments=Rr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/Ot,0,V/Ot,0,0,I,M,0])}prepare(){let i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;let a=this.map.painter.context,u=a.gl;!this._dirty||this.texture instanceof Mx||(this.texture?this.texture.update(this.image):(this.texture=new SM(a,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(a)}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){let a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;let u=this.elevatedGlobeTrianglesCenterLongitudes,m=(d=i+180)+360*Math.round((u[0]-d)/360);var d;let g=new Rr,b=(E,P)=>{g.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:a.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-m)<=T){let E=tt(u,0,u.length,m+T);return E===u.length||b(E,Bu(u,E+1,u.length,m+360-T)-E),g}m<u[0]&&(m+=360);let O=Bu(u,0,u.length,m-T);if(O===u.length)return b(0,u.length),g;b(0,O-0);let x=tt(u,O+1,u.length,m+T);return x!==u.length&&b(x,u.length-x),g}}let VU=(Math.pow(256,2)-1)/16907520;class zO extends Ss{constructor(i,a,u,m){super(i,{layout:kO||(kO=new Ar({visibility:new Et(qe.layout_raster.visibility)})),paint:LO||(LO=new Ar({"raster-opacity":new Et(qe.paint_raster["raster-opacity"]),"raster-color":new ad(qe.paint_raster["raster-color"]),"raster-color-mix":new Et(qe.paint_raster["raster-color-mix"]),"raster-color-range":new Et(qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Et(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Et(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Et(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Et(qe.paint_raster["raster-saturation"]),"raster-contrast":new Et(qe.paint_raster["raster-contrast"]),"raster-resampling":new Et(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Et(qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Et(qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Et(qe.paint_raster["raster-array-band"]),"raster-elevation":new Et(qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},a,u,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof NO&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;let a=this._transitionablePaint._values["raster-color"].value.expression,[u,m]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(m)||u===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=G_({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,m])}}let BO,VO,jO,UO,HO;class $O extends Ss{constructor(i,a,u,m){super(i,{layout:BO||(BO=new Ar({visibility:new Et(qe["layout_raster-particle"].visibility)})),paint:VO||(VO=new Ar({"raster-particle-array-band":new Et(qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Et(qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ad(qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Et(qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Et(qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Et(qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Et(qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Et(qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},a,u,m),this._updateColorRamp(),this.lastInvalidatedAt=Vt.now()}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let i=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=G_({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Vt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class jU extends Ss{constructor(i,a){super(i,{},a,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function IM(c,i,a){let u=[0,0,1],m=Ee.quat.identity([]);return Ee.quat.rotateY(m,m,a?-Cn(c)+Math.PI:Cn(c)),Ee.quat.rotateX(m,m,-Cn(i)),Ee.vec3.transformQuat(u,u,m),Ee.vec3.normalize(u,u)}function GO(c,i){let a=Sx(c.projection,c.zoom,c.width,c.height),u=function(d,g,b,T,O){let x=new bi(b.lng-180*wd,b.lat),E=new bi(b.lng+180*wd,b.lat),P=d.project(x.lng,x.lat),M=d.project(E.lng,E.lat),I=-Math.atan2(M.y-P.y,M.x-P.x),R=y.fromLngLat(b);R.y=Rn(R.y,-1+wd,1-wd);let V=R.toLngLat(),j=d.project(V.lng,V.lat),Z=y.fromLngLat(V);Z.x+=wd;let W=Z.toLngLat(),G=d.project(W.lng,W.lat),X=ZO(G.x-j.x,G.y-j.y,I),J=y.fromLngLat(V);J.y+=wd;let te=J.toLngLat(),fe=d.project(te.lng,te.lat),de=ZO(fe.x-j.x,fe.y-j.y,I),he=Math.abs(X.x)/Math.abs(de.y),Ce=Ee.mat4.identity([]);Ee.mat4.rotateZ(Ce,Ce,-I*(1-(O?0:T)));let me=Ee.mat4.identity([]);return Ee.mat4.scale(me,me,[1,1-(1-he)*T,1]),me[4]=-de.x/de.y*T,Ee.mat4.rotateZ(me,me,I),Ee.mat4.multiply(me,Ce,me),me}(c.projection,0,c.center,a,i),m=qO(c);return Ee.mat4.scale(u,u,[m,m,1]),u}function qO(c){let i=c.projection,a=Sx(c.projection,c.zoom,c.width,c.height),u=PM(i,c.center),m=PM(i,bi.convert(i.center));return Math.pow(2,u*a+(1-a)*m)}function Sx(c,i,a,u,m=1/0){let d=c.range;if(!d)return 0;let g=Math.min(m,Math.max(a,u)),b=Math.log(g/1024)/Math.LN2;return Gc(d[0]+b,d[1]+b,i)}let wd=1/4e4;function PM(c,i){let a=Rn(i.lat,-Wr,Wr),u=new bi(i.lng-180*wd,a),m=new bi(i.lng+180*wd,a),d=c.project(u.lng,a),g=c.project(m.lng,a),b=y.fromLngLat(u),T=y.fromLngLat(m),O=g.x-d.x,x=g.y-d.y,E=T.x-b.x,P=T.y-b.y,M=Math.sqrt((E*E+P*P)/(O*O+x*x));return Math.log(M)/Math.LN2}function ZO(c,i,a){let u=Math.cos(a),m=Math.sin(a);return{x:c*u-i*m,y:c*m+i*u}}function WO(c,i,a){Ee.mat4.identity(c),Ee.mat4.rotateZ(c,c,Cn(i[2])),Ee.mat4.rotateX(c,c,Cn(i[0])),Ee.mat4.rotateY(c,c,Cn(i[1])),Ee.mat4.scale(c,c,a),Ee.mat4.multiply(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ix(c,i,a,u,m,d,g,b){let T=[a[0]-i[0],a[1]-i[1],0],O=[u[0]-i[0],u[1]-i[1],0];if(Ee.vec3.length(T)<1e-12||Ee.vec3.length(O)<1e-12)return Ee.quat.identity(c);let x=Ee.vec3.cross([],T,O);Ee.vec3.normalize(x,x),Ee.vec3.subtract(O,u,i),T[2]=(d-m)*b,O[2]=(g-m)*b;let E=T;return Ee.vec3.cross(E,T,O),Ee.vec3.normalize(E,E),Ee.quat.rotationTo(c,x,E)}function DM(c,i,a=!1){let u=ts(i.zoom),m=function(d,g,b){let T=g.worldSize,O=[d[12],d[13],d[14]],x=Bo(O[1]/T),E=Xs(O[0]/T),P=Ee.mat4.identity([]),M=ms(1,x)*T,I=ms(1,0)*T*o(x,g.zoom),R=1/Is(T),V=I*R;if(b){let G=Sx(g.projection,g.zoom,g.width,g.height,1024);V=R*g.projection.pixelSpaceConversion(g.center.lat,T,G)}let j=ch(x,E);Ee.vec3.add(j,j,Ee.vec3.scale([],Ee.vec3.normalize([],j),M*V*O[2]));let Z=function(G){let X=[G[0],G[1],G[2]],J=[0,1,0],te=Ee.vec3.cross([],J,X);return Ee.vec3.cross(J,X,te),Ee.vec3.squaredLength(J)===0&&(J=[0,1,0],Ee.vec3.cross(te,X,J)),Ee.vec3.normalize(te,te),Ee.vec3.normalize(J,J),Ee.vec3.normalize(X,X),[te[0],te[1],te[2],0,J[0],J[1],J[2],0,X[0],X[1],X[2],0,G[0],G[1],G[2],1]}(j);Ee.mat4.scale(P,P,[V,V,V*M]),Ee.mat4.translate(P,P,[-O[0],-O[1],-O[2]]);let W=Ee.mat4.multiply([],g.globeMatrix,Z);return Ee.mat4.multiply(W,W,P),Ee.mat4.multiply(W,W,d),W}(c,i,a);if(u>0){let d=function(g,b){let T=b.worldSize,O=ms(1,0)*T*o(b.center.lat,b.zoom)/Is(T),x=ms(1,b.center.lat)*T,E=Ee.mat4.identity([]);return Ee.mat4.rotateY(E,E,Cn(b.center.lng)),Ee.mat4.rotateX(E,E,Cn(b.center.lat)),Ee.mat4.translate(E,E,[0,0,Qo]),Ee.mat4.scale(E,E,[O,O,O*x]),Ee.mat4.translate(E,E,[b.point.x-.5*T,b.point.y-.5*T,0]),Ee.mat4.multiply(E,E,g),Ee.mat4.multiply(E,b.globeMatrix,E)}(c,i);return function(g,b,T){let O=(I,R,V)=>{let j=Ee.vec3.length(I),Z=Ee.vec3.length(R),W=eo(I,R,V);return Ee.vec3.scale(W,W,1/Ee.vec3.length(W)*gn(j,Z,V))},x=O([g[0],g[1],g[2]],[b[0],b[1],b[2]],T),E=O([g[4],g[5],g[6]],[b[4],b[5],b[6]],T),P=O([g[8],g[9],g[10]],[b[8],b[9],b[10]],T),M=eo([g[12],g[13],g[14]],[b[12],b[13],b[14]],T);return[x[0],x[1],x[2],0,E[0],E[1],E[2],0,P[0],P[1],P[2],0,M[0],M[1],M[2],1]}(m,d,u)}return m}function YO(c,i,a,u){let m=bn.projectAabbCorners(u,a),d=Number.MAX_VALUE,g=-1;for(let O=0;O<m.length;++O){let x=m[O];x[0]=(.5*x[0]+.5)*i.width,x[1]=(.5-.5*x[1])*i.height,x[2]<d&&(g=O,d=x[2])}let b=O=>new We(m[O][0],m[O][1]),T;switch(g){case 0:case 6:T=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:T=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:T=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:T=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(re(c,T))return d}let UU=Ti([{name:"a_pos_3f",components:3,type:"Float32"}]),HU=Ti([{name:"a_color_3f",components:3,type:"Float32"}]),$U=Ti([{name:"a_color_4f",components:4,type:"Float32"}]),GU=Ti([{name:"a_uv_2f",components:2,type:"Float32"}]),qU=Ti([{name:"a_normal_3f",components:3,type:"Float32"}]),ZU=Ti([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),WU=Ti([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),XO={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Px{constructor(i,a,u,m){this.message=(i?`${i}: `:"")+u,m&&(this.identifier=m),a!=null&&a.__line__&&(this.line=a.__line__)}}function KO(c,i){let a=c.indexOf("://")===-1;try{return new URL(c,a&&i?"http://example.com":void 0),!0}catch{return!1}}class JO{constructor(i,a){this.feature=i,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class QO{constructor(){this.instancedDataArray=new bm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class OM{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=i.projection,this.index=i.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(i,a){}populate(i,a,u,m){this.tileToMeter=p(u);let d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:g,id:b,index:T,sourceLayerIndex:O}of i){let x=b??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),E=q(g,d);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),E,u))continue;let P={id:x,sourceLayerIndex:O,index:T,geometry:d?E.geometry:U(g,u,m),properties:g.properties,type:g.type,patterns:{}},M=this.addFeature(P,P.geometry,E);M&&a.featureIndex.insert(g,P.geometry,T,O,this.index,this.instancesPerModel[M].instancedDataArray.length,Ot/32)}this.lookup=null}update(i,a,u,m){for(let d in this.instancesPerModel){let g=this.instancesPerModel[d];for(let b in i)g.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(g.features[g.idToFeaturesIndex[b]],i[b],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(let a in this.instancesPerModel){let u=this.instancesPerModel[a];for(let m of u.features){let d=this.layers[0],g=m.feature,b=this.canonical,T=d.paint.get("model-rotation").evaluate(g,{},b),O=d.paint.get("model-scale").evaluate(g,{},b),x=d.paint.get("model-translation").evaluate(g,{},b);Ee.vec3.exactEquals(m.rotation,T)&&Ee.vec3.exactEquals(m.scale,O)&&Ee.vec3.exactEquals(m.translation,x)||(this.evaluate(m,m.featureStates,u,!0),i=!0)}}return i}updateReplacement(i,a,u,m){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;let d=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(nM(this.activeReplacements,d))return!1;this.activeReplacements=d;let g=!1;for(let b in this.instancesPerModel){let T=this.instancesPerModel[b],O=T.instancedDataArray;for(let x of T.features){let E=x.instancedDataOffset,P=x.instancedDataCount;for(let M=0;M<P;M++){let I=16*(M+E),R=O.float32[I+0],V=R>Ot;R=V?R-Ot:R;let j=Math.floor(R),Z=O.float32[I+1],W=!1;for(let G of this.activeReplacements)if(!fD(G,u,XO.Model,m)&&!(G.min.x>j||j>G.max.x||G.min.y>Z||Z>G.max.y)&&(W=vD(yD(j,Z,i.canonical,G.footprintTileId.canonical),G.footprint),W))break;O.float32[I]=W?R+Ot:R,g=g||W!==V}}}return g}isEmpty(){for(let i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(let a in this.instancesPerModel){let u=this.instancesPerModel[a];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=i.createVertexBuffer(u.instancedDataArray,ZU.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let a in this.instancesPerModel){let u=this.instancesPerModel[a];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}let i=this.layers[0].modelManager;if(i&&this.modelUris)for(let a of this.modelUris)i.removeModel(a,"")}addFeature(i,a,u){let m=this.layers[0],d=m.layout.get("model-id").evaluate(u,{},this.canonical);if(!d)return Wn(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),d;KO(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new QO);let g=this.instancesPerModel[d],b=g.instancedDataArray,T=new JO(u,b.length);for(let O of a)for(let x of O){if(x.x<0||x.x>=Ot||x.y<0||x.y>=Ot)continue;let E=(this.lookupDim-1)/Ot,P=this.lookupDim*(x.y*E|0)+x.x*E|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;let M=b.length;b.resize(M+1),g.instancesEvaluatedElevation.push(0),b.float32[16*M]=x.x,b.float32[16*M+1]=x.y}return T.instancedDataCount=g.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(i.id&&(g.idToFeaturesIndex[i.id]=g.features.length),g.features.push(T),this.evaluate(T,{},g,!1)),d}getModelUris(){return this.modelUris}evaluate(i,a,u,m){let d=this.layers[0],g=i.feature,b=this.canonical,T=i.rotation=d.paint.get("model-rotation").evaluate(g,a,b),O=i.scale=d.paint.get("model-scale").evaluate(g,a,b),x=i.translation=d.paint.get("model-translation").evaluate(g,a,b),E=d.paint.get("model-color").evaluate(g,a,b);E.a=d.paint.get("model-color-mix-intensity").evaluate(g,a,b);let P=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,O[0]),Math.max(O[1],O[2])),WO(P,T,O);let M=Math.round(100*E.a)+E.b/1.05;for(let I=0;I<i.instancedDataCount;++I){let R=i.instancedDataOffset+I,V=16*R,j=u.instancedDataArray.float32,Z=0;m&&(Z=j[V+6]-u.instancesEvaluatedElevation[R]);let W=0|j[V+1];j[V]=(0|j[V])+E.r/1.05,j[V+1]=W+E.g/1.05,j[V+2]=M,j[V+3]=1/(b.z>10?this.tileToMeter:p(b,W)),j[V+4]=x[0],j[V+5]=x[1],j[V+6]=x[2]+Z,j[V+7]=P[0],j[V+8]=P[1],j[V+9]=P[2],j[V+10]=P[4],j[V+11]=P[5],j[V+12]=P[6],j[V+13]=P[8],j[V+14]=P[9],j[V+15]=P[10],u.instancesEvaluatedElevation[R]=x[2]}}}let eA,tA;Xt(OM,"ModelBucket",{omit:["layers"]}),Xt(QO,"PerModelAttributes"),Xt(JO,"ModelFeature");let Yf=64,Vm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function nA(c,i,a,u,m,d,g,b,T,O=!1){let x=a.zoom,E=a.project(u),P=o(u.lat,x),M=1/P;Ee.mat4.identity(c),Ee.mat4.translate(c,c,[E.x+g[0]*M,E.y+g[1]*M,g[2]]);let I=1,R=1,V=a.worldSize;if(O){if(a.projection.name==="mercator"){let G=0;a.elevation&&(G=a.elevation.getAtPointOrZero(new y(E.x/V,E.y/V),0));let X=Ee.vec4.transformMat4([],[E.x,E.y,G,1],a.projMatrix)[3]/a.cameraToCenterDistance;I=X,R=X*o(a.center.lat,x)}else if(a.projection.name==="globe"){let G=DM(c,a),X=Ee.mat4.multiply([],a.projMatrix,G),J=[0,0,0,1];Ee.vec4.transformMat4(J,J,X);let te=J[3]/a.cameraToCenterDistance,fe=ts(x),de=a.projection.pixelsPerMeter(u.lat,V)*o(u.lat,x),he=a.projection.pixelsPerMeter(a.center.lat,V)*o(a.center.lat,x);I=te/gn(de,f(a.center.lat),fe),R=te*P/de,I*=he,R*=he}}else I=M;Ee.mat4.scale(c,c,[I,I,R]);let j=[...c],Z=i.orientation,W=[];if(WO(W,[Z[0]+m[0],Z[1]+m[1],Z[2]+m[2]],d),Ee.mat4.multiply(c,j,W),b&&a.elevation){let G=0,X=[];if(T&&a.elevation){G=function(fe,de,he,Ce,me){let Me=de.elevation;if(!Me)return 0;let Oe=bn.projectAabbCorners(he,Ce),Pe=ms(1,me.lat)*de.worldSize,ke=function(tn,kt){let Jt=[0,0,1],mn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let zn of mn){let Vn=tn[zn.corners[0]],Jn=tn[zn.corners[1]],jn=tn[zn.corners[2]],ni=[Jn[0]-Vn[0],Jn[1]-Vn[1],kt*(Jn[2]-Vn[2])],Ki=Ee.vec3.cross(ni,ni,[jn[0]-Vn[0],jn[1]-Vn[1],kt*(jn[2]-Vn[2])]);Ee.vec3.normalize(Ki,Ki),zn.dotProductWithUp=Ee.vec3.dot(Ki,Jt)}return mn.sort((zn,Vn)=>zn.dotProductWithUp-Vn.dotProductWithUp),mn[0].corners}(Oe,Pe),Ne=Oe[ke[0]],Be=Oe[ke[1]],Le=Oe[ke[2]],it=Oe[ke[3]],vt=Me.getAtPointOrZero(new y(Ne[0]/de.worldSize,Ne[1]/de.worldSize),0),rt=Me.getAtPointOrZero(new y(Be[0]/de.worldSize,Be[1]/de.worldSize),0),Rt=Me.getAtPointOrZero(new y(Le[0]/de.worldSize,Le[1]/de.worldSize),0),Pt=Me.getAtPointOrZero(new y(it[0]/de.worldSize,it[1]/de.worldSize),0),zt=(vt+Pt)/2,ct=(rt+Rt)/2;return zt>ct?rt<Rt?Ix(fe,Be,it,Ne,rt,Pt,vt,Pe):Ix(fe,Le,Ne,it,Rt,vt,Pt,Pe):vt<Pt?Ix(fe,Ne,Be,Le,vt,rt,Rt,Pe):Ix(fe,it,Le,Be,Pt,Rt,rt,Pe),Math.max(zt,ct)}(X,a,i.aabb,c,u);let J=Ee.mat4.fromQuat([],X),te=Ee.mat4.multiply([],J,W);Ee.mat4.multiply(c,j,te)}else G=a.elevation.getAtPointOrZero(new y(E.x/V,E.y/V),0);G!==0&&(c[14]+=G)}}function hy(c,i,a=!1){c.uploaded||(c.gfxTexture=new SM(i,c.image,a?i.gl.R8:i.gl.RGBA8,{useMipmap:c.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function YU(c,i,a){c.indexBuffer=i.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=i.createVertexBuffer(c.vertexArray,UU.members,!1,!0),c.normalArray&&(c.normalBuffer=i.createVertexBuffer(c.normalArray,qU.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=i.createVertexBuffer(c.texcoordArray,GU.members,!1,!0)),c.colorArray&&(c.colorBuffer=i.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?HU:$U).members,!1,!0)),c.featureArray&&(c.pbrBuffer=i.createVertexBuffer(c.featureArray,WU.members,!0)),c.segments=Rr.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);let u=c.material;u.pbrMetallicRoughness.baseColorTexture&&hy(u.pbrMetallicRoughness.baseColorTexture,i),u.pbrMetallicRoughness.metallicRoughnessTexture&&hy(u.pbrMetallicRoughness.metallicRoughnessTexture,i),u.normalTexture&&hy(u.normalTexture,i),u.occlusionTexture&&hy(u.occlusionTexture,i,a),u.emissionTexture&&hy(u.emissionTexture,i)}function AM(c,i,a){if(c.meshes)for(let u of c.meshes)YU(u,i,a);if(c.children)for(let u of c.children)AM(u,i,a)}function Dx(c){if(c.meshes)for(let i of c.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(c.children)for(let i of c.children)Dx(i)}function RM(c){if(c.meshes)for(let a of c.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((i=a.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(c.children)for(let a of c.children)RM(a)}class jm{constructor(i,a,u){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(i,a,u){let m=u||i.findDEMTileFor(a);if(!m||!m.dem)return;let d=m.dem,g=m.tileID,b=1<<a.canonical.z-g.canonical.z;return new jm(m,d.dim/Ot/b,[(a.canonical.x/b-g.canonical.x)*d.dim,(a.canonical.y/b-g.canonical.y)*d.dim])}tileCoordToPixel(i,a){let u=a*this._scale+this._offset[1],m=Math.floor(i*this._scale+this._offset[0]),d=Math.floor(u);return new We(m,d)}getElevationAt(i,a,u,m){let d=i*this._scale+this._offset[0],g=a*this._scale+this._offset[1],b=Math.floor(d),T=Math.floor(g),O=this._dem;return m=!!m,u?gn(gn(O.get(b,T,m),O.get(b,T+1,m),g-T),gn(O.get(b+1,T,m),O.get(b+1,T+1,m),g-T),d-b):O.get(b,T,m)}getElevationAtPixel(i,a,u){return this._dem.get(i,a,!!u)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*ms(1,i)*this._dem.stride}}let kM=new Float32Array(262144),Xf=new Uint8Array(262144);function iA(c){let i=0;if(c.meshes)for(let a of c.meshes)i=Math.max(i,a.aabb.max[2]);if(c.children)for(let a of c.children)i=Math.max(i,iA(a));return i}function rA(c,i,a){if(c.meshes)for(let u of c.meshes){if(u.aabb.min[0]===1/0)continue;let m=bn.applyTransform(u.aabb,c.matrix);a.insert(i,m.min[0],m.min[1],m.max[0],m.max[1])}if(c.children)for(let u of c.children)rA(u,i,a)}let oA=["","wall","door","roof","window","lamp","logo"];class sA{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:iA(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0,a=new bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let u of this.node.meshes)this.node.lightMeshIndex!==i&&(u.transformedAabb=bn.applyTransformFast(u.aabb,this.node.matrix),a.encapsulate(u.transformedAabb)),i++;this.aabb=a}return this.aabb}}class Ox{constructor(i,a,u,m,d,g,b){this.id=u,this.layers=i,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Vm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=Vm.HasMapboxMeshFeatures),d&&(this.modelTraits|=Vm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let T of a)this.nodesInfo.push(new sA(T)),rA(T,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(i,a){for(let u of this.getNodesInfo()){let m=u.node;m.footprint&&a.push({footprint:m.footprint,id:i})}}update(i){let a=Object.keys(i).length!==0;if(a&&!this.stateDependentLayers.length)return;let u=a?this.stateDependentLayers:this.layers;if(!Nr(i,this.states))for(let m of u)this.evaluate(m,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;let a=this.getNodesInfo();for(let u of a){let m=u.node;this.uploaded?this.updatePbrBuffer(m):AM(m,i,!0)}for(let u of a)Dx(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let a=!1;if(!i.meshes)return a;for(let u of i.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),a=!0);return a}needsReEvaluation(i,a,u){let m=i.transform.projectionOptions,d=i.style.getBrightness(),g=this.brightness!==d;if(!this.uploaded||this.dirty||m.name!==this.projection.name||dy(u.paint.get("model-color").value,g)||dy(u.paint.get("model-color-mix-intensity").value,g)||dy(u.paint.get("model-roughness").value,g)||dy(u.paint.get("model-emissive-strength").value,g)||dy(u.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=m,this.brightness=d;let b=this.getNodesInfo();for(let T of b)T.state=null;return!0}return!1}evaluateScale(i,a){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;let u=this.getNodesInfo(),m=this.id.canonical;for(let d of u){let g=d.feature;d.evaluatedScale=a.paint.get("model-scale").evaluate(g,{},m)}}evaluate(i,a){let u=this.getNodesInfo();for(let m of u){if(!m.node.meshes)continue;let d=m.feature,g=a&&a[d.id];if(Nr(g,m.state))continue;m.state=structuredClone(g);let b=m.node.meshes&&m.node.meshes[0].featureData,T=m.evaluatedColor[2],O=m.evaluatedRMEA[2],x=this.id.canonical;if(m.hasTranslucentParts=!1,b){for(let E=0;E<oA.length;E++){let P=oA[E];P.length&&(d.properties.part=P);let M=i.paint.get("model-color").evaluate(d,g,x).toRenderColor(null),I=i.paint.get("model-color-mix-intensity").evaluate(d,g,x);m.evaluatedColor[E]=[M.r,M.g,M.b,I],m.evaluatedRMEA[E][0]=i.paint.get("model-roughness").evaluate(d,g,x),m.evaluatedRMEA[E][2]=i.paint.get("model-emissive-strength").evaluate(d,g,x),m.evaluatedRMEA[E][3]=M.a,m.emissionHeightBasedParams[E]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,g,x),!m.hasTranslucentParts&&M.a<1&&(m.hasTranslucentParts=!0)}delete d.properties.part,KU(m,T!==m.evaluatedColor[2]||O!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(d,g,x);m.evaluatedScale=i.paint.get("model-scale").evaluate(d,g,x),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,a,u,m){let d=i.findDEMTileFor(u);if(d&&(d.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;let g=jm.create(i,u,d);if(!g)return;this.modelTraits&Vm.HasMapboxMeshFeatures&&this.updateDEM(i,g,u,m);for(let b of this.getNodesInfo()){let T=b.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;let O=T.footprint.vertices,x=g.getElevationAt(O[0].x,O[0].y,!0,!0);for(let E=1;E<O.length;E++)x=Math.min(x,g.getElevationAt(O[E].x,O[E].y,!0,!0));T.elevation=x}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=a}}updateDEM(i,a,u,m){let d=a._dem._modifiedForSources[m];if(d===void 0&&(a._dem._modifiedForSources[m]=[],d=a._dem._modifiedForSources[m]),d.includes(u.canonical))return;let g=a._dem.dim;d.push(u.canonical);let b=!1;for(let T of this.getNodesInfo()){let O=T.node;if(!O.footprint||!O.footprint.grid)continue;let x=O.footprint.grid,E=a.tileCoordToPixel(x.min.x,x.min.y),P=a.tileCoordToPixel(x.max.x,x.max.y),M=Math.min(Math.min(g-P.y,E.x),Math.min(E.y,g-P.x));if(M<0)continue;let I=Rn(M,2,5),R=Math.max(0,E.x-I),V=Math.max(0,E.y-I),j=Math.min(P.x+I,g-1),Z=Math.min(P.y+I,g-1);for(let J=V;J<=Z;++J)for(let te=R;te<=j;++te)Xf[J*g+te]=255;let W=0,G=0;for(let J=0;J<x.cellsY;++J)for(let te=0;te<x.cellsX;++te){if(!x.cells[J*x.cellsX+te])continue;let fe=a.tileCoordToPixel(x.min.x+te/x.xScale,x.min.y+J/x.yScale),de=a.tileCoordToPixel(x.min.x+(te+1)/x.xScale,x.min.y+(J+1)/x.yScale);for(let he=fe.y;he<=Math.min(de.y+1,g-1);++he)for(let Ce=fe.x;Ce<=Math.min(de.x+1,g-1);++Ce)Xf[he*g+Ce]===255&&(Xf[he*g+Ce]=0,W+=a.getElevationAtPixel(Ce,he),G++)}let X=W/G;R=Math.max(1,E.x-I),V=Math.max(1,E.y-I),j=Math.min(P.x+I,g-2),Z=Math.min(P.y+I,g-2),b=!0;for(let J=V;J<=Z;++J)for(let te=R;te<=j;++te)Xf[J*g+te]===0&&(kM[J*g+te]=a._dem.set(te,J,X));for(let J=1;J<I;++J){R=Math.max(1,E.x-J),V=Math.max(1,E.y-J),j=Math.min(P.x+J,g-2),Z=Math.min(P.y+J,g-2);for(let te=V;te<=Z;++te)for(let fe=R;fe<=j;++fe){let de=te*g+fe;if(Xf[de]===255){let he=0,Ce=0,me=-1,Me=-1;for(let Oe=-1;Oe<=1;++Oe)for(let Pe=-1;Pe<=1;++Pe){let ke=(te+Oe)*g+fe+Pe;if(Xf[ke]>=J)continue;let Ne=kM[ke],Be=Math.abs(Ne);Be>Ce&&(he=Ne,Ce=Be,me=Pe,Me=Oe)}if(Ce>.1){let Oe=1-(J+.5*Math.abs(me*Me))/I,Pe=a._dem.get(fe,te)+he*Oe,ke=a._dem.get(fe+me,te+Me),Ne=a._dem.get(fe-me,te-Me,!0);(Pe-ke)*(Pe-Ne)>0&&(Pe=(ke+Ne)/2),kM[de]=a._dem.set(fe,te,Pe),Xf[de]=J}}}}}b&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=Vt.now())}getNodesInfo(){return this.nodesInfo}destroy(){let i=this.getNodesInfo();for(let a of i)Dx(a.node),RM(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;let u=a.getReplacementRegionsForTile(i.toUnwrapped()),m=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){let g=m[d].node;m[d].hiddenByReplacement=!!g.footprint&&!u.find(b=>b.footprint===g.footprint)}}getHeightAtTileCoord(i,a){let u=this.getNodesInfo(),m=[],d=[0,0,0],g=Ee.mat4.identity([]);for(let b=0;b<this.nodesInfo.length;b++){let T=u[b],O=T.node.meshes[0],x=O.transformedAabb;if(i<x.min[0]||a<x.min[1]||i>x.max[0]||a>x.max[1])continue;if(T.node.hidden===!0)return{height:1/0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};Ee.mat4.invert(g,T.node.matrix),d[0]=i,d[1]=a,Ee.vec3.transformMat4(d,d,g);let E=(d[0]-O.aabb.min[0])/(O.aabb.max[0]-O.aabb.min[0])*Yf|0,P=Math.min(63,(d[1]-O.aabb.min[1])/(O.aabb.max[1]-O.aabb.min[1])*Yf|0)*Yf+Math.min(63,E),M=O.heightmap[P];if(!(M<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:M,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new We(i,a),new We(i,a),m),m.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function dy(c,i){return!c.isLightConstant&&i}function XU(c,i,a,u,m,d,g,b){let T=(61440&i|(61440&i)>>4)>>8,O=(3840&i|(3840&i)>>4)>>4,x=240&i|(240&i)>>4;a[3]>0&&(T=gn(T,255*a[0],a[3]),O=gn(O,255*a[1],a[3]),x=gn(x,255*a[2],a[3]));let E=T<<8|O,P=x<<8|Math.floor(255*u[3]),M=function(J){let te=Rn(J,0,2);return Math.min(Math.round(.5*te*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],I=Rn(m[0],0,1),R=Rn(m[1],0,1),V=Rn(m[2],0,1),j=Rn(m[3],0,1),Z,W,G,X;if(I!==R&&g!==d&&R!==I){let J=g-d;W=1/(J*(R-I)),G=-(d+J*I)/(J*(R-I));let te=Rn(m[4],-1,1);X=Math.pow(10,te),Z=255*V<<8|255*j}else Z=65535,W=0,G=1,X=1;if(c.emplaceBack(E,P,M,Z,W,G,X),b){let J=b.length;b.clear();for(let te=0;te<J;te++)b.emplaceBack(E,P,M,Z,W,G,X)}}function KU(c,i,a){let u=c.node,m=0,d=a&Vm.HasMeshoptCompression;for(let g of u.meshes){if(u.lights&&u.lightMeshIndex===m||!g.featureData)continue;g.featureArray=new wm,g.featureArray.reserve(g.featureData.length);let b=i;for(let T of g.featureData){let O=d?65535&T:T>>16&65535,x=d?T>>16&65535:65535&T,E=(15&x)<8?15&x:0,P=c.evaluatedRMEA[E],M=c.evaluatedColor[E],I=c.emissionHeightBasedParams[E],R;if(b&&E===2&&u.lights&&(R=new wm,R.resize(10*u.lights.length)),XU(g.featureArray,O,M,P,I,g.aabb.min[2],g.aabb.max[2],R),R&&b){b=!1;let V=u.meshes[u.lightMeshIndex];V.featureArray=R,V.featureArray._trim()}}g.featureArray._trim(),m++}}function aA(c,i,a,u){let m=1<<c.z;i.lat=Bo((u/Ot+c.y)/m),i.lng=Xs((a/Ot+c.x)/m)}Xt(Ox,"Tiled3dModelBucket",{omit:["layers"]}),Xt(sA,"Tiled3dModelFeature");let JU={circle:class extends Ss{constructor(c,i,a,u){super(c,{layout:dt||(dt=new Ar({"circle-sort-key":new Gt(qe.layout_circle["circle-sort-key"]),visibility:new Et(qe.layout_circle.visibility)})),paint:et||(et=new Ar({"circle-radius":new Gt(qe.paint_circle["circle-radius"]),"circle-color":new Gt(qe.paint_circle["circle-color"]),"circle-blur":new Gt(qe.paint_circle["circle-blur"]),"circle-opacity":new Gt(qe.paint_circle["circle-opacity"]),"circle-translate":new Et(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Et(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Et(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Et(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Et(qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u)}createBucket(c){return new ie(c)}queryRadius(c){let i=c;return at("circle-radius",this,i)+at("circle-stroke-width",this,i)+gt(this.paint.get("circle-translate"))}queryIntersectsFeature(c,i,a,u,m,d,g,b){let T=Ve(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,c.pixelToTileUnitsFactor),O=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return NP(c,u,d,g,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,O)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,i,a){let u=Am(this);return{config:new sh(this,{zoom:i,lut:a}),defines:u,overrideFog:!1}}},heatmap:class extends Ss{createBucket(c){return new BP(c)}constructor(c,i,a,u){super(c,{layout:VP||(VP=new Ar({visibility:new Et(qe.layout_heatmap.visibility)})),paint:jP||(jP=new Ar({"heatmap-radius":new Gt(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Et(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ad(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Et(qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=G_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return at("heatmap-radius",this,c)}queryIntersectsFeature(c,i,a,u,m,d,g,b){let T=this.paint.get("heatmap-radius").evaluate(i,a);return NP(c,u,d,g,b,!0,!0,new We(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,i,a){return c==="heatmap"?{config:new sh(this,{zoom:i,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Ss{constructor(c,i,a,u){super(c,{layout:UP||(UP=new Ar({visibility:new Et(qe.layout_hillshade.visibility)})),paint:HP||(HP=new Ar({"hillshade-illumination-direction":new Et(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Et(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Et(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Et(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Et(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Et(qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Et(qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,i,a){return{overrideFog:!1}}},fill:class extends Ss{constructor(c,i,a,u){super(c,{layout:JP||(JP=new Ar({"fill-sort-key":new Gt(qe.layout_fill["fill-sort-key"]),visibility:new Et(qe.layout_fill.visibility),"fill-elevation-reference":new Et(qe.layout_fill["fill-elevation-reference"])})),paint:QP||(QP=new Ar({"fill-antialias":new Et(qe.paint_fill["fill-antialias"]),"fill-opacity":new Gt(qe.paint_fill["fill-opacity"]),"fill-color":new Gt(qe.paint_fill["fill-color"]),"fill-outline-color":new Gt(qe.paint_fill["fill-outline-color"]),"fill-translate":new Et(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Et(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gt(qe.paint_fill["fill-pattern"]),"fill-emissive-strength":new Et(qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Gt(qe.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u)}getProgramIds(){let c=this.paint.get("fill-pattern"),i=c&&c.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(c,i,a){return{config:new sh(this,{zoom:i,lut:a}),overrideFog:!1}}recalculate(c,i){super.recalculate(c,i);let a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new XC(c)}queryRadius(){return gt(this.paint.get("fill-translate"))}queryIntersectsFeature(c,i,a,u,m,d){return!c.queryGeometry.isAboveHorizon&&ge(St(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,c.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Ss{constructor(c,i,a,u){super(c,{layout:kD||(kD=new Ar({visibility:new Et(qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Et(qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:LD||(LD=new Ar({"fill-extrusion-opacity":new Et(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Et(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Et(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gt(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Et(qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Et(qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Et(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Et(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Et(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Et(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Et(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Et(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Et(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Et(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Gt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Gt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Et(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Et(qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Et(qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Et(qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Gt(qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Gt(qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Et(qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new ax(c)}queryRadius(){return gt(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,i,a,u,m,d,g,b,T){let O=Ve(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,c.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(i,a),E=this.paint.get("fill-extrusion-base").evaluate(i,a),P=[0,0],M=b&&d.elevation,I=d.elevation?d.elevation.exaggeration():1,R=c.tile.getBucket(this);if(M&&R instanceof ax){let G=R.centroidVertexArray,X=T+1;X<G.length&&(P[0]=G.geta_centroid_pos0(X),P[1]=G.geta_centroid_pos1(X))}if(P[0]===0&&P[1]===1)return!1;d.projection.name==="globe"&&(u=RD([u],[new We(0,0),new We(Ot,Ot)],c.tileID.canonical).map(G=>G.polygon).flat());let V=M?b:null,[j,Z]=function(G,X,J,te,fe,de,he,Ce,me,Me,Oe){return G.projection.name==="globe"?function(Pe,ke,Ne,Be,Le,it,vt,rt,Rt,Pt,zt){let ct=[],tn=[],kt=Pe.projection.upVectorScale(zt,Pe.center.lat,Pe.worldSize).metersToTile,Jt=[0,0,0,1],mn=[0,0,0,1],zn=(Jn,jn,ni,Ki)=>{Jn[0]=jn,Jn[1]=ni,Jn[2]=Ki,Jn[3]=1},Vn=AD();Ne>0&&(Ne+=Vn),Be+=Vn;for(let Jn of ke){let jn=[],ni=[];for(let Ki of Jn){let Vi=Ki.x+Le.x,Pn=Ki.y+Le.y,ji=Pe.projection.projectTilePoint(Vi,Pn,zt),Li=Pe.projection.upVector(zt,Ki.x,Ki.y),Ji=Ne,uo=Be;if(vt){let ho=ND(Vi,Pn,Ne,Be,vt,rt,Rt,Pt);Ji+=ho.base,uo+=ho.top}Ne!==0?zn(Jt,ji.x+Li[0]*kt*Ji,ji.y+Li[1]*kt*Ji,ji.z+Li[2]*kt*Ji):zn(Jt,ji.x,ji.y,ji.z),zn(mn,ji.x+Li[0]*kt*uo,ji.y+Li[1]*kt*uo,ji.z+Li[2]*kt*uo),Ee.vec3.transformMat4(Jt,Jt,it),Ee.vec3.transformMat4(mn,mn,it),jn.push(new Wf(Jt[0],Jt[1],Jt[2])),ni.push(new Wf(mn[0],mn[1],mn[2]))}ct.push(jn),tn.push(ni)}return[ct,tn]}(G,X,J,te,fe,de,he,Ce,me,Me,Oe):he?function(Pe,ke,Ne,Be,Le,it,vt,rt,Rt){let Pt=[],zt=[],ct=[0,0,0,1];for(let tn of Pe){let kt=[],Jt=[];for(let mn of tn){let zn=mn.x+Be.x,Vn=mn.y+Be.y,Jn=ND(zn,Vn,ke,Ne,it,vt,rt,Rt);ct[0]=zn,ct[1]=Vn,ct[2]=Jn.base,ct[3]=1,Ee.vec4.transformMat4(ct,ct,Le),ct[3]=Math.max(ct[3],1e-5);let jn=new Wf(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ct[0]=zn,ct[1]=Vn,ct[2]=Jn.top,ct[3]=1,Ee.vec4.transformMat4(ct,ct,Le),ct[3]=Math.max(ct[3],1e-5);let ni=new Wf(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);kt.push(jn),Jt.push(ni)}Pt.push(kt),zt.push(Jt)}return[Pt,zt]}(X,J,te,fe,de,he,Ce,me,Me):function(Pe,ke,Ne,Be,Le){let it=[],vt=[],rt=Le[8]*ke,Rt=Le[9]*ke,Pt=Le[10]*ke,zt=Le[11]*ke,ct=Le[8]*Ne,tn=Le[9]*Ne,kt=Le[10]*Ne,Jt=Le[11]*Ne;for(let mn of Pe){let zn=[],Vn=[];for(let Jn of mn){let jn=Jn.x+Be.x,ni=Jn.y+Be.y,Ki=Le[0]*jn+Le[4]*ni+Le[12],Vi=Le[1]*jn+Le[5]*ni+Le[13],Pn=Le[2]*jn+Le[6]*ni+Le[14],ji=Le[3]*jn+Le[7]*ni+Le[15],Li=Ki+rt,Ji=Vi+Rt,uo=Pn+Pt,ho=Math.max(ji+zt,1e-5),Yr=Ki+ct,Js=Vi+tn,vr=Pn+kt,Cr=Math.max(ji+Jt,1e-5);zn.push(new Wf(Li/ho,Ji/ho,uo/ho)),Vn.push(new Wf(Yr/Cr,Js/Cr,vr/Cr))}it.push(zn),vt.push(Vn)}return[it,vt]}(X,J,te,fe,de)}(d,u,E,x,O,g,V,P,I,d.center.lat,c.tileID.canonical),W=c.queryGeometry;return function(G,X,J){let te=1/0;ge(J,X)&&(te=FD(J,X[0]));for(let fe=0;fe<X.length;fe++){let de=X[fe],he=G[fe];for(let Ce=0;Ce<de.length-1;Ce++){let me=de[Ce],Me=[me,de[Ce+1],he[Ce+1],he[Ce],me];re(J,Me)&&(te=Math.min(te,FD(J,Me)))}}return te!==1/0&&te}(j,Z,W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends Ss{constructor(c,i,a,u){let m=ZD();super(c,m,i,a,u),m.layout&&(this.layout=new sd(m.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){let i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof sl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,i){super.recalculate(c,i),this.paint._values["line-floorwidth"]=(()=>{if(ey)return ey;let a=ZD();return ey=new tU(a.paint.properties["line-width"].specification),ey.useIntegerZoom=!0,ey})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new sM(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,i,a){let u=GD(this);return{config:new sh(this,{zoom:i,lut:a}),defines:u,overrideFog:!1}}queryRadius(c){let i=c,a=WD(at("line-width",this,i),at("line-gap-width",this,i)),u=at("line-offset",this,i);return a/2+Math.abs(u)+gt(this.paint.get("line-translate"))}queryIntersectsFeature(c,i,a,u,m,d){if(c.queryGeometry.isAboveHorizon)return!1;let g=St(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,c.pixelToTileUnitsFactor),b=c.pixelToTileUnitsFactor/2*WD(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),T=this.paint.get("line-offset").evaluate(i,a);return T&&(u=function(O,x){let E=[],P=new We(0,0);for(let M=0;M<O.length;M++){let I=O[M],R=[];for(let V=0;V<I.length;V++){let j=I[V],Z=I[V+1],W=V===0?P:j.sub(I[V-1])._unit()._perp(),G=V===I.length-1?P:Z.sub(j)._unit()._perp(),X=W._add(G)._unit();X._mult(1/(X.x*G.x+X.y*G.y)),R.push(X._mult(x)._add(j))}E.push(R)}return E}(u,T*c.pixelToTileUnitsFactor)),function(O,x,E){for(let P=0;P<x.length;P++){let M=x[P];if(O.length>=3){for(let I=0;I<M.length;I++)if(Re(O,M[I]))return!0}if(pe(O,M,E))return!0}return!1}(g,u,b)}isTileClipped(){return!0}isDraped(c){let i=this.layout.get("line-z-offset"),a=i.isConstant()&&!i.constantOr(0),u=this.layout.get("line-elevation-reference");return!(u==="sea"||u==="ground")&&(a||u!=="none")}},symbol:Cx,background:class extends Ss{constructor(c,i,a,u){super(c,{layout:AO||(AO=new Ar({visibility:new Et(qe.layout_background.visibility)})),paint:RO||(RO=new Ar({"background-pitch-alignment":new Et(qe.paint_background["background-pitch-alignment"]),"background-color":new Et(qe.paint_background["background-color"]),"background-pattern":new Et(qe.paint_background["background-pattern"]),"background-opacity":new Et(qe.paint_background["background-opacity"]),"background-emissive-strength":new Et(qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,i,a){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:zO,"raster-particle":$O,sky:class extends Ss{constructor(c,i,a,u){super(c,{layout:jO||(jO=new Ar({visibility:new Et(qe.layout_sky.visibility)})),paint:UO||(UO=new Ar({"sky-type":new Et(qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Et(qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Et(qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Et(qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Et(qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new ad(qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Et(qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Et(qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Et(qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=G_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let i=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(c,i){if(this.paint.get("sky-type")==="atmosphere"){let u=this.paint.get("sky-atmosphere-sun"),m=!u,d=c.style.light,g=d.properties.get("position");return m&&d.properties.get("anchor")==="viewport"&&Wn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?IM(g.azimuthal,90-g.polar,i):IM(u[0],90-u[1],i)}let a=this.paint.get("sky-gradient-center");return IM(a[0],90-a[1],i)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends Ss{constructor(c,i,a,u){super(c,{paint:HO||(HO=new Ar({}))},i,null)}},model:class extends Ss{constructor(c,i,a,u){super(c,{layout:eA||(eA=new Ar({visibility:new Et(qe.layout_model.visibility),"model-id":new Gt(qe.layout_model["model-id"])})),paint:tA||(tA=new Ar({"model-opacity":new Gt(qe.paint_model["model-opacity"]),"model-rotation":new Gt(qe.paint_model["model-rotation"]),"model-scale":new Gt(qe.paint_model["model-scale"]),"model-translation":new Gt(qe.paint_model["model-translation"]),"model-color":new Gt(qe.paint_model["model-color"]),"model-color-mix-intensity":new Gt(qe.paint_model["model-color-mix-intensity"]),"model-type":new Et(qe.paint_model["model-type"]),"model-cast-shadows":new Et(qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Et(qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Et(qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Gt(qe.paint_model["model-emissive-strength"]),"model-roughness":new Gt(qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Gt(qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Et(qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Et(qe.paint_model["model-front-cutoff"]),"model-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new OM(c)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof Ox?Ot-1:0}queryIntersectsFeature(c,i,a,u,m,d){if(!this.modelManager)return!1;let g=this.modelManager,b=c.tile.getBucket(this);if(!(b&&b instanceof OM))return!1;for(let T in b.instancesPerModel){let O=b.instancesPerModel[T],x=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(O.idToFeaturesIndex.hasOwnProperty(x)){let E=O.features[O.idToFeaturesIndex[x]],P=g.getModel(T,this.scope);if(!P)return!1;let M=Ee.mat4.create(),I=new bi(0,0),R=b.canonical,V=Number.MAX_VALUE;for(let j=0;j<E.instancedDataCount;++j){let Z=16*(E.instancedDataOffset+j),W=O.instancedDataArray.float32,G=[W[Z+4],W[Z+5],W[Z+6]];aA(R,I,W[Z],0|W[Z+1]),nA(M,P,d,I,E.rotation,E.scale,G,!1,!1,!1),d.projection.name==="globe"&&(M=DM(M,d));let X=Ee.mat4.multiply([],d.projMatrix,M),J=c.queryGeometry,te=YO(J.isPointQuery()?J.screenBounds:J.screenGeometry,d,X,P.aabb);te!=null&&(V=Math.min(te,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(c,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){let i=this._transitionablePaint._values[c];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof nd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ss{constructor(c,i,a,u){super(c,{layout:eD||(eD=new Ar({"clip-layer-types":new Et(qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Et(qe.layout_clip["clip-layer-scope"])})),paint:tD||(tD=new Ar({}))},i,a,u)}recalculate(c,i){super.recalculate(c,i)}createBucket(c){return new nD(c)}isTileClipped(){return!0}is3D(){return!0}}};class QU{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class e8{constructor(){this.tasks={},this.taskQueue=[],Wc(["process"],this),this.invoker=new QU(this.process),this.nextId=0}add(i,a){let u=this.nextId++,m=function({type:d,isSymbolTile:g,zoom:b}){return b=b||0,d==="message"?0:d!=="maybePrepare"||g?d!=="parseTile"||g?d==="parseTile"&&g?300-b:d==="maybePrepare"&&g?400-b:500:200-b:100-b}(a);if(m===0){try{i()}finally{}return null}return this.tasks[u]={fn:i,metadata:a,priority:m,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;let i=this.pick();if(i===null)return;let a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let m=0;m<this.taskQueue.length;m++){let d=this.tasks[this.taskQueue[m]];d.priority<a&&(a=d.priority,i=m)}if(i===null)return null;let u=this.taskQueue[i];return this.taskQueue.splice(i,1),u}remove(){this.invoker.remove()}}class lA{constructor(i,a,u){this.target=i,this.parent=a,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Wc(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new e8}send(i,a,u,m,d=!1,g){let b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[b]=u);let T=new Set;return this.target.postMessage({id:b,type:i,hasCallback:!!u,targetMapId:m,mustQueue:d,sourceMapId:this.mapId,data:nh(a,T)},T),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(i){let a=i.data,u=a.id;if(u&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){let m=this.cancelCallbacks[u];delete this.cancelCallbacks[u],m&&m.cancel()}else if(a.mustQueue||Sl()){let m=this.callbacks[u],d=this.scheduler.add(()=>this.processTask(u,a),m&&m.metadata||{type:"message"});d&&(this.cancelCallbacks[u]=d)}else this.processTask(u,a)}processTask(i,a){if(delete this.cancelCallbacks[i],a.type==="<response>"){let u=this.callbacks[i];delete this.callbacks[i],u&&(a.error?u(ih(a.error)):u(null,ih(a.data)))}else{let u=new Set,m=a.hasCallback?(g,b)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:g?nh(g):null,data:nh(b,u)},u)}:()=>{},d=ih(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,d,m);else if(this.parent.getWorkerSource){let g=a.type.split(".");this.parent.getWorkerSource(a.sourceMapId,g[0],d.source,d.scope)[g[1]](d,m)}else m(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var fy={workerUrl:"",workerClass:null,workerParams:void 0};let LM="mapboxgl_preloaded_worker_pool",Ax=(()=>{class c{constructor(){this.active={}}acquire(a,u=c.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<u;)this.workers.push(fy.workerClass!=null?new fy.workerClass:new self.Worker(fy.workerUrl,fy.workerParams));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.workers&&this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[LM]}numActive(){return Object.keys(this.active).length}}return c.workerCount=2,c})();class Um{constructor(i,a,u="Worker",m=Ax.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=qc();let d=this.workerPool.acquire(this.id,m);for(let g=0;g<d.length;g++){let b=new Um.Actor(d[g],a,this.id);b.name=`${u} ${g}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,a,u){El(this.actors,(m,d)=>{m.send(i,a,d)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let py,FM;function Rx(){return py||(py=new Ax),py}Um.Actor=lA;let NM=new oi(0,0,0);var kx=(c=>(c[c.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",c[c.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",c[c.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",c))(kx||{}),Lx=(c=>(c[c.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",c[c.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",c[c.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",c[c.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",c))(Lx||{}),my=(c=>(c[c.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",c[c.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",c[c.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",c[c.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",c[c.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",c))(my||{}),cA=(c=>(c[c.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",c[c.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",c[c.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",c))(cA||{}),Hm=(c=>(c[c.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",c[c.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",c[c.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",c[c.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",c[c.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",c[c.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",c))(Hm||{}),uA=(c=>(c[c.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",c[c.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",c[c.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",c))(uA||{});function t8(c,i,a){c===1&&i.icons.push(function(u,m){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;let{metadata:g}=d;if(g.content_area){let{content_area:b}=g;b.top==null&&(b.top=b.left),b.width==null&&(b.width=d.usvg_tree.width),b.height==null&&(b.height=b.width)}return g.stretch_x&&g.stretch_x.length&&hA(g,"x"),g.stretch_y&&g.stretch_y.length&&hA(g,"y"),d}(u.readFields(n8,{name:void 0},m))}(a,a.readVarint()+a.pos))}function hA(c,i){let a=[],u=c[`stretch_${i}`],m=null;for(let d=0;d<u.length;d++)m===null?m=a.length===0?u[0]:a[a.length-1][1]+u[d]:(a.push([m,m+u[d]]),m=null);c[`stretch_${i}_areas`]=a}function n8(c,i,a){c===1?i.name=a.readString():c===2?i.metadata=function(u,m){return u.readFields(i8,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)}(a,a.readVarint()+a.pos):c===3&&(i.usvg_tree=function(u,m){return u.readFields(s8,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)}(a,a.readVarint()+a.pos),i.data="usvg_tree")}function i8(c,i,a){c===1?i.stretch_x=a.readPackedVarint():c===2?i.stretch_y=a.readPackedVarint():c===3?i.content_area=function(u,m){return u.readFields(r8,{left:0},m)}(a,a.readVarint()+a.pos):c===4&&i.variables.push(function(u,m){return u.readFields(o8,{name:void 0},m)}(a,a.readVarint()+a.pos))}function r8(c,i,a){c===1?i.left=a.readVarint():c===2?i.width=a.readVarint():c===3?i.top=a.readVarint():c===4&&(i.height=a.readVarint())}function o8(c,i,a){c===1?i.name=a.readString():c===2&&(i.rgb_color=zx(a.readVarint()),i.value="rgb_color")}function s8(c,i,a){c===1?i.width=i.height=a.readVarint():c===2?i.height=a.readVarint():c===3?i.children.push(Fx(a,a.readVarint()+a.pos)):c===4?i.linear_gradients.push(function(u,m){return u.readFields(f8,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m)}(a,a.readVarint()+a.pos)):c===5?i.radial_gradients.push(function(u,m){return u.readFields(m8,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)}(a,a.readVarint()+a.pos)):c===7?i.clip_paths.push(function(u,m){return u.readFields(g8,{children:[]},m)}(a,a.readVarint()+a.pos)):c===8&&i.masks.push(function(u,m){let d=u.readFields(_8,{left:0,width:20,mask_type:1,children:[]},m);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(a,a.readVarint()+a.pos))}function Fx(c,i){return c.readFields(a8,{},i)}function a8(c,i,a){c===1?(i.group=function(u,m){return u.readFields(l8,{opacity:255,children:[]},m)}(a,a.readVarint()+a.pos),i.node="group"):c===2&&(i.path=function(u,m){return u.readFields(u8,{paint_order:1,commands:[],step:1,diffs:[],rule:1},m)}(a,a.readVarint()+a.pos),i.node="path")}function l8(c,i,a){c===1?i.transform=Nx(a,a.readVarint()+a.pos):c===2?i.opacity=a.readVarint():c===5?i.clip_path_idx=a.readVarint():c===6?i.mask_idx=a.readVarint():c===7&&i.children.push(Fx(a,a.readVarint()+a.pos))}function Nx(c,i){return c.readFields(c8,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function c8(c,i,a){c===1?i.sx=a.readFloat():c===2?i.ky=a.readFloat():c===3?i.kx=a.readFloat():c===4?i.sy=a.readFloat():c===5?i.tx=a.readFloat():c===6&&(i.ty=a.readFloat())}function u8(c,i,a){c===1?i.fill=function(u,m){return u.readFields(h8,{rgb_color:NM,paint:"rgb_color",opacity:255},m)}(a,a.readVarint()+a.pos):c===2?i.stroke=function(u,m){return u.readFields(d8,{rgb_color:NM,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)}(a,a.readVarint()+a.pos):c===3?i.paint_order=a.readVarint():c===5?a.readPackedVarint(i.commands):c===6?i.step=a.readFloat():c===7?a.readPackedSVarint(i.diffs):c===8&&(i.rule=a.readVarint())}function h8(c,i,a){c===1?(i.rgb_color=zx(a.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):c===5&&(i.opacity=a.readVarint())}function zx(c){return new oi((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function d8(c,i,a){c===1?(i.rgb_color=zx(a.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):c===5?a.readPackedFloat(i.dasharray):c===6?i.dashoffset=a.readFloat():c===7?i.miterlimit=a.readFloat():c===8?i.opacity=a.readVarint():c===9?i.width=a.readFloat():c===10?i.linecap=a.readVarint():c===11&&(i.linejoin=a.readVarint())}function f8(c,i,a){c===1?i.transform=Nx(a,a.readVarint()+a.pos):c===2?i.spread_method=a.readVarint():c===3?i.stops.push(dA(a,a.readVarint()+a.pos)):c===4?i.x1=a.readFloat():c===5?i.y1=a.readFloat():c===6?i.x2=a.readFloat():c===7&&(i.y2=a.readFloat())}function dA(c,i){return c.readFields(p8,{offset:0,opacity:255,rgb_color:NM},i)}function p8(c,i,a){c===1?i.offset=a.readFloat():c===2?i.opacity=a.readVarint():c===3&&(i.rgb_color=zx(a.readVarint()))}function m8(c,i,a){c===1?i.transform=Nx(a,a.readVarint()+a.pos):c===2?i.spread_method=a.readVarint():c===3?i.stops.push(dA(a,a.readVarint()+a.pos)):c===4?i.cx=a.readFloat():c===5?i.cy=a.readFloat():c===6?i.r=a.readFloat():c===7?i.fx=a.readFloat():c===8?i.fy=a.readFloat():c===9&&(i.fr=a.readFloat())}function g8(c,i,a){c===1?i.transform=Nx(a,a.readVarint()+a.pos):c===2?i.clip_path_idx=a.readVarint():c===3&&i.children.push(Fx(a,a.readVarint()+a.pos))}function _8(c,i,a){c===1?i.left=i.top=a.readFloat():c===2?i.width=i.height=a.readFloat():c===3?i.top=a.readFloat():c===4?i.height=a.readFloat():c===5?i.mask_type=a.readVarint():c===6?i.mask_idx=a.readVarint():c===7&&i.children.push(Fx(a,a.readVarint()+a.pos))}class y8{static calculate(i,a){let u=new Map,m=new Map;if(Object.keys(i).length===0)return u;a.forEach(d=>{m.set(d.name,d.rgb_color||new oi(0,0,0))});for(let[d,g]of Object.entries(i))m.has(d)?u.set(m.get(d).toStringPremultipliedAlpha(),g):console.warn(`Ignoring unknown image variable "${d}"`);return u}}function $m(c,i=255,a){let u=i/255,m=c.toStringPremultipliedAlpha(),d=a.has(m)?a.get(m).clone():c.clone();return d.a=u,d.toString()}function zM(c,i){if(!wt()){let a=document.createElement("canvas");return a.width=c,a.height=i,a}return new OffscreenCanvas(c,i)}function v8(c,i){let a=y8.calculate(i.params,c.metadata?c.metadata.variables:[]),u=c.usvg_tree,m=u.width,d=u.height,g=i.transform?i.transform:new DOMMatrix,b=Math.max(1,Math.round(m*g.a)),T=Math.max(1,Math.round(d*g.d)),O=new DOMMatrix([b/m,0,0,T/d,0,0]),x=zM(b,T).getContext("2d");return BM(x,O,u,u,a),x.getImageData(0,0,b,T)}function BM(c,i,a,u,m){for(let d of u.children)fA(c,i,a,d,m)}function fA(c,i,a,u,m){u.group?(c.save(),function(d,g,b,T,O){let x=T.mask_idx!=null?b.masks[T.mask_idx]:null,E=T.clip_path_idx!=null?b.clip_paths[T.clip_path_idx]:null;if(T.transform&&(g=gy(T.transform).preMultiplySelf(g)),!function(I,R,V){return I.opacity!==255||R||V}(T,E!=null,x!=null))return void BM(d,g,b,T,O);let P=zM(d.canvas.width,d.canvas.height),M=P.getContext("2d");E&&yA(M,g,b,E),BM(M,g,b,T,O),x&&vA(M,g,b,x,O),d.globalAlpha=T.opacity/255,d.drawImage(P,0,0)}(c,i,a,u.group,m),c.restore()):u.path&&(c.save(),function(d,g,b,T,O){let x=xA(T);d.setTransform(g),T.paint_order===cA.PAINT_ORDER_FILL_AND_STROKE?(pA(d,b,T,x,O),mA(d,b,T,x,O)):(mA(d,b,T,x,O),pA(d,b,T,x,O))}(c,i,a,u.path,m),c.restore())}function pA(c,i,a,u,m){let d=a.fill;if(!d)return;let g=d.opacity/255;switch(d.paint){case"rgb_color":c.fillStyle=$m(d.rgb_color,d.opacity,m);break;case"linear_gradient_idx":c.fillStyle=gA(c,i.linear_gradients[d.linear_gradient_idx],g,m);break;case"radial_gradient_idx":c.fillStyle=_A(c,i.radial_gradients[d.radial_gradient_idx],g,m)}let b;switch(a.rule){case kx.PATH_RULE_NON_ZERO:b="nonzero";break;case kx.PATH_RULE_EVEN_ODD:b="evenodd"}c.fill(u,b)}function mA(c,i,a,u,m){let d=a.stroke;if(!d)return;c.lineWidth=d.width,c.miterLimit=d.miterlimit,c.setLineDash(d.dasharray),c.lineDashOffset=d.dashoffset;let g=d.opacity/255;switch(d.paint){case"rgb_color":c.strokeStyle=$m(d.rgb_color,d.opacity,m);break;case"linear_gradient_idx":c.strokeStyle=gA(c,i.linear_gradients[d.linear_gradient_idx],g,m);break;case"radial_gradient_idx":c.strokeStyle=_A(c,i.radial_gradients[d.radial_gradient_idx],g,m)}switch(d.linejoin){case my.LINE_JOIN_MITER_CLIP:case my.LINE_JOIN_MITER:c.lineJoin="miter";break;case my.LINE_JOIN_ROUND:c.lineJoin="round";break;case my.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(d.linecap){case Lx.LINE_CAP_BUTT:c.lineCap="butt";break;case Lx.LINE_CAP_ROUND:c.lineCap="round";break;case Lx.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(u)}function gA(c,i,a,u){if(i.stops.length===1){let P=i.stops[0];return $m(P.rgb_color,P.opacity*a,u)}let m=gy(i.transform),{x1:d,y1:g,x2:b,y2:T}=i,O=m.transformPoint(new DOMPoint(d,g)),x=m.transformPoint(new DOMPoint(b,T)),E=c.createLinearGradient(O.x,O.y,x.x,x.y);for(let P of i.stops)E.addColorStop(P.offset,$m(P.rgb_color,P.opacity*a,u));return E}function _A(c,i,a,u){if(i.stops.length===1){let P=i.stops[0];return $m(P.rgb_color,P.opacity*a,u)}let m=gy(i.transform),{fx:d,fy:g,cx:b,cy:T}=i,O=m.transformPoint(new DOMPoint(d,g)),x=m.transformPoint(new DOMPoint(b,T)),E=c.createRadialGradient(O.x,O.y,0,x.x,x.y,i.r*((m.a+m.d)/2));for(let P of i.stops)E.addColorStop(P.offset,$m(P.rgb_color,P.opacity*a,u));return E}function yA(c,i,a,u){let m=gy(u.transform).preMultiplySelf(i),d=u.clip_path_idx!=null?a.clip_paths[u.clip_path_idx]:null;d&&yA(c,m,a,d);let g=new Path2D,b;function T(O,x){if(O.path){let E=O.path;g.addPath(xA(E),x),E.rule===kx.PATH_RULE_EVEN_ODD&&(b="evenodd")}else if(O.group){let E=O.group.transform?gy(O.group.transform).preMultiplySelf(x):x;for(let P of O.group.children)T(P,E)}}for(let O of u.children)T(O,m);c.clip(g,b)}function vA(c,i,a,u,m){if(u.children.length===0)return;let d=u.mask_idx!=null?a.masks[u.mask_idx]:null;d&&vA(c,i,a,d,m);let g=c.canvas.width,b=c.canvas.height,T=zM(g,b),O=T.getContext("2d"),x=u.width,E=u.height,P=u.left,M=u.top,I=new Path2D,R=new Path2D;R.rect(P,M,x,E),I.addPath(R,i),O.clip(I);for(let Z of u.children)fA(O,i,a,Z,m);let V=O.getImageData(0,0,g,b),j=V.data;if(u.mask_type===uA.MASK_TYPE_LUMINANCE)for(let Z=0;Z<j.length;Z+=4)j[Z+3]=j[Z+3]/255*(.2126*j[Z]+.7152*j[Z+1]+.0722*j[Z+2]);O.putImageData(V,0,0),c.globalCompositeOperation="destination-in",c.drawImage(T,0,0)}function gy(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function xA(c){let i=new Path2D,a=c.step,u=c.diffs[0]*a,m=c.diffs[1]*a;i.moveTo(u,m);for(let d=0,g=2;d<c.commands.length;d++)switch(c.commands[d]){case Hm.PATH_COMMAND_MOVE:u+=c.diffs[g++]*a,m+=c.diffs[g++]*a,i.moveTo(u,m);break;case Hm.PATH_COMMAND_LINE:u+=c.diffs[g++]*a,m+=c.diffs[g++]*a,i.lineTo(u,m);break;case Hm.PATH_COMMAND_QUAD:{let b=u+c.diffs[g++]*a,T=m+c.diffs[g++]*a;u=b+c.diffs[g++]*a,m=T+c.diffs[g++]*a,i.quadraticCurveTo(b,T,u,m);break}case Hm.PATH_COMMAND_CUBIC:{let b=u+c.diffs[g++]*a,T=m+c.diffs[g++]*a,O=b+c.diffs[g++]*a,x=T+c.diffs[g++]*a;u=O+c.diffs[g++]*a,m=x+c.diffs[g++]*a,i.bezierCurveTo(b,T,O,x,u,m);break}case Hm.PATH_COMMAND_CLOSE:i.closePath()}return i}class VM{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;let a=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,a),a}put(i,a){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,a)}delete(i){this.cache.delete(i)}}class jM{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new gs(i,i.data)}getFromCache(i,a,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new VM(150)),this.cacheMap.get(u).get(Es(i.serialize(),a))}setInCache(i,a,u,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new VM(150));let d=this.cacheDependenciesMap.get(m);d.get(Es(i.id,u))||d.set(Es(i.id,u),new Set);let g=this.cacheMap.get(m),b=i.serialize();d.get(Es(i.id,u)).add(b),g.put(Es(i.serialize(),u),a)}removeImagesFromCacheByIds(i,a,u=""){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;let m=this.cacheMap.get(u),d=this.cacheDependenciesMap.get(u);for(let g of i)if(d.has(Es(g,a))){for(let b of d.get(Es(g,a)))m.delete(b);d.delete(Es(g,a))}}rasterize(i,a,u,m,d=v8){let g=this.getFromCache(i,u,m);if(g)return g.clone();let b=d(a.icon,i.options),T=jM._getImage(b);return this.setInCache(i,T,u,m),T.clone()}}class bA{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){let u=this.toIdx(i,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function wA(c,i,a,u){let m=0,d=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(a[g]<c[g]||a[g]>i[g])return null}else{let b=1/u[g],T=(c[g]-a[g])*b,O=(i[g]-a[g])*b;if(T>O){let x=T;T=O,O=x}if(T>m&&(m=T),O<d&&(d=O),m>d)return null}return m}function CA(c,i,a,u,m,d,g,b,T,O,x){let E=u-c,P=m-i,M=d-a,I=g-c,R=b-i,V=T-a,j=x[1]*V-x[2]*R,Z=x[2]*I-x[0]*V,W=x[0]*R-x[1]*I,G=E*j+P*Z+M*W;if(Math.abs(G)<1e-15)return null;let X=1/G,J=O[0]-c,te=O[1]-i,fe=O[2]-a,de=(J*j+te*Z+fe*W)*X;if(de<0||de>1)return null;let he=te*M-fe*P,Ce=fe*E-J*M,me=J*P-te*E,Me=(x[0]*he+x[1]*Ce+x[2]*me)*X;return Me<0||de+Me>1?null:(I*he+R*Ce+V*me)*X}function MA(c,i,a){return(c-i)/(a-i)}function TA(c,i,a,u,m,d,g,b,T){let O=1<<a,x=d-u,E=g-m,P=(c+1)/O*x+u,M=(i+0)/O*E+m,I=(i+1)/O*E+m;b[0]=(c+0)/O*x+u,b[1]=M,T[0]=P,T[1]=I}class EA{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let a=function(d){let g=Math.ceil(Math.log2(d.dim/8)),b=[],T=Math.ceil(Math.pow(2,g)),O=1/T,x=(M,I,R,V,j)=>{let Z=V?1:0,W=(M+1)*R-Z,G=I*R,X=(I+1)*R-Z;j[0]=M*R,j[1]=G,j[2]=W,j[3]=X},E=new bA(T),P=[];for(let M=0;M<T*T;M++){x(M%T,Math.floor(M/T),O,!1,P);let I=Cd(P[0],P[1],d),R=Cd(P[2],P[1],d),V=Cd(P[2],P[3],d),j=Cd(P[0],P[3],d);E.minimums.push(Math.min(I,R,V,j)),E.maximums.push(Math.max(I,R,V,j)),E.leaves.push(1)}for(b.push(E),T/=2;T>=1;T/=2){let M=b[b.length-1];E=new bA(T);for(let I=0;I<T*T;I++){x(I%T,Math.floor(I/T),2,!0,P);let R=M.getElevation(P[0],P[1]),V=M.getElevation(P[2],P[1]),j=M.getElevation(P[2],P[3]),Z=M.getElevation(P[0],P[3]),W=M.isLeaf(P[0],P[1]),G=M.isLeaf(P[2],P[1]),X=M.isLeaf(P[2],P[3]),J=M.isLeaf(P[0],P[3]),te=Math.min(R.min,V.min,j.min,Z.min),fe=Math.max(R.max,V.max,j.max,Z.max),de=W&&G&&X&&J;E.maximums.push(fe),E.minimums.push(te),E.leaves.push(fe-te<=5&&de?1:0)}b.push(E)}return b}(this.dem),u=a.length-1,m=a[u];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(i,a,u,m,d,g,b=1){return wA([i,a,-100],[u,m,this.maximums[0]*b],d,g)}raycast(i,a,u,m,d,g,b=1){if(!this.nodeCount)return null;let T=this.raycastRoot(i,a,u,m,d,g,b);if(T==null)return null;let O=[],x=[],E=[],P=[],M=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;M.length>0;){let{idx:I,t:R,nodex:V,nodey:j,depth:Z}=M.pop();if(this.leaves[I]){TA(V,j,Z,i,a,u,m,E,P);let G=1<<Z,X=(V+0)/G,J=(V+1)/G,te=(j+0)/G,fe=(j+1)/G,de=Cd(X,te,this.dem)*b,he=Cd(J,te,this.dem)*b,Ce=Cd(J,fe,this.dem)*b,me=Cd(X,fe,this.dem)*b,Me=CA(E[0],E[1],de,P[0],E[1],he,P[0],P[1],Ce,d,g),Oe=CA(P[0],P[1],Ce,E[0],P[1],me,E[0],E[1],de,d,g),Pe=Math.min(Me!==null?Me:Number.MAX_VALUE,Oe!==null?Oe:Number.MAX_VALUE);if(Pe!==Number.MAX_VALUE)return Pe;{let ke=Ee.vec3.scaleAndAdd([],d,g,R);if(SA(de,he,me,Ce,MA(ke[0],E[0],P[0]),MA(ke[1],E[1],P[1]))>=ke[2])return R}continue}let W=0;for(let G=0;G<this._siblingOffset.length;G++){TA((V<<1)+this._siblingOffset[G][0],(j<<1)+this._siblingOffset[G][1],Z+1,i,a,u,m,E,P),E[2]=-100,P[2]=this.maximums[this.childOffsets[I]+G]*b;let X=wA(E,P,d,g);if(X!=null){let J=X;O[G]=J;let te=!1;for(let fe=0;fe<W&&!te;fe++)J>=O[x[fe]]&&(x.splice(fe,0,G),te=!0);te||(x[W]=G),W++}}for(let G=0;G<W;G++){let X=x[G];M.push({idx:this.childOffsets[I]+X,t:O[X],nodex:(V<<1)+this._siblingOffset[X][0],nodey:(j<<1)+this._siblingOffset[X][1],depth:Z+1})}}return null}_addNode(i,a,u){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,u,m,d){if(i[m].isLeaf(a,u)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);let g=m-1,b=i[g],T=0,O=0;for(let x=0;x<this._siblingOffset.length;x++){let E=2*a+this._siblingOffset[x][0],P=2*u+this._siblingOffset[x][1],M=b.getElevation(E,P),I=b.isLeaf(E,P),R=this._addNode(M.min,M.max,I);I&&(T|=1<<x),O||(O=R)}for(let x=0;x<this._siblingOffset.length;x++)T&1<<x||this._construct(i,2*a+this._siblingOffset[x][0],2*u+this._siblingOffset[x][1],g,O+x)}}function SA(c,i,a,u,m,d){return gn(gn(c,a,d),gn(i,u,d),m)}function Cd(c,i,a){let u=a.dim,m=Rn(c*u-.5,0,u-1),d=Rn(i*u-.5,0,u-1),g=Math.floor(m),b=Math.floor(d),T=Math.min(g+1,u-1),O=Math.min(b+1,u-1);return SA(a.get(g,b),a.get(T,b),a.get(g,O),a.get(T,O),m-g,d-b)}let x8={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function b8(c,i,a){return(256*c*256+256*i+a)/10-1e4}function w8(c,i,a){return 256*c+i+a/256-32768}class Bx{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,u,m=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Wn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;let d=this.dim=a.height-2,g=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let T=0;T<d;T++)g[this._idx(-1,T)]=g[this._idx(0,T)],g[this._idx(d,T)]=g[this._idx(d-1,T)],g[this._idx(T,-1)]=g[this._idx(T,0)],g[this._idx(T,d)]=g[this._idx(T,d-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(d,-1)]=g[this._idx(d-1,0)],g[this._idx(-1,d)]=g[this._idx(0,d-1)],g[this._idx(d,d)]=g[this._idx(d-1,d-1)]}let b=u==="terrarium"?w8:b8;for(let T=0;T<g.length;++T){let O=4*T;this.floatView[T]=b(this.pixels[O],this.pixels[O+1],this.pixels[O+2])}this._timestamp=Vt.now()}_buildQuadTree(){this._tree=new EA(this)}get(i,a,u=!1){u&&(i=Rn(i,-1,this.dim),a=Rn(a,-1,this.dim));let m=this._idx(i,a);return this.floatView[m]}set(i,a,u){let m=this._idx(i,a),d=this.floatView[m];return this.floatView[m]=u,u-d}static getUnpackVector(i){return x8[i]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}static pack(i,a){let u=[0,0,0,0],m=Bx.getUnpackVector(a),d=Math.floor((i+m[3])/m[2]);return u[2]=d%256,d=Math.floor(d/256),u[1]=d%256,d=Math.floor(d/256),u[0]=d,u}getPixels(){return new qP({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let m=a*this.dim,d=a*this.dim+this.dim,g=u*this.dim,b=u*this.dim+this.dim;switch(a){case-1:m=d-1;break;case 1:d=m+1}switch(u){case-1:g=b-1;break;case 1:b=g+1}let T=-a*this.dim,O=-u*this.dim;for(let x=g;x<b;x++)for(let E=m;E<d;E++){let P=4*this._idx(E,x),M=4*this._idx(E+T,x+O);this.pixels[P+0]=i.pixels[M+0],this.pixels[P+1]=i.pixels[M+1],this.pixels[P+2]=i.pixels[M+2],this.pixels[P+3]=i.pixels[M+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function C8(c,i,a){c===1?i.headerLength=a.readFixed32():c===2?i.x=a.readVarint():c===3?i.y=a.readVarint():c===4?i.z=a.readVarint():c===5&&i.layers.push(function(u,m){return u.readFields(I8,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)}(a,a.readVarint()+a.pos))}function M8(c,i,a){c===1?(i.delta_filter=function(u,m){return u.readFields(T8,{blockSize:0},m)}(a,a.readVarint()+a.pos),i.filter="delta_filter"):c===2?(a.readVarint(),i.filter="zigzag_filter"):c===3?(a.readVarint(),i.filter="bitshuffle_filter"):c===4&&(a.readVarint(),i.filter="byteshuffle_filter")}function T8(c,i,a){c===1&&(i.blockSize=a.readVarint())}function E8(c,i,a){c===1?(a.readVarint(),i.codec="gzip_data"):c===2?(a.readVarint(),i.codec="jpeg_image"):c===3?(a.readVarint(),i.codec="webp_image"):c===4&&(a.readVarint(),i.codec="png_image")}function S8(c,i,a){let u=0,m=0;c===1?i.firstByte=a.readFixed64():c===2?i.lastByte=a.readFixed64():c===3?i.filters.push(function(d,g){return d.readFields(M8,{},g)}(a,a.readVarint()+a.pos)):c===4?i.codec=function(d,g){return d.readFields(E8,{},g)}(a,a.readVarint()+a.pos):c===5?m=a.readFloat():c===6?u=a.readFloat():c===7?i.bands.push(a.readString()):c===8?i.offset=a.readDouble():c===9&&(i.scale=a.readDouble()),i.offset===0&&(i.offset=m),i.scale===0&&(i.scale=u)}function I8(c,i,a){c===1?i.version=a.readVarint():c===2?i.name=a.readString():c===3?i.units=a.readString():c===4?i.tileSize=a.readVarint():c===5?i.buffer=a.readVarint():c===6?i.pixelFormat=a.readVarint():c===7&&i.dataIndex.push(function(u,m){return u.readFields(S8,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)}(a,a.readVarint()+a.pos))}function P8(c,i,a){if(c===2)(function(u,m,d){u.readFields(D8,d,m)})(a,a.readVarint()+a.pos,i);else if(c===3)throw new Error("Not implemented")}function D8(c,i,a){if(c===1){let u=0,m=a.readVarint()+a.pos;for(;a.pos<m;)i[u++]=a.readVarint()}}function O8(c,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let a=i[3];for(let u=2;u>=1;u--){let m=u===1?1:0,d=u===2?1:0;for(let g=0;g<i[0];g++){let b=i[1]*g;for(let T=m;T<i[1];T++){let O=i[2]*(T+b);for(let x=d;x<i[2];x++){let E=i[3]*(x+O);for(let P=0;P<i[3];P++){let M=E+P;c[M]+=c[M-a]}}}}a*=i[u]}return c}function A8(c){for(let i=0,a=c.length;i<a;i++)c[i]=c[i]>>>1^-(1&c[i]);return c}function R8(c,i){switch(i){case"uint32":return c;case"uint16":for(let a=0;a<c.length;a+=2){let u=c[a],m=c[a+1];c[a]=(240&u)>>4|(61440&u)>>8|(240&m)<<4|61440&m,c[a+1]=15&u|(3840&u)>>4|(15&m)<<8|(3840&m)<<4}return c;case"uint8":for(let a=0;a<c.length;a+=4){let u=c[a],m=c[a+1],d=c[a+2],g=c[a+3];c[a+0]=(192&u)>>6|(192&m)>>4|(192&d)>>2|192&g,c[a+1]=(48&u)>>4|(48&m)>>2|48&d|(48&g)<<2,c[a+2]=(12&u)>>2|12&m|(12&d)<<2|(12&g)<<4,c[a+3]=3&u|(3&m)<<2|(3&d)<<4|(3&g)<<6}return c;default:throw new Error(`Invalid pixel format, "${i}"`)}}Xt(Bx,"DEMData"),Xt(EA,"DemMinMaxQuadTree",{omit:["dem"]});var ml=Uint8Array,_y=Uint16Array,k8=Int32Array,IA=new ml([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),PA=new ml([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),L8=new ml([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DA=function(c,i){for(var a=new _y(31),u=0;u<31;++u)a[u]=i+=1<<c[u-1];var m=new k8(a[30]);for(u=1;u<30;++u)for(var d=a[u];d<a[u+1];++d)m[d]=d-a[u]<<5|u;return{b:a,r:m}},OA=DA(IA,2),AA=OA.b,F8=OA.r;AA[28]=258,F8[258]=28;for(var N8=DA(PA,0).b,RA=new _y(32768),co=0;co<32768;++co){var Gm=(43690&co)>>1|(21845&co)<<1;RA[co]=((65280&(Gm=(61680&(Gm=(52428&Gm)>>2|(13107&Gm)<<2))>>4|(3855&Gm)<<4))>>8|(255&Gm)<<8)>>1}var yy=function(c,i,a){for(var u=c.length,m=0,d=new _y(i);m<u;++m)c[m]&&++d[c[m]-1];var g,b=new _y(i);for(m=1;m<i;++m)b[m]=b[m-1]+d[m-1]<<1;g=new _y(1<<i);var T=15-i;for(m=0;m<u;++m)if(c[m])for(var O=m<<4|c[m],x=i-c[m],E=b[c[m]-1]++<<x,P=E|(1<<x)-1;E<=P;++E)g[RA[E]>>T]=O;return g},vy=new ml(288);for(co=0;co<144;++co)vy[co]=8;for(co=144;co<256;++co)vy[co]=9;for(co=256;co<280;++co)vy[co]=7;for(co=280;co<288;++co)vy[co]=8;var kA=new ml(32);for(co=0;co<32;++co)kA[co]=5;var z8=yy(vy,9),B8=yy(kA,5),UM=function(c){for(var i=c[0],a=1;a<c.length;++a)c[a]>i&&(i=c[a]);return i},Sc=function(c,i,a){var u=i/8|0;return(c[u]|c[u+1]<<8)>>(7&i)&a},HM=function(c,i){var a=i/8|0;return(c[a]|c[a+1]<<8|c[a+2]<<16)>>(7&i)},V8=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ic=function(c,i,a){var u=new Error(i||V8[c]);if(u.code=c,Error.captureStackTrace&&Error.captureStackTrace(u,Ic),!a)throw u;return u},j8=new ml(0),U8=typeof TextDecoder<"u"&&new TextDecoder;try{U8.decode(j8,{stream:!0})}catch{}let H8={gzip_data:"gzip"};class jl extends Error{constructor(i){super(i),this.name="MRTError"}}let $8={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},LA={uint32:1,uint16:2,uint8:4},G8={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},$M;class GM{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){let a=this.layers[i];if(!a)throw new jl(`Layer '${i}' not found`);return a}getHeaderLength(i){let a=new Uint8Array(i),u=new DataView(i);if(a[0]!==13)throw new jl("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(i){let a=new Uint8Array(i),u=this.getHeaderLength(i);if(a.length<u)throw new jl(`Expected header with length >= ${u} but got buffer of length ${a.length}`);let m=function(d,g){return d.readFields(C8,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new $M(a.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new jl(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(let d of m.layers)this.layers[d.name]=new q8(d,{cacheSize:this._cacheSize});return this}createDecodingTask(i){let a=[],u=this.getLayer(i.layerName);for(let m of i.blockIndices){let d=u.dataIndex[m],g=d.firstByte-i.firstByte,b=d.lastByte-i.firstByte;if(u._blocksInProgress.has(m))continue;let T={layerName:u.name,firstByte:g,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:m,blockShape:[d.bands.length].concat(u.bandShape),buffer:u.buffer,codec:d.codec.codec,filters:d.filters.map(O=>O.filter)};u._blocksInProgress.add(m),a.push(T)}return new FA(a,()=>{a.forEach(m=>u._blocksInProgress.delete(m.blockIndex))},(m,d)=>{if(a.forEach(g=>u._blocksInProgress.delete(g.blockIndex)),m)throw m;d.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class q8{constructor({version:i,name:a,units:u,tileSize:m,pixelFormat:d,buffer:g,dataIndex:b},T){if(this.version=i,this.version!==1)throw new jl(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=a,this.units=u,this.tileSize=m,this.buffer=g,this.pixelFormat=$8[d],this.dataIndex=b,this.bandShape=[m+2*g,m+2*g,LA[this.pixelFormat]],this._decodedBlocks=new VM(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return LA[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){let a=i.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,i.data)}getBlockForBand(i){let a=0;switch(typeof i){case"string":for(let[u,m]of this.dataIndex.entries()){for(let[d,g]of m.bands.entries())if(g===i)return{bandIndex:a+d,blockIndex:u,blockBandIndex:d};a+=m.bands.length}break;case"number":for(let[u,m]of this.dataIndex.entries()){if(i>=a&&i<a+m.bands.length)return{bandIndex:i,blockIndex:u,blockBandIndex:i-a};a+=m.bands.length}break;default:throw new jl(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}throw new jl(`Band not found: ${JSON.stringify(i)}`)}getDataRange(i){let a=1/0,u=-1/0,m=[],d=new Set;for(let g of i){let{blockIndex:b}=this.getBlockForBand(g);if(b<0)throw new jl(`Invalid band: ${JSON.stringify(g)}`);let T=this.dataIndex[b];m.includes(b)||m.push(b),d.add(b),a=Math.min(a,T.firstByte),u=Math.max(u,T.lastByte)}if(d.size>this.cacheSize)throw new jl(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:u,blockIndices:m}}hasBand(i){let{blockIndex:a}=this.getBlockForBand(i);return a>=0}hasDataForBand(i){let{blockIndex:a}=this.getBlockForBand(i);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(i){let{blockIndex:a,blockBandIndex:u}=this.getBlockForBand(i),m=this._decodedBlocks.get(a.toString());if(!m)throw new jl(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);let d=this.dataIndex[a],g=this.bandShape.reduce((O,x)=>O*x,1),b=u*g,T=m.subarray(b,b+g);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}GM.setPbf=function(c){$M=c};class FA{constructor(i,a,u){this.tasks=i,this._onCancel=a,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,a){this._finalized||(this._onComplete(i,a),this._finalized=!0)}}GM.performDecoding=function(c,i){let a=new Uint8Array(c);return Promise.all(i.tasks.map(u=>{let{layerName:m,firstByte:d,lastByte:g,pixelFormat:b,blockShape:T,blockIndex:O,filters:x,codec:E}=u,P=a.subarray(d,g+1),M=new Uint32Array(T[0]*T[1]*T[2]),I;if(E!=="gzip_data")throw new jl(`Unhandled codec: ${E}`);return I=function(R,V){if(!globalThis.DecompressionStream&&V==="gzip_data")return Promise.resolve(((G=function(te){te[0]==31&&te[1]==139&&te[2]==8||Ic(6,"invalid gzip data");var fe=te[3],de=10;4&fe&&(de+=2+(te[10]|te[11]<<8));for(var he=(fe>>3&1)+(fe>>4&1);he>0;he-=!te[de++]);return de+(2&fe)}(W=R))+8>W.length&&Ic(6,"invalid gzip data"),function(te,fe,de,he){var Ce=te.length;if(!Ce||fe.f&&!fe.l)return de||new ml(0);var me=!de,Me=me||fe.i!=2,Oe=fe.i;me&&(de=new ml(3*Ce));var Pe,ke,Ne=function(dh){var Ed=de.length;if(dh>Ed){var Sd=new ml(Math.max(2*Ed,dh));Sd.set(de),de=Sd}},Be=fe.f||0,Le=fe.p||0,it=fe.b||0,vt=fe.l,rt=fe.d,Rt=fe.m,Pt=fe.n,zt=8*Ce;do{if(!vt){Be=Sc(te,Le,1);var ct=Sc(te,Le+1,3);if(Le+=3,!ct){var tn=te[(Pn=4+((Le+7)/8|0))-4]|te[Pn-3]<<8,kt=Pn+tn;if(kt>Ce){Oe&&Ic(0);break}Me&&Ne(it+tn),de.set(te.subarray(Pn,kt),it),fe.b=it+=tn,fe.p=Le=8*kt,fe.f=Be;continue}if(ct==1)vt=z8,rt=B8,Rt=9,Pt=5;else if(ct==2){var Jt=Sc(te,Le,31)+257,mn=Sc(te,Le+10,15)+4,zn=Jt+Sc(te,Le+5,31)+1;Le+=14;for(var Vn=new ml(zn),Jn=new ml(19),jn=0;jn<mn;++jn)Jn[L8[jn]]=Sc(te,Le+3*jn,7);Le+=3*mn;var ni=UM(Jn),Ki=(1<<ni)-1,Vi=yy(Jn,ni);for(jn=0;jn<zn;){var Pn,ji=Vi[Sc(te,Le,Ki)];if(Le+=15&ji,(Pn=ji>>4)<16)Vn[jn++]=Pn;else{var Li=0,Ji=0;for(Pn==16?(Ji=3+Sc(te,Le,3),Le+=2,Li=Vn[jn-1]):Pn==17?(Ji=3+Sc(te,Le,7),Le+=3):Pn==18&&(Ji=11+Sc(te,Le,127),Le+=7);Ji--;)Vn[jn++]=Li}}var uo=Vn.subarray(0,Jt),ho=Vn.subarray(Jt);Rt=UM(uo),Pt=UM(ho),vt=yy(uo,Rt),rt=yy(ho,Pt)}else Ic(1);if(Le>zt){Oe&&Ic(0);break}}Me&&Ne(it+131072);for(var Yr=(1<<Rt)-1,Js=(1<<Pt)-1,vr=Le;;vr=Le){var Cr=(Li=vt[HM(te,Le)&Yr])>>4;if((Le+=15&Li)>zt){Oe&&Ic(0);break}if(Li||Ic(2),Cr<256)de[it++]=Cr;else{if(Cr==256){vr=Le,vt=null;break}var Ps=Cr-254;Cr>264&&(Ps=Sc(te,Le,(1<<(Io=IA[jn=Cr-257]))-1)+AA[jn],Le+=Io);var fo=rt[HM(te,Le)&Js],pa=fo>>4;if(fo||Ic(3),Le+=15&fo,ho=N8[pa],pa>3){var Io=PA[pa];ho+=HM(te,Le)&(1<<Io)-1,Le+=Io}if(Le>zt){Oe&&Ic(0);break}Me&&Ne(it+131072);var _u=it+Ps;if(it<ho){var Md=0-ho,Td=Math.min(ho,_u);for(Md+it<0&&Ic(3);it<Td;++it)de[it]=(void 0)[Md+it]}for(;it<_u;++it)de[it]=de[it-ho]}}fe.l=vt,fe.p=vr,fe.b=it,fe.f=Be,vt&&(Be=1,fe.m=Rt,fe.d=rt,fe.n=Pt)}while(!Be);return it!=de.length&&me?(Pe=de,((ke=it)==null||ke>Pe.length)&&(ke=Pe.length),new ml(Pe.subarray(0,ke))):de.subarray(0,it)}(W.subarray(G,-8),{i:2},new ml(((j=W)[(Z=j.length)-4]|j[Z-3]<<8|j[Z-2]<<16|j[Z-1]<<24)>>>0))));var j,Z,W,G;let X=H8[V];if(!X)throw new Error(`Unhandled codec: ${V}`);let J=new globalThis.DecompressionStream(X);return new Response(new Blob([R]).stream().pipeThrough(J)).arrayBuffer().then(te=>new Uint8Array(te))}(P,E).then(R=>(function(V,j){V.readFields(P8,j)}(new $M(R),M),new G8[b](M.buffer))),I.then(R=>{for(let V=x.length-1;V>=0;V--)switch(x[V]){case"delta_filter":O8(R,T);break;case"zigzag_filter":A8(R);break;case"bitshuffle_filter":R8(R,b);break;default:throw new jl(`Unhandled filter "${x[V]}"`)}return{layerName:m,blockIndex:O,data:R}}).catch(R=>{throw R})}))},Xt(FA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let xy,qM,Pc,qm,ZM,Zm=null;function NA(){return Sl()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:qM||_e.DRACO_URL}function zA(){if(Sl()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(qm)return qm;let c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return qm=WebAssembly.validate(c)?_e.MESHOPT_SIMD_URL:_e.MESHOPT_URL,qm}let Vx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Z8={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},by={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function BA(c,i,a){let u=a.json.bufferViews.length,m=a.buffers.length;i.bufferView=u,a.json.bufferViews[u]={buffer:m,byteLength:c.byteLength},a.buffers[m]=c}let WM="KHR_draco_mesh_compression";function W8(c,i){let a=c.extensions&&c.extensions[WM];if(!a)return;let u=new Pc.Decoder,m=HA(i,a.bufferView),d=new Pc.Mesh;if(!u.DecodeArrayToMesh(m,m.byteLength,d))throw new Error("Failed to decode Draco mesh");let g=i.json.accessors[c.indices],b=Vx[g.componentType],T=g.count*b.BYTES_PER_ELEMENT,O=Pc._malloc(T);b===Uint16Array?u.GetTrianglesUInt16Array(d,T,O):u.GetTrianglesUInt32Array(d,T,O),BA(Pc.memory.buffer.slice(O,O+T),g,i),Pc._free(O);for(let x of Object.keys(a.attributes)){let E=u.GetAttributeByUniqueId(d,a.attributes[x]),P=i.json.accessors[c.attributes[x]],M=Z8[P.componentType],I=P.count*by[P.type]*Vx[P.componentType].BYTES_PER_ELEMENT,R=Pc._malloc(I);u.GetAttributeDataArrayForAllPoints(d,E,Pc[M],I,R),BA(Pc.memory.buffer.slice(R,R+I),P,i),Pc._free(R)}u.destroy(),d.destroy(),delete c.extensions[WM]}let jx="EXT_meshopt_compression";function Y8(c,i){if(!c.extensions||!c.extensions[jx])return;let a=c.extensions[jx],u=new Uint8Array(i.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),m=new Uint8Array(a.count*a.byteStride);ZM.decodeGltfBuffer(m,a.count,a.byteStride,u,a.mode,a.filter),c.buffer=i.buffers.length,c.byteOffset=0,i.buffers[c.buffer]=m.buffer,delete c.extensions[jx]}let VA=1179937895,jA=new TextDecoder("utf8");function UA(c,i){return new URL(c,i).href}function X8(c,i,a,u){return fetch(UA(c.uri,u)).then(m=>m.arrayBuffer()).then(m=>{i.buffers[a]=m})}function HA(c,i){let a=c.json.bufferViews[i];return new Uint8Array(c.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function K8(c,i,a,u){if(c.uri){let m=UA(c.uri,u);return fetch(m).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{i.images[a]=d})}if(c.bufferView!==void 0){let m=HA(i,c.bufferView),d=new Blob([m],{type:c.mimeType});return createImageBitmap(d).then(g=>{i.images[a]=g})}}function $A(c,i=0,a){let u={json:null,images:[],buffers:[]};if(new Uint32Array(c,i,1)[0]===VA){let x=new Uint32Array(c,i),E=2,P=(x[E++]>>2)-3,M=x[E++]>>2;if(E++,u.json=JSON.parse(jA.decode(x.subarray(E,E+M))),E+=M,E<P){let I=x[E++];E++;let R=i+(E<<2);u.buffers[0]=c.slice(R,R+I)}}else u.json=JSON.parse(jA.decode(new Uint8Array(c,i)));let{buffers:m,images:d,meshes:g,extensionsUsed:b,bufferViews:T}=u.json,O=Promise.resolve();if(m){let x=[];for(let E=0;E<m.length;E++){let P=m[E];P.uri?x.push(X8(P,u,E,a)):u.buffers[E]||(u.buffers[E]=null)}O=Promise.all(x)}return O.then(()=>{let x=[],E=b&&b.includes(WM),P=b&&b.includes(jx);if(E&&x.push(function(){if(!Pc)return xy??(xy=function(M){let I,R=null;function V(){I=new Uint8Array(R.buffer)}function j(){throw new Error("Unexpected Draco error.")}let Z={a:{a:j,d:function(W,G,X){return I.copyWithin(W,G,G+X)},c:function(W){let G=I.length,X=Math.max(W>>>0,Math.ceil(1.2*G)),J=Math.ceil((X-G)/65536);try{return R.grow(J),V(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(M,Z):M.then(W=>W.arrayBuffer()).then(W=>WebAssembly.instantiate(W,Z))).then(W=>{let{Rb:G,Qb:X,P:J,T:te,X:fe,Ja:de,La:he,Qa:Ce,Va:me,Wa:Me,eb:Oe,jb:Pe,f:ke,e:Ne,yb:Be,zb:Le,Ab:it,Bb:vt,Db:rt,Gb:Rt}=W.instance.exports;R=Ne;let Pt=(()=>{let zt=0,ct=0,tn=0,kt=0;return Jt=>{tn&&(G(kt),G(zt),ct+=tn,tn=zt=0),zt||(ct+=128,zt=X(ct));let mn=Jt.length+7&-8,zn=zt;mn>=ct&&(tn=mn,zn=kt=X(mn));for(let Vn=0;Vn<Jt.length;Vn++)I[zn+Vn]=Jt[Vn];return zn}})();return V(),ke(),{memory:Ne,_free:G,_malloc:X,Mesh:class{constructor(){this.ptr=J()}destroy(){te(this.ptr)}},Decoder:class{constructor(){this.ptr=de()}destroy(){Pe(this.ptr)}DecodeArrayToMesh(zt,ct,tn){let kt=Pt(zt),Jt=he(this.ptr,kt,ct,tn.ptr);return!!fe(Jt)}GetAttributeByUniqueId(zt,ct){return{ptr:Ce(this.ptr,zt.ptr,ct)}}GetTrianglesUInt16Array(zt,ct,tn){me(this.ptr,zt.ptr,ct,tn)}GetTrianglesUInt32Array(zt,ct,tn){Me(this.ptr,zt.ptr,ct,tn)}GetAttributeDataArrayForAllPoints(zt,ct,tn,kt,Jt){Oe(this.ptr,zt.ptr,ct.ptr,tn,kt,Jt)}},DT_INT8:Be(),DT_UINT8:Le(),DT_INT16:it(),DT_UINT16:vt(),DT_UINT32:rt(),DT_FLOAT32:Rt()}})}(fetch(NA())),xy.then(M=>{Pc=M,xy=void 0}))}()),P&&x.push(function(){if(ZM)return;let M=function(I){let R,V=WebAssembly.instantiateStreaming(I,{}).then(W=>{R=W.instance,R.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:V,supported:!0,decodeGltfBuffer(W,G,X,J,te,fe){(function(de,he,Ce,me,Me,Oe,Pe){let ke=de.exports.sbrk,Ne=me+3&-4,Be=ke(Ne*Me),Le=ke(Oe.length),it=new Uint8Array(de.exports.memory.buffer);it.set(Oe,Le);let vt=he(Be,me,Me,Le,Oe.length);if(vt===0&&Pe&&Pe(Be,Ne,Me),Ce.set(it.subarray(Be,Be+me*Me)),ke(Be-ke(0)),vt!==0)throw new Error(`Malformed buffer data: ${vt}`)})(R,R.exports[Z[te]],W,G,X,J,R.exports[j[fe]])}}}(fetch(zA()));return M.ready.then(()=>{ZM=M})}()),d)for(let M=0;M<d.length;M++)x.push(K8(d[M],u,M,a));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(E&&g)for(let{primitives:M}of g)for(let I of M)W8(I,u);if(P&&g&&T)for(let M of T)Y8(M,u);return u})})}function Kf(c,i){let a=c.json.bufferViews[i.bufferView],u=Vx[i.componentType];return new u(c.buffers[a.buffer],(i.byteOffset||0)+(a.byteOffset||0),i.count*(a.byteStride&&a.byteStride!==by[i.type]*u.BYTES_PER_ELEMENT?a.byteStride/u.BYTES_PER_ELEMENT:by[i.type]))}function YM(c,i,a,u){let m=Vx[i.componentType],d=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),g=c.json.bufferViews[i.bufferView],b=g.byteStride?g.byteStride/m.BYTES_PER_ELEMENT:by[i.type],T=a.float32,O=T.length/a.capacity;for(let x=0,E=0;x<i.count*b;x+=b,E+=O)for(let P=0;P<O;P++)T[E+P]=u[x+P]*d;a._trim()}function J8(c,i,a){let u=c.indices,m=c.attributes,d={};d.indexArray=new qo;let g=i.json.accessors[u],b=g.count/3;d.indexArray.reserve(b);let T=Kf(i,g);for(let P=0;P<b;P++)d.indexArray.emplaceBack(T[3*P],T[3*P+1],T[3*P+2]);d.indexArray._trim(),d.vertexArray=new lu;let O=i.json.accessors[m.POSITION];d.vertexArray.reserve(O.count);let x=Kf(i,O);for(let P=0;P<O.count;P++)d.vertexArray.emplaceBack(x[3*P],x[3*P+1],x[3*P+2]);if(d.vertexArray._trim(),d.aabb=new bn(O.min,O.max),d.centroid=function(P,M){let I=[0,0,0],R=P.length;if(R>0){for(let V=0;V<R;V++){let j=3*P[V];I[0]+=M[j],I[1]+=M[j+1],I[2]+=M[j+2]}I[0]/=R,I[1]/=R,I[2]/=R}return I}(T,x),m.COLOR_0!==void 0){let P=i.json.accessors[m.COLOR_0],M=by[P.type],I=Kf(i,P);d.colorArray=M===3?new lu:new vc,d.colorArray.resize(P.count),YM(i,P,d.colorArray,I)}if(m.NORMAL!==void 0){d.normalArray=new lu;let P=i.json.accessors[m.NORMAL];d.normalArray.resize(P.count);let M=Kf(i,P);YM(i,P,d.normalArray,M)}if(m.TEXCOORD_0!==void 0&&a.length>0){d.texcoordArray=new xc;let P=i.json.accessors[m.TEXCOORD_0];d.texcoordArray.resize(P.count);let M=Kf(i,P);YM(i,P,d.texcoordArray,M)}if(m._FEATURE_ID_RGBA4444!==void 0){let P=i.json.accessors[m._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=Kf(i,P))}m._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(Kf(i,i.json.accessors[m._FEATURE_RGBA4444]).buffer));let E=c.material;return d.material=function(P,M){let{emissiveFactor:I=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:V=.5,normalTexture:j,occlusionTexture:Z,emissiveTexture:W,doubleSided:G}=P,{baseColorFactor:X=[1,1,1,1],metallicFactor:J=1,roughnessFactor:te=1,baseColorTexture:fe,metallicRoughnessTexture:de}=P.pbrMetallicRoughness||{},he=Z?M[Z.index]:void 0;if(Z&&Z.extensions&&Z.extensions.KHR_texture_transform&&he){let Ce=Z.extensions.KHR_texture_transform;he.offsetScale=[Ce.offset[0],Ce.offset[1],Ce.scale[0],Ce.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new oi(...X),metallicFactor:J,roughnessFactor:te,baseColorTexture:fe?M[fe.index]:void 0,metallicRoughnessTexture:de?M[de.index]:void 0},doubleSided:G,emissiveFactor:I,alphaMode:R,alphaCutoff:V,normalTexture:j?M[j.index]:void 0,occlusionTexture:he,emissionTexture:W?M[W.index]:void 0,defined:P.defined===void 0}}(E!==void 0?i.json.materials[E]:{defined:!1},a),d}function GA(c,i,a){let{matrix:u,rotation:m,translation:d,scale:g,mesh:b,extras:T,children:O}=c,x={};if(x.matrix=u||Ee.mat4.fromRotationTranslationScale([],m||[0,0,0,1],d||[0,0,0],g||[1,1,1]),b!==void 0){x.meshes=a[b];let E=x.anchor=[0,0];for(let P of x.meshes){let{min:M,max:I}=P.aabb;E[0]+=M[0]+I[0],E[1]+=M[1]+I[1]}E[0]=Math.floor(E[0]/x.meshes.length/2),E[1]=Math.floor(E[1]/x.meshes.length/2)}if(T&&(T.id&&(x.id=T.id),T.lights&&(x.lights=function(E){if(!E.length)return[];let P=function(j){let Z=atob(j),W=new Uint8Array(Z.length);for(let G=0;G<Z.length;G++)W[G]=Z.codePointAt(G);return W}(E),M=[],I=P.length/24,R=new Uint16Array(P.buffer),V=new Float32Array(P.buffer);for(let j=0;j<I;j++){let Z=R[2*j*6]/30,W=R[2*j*6+1]/30,G=R[2*j*6+10]/100,X=V[6*j+1],J=V[6*j+2],te=V[6*j+3],fe=V[6*j+4],de=te-X,he=fe-J,Ce=Math.hypot(de,he);M.push({pos:[X+.5*de,J+.5*he,W],normal:[he/Ce,-de/Ce,0],width:Ce,height:Z,depth:G,points:[X,J,te,fe]})}return M}(T.lights))),O){let E=[];for(let P of O)E.push(GA(i.json.nodes[P],i,a));x.children=E}return x}function Q8(c){if(c.vertices.length===0||c.indices.length===0)return null;let i=new KC(c.vertices,c.indices,8,256),[a,u]=[i.min.clone(),i.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:i,min:a,max:u}}function e9(c){if(!c.extras||!c.extras.ground)return null;let i=c.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;let a=i[0];if(!a||!Array.isArray(a)||a.length===0)return null;let u=[];for(let g of a){if(!Array.isArray(g)||g.length!==2)continue;let b=g[0],T=g[1];typeof b=="number"&&typeof T=="number"&&u.push(new We(b,T))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let m=0;for(let g=0;g<u.length;g++){let b=u[g],T=u[(g+1)%u.length],O=u[(g+2)%u.length];m+=(b.x-T.x)*(O.y-T.y)-(O.x-T.x)*(b.y-T.y)}m>0&&u.reverse();let d=q_(u.flatMap(g=>[g.x,g.y]),[]);return d.length===0?null:{vertices:u,indices:d}}function t9(c,i){let a=[],u=[],m=0,d=[];for(let g of c){m=a.length;let b=g.vertexArray.float32,T=g.indexArray.uint16;for(let O=0;O<g.vertexArray.length;O++)d[0]=b[3*O+0],d[1]=b[3*O+1],d[2]=b[3*O+2],Ee.vec3.transformMat4(d,d,i),a.push(new We(d[0],d[1]));for(let O=0;O<3*g.indexArray.length;O++)u.push(T[O]+m)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){let b=a[u[g+0]],T=a[u[g+1]],O=a[u[g+2]];(b.x-T.x)*(O.y-T.y)-(O.x-T.x)*(b.y-T.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:a,indices:u}}function qA(c){let i=function(T,O){let x=[],E=WebGL2RenderingContext;if(T.json.textures)for(let P of T.json.textures){let M={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};P.sampler!==void 0&&Object.assign(M,T.json.samplers[P.sampler]),x.push({image:O[P.source],sampler:M,uploaded:!1})}return x}(c,c.images),a=function(T,O){let x=[];for(let E of T.json.meshes){let P=[];for(let M of E.primitives)P.push(J8(M,T,O));x.push(P)}return x}(c,i),{scenes:u,scene:m,nodes:d}=c.json,g=u?u[m||0].nodes:d,b=[];for(let T of g)b.push(GA(d[T],c,a));return function(T,O,x){let E={},P=new Set;for(let M=0;M<T.length;M++){let I=x[O[M]];if(!I.extras)continue;let R=I.extras["mapbox:footprint:version"],V=I.extras["mapbox:footprint:id"];(R||V)&&P.add(M),R==="1.0.0"&&V&&(E[V]=M)}for(let M=0;M<T.length;M++){if(P.has(M))continue;let I=T[M],R=x[O[M]];if(!R.extras)continue;let V=null;I.id in E&&(V=t9(T[E[I.id]].meshes,I.matrix)),V||(V=e9(R)),V&&(I.footprint=Q8(V))}if(P.size>0){let M=Array.from(P.values()).sort((I,R)=>I-R);for(let I=M.length-1;I>=0;I--)T.splice(M[I],1)}}(b,g,c.json.nodes),b}function n9(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);let i=c.vertexArray.float32,a=c.aabb.min[0]-1,u=c.aabb.min[1]-1,m=Yf/(c.aabb.max[0]-a+2),d=Yf/(c.aabb.max[1]-u+2);for(let g=0;g<i.length;g+=3){let b=i[g+2],T=(i[g+0]-a)*m|0,O=(i[g+1]-u)*d|0;b>c.heightmap[O*Yf+T]&&(c.heightmap[O*Yf+T]=b)}}function i9(c,i){let a={};a.indexArray=new qo,a.indexArray.reserve(4*c.length),a.vertexArray=new lu,a.vertexArray.reserve(10*c.length),a.colorArray=new vc,a.vertexArray.reserve(10*c.length);let u=0;for(let g of c){let b=Math.min(10,Math.max(4,1.3*g.height))*i,T=[-g.normal[1],g.normal[0],0],O=Math.min(.29,.1*g.width/g.depth),x=g.width-2*g.depth*i*(O+.01),E=Ee.vec3.scaleAndAdd([],g.pos,T,x/2),P=Ee.vec3.scaleAndAdd([],g.pos,T,-x/2),M=[E[0],E[1],E[2]+g.height],I=[P[0],P[1],P[2]+g.height],R=Ee.vec3.scaleAndAdd([],g.normal,T,O);Ee.vec3.scale(R,R,b);let V=Ee.vec3.scaleAndAdd([],g.normal,T,-O);Ee.vec3.scale(V,V,b),Ee.vec3.add(R,E,R),Ee.vec3.add(V,P,V),E[2]+=.1,P[2]+=.1,a.vertexArray.emplaceBack(R[0],R[1],R[2]),a.vertexArray.emplaceBack(V[0],V[1],V[2]),a.vertexArray.emplaceBack(E[0],E[1],E[2]),a.vertexArray.emplaceBack(P[0],P[1],P[2]),a.vertexArray.emplaceBack(M[0],M[1],M[2]),a.vertexArray.emplaceBack(I[0],I[1],I[2]),a.vertexArray.emplaceBack(E[0],E[1],E[2]),a.vertexArray.emplaceBack(P[0],P[1],P[2]),a.vertexArray.emplaceBack(R[0],R[1],R[2]),a.vertexArray.emplaceBack(V[0],V[1],V[2]);let j=x/b/2;a.colorArray.emplaceBack(-j-O,-1,j,.8),a.colorArray.emplaceBack(j+O,-1,j,.8),a.colorArray.emplaceBack(-j,0,j,1.3),a.colorArray.emplaceBack(j,0,j,1.3),a.colorArray.emplaceBack(j+O,-.8,j,.7),a.colorArray.emplaceBack(j+O,-.8,j,.7),a.colorArray.emplaceBack(0,0,j,1.3),a.colorArray.emplaceBack(0,0,j,1.3),a.colorArray.emplaceBack(j+O,-1.2,j,.8),a.colorArray.emplaceBack(j+O,-1.2,j,.8),a.indexArray.emplaceBack(6+u,4+u,8+u),a.indexArray.emplaceBack(7+u,9+u,5+u),a.indexArray.emplaceBack(0+u,1+u,2+u),a.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}let m={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=oi.white,m.pbrMetallicRoughness=d,a.material=m,a.aabb=new bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}class ZA{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){let u=i[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}let r9=["id","tile","layer","source","sourceLayer","state"];class Wm{constructor(i,a,u,m,d){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=u,this._y=m,this.properties=i.properties,this.id=d}clone(){let i=new Wm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=cn({},this.state)),this.layer&&(i.layer=cn({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){let i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let a of r9)this[a]!==void 0&&(i[a]=this[a]);return i}}class WA{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new eh(Ot,16,0),this.featureIndexArray=new $v,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,a,u,m,d,g=0,b=0){let T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,d,g);let O=this.grid;for(let x=0;x<a.length;x++){let E=a[x],P=[1/0,1/0,-1/0,-1/0];for(let M=0;M<E.length;M++){let I=E[M];P[0]=Math.min(P[0],I.x),P[1]=Math.min(P[1],I.y),P[2]=Math.max(P[2],I.x),P[3]=Math.max(P[3],I.y)}b!==0&&(P[0]-=b,P[1]-=b,P[2]+=b,P[3]+=b),P[0]<Ot&&P[1]<Ot&&P[2]>=0&&P[3]>=0&&O.insert(T,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new km.VectorTile(new ux(this.rawTileData)).layers,this.sourceLayerCoder=new ZA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a){let{tilespaceGeometry:u,transform:m,tileTransform:d,pixelPosMatrix:g,availableImages:b}=a;this.loadVTLayers(),this.serializedLayersCache.clear();let T=u.bufferedTilespaceBounds,O=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(M,I,R,V)=>Ye(u.bufferedTilespaceGeometry,M,I,R,V));O.sort(o9);let x=null;m.elevation&&O.length>0&&(x=jm.create(m.elevation,this.tileID));let E={},P;for(let M=0;M<O.length;M++){let I=O[M];if(I===P)continue;P=I;let R=this.featureIndexArray.get(I),V=null;this.is3DTile?this.loadMatchingModelFeature(E,R,i,u,m):this.loadMatchingFeature(E,R,i,b,(j,Z,W,G=0)=>(V||(V=U(j,this.tileID.canonical,d)),Z.queryIntersectsFeature(u,j,W,V,this.z,m,g,x,G)))}return E}loadMatchingFeature(i,a,u,m,d){let{featureIndex:g,bucketIndex:b,sourceLayerIndex:T,layoutVertexArrayOffset:O}=a,x=this.bucketLayerIDs[b],E=u.layers,P=Object.keys(E);if(P.length&&!function(j,Z){for(let W=0;W<j.length;W++)if(Z.indexOf(j[W])>=0)return!0;return!1}(P,x))return;let M=u.sourceCache,I=this.sourceLayerCoder.decode(T),R=this.vtLayers[I].feature(g),V=this.getId(R,I);for(let j=0;j<x.length;j++){let Z=x[j];if(!E[Z])continue;let{styleLayer:W,targets:G}=E[Z],X={};V!==void 0&&(X=M.getFeatureState(W.sourceLayer,V));let J=!d||d(R,W,X,O);if(!J)continue;let te=new Wm(R,this.z,this.x,this.y,V);te.tile=this.tileID.canonical,te.state=X;let fe=this.serializedLayersCache.get(Z);fe||(fe=W.serialize(),fe.id=Z,this.serializedLayersCache.set(Z,fe)),te.source=fe.source,te.sourceLayer=fe["source-layer"],te.layer=Oo({},fe),te.layer.paint=YA(fe.paint,W.paint,R,X,m),te.layer.layout=YA(fe.layout,W.layout,R,X,m);let de=!1;for(let he of G){this.updateFeatureProperties(te,he);let{filter:Ce}=he;if(Ce){if(R.properties=te.properties,Ce.needGeometry){let me=q(R,!0);if(!Ce.filter(new _r(this.tileID.overscaledZ),me,this.tileID.canonical))continue}else if(!Ce.filter(new _r(this.tileID.overscaledZ),R))continue}de=!0,he.targetId&&this.addFeatureVariant(te,he)}de&&this.appendToResult(i,Z,g,te,J)}}loadMatchingModelFeature(i,a,u,m,d){let g=this.bucketLayerIDs[0][0],b=u.layers;if(!b[g])return;let{styleLayer:T,targets:O}=b[g];if(T.type!=="model")return;let x=m.tile,E=a.featureIndex,P=x.getBucket(T);if(!(P&&P instanceof Ox))return;let M=function(fe,de,he,Ce){let me=fe.getNodesInfo()[de];if(me.hiddenByReplacement||!me.node.meshes)return;let Me=Number.MAX_VALUE,Oe=me.node,Pe=he.tile,ke=Ce.calculatePosMatrix(Pe.tileID.toUnwrapped(),Ce.worldSize),Ne=me.evaluatedScale,Be=0;Ce.elevation&&Oe.elevation&&(Be=Oe.elevation*Ce.elevation.exaggeration()),Ee.mat4.translate(ke,ke,[(Oe.anchor?Oe.anchor[0]:0)*(Ne[0]-1),(Oe.anchor?Oe.anchor[1]:0)*(Ne[1]-1),Be]),Ee.mat4.scale(ke,ke,Ne);let Le=he.queryGeometry,it=Le.isPointQuery()?Le.screenBounds:Le.screenGeometry,vt=function(Rt){let Pt=Ee.mat4.multiply([],ke,Rt.matrix);Ee.mat4.multiply(Pt,Ce.expandedFarZProjMatrix,Pt);for(let zt=0;zt<Rt.meshes.length;++zt){let ct=Rt.meshes[zt];if(zt===Rt.lightMeshIndex)continue;let tn=YO(it,Ce,Pt,ct.aabb);tn!=null&&(Me=Math.min(tn,Me))}if(Rt.children)for(let zt of Rt.children)vt(zt)};if(vt(Oe),Me===Number.MAX_VALUE)return;let rt=new bi(0,0);return aA(Pe.tileID.canonical,rt,me.node.anchor[0],me.node.anchor[1]),{intersectionZ:Me,position:rt,feature:me.feature}}(P,E,m,d);if(!M)return;let{z:I,x:R,y:V}=x.tileID.canonical,{feature:j,intersectionZ:Z,position:W}=M,G={};j.id!==void 0&&(G=u.sourceCache.getFeatureState(T.sourceLayer,j.id));let X=new Wm({},I,R,V,j.id);X.tile=this.tileID.canonical,X.state=G,X.properties=j.properties,X.geometry={type:"Point",coordinates:[W.lng,W.lat]};let J=this.serializedLayersCache.get(g);J||(J=T.serialize(),J.id=g,this.serializedLayersCache.set(g,J)),X.source=J.source,X.sourceLayer=J["source-layer"],X.layer=Oo({},J);let te=!1;for(let fe of O){this.updateFeatureProperties(X,fe);let{filter:de}=fe;if(de){if(j.properties=X.properties,de.needGeometry){if(!de.filter(new _r(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!de.filter(new _r(this.tileID.overscaledZ),j))continue}te=!0,fe.targetId&&this.addFeatureVariant(X,fe)}te&&this.appendToResult(i,g,E,X,Z)}updateFeatureProperties(i,a,u){if(a.properties){let m={};for(let d in a.properties){let g=a.properties[d].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,u);g!=null&&(m[d]=g)}i.properties=m}}addFeatureVariant(i,a,u){let m={target:a.target,namespace:a.namespace};a.properties&&(m.properties=i.properties),i.variants=i.variants||{},i.variants[a.targetId]=i.variants[a.targetId]||[],i.variants[a.targetId].push(m)}appendToResult(i,a,u,m,d){let g=i[a];g===void 0&&(g=i[a]=[]),g.push({featureIndex:u,feature:m,intersectionZ:d})}lookupSymbolFeatures(i,a,u,m,d){let g={};this.loadVTLayers();for(let b of i)this.loadMatchingFeature(g,{bucketIndex:a,sourceLayerIndex:u,featureIndex:b,layoutVertexArrayOffset:0},m,d);return g}loadFeature(i){let{featureIndex:a,sourceLayerIndex:u}=i;this.loadVTLayers();let m=this.sourceLayerCoder.decode(u),d=this.vtFeatures[m];if(d[a])return d[a];let g=this.vtLayers[m].feature(a);return d[a]=g,g}hasLayer(i){for(let a of this.bucketLayerIDs)for(let u of a)if(i===u)return!0;return!1}getId(i,a){let u=i.id;if(this.promoteId){let m=typeof this.promoteId=="string"?this.promoteId:this.promoteId[a];m!=null&&(u=i.properties[m]),typeof u=="boolean"&&(u=Number(u))}return u}}function YA(c,i,a,u,m){return Ka(c,(d,g)=>{let b=i instanceof sd?i.get(g):null;return b&&b.evaluate?b.evaluate(a,u,m):b})}function o9(c,i){return i-c}Xt(WA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let XA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class XM{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[a,u]=new Uint8Array(i,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");let m=u>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);let d=XA[15&u];if(!d)throw new Error("Unrecognized array type.");let[g]=new Uint16Array(i,2,1),[b]=new Uint32Array(i,4,1);return new XM(b,g,d,i)}constructor(i,a=64,u=Float64Array,m){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;let d=XA.indexOf(this.ArrayType),g=2*i*this.ArrayType.BYTES_PER_ELEMENT,b=i*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+b+T,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+T),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+b+T,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=i)}add(i,a){let u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=i,this.coords[this._pos++]=a,u}finish(){let i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return KM(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,a,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:g,nodeSize:b}=this,T=[0,d.length-1,0],O=[];for(;T.length;){let x=T.pop()||0,E=T.pop()||0,P=T.pop()||0;if(E-P<=b){for(let V=P;V<=E;V++){let j=g[2*V],Z=g[2*V+1];j>=i&&j<=u&&Z>=a&&Z<=m&&O.push(d[V])}continue}let M=P+E>>1,I=g[2*M],R=g[2*M+1];I>=i&&I<=u&&R>=a&&R<=m&&O.push(d[M]),(x===0?i<=I:a<=R)&&(T.push(P),T.push(M-1),T.push(1-x)),(x===0?u>=I:m>=R)&&(T.push(M+1),T.push(E),T.push(1-x))}return O}within(i,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:d,nodeSize:g}=this,b=[0,m.length-1,0],T=[],O=u*u;for(;b.length;){let x=b.pop()||0,E=b.pop()||0,P=b.pop()||0;if(E-P<=g){for(let V=P;V<=E;V++)JA(d[2*V],d[2*V+1],i,a)<=O&&T.push(m[V]);continue}let M=P+E>>1,I=d[2*M],R=d[2*M+1];JA(I,R,i,a)<=O&&T.push(m[M]),(x===0?i-u<=I:a-u<=R)&&(b.push(P),b.push(M-1),b.push(1-x)),(x===0?i+u>=I:a+u>=R)&&(b.push(M+1),b.push(E),b.push(1-x))}return T}}function KM(c,i,a,u,m,d){if(m-u<=a)return;let g=u+m>>1;KA(c,i,g,u,m,d),KM(c,i,a,u,g-1,1-d),KM(c,i,a,g+1,m,1-d)}function KA(c,i,a,u,m,d){for(;m>u;){if(m-u>600){let O=m-u+1,x=a-u+1,E=Math.log(O),P=.5*Math.exp(2*E/3),M=.5*Math.sqrt(E*P*(O-P)/O)*(x-O/2<0?-1:1);KA(c,i,a,Math.max(u,Math.floor(a-x*P/O+M)),Math.min(m,Math.floor(a+(O-x)*P/O+M)),d)}let g=i[2*a+d],b=u,T=m;for(wy(c,i,u,a),i[2*m+d]>g&&wy(c,i,u,m);b<T;){for(wy(c,i,b,T),b++,T--;i[2*b+d]<g;)b++;for(;i[2*T+d]>g;)T--}i[2*u+d]===g?wy(c,i,u,T):(T++,wy(c,i,T,m)),T<=a&&(u=T+1),a<=T&&(m=T-1)}}function wy(c,i,a,u){JM(c,a,u),JM(i,2*a,2*u),JM(i,2*a+1,2*u+1)}function JM(c,i,a){let u=c[i];c[i]=c[a],c[a]=u}function JA(c,i,a,u){let m=c-a,d=i-u;return m*m+d*d}r.$=b_,r.A=so,r.B=2,r.C=dO,r.D=Um,r.E=Ol,r.F=mM,r.G=class extends Px{},r.H=Rl,r.I=jM,r.J=_i,r.K=Av,r.L=tm,r.M=td,r.N=vv,r.O=g_,r.P=We,r.Q=mm,r.R=Il,r.S=Cv,r.T=SM,r.U=Af,r.V=Px,r.W=mc,r.X=La,r.Y=ka,r.Z=us,r._=Jc,r.a=function(c){return _e.API_CDN_URL_REGEX.test(c)},r.a$=Wm,r.a0=nm,r.a1=yv,r.a2=function(c){let i=c.value,a=[];if(!i)return a;let u=Rl(i);return u!=="string"?(a=a.concat([new Px(c.key,i,`string expected, "${u}" found`)]),a):(KO(i,!0)||(a=a.concat([new Px(c.key,i,`invalid url "${i}"`)])),a)},r.a3=qe,r.a4=rh,r.a5=Ar,r.a6=Et,r.a7=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return Uo(c.expression.evaluate(i))}interpolate(c,i,a){return{x:gn(c.x,i.x,a),y:gn(c.y,i.y,a),z:gn(c.z,i.z,a),azimuthal:gn(c.azimuthal,i.azimuthal,a),polar:gn(c.polar,i.polar,a)}}},r.a8=_r,r.a9=nd,r.aA=wc,r.aB=class{constructor(c){this.entries={},this.scheduler=c}request(c,i,a,u){let m=this.entries[c]=this.entries[c]||{callbacks:[]};if(m.result){let[d,g]=m.result;return this.scheduler?this.scheduler.add(()=>{u(d,g)},i):u(d,g),()=>{}}return m.callbacks.push(u),m.cancel||(m.cancel=a((d,g)=>{m.result=[d,g];for(let b of m.callbacks)this.scheduler?this.scheduler.add(()=>{b(d,g)},i):b(d,g);setTimeout(()=>delete this.entries[c],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(d=>d!==u),m.callbacks.length||(m.cancel(),delete this.entries[c]))}}},r.aC=Es,r.aD=function(c,i,a){let u=JSON.stringify(c.request);return c.data&&(this.deduped.entries[u]={result:[null,c.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},m=>{let d=Aa(c.request,(g,b,T,O)=>{g?m(g):b&&m(null,{vectorTile:a?void 0:new km.VectorTile(new ux(b)),rawData:b,cacheControl:T,expires:O})});return()=>{d.cancel(),m()}},i)},r.aE=function(c){qr++,qr>Mn&&(c.getActor().send("enforceCacheSizeLimit",En),qr=0)},r.aF=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},r.aG=Lt,r.aH=zO,r.aI=$O,r.aJ=NO,r.aK=function(c,i){let a=document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let u=0;u<c.length;u++){let m=document.createElement("source");Dl(c[u])||(a.crossOrigin="Anonymous"),m.src=c[u],a.appendChild(m)}return{cancel:()=>{}}},r.aL=Mx,r.aM=function(c){return fetch(c).then(i=>i.arrayBuffer()).then(i=>$A(i,0,c))},r.aN=qA,r.aO=class{constructor(c,i,a,u){this.id=c,this.position=i!=null?new bi(i[0],i[1]):new bi(0,0),this.orientation=a??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,i){if(Ee.mat4.multiply(c.matrix,i,c.matrix),c.meshes)for(let a of c.meshes){let u=bn.applyTransformFast(a.aabb,c.matrix);this.aabb.encapsulate(u)}if(c.children)for(let a of c.children)this._applyTransformations(a,c.matrix)}computeBoundsAndApplyParent(){let c=Ee.mat4.identity([]);for(let i of this.nodes)this._applyTransformations(i,c)}computeModelMatrix(c,i,a,u,m,d,g=!1){nA(this.matrix,this,c.transform,this.position,i,a,u,m,d,g)}upload(c){if(!this.uploaded){for(let i of this.nodes)AM(i,c);for(let i of this.nodes)Dx(i);this.uploaded=!0}}destroy(){for(let c of this.nodes)RM(c)}},r.aP=Wc,r.aQ=sy,r.aR=Xs,r.aS=Bo,r.aT=dd,r.aU=qo,r.aV=qc,r.aW=Vv,r.aX=wx,r.aY=function(){Ws.isLoading()||Ws.isLoaded()||x_()!=="deferred"||Pv()},r.aZ=Rv,r.a_=q,r.aa=y,r.ab=Ee,r.ac=Gc,r.ad=sd,r.ae=ts,r.af=gn,r.ag=Ot,r.ah=Uu,r.ai=Cn,r.aj=oi,r.ak=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return function([a,u]){let m=Uo([1,a,u]);return{x:m.x,y:m.y,z:m.z}}(c.expression.evaluate(i))}interpolate(c,i,a){return{x:gn(c.x,i.x,a),y:gn(c.y,i.y,a),z:gn(c.z,i.z,a)}}},r.al=function(c,i,a=0,u=!0){let m=new We(a,a),d=c.sub(m),g=i.add(m),b=[d,new We(g.x,d.y),g,new We(d.x,g.y)];return u&&b.push(d.clone()),b},r.am=function(c,i){let a=[];for(let u=0;u<c.length;u++){let m=oa(u-1,-1,c.length-1),d=oa(u+1,-1,c.length-1),g=c[u],b=c[d],T=c[m].sub(g).unit(),O=b.sub(g).unit(),x=O.angleWithSep(T.x,T.y),E=T.add(O).unit().mult(-1*i/Math.sin(x/2));a.push(g.add(E))}return a},r.an=CO,r.ao=Ye,r.ap=function(c,i,a=0){return Ee.vec3.fromValues(((i.x-a)*c.scale-c.x)*Ot,(i.y*c.scale-c.y)*Ot,H_(i.z,i.y))},r.aq=Gn,r.ar=jD,r.as=function(c){let i=1/0,a=1/0,u=-1/0,m=-1/0;for(let d of c)i=Math.min(i,d.x),a=Math.min(a,d.y),u=Math.max(u,d.x),m=Math.max(m,d.y);return{min:new We(i,a),max:new We(u,m)}},r.at=mu,r.au=Re,r.av=C,r.aw=Rn,r.ax=Qo,r.ay=function(c,i){let a={};for(let u=0;u<i.length;u++){let m=i[u];m in c&&(a[m]=c[m])}return a},r.az=pu,r.b=function(c){return _e.API_FONTS_REGEX.test(c)},r.b$=Sx,r.b0=Nu,r.b1=sM,r.b2=XC,r.b3=U,r.b4=yc,r.b5=R_,r.b6=si,r.b7=Rr,r.b8=q_,r.b9=MM,r.bA=vD,r.bB=yM,r.bC=vO,r.bD=pM,r.bE=XM,r.bF=oa,r.bG=Yc,r.bH=ms,r.bI=function(c,i,a){c[4*i+0]=a[0],c[4*i+1]=a[1],c[4*i+2]=a[2],c[4*i+3]=a[3]},r.bJ=$f,r.bK=Bl,r.bL=Em,r.bM=Hr,r.bN=oh,r.bO=bi,r.bP=IO,r.bQ=Ht,r.bR=ci,r.bS=qO,r.bT=Nt,r.bU=ar,r.bV=function(c,i,a,u,m,d,g,b,T){if(T.name==="globe")return ar(c,i,new Nt(a,u,m),!1);let O=sy({z:a,x:u,y:m},T);return new bn([(d+O.x/O.scale)*i,i*(O.y/O.scale),g],[(d+O.x2/O.scale)*i,i*(O.y2/O.scale),b])},r.bW=function(c,i,a){let u=0;for(let m=0;m<2;++m)c[m]>0&&(u+=(c[m]-0)*(c[m]-0)),i[m]<0&&(u+=(0-i[m])*(0-i[m]));return u},r.bX=Wr,r.bY=B_,r.bZ=function(c){let i=Ee.mat4.identity(new Float64Array(16));Ee.mat4.multiply(i,c.pixelMatrix,c.globeMatrix);let a=[0,Ba,0],u=[0,Va,0];return Ee.vec3.transformMat4(a,a,i),Ee.vec3.transformMat4(u,u,i),[a[0]>0&&a[0]<=c.width&&a[1]>0&&a[1]<=c.height&&!Mc(c,new bi(c.center.lat,90)),u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!Mc(c,new bi(c.center.lat,-90))]},r.b_=function(c,i){let{scale:a}=c.tileTransform,u=a*Ot/(c.tileSize*Math.pow(2,i.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return Ee.mat2.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[u,u])},r.ba=function(c,i){let a=ts(i.zoom);if(a===0)return To(c);let u=Xi(c),m=fi(u),d=mu(u.getWest())*i.worldSize,g=mu(u.getEast())*i.worldSize,b=wc(u.getNorth())*i.worldSize,T=wc(u.getSouth())*i.worldSize,O=[d,b,0],x=[g,b,0],E=[d,T,0],P=[g,T,0],M=Ee.mat4.invert([],i.globeMatrix);return Ee.vec3.transformMat4(O,O,M),Ee.vec3.transformMat4(x,x,M),Ee.vec3.transformMat4(E,E,M),Ee.vec3.transformMat4(P,P,M),m[0]=eo(m[0],E,a),m[1]=eo(m[1],P,a),m[2]=eo(m[2],x,a),m[3]=eo(m[3],O,a),bn.fromPoints(m)},r.bb=Zo,r.bc=kr,r.bd=eo,r.be=hd,r.bf=In,r.bg=GM,r.bh=ux,r.bi=Aa,r.bj=function(c){let i=[];for(let a in c)i.push(c[a]);return i},r.bk=function(c,i){let a=[];for(let u in c)u in i||a.push(u);return a},r.bl=El,r.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bn=Nr,r.bo=function(c,i){let{x:a,y:u}=c.point,m=Vl(a,u,c.worldSize/c._pixelsPerMercatorPixel,0,0);return Ee.mat4.multiply(m,m,da(To(i)))},r.bp=Lm,r.bq=pl,r.br=cx,r.bs=function(c,i,a,u,m){let d=5*i+2;c.float32[d+0]=a,c.float32[d+1]=u,c.float32[d+2]=m},r.bt=bx,r.bu=hO,r.bv=re,r.bw=ns,r.bx=fD,r.by=XO,r.bz=yD,r.c=Se,r.c$=(c,i,a,u,m,d,g,b)=>{let T=c.transform,O=T.pitch<15?UD(.07,.7,Rn((14-T.zoom)/5,0,1)):.07,x=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:$D(c,i,a,u),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:m,u_width_scale:d,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:HD(i,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(x?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:O,u_tile_to_meter:p(i.tileID.canonical,0)}},r.c0=GO,r.c1=function(c){let i=GO(c,!0);return Ee.mat2.invert([],[i[0],i[1],i[4],i[5]])},r.c2=fr,r.c3=function(c){let{x:i,y:a}=c.point,{lng:u,lat:m}=c._center;return Vl(i,a,c.worldSize,u,m)},r.c4=Er,r.c5=Wt,r.c6=z_,r.c7=function(c){let i=Math.round((c+45+360)%360/90)%4;return Xo[i]},r.c8=45,r.c9=Gf,r.cA=class extends hl{constructor(c){super(c),this.current=jC}set(c,i,a){if(this.fetchUniformLocation(c,i)){for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},r.cB=Ya,r.cC=function(c,i,a){let u=ts(a.zoom),m=c.style.map._antialias,d=i.options.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return u===0&&!m&&!d},r.cD=function(c){let i=c.pixelsPerMeter,a=i/ms(1,c.center.lat),u=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.translate(u,u,[c.point.x,c.point.y,0]),Ee.mat4.scale(u,u,[a,a,i]),Float32Array.from(u)},r.cE=Xi,r.cF=function(c){let i=Wr-5;c=Rn(c,-i,i)/i*90;let a=Math.pow(Math.abs(Math.sin(Cn(c))),3);return Math.round(a*(V_.length-1))},r.cG=function(c,i,a,u){let m=i.getNorth(),d=i.getSouth(),g=i.getWest(),b=i.getEast(),T=1<<c.z,O=b-g,x=m-d,E=O/ah,P=-x/V_[a],M=[0,E,0,P,0,0,m,g,0];if(c.z>0){let I=180/u;Ee.mat3.multiply(M,M,[I/O+1,0,0,0,I/x+1,0,-.5*I/E,.5*I/P,1])}return M[2]=T,M[5]=c.x,M[8]=c.y,M},r.cH=To,r.cI=function(c,i,a){let u=Ee.mat4.identity(new Float64Array(16)),m=(i/(1<<c)-.5)*Math.PI*2;return Ee.mat4.rotateY(u,a.globeMatrix,m),Float32Array.from(u)},r.cJ=class{isDataAvailableAtPoint(c){let i=this._source();if(this.isUsingMockSource()||!i||c.y<0||c.y>1)return!1;let a=i.getSource().maxzoom,u=1<<a,m=Math.floor(c.x),d=Math.floor((c.x-m)*u),g=Math.floor(c.y*u),b=this.findDEMTileFor(new Lt(a,m,a,d,g));return!(!b||!b.dem)}getAtPointOrZero(c,i=0){return this.getAtPoint(c,i)||0}getAtPoint(c,i,a=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);let u=this._source();if(!u||c.y<0||c.y>1)return i;let m=u.getSource().maxzoom,d=1<<m,g=Math.floor(c.x),b=c.x-g,T=new Lt(m,g,m,Math.floor(b*d),Math.floor(c.y*d)),O=this.findDEMTileFor(T);if(!O||!O.dem)return i;let x=O.dem,E=1<<O.tileID.canonical.z,P=(b*E-O.tileID.canonical.x)*x.dim,M=(c.y*E-O.tileID.canonical.y)*x.dim,I=Math.floor(P),R=Math.floor(M);return(a?this.exaggeration():1)*gn(gn(x.get(I,R),x.get(I,R+1),M-R),gn(x.get(I+1,R),x.get(I+1,R+1),M-R),P-I)}getAtTileOffset(c,i,a){let u=1<<c.canonical.z;return this.getAtPointOrZero(new y(c.wrap+(c.canonical.x+i/Ot)/u,(c.canonical.y+a/Ot)/u))}getAtTileOffsetFunc(c,i,a,u){return m=>{let d=this.getAtTileOffset(c,m.x,m.y),g=u.upVector(c.canonical,m.x,m.y),b=u.upVectorScale(c.canonical,i,a).metersToTile;return Ee.vec3.scale(g,g,d*b),g}}getForTilePoints(c,i,a,u){if(this.isUsingMockSource())return!1;let m=jm.create(this,c,u);return!!m&&(i.forEach(d=>{d[2]=this.exaggeration()*m.getElevationAt(d[0],d[1],a)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;let i=this.findDEMTileFor(c);if(!i||!i.dem)return null;let a=i.dem.tree,u=i.tileID,m=1<<c.canonical.z-u.canonical.z,d=c.canonical.x/m-u.canonical.x,g=c.canonical.y/m-u.canonical.y,b=0;for(let T=0;T<c.canonical.z-u.canonical.z&&!a.leaves[b];T++){d*=2,g*=2;let O=2*Math.floor(g)+Math.floor(d);b=a.childOffsets[b]+O,d%=1,g%=1}return{min:this.exaggeration()*a.minimums[b],max:this.exaggeration()*a.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let c=this.visibleDemTiles;if(c.length===0)return null;let i=!1,a=Number.MAX_VALUE,u=Number.MIN_VALUE;for(let m of c){let d=this.getMinMaxForTile(m.tileID);d&&(a=Math.min(a,d.min),u=Math.max(u,d.max),i=!0)}return i?{min:a,max:u}:null}},r.cK=qP,r.cL=Ei,r.cM=function(c,i){return[Math.pow(c[0],2.2)*i,Math.pow(c[1],2.2)*i,Math.pow(c[2],2.2)*i]},r.cN=Cc,r.cO=ce,r.cP=oe,r.cQ=256,r.cR=function(c,i){let a=[0,0,0],u=Zo(To(i.canonical));return Ee.vec3.transformMat4(a,a,u),Ee.vec3.transformMat4(a,a,c),a},r.cS=c=>({u_camera_to_center_distance:new Hr(c),u_extrude_scale:new Pm(c),u_device_pixel_ratio:new Hr(c),u_matrix:new $f(c),u_inv_rot_matrix:new $f(c),u_merc_center:new Bl(c),u_tile_id:new Em(c),u_zoom_transition:new Hr(c),u_up_dir:new Em(c),u_emissive_strength:new Hr(c)}),r.cT=c=>({u_matrix:new $f(c),u_pixels_to_tile_units:new Pm(c),u_device_pixel_ratio:new Hr(c),u_width_scale:new Hr(c),u_floor_width_scale:new Hr(c),u_units_to_pixels:new Bl(c),u_dash_image:new oh(c),u_gradient_image:new oh(c),u_image_height:new Hr(c),u_texsize:new Bl(c),u_tile_units_to_pixels:new Hr(c),u_alpha_discard_threshold:new Hr(c),u_trim_offset:new Bl(c),u_trim_fade_range:new Bl(c),u_trim_color:new Sm(c),u_emissive_strength:new Hr(c),u_zbias_factor:new Hr(c),u_tile_to_meter:new Hr(c)}),r.cU=c=>({u_matrix:new $f(c),u_texsize:new Bl(c),u_pixels_to_tile_units:new Pm(c),u_device_pixel_ratio:new Hr(c),u_width_scale:new Hr(c),u_floor_width_scale:new Hr(c),u_image:new oh(c),u_units_to_pixels:new Bl(c),u_tile_units_to_pixels:new Hr(c),u_alpha_discard_threshold:new Hr(c),u_trim_offset:new Bl(c),u_trim_fade_range:new Bl(c),u_trim_color:new Sm(c),u_emissive_strength:new Hr(c),u_zbias_factor:new Hr(c),u_tile_to_meter:new Hr(c)}),r.cV=I_,r.cW=cU,r.cX=uU,r.cY=Am,r.cZ=(c,i,a,u,m,d)=>{let g=c.transform,b=g.projection.name==="globe",T;if(d.paint.get("circle-pitch-alignment")==="map")if(b){let x=Cc(g.zoom,i.canonical)*g._pixelsPerMercatorPixel;T=Float32Array.from([x,0,0,x])}else T=g.calculatePixelsToTileUnitsMatrix(a);else T=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);let O={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(g.projection),u_matrix:c.translatePosMatrix(i.projMatrix,a,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Vt.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:$_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(b){O.u_inv_rot_matrix=u,O.u_merc_center=m,O.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],O.u_zoom_transition=ts(g.zoom);let x=m[0]*Ot,E=m[1]*Ot;O.u_up_dir=g.projection.upVector(new Nt(0,0,0),x,E)}return O},r.c_=GD,r.ca=Sm,r.cb=function(c,i,a){let u=Math.sqrt(c*c+i*i+a*a),m=u>0?Math.acos(a/u)*zr:0,d=c!==0||i!==0?Math.atan2(-i,-c)*zr+90:0;return d<0&&(d+=360),[u,d,m]},r.cc=p,r.cd=bn,r.ce=Uo,r.cf=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},r.cg=function(c,i){return c.readFields(t8,{icons:[]},i)},r.ch=function(c){return c({pluginStatus:Zs,pluginURL:cl}),pm.on("pluginStateChange",c),c},r.ci=Rx,r.cj=Nm,r.ck=gM,r.cl=Ni,r.cm=v_,r.cn=pn,r.co=sa,r.cp=Ls,r.cq=function(c){let i=c.indexOf(Ff);return i>=0?c.slice(0,i):c},r.cr=function(c){return c.indexOf(Ff)>=0},r.cs=function(c){let i=c.indexOf(Ff);return i>=0?c.slice(i+1):""},r.ct=function(c){let i=[],a=c.id;return a===void 0&&i.push({message:`layers.${a}: missing required property "id"`}),c.render===void 0&&i.push({message:`layers.${a}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},r.cu=function(c,i,a,u){return c.type==="custom"?new jU(c,i):new JU[c.type](c,i,a,u)},r.cv=tc,r.cw=class extends Wm{constructor(c,i){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=cn({},c.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){let c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},r.cx=pm,r.cy=hr,r.cz=Im,r.d=function(c){return _e.API_TILEJSON_REGEX.test(c)},r.d$=Ka,r.d0=(c,i,a,u,m,d,g,b,T)=>{let O=c.transform,x=O.calculatePixelsToTileUnitsMatrix(i),E=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",P=O.pitch<15?UD(.07,.7,Rn((14-O.zoom)/5,0,1)):.07;return{u_matrix:$D(c,i,a,u),u_pixels_to_tile_units:x,u_device_pixel_ratio:d,u_width_scale:g,u_floor_width_scale:b,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:qD(a)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:HD(i,c.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(E?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:p(i.tileID.canonical,0)}},r.d1=Zc,r.d2=G_,r.d3=AD,r.d4=Tn,r.d5=ax,r.d6=yd,r.d7=450,r.d8=7,r.d9=VU,r.dA=ec,r.dB=l,r.dC=ch,r.dD=function([c,i,a]){let u=Math.hypot(c,i,a),m=Math.atan2(c,a),d=.5*Math.PI-Math.acos(-i/u);return new bi(Er(m),Er(d))},r.dE=PM,r.dF=function(c){let i=c.navigator?c.navigator.userAgent:null;return!!function(a){if(zu==null){let u=a.navigator?a.navigator.userAgent:null;zu=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return zu}(c)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dG=function(c,i){En=c,Mn=i},r.dH=Mc,r.dI=fa,r.dJ=function(c){let i=[0,0,0],a=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.multiply(a,c.pixelMatrix,c.globeMatrix),Ee.vec3.transformMat4(i,i,a),new We(i[0],i[1])},r.dK=function(c,i,a=!1){if(Zs===dm||Zs===__||Zs===y_)throw new Error("setRTLTextPlugin cannot be called multiple times.");cl=Vt.resolveURL(c),Zs=dm,fm=i,id(),a||Pv()},r.dL=x_,r.dM=function(){Rx().acquire(LM)},r.dN=function(){let c=py;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(LM),py=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dO=Ax,r.dP=function(c){let i=Oi();if(!i)return;let a=i.delete(kn);c&&a.catch(c).then(()=>c())},r.dQ=fy,r.dR=NA,r.dS=function(c){qM=Vt.resolveURL(c),Zm||(Zm=new Um(Rx(),new Ol)),Zm.broadcast("setDracoUrl",qM)},r.dT=zA,r.dU=function(c){qm=Vt.resolveURL(c),Zm||(Zm=new Um(Rx(),new Ol)),Zm.broadcast("setMeshoptUrl",qm)},r.dV=Xt,r.dW=_d,r.dX=Ec,r.dY=ZA,r.dZ=WA,r.d_=zD,r.da=Ti,r.db=Cm,r.dc=256,r.dd=da,r.de=lu,r.df=hu,r.dg=D_,r.dh=function(c,i,a,u,m){return Rn((c-i)/(a-i)*(m-u)+u,u,m)},r.di=lo,r.dj=o,r.dk=class{constructor(c,i,a,u){this.context=c,this.format=u,this.size=a,this.texture=c.gl.createTexture();let[m,d,g]=this.size,{gl:b}=c;b.bindTexture(b.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),b.texImage3D(b.TEXTURE_3D,0,this.format,m,d,g,0,TM(this.format),EM(this.format),i.data)}bind(c,i){let{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_3D,this.texture),c!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,c),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,c),this.minFilter=c),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){let{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},r.dl=DM,r.dm=[1,1,1],r.dn=jm,r.dp=Vm,r.dq=uu,r.dr=xc,r.ds=gd,r.dt=A_,r.du=O_,r.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new We(1/0,1/0),max:new We(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,i=!1){let a=mD(new We(0,0),new We(Ot,Ot),c),u=[];if(i&&!tM(a,this._globalClipBounds))return u;for(let m of this._activeRegions){if(m.hiddenByOverlap||!tM(a,m))continue;let d=Fj(m.min,m.max,c);u.push({min:d.min,max:d.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return u}setSources(c){this._setSources(c.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{let a=[];for(let u of i.cache.getVisibleCoordinates()){let m=i.cache.getTile(u).buckets[i.layer];m&&m.updateFootprints(u.toUnwrapped(),a)}return a},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(c){let i=c.getFootprints();if(i.length===0)return;let a=c.getOrder(),u=c.getClipMask(),m=c.getClipScope();for(let d of i){if(!d.footprint)continue;let g=mD(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:a,clipMask:u,clipScope:m})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,a)=>i.priority-a.priority||ox(i.min,a.min)||ox(i.max,a.max)||i.order-a.order||i.clipMask-a.clipMask||function(u,m){let d=(g,b)=>g+b;return u.length-m.length||u.reduce(d,"").localeCompare(m.reduce(d,""))}(i.clipScope,a.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let i=0;for(;!c&&i!==this._activeRegions.length;){let a=this._activeRegions[i],u=this._prevRegions[i];c=a.priority!==u.priority||!pD(a,u)||a.order!==u.order||a.clipMask!==u.clipMask||!Nr(a.clipScope,u.clipScope),++i}}if(c){++this._updateTime;for(let a of this._activeRegions)a.order!==rx&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));let i=a=>{let u=this._activeRegions;if(a>=u.length)return a;let m=u[a].priority;for(;a<u.length&&u[a].priority===m;)++a;return a};if(this._sourceIds.length>1){let a=0,u=i(a);for(;a!==u;){let m=a,d=a;for(;m!==u;){let g=this._activeRegions[m];g.hiddenByOverlap=!1;for(let b=0;b<d;b++){let T=this._activeRegions[b];if(!T.hiddenByOverlap&&g.order===rx&&tM(g,T)&&(g.hiddenByOverlap=_D(g.footprint,g.tileId,T.footprint,T.tileId),g.hiddenByOverlap))break}++m}a=u,u=i(a)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=c.length-1;i>=0;i--)this._addSource(c[i]);this._computeReplacement()}},r.dw=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let c of this._poleSegments)c.destroy();for(let c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,i){let a=new yc,u=new qo,m=[],d=c+1+2,g=i[0]+1,b=i[0]+1+(1+i.length),T=(O,x,E)=>{let P=O===d-1?O-2:O===0?O:O-1;return P+=E?24575:0,[P,x]};for(let O=0;O<d;++O)a.emplaceBack(...T(O,0,!0));for(let O=0;O<g;++O)for(let x=0;x<d;++x)a.emplaceBack(...T(x,O,(x===0||x===d-1)&&!0));for(let O=0;O<i.length;++O){let x=i[O];for(let E=0;E<d;++E)a.emplaceBack(...T(E,x,!0))}for(let O=0;O<i.length;++O){let x=u.length,E=i[O]+1+2,P=new qo;for(let R=0;R<E-1;R++){let V=R===E-2,j=V?d*(b-i.length+O-R):d;for(let Z=0;Z<d-1;Z++){let W=R*d+Z;R===0||V||Z===0||Z===d-2?(P.emplaceBack(W+1,W,W+j),P.emplaceBack(W+j,W+j+1,W+1)):(u.emplaceBack(W+1,W,W+j),u.emplaceBack(W+j,W+j+1,W+1))}}let M=Rr.simpleSegment(0,x,a.length,u.length-x);for(let R=0;R<P.uint16.length;R+=3)u.emplaceBack(P.uint16[R],P.uint16[R+1],P.uint16[R+2]);let I=Rr.simpleSegment(0,x,a.length,u.length-x);m.push({withoutSkirts:M,withSkirts:I})}return{vertices:a,indices:u,segments:m}}_createGrid(c){let i=this._fillGridMeshWithLods(ah,V_);this._gridSegments=i.segments,this._gridBuffer=c.createVertexBuffer(i.vertices,si.members),this._gridIndexBuffer=c.createIndexBuffer(i.indices,!0)}_createPoles(c){let i=new qo;for(let g=0;g<=ah;g++)i.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=c.createIndexBuffer(i,!0);let a=new hu,u=new hu,m=new hu,d=new hu;this._poleSegments=[];for(let g=0,b=0;g<z_;g++){let T=360/(1<<g);a.emplaceBack(0,-Qo,0,.5,0),u.emplaceBack(0,-Qo,0,.5,1),m.emplaceBack(0,-Qo,0,.5,.5),d.emplaceBack(0,-Qo,0,.5,.5);for(let O=0;O<=ah;O++){let x=O/ah,E=0,P=gn(0,T,x),[M,I,R]=lh(uh,qf,P,Qo);a.emplaceBack(M,I,R,x,E),u.emplaceBack(M,I,R,x,1-E);let V=Cn(P);x=.5+.5*Math.sin(V),E=.5+.5*Math.cos(V),m.emplaceBack(M,I,R,x,E),d.emplaceBack(M,I,R,x,1-E)}this._poleSegments.push(Rr.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(a,un,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(u,un,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(m,un,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(d,un,!1)}getGridBuffers(c,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},r.dx=rx,r.dy=Xa,r.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.e=_e,r.e0=cs,r.e1=fO,r.e2=function(c,i,a,u,m,d,g,b,T,O,x=1,E,P){c.createArrays(),c.tilePixelRatio=Ot/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;let M=c.layers[0].layout,I=c.layers[0]._unevaluatedLayout._values,R={};R.scaleFactor=x,R.textSizeScaleRange=M.get("text-size-scale-range"),R.iconSizeScaleRange=M.get("icon-size-scale-range");let[V,j]=R.textSizeScaleRange,[Z,W]=R.iconSizeScaleRange;if(R.textScaleFactor=Rn(R.scaleFactor,V,j),R.iconScaleFactor=Rn(R.scaleFactor,Z,W),c.textSizeData.kind==="composite"){let{minZoom:te,maxZoom:fe}=c.textSizeData;R.compositeTextSizes=[I["text-size"].possiblyEvaluate(new _r(te),b),I["text-size"].possiblyEvaluate(new _r(fe),b)]}if(c.iconSizeData.kind==="composite"){let{minZoom:te,maxZoom:fe}=c.iconSizeData;R.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new _r(te),b),I["icon-size"].possiblyEvaluate(new _r(fe),b)]}R.layoutTextSize=I["text-size"].possiblyEvaluate(new _r(T+1),b),R.layoutIconSize=I["icon-size"].possiblyEvaluate(new _r(T+1),b),R.textMaxSize=I["text-size"].possiblyEvaluate(new _r(18),b);let G=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",X=M.get("text-size"),J=!1;for(let te of c.features)if(te.icon&&te.icon.nameSecondary){J=!0;break}for(let te of c.features){let fe=M.get("text-font").evaluate(te,{},b).join(","),de=X.evaluate(te,{},b)*R.textScaleFactor,he=R.layoutTextSize.evaluate(te,{},b)*R.textScaleFactor,Ce=(R.layoutIconSize.evaluate(te,{},b),{horizontal:{},vertical:void 0}),me=te.text,Me,Oe=[0,0];if(me){let Be=me.toString(),Le=M.get("text-letter-spacing").evaluate(te,{},b)*ns,it=M.get("text-line-height").evaluate(te,{},b)*ns,vt=Ev(Be)?Le:0,rt=M.get("text-anchor").evaluate(te,{},b),Rt=M.get("text-variable-anchor");if(!Rt){let kt=M.get("text-radial-offset").evaluate(te,{},b);Oe=kt?vO(rt,[kt*ns,_M]):M.get("text-offset").evaluate(te,{},b).map(Jt=>Jt*ns)}let Pt=G?"center":M.get("text-justify").evaluate(te,{},b),zt=M.get("symbol-placement")==="point",ct=zt?M.get("text-max-width").evaluate(te,{},b)*ns:1/0,tn=kt=>{c.allowVerticalPlacement&&lm(Be)&&(Ce.vertical=fM(me,i,a,m,fe,ct,it,rt,kt,vt,Oe,pl.vertical,!0,he,de))};if(!G&&Rt){let kt=Pt==="auto"?Rt.map(mn=>yM(mn)):[Pt],Jt=!1;for(let mn=0;mn<kt.length;mn++){let zn=kt[mn];if(!Ce.horizontal[zn])if(Jt)Ce.horizontal[zn]=Ce.horizontal[0];else{let Vn=fM(me,i,a,m,fe,ct,it,"center",zn,vt,Oe,pl.horizontal,!1,he,de);Vn&&(Ce.horizontal[zn]=Vn,Jt=Vn.positionedLines.length===1)}}tn("left")}else{if(Pt==="auto"&&(Pt=yM(rt)),zt||M.get("text-writing-mode").indexOf("horizontal")>=0||!lm(Be)){let kt=fM(me,i,a,m,fe,ct,it,rt,Pt,vt,Oe,pl.horizontal,!1,he,de);kt&&(Ce.horizontal[Pt]=kt)}tn(zt?"left":Pt)}}let Pe=!1,ke=!1;if(te.icon&&te.icon.namePrimary){let Be=lx(c.iconSizeData,I["icon-size"],b,c.zoom,te)*R.iconScaleFactor*E,Le=te.icon.getPrimary().scaleSelf(Be).serialize(),it=u[Le];it&&(Me=xU(m[Le],te.icon.nameSecondary?m[te.icon.getSecondary().scaleSelf(Be).serialize()]:void 0,M.get("icon-offset").evaluate(te,{},b),M.get("icon-anchor").evaluate(te,{},b)),Pe=it.sdf,ke=it.usvg,c.sdfIcons===void 0?c.sdfIcons=it.sdf:c.sdfIcons!==it.sdf&&Wn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(it.pixelRatio!==c.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}let Ne=bO(Ce.horizontal)||Ce.vertical;c.iconsInText||(c.iconsInText=!!Ne&&Ne.iconsInText),(Ne||Me)&&SU(c,te,Ce,Me,u,R,he,0,Oe,Pe,ke,g,b,O,P,J)}d&&c.generateCollisionDebugBuffers(T,c.collisionBoxArray,R.textScaleFactor)},r.e3=km,r.e4=Bx,r.e5=gi,r.e6=cD,r.e7=JD,r.e8=w,r.e9=function(c){let i=0;if(new Uint32Array(c,0,1)[0]!==VA){let a=new Uint32Array(c,0,7),[,,u,m,d,g]=a;i=a.byteLength+m+d+g+d,(u!==c.byteLength||i>=c.byteLength)&&Wn("Invalid b3dm header information.")}return $A(c,i)},r.ea=function(c,i){let a=qA(c);for(let u of a){for(let m of u.meshes)n9(m);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(i9(u.lights,i)))}return a},r.eb=Ox,r.ec=lA,r.ed=Ws,r.ee=function(c){Si(),vi?.then(i=>{i.keys().then(a=>{for(let u=0;u<a.length-c;u++)i.delete(a[u])})})},r.f=function(c){return c.indexOf("mapbox:")===0},r.g=function(c,i){return hr(Oo(c,{method:"GET"}),i)},r.h=De,r.i=function(c){return _e.API_STYLE_REGEX.test(c)&&!Se(c)},r.j=function(c){return decodeURIComponent(atob(c).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(i,a)=>String.fromCharCode(+("0x"+a))))},r.l=Oo,r.m=Ho,r.n=function(c,i){return hr(Oo(c,{type:"json"}),i)},r.o=jr,r.p=function(c,i){return hr(Oo(c,{method:"POST"}),i)},r.q=Vt,r.r=gs,r.s=function(c){try{let i=self[c];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=wt,r.u=function(){return function c(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},r.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},r.w=Wn,r.x=function(){return FM||(FM=new Ax),FM},r.y=Bs,r.z=zs}),s(["./shared"],function(r){function w(tt){let oe=tt?tt.url.toString():void 0;return oe?performance.getEntriesByName(oe):[]}function A(tt){if(typeof tt=="number"||typeof tt=="boolean"||typeof tt=="string"||tt==null)return JSON.stringify(tt);if(Array.isArray(tt)){let ce="[";for(let _e of tt)ce+=`${A(_e)},`;return`${ce}]`}let oe="{";for(let ce of Object.keys(tt).sort())oe+=`${ce}:${A(tt[ce])},`;return`${oe}}`}function F(tt){let oe="";for(let ce of r.bm)oe+=`/${A(tt[ce])}`;return oe}class ${constructor(oe){this.keyCache={},this._layers={},this._layerConfigs={},oe&&this.replace(oe)}replace(oe,ce){this._layerConfigs={},this._layers={},this.update(oe,[],ce)}update(oe,ce,_e){this._options=_e;for(let Se of oe)this._layerConfigs[Se.id]=Se,(this._layers[Se.id]=r.cu(Se,this.scope,null,this._options)).compileFilter(_e),this.keyCache[Se.id]&&delete this.keyCache[Se.id];for(let Se of ce)delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se];this.familiesBySource={};let De=function(Se,Fe){let He={};for(let Je=0;Je<Se.length;Je++){let nt=Se[Je],ot=Fe&&Fe[nt.id];!ot&&(ot=F(nt),nt.type==="line"&&nt.paint)&&function Vt($t){return typeof $t=="string"&&$t==="line-progress"||(Array.isArray($t)?$t.some(Vt):!(!$t||typeof $t!="object")&&Object.values($t).some(Vt))}(nt.paint["line-width"])&&(ot+=`/${A(nt.paint["line-width"])}`),Fe&&(Fe[nt.id]=ot);let wt=He[ot];wt||(wt=He[ot]=[]),wt.push(nt)}let Te=[];for(let Je in He)Te.push(He[Je]);return Te}(r.bj(this._layerConfigs),this.keyCache);for(let Se of De){let Fe=Se.map(wt=>this._layers[wt.id]),He=Fe[0];if(He.visibility==="none")continue;let Te=He.source||"",Je=this.familiesBySource[Te];Je||(Je=this.familiesBySource[Te]={});let nt=He.sourceLayer||"_geojsonTileLayer",ot=Je[nt];ot||(ot=Je[nt]=[]),ot.push(Fe)}}}let K=1*r.dX;class se{constructor(oe){let ce={},_e=[];for(let He in oe){let Te=oe[He],Je=ce[He]={};for(let nt in Te.glyphs){let ot=Te.glyphs[+nt];if(!ot||ot.bitmap.width===0||ot.bitmap.height===0)continue;let wt=ot.metrics.localGlyph?K:1,Vt={x:0,y:0,w:ot.bitmap.width+2*wt,h:ot.bitmap.height+2*wt};_e.push(Vt),Je[nt]=Vt}}let{w:De,h:Se}=r.C(_e),Fe=new r.dW({width:De||1,height:Se||1});for(let He in oe){let Te=oe[He];for(let Je in Te.glyphs){let nt=Te.glyphs[+Je];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;let ot=ce[He][Je],wt=nt.metrics.localGlyph?K:1;r.dW.copy(nt.bitmap,Fe,{x:0,y:0},{x:ot.x+wt,y:ot.y+wt},nt.bitmap)}}this.image=Fe,this.positions=ce}}r.dV(se,"GlyphAtlas");class le{constructor(oe){this.tileID=new r.aG(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.lut=oe.lut,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.scope=oe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.request&&oe.request.collectResourceTiming,this.promoteId=oe.promoteId,this.isSymbolTile=oe.isSymbolTile,this.tileTransform=r.aQ(oe.tileID.canonical,oe.projection),this.projection=oe.projection,this.worldview=oe.worldview,this.localizableLayerIds=oe.localizableLayerIds,this.brightness=oe.brightness,this.extraShadowCaster=!!oe.extraShadowCaster,this.tessellationStep=oe.tessellationStep,this.scaleFactor=oe.scaleFactor}parse(oe,ce,_e,De,Se){this.status="parsing",this.data=oe,this.collisionBoxArray=new r.aW;let Fe=new r.dY(Object.keys(oe.layers).sort()),He=new r.dZ(this.tileID,this.promoteId);He.bucketLayerIDs=[];let Te={},Je=new r.d_(256,256),nt={featureIndex:He,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Je,availableImages:_e,brightness:this.brightness,scaleFactor:this.scaleFactor},ot=ce.familiesBySource[this.source];for(let Mn in ot){let ki=oe.layers[Mn];if(!ki)continue;let vi=!1,Xn=!1,Oi=!1;for(let Ho of ot[Mn])Ho[0].type==="symbol"?vi=!0:Xn=!0,Ho[0].is3D()&&Ho[0].type!=="model"&&(Oi=!0);if(this.extraShadowCaster&&!Oi||this.isSymbolTile===!0&&!vi||this.isSymbolTile===!1&&!Xn)continue;ki.version===1&&r.w(`Vector tile source "${this.source}" layer "${Mn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Si=Fe.encode(Mn),qr=[];for(let Ho=0,_o=0;Ho<ki.length;Ho++){let wo=ki.feature(Ho),nc=He.getId(wo,Mn);if(this.localizableLayerIds&&this.localizableLayerIds.has(Mn)){let Fs=wo.properties?wo.properties.worldview:null;if(this.worldview&&typeof Fs=="string")if(Fs==="all")wo.properties.$localized=!0;else{if(!Fs.split(",").includes(this.worldview))continue;wo.properties.$localized=!0,wo.properties.worldview=this.worldview}}qr.push({feature:wo,id:nc,index:_o,sourceLayerIndex:Si}),_o++}for(let Ho of ot[Mn]){let _o=Ho[0];(!this.extraShadowCaster||_o.is3D()&&_o.type!=="model")&&(this.isSymbolTile!==void 0&&_o.type==="symbol"!==this.isSymbolTile||_o.minzoom&&this.zoom<Math.floor(_o.minzoom)||_o.maxzoom&&this.zoom>=_o.maxzoom||_o.visibility!=="none"&&(ae(Ho,this.zoom,nt.brightness,_e),(Te[_o.id]=_o.createBucket({index:He.bucketLayerIDs.length,layers:Ho,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Si,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(qr,nt,this.tileID.canonical,this.tileTransform),He.bucketLayerIDs.push(Ho.map(wo=>r.aC(wo.id,wo.scope)))))}}let wt,Vt,$t,pn;Je.trim();let kn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},En=()=>{if(wt)return this.status="done",Se(wt);if(this.extraShadowCaster)this.status="done",Se(null,{buckets:r.bj(Te).filter(Mn=>!Mn.isEmpty()),featureIndex:He,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:nt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Vt&&$t&&pn){let Mn=new se(Vt),ki=new r.e1($t,pn,this.lut);for(let vi in Te){let Xn=Te[vi];Xn instanceof r.aX?(ae(Xn.layers,this.zoom,nt.brightness,_e),r.e2(Xn,Vt,Mn.positions,$t,ki.iconPositions,this.showCollisionBoxes,_e,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Xn.hasPattern&&(Xn instanceof r.b1||Xn instanceof r.b2||Xn instanceof r.d5)&&(ae(Xn.layers,this.zoom,nt.brightness,_e),Xn.addFeatures(nt,this.tileID.canonical,ki.patternPositions,_e,this.tileTransform,this.brightness))}this.status="done",Se(null,{buckets:r.bj(Te).filter(vi=>!vi.isEmpty()),featureIndex:He,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mn.image,lineAtlas:Je,imageAtlas:ki,brightness:nt.brightness})}};if(!this.extraShadowCaster){let Mn=r.d$(nt.glyphDependencies,Xn=>Object.keys(Xn).map(Number));Object.keys(Mn).length?De.send("getGlyphs",{uid:this.uid,stacks:Mn,scope:this.scope},(Xn,Oi)=>{wt||(wt=Xn,Vt=Oi,En())},void 0,!1,kn):Vt={};let ki=Object.keys(nt.iconDependencies);ki.length?De.send("getImages",{icons:ki,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Xn,Oi)=>{if(wt)return;wt=Xn;let Si={};Object.values(Oi).some(qr=>qr.usvg)?this.rasterize(De,Si,Oi,nt.iconDependencies,()=>{$t=Si,En()}):(this.fillImageMap(Si,nt.iconDependencies,Oi),$t=Si,En())},void 0,!1,kn):$t={};let vi=Object.keys(nt.patternDependencies);vi.length?De.send("getImages",{icons:vi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Xn,Oi)=>{if(!wt){wt=Xn;let Si={};Object.values(Oi).some(qr=>qr.usvg)?this.rasterize(De,Si,Oi,nt.patternDependencies,()=>{pn=Si,En()}):(this.fillImageMap(Si,nt.patternDependencies,Oi),pn=Si,En())}},void 0,!1,kn):pn={}}En()}fillImageMap(oe,ce,_e){for(let De in _e){let Se=ce[De]||[];for(let Fe of Se)_e[Fe.id].usvg||(oe[Fe.serialize()]=_e[Fe.id])}}getImageTaskQueue(oe,ce,_e){let De={};for(let Se in ce){let Fe=_e[Se]||[];for(let He of Fe){let Te=He.serialize();ce[He.id].usvg?De[Te]||(De[Te]=He):oe[Te]=ce[He.id]}}return De}rasterize(oe,ce,_e,De,Se){let Fe=this.getImageTaskQueue(ce,_e,De);this.rasterizeTask=oe.send("rasterizeImages",{scope:this.scope,imageTasks:Fe},(He,Te)=>{if(!He)for(let Je in Te){let{id:nt}=r.e0.deserializeFromString(Je);ce[Je]=Object.assign({},_e[nt],{data:Te[Je]})}Se()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ae(tt,oe,ce,_e){let De=new r.a8(oe,{brightness:ce});for(let Se of tt)Se.recalculate(De,_e)}class Ze extends r.E{constructor(oe,ce,_e,De,Se,Fe){super(),this.actor=oe,this.layerIndex=ce,this.availableImages=_e,this.loadVectorData=Se||r.aD,this.loading={},this.loaded={},this.deduped=new r.aB(oe.scheduler),this.isSpriteLoaded=De,this.scheduler=oe.scheduler,this.brightness=Fe}loadTile(oe,ce){let _e=oe.uid,De=oe&&oe.request,Se=De&&De.collectResourceTiming,Fe=this.loading[_e]=new le(oe);Fe.abort=this.loadVectorData(oe,(He,Te)=>{let Je=!this.loading[_e];if(delete this.loading[_e],Fe.cancelRasterize(),Je||He||!Te)return Fe.status="done",Je||(this.loaded[_e]=Fe),ce(He);let nt=Te.rawData,ot={};Te.expires&&(ot.expires=Te.expires),Te.cacheControl&&(ot.cacheControl=Te.cacheControl),Fe.vectorTile=Te.vectorTile||new r.e3.VectorTile(new r.bh(nt));let wt=()=>{Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Vt,$t)=>{if(Vt||!$t)return ce(Vt);let pn={};if(Se){let kn=w(De);kn.length>0&&(pn.resourceTiming=JSON.parse(JSON.stringify(kn)))}ce(null,r.l({rawTileData:nt.slice(0)},$t,ot,pn))})};this.isSpriteLoaded?wt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(wt,{type:"parseTile",isSymbolTile:oe.isSymbolTile,zoom:oe.tileZoom}):wt()}),this.loaded=this.loaded||{},this.loaded[_e]=Fe})}reloadTile(oe,ce){let _e=this.loaded,De=oe.uid;if(_e&&_e[De]){let Se=_e[De];Se.scaleFactor=oe.scaleFactor,Se.showCollisionBoxes=oe.showCollisionBoxes,Se.projection=oe.projection,Se.brightness=oe.brightness,Se.tileTransform=r.aQ(oe.tileID.canonical,oe.projection),Se.extraShadowCaster=oe.extraShadowCaster,Se.lut=oe.lut;let Fe=(He,Te)=>{let Je=Se.reloadCallback;Je&&(delete Se.reloadCallback,Se.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,Je)),ce(He,Te)};Se.status==="parsing"?Se.reloadCallback=Fe:Se.status==="done"&&(Se.vectorTile?Se.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,Fe):Fe())}else ce(null,void 0)}abortTile(oe,ce){let _e=oe.uid,De=this.loading[_e];De&&(De.abort&&De.abort(),delete this.loading[_e]),ce()}removeTile(oe,ce){let _e=this.loaded,De=oe.uid;_e&&_e[De]&&delete _e[De],ce()}}class Ue{loadTile(oe,ce){let{uid:_e,encoding:De,rawImageData:Se,padding:Fe}=oe,He=ImageBitmap&&Se instanceof ImageBitmap?this.getImageData(Se,Fe):Se;ce(null,new r.e4(_e,He,De,Fe<1))}getImageData(oe,ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(oe.width,oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=oe.width,this.offscreenCanvas.height=oe.height,this.offscreenCanvasContext.drawImage(oe,0,0,oe.width,oe.height);let _e=this.offscreenCanvasContext.getImageData(-ce,-ce,oe.width+2*ce,oe.height+2*ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),_e}}r.bg.setPbf(r.bh);class ft{decodeRasterArray({task:oe,buffer:ce},_e){r.bg.performDecoding(ce,oe).then(De=>{_e(null,De)},De=>{_e(De)})}}let Xe=r.e3.VectorTileFeature.prototype.toGeoJSON;class st{constructor(oe){this._feature=oe,this.extent=r.ag,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){let oe=[];for(let ce of this._feature.geometry)oe.push([new r.P(ce[0],ce[1])]);return oe}{let oe=[];for(let ce of this._feature.geometry){let _e=[];for(let De of ce)_e.push(new r.P(De[0],De[1]));oe.push(_e)}return oe}}toGeoJSON(oe,ce,_e){return Xe.call(this,oe,ce,_e)}}class Ut{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.ag,this.length=oe.length,this._features=oe}feature(oe){return new st(this._features[oe])}}let Bt=64/4096,xt=128;class yt{constructor(){this.features=new Map}clear(){this.features.clear()}load(oe=[],ce){for(let _e of oe){let De=_e.id;if(De==null)continue;let Se=this.features.get(De);Se&&this.updateCache(Se,ce),_e.geometry?(Se=Dt(_e),this.updateCache(Se,ce),this.features.set(De,Se)):this.features.delete(De),this.updateCache(Se,ce)}}updateCache(oe,ce){for(let{canonical:_e,uid:De}of Object.values(ce)){let{z:Se,x:Fe,y:He}=_e;rn(oe,Math.pow(2,Se),Fe,He)&&delete ce[De]}}getTile(oe,ce,_e){let De=Math.pow(2,oe),Se=[];for(let Fe of this.features.values())rn(Fe,De,ce,_e)&&Se.push(ln(Fe,De,ce,_e));return{features:Se}}getFeatures(){return[...this.features.values()]}}function rn({minX:tt,minY:oe,maxX:ce,maxY:_e},De,Se,Fe){return tt<(Se+1+Bt)/De&&oe<(Fe+1+Bt)/De&&ce>(Se-Bt)/De&&_e>(Fe-Bt)/De}function Dt(tt){let{id:oe,geometry:ce,properties:_e}=tt;if(!ce)return;if(ce.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:De,coordinates:Se}=ce,Fe={id:oe,type:1,geometry:[],tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},He=Fe.geometry;if(De==="Point")Tt(Se,He,Fe);else if(De==="MultiPoint")for(let Te of Se)Tt(Te,He,Fe);else if(De==="LineString")Fe.type=2,ri(Se,He,Fe);else if(De==="MultiLineString")Fe.type=2,er(Se,He,Fe);else if(De==="Polygon")Fe.type=3,er(Se,He,Fe,!0);else{if(De!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Fe.type=3;for(let Te of Se)er(Te,He,Fe,!0)}return Fe}function Tt([tt,oe],ce,_e){let De=r.at(tt),Se=r.aA(oe);Se=Se<0?0:Se>1?1:Se,ce.push(De,Se),_e.minX=Math.min(_e.minX,De),_e.minY=Math.min(_e.minY,Se),_e.maxX=Math.max(_e.maxX,De),_e.maxY=Math.max(_e.maxY,Se)}function ri(tt,oe,ce,_e=!1,De=!1){let Se=[];for(let Fe of tt)Tt(Fe,Se,ce);oe.push(Se),_e&&function(Fe,He){let Te=0;for(let Je=0,nt=Fe.length,ot=nt-2;Je<nt;ot=Je,Je+=2)Te+=(Fe[Je]-Fe[ot])*(Fe[Je+1]+Fe[ot+1]);if(Te>0===He)for(let Je=0,nt=Fe.length;Je<nt/2;Je+=2){let ot=Fe[Je],wt=Fe[Je+1];Fe[Je]=Fe[nt-2-Je],Fe[Je+1]=Fe[nt-1-Je],Fe[nt-2-Je]=ot,Fe[nt-1-Je]=wt}}(Se,De)}function er(tt,oe,ce,_e=!1){for(let De=0;De<tt.length;De++)ri(tt[De],oe,ce,_e,De===0)}function ln(tt,oe,ce,_e){let{id:De,type:Se,geometry:Fe,tags:He}=tt,Te=[];if(Se===1)(function(Je,nt,ot,wt,Vt){for(let $t=0;$t<Je.length;$t+=2){let pn=Math.round(r.ag*(Je[$t+0]*nt-ot)),kn=Math.round(r.ag*(Je[$t+1]*nt-wt));Vt.push([pn,kn])}})(Fe,oe,ce,_e,Te);else for(let Je of Fe)Mt(Je,oe,ce,_e,Te);return{id:De,type:Se,geometry:Te,tags:He}}function Mt(tt,oe,ce,_e,De){let Se=-xt,Fe=r.ag+xt,He;for(let Te=0;Te<tt.length-2;Te+=2){let Je=Math.round(r.ag*(tt[Te+0]*oe-ce)),nt=Math.round(r.ag*(tt[Te+1]*oe-_e)),ot=Math.round(r.ag*(tt[Te+2]*oe-ce)),wt=Math.round(r.ag*(tt[Te+3]*oe-_e)),Vt=ot-Je,$t=wt-nt;Je<Se&&ot<Se||(Je<Se?(nt+=Math.round($t*((Se-Je)/Vt)),Je=Se):ot<Se&&(wt=nt+Math.round($t*((Se-Je)/Vt)),ot=Se),nt<Se&&wt<Se||(nt<Se?(Je+=Math.round(Vt*((Se-nt)/$t)),nt=Se):wt<Se&&(ot=Je+Math.round(Vt*((Se-nt)/$t)),wt=Se),Je>=Fe&&ot>=Fe||(Je>=Fe?(nt+=Math.round($t*((Fe-Je)/Vt)),Je=Fe):ot>=Fe&&(wt=nt+Math.round($t*((Fe-Je)/Vt)),ot=Fe),nt>=Fe&&wt>=Fe||(nt>=Fe?(Je+=Math.round(Vt*((Fe-nt)/$t)),nt=Fe):wt>=Fe&&(ot=Je+Math.round(Vt*((Fe-nt)/$t)),wt=Fe),He&&Je===He[He.length-1][0]&&nt===He[He.length-1][1]||(He=[[Je,nt]],De.push(He)),He.push([ot,wt])))))}}var je,At,Ke,mt={exports:{}},It=function(){if(Ke)return mt.exports;Ke=1;var tt=r.e7(),oe=function(){if(At)return je;At=1;var nt=r.e5(),ot=r.e6().VectorTileFeature;function wt($t,pn){this.options=pn||{},this.features=$t,this.length=$t.length}function Vt($t,pn){this.id=typeof $t.id=="number"?$t.id:void 0,this.type=$t.type,this.rawGeometry=$t.type===1?[$t.geometry]:$t.geometry,this.properties=$t.tags,this.extent=pn||4096}return je=wt,wt.prototype.feature=function($t){return new Vt(this.features[$t],this.options.extent)},Vt.prototype.loadGeometry=function(){var $t=this.rawGeometry;this.geometry=[];for(var pn=0;pn<$t.length;pn++){for(var kn=$t[pn],En=[],Mn=0;Mn<kn.length;Mn++)En.push(new nt(kn[Mn][0],kn[Mn][1]));this.geometry.push(En)}return this.geometry},Vt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $t=this.geometry,pn=1/0,kn=-1/0,En=1/0,Mn=-1/0,ki=0;ki<$t.length;ki++)for(var vi=$t[ki],Xn=0;Xn<vi.length;Xn++){var Oi=vi[Xn];pn=Math.min(pn,Oi.x),kn=Math.max(kn,Oi.x),En=Math.min(En,Oi.y),Mn=Math.max(Mn,Oi.y)}return[pn,En,kn,Mn]},Vt.prototype.toGeoJSON=ot.prototype.toGeoJSON,je}();function ce(nt){var ot=new tt;return function(wt,Vt){for(var $t in wt.layers)Vt.writeMessage(3,_e,wt.layers[$t])}(nt,ot),ot.finish()}function _e(nt,ot){var wt;ot.writeVarintField(15,nt.version||1),ot.writeStringField(1,nt.name||""),ot.writeVarintField(5,nt.extent||4096);var Vt={keys:[],values:[],keycache:{},valuecache:{}};for(wt=0;wt<nt.length;wt++)Vt.feature=nt.feature(wt),ot.writeMessage(2,De,Vt);var $t=Vt.keys;for(wt=0;wt<$t.length;wt++)ot.writeStringField(3,$t[wt]);var pn=Vt.values;for(wt=0;wt<pn.length;wt++)ot.writeMessage(4,Je,pn[wt])}function De(nt,ot){var wt=nt.feature;wt.id!==void 0&&ot.writeVarintField(1,wt.id),ot.writeMessage(2,Se,nt),ot.writeVarintField(3,wt.type),ot.writeMessage(4,Te,wt)}function Se(nt,ot){var wt=nt.feature,Vt=nt.keys,$t=nt.values,pn=nt.keycache,kn=nt.valuecache;for(var En in wt.properties){var Mn=wt.properties[En],ki=pn[En];if(Mn!==null){ki===void 0&&(Vt.push(En),pn[En]=ki=Vt.length-1),ot.writeVarint(ki);var vi=typeof Mn;vi!=="string"&&vi!=="boolean"&&vi!=="number"&&(Mn=JSON.stringify(Mn));var Xn=vi+":"+Mn,Oi=kn[Xn];Oi===void 0&&($t.push(Mn),kn[Xn]=Oi=$t.length-1),ot.writeVarint(Oi)}}}function Fe(nt,ot){return(ot<<3)+(7&nt)}function He(nt){return nt<<1^nt>>31}function Te(nt,ot){for(var wt=nt.loadGeometry(),Vt=nt.type,$t=0,pn=0,kn=wt.length,En=0;En<kn;En++){var Mn=wt[En],ki=1;Vt===1&&(ki=Mn.length),ot.writeVarint(Fe(1,ki));for(var vi=Vt===3?Mn.length-1:Mn.length,Xn=0;Xn<vi;Xn++){Xn===1&&Vt!==1&&ot.writeVarint(Fe(2,vi-1));var Oi=Mn[Xn].x-$t,Si=Mn[Xn].y-pn;ot.writeVarint(He(Oi)),ot.writeVarint(He(Si)),$t+=Oi,pn+=Si}Vt===3&&ot.writeVarint(Fe(7,1))}}function Je(nt,ot){var wt=typeof nt;wt==="string"?ot.writeStringField(1,nt):wt==="boolean"?ot.writeBooleanField(7,nt):wt==="number"&&(nt%1!=0?ot.writeDoubleField(3,nt):nt<0?ot.writeSVarintField(6,nt):ot.writeVarintField(5,nt))}return mt.exports=ce,mt.exports.fromVectorTileJs=ce,mt.exports.fromGeojsonVt=function(nt,ot){ot=ot||{};var wt={};for(var Vt in nt)wt[Vt]=new oe(nt[Vt].features,ot),wt[Vt].name=Vt,wt[Vt].version=ot.version,wt[Vt].extent=ot.extent;return ce({layers:wt})},mt.exports.GeoJSONWrapper=oe,mt.exports}(),en=r.e8(It);let dn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:tt=>tt},Ft=Math.fround||(Dn=new Float32Array(1),tt=>(Dn[0]=+tt,Dn[0]));var Dn;let An=3,_n=5,qi=6;class mr{constructor(oe){this.options=Object.assign(Object.create(dn),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){let{log:ce,minZoom:_e,maxZoom:De}=this.options;ce&&console.time("total time");let Se=`prepare ${oe.length} points`;ce&&console.time(Se),this.points=oe;let Fe=[];for(let Te=0;Te<oe.length;Te++){let Je=oe[Te];if(!Je.geometry)continue;let[nt,ot]=Je.geometry.coordinates,wt=Ft(on(nt)),Vt=Ft(Zn(ot));Fe.push(wt,Vt,1/0,Te,-1,1),this.options.reduce&&Fe.push(0)}let He=this.trees[De+1]=this._createTree(Fe);ce&&console.timeEnd(Se);for(let Te=De;Te>=_e;Te--){let Je=+Date.now();He=this.trees[Te]=this._createTree(this._cluster(He,Te)),ce&&console.log("z%d: %d clusters in %dms",Te,He.numItems,+Date.now()-Je)}return ce&&console.timeEnd("total time"),this}getClusters(oe,ce){let _e=((oe[0]+180)%360+360)%360-180,De=Math.max(-90,Math.min(90,oe[1])),Se=oe[2]===180?180:((oe[2]+180)%360+360)%360-180,Fe=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)_e=-180,Se=180;else if(_e>Se){let ot=this.getClusters([_e,De,180,Fe],ce),wt=this.getClusters([-180,De,Se,Fe],ce);return ot.concat(wt)}let He=this.trees[this._limitZoom(ce)],Te=He.range(on(_e),Zn(Fe),on(Se),Zn(De)),Je=He.data,nt=[];for(let ot of Te){let wt=this.stride*ot;nt.push(Je[wt+_n]>1?gr(Je,wt,this.clusterProps):this.points[Je[wt+An]])}return nt}getChildren(oe){let ce=this._getOriginId(oe),_e=this._getOriginZoom(oe),De="No cluster with the specified id.",Se=this.trees[_e];if(!Se)throw new Error(De);let Fe=Se.data;if(ce*this.stride>=Fe.length)throw new Error(De);let He=this.options.radius/(this.options.extent*Math.pow(2,_e-1)),Te=Se.within(Fe[ce*this.stride],Fe[ce*this.stride+1],He),Je=[];for(let nt of Te){let ot=nt*this.stride;Fe[ot+4]===oe&&Je.push(Fe[ot+_n]>1?gr(Fe,ot,this.clusterProps):this.points[Fe[ot+An]])}if(Je.length===0)throw new Error(De);return Je}getLeaves(oe,ce,_e){let De=[];return this._appendLeaves(De,oe,ce=ce||10,_e=_e||0,0),De}getTile(oe,ce,_e){let De=this.trees[this._limitZoom(oe)],Se=Math.pow(2,oe),{extent:Fe,radius:He}=this.options,Te=He/Fe,Je=(_e-Te)/Se,nt=(_e+1+Te)/Se,ot={features:[]};return this._addTileFeatures(De.range((ce-Te)/Se,Je,(ce+1+Te)/Se,nt),De.data,ce,_e,Se,ot),ce===0&&this._addTileFeatures(De.range(1-Te/Se,Je,1,nt),De.data,Se,_e,Se,ot),ce===Se-1&&this._addTileFeatures(De.range(0,Je,Te/Se,nt),De.data,-1,_e,Se,ot),ot.features.length?ot:null}getClusterExpansionZoom(oe){let ce=this._getOriginZoom(oe)-1;for(;ce<=this.options.maxZoom;){let _e=this.getChildren(oe);if(ce++,_e.length!==1)break;oe=_e[0].properties.cluster_id}return ce}_appendLeaves(oe,ce,_e,De,Se){let Fe=this.getChildren(ce);for(let He of Fe){let Te=He.properties;if(Te&&Te.cluster?Se+Te.point_count<=De?Se+=Te.point_count:Se=this._appendLeaves(oe,Te.cluster_id,_e,De,Se):Se<De?Se++:oe.push(He),oe.length===_e)break}return Se}_createTree(oe){let ce=new r.bE(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _e=0;_e<oe.length;_e+=this.stride)ce.add(oe[_e],oe[_e+1]);return ce.finish(),ce.data=oe,ce}_addTileFeatures(oe,ce,_e,De,Se,Fe){for(let He of oe){let Te=He*this.stride,Je=ce[Te+_n]>1,nt,ot,wt;if(Je)nt=Ee(ce,Te,this.clusterProps),ot=ce[Te],wt=ce[Te+1];else{let pn=this.points[ce[Te+An]];nt=pn.properties;let[kn,En]=pn.geometry.coordinates;ot=on(kn),wt=Zn(En)}let Vt={type:1,geometry:[[Math.round(this.options.extent*(ot*Se-_e)),Math.round(this.options.extent*(wt*Se-De))]],tags:nt},$t;$t=Je||this.options.generateId?ce[Te+An]:this.points[ce[Te+An]].id,$t!==void 0&&(Vt.id=$t),Fe.features.push(Vt)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,ce){let{radius:_e,extent:De,reduce:Se,minPoints:Fe}=this.options,He=_e/(De*Math.pow(2,ce)),Te=oe.data,Je=[],nt=this.stride;for(let ot=0;ot<Te.length;ot+=nt){if(Te[ot+2]<=ce)continue;Te[ot+2]=ce;let wt=Te[ot],Vt=Te[ot+1],$t=oe.within(Te[ot],Te[ot+1],He),pn=Te[ot+_n],kn=pn;for(let En of $t){let Mn=En*nt;Te[Mn+2]>ce&&(kn+=Te[Mn+_n])}if(kn>pn&&kn>=Fe){let En,Mn=wt*pn,ki=Vt*pn,vi=-1,Xn=(ot/nt<<5)+(ce+1)+this.points.length;for(let Oi of $t){let Si=Oi*nt;if(Te[Si+2]<=ce)continue;Te[Si+2]=ce;let qr=Te[Si+_n];Mn+=Te[Si]*qr,ki+=Te[Si+1]*qr,Te[Si+4]=Xn,Se&&(En||(En=this._map(Te,ot,!0),vi=this.clusterProps.length,this.clusterProps.push(En)),Se(En,this._map(Te,Si)))}Te[ot+4]=Xn,Je.push(Mn/kn,ki/kn,1/0,Xn,-1,kn),Se&&Je.push(vi)}else{for(let En=0;En<nt;En++)Je.push(Te[ot+En]);if(kn>1)for(let En of $t){let Mn=En*nt;if(!(Te[Mn+2]<=ce)){Te[Mn+2]=ce;for(let ki=0;ki<nt;ki++)Je.push(Te[Mn+ki])}}}}return Je}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,ce,_e){if(oe[ce+_n]>1){let Fe=this.clusterProps[oe[ce+qi]];return _e?Object.assign({},Fe):Fe}let De=this.points[oe[ce+An]].properties,Se=this.options.map(De);return _e&&Se===De?Object.assign({},Se):Se}}function gr(tt,oe,ce){return{type:"Feature",id:tt[oe+An],properties:Ee(tt,oe,ce),geometry:{type:"Point",coordinates:[(_e=tt[oe],360*(_e-.5)),gi(tt[oe+1])]}};var _e}function Ee(tt,oe,ce){let _e=tt[oe+_n],De=_e>=1e4?`${Math.round(_e/1e3)}k`:_e>=1e3?Math.round(_e/100)/10+"k":_e,Se=tt[oe+qi],Fe=Se===-1?{}:Object.assign({},ce[Se]);return Object.assign(Fe,{cluster:!0,cluster_id:tt[oe+An],point_count:_e,point_count_abbreviated:De})}function on(tt){return tt/360+.5}function Zn(tt){let oe=Math.sin(tt*Math.PI/180),ce=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ce<0?0:ce>1?1:ce}function gi(tt){let oe=(180-360*tt)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function We(tt,oe,ce,_e){let De=_e,Se=oe+(ce-oe>>1),Fe,He=ce-oe,Te=tt[oe],Je=tt[oe+1],nt=tt[ce],ot=tt[ce+1];for(let wt=oe+3;wt<ce;wt+=3){let Vt=Nr(tt[wt],tt[wt+1],Te,Je,nt,ot);if(Vt>De)Fe=wt,De=Vt;else if(Vt===De){let $t=Math.abs(wt-Se);$t<He&&(Fe=wt,He=$t)}}De>_e&&(Fe-oe>3&&We(tt,oe,Fe,_e),tt[Fe+2]=De,ce-Fe>3&&We(tt,Fe,ce,_e))}function Nr(tt,oe,ce,_e,De,Se){let Fe=De-ce,He=Se-_e;if(Fe!==0||He!==0){let Te=((tt-ce)*Fe+(oe-_e)*He)/(Fe*Fe+He*He);Te>1?(ce=De,_e=Se):Te>0&&(ce+=Fe*Te,_e+=He*Te)}return Fe=tt-ce,He=oe-_e,Fe*Fe+He*He}function hi(tt,oe,ce,_e){let De={id:tt??null,type:oe,geometry:ce,tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")zr(De,ce);else if(oe==="Polygon")zr(De,ce[0]);else if(oe==="MultiLineString")for(let Se of ce)zr(De,Se);else if(oe==="MultiPolygon")for(let Se of ce)zr(De,Se[0]);return De}function zr(tt,oe){for(let ce=0;ce<oe.length;ce+=3)tt.minX=Math.min(tt.minX,oe[ce]),tt.minY=Math.min(tt.minY,oe[ce+1]),tt.maxX=Math.max(tt.maxX,oe[ce]),tt.maxY=Math.max(tt.maxY,oe[ce+1])}function Cn(tt,oe,ce,_e){if(!oe.geometry)return;let De=oe.geometry.coordinates;if(De&&De.length===0)return;let Se=oe.geometry.type,Fe=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),He=[],Te=oe.id;if(ce.promoteId?Te=oe.properties[ce.promoteId]:ce.generateId&&(Te=_e||0),Se==="Point")Er(De,He);else if(Se==="MultiPoint")for(let Je of De)Er(Je,He);else if(Se==="LineString")Xo(De,He,Fe,!1);else if(Se==="MultiLineString"){if(ce.lineMetrics){for(let Je of De)He=[],Xo(Je,He,Fe,!1),tt.push(hi(Te,"LineString",He,oe.properties));return}Ya(De,He,Fe,!1)}else if(Se==="Polygon")Ya(De,He,Fe,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for(let Je of oe.geometry.geometries)Cn(tt,{id:Te,geometry:Je,properties:oe.properties},ce,_e);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Je of De){let nt=[];Ya(Je,nt,Fe,!0),He.push(nt)}}tt.push(hi(Te,Se,He,oe.properties))}function Er(tt,oe){oe.push(Xa(tt[0]),ec(tt[1]),0)}function Xo(tt,oe,ce,_e){let De,Se,Fe=0;for(let Te=0;Te<tt.length;Te++){let Je=Xa(tt[Te][0]),nt=ec(tt[Te][1]);oe.push(Je,nt,0),Te>0&&(Fe+=_e?(De*nt-Je*Se)/2:Math.sqrt(Math.pow(Je-De,2)+Math.pow(nt-Se,2))),De=Je,Se=nt}let He=oe.length-3;oe[2]=1,We(oe,0,He,ce),oe[He+2]=1,oe.size=Math.abs(Fe),oe.start=0,oe.end=oe.size}function Ya(tt,oe,ce,_e){for(let De=0;De<tt.length;De++){let Se=[];Xo(tt[De],Se,ce,_e),oe.push(Se)}}function Xa(tt){return tt/360+.5}function ec(tt){let oe=Math.sin(tt*Math.PI/180),ce=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ce<0?0:ce>1?1:ce}function Rn(tt,oe,ce,_e,De,Se,Fe,He){if(_e/=oe,Se>=(ce/=oe)&&Fe<_e)return tt;if(Fe<ce||Se>=_e)return null;let Te=[];for(let Je of tt){let nt=Je.geometry,ot=Je.type,wt=De===0?Je.minX:Je.minY,Vt=De===0?Je.maxX:Je.maxY;if(wt>=ce&&Vt<_e){Te.push(Je);continue}if(Vt<ce||wt>=_e)continue;let $t=[];if(ot==="Point"||ot==="MultiPoint")Gc(nt,$t,ce,_e,De);else if(ot==="LineString")oa(nt,$t,ce,_e,De,!1,He.lineMetrics);else if(ot==="MultiLineString")Oo(nt,$t,ce,_e,De,!1);else if(ot==="Polygon")Oo(nt,$t,ce,_e,De,!0);else if(ot==="MultiPolygon")for(let pn of nt){let kn=[];Oo(pn,kn,ce,_e,De,!0),kn.length&&$t.push(kn)}if($t.length){if(He.lineMetrics&&ot==="LineString"){for(let pn of $t)Te.push(hi(Je.id,ot,pn,Je.tags));continue}ot!=="LineString"&&ot!=="MultiLineString"||($t.length===1?(ot="LineString",$t=$t[0]):ot="MultiLineString"),ot!=="Point"&&ot!=="MultiPoint"||(ot=$t.length===3?"Point":"MultiPoint"),Te.push(hi(Je.id,ot,$t,Je.tags))}}return Te.length?Te:null}function Gc(tt,oe,ce,_e,De){for(let Se=0;Se<tt.length;Se+=3){let Fe=tt[Se+De];Fe>=ce&&Fe<=_e&&Ms(oe,tt[Se],tt[Se+1],tt[Se+2])}}function oa(tt,oe,ce,_e,De,Se,Fe){let He=El(tt),Te=De===0?qc:Zc,Je,nt,ot=tt.start;for(let kn=0;kn<tt.length-3;kn+=3){let En=tt[kn],Mn=tt[kn+1],ki=tt[kn+2],vi=tt[kn+3],Xn=tt[kn+4],Oi=De===0?En:Mn,Si=De===0?vi:Xn,qr=!1;Fe&&(Je=Math.sqrt(Math.pow(En-vi,2)+Math.pow(Mn-Xn,2))),Oi<ce?Si>ce&&(nt=Te(He,En,Mn,vi,Xn,ce),Fe&&(He.start=ot+Je*nt)):Oi>_e?Si<_e&&(nt=Te(He,En,Mn,vi,Xn,_e),Fe&&(He.start=ot+Je*nt)):Ms(He,En,Mn,ki),Si<ce&&Oi>=ce&&(nt=Te(He,En,Mn,vi,Xn,ce),qr=!0),Si>_e&&Oi<=_e&&(nt=Te(He,En,Mn,vi,Xn,_e),qr=!0),!Se&&qr&&(Fe&&(He.end=ot+Je*nt),oe.push(He),He=El(tt)),Fe&&(ot+=Je)}let wt=tt.length-3,Vt=tt[wt],$t=tt[wt+1],pn=De===0?Vt:$t;pn>=ce&&pn<=_e&&Ms(He,Vt,$t,tt[wt+2]),wt=He.length-3,Se&&wt>=3&&(He[wt]!==He[0]||He[wt+1]!==He[1])&&Ms(He,He[0],He[1],He[2]),He.length&&oe.push(He)}function El(tt){let oe=[];return oe.size=tt.size,oe.start=tt.start,oe.end=tt.end,oe}function Oo(tt,oe,ce,_e,De,Se){for(let Fe of tt)oa(Fe,oe,ce,_e,De,Se,!1)}function Ms(tt,oe,ce,_e){tt.push(oe,ce,_e)}function qc(tt,oe,ce,_e,De,Se){let Fe=(Se-oe)/(_e-oe);return Ms(tt,Se,ce+(De-ce)*Fe,1),Fe}function Zc(tt,oe,ce,_e,De,Se){let Fe=(Se-ce)/(De-ce);return Ms(tt,oe+(_e-oe)*Fe,Se,1),Fe}function Wc(tt,oe){let ce=[];for(let _e=0;_e<tt.length;_e++){let De=tt[_e],Se=De.type,Fe;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")Fe=Da(De.geometry,oe);else if(Se==="MultiLineString"||Se==="Polygon"){Fe=[];for(let He of De.geometry)Fe.push(Da(He,oe))}else if(Se==="MultiPolygon"){Fe=[];for(let He of De.geometry){let Te=[];for(let Je of He)Te.push(Da(Je,oe));Fe.push(Te)}}ce.push(hi(De.id,Se,Fe,De.tags))}return ce}function Da(tt,oe){let ce=[];ce.size=tt.size,tt.start!==void 0&&(ce.start=tt.start,ce.end=tt.end);for(let _e=0;_e<tt.length;_e+=3)ce.push(tt[_e]+oe,tt[_e+1],tt[_e+2]);return ce}function Ka(tt,oe){if(tt.transformed)return tt;let ce=1<<tt.z,_e=tt.x,De=tt.y;for(let Se of tt.features){let Fe=Se.geometry,He=Se.type;if(Se.geometry=[],He===1)for(let Te=0;Te<Fe.length;Te+=2)Se.geometry.push(tc(Fe[Te],Fe[Te+1],oe,ce,_e,De));else for(let Te=0;Te<Fe.length;Te++){let Je=[];for(let nt=0;nt<Fe[Te].length;nt+=2)Je.push(tc(Fe[Te][nt],Fe[Te][nt+1],oe,ce,_e,De));Se.geometry.push(Je)}}return tt.transformed=!0,tt}function tc(tt,oe,ce,_e,De,Se){return[Math.round(ce*(tt*_e-De)),Math.round(ce*(oe*_e-Se))]}function Ls(tt,oe,ce,_e,De){let Se=oe===De.maxZoom?0:De.tolerance/((1<<oe)*De.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:tt.length,source:null,x:ce,y:_e,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let He of tt)Ja(Fe,He,Se,De);return Fe}function Ja(tt,oe,ce,_e){let De=oe.geometry,Se=oe.type,Fe=[];if(tt.minX=Math.min(tt.minX,oe.minX),tt.minY=Math.min(tt.minY,oe.minY),tt.maxX=Math.max(tt.maxX,oe.maxX),tt.maxY=Math.max(tt.maxY,oe.maxY),Se==="Point"||Se==="MultiPoint")for(let He=0;He<De.length;He+=3)Fe.push(De[He],De[He+1]),tt.numPoints++,tt.numSimplified++;else if(Se==="LineString")Wn(Fe,De,tt,ce,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(let He=0;He<De.length;He++)Wn(Fe,De[He],tt,ce,Se==="Polygon",He===0);else if(Se==="MultiPolygon")for(let He=0;He<De.length;He++){let Te=De[He];for(let Je=0;Je<Te.length;Je++)Wn(Fe,Te[Je],tt,ce,!0,Je===0)}if(Fe.length){let He=oe.tags||null;if(Se==="LineString"&&_e.lineMetrics){He={};for(let Je in oe.tags)He[Je]=oe.tags[Je];He.mapbox_clip_start=De.start/De.size,He.mapbox_clip_end=De.end/De.size}let Te={geometry:Fe,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:He};oe.id!==null&&(Te.id=oe.id),tt.features.push(Te)}}function Wn(tt,oe,ce,_e,De,Se){let Fe=_e*_e;if(_e>0&&oe.size<(De?Fe:_e))return void(ce.numPoints+=oe.length/3);let He=[];for(let Te=0;Te<oe.length;Te+=3)(_e===0||oe[Te+2]>Fe)&&(ce.numSimplified++,He.push(oe[Te],oe[Te+1])),ce.numPoints++;De&&function(Te,Je){let nt=0;for(let ot=0,wt=Te.length,Vt=wt-2;ot<wt;Vt=ot,ot+=2)nt+=(Te[ot]-Te[Vt])*(Te[ot+1]+Te[Vt+1]);if(nt>0===Je)for(let ot=0,wt=Te.length;ot<wt/2;ot+=2){let Vt=Te[ot],$t=Te[ot+1];Te[ot]=Te[wt-2-ot],Te[ot+1]=Te[wt-1-ot],Te[wt-2-ot]=Vt,Te[wt-1-ot]=$t}}(He,Se),tt.push(He)}let Oa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Fu{constructor(oe,ce){let _e=(ce=this.options=function(Se,Fe){for(let He in Fe)Se[He]=Fe[He];return Se}(Object.create(Oa),ce)).debug;if(_e&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let De=function(Se,Fe){let He=[];if(Se.type==="FeatureCollection")for(let Te=0;Te<Se.features.length;Te++)Cn(He,Se.features[Te],Fe,Te);else Cn(He,Se.type==="Feature"?Se:{geometry:Se},Fe);return He}(oe,ce);this.tiles={},this.tileCoords=[],_e&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),De=function(Se,Fe){let He=Fe.buffer/Fe.extent,Te=Se,Je=Rn(Se,1,-1-He,He,0,-1,2,Fe),nt=Rn(Se,1,1-He,2+He,0,-1,2,Fe);return(Je||nt)&&(Te=Rn(Se,1,-He,1+He,0,-1,2,Fe)||[],Je&&(Te=Wc(Je,1).concat(Te)),nt&&(Te=Te.concat(Wc(nt,-1)))),Te}(De,ce),De.length&&this.splitTile(De,0,0,0),_e&&(De.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,ce,_e,De,Se,Fe,He){let Te=[oe,ce,_e,De],Je=this.options,nt=Je.debug;for(;Te.length;){De=Te.pop(),_e=Te.pop(),ce=Te.pop(),oe=Te.pop();let ot=1<<ce,wt=Uo(ce,_e,De),Vt=this.tiles[wt];if(!Vt&&(nt>1&&console.time("creation"),Vt=this.tiles[wt]=Ls(oe,ce,_e,De,Je),this.tileCoords.push({z:ce,x:_e,y:De}),nt)){nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,_e,De,Vt.numFeatures,Vt.numPoints,Vt.numSimplified),console.timeEnd("creation"));let qr=`z${ce}`;this.stats[qr]=(this.stats[qr]||0)+1,this.total++}if(Vt.source=oe,Se==null){if(ce===Je.indexMaxZoom||Vt.numPoints<=Je.indexMaxPoints)continue}else{if(ce===Je.maxZoom||ce===Se)continue;if(Se!=null){let qr=Se-ce;if(_e!==Fe>>qr||De!==He>>qr)continue}}if(Vt.source=null,oe.length===0)continue;nt>1&&console.time("clipping");let $t=.5*Je.buffer/Je.extent,pn=.5-$t,kn=.5+$t,En=1+$t,Mn=null,ki=null,vi=null,Xn=null,Oi=Rn(oe,ot,_e-$t,_e+kn,0,Vt.minX,Vt.maxX,Je),Si=Rn(oe,ot,_e+pn,_e+En,0,Vt.minX,Vt.maxX,Je);oe=null,Oi&&(Mn=Rn(Oi,ot,De-$t,De+kn,1,Vt.minY,Vt.maxY,Je),ki=Rn(Oi,ot,De+pn,De+En,1,Vt.minY,Vt.maxY,Je),Oi=null),Si&&(vi=Rn(Si,ot,De-$t,De+kn,1,Vt.minY,Vt.maxY,Je),Xn=Rn(Si,ot,De+pn,De+En,1,Vt.minY,Vt.maxY,Je),Si=null),nt>1&&console.timeEnd("clipping"),Te.push(Mn||[],ce+1,2*_e,2*De),Te.push(ki||[],ce+1,2*_e,2*De+1),Te.push(vi||[],ce+1,2*_e+1,2*De),Te.push(Xn||[],ce+1,2*_e+1,2*De+1)}}getTile(oe,ce,_e){oe=+oe,ce=+ce,_e=+_e;let De=this.options,{extent:Se,debug:Fe}=De;if(oe<0||oe>24)return null;let He=1<<oe,Te=Uo(oe,ce=ce+He&He-1,_e);if(this.tiles[Te])return Ka(this.tiles[Te],Se);Fe>1&&console.log("drilling down to z%d-%d-%d",oe,ce,_e);let Je,nt=oe,ot=ce,wt=_e;for(;!Je&&nt>0;)nt--,ot>>=1,wt>>=1,Je=this.tiles[Uo(nt,ot,wt)];return Je&&Je.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",nt,ot,wt),console.time("drilling down")),this.splitTile(Je.source,nt,ot,wt,oe,ce,_e),Fe>1&&console.timeEnd("drilling down"),this.tiles[Te]?Ka(this.tiles[Te],Se):null):null}}function Uo(tt,oe,ce){return 32*((1<<tt)*ce+oe)+tt}function Sl(tt,oe){let ce=tt.tileID.canonical;if(!this._geoJSONIndex)return void oe(null,null);let _e=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!_e)return void oe(null,null);let De=new Ut(_e.features),Se=en(De);Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),oe(null,{vectorTile:De,rawData:Se.buffer})}class Nu extends Ze{constructor(oe,ce,_e,De,Se,Fe){super(oe,ce,_e,De,Sl,Fe),Se&&(this.loadGeoJSON=Se),this._dynamicIndex=new yt}loadData(oe,ce){let _e=oe&&oe.request,De=_e&&_e.collectResourceTiming;this.loadGeoJSON(oe,(Se,Fe)=>{if(Se||!Fe)return ce(Se);if(typeof Fe!="object")return ce(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));{try{if(oe.filter){let Te=r.U(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(Je=>`${Je.key}: ${Je.message}`).join(", "));Fe.features=Fe.features.filter(Je=>Te.value.evaluate({zoom:0},Je))}oe.dynamic?(Fe.type==="Feature"&&(Fe={type:"FeatureCollection",features:[Fe]}),oe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Fe.features,this.loaded),oe.cluster&&(Fe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=oe.cluster?new mr(function({superclusterOptions:Te,clusterProperties:Je}){if(!Je||!Te)return Te;let nt={},ot={},wt={accumulated:null,zoom:0},Vt={properties:null},$t=Object.keys(Je);for(let pn of $t){let[kn,En]=Je[pn],Mn=r.U(En),ki=r.U(typeof kn=="string"?[kn,["accumulated"],["get",pn]]:kn);nt[pn]=Mn.value,ot[pn]=ki.value}return Te.map=pn=>{Vt.properties=pn;let kn={};for(let En of $t)kn[En]=nt[En].evaluate(wt,Vt);return kn},Te.reduce=(pn,kn)=>{Vt.properties=kn;for(let En of $t)wt.accumulated=pn[En],pn[En]=ot[En].evaluate(wt,Vt)},Te}(oe)).load(Fe.features):oe.dynamic?this._dynamicIndex:function(Te,Je){return new Fu(Te,Je)}(Fe,oe.geojsonVtOptions)}catch(Te){return ce(Te)}let He={};if(De){let Te=w(_e);Te&&(He.resourceTiming={},He.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Te)))}ce(null,He)}})}reloadTile(oe,ce){let _e=this.loaded;return _e&&_e[oe.uid]?oe.partial?ce(null,void 0):super.reloadTile(oe,ce):this.loadTile(oe,ce)}loadGeoJSON(oe,ce){if(oe.request)r.n(oe.request,ce);else{if(typeof oe.data!="string")return ce(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));try{return ce(null,JSON.parse(oe.data))}catch{return ce(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(oe,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(_e){ce(_e)}}getClusterChildren(oe,ce){try{ce(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(_e){ce(_e)}}getClusterLeaves(oe,ce){try{ce(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(_e){ce(_e)}}}class zu{constructor(oe,ce){this.tileID=new r.aG(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=oe.projection,this.brightness=ce}parse(oe,ce,_e,De){this.status="parsing";let Se=new r.aG(_e.tileID.overscaledZ,_e.tileID.wrap,_e.tileID.canonical.z,_e.tileID.canonical.x,_e.tileID.canonical.y),Fe=[],He=ce.familiesBySource[_e.source],Te=new r.dZ(Se,_e.promoteId);return Te.bucketLayerIDs=[],Te.is3DTile=!0,r.e9(oe).then(Je=>{if(!Je)return De(new Error("Could not parse tile"));let nt=r.ea(Je,1/r.cc(_e.tileID.canonical)),ot=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("MAPBOX_mesh_features")||Je.json.asset.extras&&Je.json.asset.extras.MAPBOX_mesh_features,wt=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("EXT_meshopt_compression"),Vt=new r.a8(this.zoom,{brightness:this.brightness});for(let $t in He)for(let pn of He[$t]){let kn=pn[0];Te.bucketLayerIDs.push(pn.map(Mn=>r.aC(Mn.id,Mn.scope))),kn.recalculate(Vt,[]);let En=new r.eb(pn,nt,Se,ot,wt,this.brightness,Te);ot||(En.needsUpload=!0),Fe.push(En),En.evaluate(kn)}this.status="done",De(null,{buckets:Fe,featureIndex:Te,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Je=>De(new Error(Je.message)))}}class Yc{constructor(oe,ce,_e,De,Se,Fe){this.actor=oe,this.layerIndex=ce,this.availableImages=_e,this.brightness=Fe,this.loading={},this.loaded={}}loadTile(oe,ce){let _e=oe.uid,De=this.loading[_e]=new zu(oe,this.brightness);r.bi(oe.request,(Se,Fe)=>{let He=!this.loading[_e];return delete this.loading[_e],He||Se?(De.status="done",He||(this.loaded[_e]=De),ce(Se)):Fe&&Fe.byteLength!==0?void De.parse(Fe,this.layerIndex,oe,(Te,Je)=>{De.status="done",this.loaded=this.loaded||{},this.loaded[_e]=De,Te||!Je?ce(Te):ce(null,Je)}):(De.status="done",this.loaded[_e]=De,ce())})}reloadTile(oe,ce){let _e=this.loaded,De=oe.uid;if(_e&&_e[De]){let Se=_e[De];Se.projection=oe.projection,Se.brightness=oe.brightness;let Fe=(He,Te)=>{Se.reloadCallback&&(delete Se.reloadCallback,this.loadTile(oe,ce)),ce(He,Te)};Se.status==="parsing"?Se.reloadCallback=Fe:Se.status==="done"&&this.loadTile(oe,ce)}}abortTile(oe,ce){let _e=oe.uid;this.loading[_e]&&delete this.loading[_e],ce()}removeTile(oe,ce){let _e=this.loaded,De=oe.uid;_e&&_e[De]&&delete _e[De],ce()}}class Bu{constructor(oe){this.self=oe,this.actor=new r.ec(oe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new r.I,this.projections={},this.defaultProjection=r.bP({name:"mercator"}),this.workerSourceTypes={vector:Ze,geojson:Nu,"batched-model":Yc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ce,_e)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=_e},this.self.registerRTLTextPlugin=ce=>{if(r.ed.isParsed())throw new Error("RTL text plugin already registered.");r.ed.applyArabicShaping=ce.applyArabicShaping,r.ed.processBidirectionalText=ce.processBidirectionalText,r.ed.processStyledBidirectionalText=ce.processStyledBidirectionalText}}clearCaches(oe,ce,_e){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.workerSources[oe],delete this.demWorkerSources[oe],delete this.rasterArrayWorkerSource,_e()}checkIfReady(oe,ce,_e){_e()}setReferrer(oe,ce){this.referrer=ce}spriteLoaded(oe,{scope:ce,isLoaded:_e}){if(this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),this.isSpriteLoaded[oe][ce]=_e,this.workerSources[oe]&&this.workerSources[oe][ce])for(let De in this.workerSources[oe][ce]){let Se=this.workerSources[oe][ce][De];for(let Fe in Se){let He=Se[Fe];He instanceof Ze&&(He.isSpriteLoaded=_e,He.fire(new r.z("isSpriteLoaded")))}}}setImages(oe,{scope:ce,images:_e},De){if(this.availableImages[oe]||(this.availableImages[oe]={}),this.availableImages[oe][ce]=_e,this.workerSources[oe]&&this.workerSources[oe][ce]){for(let Se in this.workerSources[oe][ce]){let Fe=this.workerSources[oe][ce][Se];for(let He in Fe)Fe[He].availableImages=_e}De()}else De()}setProjection(oe,ce){this.projections[oe]=r.bP(ce)}setBrightness(oe,ce,_e){this.brightness=ce,_e()}setLayers(oe,ce,_e){this.getLayerIndex(oe,ce.scope).replace(ce.layers,ce.options),_e()}updateLayers(oe,ce,_e){this.getLayerIndex(oe,ce.scope).update(ce.layers,ce.removedIds,ce.options),_e()}loadTile(oe,ce,_e){ce.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,ce.type,ce.source,ce.scope).loadTile(ce,_e)}loadDEMTile(oe,ce,_e){this.getDEMWorkerSource(oe,ce.source,ce.scope).loadTile(ce,_e)}decodeRasterArray(oe,ce,_e){this.getRasterArrayWorkerSource().decodeRasterArray(ce,_e)}reloadTile(oe,ce,_e){ce.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,ce.type,ce.source,ce.scope).reloadTile(ce,_e)}abortTile(oe,ce,_e){this.getWorkerSource(oe,ce.type,ce.source,ce.scope).abortTile(ce,_e)}removeTile(oe,ce,_e){this.getWorkerSource(oe,ce.type,ce.source,ce.scope).removeTile(ce,_e)}removeSource(oe,ce,_e){if(!(this.workerSources[oe]&&this.workerSources[oe][ce.scope]&&this.workerSources[oe][ce.scope][ce.type]&&this.workerSources[oe][ce.scope][ce.type][ce.source]))return;let De=this.workerSources[oe][ce.scope][ce.type][ce.source];delete this.workerSources[oe][ce.scope][ce.type][ce.source],De.removeSource!==void 0?De.removeSource(ce,_e):_e()}loadWorkerSource(oe,ce,_e){try{this.self.importScripts(ce.url),_e()}catch(De){_e(De.toString())}}syncRTLPluginState(oe,ce,_e){try{r.ed.setState(ce);let De=r.ed.getPluginURL();if(r.ed.isLoaded()&&!r.ed.isParsed()&&De!=null){this.self.importScripts(De);let Se=r.ed.isParsed();_e(Se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${De}`),Se)}}catch(De){_e(De.toString())}}setDracoUrl(oe,ce){this.dracoUrl=ce}getAvailableImages(oe,ce){this.availableImages[oe]||(this.availableImages[oe]={});let _e=this.availableImages[oe][ce];return _e||(_e=[]),_e}getLayerIndex(oe,ce){this.layerIndexes[oe]||(this.layerIndexes[oe]={});let _e=this.layerIndexes[oe][ce];return _e||(_e=this.layerIndexes[oe][ce]=new $,_e.scope=ce),_e}getWorkerSource(oe,ce,_e,De){return this.workerSources[oe]||(this.workerSources[oe]={}),this.workerSources[oe][De]||(this.workerSources[oe][De]={}),this.workerSources[oe][De][ce]||(this.workerSources[oe][De][ce]={}),this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),this.workerSources[oe][De][ce][_e]||(this.workerSources[oe][De][ce][_e]=new this.workerSourceTypes[ce]({send:(Se,Fe,He,Te,Je,nt)=>{this.actor.send(Se,Fe,He,oe,Je,nt)},scheduler:this.actor.scheduler},this.getLayerIndex(oe,De),this.getAvailableImages(oe,De),this.isSpriteLoaded[oe][De],void 0,this.brightness)),this.workerSources[oe][De][ce][_e]}rasterizeImages(oe,ce,_e){let{imageTasks:De,scope:Se}=ce,Fe={};for(let He in De){let{image:Te,imageIdWithOptions:Je}=De[He];Fe[He]=this.imageRasterizer.rasterize(Je,Te,Se,oe)}_e(void 0,Fe)}removeRasterizedImages(oe,ce,_e){let{imageIds:De,scope:Se}=ce;this.imageRasterizer.removeImagesFromCacheByIds(De,Se,oe),_e()}getDEMWorkerSource(oe,ce,_e){return this.demWorkerSources[oe]||(this.demWorkerSources[oe]={}),this.demWorkerSources[oe][_e]||(this.demWorkerSources[oe][_e]={}),this.demWorkerSources[oe][_e][ce]||(this.demWorkerSources[oe][_e][ce]=new Ue),this.demWorkerSources[oe][_e][ce]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new ft),this.rasterArrayWorkerSource}enforceCacheSizeLimit(oe,ce){r.ee(ce)}getWorkerPerformanceMetrics(oe,ce,_e){_e(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Bu(self)),Bu}),s(["./shared"],function(r){var w="3.9.2";let A={create:"create",load:"load",fullLoad:"fullLoad"},F={mark(f){performance.mark(f)},measure(f,o,l){performance.measure(f,o,l)}};function $(f){let o=f.name.split("?")[0];return r.a(o)&&o.includes("mapbox-gl.js")?"javascript":r.a(o)&&o.includes("mapbox-gl.css")?"css":r.b(o)?"fontRange":r.c(o)?"sprite":r.i(o)?"style":r.d(o)?"tilejson":"other"}var K,se={},le=function(){if(K)return se;function f(p){return!o(p)}function o(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,C,D=new Blob([""],{type:"text/javascript"}),k=URL.createObjectURL(D);try{C=new Worker(k),v=!0}catch{v=!1}return C&&C.terminate(),URL.revokeObjectURL(k),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var C=v.getContext("2d");if(!C)return!1;var D=C.getImageData(0,0,1,1);return D&&D.width===v.width}()?(l[y=p&&p.failIfMajorPerformanceCaveat]===void 0&&(l[y]=function(v){var C,D=function(k){var N=document.createElement("canvas"),B=Object.create(f.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=k,N.getContext("webgl2",B)}(v);if(!D)return!1;try{C=D.createShader(D.VERTEX_SHADER)}catch{return!1}return!(!C||D.isContextLost())&&(D.shaderSource(C,"void main() {}"),D.compileShader(C),D.getShaderParameter(C,D.COMPILE_STATUS)===!0)}(y)),l[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}K=1,se.supported=f,se.notSupportedReason=o;var l={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},se}();function ae(f,o,l){let p=document.createElement(f);return o!=null&&(p.className=o),l&&l.appendChild(p),p}function Ze(f,o,l){let p=document.createElementNS("http://www.w3.org/2000/svg",f);for(let y of Object.keys(o))p.setAttributeNS(null,y,String(o[y]));return l&&l.appendChild(p),p}let Ue=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ft=Ue&&Ue.userSelect!==void 0?"userSelect":"WebkitUserSelect",Xe;function st(){Ue&&ft&&(Xe=Ue[ft],Ue[ft]="none")}function Ut(){Ue&&ft&&(Ue[ft]=Xe)}function Bt(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Bt,!0)}function xt(){window.addEventListener("click",Bt,!0),window.setTimeout(()=>{window.removeEventListener("click",Bt,!0)},0)}function yt(f,o){let l=f.getBoundingClientRect();return Tt(f,l,o)}function rn(f,o){let l=f.getBoundingClientRect(),p=[];for(let y=0;y<o.length;y++)p.push(Tt(f,l,o[y]));return p}function Dt(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Tt(f,o,l){let p=f.offsetWidth===o.width?1:f.offsetWidth/o.width;return new r.P((l.clientX-o.left)*p,(l.clientY-o.top)*p)}let ri="01",er="NO_ACCESS_TOKEN";class ln{constructor(o,l,p){this._transformRequestFn=o,this._customAccessToken=l,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){let o=function(){let l="";for(let p=0;p<10;p++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ri,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,l){return this._transformRequestFn&&this._transformRequestFn(o,l)||{url:o}}normalizeStyleURL(o,l){if(!r.f(o))return o;let p=je(o);return p.params.push(`sdk=js-${w}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeGlyphsURL(o,l){if(!r.f(o))return o;let p=je(o);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeModelURL(o,l){if(!r.f(o))return o;let p=je(o);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeSourceURL(o,l,p,y){if(!r.f(o))return o;let v=je(o);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),p&&v.params.push(`language=${p}`),y&&v.params.push(`worldview=${y}`),this._makeAPIURL(v,this._customAccessToken||l)}normalizeIconsetURL(o,l){let p=je(o);return r.f(o)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||l)):At(p)}normalizeSpriteURL(o,l,p,y){let v=je(o);return r.f(o)?(v.path=`/styles/v1${v.path}/sprite${l}${p}`,this._makeAPIURL(v,this._customAccessToken||y)):(v.path+=`${l}${p}`,At(v))}normalizeTileURL(o,l,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!r.f(o))return o;let y=je(o);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||p&&y.authority!=="raster"&&p===512?"@2x":""}${r.m.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${r.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${r.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${r.e.TILE_URL_VERSION}${y.path}`);let v=this._customAccessToken||function(C){for(let D of C){let k=D.match(/^access_token=(.*)$/);if(k)return k[1]}return null}(y.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,v)}canonicalizeTileURL(o,l){let p=je(o);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return o;let y="mapbox://";p.path.match(/^\/raster\/v1\//)?y+=`raster/${p.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${p.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${p.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let v=p.params;return l&&(v=v.filter(C=>!C.match(/^access_token=/))),v.length&&(y+=`?${v.join("&")}`),y}canonicalizeTileset(o,l){let p=!!l&&r.f(l),y=[];for(let v of o.tiles||[])r.h(v)?y.push(this.canonicalizeTileURL(v,p)):y.push(v);return y}_makeAPIURL(o,l){let p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=je(r.e.API_URL);if(o.protocol=y.protocol,o.authority=y.authority,o.protocol==="http"){let v=o.params.indexOf("secure");v>=0&&o.params.splice(v,1)}if(y.path!=="/"&&(o.path=`${y.path}${o.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return At(o);if(l=l||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return o.params=o.params.filter(v=>v.indexOf("access_token")===-1),o.params.push(`access_token=${l||""}`),At(o)}}let Mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function je(f){let o=f.match(Mt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function At(f){let o=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${o}`}let Ke="mapbox.eventData";function mt(f){if(!f)return null;let o=f.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(r.j(o[1]))}catch{return null}}class It{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){let l=mt(r.e.ACCESS_TOKEN),p="";return p=l&&l.u?r.k(l.u):r.e.ACCESS_TOKEN||"",o?`${Ke}.${o}:${p}`:`${Ke}:${p}`}fetchEventData(){let o=r.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid");if(o)try{let y=localStorage.getItem(l);y&&(this.eventData=JSON.parse(y));let v=localStorage.getItem(p);v&&(this.anonId=v)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){let o=r.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.anonId;if(o&&y)try{localStorage.setItem(p,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,p,y){if(!r.e.EVENTS_URL)return;let v=je(r.e.EVENTS_URL);v.params.push(`access_token=${y||r.e.ACCESS_TOKEN||""}`);let C={event:this.type,created:new Date(o).toISOString()},D=l?r.l(C,l):C,k={url:At(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};this.pendingRequest=r.p(k,N=>{this.pendingRequest=null,p(N),this.saveEventData(),this.processRequests(y)})}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}let en=new class extends It{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,o){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(l=>r.f(l)||r.h(l))&&this.queueRequest(Date.now(),o)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let o=mt(r.e.ACCESS_TOKEN),l=o?o.u:r.e.ACCESS_TOKEN,p=l!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),p=!0);let y=this.queue.shift();if(this.eventData.lastSuccess){let v=new Date(this.eventData.lastSuccess),C=new Date(y),D=(y-this.eventData.lastSuccess)/864e5;p=p||D>=1||D<-1||v.getDate()!==C.getDate()}else p=!0;p?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:ri,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=y,this.eventData.tokenU=l)},f):this.processRequests()}},dn=en.postTurnstileEvent.bind(en),Ft=new class extends It{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,o,l,p){this.skuToken=o,this.errorCb=p,r.e.EVENTS_URL&&(l||r.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(er)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;let{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:ri,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):o&&(this.success[o]=!0)},f))}remove(){this.errorCb=null}},Dn=Ft.postMapLoadEvent.bind(Ft),An=new class extends It{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let o=this.mapInstanceIdMap.get(f);return o||(o=r.u(),this.mapInstanceIdMap.set(f,o)),o}getEventId(f){let o=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,o+1),o}postStyleLoadEvent(f,o){let{map:l,style:p,importedStyles:y}=o;if(!r.e.EVENTS_URL||!f&&!r.e.ACCESS_TOKEN)return;let v=this.getMapInstanceId(l),C={mapInstanceId:v,eventId:this.getEventId(v),style:p};y.length&&(C.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:C},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:o,payload:l}=this.queue.shift();this.postEvent(o,l,()=>{},f)}},_n=An.postStyleLoadEvent.bind(An),qi=new class extends It{constructor(){super("gljs.performance")}postPerformanceEvent(f,o){r.e.EVENTS_URL&&(f||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:o,performanceData:l}=this.queue.shift(),p=function(y){let v=performance.getEntriesByType("resource"),C=performance.getEntriesByType("mark"),D=function(q){let ee={};if(q){for(let Q in q)if(Q!=="other")for(let ie of q[Q]){let re=`${Q}ResolveRangeMin`,ue=`${Q}ResolveRangeMax`,ge=`${Q}RequestCount`,pe=`${Q}RequestCachedCount`;ee[re]=Math.min(ee[re]||1/0,ie.startTime),ee[ue]=Math.max(ee[ue]||-1/0,ie.responseEnd);let we=xe=>{ee[xe]===void 0&&(ee[xe]=0),++ee[xe]};ie.transferSize!==void 0&&ie.transferSize===0&&we(pe),we(ge)}}return ee}(function(q,ee){let Q={};if(q)for(let ie of q){let re=ee(ie);Q[re]===void 0&&(Q[re]=[]),Q[re].push(ie)}return Q}(v,$)),k=window.devicePixelRatio,N=navigator.connection||navigator.mozConnection||navigator.webkitConnection,B=N?N.effectiveType:void 0,H={counters:[],metadata:[],attributes:[]},U=(q,ee,Q)=>{Q!=null&&q.push({name:ee,value:Q.toString()})};for(let q in D)U(H.counters,q,D[q]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(U(H.counters,"interactionRangeMin",y.interactionRange[0]),U(H.counters,"interactionRangeMax",y.interactionRange[1])),C)for(let q of Object.keys(A)){let ee=A[q],Q=C.find(ie=>ie.name===ee);Q&&U(H.counters,ee,Q.startTime)}return U(H.counters,"visibilityHidden",y.visibilityHidden),U(H.attributes,"style",function(q){if(q)for(let ee of q){let Q=ee.name.split("?")[0];if(r.i(Q)){let ie=Q.split("/").slice(-2);if(ie.length===2)return`mapbox://styles/${ie[0]}/${ie[1]}`}}}(v)),U(H.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),U(H.attributes,"fogEnabled",y.fogEnabled?"true":"false"),U(H.attributes,"projection",y.projection),U(H.attributes,"zoom",y.zoom),U(H.metadata,"devicePixelRatio",k),U(H.metadata,"connectionEffectiveType",B),U(H.metadata,"navigatorUserAgent",navigator.userAgent),U(H.metadata,"screenWidth",window.screen.width),U(H.metadata,"screenHeight",window.screen.height),U(H.metadata,"windowWidth",window.innerWidth),U(H.metadata,"windowHeight",window.innerHeight),U(H.metadata,"mapWidth",y.width/k),U(H.metadata,"mapHeight",y.height/k),U(H.metadata,"webglRenderer",y.renderer),U(H.metadata,"webglVendor",y.vendor),U(H.metadata,"sdkVersion",w),U(H.metadata,"sdkIdentifier","mapbox-gl-js"),H}(l);for(let y of p.metadata);for(let y of p.counters);for(let y of p.attributes);this.postEvent(o,p,()=>{},f)}},mr=qi.postPerformanceEvent.bind(qi),gr=new class extends It{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,o,l,p){if(!r.e.API_URL||!r.e.SESSION_PATH)return;let y=je(r.e.API_URL+r.e.SESSION_PATH);y.params.push(`sku=${o||""}`),y.params.push(`access_token=${p||r.e.ACCESS_TOKEN||""}`);let v={url:At(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(v,C=>{this.pendingRequest=null,l(C),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,o,l,p){this.skuToken=o,this.errorCb=p,r.e.SESSION_PATH&&r.e.API_URL&&(l||r.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(er)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;let{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,p=>{p?this.errorCb(p):o&&(this.success[o]=!0)},f)}remove(){this.errorCb=null}},Ee=gr.getSessionAPI.bind(gr),on=new Set;function Zn(f,o){o?on.add(f):on.delete(f)}class gi{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,l){this._updatedSourceCaches[o]=l,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){let l=o.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(o.id),this.setDirty()}removeLayer(o){let l=o.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][o.id]=o,this._updatedLayers[l].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){let o={};for(let l in this._updatedLayers)o[l]=o[l]||{},o[l].updatedIds=Array.from(this._updatedLayers[l].values());for(let l in this._removedLayers)o[l]=o[l]||{},o[l].removedIds=Object.keys(this._removedLayers[l]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(o){this._updatedImages.add(o),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function We(f){let{userImage:o}=f;return!!(o&&o.render&&o.render())&&(f.data.replace(new Uint8Array(o.data.buffer)),!0)}class Nr extends r.E{constructor(o){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=o,o!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.I),this._imageRasterizer}createScope(o){this.images[o]={},this.loaded[o]=!1,this.updatedImages[o]={},this.patterns[o]={},this.callbackDispatchedThisFrame[o]={},this.atlasImage[o]=new r.r({width:1,height:1})}isLoaded(){for(let o in this.loaded)if(!this.loaded[o])return!1;return!0}setLoaded(o,l){if(this.loaded[l]!==o&&(this.loaded[l]=o,o)){for(let{ids:p,callback:y}of this.requestors)this._notify(p,l,y);this.requestors=[]}}hasImage(o,l){return!!this.getImage(o,l)}getImage(o,l){return this.images[l][o]}addImage(o,l,p){this._validate(o,p)&&(this.images[l][o]=p)}_validate(o,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new r.y(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new r.y(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new r.y(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,l){if(!o)return!0;let p=0;for(let y of o){if(y[0]<p||y[1]<y[0]||l<y[1])return!1;p=y[1]}return!0}_validateContent(o,l){return o?o.length!==4||!l.usvg&&(o[0]<0||l.data.width<o[0]||o[1]<0||l.data.height<o[1]||o[2]<0||l.data.width<o[2]||o[3]<0||l.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,l,p){p.version=this.images[l][o].version+1,this.images[l][o]=p,this.updatedImages[l][o]=!0,this.removeFromImageRasterizerCache(o,l)}removeFromImageRasterizerCache(o,l){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:l}):this.imageRasterizer.removeImagesFromCacheByIds([o],l))}removeImage(o,l){let p=this.images[l][o];delete this.images[l][o],delete this.patterns[l][o],this.removeFromImageRasterizerCache(o,l),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(o){return Object.keys(this.images[o])}getImages(o,l,p){let y=!0,v=!!this.loaded[l];if(!v)for(let C of o)this.images[l][C]||(y=!1);v||y?this._notify(o,l,p):this.requestors.push({ids:o,scope:l,callback:p})}rasterizeImages({scope:o,imageTasks:l},p){let y={};for(let v in l){let C=l[v],D=this.getImage(C.id,o);D&&(y[v]={image:D,imageIdWithOptions:C})}r.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:y,scope:o},p):this.rasterizeImagesInMainThread({imageTasks:y,scope:o},p)}rasterizeImagesInMainThread(o,l){let{imageTasks:p,scope:y}=o,v={};for(let C in p){let{image:D,imageIdWithOptions:k}=p[C];v[C]=this.imageRasterizer.rasterize(k,D,y,"")}l(void 0,v)}getUpdatedImages(o){return this.updatedImages[o]}_notify(o,l,p){let y={};for(let v of o){this.images[l][v]||this.fire(new r.z("styleimagemissing",{id:v}));let C=this.images[l][v];C?y[v]={data:C.usvg?null:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,usvg:C.usvg,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)}:r.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,y)}getPixelSize(o){let{width:l,height:p}=this.atlasImage[o];return{width:l,height:p}}getPattern(o,l,p){let y=this.patterns[l][o],v=this.getImage(o,l);if(!v)return null;if(y&&y.position.version===v.version)return y.position;if(y)y.position.version=v.version;else{v.usvg&&!v.data&&(v.data=this.imageRasterizer.rasterize(r.A.from(o).getPrimary(),v,l,""));let C={w:v.data.width+2*r.B,h:v.data.height+2*r.B,x:0,y:0},D=new r.F(C,v,r.B);this.patterns[l][o]={bin:C,position:D}}return this._updatePatternAtlas(l,p),this.patterns[l][o].position}bind(o,l){let p=o.gl,y=this.atlasTexture[l];y?this.dirty&&(y.update(this.atlasImage[l]),this.dirty=!1):(y=new r.T(o,this.atlasImage[l],p.RGBA8),this.atlasTexture[l]=y),y.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(o,l){let p=[];for(let D in this.patterns[o])p.push(this.patterns[o][D].bin);let{w:y,h:v}=r.C(p),C=this.atlasImage[o];C.resize({width:y||1,height:v||1});for(let D in this.patterns[o]){let{bin:k,position:N}=this.patterns[o][D],B=N.padding,H=k.x+B,U=k.y+B,q=this.images[o][D].data,ee=q.width,Q=q.height;B=B>1?B-1:B,r.r.copy(q,C,{x:0,y:0},{x:H,y:U},{width:ee,height:Q},l),r.r.copy(q,C,{x:0,y:Q-B},{x:H,y:U-B},{width:ee,height:B},l),r.r.copy(q,C,{x:0,y:0},{x:H,y:U+Q},{width:ee,height:B},l),r.r.copy(q,C,{x:ee-B,y:0},{x:H-B,y:U},{width:B,height:Q},l),r.r.copy(q,C,{x:0,y:0},{x:H+ee,y:U},{width:B,height:Q},l),r.r.copy(q,C,{x:ee-B,y:Q-B},{x:H-B,y:U-B},{width:B,height:B},l),r.r.copy(q,C,{x:0,y:Q-B},{x:H+ee,y:U-B},{width:B,height:B},l),r.r.copy(q,C,{x:0,y:0},{x:H+ee,y:U+Q},{width:B,height:B},l),r.r.copy(q,C,{x:ee-B,y:0},{x:H-B,y:U+Q},{width:B,height:B},l)}this.dirty=!0}beginFrame(){for(let o in this.images)this.callbackDispatchedThisFrame[o]={}}dispatchRenderCallbacks(o,l){for(let p of o){if(this.callbackDispatchedThisFrame[l][p])continue;this.callbackDispatchedThisFrame[l][p]=!0;let y=this.images[l][p];We(y)&&this.updateImage(p,l,y)}}}function hi(f){let o=f.key,l=f.value,p=f.valueSpec||{},y=f.objectElementValidators||{},v=f.style,C=f.styleSpec,D=[],k=r.H(l);if(k!=="object")return[new r.V(o,l,`object expected, ${k} found`)];for(let N in l){let B=N.split(".")[0],H;y[B]?H=y[B]:p[B]?H=Wn:y["*"]?H=y["*"]:p["*"]&&(H=Wn),H?D=D.concat(H({key:(o&&`${o}.`)+N,value:l[N],valueSpec:p[B]||p["*"],style:v,styleSpec:C,object:l,objectKey:N},l)):D.push(new r.G(o,l[N],`unknown property "${N}"`))}for(let N in p)y[N]||p[N].required&&p[N].default===void 0&&l[N]===void 0&&D.push(new r.V(o,l,`missing required property "${N}"`));return D}function zr(f){let o=f.value,l=f.valueSpec,p=f.style,y=f.styleSpec,v=f.key,C=f.arrayElementValidator||Wn;if(r.H(o)!=="array")return[new r.V(v,o,`array expected, ${r.H(o)} found`)];if(l.length&&o.length!==l.length)return[new r.V(v,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new r.V(v,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let D={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};y.$version<7&&(D.function=l.function),r.H(l.value)==="object"&&(D=l.value);let k=[];for(let N=0;N<o.length;N++)k=k.concat(C({array:o,arrayIndex:N,value:o[N],valueSpec:D,style:p,styleSpec:y,key:`${v}[${N}]`},!0));return k}function Cn(f){let o=f.key,l=f.value,p=f.valueSpec,y=r.H(l);if(y==="number"&&l!=l&&(y="NaN"),y!=="number")return[new r.V(o,l,`number expected, ${y} found`)];if("minimum"in p){let v=p.minimum;if(r.H(p.minimum)==="array"&&(v=p.minimum[f.arrayIndex]),l<v)return[new r.V(o,l,`${l} is less than the minimum value ${v}`)]}if("maximum"in p){let v=p.maximum;if(r.H(p.maximum)==="array"&&(v=p.maximum[f.arrayIndex]),l>v)return[new r.V(o,l,`${l} is greater than the maximum value ${v}`)]}return[]}function Er(f){let o=f.valueSpec,l=r.K(f.value.type),p,y,v,C={},D=l!=="categorical"&&f.value.property===void 0,k=!D,N=r.H(f.value.stops)==="array"&&r.H(f.value.stops[0])==="array"&&r.H(f.value.stops[0][0])==="object",B=hi({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(q){if(l==="identity")return[new r.V(q.key,q.value,'identity function may not have a "stops" property')];let ee=[],Q=q.value;return ee=ee.concat(zr({key:q.key,value:Q,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:H})),r.H(Q)==="array"&&Q.length===0&&ee.push(new r.V(q.key,Q,"array must have at least one stop")),ee},default:function(q){return Wn({key:q.key,value:q.value,valueSpec:o,style:q.style,styleSpec:q.styleSpec})}}});return l==="identity"&&D&&B.push(new r.V(f.key,f.value,'missing required property "property"')),l==="identity"||f.value.stops||B.push(new r.V(f.key,f.value,'missing required property "stops"')),l==="exponential"&&f.valueSpec.expression&&!r.L(f.valueSpec)&&B.push(new r.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(k&&!r.M(f.valueSpec)?B.push(new r.V(f.key,f.value,"property functions not supported")):D&&!r.N(f.valueSpec)&&B.push(new r.V(f.key,f.value,"zoom functions not supported"))),l!=="categorical"&&!N||f.value.property!==void 0||B.push(new r.V(f.key,f.value,'"property" property is required')),B;function H(q){let ee=[],Q=q.value,ie=q.key;if(r.H(Q)!=="array")return[new r.V(ie,Q,`array expected, ${r.H(Q)} found`)];if(Q.length!==2)return[new r.V(ie,Q,`array length 2 expected, length ${Q.length} found`)];if(N){if(r.H(Q[0])!=="object")return[new r.V(ie,Q,`object expected, ${r.H(Q[0])} found`)];if(Q[0].zoom===void 0)return[new r.V(ie,Q,"object stop key must have zoom")];if(Q[0].value===void 0)return[new r.V(ie,Q,"object stop key must have value")];let re=r.K(Q[0].zoom);if(typeof re!="number")return[new r.V(ie,Q[0].zoom,"stop zoom values must be numbers")];if(v&&v>re)return[new r.V(ie,Q[0].zoom,"stop zoom values must appear in ascending order")];re!==v&&(v=re,y=void 0,C={}),ee=ee.concat(hi({key:`${ie}[0]`,value:Q[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Cn,value:U}}))}else ee=ee.concat(U({key:`${ie}[0]`,value:Q[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},Q));return r.O(r.Q(Q[1]))?ee.concat([new r.V(`${ie}[1]`,Q[1],"expressions are not allowed in function stops.")]):ee.concat(Wn({key:`${ie}[1]`,value:Q[1],valueSpec:o,style:q.style,styleSpec:q.styleSpec}))}function U(q,ee){let Q=r.H(q.value),ie=r.K(q.value),re=q.value!==null?q.value:ee;if(p){if(Q!==p)return[new r.V(q.key,re,`${Q} stop domain type must match previous stop domain type ${p}`)]}else p=Q;if(Q!=="number"&&Q!=="string"&&Q!=="boolean"&&typeof ie!="number"&&typeof ie!="string"&&typeof ie!="boolean")return[new r.V(q.key,re,"stop domain value must be a number, string, or boolean")];if(Q!=="number"&&l!=="categorical"){let ue=`number expected, ${Q} found`;return r.M(o)&&l===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(q.key,re,ue)]}return l!=="categorical"||Q!=="number"||typeof ie=="number"&&isFinite(ie)&&Math.floor(ie)===ie?l!=="categorical"&&Q==="number"&&typeof ie=="number"&&typeof y=="number"&&y!==void 0&&ie<y?[new r.V(q.key,re,"stop domain values must appear in ascending order")]:(y=ie,l==="categorical"&&ie in C?[new r.V(q.key,re,"stop domain values must be unique")]:(C[ie]=!0,[])):[new r.V(q.key,re,`integer expected, found ${String(ie)}`)]}}function Xo(f){let o=(f.expressionContext==="property"?r.S:r.U)(r.Q(f.value),f.valueSpec);if(o.result==="error")return o.value.map(p=>new r.V(`${f.key}${p.key}`,f.value,p.message));let l=o.value.expression||o.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!l.outputDefined())return[new r.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!r.W(l))return[new r.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Ya(l,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!r.X(l,["zoom","feature-state"]))return[new r.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!r.Y(l))return[new r.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ya(f,o){let l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(let y of o.valueSpec.expression.parameters)l.delete(y);if(l.size===0)return[];let p=[];return f instanceof r.Z&&l.has(f.name)?[new r.V(o.key,o.value,`["${f.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(f.eachChild(y=>{p.push(...Ya(y,o))}),p)}function Xa(f){let o=f.key,l=f.value,p=f.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(r.K(l))===-1&&y.push(new r.V(o,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(r.K(l))===-1&&y.push(new r.V(o,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),y}function ec(f){return r.$(r.Q(f.value))?Xo(r.J({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Rn(f)}function Rn(f){let o=f.value,l=f.key;if(r.H(o)!=="array")return[new r.V(l,o,`array expected, ${r.H(o)} found`)];let p=f.styleSpec,y,v=[];if(o.length<1)return[new r.V(l,o,"filter array must have at least 1 element")];switch(v=v.concat(Xa({key:`${l}[0]`,value:o[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),r.K(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&r.K(o[1])==="$type"&&v.push(new r.V(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&v.push(new r.V(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(y=r.H(o[1]),y!=="string"&&v.push(new r.V(`${l}[1]`,o[1],`string expected, ${y} found`)));for(let C=2;C<o.length;C++)y=r.H(o[C]),r.K(o[1])==="$type"?v=v.concat(Xa({key:`${l}[${C}]`,value:o[C],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&v.push(new r.V(`${l}[${C}]`,o[C],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let C=1;C<o.length;C++)v=v.concat(Rn({key:`${l}[${C}]`,value:o[C],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":y=r.H(o[1]),o.length!==2?v.push(new r.V(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):y!=="string"&&v.push(new r.V(`${l}[1]`,o[1],`string expected, ${y} found`))}return v}function Gc(f,o){let l=f.key,p=f.style,y=f.layer,v=f.styleSpec,C=f.value,D=f.objectKey,k=v[`${o}_${f.layerType}`];if(!k)return[];let N=D.match(/^(.*)-use-theme$/);if(o==="paint"&&N&&k[N[1]])return Wn({key:l,value:C,valueSpec:{type:"string"},style:p,styleSpec:v});let B=D.match(/^(.*)-transition$/);if(o==="paint"&&B&&k[B[1]]&&k[B[1]].transition)return Wn({key:l,value:C,valueSpec:v.transition,style:p,styleSpec:v});let H=f.valueSpec||k[D];if(!H)return[new r.G(l,C,`unknown property "${D}"`)];let U;if(r.H(C)==="string"&&r.M(H)&&!H.tokens&&(U=/^{([^}]+)}$/.exec(C))){let ee=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new r.V(l,C,`"${D}" does not support interpolation syntax
Use an identity property function instead: ${ee}.`)]}let q=[];if(f.layerType==="symbol")D!=="text-field"||!p||p.glyphs||p.imports||q.push(new r.V(l,C,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&r.a0(r.Q(C))&&r.K(C.type)==="identity"&&q.push(new r.V(l,C,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&o==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&r.M(H)&&(r.a1(H)||r.N(H))){let ee=r.S(r.Q(C),H),Q=ee.value.expression||ee.value._styleExpression.expression;Q&&!r.X(Q,["measure-light"])&&(D==="model-emissive-strength"&&r.Y(Q)&&r.W(Q)||q.push(new r.V(l,C,`${D} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(Wn({key:f.key,value:C,valueSpec:H,style:p,styleSpec:v,expressionContext:"property",propertyType:o,propertyKey:D}))}function oa(f){return Gc(f,"paint")}function El(f){return Gc(f,"layout")}function Oo(f){let o=[],l=f.value,p=f.key,y=f.style,v=f.styleSpec;l.type||l.ref||o.push(new r.V(p,l,'either "type" or "ref" is required'));let C=r.K(l.type),D=r.K(l.ref);if(l.id){let k=r.K(l.id);for(let N=0;N<f.arrayIndex;N++){let B=y.layers[N];r.K(B.id)===k&&o.push(new r.V(p,l.id,`duplicate layer id "${l.id}", previously used at line ${B.id.__line__}`))}}if("ref"in l){let k;["type","source","source-layer","filter","layout"].forEach(N=>{N in l&&o.push(new r.V(p,l[N],`"${N}" is prohibited for ref layers`))}),y.layers.forEach(N=>{r.K(N.id)===D&&(k=N)}),k?k.ref?o.push(new r.V(p,l.ref,"ref cannot reference another ref layer")):C=r.K(k.type):typeof D=="string"&&o.push(new r.V(p,l.ref,`ref layer "${D}" not found`))}else if(C!=="background"&&C!=="sky"&&C!=="slot")if(l.source){let k=y.sources&&y.sources[l.source],N=k&&r.K(k.type);k?N==="vector"&&C==="raster"?o.push(new r.V(p,l.source,`layer "${l.id}" requires a raster source`)):N==="raster"&&C!=="raster"?o.push(new r.V(p,l.source,`layer "${l.id}" requires a vector source`)):N!=="vector"||l["source-layer"]?N==="raster-dem"&&C!=="hillshade"?o.push(new r.V(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="raster-array"||["raster","raster-particle"].includes(C)?C!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||N==="geojson"&&k.lineMetrics?C==="raster-particle"&&N!=="raster-array"&&o.push(new r.V(p,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):o.push(new r.V(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new r.V(p,l.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new r.V(p,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new r.V(p,l.source,`source "${l.source}" not found`))}else o.push(new r.V(p,l,'missing required property "source"'));return o=o.concat(hi({key:p,value:l,valueSpec:v.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wn({key:`${p}.type`,value:l.type,valueSpec:v.layer.type,style:f.style,styleSpec:f.styleSpec,object:l,objectKey:"type"}),filter:k=>ec(r.J({layerType:C},k)),layout:k=>hi({layer:l,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":N=>El(r.J({layerType:C},N))}}),paint:k=>hi({layer:l,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":N=>oa(r.J({layerType:C,layer:l},N))}})}})),o}function Ms(f){let o=f.value,l=f.key,p=r.H(o);return p!=="string"?[new r.V(l,o,`string expected, ${p} found`)]:[]}let qc={promoteId:function({key:f,value:o}){if(r.H(o)==="string")return Ms({key:f,value:o});{let l=[];for(let p in o)l.push(...Ms({key:`${f}.${p}`,value:o[p]}));return l}}};function Zc(f){let o=f.value,l=f.key,p=f.styleSpec,y=f.style;if(!o.type)return[new r.V(l,o,'"type" is required')];let v=r.K(o.type),C=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(o.url||o.tiles||C.push(new r.G(l,o,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return C=C.concat(hi({key:l,value:o,valueSpec:p[`source_${v.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:qc})),C;case"geojson":if(C=hi({key:l,value:o,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:qc}),o.cluster)for(let D in o.clusterProperties){let[k,N]=o.clusterProperties[D],B=typeof k=="string"?[k,["accumulated"],["get",D]]:k;C.push(...Xo({key:`${l}.${D}.map`,value:N,expressionContext:"cluster-map"})),C.push(...Xo({key:`${l}.${D}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return C;case"video":return hi({key:l,value:o,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return hi({key:l,value:o,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new r.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xa({key:`${l}.type`,value:o.type,valueSpec:{values:Wc(p)},style:y,styleSpec:p})}}function Wc(f){return f.source.reduce((o,l)=>{let p=f[l];return p.type.type==="enum"&&(o=o.concat(Object.keys(p.type.values))),o},[])}function Da(f){let o=f.value,l=f.styleSpec,p=l.light,y=f.style,v=[],C=r.H(o);if(o===void 0)return v;if(C!=="object")return v=v.concat([new r.V("light",o,`object expected, ${C} found`)]),v;for(let D in o){let k=D.match(/^(.*)-transition$/),N=D.match(/^(.*)-use-theme$/);v=v.concat(N&&p[N[1]]?Wn({key:D,value:o[D],valueSpec:{type:"string"},style:y,styleSpec:l}):k&&p[k[1]]&&p[k[1]].transition?Wn({key:D,value:o[D],valueSpec:l.transition,style:y,styleSpec:l}):p[D]?Wn({key:D,value:o[D],valueSpec:p[D],style:y,styleSpec:l}):[new r.V(D,o[D],`unknown property "${D}"`)])}return v}function Ka(f){let o=f.value,l=[];if(!o)return l;let p=r.H(o);if(p!=="object")return l=l.concat([new r.V("light-3d",o,`object expected, ${p} found`)]),l;let y=f.styleSpec,v=y["light-3d"],C=f.key,D=f.style,k=f.style.lights;for(let H of["type","id"])if(!(H in o))return l=l.concat([new r.V("light-3d",o,`missing property ${H} on light`)]),l;if(o.type&&k)for(let H=0;H<f.arrayIndex;H++){let U=r.K(o.type),q=k[H];r.K(q.type)===U&&l.push(new r.V(C,o.id,`duplicate light type "${o.type}", previously defined at line ${q.id.__line__}`))}let N=`properties_light_${o.type}`;if(!(N in y))return l=l.concat([new r.V("light-3d",o,`Invalid light type ${o.type}`)]),l;let B=y[N];for(let H in o)if(H==="properties"){let U=o[H],q=r.H(U);if(q!=="object")return l=l.concat([new r.V("properties",U,`object expected, ${q} found`)]),l;for(let ee in U)l=l.concat(B[ee]?Wn({key:ee,value:U[ee],valueSpec:B[ee],style:D,styleSpec:y}):[new r.G(f.key,U[ee],`unknown property "${ee}"`)])}else{let U=H.match(/^(.*)-transition$/),q=H.match(/^(.*)-use-theme$/);l=l.concat(q&&v[q[1]]?Wn({key:H,value:o[H],valueSpec:{type:"string"},style:D,styleSpec:y}):U&&v[U[1]]&&v[U[1]].transition?Wn({key:H,value:o[H],valueSpec:y.transition,style:D,styleSpec:y}):v[H]?Wn({key:H,value:o[H],valueSpec:v[H],style:D,styleSpec:y}):[new r.G(H,o[H],`unknown property "${H}"`)])}return l}function tc(f){let o=f.value,l=f.key,p=f.style,y=f.styleSpec,v=y.terrain,C=[],D=r.H(o);if(o===void 0||D==="null")return C;if(D!=="object")return C=C.concat([new r.V("terrain",o,`object expected, ${D} found`)]),C;for(let k in o){let N=k.match(/^(.*)-transition$/),B=k.match(/^(.*)-use-theme$/);C=C.concat(B&&v[B[1]]?Wn({key:k,value:o[k],valueSpec:{type:"string"},style:p,styleSpec:y}):N&&v[N[1]]&&v[N[1]].transition?Wn({key:k,value:o[k],valueSpec:y.transition,style:p,styleSpec:y}):v[k]?Wn({key:k,value:o[k],valueSpec:v[k],style:p,styleSpec:y}):[new r.G(k,o[k],`unknown property "${k}"`)])}if(o.source){let k=p.sources&&p.sources[o.source],N=k&&r.K(k.type);k?N!=="raster-dem"&&C.push(new r.V(l,o.source,`terrain cannot be used with a source of type ${String(N)}, it only be used with a "raster-dem" source type`)):C.push(new r.V(l,o.source,`source "${o.source}" not found`))}else C.push(new r.V(l,o,'terrain is missing required property "source"'));return C}function Ls(f){let o=f.value,l=f.style,p=f.styleSpec,y=p.fog,v=[],C=r.H(o);if(o===void 0)return v;if(C!=="object")return v=v.concat([new r.V("fog",o,`object expected, ${C} found`)]),v;for(let D in o){let k=D.match(/^(.*)-transition$/),N=D.match(/^(.*)-use-theme$/);v=v.concat(N&&y[N[1]]?Wn({key:D,value:o[D],valueSpec:{type:"string"},style:l,styleSpec:p}):k&&y[k[1]]&&y[k[1]].transition?Wn({key:D,value:o[D],valueSpec:p.transition,style:l,styleSpec:p}):y[D]?Wn({key:D,value:o[D],valueSpec:y[D],style:l,styleSpec:p}):[new r.G(D,o[D],`unknown property "${D}"`)])}return v}let Ja={"*":()=>[],array:zr,boolean:function(f){let o=f.value,l=f.key,p=r.H(o);return p!=="boolean"?[new r.V(l,o,`boolean expected, ${p} found`)]:[]},number:Cn,color:function(f){let o=f.key,l=f.value,p=r.H(l);return p!=="string"?[new r.V(o,l,`color expected, ${p} found`)]:r._.parseCSSColor(l)===null?[new r.V(o,l,`color expected, "${l}" found`)]:[]},enum:Xa,filter:ec,function:Er,layer:Oo,object:hi,source:Zc,model:r.a2,light:Da,"light-3d":Ka,terrain:tc,fog:Ls,string:Ms,formatted:function(f){return Ms(f).length===0?[]:Xo(f)},resolvedImage:function(f){return Ms(f).length===0?[]:Xo(f)},projection:function(f){let o=f.value,l=f.styleSpec,p=l.projection,y=f.style,v=[],C=r.H(o);if(C==="object")for(let D in o)v=v.concat(Wn({key:D,value:o[D],valueSpec:p[D],style:y,styleSpec:l}));else C!=="string"&&(v=v.concat([new r.V("projection",o,`object or string expected, ${C} found`)]));return v},import:function(f){let{value:o,styleSpec:l}=f,C=o,{data:p}=C,y=$x(C,["data"]);Object.defineProperty(y,"__line__",{value:o.__line__,enumerable:!1});let v=hi(r.J({},f,{value:y,valueSpec:l.import}));return r.K(y.id)===""&&v.push(new r.V(`${f.key}.id`,y,"import id can't be an empty string")),p&&(v=v.concat(Fu(p,l,{key:`${f.key}.data`}))),v}};function Wn(f,o=!1){let l=f.value,p=f.valueSpec,y=f.styleSpec;if(p.expression&&r.a0(r.K(l)))return Er(f);if(p.expression&&r.O(r.Q(l)))return Xo(f);if(p.type&&Ja[p.type]){let v=Ja[p.type](f);return o===!0&&v.length>0&&r.H(f.value)==="array"?Xo(f):v}return hi(r.J({},f,{valueSpec:p.type?y[p.type]:p}))}function Oa(f){let o=f.value,l=f.key,p=Ms(f);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new r.V(l,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new r.V(l,o,'"glyphs" url must include a "{range}" token'))),p}function Fu(f,o=r.a3,l={}){return Wn({key:l.key||"",value:f,valueSpec:o.$root,styleSpec:o,style:f,objectElementValidators:{glyphs:Oa,"*":()=>[]}})}function Uo(f,o=r.a3){return He(Fu(f,o))}let Sl=f=>He(Zc(f)),Nu=f=>He(Da(f)),zu=f=>He(Ka(f)),Yc=f=>He(tc(f)),Bu=f=>He(Ls(f)),tt=f=>He(function(o){let l=o.value,p=o.style,y=o.styleSpec,v=y.snow,C=[],D=r.H(l);if(l===void 0)return C;if(D!=="object")return C=C.concat([new r.V("snow",l,`object expected, ${D} found`)]),C;for(let k in l){let N=k.match(/^(.*)-transition$/);C=C.concat(N&&v[N[1]]&&v[N[1]].transition?Wn({key:k,value:l[k],valueSpec:y.transition,style:p,styleSpec:y}):v[k]?Wn({key:k,value:l[k],valueSpec:v[k],style:p,styleSpec:y}):[new r.G(k,l[k],`unknown property "${k}"`)])}return C}(f)),oe=f=>He(function(o){let l=o.value,p=o.style,y=o.styleSpec,v=y.rain,C=[],D=r.H(l);if(l===void 0)return C;if(D!=="object")return C=C.concat([new r.V("rain",l,`object expected, ${D} found`)]),C;for(let k in l){let N=k.match(/^(.*)-transition$/);C=C.concat(N&&v[N[1]]&&v[N[1]].transition?Wn({key:k,value:l[k],valueSpec:y.transition,style:p,styleSpec:y}):v[k]?Wn({key:k,value:l[k],valueSpec:v[k],style:p,styleSpec:y}):[new r.G(k,l[k],`unknown property "${k}"`)])}return C}(f)),ce=f=>He(Oo(f)),_e=f=>He(ec(f)),De=f=>He(oa(f)),Se=f=>He(El(f)),Fe=f=>He(r.a2(f));function He(f){return f.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function Te(f,o){let l=!1;if(o&&o.length)for(let p of o)p instanceof r.G?r.w(p.message):(f.fire(new r.y(new Error(p.message))),l=!0);return l}let Je;class nt extends r.E{constructor(o,l="flat"){super(),this._transitionable=new r.a4(Je||(Je=new r.a5({anchor:new r.a6(r.a3.light.anchor),position:new r.a7(r.a3.light.position),color:new r.a6(r.a3.light.color),intensity:new r.a6(r.a3.light.intensity)}))),this.setLight(o,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,l,p={}){this._validate(Nu,o,p)||(this._transitionable.setTransitionOrValue(o),this.id=l)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,l,p){return(!p||p.validate!==!1)&&Te(this,o.call(Uo,r.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let ot=class extends r.E{constructor(f,o,l,p){super(),this.scope=l,this._transitionable=new r.a4(new r.a5({source:new r.a6(r.a3.terrain.source),exaggeration:new r.a6(r.a3.terrain.exaggeration)}),l,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(f,o){this._transitionable.setTransitionOrValue(f,o)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new r.a8(f)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let f=this._transitionable._values.exaggeration;if(!f)return null;let o=f.value.expression;if(!o)return null;let l=-1,p=-1,y=1;for(let v of o.zoomStops)y=o.evaluate(new r.a8(v)),y>.01?(l=v,p=-1):p=v;return y<.01&&l>0&&p>l?[l,p]:null}isZoomDependent(){let f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof r.a9}},wt=45,Vt=65,$t=.05;function pn(f,o,l,p){let y=r.ac(wt,Vt,l),[v,C]=kn(f,p),D=1-Math.min(1,Math.exp((o-v)/(C-v)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*y*f.alpha}function kn(f,o){let l=.5/Math.tan(.5*o);return[f.range[0]+l,f.range[1]+l]}function En(f,o,l,p,y){let v=r.ab.vec3.transformMat4([],[o,l,p],y.mercatorFogMatrix);return pn(f,r.ab.vec3.length(v),y.pitch,y._fov)}function Mn(f,o,l,p,y,v,C){let D=[[l,p,0],[y,p,0],[y,v,0],[l,v,0]],k=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let B of D){let H=r.ab.vec3.transformMat4([],B,o),U=r.ab.vec3.length(H);k=Math.min(k,U),N=Math.max(N,U)}return[pn(f,k,C.pitch,C._fov),pn(f,N,C.pitch,C._fov)]}class ki extends r.E{constructor(o,l,p,y){super();let v=new r.a5({range:new r.a6(r.a3.fog.range),color:new r.a6(r.a3.fog.color),"color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a6(r.a3.fog["high-color"]),"high-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a6(r.a3.fog["space-color"]),"space-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a6(r.a3.fog["horizon-blend"]),"star-intensity":new r.a6(r.a3.fog["star-intensity"]),"vertical-range":new r.a6(r.a3.fog["vertical-range"])});this._transitionable=new r.a4(v,p,new Map(y)),this.set(o,y),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new r.ad(v),this.scope=p}get state(){let o=this._transform,l=o.projection.name==="globe",p=r.ae(o.zoom),y=this.properties.get("range"),v=[.5,3];return{range:l?[r.af(v[0],y[0],p),r.af(v[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,l,p={}){if(this._validate(Bu,o,p))return;let y=r.l({},o);for(let v of Object.keys(r.a3.fog))y[v]===void 0&&(y[v]=r.a3.fog[v].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;let l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ac(wt,Vt,o))*l.a}getOpacityAtLatLng(o,l){return this._transform.projection.supportsFog?function(p,y,v){let C=r.aa.fromLngLat(y),D=v.elevation?v.elevation.getAtPointOrZero(C):0;return En(p,C.x,C.y,D,v)}(this.state,o,l):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];let l=this._transform.calculateFogTileMatrix(o.toUnwrapped());return Mn(this.state,l,0,0,r.ag,r.ag,this._transform)}getOpacityForBounds(o,l,p,y,v){return this._transform.projection.supportsFog?Mn(this.state,o,l,p,y,v,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?kn(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;let l=[4,5,6,7];for(let p of l){let y=o.points[p],v;if(y[2]>=0)v=y;else{let C=o.points[p-4];v=r.ah(C,y,C[2]/(C[2]-y[2]))}if(En(this.state,v[0],v[1],0,this._transform)>=$t)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,l,p){return(!p||p.validate!==!1)&&Te(this,o.call(Uo,r.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let vi,Xn,Oi,Si,qr=class extends r.E{constructor(f,o,l,p){super();let y=vi||(vi=new r.a5({density:new r.a6(r.a3.snow.density),intensity:new r.a6(r.a3.snow.intensity),color:new r.a6(r.a3.snow.color),opacity:new r.a6(r.a3.snow.opacity),vignette:new r.a6(r.a3.snow.vignette),"vignette-color":new r.a6(r.a3.snow["vignette-color"]),"center-thinning":new r.a6(r.a3.snow["center-thinning"]),direction:new r.a6(r.a3.snow.direction),"flake-size":new r.a6(r.a3.snow["flake-size"])}));this._transitionable=new r.a4(y,l,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(y),this.scope=l}get state(){let f=this.properties.get("opacity"),o=this.properties.get("color"),l=this.properties.get("direction"),p=r.ai(l[0]),y=-Math.max(r.ai(l[1]),.01),v=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],C=this.properties.get("vignette"),D=this.properties.get("vignette-color");return D.a=C,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(o.r,o.g,o.b,o.a*f),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:D}}get(){return this._transitionable.serialize()}set(f,o,l={}){if(this._validate(tt,f,l))return;let p=r.l({},f);for(let y of Object.keys(r.a3.snow))p[y]===void 0&&(p[y]=r.a3.snow[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,o,l){return(!l||l.validate!==!1)&&Te(this,f.call(Uo,r.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}},Ho=class extends r.E{constructor(f,o,l,p){super();let y=Xn||(Xn=new r.a5({density:new r.a6(r.a3.rain.density),intensity:new r.a6(r.a3.rain.intensity),color:new r.a6(r.a3.rain.color),opacity:new r.a6(r.a3.rain.opacity),vignette:new r.a6(r.a3.rain.vignette),"vignette-color":new r.a6(r.a3.rain["vignette-color"]),"center-thinning":new r.a6(r.a3.rain["center-thinning"]),direction:new r.a6(r.a3.rain.direction),"droplet-size":new r.a6(r.a3.rain["droplet-size"]),"distortion-strength":new r.a6(r.a3.rain["distortion-strength"])}));this._transitionable=new r.a4(y,l,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(y),this.scope=l}get state(){let f=this.properties.get("opacity"),o=this.properties.get("color"),l=this.properties.get("direction"),p=r.ai(l[0]),y=-Math.max(r.ai(l[1]),.01),v=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],C=this.properties.get("vignette-color");return C.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(o.r,o.g,o.b,o.a*f),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(f,o,l={}){if(this._validate(oe,f,l))return;let p=r.l({},f);for(let y of Object.keys(r.a3.rain))p[y]===void 0&&(p[y]=r.a3.rain[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,o,l){return(!l||l.validate!==!1)&&Te(this,f.call(Uo,r.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}};class _o extends r.E{constructor(o,l,p,y){super(),this.scope=p,this._options=o,this.properties=new r.ad(l),this._transitionable=new r.a4(l,p,new Map(y)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,l){this._options=o,this._transitionable.setTransitionOrValue(o.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class wo{constructor(o,l,p,y){this.screenBounds=o,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(o,l){let p,y;if(o instanceof r.P||typeof o[0]=="number"){let v=r.P.convert(o);p=[v],y=l.isPointAboveHorizon(v)}else{let v=r.P.convert(o[0]),C=r.P.convert(o[1]);p=[v,C],y=r.al(v,C).every(D=>l.isPointAboveHorizon(D))}return new wo(p,l.getCameraPoint(),y,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return r.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){let l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],y=r.al(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(y[3]=this.cameraPoint)),r.am(y,o)}bufferedCameraGeometryGlobe(o){let l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],y=r.al(l,p,o),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>p.y))+((v.x>l.x)+(v.x>p.x))){case 0:y[0]=v,y[4]=v.clone();break;case 1:y.splice(1,0,v);break;case 2:y[1]=v;break;case 3:y.splice(4,0,v);break;case 5:y.splice(2,0,v);break;case 6:y[3]=v;break;case 7:y.splice(3,0,v);break;case 8:y[2]=v}return y}containsTile(o,l,p,y=0){let v=o.queryPadding/l._pixelsPerMercatorPixel+1,C=p?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l),D=o.tileID.wrap+(C.unwrapped?y:0),k=C.polygon.map(ie=>r.an(o.tileTransform,ie,D));if(!r.ao(k,0,0,r.ag,r.ag))return;D=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);let N=this.screenGeometryMercator.polygon.map(ie=>r.ap(o.tileTransform,ie,D)),B=N.map(ie=>new r.P(ie[0],ie[1])),H=l.getFreeCameraOptions().position||new r.aa(0,0,0),U=r.ap(o.tileTransform,H,D),q=N.map(ie=>{let re=r.ab.vec3.sub(ie,ie,U);return r.ab.vec3.normalize(re,re),new r.aq(U,re)}),ee=r.ar(o,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:q,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(Q=r.as(k),Q.min.x=r.aw(Q.min.x,0,r.ag),Q.min.y=r.aw(Q.min.y,0,r.ag),Q.max.x=r.aw(Q.max.x,0,r.ag),Q.max.y=r.aw(Q.max.y,0,r.ag),Q),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:ee};var Q}_bufferedScreenMercator(o,l){let p=ic(o);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),l):{polygon:this.bufferedScreenGeometry(o).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(o,l){let p=ic(o);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),l):{polygon:this.bufferedCameraGeometry(o).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(o,l){let p=function(v,C){let D=r.ab.mat4.multiply([],C.pixelMatrix,C.globeMatrix),k=[0,-r.ax,0,1],N=[0,r.ax,0,1],B=[0,0,0,1];r.ab.vec4.transformMat4(k,k,D),r.ab.vec4.transformMat4(N,N,D),r.ab.vec4.transformMat4(B,B,D);let H=new r.P(k[0]/k[3],k[1]/k[3]),U=new r.P(N[0]/N[3],N[1]/N[3]),q=r.au(v,H)&&k[3]<B[3],ee=r.au(v,U)&&N[3]<B[3];if(!q&&!ee)return null;let Q=function(be,ve,Ie){for(let Re=1;Re<be.length;Re++){let Ye=Fs(ve.pointCoordinate3D(be[Re-1]).x),$e=Fs(ve.pointCoordinate3D(be[Re]).x);if(Ie<0){if(Ye<$e)return{idx:Re,t:-Ye/($e-1-Ye)}}else if($e<Ye)return{idx:Re,t:(1-Ye)/($e+1-Ye)}}return null}(v,C,q?-1:1);if(!Q)return null;let{idx:ie,t:re}=Q,ue=ie>1?nc(v.slice(0,ie),C):[],ge=ie<v.length?nc(v.slice(ie),C):[];ue=ue.map(be=>new r.P(Fs(be.x),be.y)),ge=ge.map(be=>new r.P(Fs(be.x),be.y));let pe=[...ue];pe.length===0&&pe.push(ge[ge.length-1]);let we=r.af(pe[pe.length-1].y,(ge.length===0?ue[0]:ge[0]).y,re),xe;return xe=q?[new r.P(0,we),new r.P(0,0),new r.P(1,0),new r.P(1,we)]:[new r.P(1,we),new r.P(1,1),new r.P(0,1),new r.P(0,we)],pe.push(...xe),ge.length===0?pe.push(ue[0]):pe.push(...ge),{polygon:pe.map(be=>new r.aa(be.x,be.y)),unwrapped:!1}}(o,l);if(p)return p;let y=function(v,C){let D=!1,k=-1/0,N=0;for(let H=0;H<v.length-1;H++)v[H].x>k&&(k=v[H].x,N=H);for(let H=0;H<v.length-1;H++){let U=(N+H)%(v.length-1),q=v[U],ee=v[U+1];Math.abs(q.x-ee.x)>.5&&(q.x<ee.x?(q.x+=1,U===0&&(v[v.length-1].x+=1)):(ee.x+=1,U+1===v.length-1&&(v[0].x+=1)),D=!0)}let B=r.at(C.center.lng);return D&&B<Math.abs(B-1)&&v.forEach(H=>{H.x-=1}),{polygon:v,unwrapped:D}}(nc(o,l).map(v=>new r.P(Fs(v.x),v.y)),l);return{polygon:y.polygon.map(v=>new r.aa(v.x,v.y)),unwrapped:y.unwrapped}}}function nc(f,o){return r.av(f,l=>{let p=o.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function Fs(f){return f<0?1+f%1:f%1}function ic(f){return 100*f|0}function Vu(f,o,l,p,y){let v=function(D,k){if(D)return y(D);if(k){if(f.url&&k.tiles&&f.tiles&&delete f.tiles,k.variants){if(!Array.isArray(k.variants))return y(new Error("variants must be an array"));for(let B of k.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return y(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){k=r.l(k,B);break}}}let N=r.ay(r.l({},k,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);N.tiles=o.canonicalizeTileset(N,f.url),y(null,N)}},C=function(D,k,N){if(!D)return null;if(!k&&!N)return D;N=N||D.worldview_default;let B=Object.values(D.language||{});if(B.length===0)return null;let H=Object.values(D.worldview||{});if(H.length===0)return null;let U=B.every(ee=>ee===k),q=H.every(ee=>ee===N);return U&&q?D:k in(D.language_options||{})||N in(D.worldview_options||{})?null:D.language_options&&D.worldview_options?D:null}(f.data,l,p);return C?r.q.frame(()=>v(null,C)):f.url?r.n(o.transformRequest(o.normalizeSourceURL(f.url,null,l,p),r.R.Source),v):r.q.frame(()=>{let N=f,{data:D}=N,k=$x(N,["data"]);v(null,k)})}class Il{constructor(o,l,p){this.bounds=r.az.convert(this.validateBounds(o)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){let l=Math.pow(2,o.z),p=Math.floor(r.at(this.bounds.getWest())*l),y=Math.floor(r.aA(this.bounds.getNorth())*l),v=Math.ceil(r.at(this.bounds.getEast())*l),C=Math.ceil(r.aA(this.bounds.getSouth())*l);return o.x>=p&&o.x<v&&o.y>=y&&o.y<C}}class Pl extends r.E{constructor(o,l,p,y){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.ay(l,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new r.aB}load(o){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));let l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Vu(this._options,this.map._requestManager,l,p,(y,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new r.y(y));else if(v){if(r.l(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(let C of v.vector_layers)this.vectorLayerIds.push(C.id),v.worldview&&v.worldview[C.source]&&this.localizableLayerIds.add(C.id)}v.bounds&&(this.tileBounds=new Il(v.bounds,this.minzoom,this.maxzoom)),dn(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(y)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(o,l){let p=o.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(p),v=this.map._requestManager.transformRequest(y,r.R.Tile),C=this.map.style?this.map.style.getLut(this.scope):null,D=C?{image:C.image.clone()}:null,k={request:v,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:D,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(p)&&(k.worldview=this.map.getWorldview()||this.worldviewDefault,k.localizableLayerIds=this.localizableLayerIds),k.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=l:o.request=o.actor.send("reloadTile",k,N.bind(this));else if(o.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",k,N.bind(this),void 0,!0);else{let B=r.aD.call({deduped:this._deduped},k,(H,U)=>{H||!U?N.call(this,H):(k.data={cacheControl:U.cacheControl,expires:U.expires,rawData:U.rawData.slice(0)},o.actor&&o.actor.send("loadTile",k,N.bind(this),void 0,!0))},!0);o.request={cancel:B}}function N(B,H){return delete o.request,o.aborted?l(null):B&&B.status!==404?l(B):(H&&H.resourceTiming&&(o.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&o.setExpiryData(H),o.loadVectorData(H,this.map.painter),r.aE(this.dispatcher),l(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,l){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ni extends r.E{constructor(o,l,p,y){super(),this.id=o,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},l),r.l(this,r.ay(l,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._tileJSONRequest=Vu(this._options,this.map._requestManager,null,null,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new r.y(l)):p&&(r.l(this,p),p.raster_layers&&(this.rasterLayers=p.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),p.bounds&&(this.tileBounds=new Il(p.bounds,this.minzoom,this.maxzoom)),dn(p.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(l)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,l){let p=r.q.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);o.request=r.o(this.map._requestManager.transformRequest(y,r.R.Tile),(v,C,D,k)=>(delete o.request,o.aborted?(o.state="unloaded",l(null)):v?(o.state="errored",l(v)):C?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:D,expires:k}),o.setTexture(C,this.map.painter),o.state="loaded",r.aE(this.dispatcher),void l(null)):l(null)))}abortTile(o,l){o.request&&(o.request.cancel(),delete o.request),l&&l()}unloadTile(o,l){o.texture&&o.texture instanceof r.T?(o.destroy(!0),o.texture&&o.texture instanceof r.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class hr extends Ni{constructor(o,l,p,y){super(o,l,p,y),this.type="raster-array",this.maxzoom=22,this._options=r.l({type:"raster-array"},l)}triggerRepaint(o){let l=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);l&&l.enabled&&p&&l._clearRenderCacheForTile(p.id,o.tileID),this.map.triggerRepaint()}loadTile(o,l){let p=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,r.R.Tile);o.requestParams=y,o.actor||(o.actor=this.dispatcher.getActor()),o.request=o.fetchHeader(void 0,(v,C,D,k)=>{if(delete o.request,o.aborted)return o.state="unloaded",l(null);if(v)return v.code===20?void 0:(o.state="errored",l(v));this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:D,expires:k}),o.state="empty",l(null)})}unloadTile(o,l){let p=o.texture;p&&p instanceof r.T?(o.destroy(!0),this.map.painter.saveTileTexture(p)):(o.destroy(),o.flushQueues(),o._isHeaderLoaded=!1,delete o._mrt,delete o.textureDescriptor),o.fbo&&(o.fbo.destroy(),delete o.fbo),delete o.request,delete o.requestParams,delete o.neighboringTiles,o.state="unloaded"}prepareTile(o,l,p){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBand(l,p,(y,v)=>{if(y)return o.state="errored",this.fire(new r.y(y)),void this.triggerRepaint(o);v&&(o.setTexture(v,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;let l=this.rasterLayers.find(({id:v})=>v===o),p=l&&l.fields,y=p&&p.bands&&p.bands;return y?y[0]:0}getTextureDescriptor(o,l,p){if(!o)return;let y=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let v=null;l instanceof r.aH?v=l.paint.get("raster-array-band"):l instanceof r.aI&&(v=l.paint.get("raster-particle-array-band"));let C=v||this.getInitialBand(y);if(C!=null)if(o.textureDescriptor){if(!o.updateNeeded(y,C)||p)return Object.assign({},o.textureDescriptor,{texture:o.texture})}else this.prepareTile(o,y,C)}}let Aa={vector:Pl,raster:Ni,"raster-dem":class extends Ni{constructor(f,o,l,p){super(f,o,l,p),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(f,o){let l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,v){y&&(f.state="errored",o(y)),v&&(f.dem=v,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",o(null))}f.request=r.o(this.map._requestManager.transformRequest(l,r.R.Tile),function(y,v,C,D){if(delete f.request,f.aborted)f.state="unloaded",o(null);else if(y)f.state="errored",o(y);else if(v){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:C,expires:D});let k=ImageBitmap&&v instanceof ImageBitmap&&r.t(),N=1-(v.width-r.aF(v.width))/2;N<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));let B=k?v:r.q.getImageData(v,N),H={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:N};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",H,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){let o=f.canonical,l=Math.pow(2,o.z),p=(o.x-1+l)%l,y=o.x===0?f.wrap-1:f.wrap,v=(o.x+1+l)%l,C=o.x+1===l?f.wrap+1:f.wrap,D={};return D[new r.aG(f.overscaledZ,y,o.z,p,o.y).key]={backfilled:!1},D[new r.aG(f.overscaledZ,C,o.z,v,o.y).key]={backfilled:!1},o.y>0&&(D[new r.aG(f.overscaledZ,y,o.z,p,o.y-1).key]={backfilled:!1},D[new r.aG(f.overscaledZ,f.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},D[new r.aG(f.overscaledZ,C,o.z,v,o.y-1).key]={backfilled:!1}),o.y+1<l&&(D[new r.aG(f.overscaledZ,y,o.z,p,o.y+1).key]={backfilled:!1},D[new r.aG(f.overscaledZ,f.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},D[new r.aG(f.overscaledZ,C,o.z,v,o.y+1).key]={backfilled:!1}),D}},"raster-array":hr,geojson:class extends r.E{constructor(f,o,l,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=o.data,this._options=r.l({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;let y=r.ag/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*y,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*y,extent:r.ag,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:r.ag,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*y,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let o=new Map;for(let l of this._data.features)o.set(l.id,l);for(let l of f.features)o.set(l.id,l);this._data.features=[...o.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},o),this}getClusterChildren(f,o){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},o),this}getClusterLeaves(f,o,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:o,offset:l},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;let o=r.l({append:f},this.workerOptions);o.scope=this.scope;let l=this._data;typeof l=="string"?(o.request=this.map._requestManager.transformRequest(r.q.resolveURL(l),r.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(p,y)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new r.y(p));else{let v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(v.resourceTiming=y.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new r.z("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,o){let l=f.actor?"reloadTile":"loadTile";f.actor=this.actor;let p=this.map.style?this.map.style.getLut(this.scope):null,y=p?{image:p.image.clone()}:null,v=this._partialReload,C={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:v};f.request=this.actor.send(l,C,(D,k)=>v&&!k?(f.state="loaded",o(null)):(delete f.request,f.destroy(),f.aborted?o(null):D?o(D):(f.loadVectorData(k,this.map.painter,l==="reloadTile"),o(null))),void 0,l==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,o){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aJ{constructor(f,o,l,p){super(f,o,l,p),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;let f=this.options;this.urls=[];for(let o of f.urls)this.urls.push(this.map._requestManager.transformRequest(o,r.R.Source).url);r.aK(this.urls,(o,l)=>{this._loaded=!0,o?this.fire(new r.y(o)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){let o=this.video.seekable;f<o.start(0)||f>o.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let f=this.map.painter.context,o=f.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(f,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aJ,model:class extends r.E{constructor(f,o,l,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){let f=[];for(let o in this._options.models){let l=this._options.models[o],p=r.aM(this.map._requestManager.transformRequest(l.uri,r.R.Model).url).then(y=>{if(!y)return;let v=r.aN(y),C=new r.aO(o,l.position,l.orientation,v);C.computeBoundsAndApplyParent(),this.models.push(C)}).catch(y=>{this.fire(new r.y(new Error(`Could not load model ${o} from ${l.uri}: ${y.message}`)))});f.push(p)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this.fire(new r.y(new Error(`Could not load models: ${o.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,o){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(f,o,l,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=Vu(this._options,this.map._requestManager,o,l,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new r.y(p))):y&&(r.l(this,y),y.bounds&&(this.tileBounds=new Il(y.bounds,this.minzoom,this.maxzoom)),dn(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,o){let l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,r.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=o;else{if(f.buckets){let v=Object.values(f.buckets);for(let C of v)C.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,y.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,y.bind(this),void 0,!0);function y(v,C){return f.aborted?o(null):v&&v.status!==404?o(v):(this.map._refreshExpiredTiles&&C&&f.setExpiryData(C),f.loadModelData(C,this.map.painter),f.state="loaded",void o(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aJ{constructor(f,o,l,p){super(f,o,l,p),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(v=>typeof v!="number"))||this.fire(new r.y(new r.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${f}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let o=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof r.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends r.E{constructor(f,o,l,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=o,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Il(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.ay(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){let{x:o,y:l,z:p}=f.canonical;return this._implementation.hasTile({x:o,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,o){let{x:l,y:p,z:y}=f.tileID.canonical,v=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:y},{signal:v.signal})).then(function(C){return delete f.request,f.aborted?(f.state="unloaded",o(null)):C===void 0?(f.state="errored",o(null)):C===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",o(null)):function(D){return D instanceof ImageData||D instanceof HTMLCanvasElement||D instanceof ImageBitmap||D instanceof HTMLImageElement}(C)?(this.loadTileData(f,C),f.state="loaded",void o(null)):(f.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(C=>{C.code!==20&&(f.state="errored",o(C))}),f.request.cancel=()=>v.abort()}loadTileData(f,o){f.setTexture(o,this.map.painter)}unloadTile(f,o){if(f.texture&&f.texture instanceof r.T?(f.destroy(!0),f.texture&&f.texture instanceof r.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){let{x:l,y:p,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:y})}o&&o()}abortTile(f,o){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){let f=r.aC(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},Dl=function(f,o,l,p){let y=new Aa[o.type](f,o,l,p);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return r.aP(["load","abort","unload","serialize","prepare"],y),y};function rc(f,o,l,p,y=!1){let v=o.sourceCache.transform,C=o.sourceCache.tilesIn(f,o.has3DLayers,y);C.sort(jr);let D=[];for(let k of C){let N=k.tile.queryRenderedFeatures(o,k,l,p,v,y);Object.keys(N).length&&D.push({wrappedTileID:k.tile.tileID.wrapped().key,queryResults:N})}return D.length===0?{}:function(k){let N={},B={};for(let H of k){let U=H.queryResults,q=H.wrappedTileID,ee=B[q]=B[q]||{};for(let Q in U){let ie=U[Q],re=ee[Q]=ee[Q]||{},ue=N[Q]=N[Q]||[];for(let ge of ie)re[ge.featureIndex]||(re[ge.featureIndex]=!0,ue.push(ge))}}return N}(D)}function Xc(f,o,l,p,y){let v={},C=p.queryRenderedSymbols(f),D=[];for(let k of Object.keys(C).map(Number))D.push(y[k]);D.sort(jr);for(let k of D){let N=k.featureIndex.lookupSymbolFeatures(C[k.bucketInstanceId],k.bucketIndex,k.sourceLayerIndex,o,l);for(let B in N){let H=v[B]=v[B]||[],U=N[B];U.sort((q,ee)=>{let Q=k.featureSortOrder;if(Q){let ie=Q.indexOf(q.featureIndex);return Q.indexOf(ee.featureIndex)-ie}return ee.featureIndex-q.featureIndex});for(let q of U)H.push(q)}}return v}function xi(f,o){let l=f.getRenderableIds().map(v=>f.getTileByID(v)),p=[],y={};for(let v=0;v<l.length;v++){let C=l[v],D=C.tileID.canonical.key;y[D]||(y[D]=!0,C.querySourceFeatures(p,o))}return p}function jr(f,o){let l=f.tileID,p=o.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function ju(f,o){let l={};if(!o)return l;for(let p of f){let y=p.layerIds.map(v=>o.getLayer(v)).filter(Boolean);if(y.length!==0){p.layers=y,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(v=>y.filter(C=>C.id===v)[0]));for(let v of y)l[v.fqid]=p}}return l}let $o=32,Qr=33,Ns=new Uint16Array(8184);for(let f=0;f<2046;f++){let o=f+2,l=0,p=0,y=0,v=0,C=0,D=0;for(1&o?y=v=C=$o:l=p=D=$o;(o>>=1)>1;){let N=l+y>>1,B=p+v>>1;1&o?(y=l,v=p,l=C,p=D):(l=y,p=v,y=C,v=D),C=N,D=B}let k=4*f;Ns[k+0]=l,Ns[k+1]=p,Ns[k+2]=y,Ns[k+3]=v}let as=new Uint16Array(2178),Ko=new Uint8Array(1089),Zr=new Uint16Array(1089);function sa(f){return f===0?-.03125:f===32?.03125:0}let zs={type:2,extent:r.ag,loadGeometry:()=>[[new r.P(0,0),new r.P(r.ag+1,0),new r.P(r.ag+1,r.ag+1),new r.P(0,r.ag+1),new r.P(0,0)]]};class Bs{constructor(o,l,p,y,v){this.tileID=o,this.uid=r.aV(),this.uses=0,this.tileSize=l,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection)}registerFadeDuration(o){let l=o+this.timeAdded;l<r.q.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,p){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=ju(o.buckets,l.style),this.hasSymbolBuckets=!1;for(let y in this.buckets){let v=this.buckets[y];if(v instanceof r.aX){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let y in this.buckets){let v=this.buckets[y];if(v instanceof r.aX&&v.hasRTLText){this.hasRTLText=!0,r.aY();break}}this.queryPadding=0;for(let y in this.buckets){let v=this.buckets[y],C=l.style.getOwnLayer(y);if(!C)continue;let D=C.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,D)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new r.aW}unloadVectorData(){if(this.hasData()){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,l,p){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=cn(cn({},this.buckets),ju(o.buckets,l.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o){for(let y in this.buckets){let v=this.buckets[y];v.uploadPending()&&v.upload(o)}let l=o.gl,p=this.imageAtlas;if(p&&!p.uploaded){let y=!!Object.keys(p.patternPositions).length;this.imageAtlasTexture=new r.T(o,p.image,l.RGBA8,{useMipmap:y}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(o,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(o,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(o,l,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,p),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let y=l.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(o,l,p,y,v,C){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};let D=function(k,N){let B=r.ab.mat4.fromScaling([],[.5*k.width,.5*-k.height,1]);return r.ab.mat4.translate(B,B,[1,-1,0]),r.ab.mat4.multiply(B,B,k.calculateProjMatrix(N.toUnwrapped())),Float32Array.from(B)}(v,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:l,pixelPosMatrix:D,transform:y,availableImages:p,tileTransform:this.tileTransform})}querySourceFeatures(o,l){let p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;let y=p.loadVTLayers(),v=l?l.sourceLayer:"",C=y._geojsonTileLayer||y[v];if(!C)return;let D=r.aZ(l&&l.filter),{z:k,x:N,y:B}=this.tileID.canonical,H={z:k,x:N,y:B};for(let U=0;U<C.length;U++){let q=C.feature(U);if(D.needGeometry){let ie=r.a_(q,!0);if(!D.filter(new r.a8(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!D.filter(new r.a8(this.tileID.overscaledZ),q))continue;let ee=p.getId(q,v),Q=new r.a$(q,k,N,B,ee);Q.tile=H,o.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){let l=this.expirationTime;if(o.cacheControl){let p=r.b0(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){let p=Date.now(),y=!1;if(this.expirationTime>p)y=!1;else if(l)if(this.expirationTime<l)y=!0;else{let v=this.expirationTime-l;v?this.expirationTime=p+Math.max(v,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}updateBuckets(o,l){if(!this.latestFeatureIndex||!o.style)return;let p=this.latestFeatureIndex.loadVTLayers(),y=o.style.listImages(),v=o.style.getBrightness();for(let C in this.buckets){if(!o.style.hasLayer(C))continue;let D=this.buckets[C],k=D.layers[0],N=k.sourceLayer||"_geojsonTileLayer",B=p[N],H=o.style.getSourceCache(k.source,k.scope),U={};H&&(U=H._state.getState(N,void 0));let q=this.imageAtlas&&this.imageAtlas.patternPositions||{},ee=Object.keys(U).length>0&&!l;(ee&&D.stateDependentLayers.length!==0||l)&&D.update(U,B,y,q,ee?D.stateDependentLayers:D.layers,l,v),(D instanceof r.b1||D instanceof r.b2)&&o._terrain&&o._terrain.enabled&&H&&D.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(H.id,this.tileID);let Q=o&&o.style&&o.style.getOwnLayer(C);Q&&(this.queryPadding=Math.max(this.queryPadding,Q.queryRadius(D)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=r.q.now()+o}setTexture(o,l){let p=l.context,y=p.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture&&this.texture instanceof r.T?this.texture.update(o):(this.texture=new r.T(p,o,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(o,l){let p={};for(let y of l)p[y]=!0;this.dependencies[o]=p}hasDependency(o,l){for(let p of o){let y=this.dependencies[p];if(y){for(let v of l)if(y[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;let p=r.b3(zs,this.tileID.canonical,this.tileTransform)[0],y=new r.b4,v=new r.b5;for(let C=0;C<p.length;C++){let{x:D,y:k}=p[C];y.emplaceBack(D,k),v.emplaceBack(C)}v.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(v),this._tileDebugBuffer=o.createVertexBuffer(y,r.b6.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,y.length,v.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;let p=r.b3(zs,this.tileID.canonical,this.tileTransform)[0],y,v;if(this.isRaster){let C=function(D,k){let N=r.aQ(D,k),B=Math.pow(2,D.z);for(let ie=0;ie<Qr;ie++)for(let re=0;re<Qr;re++){let ue=r.aR((D.x+(re+sa(re))/$o)/B),ge=r.aS((D.y+(ie+sa(ie))/$o)/B),pe=k.project(ue,ge),we=ie*Qr+re;as[2*we+0]=Math.round((pe.x*N.scale-N.x)*r.ag),as[2*we+1]=Math.round((pe.y*N.scale-N.y)*r.ag)}Ko.fill(0),Zr.fill(0);for(let ie=2045;ie>=0;ie--){let re=4*ie,ue=Ns[re+0],ge=Ns[re+1],pe=Ns[re+2],we=Ns[re+3],xe=ue+pe>>1,be=ge+we>>1,ve=xe+be-ge,Ie=be+ue-xe,Re=ge*Qr+ue,Ye=we*Qr+pe,$e=be*Qr+xe,Ae=Math.hypot((as[2*Re+0]+as[2*Ye+0])/2-as[2*$e+0],(as[2*Re+1]+as[2*Ye+1])/2-as[2*$e+1])>=16;Ko[$e]=Ko[$e]||(Ae?1:0),ie<1022&&(Ko[$e]=Ko[$e]||Ko[(ge+Ie>>1)*Qr+(ue+ve>>1)]||Ko[(we+Ie>>1)*Qr+(pe+ve>>1)])}let H=new r.aT,U=new r.aU,q=0;function ee(ie,re){let ue=re*Qr+ie;return Zr[ue]===0&&(H.emplaceBack(as[2*ue+0],as[2*ue+1],ie*r.ag/$o,re*r.ag/$o),Zr[ue]=++q),Zr[ue]-1}function Q(ie,re,ue,ge,pe,we){let xe=ie+ue>>1,be=re+ge>>1;if(Math.abs(ie-pe)+Math.abs(re-we)>1&&Ko[be*Qr+xe])Q(pe,we,ie,re,xe,be),Q(ue,ge,pe,we,xe,be);else{let ve=ee(ie,re),Ie=ee(ue,ge),Re=ee(pe,we);U.emplaceBack(ve,Ie,Re)}}return Q(0,0,$o,$o,$o,0),Q($o,$o,0,0,0,$o),{vertices:H,indices:U}}(this.tileID.canonical,l);y=C.vertices,v=C.indices}else{y=new r.aT,v=new r.aU;for(let{x:D,y:k}of p)y.emplaceBack(D,k,0,0);let C=r.b8(y.int16,void 0,4);for(let D=0;D<C.length;D+=3)v.emplaceBack(C[D],C[D+1],C[D+2])}this._tileBoundsBuffer=o.createVertexBuffer(y,r.b9.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(v),this._tileBoundsSegments=r.b7.simpleSegment(0,0,y.length,v.length)}_makeGlobeTileDebugBuffers(o,l){let p=l.projection;if(!p||p.name!=="globe"||l.freezeTileCoverage)return;let y=this.tileID.canonical,v=r.ba(y,l),C=r.bb(v),D=r.ae(l.zoom),k;D>0&&(k=r.ab.mat4.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,y,l,C,k,D),this._makeGlobeTileDebugTextBuffer(o,y,l,C,k,D)}_globePoint(o,l,p,y,v,C,D){let k=r.bc(o,l,p);if(C){let N=1<<p.z,B=r.at(y.center.lng),H=r.aA(y.center.lat),U=(p.x+.5)/N-B,q=0;U>.5?q=-1:U<-.5&&(q=1);let ee=(o/r.ag+p.x)/N+q,Q=(l/r.ag+p.y)/N;ee=(ee-B)*y._pixelsPerMercatorPixel+B,Q=(Q-H)*y._pixelsPerMercatorPixel+H;let ie=[ee*y.worldSize,Q*y.worldSize,0];r.ab.vec3.transformMat4(ie,ie,C),k=r.bd(k,ie,D)}return r.ab.vec3.transformMat4(k,k,v)}_makeGlobeTileDebugBorderBuffer(o,l,p,y,v,C){let D=new r.b4,k=new r.b5,N=new r.be,B=(U,q,ee,Q,ie)=>{let re=(ee-U)/(ie-1),ue=(Q-q)/(ie-1),ge=D.length;for(let pe=0;pe<ie;pe++){let we=U+pe*re,xe=q+pe*ue;D.emplaceBack(we,xe);let be=this._globePoint(we,xe,l,p,y,v,C);N.emplaceBack(be[0],be[1],be[2]),k.emplaceBack(ge+pe)}},H=r.ag;B(0,0,H,0,16),B(H,0,H,H,16),B(H,H,0,H,16),B(0,H,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(k),this._tileDebugBuffer=o.createVertexBuffer(D,r.b6.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(N,r.bf.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,D.length,k.length)}_makeGlobeTileDebugTextBuffer(o,l,p,y,v,C){let D=r.ag/4,k=new r.b4,N=new r.aU,B=new r.be,H=25;N.reserve(32),k.reserve(H),B.reserve(H);let U=(q,ee)=>H*q+ee;for(let q=0;q<H;q++){let ee=q*D;for(let Q=0;Q<H;Q++){let ie=Q*D;k.emplaceBack(ie,ee);let re=this._globePoint(ie,ee,l,p,y,v,C);B.emplaceBack(re[0],re[1],re[2])}}for(let q=0;q<4;q++)for(let ee=0;ee<4;ee++){let Q=U(q,ee),ie=U(q,ee+1),re=U(q+1,ee),ue=U(q+1,ee+1);N.emplaceBack(Q,ie,re),N.emplaceBack(re,ie,ue)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(N),this._tileDebugTextBuffer=o.createVertexBuffer(k,r.b6.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(B,r.bf.members),this._tileDebugTextSegments=r.b7.simpleSegment(0,0,H,32)}destroy(o=!1){for(let l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bg.setPbf(r.bh);class Kc extends Bs{constructor(o,l,p,y,v){super(o,l,p,y,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(o,l){let p=l.context,y=p.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture&&this.texture instanceof r.T?this.texture.update(o,{premultiply:!1}):this.texture=new r.T(p,o,y.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(o=16384,l){let p=this._mrt=new r.bg(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=r.bi(y,(v,C,D,k)=>{if(v)l(v);else try{let N=p.getHeaderLength(C);if(N>o)return void(this.request=this.fetchHeader(N,l));p.parseHeader(C),this._isHeaderLoaded=!0;let B=0;for(let H of Object.values(p.layers))B=Math.max(B,H.dataIndex[H.dataIndex.length-1].last_byte);C.byteLength>=B&&(this.entireBuffer=C),l(null,this.entireBuffer||C,D,k)}catch(N){l(N)}}),this.request}fetchBand(o,l,p){let y=this._mrt;if(!this._isHeaderLoaded||!y)return void p(new Error("Tile header is not ready"));let v=this.actor;if(!v)return void p(new Error("Can't fetch tile band without an actor"));let C,D=(H,U)=>{C.complete(H,U),H?p(H):(this.updateTextureDescriptor(o,l),p(null,this.textureDescriptor&&this.textureDescriptor.img))},k=(H,U)=>{if(H)return p(H);let q=v.send("decodeRasterArray",{buffer:U,task:C},D,void 0,!0);this._workQueue.push(()=>{q&&q.cancel(),C.cancel()})},N=y.getLayer(o);if(!N)return void p(new Error(`Unknown sourceLayer "${o}"`));if(N.hasDataForBand(l))return this.updateTextureDescriptor(o,l),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);let B=N.getDataRange([l]);if(C=y.createDecodingTask(B),!C||C.tasks.length)if(this.flushQueues(),this.entireBuffer)k(null,this.entireBuffer.slice(B.firstByte,B.lastByte+1));else{let H=Object.assign({},this.requestParams,{headers:{Range:`bytes=${B.firstByte}-${B.lastByte}`}}),U=r.bi(H,k);this._fetchQueue.push(()=>{U.cancel(),C.cancel()})}else p(null)}updateNeeded(o,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==o)&&this.state!=="errored"}updateTextureDescriptor(o,l){if(!this._mrt)return;let p=this._mrt.getLayer(o);if(!p||!p.hasBand(l)||!p.hasDataForBand(l))return;let{bytes:y,tileSize:v,buffer:C,offset:D,scale:k}=p.getBandView(l),N=v+2*C,B={data:y,width:N,height:N},H=this.texture;H&&H instanceof r.T&&H.update(B,{premultiply:!1}),this.textureDescriptor={layer:o,band:l,img:B,buffer:C,offset:D,tileSize:v,format:p.pixelFormat,mix:[k,256*k,65536*k,16777216*k]}}}class oc{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(let o in this.data)for(let l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,p){let y=o.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);let v={value:l,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(o,v)},p)),this.data[y].push(v),this.order.push(y),this.order.length>this.max){let C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){let l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){let l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;let p=o.wrapped().key,y=l===void 0?0:this.data[p].indexOf(l),v=this.data[p][y];return this.data[p].splice(y,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){let l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){let l=[];for(let p in this.data)for(let y of this.data[p])o(y.value)||l.push(y);for(let p of l)this.remove(p.value.tileID,p)}}class Ol{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,p){let y=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][y]=this.stateChanges[o][y]||{},r.l(this.stateChanges[o][y],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(let v in this.state[o])v!==y&&(this.deletedStates[o][v]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][y]===null){this.deletedStates[o][y]={};for(let v in this.state[o][y])p[v]||(this.deletedStates[o][y][v]=null)}else for(let v in p)this.deletedStates[o]&&this.deletedStates[o][y]&&this.deletedStates[o][y][v]===null&&delete this.deletedStates[o][y][v]}removeFeatureState(o,l,p){if(this.deletedStates[o]===null)return;let y=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&l!==void 0)this.deletedStates[o][y]!==null&&(this.deletedStates[o][y]=this.deletedStates[o][y]||{},this.deletedStates[o][y][p]=null);else if(l!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][y])for(p in this.deletedStates[o][y]={},this.stateChanges[o][y])this.deletedStates[o][y][p]=null;else this.deletedStates[o][y]=null;else this.deletedStates[o]=null}getState(o,l){let p=this.state[o]||{},y=this.stateChanges[o]||{},v=this.deletedStates[o];if(v===null)return{};if(l!==void 0){let D=String(l),k=r.l({},p[D],y[D]);if(v){let N=v[l];if(N===null)return{};for(let B in N)delete k[B]}return k}let C=r.l({},p,y);if(v)for(let D in v)delete C[D];return C}initializeTileState(o,l){o.refreshFeatureState(l)}coalesceChanges(o,l){let p={};for(let y in this.stateChanges){this.state[y]=this.state[y]||{};let v={};for(let C in this.stateChanges[y])this.state[y][C]||(this.state[y][C]={}),r.l(this.state[y][C],this.stateChanges[y][C]),v[C]=this.state[y][C];p[y]=v}for(let y in this.deletedStates){this.state[y]=this.state[y]||{};let v={};if(this.deletedStates[y]===null)for(let C in this.state[y])v[C]={},this.state[y][C]={};else for(let C in this.deletedStates[y]){if(this.deletedStates[y][C]===null)this.state[y][C]={};else if(this.state[y][C])for(let D of Object.keys(this.deletedStates[y][C]))delete this.state[y][C][D];v[C]=this.state[y][C]}p[y]=p[y]||{},r.l(p[y],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(let y in o)o[y].refreshFeatureState(l)}}class ls extends r.E{constructor(o,l,p){super(),this.id=o,this._onlySymbols=p,l.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new oc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ol,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let o in this._tiles){let l=this._tiles[o];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let l in this._tiles){let p=this._tiles[l];p.upload(o),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.bj(this._tiles).map(o=>o.tileID).sort(sc).map(o=>o.key)}getRenderableIds(o,l){let p=[];for(let y in this._tiles)this._isIdRenderable(+y,o,l)&&p.push(this._tiles[y]);return o?p.sort((y,v)=>{let C=y.tileID,D=v.tileID,k=new r.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle),N=new r.P(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return C.overscaledZ-D.overscaledZ||N.y-k.y||N.x-k.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(sc).map(y=>y.key)}hasRenderableParent(o){let l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l,p){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())&&(p||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){let p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=l),this._loadTile(p,this._tileLoaded.bind(this,p,o,l)))}_tileLoaded(o,l,p,y){if(y)if(o.state="errored",y.status!==404)this._source.fire(new r.y(y,{tile:o}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else o.timeAdded=r.q.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){let l=this.getRenderableIds();for(let y=0;y<l.length;y++){let v=l[y];if(o.neighboringTiles&&o.neighboringTiles[v]){let C=this.getTileByID(v);p(o,C),p(C,o)}}function p(y,v){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let C=v.tileID.canonical.x-y.tileID.canonical.x,D=v.tileID.canonical.y-y.tileID.canonical.y,k=Math.pow(2,y.tileID.canonical.z),N=v.tileID.key;C===0&&D===0||Math.abs(D)>1||(Math.abs(C)>1&&(Math.abs(C+k)===1?C+=k:Math.abs(C-k)===1&&(C-=k)),v.dem&&y.dem&&(y.dem.backfillBorder(v.dem,C,D),y.neighboringTiles&&y.neighboringTiles[N]&&(y.neighboringTiles[N].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,p,y){for(let v in this._tiles){let C=this._tiles[v];if(y[v]||!C.hasData()||C.tileID.overscaledZ<=l||C.tileID.overscaledZ>p)continue;let D=C.tileID;for(;C&&C.tileID.overscaledZ>l+1;){let N=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[N.key],C&&C.hasData()&&(D=N)}let k=D;for(;k.overscaledZ>l;)if(k=k.scaledTo(k.overscaledZ-1),o[k.key]){y[D.key]=D;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){let p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=l?p:null}for(let p=o.overscaledZ-1;p>=l;p--){let y=o.scaledTo(p),v=this._getLoadedTile(y);if(v)return v}}_getLoadedTile(o){let l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;let p=Math.ceil(o.width/l)+1,y=Math.ceil(o.height/l)+1,v=Math.floor(p*y*5),C=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,D=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(D)}handleWrapJump(o){let l=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,l){let p={};for(let y in this._tiles){let v=this._tiles[y];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),p[v.tileID.key]=v}this._tiles=p;for(let y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(let y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(o,l,p,y){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(o,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let v=this._source.type==="batched-model",C,D=this._source.maxzoom,k=this.map&&this.map.painter?this.map.painter._terrain:null;if(k&&k.sourceCache===this&&k.attenuationRange()){let H=k.attenuationRange()[0],U=Math.floor(H)-Math.log2(k.getDemUpscale());D>U&&(D=U)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new r.aG(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y));else if(this.tileCoverLift!==0){let H=o.clone();H.tileCoverLift=this.tileCoverLift,C=H.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&o.projection.name==="globe"&&(C.push(new r.aG(1,0,1,0,0)),C.push(new r.aG(1,0,1,1,0)),C.push(new r.aG(1,0,1,0,1)),C.push(new r.aG(1,0,1,1,1)))}else if(C=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){let H=this._source.hasTile.bind(this._source);C=C.filter(U=>H(U))}}else C=[];if(C.length>0&&this.castsShadows&&y&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Jc(this._source.type)){let H=o.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),U=Math.min(H,this._source.maxzoom);if(v){let q=o.extendTileCover(C,U);for(let ee of q)C.push(ee)}else{let q=o.extendTileCover(C,U,y);for(let ee of q)this._shadowCasterTiles[ee.key]=!0,C.push(ee)}}let N=this._updateRetainedTiles(C);if(Jc(this._source.type)&&C.length!==0){let H={},U={},q=Object.keys(N);for(let Q of q){let ie=N[Q],re=this._tiles[Q];if(!re||re.fadeEndTime&&re.fadeEndTime<=r.q.now())continue;let ue=this.findLoadedParent(ie,Math.max(ie.overscaledZ-ls.maxOverzooming,this._source.minzoom));ue&&(this._addTile(ue.tileID),H[ue.tileID.key]=ue.tileID),U[Q]=ie}let ee=C[C.length-1].overscaledZ;for(let Q in this._tiles){let ie=this._tiles[Q];if(N[Q]||!ie.hasData())continue;let re=ie.tileID;for(;re.overscaledZ>ee;){re=re.scaledTo(re.overscaledZ-1);let ue=this._tiles[re.key];if(ue&&ue.hasData()&&U[re.key]){N[Q]=ie.tileID;break}}}for(let Q in H)N[Q]||(this._coveredTiles[Q]=!0,N[Q]=H[Q])}for(let H in N)this._tiles[H].clearFadeHold();let B=r.bk(this._tiles,N);for(let H of B){let U=this._tiles[H];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(+H)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){let l={};if(o.length===0)return l;let p={},y=o.reduce((N,B)=>Math.min(N,B.overscaledZ),1/0),v=o[0].overscaledZ,C=Math.max(v-ls.maxOverzooming,this._source.minzoom),D=Math.max(v+ls.maxUnderzooming,this._source.minzoom),k={};for(let N of o){let B=this._addTile(N);l[N.key]=N,B.hasData()||y<this._source.maxzoom&&(k[N.key]=N)}this._retainLoadedChildren(k,y,D,l);for(let N of o){let B=this._tiles[N.key];if(B.hasData())continue;if(N.canonical.z>=this._source.maxzoom){let U=N.children(this._source.maxzoom)[0],q=this.getTile(U);if(q&&q.hasData()){l[U.key]=U;continue}}else{let U=N.children(this._source.maxzoom);if(l[U[0].key]&&l[U[1].key]&&l[U[2].key]&&l[U[3].key])continue}let H=B.wasRequested();for(let U=N.overscaledZ-1;U>=C;--U){let q=N.scaledTo(U);if(p[q.key]||(p[q.key]=!0,B=this.getTile(q),!B&&H&&(B=this._addTile(q)),B&&(l[q.key]=q,H=B.wasRequested(),B.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let o in this._tiles){let l=[],p,y=this._tiles[o].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}l.push(y.key);let v=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;y=v}for(let v of l)this._loadedParentTiles[v]=p}}_addTile(o){let l=this._tiles[o.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));let p=!!l;if(!p){let y=this.map?this.map.painter:null,v=this._source.tileSize*o.overscaleFactor();l=this._source.type==="raster-array"?new Kc(o,v,this.transform.tileZoom,y,this._isRaster):new Bs(o,v,this.transform.tileZoom,y,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,p||this._source.fire(new r.z("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);let p=l.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){let l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,p){let y=[],v=this.transform;if(!v)return y;let C=v.projection.name==="globe",D=r.at(v.center.lng);for(let k in this._tiles){let N=this._tiles[k];if(p&&N.clearQueryDebugViz(),N.holdingForFade())continue;let B;if(C){let H=N.tileID.canonical;if(H.z===0){let U=[Math.abs(r.aw(D,...oi(H,-1))-D),Math.abs(r.aw(D,...oi(H,1))-D)];B=[0,2*U.indexOf(Math.min(...U))-1]}else{let U=[Math.abs(r.aw(D,...oi(H,-1))-D),Math.abs(r.aw(D,...oi(H,0))-D),Math.abs(r.aw(D,...oi(H,1))-D)];B=[U.indexOf(Math.min(...U))-1]}}else B=[0];for(let H of B){let U=o.containsTile(N,v,l,H);U&&y.push(U)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,l){let p=this.getRenderableIds(o,l).map(v=>this._tiles[v].tileID),y=this.transform.projection.name==="globe";for(let v of p)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=y?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return p}sortCoordinatesByDistance(o){let l=o.slice(),p=this.transform._camera.position,y=this.transform._camera.forward(),v={};for(let C of l){let D=1/(1<<C.canonical.z);v[C.key]=((C.canonical.x+.5)*D+C.wrap-p[0])*y[0]+((C.canonical.y+.5)*D-p[1])*y[1]-p[2]*y[2]}return l.sort((C,D)=>v[C.key]-v[D.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(Jc(this._source.type))for(let o in this._tiles){let l=this._tiles[o];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(o,l,p){this._state.updateState(o=o||"_geojsonTileLayer",l,p)}removeFeatureState(o,l,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,p)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,p){let y=this._tiles[o];y&&y.setDependencies(l,p)}reloadTilesForDependencies(o,l){for(let p in this._tiles)this._tiles[p].hasDependency(o,l)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(o,l))}_preloadTiles(o,l){if(!this._sourceLoaded){let k=()=>{this._sourceLoaded&&(this._source.off("data",k),this._preloadTiles(o,l))};return void this._source.on("data",k)}let p=new Map,y=Array.isArray(o)?o:[o],v=this.map.painter.terrain,C=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(let k of y){let N=k.coveringTiles({tileSize:C,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let B of N)p.set(B.key,B);this.usedForTerrain&&k.updateElevation(!1)}let D=Array.from(p.values());r.bl(D,(k,N)=>{let B=new Bs(k,this._source.tileSize*k.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(B,H=>{this._source.type==="raster-dem"&&B.dem&&this._backfillDEM(B),N(H,B)})},l)}}function sc(f,o){let l=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return f.overscaledZ-o.overscaledZ||p-l||o.canonical.y-f.canonical.y||o.canonical.x-f.canonical.x}function Jc(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function oi(f,o){let l=1<<f.z;return[f.x/l+o,(f.x+1)/l+o]}ls.maxOverzooming=10,ls.maxUnderzooming=3;class jh{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let o=!1,l=!1;for(let p in this.style._mergedLayers){let y=this.style._mergedLayers[p];if(y.type==="fill-extrusion")this.layers.push({layer:y,visible:o,visibilityChanged:l});else if(y.type==="model"){let v=this.style.getLayerSource(y);v&&v.type==="batched-model"&&this.layers.push({layer:y,visible:o,visibilityChanged:l})}}}onNewFrame(o){this.layersGotHidden=!1;for(let l of this.layers){let p=l.layer,y=!1;p.type==="fill-extrusion"?y=!p.isHidden(o)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(y=!p.isHidden(o)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&l.visible,l.visible=y}}updateZOffset(o,l){this.currentBuildingBuckets=[];for(let y of this.layers){let v=y.layer,C=this.style.getLayerSourceCache(v),D=1;v.type==="fill-extrusion"&&(D=y.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let k=C?C.getTile(l):null;if(!k&&C&&l.canonical.z>C.getSource().minzoom){let N=l.scaledTo(Math.min(C.getSource().maxzoom,l.overscaledZ-1));for(;N.overscaledZ>=C.getSource().minzoom&&(k=C.getTile(N),!k&&N.overscaledZ!==0);)N=N.scaledTo(N.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:k?k.getBucket(v):null,tileID:k?k.tileID:l,verticalScale:D})}o.hasAnyZOffset=!1;let p=!1;for(let y=0;y<o.symbolInstances.length;y++){let v=o.symbolInstances.get(y),C=v.zOffset,D=this._getHeightAtTileOffset(l,v.tileAnchorX,v.tileAnchorY);v.zOffset=D!==Number.NEGATIVE_INFINITY?D:C,p||C===v.zOffset||(p=!0),o.hasAnyZOffset||v.zOffset===0||(o.hasAnyZOffset=!0)}p&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,l,p,y){let v=l,C=p;if(o.canonical.z!==y.canonical.z){let D=y.canonical,k=1/(1<<o.canonical.z-D.z);v=(l+o.canonical.x*r.ag)*k-D.x*r.ag|0,C=(p+o.canonical.y*r.ag)*k-D.y*r.ag|0}return{tileX:v,tileY:C}}_getHeightAtTileOffset(o,l,p){let y,v;for(let C=0;C<this.layers.length;++C){if(this.layers[C].layer.type!=="fill-extrusion")continue;let{bucket:D,tileID:k,verticalScale:N}=this.currentBuildingBuckets[C];if(!D)continue;let{tileX:B,tileY:H}=this._mapCoordToOverlappingTile(o,l,p,k),U=D.getHeightAtTileCoord(B,H);U&&U.height!==void 0&&(U.hidden?y=U.height:v=Math.max(U.height*N,v||0))}if(v!==void 0)return v;for(let C=0;C<this.layers.length;++C){let D=this.layers[C];if(D.layer.type!=="model"||!D.visible)continue;let{bucket:k,tileID:N}=this.currentBuildingBuckets[C];if(!k)continue;let{tileX:B,tileY:H}=this._mapCoordToOverlappingTile(o,l,p,N),U=k.getHeightAtTileCoord(B,H);if(U&&!U.hidden)return U.height===void 0&&y!==void 0?Math.min(U.maxHeight,y)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function gn(f,o){let l={};for(let p in f)p!=="ref"&&(l[p]=f[p]);return r.bm.forEach(p=>{p in o&&(l[p]=o[p])}),l}function Uu(f){f=f.slice();let o=Object.create(null);for(let l=0;l<f.length;l++)o[f[l].id]=f[l];for(let l=0;l<f.length;l++)"ref"in f[l]&&(f[l]=gn(f[l],o[f[l].ref]));return f}let li={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function _i(f,o,l){l.push({command:li.addSource,args:[f,o[f]]})}function oo(f,o,l){o.push({command:li.removeSource,args:[f]}),l[f]=!0}function wr(f,o,l,p){oo(f,l,p),_i(f,o,l)}function ac(f,o,l){let p;for(p in f[l])if(f[l].hasOwnProperty(p)&&p!=="data"&&!r.bn(f[l][p],o[l][p]))return!1;for(p in o[l])if(o[l].hasOwnProperty(p)&&p!=="data"&&!r.bn(f[l][p],o[l][p]))return!1;return!0}function Yt(f,o,l,p,y,v){let C;for(C in o=o||{},f=f||{})f.hasOwnProperty(C)&&(r.bn(f[C],o[C])||l.push({command:v,args:[p,C,o[C],y]}));for(C in o)o.hasOwnProperty(C)&&!f.hasOwnProperty(C)&&(r.bn(f[C],o[C])||l.push({command:v,args:[p,C,o[C],y]}))}function di(f){return f.id}function ii(f,o){return f[o.id]=o,f}class yo{constructor(o,l){this.reset(o,l)}reset(o,l){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=r.aw(o,0,1);let l=1,p=this._distances[l],y=o*this.paddedLength+this.padding;for(;p<y&&l<this._distances.length;)p=this._distances[++l];let v=l-1,C=this._distances[v],D=p-C,k=D>0?(y-C)/D:0;return this.points[v].mult(1-k).add(this.points[l].mult(k))}}class Qa{constructor(o,l,p){let y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(l/p);for(let C=0;C<this.xCellCount*this.yCellCount;C++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=l,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,l,p,y,v){this._forEachCell(l,p,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(o,l,p,y){this._forEachCell(l-y,p-y,l+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(l),this.circles.push(p),this.circles.push(y)}_insertBoxCell(o,l,p,y,v,C){this.boxCells[v].push(C)}_insertCircleCell(o,l,p,y,v,C){this.circleCells[v].push(C)}_query(o,l,p,y,v,C){if(p<0||o>this.width||y<0||l>this.height)return!v&&[];let D=[];if(o<=0&&l<=0&&this.width<=p&&this.height<=y){if(v)return!0;for(let k=0;k<this.boxKeys.length;k++)D.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){let N=this.circles[3*k],B=this.circles[3*k+1],H=this.circles[3*k+2];D.push({key:this.circleKeys[k],x1:N-H,y1:B-H,x2:N+H,y2:B+H})}return C?D.filter(C):D}return this._forEachCell(o,l,p,y,this._queryCell,D,{hitTest:v,seenUids:{box:{},circle:{}}},C),v?D.length>0:D}_queryCircle(o,l,p,y,v){let C=o-p,D=o+p,k=l-p,N=l+p;if(D<0||C>this.width||N<0||k>this.height)return!y&&[];let B=[];return this._forEachCell(C,k,D,N,this._queryCellCircle,B,{hitTest:y,circle:{x:o,y:l,radius:p},seenUids:{box:{},circle:{}}},v),y?B.length>0:B}query(o,l,p,y,v){return this._query(o,l,p,y,!1,v)}hitTest(o,l,p,y,v){return this._query(o,l,p,y,!0,v)}hitTestCircle(o,l,p,y){return this._queryCircle(o,l,p,!0,y)}_queryCell(o,l,p,y,v,C,D,k){let N=D.seenUids,B=this.boxCells[v];if(B!==null){let U=this.bboxes;for(let q of B)if(!N.box[q]){N.box[q]=!0;let ee=4*q;if(o<=U[ee+2]&&l<=U[ee+3]&&p>=U[ee+0]&&y>=U[ee+1]&&(!k||k(this.boxKeys[q]))){if(D.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[q],x1:U[ee],y1:U[ee+1],x2:U[ee+2],y2:U[ee+3]})}}}let H=this.circleCells[v];if(H!==null){let U=this.circles;for(let q of H)if(!N.circle[q]){N.circle[q]=!0;let ee=3*q;if(this._circleAndRectCollide(U[ee],U[ee+1],U[ee+2],o,l,p,y)&&(!k||k(this.circleKeys[q]))){if(D.hitTest)return C.push(!0),!0;{let Q=U[ee],ie=U[ee+1],re=U[ee+2];C.push({key:this.circleKeys[q],x1:Q-re,y1:ie-re,x2:Q+re,y2:ie+re})}}}}}_queryCellCircle(o,l,p,y,v,C,D,k){let N=D.circle,B=D.seenUids,H=this.boxCells[v];if(H!==null){let q=this.bboxes;for(let ee of H)if(!B.box[ee]){B.box[ee]=!0;let Q=4*ee;if(this._circleAndRectCollide(N.x,N.y,N.radius,q[Q+0],q[Q+1],q[Q+2],q[Q+3])&&(!k||k(this.boxKeys[ee])))return C.push(!0),!0}}let U=this.circleCells[v];if(U!==null){let q=this.circles;for(let ee of U)if(!B.circle[ee]){B.circle[ee]=!0;let Q=3*ee;if(this._circlesCollide(q[Q],q[Q+1],q[Q+2],N.x,N.y,N.radius)&&(!k||k(this.circleKeys[ee])))return C.push(!0),!0}}}_forEachCell(o,l,p,y,v,C,D,k){let N=this._convertToXCellCoord(o),B=this._convertToYCellCoord(l),H=this._convertToXCellCoord(p),U=this._convertToYCellCoord(y);for(let q=N;q<=H;q++)for(let ee=B;ee<=U;ee++)if(v.call(this,o,l,p,y,this.xCellCount*ee+q,C,D,k))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,l,p,y,v,C){let D=y-o,k=v-l,N=p+C;return N*N>D*D+k*k}_circleAndRectCollide(o,l,p,y,v,C,D){let k=(C-y)/2,N=Math.abs(o-(y+k));if(N>k+p)return!1;let B=(D-v)/2,H=Math.abs(l-(v+B));if(H>B+p)return!1;if(N<=k||H<=B)return!0;let U=N-k,q=H-B;return U*U+q*q<=p*p}}let Kn={unknown:0,flipRequired:1,flipNotRequired:2},vo=Math.tan(85*Math.PI/180);function Jo(f,o,l,p,y,v,C){let D=r.ab.mat4.create();if(l)if(v.name==="globe"){let k=r.bo(y,o);r.ab.mat4.multiply(D,D,k)}else{let k=r.ab.mat2.invert([],C);D[0]=k[0],D[1]=k[1],D[4]=k[2],D[5]=k[3],p||r.ab.mat4.rotateZ(D,D,y.angle)}else r.ab.mat4.multiply(D,y.labelPlaneMatrix,f);return D}function Al(f,o,l,p,y,v,C){let D=Jo(f,o,l,p,y,v,C);return v.name==="globe"&&l||(D[2]=D[6]=D[10]=D[14]=0),D}function Ao(f,o,l,p,y,v,C){if(l){if(v.name==="globe"){let D=Jo(f,o,l,p,y,v,C);return r.ab.mat4.invert(D,D),r.ab.mat4.multiply(D,f,D),D}{let D=r.ab.mat4.clone(f),k=r.ab.mat4.identity([]);return k[0]=C[0],k[1]=C[1],k[4]=C[2],k[5]=C[3],r.ab.mat4.multiply(D,D,k),p||r.ab.mat4.rotateZ(D,D,-y.angle),D}}return y.glCoordMatrix}function Wi(f,o,l,p){let y=[f,o,l,1];l?r.ab.vec4.transformMat4(y,y,p):el(y,y,p);let v=y[3];return y[0]/=v,y[1]/=v,y[2]/=v,y}function ff(f,o){return Math.min(.5+f/o*.5,1.5)}function lc(f,o){let l=f[0]/f[3],p=f[1]/f[3];return l>=-o[0]&&l<=o[0]&&p>=-o[1]&&p<=o[1]}function Uh(f,o,l,p,y,v,C,D,k,N){let B=l.transform,H=p?f.textSizeData:f.iconSizeData,U=r.bp(H,l.transform.zoom),q=B.projection.name==="globe",ee=[256/l.width*2+1,256/l.height*2+1],Q=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Q.clear();let ie=null;q&&(ie=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);let re=f.lineVertexArray,ue=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ge=l.transform.width/l.transform.height,pe,we=!1;for(let xe=0;xe<ue.length;xe++){let be=ue.get(xe),{numGlyphs:ve,writingMode:Ie}=be;if(Ie!==r.bq.vertical||we||pe===r.bq.horizontal||(we=!0),pe=Ie,(be.hidden||Ie===r.bq.vertical)&&!we){uc(ve,Q);continue}we=!1;let Re=new r.P(be.tileAnchorX,be.tileAnchorY),{x:Ye,y:$e,z:Ae}=B.projection.projectTilePoint(Re.x,Re.y,N.canonical);if(k){let[lt,Nt,Ht]=k(Re);Ye+=lt,$e+=Nt,Ae+=Ht}let ze=[Ye,$e,Ae,1];if(r.ab.vec4.transformMat4(ze,ze,o),!lc(ze,ee)){uc(ve,Q);continue}let at=ze[3],gt=ff(l.transform.getCameraToCenterDistance(B.projection),at),St=r.br(H,U,be),Ve=C?St/gt:St*gt,dt=Wi(Ye,$e,Ae,y);if(dt[3]<=0){uc(ve,Q);continue}let et={},Ct=C?null:k,pt=Hu(be,Ve,!1,D,o,y,v,f.glyphOffsetArray,re,Q,ie,dt,Re,et,ge,Ct,B.projection,N,C);we=pt.useVertical,Ct&&pt.needsFlipping&&(et={}),(pt.notEnoughRoom||we||pt.needsFlipping&&Hu(be,Ve,!0,D,o,y,v,f.glyphOffsetArray,re,Q,ie,dt,Re,et,ge,Ct,B.projection,N,C).notEnoughRoom)&&uc(ve,Q)}p?(f.text.dynamicLayoutVertexBuffer.updateData(Q),ie&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(ie)):(f.icon.dynamicLayoutVertexBuffer.updateData(Q),ie&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(ie))}function cc(f,o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q){let{lineStartIndex:ie,glyphStartIndex:re,segment:ue}=D,ge=re+D.numGlyphs,pe=ie+D.lineLength,we=o.getoffsetX(re),xe=o.getoffsetX(ge-1),be=so(f*we,l,p,y,v,C,ue,ie,pe,k,N,B,H,U,!0,q,ee,Q);if(!be)return null;let ve=so(f*xe,l,p,y,v,C,ue,ie,pe,k,N,B,H,U,!0,q,ee,Q);return ve?{first:be,last:ve}:null}function zi(f,o,l,p){return f===r.bq.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:f===r.bq.vertical?p>0?{needsFlipping:!0}:null:o!==Kn.unknown&&function(y,v){return y===0||Math.abs(v/y)>vo}(l,p)?o===Kn.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function Hu(f,o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q,ie,re,ue){let ge=o/24,pe=f.lineOffsetX*ge,we=f.lineOffsetY*ge,{lineStartIndex:xe,glyphStartIndex:be,numGlyphs:ve,segment:Ie,writingMode:Re,flipState:Ye}=f,$e=xe+f.lineLength,Ae=ze=>{if(B){let[Ve,dt,et]=ze.up,Ct=N.length;r.bs(B,Ct+0,Ve,dt,et),r.bs(B,Ct+1,Ve,dt,et),r.bs(B,Ct+2,Ve,dt,et),r.bs(B,Ct+3,Ve,dt,et)}let[at,gt,St]=ze.point;r.bt(N,at,gt,St,ze.angle)};if(ve>1){let ze=cc(ge,D,pe,we,l,H,U,f,k,v,q,Q,!1,ie,re,ue);if(!ze)return{notEnoughRoom:!0};if(p&&!l){let[at,gt,St]=ze.first.point,[Ve,dt,et]=ze.last.point;[at,gt]=Wi(at,gt,St,C),[Ve,dt]=Wi(Ve,dt,et,C);let Ct=zi(Re,Ye,(Ve-at)*ee,dt-gt);if(f.flipState=Ct&&Ct.needsFlipping?Kn.flipRequired:Kn.flipNotRequired,Ct)return Ct}Ae(ze.first);for(let at=be+1;at<be+ve-1;at++){let gt=so(ge*D.getoffsetX(at),pe,we,l,H,U,Ie,xe,$e,k,v,q,Q,!1,!1,ie,re,ue);if(!gt)return N.length-=4*(at-be),{notEnoughRoom:!0};Ae(gt)}Ae(ze.last)}else{if(p&&!l){let at=Wi(U.x,U.y,0,y),gt=xe+Ie+1,St=new r.P(k.getx(gt),k.gety(gt)),Ve=Wi(St.x,St.y,0,y),dt=Ve[3]>0?Ve:cs(U,St,at,1,y,void 0,ie,re.canonical),et=zi(Re,Ye,(dt[0]-at[0])*ee,dt[1]-at[1]);if(f.flipState=et&&et.needsFlipping?Kn.flipRequired:Kn.flipNotRequired,et)return et}let ze=so(ge*D.getoffsetX(be),pe,we,l,H,U,Ie,xe,$e,k,v,q,Q,!1,!1,ie,re,ue);if(!ze)return{notEnoughRoom:!0};Ae(ze)}return{}}function Sr(f,o,l,p,y){let{x:v,y:C,z:D}=p.projectTilePoint(f.x,f.y,o);if(!y)return Wi(v,C,D,l);let[k,N,B]=y(f);return Wi(v+k,C+N,D+B,l)}function cs(f,o,l,p,y,v,C,D){let k=Sr(f.sub(o)._unit()._add(f),D,y,C,v);return r.ab.vec3.sub(k,l,k),r.ab.vec3.normalize(k,k),r.ab.vec3.scaleAndAdd(k,l,k,p)}function so(f,o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q,ie,re){let ue=p?f-o:f+o,ge=ue>0?1:-1,pe=0;p&&(ge*=-1,pe=Math.PI),ge<0&&(pe+=Math.PI);let we=D+C+(ge>0?0:1)|0,xe=y,be=y,ve=0,Ie=0,Re=Math.abs(ue),Ye=[],$e=[],Ae=v,ze=Ae,at=()=>cs(ze,Ae,be,Re-ve+1,B,U,Q,ie.canonical);for(;ve+Ie<=Re;){if(we+=ge,we<D||we>=k)return null;if(be=xe,ze=Ae,Ye.push(be),q&&$e.push(ze),Ae=new r.P(N.getx(we),N.gety(we)),xe=H[we],!xe){let Nt=Sr(Ae,ie.canonical,B,Q,U);xe=Nt[3]>0?H[we]=Nt:at()}ve+=Ie,Ie=r.ab.vec3.distance(be,xe)}ee&&U&&(H[we]&&(xe=at(),Ie=r.ab.vec3.distance(be,xe)),H[we]=xe);let gt=(Re-ve)/Ie,St=Ae.sub(ze)._mult(gt)._add(ze),Ve=r.ab.vec3.sub([],xe,be),dt=r.ab.vec3.scaleAndAdd([],be,Ve,gt),et=[0,0,1],Ct=Ve[0],pt=Ve[1];if(re&&(et=Q.upVector(ie.canonical,St.x,St.y),et[0]!==0||et[1]!==0||et[2]!==1)){let Nt=[et[2],0,-et[0]],Ht=r.ab.vec3.cross([],et,Nt);r.ab.vec3.normalize(Nt,Nt),r.ab.vec3.normalize(Ht,Ht),Ct=r.ab.vec3.dot(Ve,Nt),pt=r.ab.vec3.dot(Ve,Ht)}if(l){let Nt=r.ab.vec3.cross([],et,Ve);r.ab.vec3.normalize(Nt,Nt),r.ab.vec3.scaleAndAdd(dt,dt,Nt,l*ge)}let lt=pe+Math.atan2(pt,Ct);return Ye.push(dt),q&&$e.push(St),{point:dt,angle:lt,path:Ye,tilePath:$e,up:et}}function uc(f,o){let l=o.length,p=l+4*f;o.resize(p),o.float32.fill(-1/0,4*l,4*p)}function el(f,o,l){let p=o[0],y=o[1];return f[0]=l[0]*p+l[4]*y+l[12],f[1]=l[1]*p+l[5]*y+l[13],f[3]=l[3]*p+l[7]*y+l[15],f}let dr=100;class Vs{constructor(o,l,p=new Qa(o.width+200,o.height+200,25),y=new Qa(o.width+200,o.height+200,25)){this.transform=o,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+dr,this.screenBottomBoundary=o.height+dr,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=l}placeCollisionBox(o,l,p,y,v,C,D,k){let N=p.projectedAnchorX,B=p.projectedAnchorY,H=p.projectedAnchorZ,U=p.elevation,q=p.tileID,ee=o.getProjection();if(U&&q){let[xe,be,ve]=ee.upVector(q.canonical,p.tileAnchorX,p.tileAnchorY),Ie=ee.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=xe*U*Ie,B+=be*U*Ie,H+=ve*U*Ie}let Q=this.projectAndGetPerspectiveRatio(D,N,B,H,p.tileID,ee.name==="globe"||!!U||this.transform.pitch>0,ee),ie=C*Q.perspectiveRatio,re=(p.x1*l+y.x-p.padding)*ie+Q.point.x,ue=(p.y1*l+y.y-p.padding)*ie+Q.point.y,ge=(p.x2*l+y.x+p.padding)*ie+Q.point.x,pe=(p.y2*l+y.y+p.padding)*ie+Q.point.y,we=Q.perspectiveRatio<=.55||Q.occluded;return!this.isInsideGrid(re,ue,ge,pe)||!v&&this.grid.hitTest(re,ue,ge,pe,k)||we?{box:[],offscreen:!1,occluded:Q.occluded}:{box:[re,ue,ge,pe],offscreen:this.isOffscreen(re,ue,ge,pe),occluded:!1}}placeCollisionCircles(o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q){let ie=[],re=this.transform.elevation,ue=o.getProjection(),ge=re?re.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,ue):null,pe=new r.P(p.tileAnchorX,p.tileAnchorY),{x:we,y:xe,z:be}=ue.projectTilePoint(pe.x,pe.y,Q.canonical);if(ge){let[St,Ve,dt]=ge(pe);we+=St,xe+=Ve,be+=dt}let ve=ue.name==="globe",Ie=this.projectAndGetPerspectiveRatio(D,we,xe,be,Q,ve||!!re||this.transform.pitch>0,ue),{perspectiveRatio:Re}=Ie,Ye=(H?C/Re:C*Re)/r.bw,$e=Wi(we,xe,be,k),Ae=Ie.signedDistanceFromCamera>0?cc(Ye,v,p.lineOffsetX*Ye,p.lineOffsetY*Ye,!1,$e,pe,p,y,k,{},re&&!H?ge:null,H&&!!re,ue,Q,H):null,ze=!1,at=!1,gt=!0;if(Ae&&!Ie.occluded){let St=.5*q*Re+ee,Ve=new r.P(-100,-100),dt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),et=new yo,{first:Ct,last:pt}=Ae,lt=Ct.path.length,Nt=[];for(let Wt=lt-1;Wt>=1;Wt--)Nt.push(Ct.path[Wt]);for(let Wt=1;Wt<pt.path.length;Wt++)Nt.push(pt.path[Wt]);let Ht=2.5*St;N&&(Nt=Nt.map(([Wt,Tn,hn],un)=>(ge&&!ve&&(hn=ge(un<lt-1?Ct.tilePath[lt-1-un]:pt.tilePath[un-lt+2])[2]),Wi(Wt,Tn,hn,N))),Nt.some(Wt=>Wt[3]<=0)&&(Nt=[]));let Lt=[];if(Nt.length>0){let Wt=1/0,Tn=-1/0,hn=1/0,un=-1/0;for(let In of Nt)Wt=Math.min(Wt,In[0]),hn=Math.min(hn,In[1]),Tn=Math.max(Tn,In[0]),un=Math.max(un,In[1]);Tn>=Ve.x&&Wt<=dt.x&&un>=Ve.y&&hn<=dt.y&&(Lt=[Nt.map(In=>new r.P(In[0],In[1]))],(Wt<Ve.x||Tn>dt.x||hn<Ve.y||un>dt.y)&&(Lt=r.bu(Lt,Ve.x,Ve.y,dt.x,dt.y)))}for(let Wt of Lt){et.reset(Wt,.25*St);let Tn=0;Tn=et.length<=.5*St?1:Math.ceil(et.paddedLength/Ht)+1;for(let hn=0;hn<Tn;hn++){let un=hn/Math.max(Tn-1,1),In=et.lerp(un),si=In.x+dr,Gn=In.y+dr;ie.push(si,Gn,St,0);let fr=si-St,tr=Gn-St,Ai=si+St,Bi=Gn+St;if(gt=gt&&this.isOffscreen(fr,tr,Ai,Bi),at=at||this.isInsideGrid(fr,tr,Ai,Bi),!l&&this.grid.hitTestCircle(si,Gn,St,U)&&(ze=!0,!B))return{circles:[],offscreen:!1,collisionDetected:ze,occluded:!1}}}}return{circles:!B&&ze||!at?[]:ie,offscreen:gt,collisionDetected:ze,occluded:Ie.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let l=[],p=1/0,y=1/0,v=-1/0,C=-1/0;for(let B of o){let H=new r.P(B.x+dr,B.y+dr);p=Math.min(p,H.x),y=Math.min(y,H.y),v=Math.max(v,H.x),C=Math.max(C,H.y),l.push(H)}let D=this.grid.query(p,y,v,C).concat(this.ignoredGrid.query(p,y,v,C)),k={},N={};for(let B of D){let H=B.key;if(k[H.bucketInstanceId]===void 0&&(k[H.bucketInstanceId]={}),k[H.bucketInstanceId][H.featureIndex])continue;let U=[new r.P(B.x1,B.y1),new r.P(B.x2,B.y1),new r.P(B.x2,B.y2),new r.P(B.x1,B.y2)];r.bv(l,U)&&(k[H.bucketInstanceId][H.featureIndex]=!0,N[H.bucketInstanceId]===void 0&&(N[H.bucketInstanceId]=[]),N[H.bucketInstanceId].push(H.featureIndex))}return N}insertCollisionBox(o,l,p,y,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:v},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,l,p,y,v){let C=l?this.ignoredGrid:this.grid,D={bucketInstanceId:p,featureIndex:y,collisionGroupID:v};for(let k=0;k<o.length;k+=4)C.insertCircle(D,o[k],o[k+1],o[k+2])}projectAndGetPerspectiveRatio(o,l,p,y,v,C,D){let k=[l,p,y,1],N=!1;y||this.transform.pitch>0?(r.ab.vec4.transformMat4(k,k,o),this.fogState&&v&&D.name!=="globe"&&(N=function(U,q,ee,Q,ie,re){let ue=re.calculateFogTileMatrix(ie),ge=[q,ee,Q];return r.ab.vec3.transformMat4(ge,ge,ue),pn(U,r.ab.vec3.length(ge),re.pitch,re._fov)}(this.fogState,l,p,y,v.toUnwrapped(),this.transform)>.9)):el(k,k,o);let B=k[3];return{point:new r.P((k[0]/B+1)/2*this.transform.width+dr,(-k[1]/B+1)/2*this.transform.height+dr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/B*.5,1.5),signedDistanceFromCamera:B,occluded:C&&k[2]>B||N}}isOffscreen(o,l,p,y){return p<dr||o>=this.screenRightBoundary||y<dr||l>this.screenBottomBoundary}isInsideGrid(o,l,p,y){return p>=0&&o<this.gridRightBoundary&&y>=0&&l<this.gridBottomBoundary}getViewportMatrix(){let o=r.ab.mat4.identity([]);return r.ab.mat4.translate(o,o,[-100,-100,0]),o}}function js(f,o,l){let p=o.createTileMatrix(f,f.worldSize,l.toUnwrapped());return r.ab.mat4.multiply(new Float32Array(16),f.projMatrix,p)}function Ur(f,o,l){if(o.projection.name===l.projection.name)return f.projMatrix;let p=l.clone();return p.setProjection(o.projection),js(p,o.getProjection(),f)}function hc(f,o,l){return o.name===l.projection.name?f.projMatrix:js(l,o,f)}class Us{constructor(o,l,p,y){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?l:-l))):y&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Ro{constructor(o,l,p,y,v,C=!1){this.text=new Us(o?o.text:null,l,p,v),this.icon=new Us(o?o.icon:null,l,y,v),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qc{constructor(o,l,p,y=!1){this.text=o,this.icon=l,this.skipFade=p,this.clipped=y}}class Rl{constructor(){this.invProjMatrix=r.ab.mat4.create(),this.viewportMatrix=r.ab.mat4.create(),this.circles=[]}}class kl{constructor(o,l,p,y,v){this.bucketInstanceId=o,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=v}}class Ra{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){let l=++this.maxGroupID;this.collisionGroups[o]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[o]}}function pf(f,o,l,p,y){let{horizontalAlign:v,verticalAlign:C}=r.bD(f),D=-(v-.5)*o,k=-(C-.5)*l,N=r.bC(f,p);return new r.P(D+N[0]*y,k+N[1]*y)}function eu(f,o,l,p,y){let v=new r.P(f,o);return l&&v._rotate(p?y:-y),v}class us{constructor(o,l,p,y,v,C){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new Vs(this.transform,v),this.buildingIndex=C,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Ra(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,l,p,y,v=1){let C=p.getBucket(l),D=p.latestFeatureIndex;if(!C||!D||l.fqid!==C.layerIds[0])return;let k=C.layers[0].layout,N=C.layers[0].paint,B=p.collisionBoxArray,H=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),U=p.tileSize/r.ag,q=p.tileID.toUnwrapped();this.transform.setProjection(C.projection);let ee=(Q=p.tileID,ie=C.getProjection(),re=this.transform,ie.name===this.projection?re.calculateProjMatrix(Q.toUnwrapped()):js(re,ie,Q));var Q,ie,re;let ue=k.get("text-pitch-alignment")==="map",ge=k.get("text-rotation-alignment")==="map";l.compileFilter(l.options);let pe=l.dynamicFilter(),we=l.dynamicFilterNeedsFeature(),xe=this.transform.calculatePixelsToTileUnitsMatrix(p),be=Al(ee,p.tileID.canonical,ue,ge,this.transform,C.getProjection(),xe),ve=null;if(ue){let St=Ao(ee,p.tileID.canonical,ue,ge,this.transform,C.getProjection(),xe);ve=r.ab.mat4.multiply([],this.transform.labelPlaneMatrix,St)}let Ie=null;pe&&p.latestFeatureIndex&&(Ie={unwrappedTileID:q,dynamicFilter:pe,dynamicFilterNeedsFeature:we}),this.retainedQueryData[C.bucketInstanceId]=new kl(C.bucketInstanceId,D,C.sourceLayerIndex,C.index,p.tileID);let[Re,Ye]=C.layers[0].layout.get("text-size-scale-range"),$e=r.aw(v,Re,Ye),[Ae,ze]=k.get("icon-size-scale-range"),at=r.aw(v,Ae,ze),gt={bucket:C,layout:k,paint:N,posMatrix:ee,textLabelPlaneMatrix:be,labelToScreenMatrix:ve,clippingData:Ie,scale:H,textPixelRatio:U,holdingForFade:p.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:r.bp(C.textSizeData,this.transform.zoom,$e),partiallyEvaluatedIconSize:r.bp(C.iconSizeData,this.transform.zoom,at),collisionGroup:this.collisionGroups.get(C.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(y)for(let St of C.sortKeyRanges){let{sortKey:Ve,symbolInstanceStart:dt,symbolInstanceEnd:et}=St;o.push({sortKey:Ve,symbolInstanceStart:dt,symbolInstanceEnd:et,parameters:gt})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:gt})}attemptAnchorPlacement(o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q,ie,re,ue){let{textOffset0:ge,textOffset1:pe,crossTileID:we}=U,xe=[ge,pe],be=pf(o,p,y,xe,v),ve=this.collisionIndex.placeCollisionBox(ee,v,l,eu(be.x,be.y,C,D,this.transform.angle),H,k,N,B.predicate);if(ie){let Ie=ee.getSymbolInstanceIconSize(ue,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ee,Ie,ie,eu(be.x,be.y,C,D,this.transform.angle),H,k,N,B.predicate).box.length===0)return}if(ve.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[we]&&this.prevPlacement.placements[we]&&this.prevPlacement.placements[we].text&&(Ie=this.prevPlacement.variableOffsets[we].anchor),this.variableOffsets[we]={textOffset:xe,width:p,height:y,anchor:o,textScale:v,prevAnchor:Ie},this.markUsedJustification(ee,o,U,Q),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,Q,U),this.placedOrientations[we]=Q),{shift:be,placedGlyphBoxes:ve}}}placeLayerBucketPart(o,l,p,y,v=1){let{bucket:C,layout:D,paint:k,posMatrix:N,textLabelPlaneMatrix:B,labelToScreenMatrix:H,clippingData:U,textPixelRatio:q,holdingForFade:ee,collisionBoxArray:Q,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:re,collisionGroup:ue,latestFeatureIndex:ge}=o.parameters,pe=D.get("text-optional"),we=D.get("icon-optional"),xe=D.get("text-allow-overlap"),be=D.get("icon-allow-overlap"),ve=D.get("text-rotation-alignment")==="map",Ie=D.get("text-pitch-alignment")==="map",Re=D.get("symbol-z-elevate"),Ye=k.get("symbol-z-offset"),$e=D.get("symbol-elevation-reference")==="sea",[Ae,ze]=D.get("text-size-scale-range"),[at,gt]=D.get("icon-size-scale-range"),St=r.aw(v,Ae,ze),Ve=r.aw(v,at,gt);this.transform.setProjection(C.projection);let dt=xe&&(be||!C.hasIconData()||we),et=be&&(xe||!C.hasTextData()||pe),Ct=!Ye.isConstant();!C.collisionArrays&&Q&&C.deserializeCollisionBoxes(Q),p&&y&&C.updateCollisionDebugBuffers(this.transform.zoom,Q,St,Ve);let pt=(lt,Nt,Ht)=>{let{crossTileID:Lt,numVerticalGlyphVertices:Wt}=lt,Tn=null;if(U&&U.dynamicFilterNeedsFeature||Ct){let ar=this.retainedQueryData[C.bucketInstanceId];Tn=ge.loadFeature({featureIndex:lt.featureIndex,bucketIndex:ar.bucketIndex,sourceLayerIndex:ar.sourceLayerIndex,layoutVertexArrayOffset:0})}if(U&&!(0,U.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Tn,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new r.P(lt.tileAnchorX,lt.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[Lt]=new Qc(!1,!1,!1,!0),void l.add(Lt);let hn=Ye.evaluate(Tn,{});if(l.has(Lt))return;if(ee)return void(this.placements[Lt]=new Qc(!1,!1,!1));let un=!1,In=!1,si=!0,Gn=!1,fr=!1,tr=null,Ai={box:null,offscreen:null,occluded:null},Bi={box:null,offscreen:null,occluded:null},qn=null,ci=null,bn=null,Ei=0,Ir=0,ko=0;Ht.textFeatureIndex?Ei=Ht.textFeatureIndex:lt.useRuntimeCollisionCircles&&(Ei=lt.featureIndex),Ht.verticalTextFeatureIndex&&(Ir=Ht.verticalTextFeatureIndex);let Ks=ar=>{ar.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;let Xi=this.transform.elevation;ar.elevation=$e?hn:hn+(Xi?Xi.getAtTileOffset(ar.tileID,ar.tileAnchorX,ar.tileAnchorY):0),ar.elevation+=lt.zOffset},es=Ht.textBox;if(es){Ks(es);let ar=fi=>{let kr=r.bq.horizontal;if(C.allowVerticalPlacement&&!fi&&this.prevPlacement){let Eo=this.prevPlacement.placedOrientations[Lt];Eo&&(this.placedOrientations[Lt]=Eo,kr=Eo,this.markUsedOrientation(C,kr,lt))}return kr},Xi=(fi,kr)=>{if(C.allowVerticalPlacement&&Wt>0&&Ht.verticalTextBox){for(let Eo of C.writingModes)if(Eo===r.bq.vertical?(Ai=kr(),Bi=Ai):Ai=fi(),Ai&&Ai.box&&Ai.box.length)break}else Ai=fi()};if(D.get("text-variable-anchor")){let fi=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lt]){let nr=this.prevPlacement.variableOffsets[Lt];fi.indexOf(nr.anchor)>0&&(fi=fi.filter(Zo=>Zo!==nr.anchor),fi.unshift(nr.anchor))}let kr=(nr,Zo,da)=>{let Is=C.getSymbolInstanceTextSize(ie,lt,this.transform.zoom,Nt),Cc=(nr.x2-nr.x1)*Is+2*nr.padding,Vl=(nr.y2-nr.y1)*Is+2*nr.padding,ts=lt.hasIconTextFit&&!be?Zo:null;ts&&Ks(ts);let fa={box:[],offscreen:!1,occluded:!1},Mc=xe?2*fi.length:fi.length;for(let fl=0;fl<Mc;++fl){let uh=this.attemptAnchorPlacement(fi[fl%fi.length],nr,Cc,Vl,Is,ve,Ie,q,N,ue,fl>=fi.length,lt,Nt,C,da,ts,ie,re);if(uh&&(fa=uh.placedGlyphBoxes,fa&&fa.box&&fa.box.length)){un=!0,tr=uh.shift;break}}return fa};Xi(()=>kr(es,Ht.iconBox,r.bq.horizontal),()=>{let nr=Ht.verticalTextBox;return nr&&Ks(nr),C.allowVerticalPlacement&&!(Ai&&Ai.box&&Ai.box.length)&&Wt>0&&nr?kr(nr,Ht.verticalIconBox,r.bq.vertical):{box:null,offscreen:null,occluded:null}}),Ai&&(un=Ai.box,si=Ai.offscreen,Gn=Ai.occluded);let Eo=ar(!(!Ai||!Ai.box));if(!un&&this.prevPlacement){let nr=this.prevPlacement.variableOffsets[Lt];nr&&(this.variableOffsets[Lt]=nr,this.markUsedJustification(C,nr.anchor,lt,Eo))}}else{let fi=(kr,Eo)=>{let nr=C.getSymbolInstanceTextSize(ie,lt,this.transform.zoom,Nt,v),Zo=this.collisionIndex.placeCollisionBox(C,nr,kr,new r.P(0,0),xe,q,N,ue.predicate);return Zo&&Zo.box&&Zo.box.length&&(this.markUsedOrientation(C,Eo,lt),this.placedOrientations[Lt]=Eo),Zo};Xi(()=>fi(es,r.bq.horizontal),()=>{let kr=Ht.verticalTextBox;return C.allowVerticalPlacement&&Wt>0&&kr?(Ks(kr),fi(kr,r.bq.vertical)):{box:null,offscreen:null,occluded:null}}),ar(!!(Ai&&Ai.box&&Ai.box.length))}}if(qn=Ai,un=qn&&qn.box&&qn.box.length>0,si=qn&&qn.offscreen,Gn=qn&&qn.occluded,lt.useRuntimeCollisionCircles){let ar=C.text.placedSymbolArray.get(lt.centerJustifiedTextSymbolIndex>=0?lt.centerJustifiedTextSymbolIndex:lt.verticalPlacedTextSymbolIndex),Xi=r.br(C.textSizeData,ie,ar),fi=D.get("text-padding");ci=this.collisionIndex.placeCollisionCircles(C,xe,ar,C.lineVertexArray,C.glyphOffsetArray,Xi,N,B,H,p,Ie,ue.predicate,lt.collisionCircleDiameter*Xi/r.bw,fi,this.retainedQueryData[C.bucketInstanceId].tileID),un=xe||ci.circles.length>0&&!ci.collisionDetected,si=si&&ci.offscreen,Gn=ci.occluded}if(Ht.iconFeatureIndex&&(ko=Ht.iconFeatureIndex),Ht.iconBox){let ar=Xi=>{Ks(Xi);let fi=lt.hasIconTextFit&&tr?eu(tr.x,tr.y,ve,Ie,this.transform.angle):new r.P(0,0),kr=C.getSymbolInstanceIconSize(re,this.transform.zoom,lt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,kr,Xi,fi,be,q,N,ue.predicate)};Bi&&Bi.box&&Bi.box.length&&Ht.verticalIconBox?(bn=ar(Ht.verticalIconBox),In=bn.box.length>0):(bn=ar(Ht.iconBox),In=bn.box.length>0),si=si&&bn.offscreen,fr=bn.occluded}let To=pe||lt.numHorizontalGlyphVertices===0&&Wt===0,eo=we||lt.numIconVertices===0;if(To||eo?eo?To||(In=In&&un):un=In&&un:In=un=In&&un,un&&qn&&qn.box&&this.collisionIndex.insertCollisionBox(qn.box,D.get("text-ignore-placement"),C.bucketInstanceId,Bi&&Bi.box&&Ir?Ir:Ei,ue.ID),In&&bn&&this.collisionIndex.insertCollisionBox(bn.box,D.get("icon-ignore-placement"),C.bucketInstanceId,ko,ue.ID),ci&&(un&&this.collisionIndex.insertCollisionCircles(ci.circles,D.get("text-ignore-placement"),C.bucketInstanceId,Ei,ue.ID),p)){let ar=C.bucketInstanceId,Xi=this.collisionCircleArrays[ar];Xi===void 0&&(Xi=this.collisionCircleArrays[ar]=new Rl);for(let fi=0;fi<ci.circles.length;fi+=4)Xi.circles.push(ci.circles[fi+0]),Xi.circles.push(ci.circles[fi+1]),Xi.circles.push(ci.circles[fi+2]),Xi.circles.push(ci.collisionDetected?1:0)}let Br=C.projection.name!=="globe";dt=dt&&(Br||!Gn),et=et&&(Br||!fr),this.placements[Lt]=new Qc(un||dt,In||et,si||C.justReloaded),l.add(Lt)};if(Re&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,this.retainedQueryData[C.bucketInstanceId].tileID),C.updateZOffset()),C.sortFeaturesByY){let lt=C.getSortedSymbolIndexes(this.transform.angle);for(let Nt=lt.length-1;Nt>=0;--Nt){let Ht=lt[Nt];pt(C.symbolInstances.get(Ht),Ht,C.collisionArrays[Ht])}C.hasAnyZOffset&&r.w(`${C.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(C.hasAnyZOffset){let lt=C.getSortedIndexesByZOffset();for(let Nt=0;Nt<lt.length;++Nt){let Ht=lt[Nt];pt(C.symbolInstances.get(Ht),Ht,C.collisionArrays[Ht])}}else for(let lt=o.symbolInstanceStart;lt<o.symbolInstanceEnd;lt++)pt(C.symbolInstances.get(lt),lt,C.collisionArrays[lt]);if(p&&C.bucketInstanceId in this.collisionCircleArrays){let lt=this.collisionCircleArrays[C.bucketInstanceId];r.ab.mat4.invert(lt.invProjMatrix,N),lt.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(o,l,p,y){let{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:k,crossTileID:N}=p,B=r.bB(l),H=y===r.bq.vertical?k:B==="left"?v:B==="center"?C:B==="right"?D:-1;v>=0&&(o.text.placedSymbolArray.get(v).crossTileID=H>=0&&v!==H?0:N),C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=H>=0&&C!==H?0:N),D>=0&&(o.text.placedSymbolArray.get(D).crossTileID=H>=0&&D!==H?0:N),k>=0&&(o.text.placedSymbolArray.get(k).crossTileID=H>=0&&k!==H?0:N)}markUsedOrientation(o,l,p){let y=l===r.bq.horizontal||l===r.bq.horizontalOnly?l:0,v=l===r.bq.vertical?l:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:N}=p,B=o.text.placedSymbolArray;C>=0&&(B.get(C).placedOrientation=y),D>=0&&(B.get(D).placedOrientation=y),k>=0&&(B.get(k).placedOrientation=y),N>=0&&(B.get(N).placedOrientation=v)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;let l=this.prevPlacement,p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;let y=l?l.symbolFadeChange(o):1,v=l?l.opacities:{},C=l?l.variableOffsets:{},D=l?l.placedOrientations:{};for(let k in this.placements){let N=this.placements[k],B=v[k];B?(this.opacities[k]=new Ro(B,y,N.text,N.icon,null,N.clipped),p=p||N.text!==B.text.placed||N.icon!==B.icon.placed):(this.opacities[k]=new Ro(null,y,N.text,N.icon,N.skipFade,N.clipped),p=p||N.text||N.icon)}for(let k in v){let N=v[k];if(!this.opacities[k]){let B=new Ro(N,y,!1,!1);B.isHidden()||(this.opacities[k]=B,p=p||N.text.placed||N.icon.placed)}}for(let k in C)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=C[k]);for(let k in D)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=D[k]);p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:o)}updateLayerOpacities(o,l,p,y){let v=new Set;for(let C of l){let D=C.getBucket(o);D&&C.latestFeatureIndex&&o.fqid===D.layerIds[0]&&(this.updateBucketOpacities(D,v,C,C.collisionBoxArray,p,y,C.tileID,o.scope),D.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(D,C.tileID),D.updateZOffset()))}}updateBucketOpacities(o,l,p,y,v,C,D,k){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();let N=o.layers[0].layout,B=o.layers[0].paint,H=!!o.layers[0].dynamicFilter(),U=new Ro(null,0,!1,!1,!0),q=N.get("text-allow-overlap"),ee=N.get("icon-allow-overlap"),Q=N.get("text-variable-anchor"),ie=N.get("text-rotation-alignment")==="map",re=N.get("text-pitch-alignment")==="map",ue=B.get("symbol-z-offset"),ge=N.get("symbol-elevation-reference")==="sea",pe=!ue.isConstant(),we=new Ro(null,0,q&&(ee||!o.hasIconData()||N.get("icon-optional")),ee&&(q||!o.hasTextData()||N.get("text-optional")),!0);!o.collisionArrays&&y&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(y);let xe=(ve,Ie,Re)=>{for(let Ye=0;Ye<Ie/4;Ye++)ve.opacityVertexArray.emplaceBack(Re)},be=0;C&&o.updateReplacement(D,C);for(let ve=0;ve<o.symbolInstances.length;ve++){let Ie=o.symbolInstances.get(ve),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:Ye,crossTileID:$e,numIconVertices:Ae,tileAnchorX:ze,tileAnchorY:at}=Ie,gt=null,St=this.retainedQueryData[o.bucketInstanceId];pe&&Ie&&St&&(gt=p.latestFeatureIndex.loadFeature({featureIndex:Ie.featureIndex,bucketIndex:St.bucketIndex,sourceLayerIndex:St.sourceLayerIndex,layoutVertexArrayOffset:0}));let Ve=ue.evaluate(gt,{}),dt=l.has($e),et=this.opacities[$e];dt?et=U:et||(et=we,this.opacities[$e]=et),l.add($e);let Ct=Re>0||Ye>0,pt=Ae>0,lt=this.placedOrientations[$e],Nt=lt===r.bq.vertical,Ht=lt===r.bq.horizontal||lt===r.bq.horizontalOnly;!Ct&&!pt||et.isHidden()||be++;let Lt=!1;if((Ct||pt)&&C)for(let Wt of o.activeReplacements){if(r.bx(Wt,v,r.by.Symbol,k)||Wt.min.x>ze||ze>Wt.max.x||Wt.min.y>at||at>Wt.max.y)continue;let Tn=r.bz(ze,at,D.canonical,Wt.footprintTileId.canonical);if(Lt=r.bA(Tn,Wt.footprint),Lt)break}if(Ct){let Wt=Lt?Fo:Zu(et.text);xe(o.text,Re,Nt?Fo:Wt),xe(o.text,Ye,Ht?Fo:Wt);let Tn=et.text.isHidden(),{leftJustifiedTextSymbolIndex:hn,centerJustifiedTextSymbolIndex:un,rightJustifiedTextSymbolIndex:In,verticalPlacedTextSymbolIndex:si}=Ie,Gn=o.text.placedSymbolArray,fr=Tn||Nt?1:0;hn>=0&&(Gn.get(hn).hidden=fr),un>=0&&(Gn.get(un).hidden=fr),In>=0&&(Gn.get(In).hidden=fr),si>=0&&(Gn.get(si).hidden=Tn||Ht?1:0);let tr=this.variableOffsets[$e];tr&&this.markUsedJustification(o,tr.anchor,Ie,lt);let Ai=this.placedOrientations[$e];Ai&&(this.markUsedJustification(o,"left",Ie,Ai),this.markUsedOrientation(o,Ai,Ie))}if(pt){let Wt=Lt?Fo:Zu(et.icon),{placedIconSymbolIndex:Tn,verticalPlacedIconSymbolIndex:hn}=Ie,un=o.icon.placedSymbolArray,In=et.icon.isHidden()?1:0;Tn>=0&&(xe(o.icon,Ae,Nt?Fo:Wt),un.get(Tn).hidden=In),hn>=0&&(xe(o.icon,Ie.numVerticalIconVertices,Ht?Fo:Wt),un.get(hn).hidden=In)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){let Wt=o.collisionArrays[ve];if(Wt){let Tn=new r.P(0,0),hn=!0;if(Wt.textBox||Wt.verticalTextBox){if(Q){let In=this.variableOffsets[$e];In?(Tn=pf(In.anchor,In.width,In.height,In.textOffset,In.textScale),ie&&Tn._rotate(re?this.transform.angle:-this.transform.angle)):hn=!1}H&&(hn=!et.clipped),Wt.textBox&&$u(o.textCollisionBox.collisionVertexArray,et.text.placed,!hn||Nt,Ve,ge,Tn.x,Tn.y),Wt.verticalTextBox&&$u(o.textCollisionBox.collisionVertexArray,et.text.placed,!hn||Ht,Ve,ge,Tn.x,Tn.y)}let un=hn&&!!(!Ht&&Wt.verticalIconBox);Wt.iconBox&&$u(o.iconCollisionBox.collisionVertexArray,et.icon.placed,un,Ve,ge,Ie.hasIconTextFit?Tn.x:0,Ie.hasIconTextFit?Tn.y:0),Wt.verticalIconBox&&$u(o.iconCollisionBox.collisionVertexArray,et.icon.placed,!un,Ve,ge,Ie.hasIconTextFit?Tn.x:0,Ie.hasIconTextFit?Tn.y:0)}}}if(o.fullyClipped=be===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){let ve=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ve.invProjMatrix,o.placementViewportMatrix=ve.viewportMatrix,o.collisionCircleArray=ve.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,l){let p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function $u(f,o,l,p,y,v,C){f.emplaceBack(o?1:0,l?1:0,v||0,C||0,p,y?1:0),f.emplaceBack(o?1:0,l?1:0,v||0,C||0,p,y?1:0),f.emplaceBack(o?1:0,l?1:0,v||0,C||0,p,y?1:0),f.emplaceBack(o?1:0,l?1:0,v||0,C||0,p,y?1:0)}let Gu=Math.pow(2,25),$p=Math.pow(2,24),qu=Math.pow(2,17),mf=Math.pow(2,16),c_=Math.pow(2,9),tu=Math.pow(2,8),nu=Math.pow(2,1);function Zu(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let o=f.placed?1:0,l=Math.floor(127*f.opacity);return l*Gu+o*$p+l*qu+o*mf+l*c_+o*tu+l*nu+o}let Fo=0;class Gp{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,l,p,y,v,C){let D=this._bucketParts;for(;this._currentTileIndex<o.length;)if(l.getBucketParts(D,y,o[this._currentTileIndex],this._sortAcrossTiles,C),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((k,N)=>k.sortKey-N.sortKey));this._currentPartIndex<D.length;){let k=D[this._currentPartIndex];if(l.placeLayerBucketPart(k,this._seenCrossTileIDs,p,k.symbolInstanceStart===0,C),this._currentPartIndex++,v())return!0}return!1}}class Ll{constructor(o,l,p,y,v,C,D,k,N){this.placement=new us(o,v,C,D,k,N),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(o,l,p,y,v){let C=r.q.now(),D=()=>{let k=r.q.now()-C;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){let k=l[o[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=N)&&(!k.maxzoom||k.maxzoom>N)){let B=k,H=B.layout.get("symbol-z-elevate"),U=B.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=B.layout.get("symbol-z-order"),ee=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&U),Q=B.layout.get("text-allow-overlap")||B.layout.get("icon-allow-overlap")||B.layout.get("text-ignore-placement")||B.layout.get("icon-ignore-placement"),ie=ee&&Q,re=this._inProgressLayer=this._inProgressLayer||new Gp(B),ue=r.aC(k.source,k.scope);if(re.continuePlacement(H||ie?y[ue]:p[ue],this.placement,this._showCollisionBoxes,k,D,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}let ao=512/r.ag/2;class qp{constructor(o,l,p){this.tileID=o,this.bucketInstanceId=p,this.index=new r.bE(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let y=o.canonical.x*r.ag,v=o.canonical.y*r.ag;for(let C=0;C<l.length;C++){let{key:D,crossTileID:k,tileAnchorX:N,tileAnchorY:B}=l.get(C),H=Math.floor((y+N)*ao),U=Math.floor((v+B)*ao);this.index.add(H,U),this.keys.push(D),this.crossTileIDs.push(k)}this.index.finish()}findMatches(o,l,p){let y=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),v=ao/Math.pow(2,l.canonical.z-this.tileID.canonical.z),C=l.canonical.x*r.ag,D=l.canonical.y*r.ag;for(let k=0;k<o.length;k++){let N=o.get(k);if(N.crossTileID)continue;let{key:B,tileAnchorX:H,tileAnchorY:U}=N,q=Math.floor((C+H)*v),ee=Math.floor((D+U)*v),Q=this.index.range(q-y,ee-y,q+y,ee+y);for(let ie of Q){let re=this.crossTileIDs[ie];if(this.keys[ie]===B&&!p.has(re)){p.add(re),N.crossTileID=re;break}}}}}class Zp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class u_{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){let l=Math.round((o-this.lng)/360);if(l!==0)for(let p in this.indexes){let y=this.indexes[p],v={};for(let C in y){let D=y[C];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+l),v[D.tileID.key]=D}this.indexes[p]=v}this.lng=o}addBucket(o,l,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);let y=this.usedCrossTileIDs[o.overscaledZ];for(let v in this.indexes){let C=this.indexes[v];if(Number(v)>o.overscaledZ)for(let D in C){let k=C[D];k.tileID.isChildOf(o)&&k.findMatches(l.symbolInstances,o,y)}else{let D=C[o.scaledTo(Number(v)).key];D&&D.findMatches(l.symbolInstances,o,y)}}for(let v=0;v<l.symbolInstances.length;v++){let C=l.symbolInstances.get(v);C.crossTileID||(C.crossTileID=p.generate(),y.add(C.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new qp(o,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(o,l){for(let p of l.crossTileIDs)this.usedCrossTileIDs[o].delete(p)}removeStaleBuckets(o){let l=!1;for(let p in this.indexes){let y=this.indexes[p];for(let v in y)o[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[v]),delete y[v],l=!0)}return l}}class Hh{constructor(){this.layerIndexes={},this.crossTileIDs=new Zp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,l,p,y){let v=this.layerIndexes[o.fqid];v===void 0&&(v=this.layerIndexes[o.fqid]=new u_);let C=!1,D={};y.name!=="globe"&&v.handleWrapJump(p);for(let k of l){let N=k.getBucket(o);N&&o.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(k.tileID,N,this.crossTileIDs)&&(C=!0),D[N.bucketInstanceId]=!0)}return v.removeStaleBuckets(D)&&(C=!0),C}pruneUnusedLayers(o){let l={};o.forEach(p=>{l[p]=!0});for(let p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}let Fl=771;class $n{constructor(o,l,p,y){this.blendFunction=o,this.blendColor=l,this.mask=p,this.blendEquation=y}}$n.Replace=[1,0,1,0],$n.disabled=new $n($n.Replace,r.aj.transparent,[!1,!1,!1,!1]),$n.unblended=new $n($n.Replace,r.aj.transparent,[!0,!0,!0,!0]),$n.alphaBlended=new $n([1,Fl,1,Fl],r.aj.transparent,[!0,!0,!0,!0]),$n.alphaBlendedNonPremultiplied=new $n([770,Fl,770,Fl],r.aj.transparent,[!0,!0,!0,!0]),$n.multiply=new $n([774,0,774,0],r.aj.transparent,[!0,!0,!0,!0]);class an{constructor(o,l,p){this.func=o,this.mask=l,this.range=p}}an.ReadOnly=!1,an.ReadWrite=!0,an.disabled=new an(519,an.ReadOnly,[0,1]);let Wu=7680;class Sn{constructor(o,l,p,y,v,C){this.test=o,this.ref=l,this.mask=p,this.fail=y,this.depthFail=v,this.pass=C}}Sn.disabled=new Sn({func:519,mask:0},0,0,Wu,Wu,Wu);let hs=1029,ds=2305;class yn{constructor(o,l,p){this.enable=o,this.mode=l,this.frontFace=p}}function aa(f,o){let l=r.bG(f,3);r.ab.mat4.fromQuat(f,o),r.bI(f,3,l)}function $h(f,o){let l=r.ab.quat.identity([]);return r.ab.quat.rotateZ(l,l,-o),r.ab.quat.rotateX(l,l,-f),l}function la(f,o){let l=[f[0],f[1],0],p=[o[0],o[1],0];if(r.ab.vec3.length(l)>=1e-15){let C=r.ab.vec3.normalize([],l);r.ab.vec3.scale(p,C,r.ab.vec3.dot(p,C)),o[0]=p[0],o[1]=p[1]}let y=r.ab.vec3.cross([],o,f);if(r.ab.vec3.len(y)<1e-15)return null;let v=Math.atan2(-y[1],y[0]);return $h(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),v)}yn.disabled=new yn(!1,hs,ds),yn.backCCW=new yn(!0,hs,ds),yn.backCW=new yn(!0,hs,2304),yn.frontCW=new yn(!0,1028,2304),yn.frontCCW=new yn(!0,1028,ds);class iu{constructor(o,l){this.position=o,this.orientation=l}get position(){return this._position}set position(o){if(o){let l=o instanceof r.aa?o:new r.aa(o[0],o[1],o[2]);this._renderWorldCopies&&(l.x=r.bF(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(o,l){if(this.orientation=null,!this.position)return;let p=this.position,y=this._elevation?this._elevation.getAtPointOrZero(r.aa.fromLngLat(o)):0,v=r.aa.fromLngLat(o,y),C=[v.x-p.x,v.y-p.y,v.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=la(C,l)}setPitchBearing(o,l){this.orientation=$h(r.ai(o),r.ai(-l))}}class tl{constructor(o,l){this._transform=r.ab.mat4.identity([]),this.orientation=l,this.position=o}get mercatorPosition(){let o=this.position;return new r.aa(o[0],o[1],o[2])}get position(){let o=r.bG(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var l;o&&r.bI(this._transform,3,[(l=o)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||r.ab.quat.identity([]),o&&aa(this._transform,this._orientation)}getPitchBearing(){let o=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,l){this._orientation=$h(o,l),aa(this._transform,this._orientation)}forward(){let o=r.bG(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){let o=r.bG(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){let o=r.bG(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,l){let p=new Float64Array(16);return r.ab.mat4.invert(p,this.getWorldToCamera(o,l)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,l,p){let y=this.position;r.ab.vec3.scale(y,y,-o);let v=new Float64Array(16);return r.ab.mat4.fromScaling(v,[p,p,p]),r.ab.mat4.translate(v,v,y),v[10]*=l,v}getWorldToCamera(o,l){let p=new Float64Array(16),y=new Float64Array(4),v=this.position;return r.ab.quat.conjugate(y,this._orientation),r.ab.vec3.scale(v,v,-o),r.ab.mat4.fromQuat(p,y),r.ab.mat4.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(o,l,p,y){let v=new Float64Array(16);return r.ab.mat4.perspective(v,o,l,p,y),v}getCameraToClipOrthographic(o,l,p,y,v,C){let D=new Float64Array(16);return r.ab.mat4.ortho(D,o,l,p,y,v,C),D}getDistanceToElevation(o,l=!1){let p=o===0?0:r.bH(o,l?r.aS(this.position[1]):this.position[1]),y=this.forward();return(p-this.position[2])/y[2]}clone(){return new tl([...this.position],[...this.orientation])}}let Co={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class No{constructor(o=0,l=0,p=0,y=0){if(isNaN(o)||o<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=l,this.left=p,this.right=y}interpolate(o,l,p){return l.top!=null&&o.top!=null&&(this.top=r.af(o.top,l.top,p)),l.bottom!=null&&o.bottom!=null&&(this.bottom=r.af(o.bottom,l.bottom,p)),l.left!=null&&o.left!=null&&(this.left=r.af(o.left,l.left,p)),l.right!=null&&o.right!=null&&(this.right=r.af(o.right,l.right,p)),this}getCenter(o,l){let p=r.aw((this.left+o-this.right)/2,0,o),y=r.aw((this.top+l-this.bottom)/2,0,l);return new r.P(p,y)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new No(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Gh=(f,o,l)=>(1-l)*f+l*o,Ot=f=>f*f*f*f*f;class dc{constructor(o,l,p,y,v,C,D){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=o||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=y??60,this.setProjection(C),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new r.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new No,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new tl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let o=new dc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,l=!1){let p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(o||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return r.ay(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};let l=this.projection?this.getProjection():void 0;this.projection=r.bP(this.projectionOptions);let p=this.getProjection(),y=!r.bn(l,p);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){let o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bP({name:"mercator"});let l=o!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bF(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){let l=-o*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=r.ab.mat2.create(),r.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){let l=r.aw(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=r.ai(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){let l=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){let o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let p=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let o=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop(),y=0,v=0;for(let C=0;C<l.length;C++){let D=new r.P(l[C][0]*this.width,p+l[C][1]*(this.height-p)),k=o.pointCoordinate(D);if(!k)continue;let N=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);y+=k[3]*N,v+=N}return v===0?NaN:y/v}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let o=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,y=this._mercatorZfromZoom(o),v=this._mercatorZfromZoom(this._maxZoom),C=Math.max(y-p,v);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){let l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude())),p;p=o.z<this._camera.position[2]?[l.x,l.y,l.z]:[o.x,o.y,o.z];let y=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,p));return r.aw(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let l=!1;if(o.orientation&&!r.ab.quat.exactEquals(o.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(o.orientation)),o.position){let p=[o.position.x,o.position.y,o.position.z];r.ab.vec3.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let o=this._camera.position,l=new iu;return l.position=new r.aa(o[0],o[1],o[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(o){if(!r.ab.quat.length(o))return!1;r.ab.quat.normalize(o,o);let l=r.ab.vec3.transformQuat([],[0,0,-1],o),p=r.ab.vec3.transformQuat([],[0,-1,0],o);if(p[2]<0)return!1;let y=la(l,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(o){let l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;o[2]=r.aw(o[2],y/p,y/l),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,l,p){this._unmodified=!1,this._edgeInsets.interpolate(o,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){let l=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(o){let l=[new r.bQ(0,o)];if(this.renderWorldCopies){let p=this.pointCoordinate(new r.P(0,0)),y=this.pointCoordinate(new r.P(this.width,0)),v=this.pointCoordinate(new r.P(this.width,this.height)),C=this.pointCoordinate(new r.P(0,this.height)),D=Math.floor(Math.min(p.x,y.x,v.x,C.x)),k=Math.floor(Math.max(p.x,y.x,v.x,C.x)),N=1;for(let B=D-N;B<=k+N;B++)B!==0&&l.push(new r.bQ(B,o))}return l}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,l,p){let y=[],v=p!==void 0,C=!v;if(C&&this.zoom<l||v&&p[0]===0&&p[1]===0)return y;let D=new Set,k=(B,H,U,q,ee)=>{let Q=r.c5(H,B,U,q,ee);D.has(Q)||(y.push(new r.aG(B,H,U,q,ee)),D.add(Q))};for(let B=0;B<o.length;B++){let H=o[B];if(C&&H.canonical.z!==l)continue;let U=H.canonical,q=H.overscaledZ,ee=H.wrap,Q=1<<U.z,ie=U.x+1<Q,re=U.x>0,ue=U.y+1<Q,ge=U.y>0,pe=H.wrap-(re?0:1),we=H.wrap+(ie?0:1),xe=re?U.x-1:Q-1,be=ie?U.x+1:0;if(v)p[0]<0?(k(q,we,U.z,be,U.y),p[1]<0&&ue&&(k(q,ee,U.z,U.x,U.y+1),k(q,we,U.z,be,U.y+1)),p[1]>0&&ge&&(k(q,ee,U.z,U.x,U.y-1),k(q,we,U.z,be,U.y-1))):p[0]>0?(k(q,pe,U.z,xe,U.y),p[1]<0&&ue&&(k(q,ee,U.z,U.x,U.y+1),k(q,pe,U.z,xe,U.y+1)),p[1]>0&&ge&&(k(q,ee,U.z,U.x,U.y-1),k(q,pe,U.z,xe,U.y-1))):p[1]<0&&ue?k(q,ee,U.z,U.x,U.y+1):ge&&k(q,ee,U.z,U.x,U.y-1);else{let ve=H.visibleQuadrants;1&ve&&(k(q,pe,U.z,xe,U.y),ge&&(k(q,ee,U.z,U.x,U.y-1),k(q,pe,U.z,xe,U.y-1))),2&ve&&(k(q,we,U.z,be,U.y),ge&&(k(q,ee,U.z,U.x,U.y-1),k(q,we,U.z,be,U.y-1))),4&ve&&(k(q,pe,U.z,xe,U.y),ue&&(k(q,ee,U.z,U.x,U.y+1),k(q,pe,U.z,xe,U.y+1))),8&ve&&(k(q,we,U.z,be,U.y),ue&&(k(q,ee,U.z,U.x,U.y+1),k(q,we,U.z,be,U.y+1)))}}let N=[];for(let B of y)y.some(H=>B.isChildOf(H))||N.push(B);if(y=N.filter(B=>!o.some(H=>!!(B.overscaledZ<l&&H.isChildOf(B))||B.equals(H)||B.isChildOf(H))),C){let B=1<<l,H=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[B*H.x,B*H.y],q=4,ee=q*q;y=y.filter(Q=>{let ie=Q.canonical.x+.5-U[0],re=Q.canonical.y+.5-U[1];return ie*ie+re*re<ee})}return y}coveringTiles(o){let l=this.coveringZoomLevel(o),p=l,y=this.elevation&&this.elevation.exaggeration(),v=y&&!o.isTerrainDEM,C=this.projection.name==="mercator";if(o.minzoom!==void 0&&l<o.minzoom)return[];o.maxzoom!==void 0&&l>o.maxzoom&&(l=o.maxzoom);let D=this.locationCoordinate(this.center),k=this.center.lat,N=1<<l,B=[N*D.x,N*D.y,0],H=this.projection.name==="globe",U=!H,q=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,U),ee=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=N*r.bH(1,this.center.lat),ie=this._camera.position[2]/r.bH(1,this.center.lat),re=[N*ee.x,N*ee.y,ie*(U?1:Q)],ue=H||y,ge=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),pe=this.isLODDisabled(!0)?l:0,we;if(this._elevation&&o.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){let Ve=this._elevation.getMinMaxForVisibleTiles();we=Ve?Ve.max:this._centerAltitude}else we=this._centerAltitude;let xe=o.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,be=this.projection.isReprojectedInTileSpace?r.bS(this):1,ve=Ve=>{let et=new r.aa(Ve.x+25e-6,Ve.y,Ve.z),Ct=new r.aa(Ve.x,Ve.y+25e-6,Ve.z),pt=Ve.toLngLat(),lt=et.toLngLat(),Nt=Ct.toLngLat(),Ht=this.locationCoordinate(pt),Lt=this.locationCoordinate(lt),Wt=this.locationCoordinate(Nt),Tn=Math.hypot(Lt.x-Ht.x,Lt.y-Ht.y),hn=Math.hypot(Wt.x-Ht.x,Wt.y-Ht.y);return Math.sqrt(Tn*hn)*be/25e-6},Ie=Ve=>{let dt=we,et=xe;return{aabb:r.bV(this,N,0,0,0,Ve,et,dt,this.projection),zoom:0,x:0,y:0,minZ:et,maxZ:dt,wrap:Ve,fullyVisible:!1}},Re=[],Ye=[],$e=l,Ae=o.reparseOverscaled?p:l,ze=(ie-this._centerAltitude)*Q,at=Ve=>{if(!this._elevation||!Ve.tileID||!C)return;let dt=this._elevation.getMinMaxForTile(Ve.tileID),et=Ve.aabb;dt?(et.min[2]=dt.min,et.max[2]=dt.max,et.center[2]=(et.min[2]+et.max[2])/2):(Ve.shouldSplit=St(Ve),Ve.shouldSplit||(et.min[2]=et.max[2]=et.center[2]=this._centerAltitude))},gt=(Ve,dt)=>{if(.707*dt<Ve)return 1;let et=dt/Ve;return et/(1.4144271570014144+(Math.pow(1.1,et-1.4144271570014144+1)-1)/(1.1-1)-1)},St=Ve=>{if(Ve.zoom<pe)return!0;if(Ve.zoom===$e)return!1;if(Ve.shouldSplit!=null)return Ve.shouldSplit;let dt=Ve.aabb.distanceX(re),et=Ve.aabb.distanceY(re),Ct=ze,pt=1;if(H){Ct=Ve.aabb.distanceZ(re);let hn=Math.pow(2,Ve.zoom),un=r.aS((Ve.y+1)/hn),In=r.aS(Ve.y/hn),si=Math.min(Math.max(k,un),In),Gn=r.c9(si)/r.c9(k);if(pt=si===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Gn/this._mercatorScaleRatio),this.zoom<=r.c6&&Ve.zoom===$e-1&&Gn>=.9)return!0}else if(v&&(Ct=Ve.aabb.distanceZ(re)*Q),this.projection.isReprojectedInTileSpace&&p<=5){let hn=Math.pow(2,Ve.zoom),un=ve(new r.aa((Ve.x+.5)/hn,(Ve.y+.5)/hn));pt=un>.85?1:un}if(!C){let hn=Math.sqrt(dt*dt+et*et+Ct*Ct),un=(1<<$e-Ve.zoom)*ge*pt;return un*=gt(Math.max(Ct,ze),hn),hn<un}let lt=Number.MAX_VALUE,Nt=0,Ht=Ve.aabb.getCorners(),Lt=[];for(let hn of Ht){r.ab.vec3.sub(Lt,hn,re),H||(v?Lt[2]*=Q:Lt[2]=ze);let un=r.ab.vec3.dot(Lt,this._camera.forward());un<lt&&(lt=un,Nt=Math.abs(Lt[2]))}let Wt=(1<<$e-Ve.zoom)*ge*pt;if(Wt*=gt(Math.max(Nt,ze),lt),lt<Wt)return!0;let Tn=Ve.aabb.closestPoint(B);return Tn[0]===B[0]&&Tn[1]===B[1]};if(this.renderWorldCopies)for(let Ve=1;Ve<=3;Ve++)Re.push(Ie(-Ve)),Re.push(Ie(Ve));for(Re.push(Ie(0));Re.length>0;){let Ve=Re.pop(),dt=Ve.x,et=Ve.y,Ct=Ve.fullyVisible,pt=()=>this.projection.name==="globe"&&(Ve.y===0||Ve.y===(1<<Ve.zoom)-1);if(!Ct){let lt=ue?Ve.aabb.intersects(q):Ve.aabb.intersectsFlat(q);if(lt===0&&pt()){let Nt=new r.bT(Ve.zoom,dt,et);lt=r.bU(this,N,Nt,!0).intersects(q)}if(lt===0)continue;Ct=lt===2}if(Ve.zoom!==$e&&St(Ve))for(let lt=0;lt<4;lt++){let Nt=(dt<<1)+lt%2,Ht=(et<<1)+(lt>>1),Lt={aabb:C?Ve.aabb.quadrant(lt):r.bV(this,N,Ve.zoom+1,Nt,Ht,Ve.wrap,Ve.minZ,Ve.maxZ,this.projection),zoom:Ve.zoom+1,x:Nt,y:Ht,wrap:Ve.wrap,fullyVisible:Ct,tileID:void 0,shouldSplit:void 0,minZ:Ve.minZ,maxZ:Ve.maxZ};v&&!H&&(Lt.tileID=new r.aG(Ve.zoom+1===$e?Ae:Ve.zoom+1,Ve.wrap,Ve.zoom+1,Nt,Ht),at(Lt)),Re.push(Lt)}else{let lt=Ve.zoom===$e?Ae:Ve.zoom;if(o.minzoom&&o.minzoom>lt)continue;let Nt=0;if(!Ct){let Tn=ue?Ve.aabb.intersectsPrecise(q):Ve.aabb.intersectsPreciseFlat(q);if(Tn===0&&pt()){let hn=new r.bT(Ve.zoom,dt,et);Tn=r.bU(this,N,hn,!0).intersectsPrecise(q)}if(Tn===0)continue;if(o.calculateQuadrantVisibility)if(q.containsPoint(Ve.aabb.center))Nt=15;else for(let hn=0;hn<4;hn++)Ve.aabb.quadrant(hn).intersects(q)!==0&&(Nt|=1<<hn)}let Ht=B[0]-(.5+dt+(Ve.wrap<<Ve.zoom))*(1<<l-Ve.zoom),Lt=B[1]-.5-et,Wt=Ve.tileID?Ve.tileID:new r.aG(lt,Ve.wrap,Ve.zoom,dt,et);o.calculateQuadrantVisibility&&(Wt.visibleQuadrants=Nt),Ye.push({tileID:Wt,distanceSq:Ht*Ht+Lt*Lt})}}if(this.fogCullDistSq){let Ve=this.fogCullDistSq,dt=this.horizonLineFromTop();Ye=Ye.filter(et=>{let Ct=[0,0,0,1],pt=[r.ag,r.ag,0,1],lt=this.calculateFogTileMatrix(et.tileID.toUnwrapped());r.ab.vec4.transformMat4(Ct,Ct,lt),r.ab.vec4.transformMat4(pt,pt,lt);let Nt=r.ab.vec4.min([],Ct,pt),Ht=r.ab.vec4.max([],Ct,pt),Lt=r.bW(Nt,Ht);if(Lt===0)return!0;let Wt=!1,Tn=this._elevation;if(Tn&&Lt>Ve&&dt!==0){let hn=this.calculateProjMatrix(et.tileID.toUnwrapped()),un;o.isTerrainDEM||(un=Tn.getMinMaxForTile(et.tileID)),un||(un={min:xe,max:we});let In=r.c7(this.rotation),si=[In[0]*r.ag,In[1]*r.ag,un.max];r.ab.vec3.transformMat4(si,si,hn),Wt=(1-si[1])*this.height*.5<dt}return Lt<Ve||Wt})}return Ye.sort((Ve,dt)=>Ve.distanceSq-dt.distanceSq).map(Ve=>Ve.tileID)}resize(o,l){this.width=o,this.height=l,this.pixelsToGLUnits=[2/o,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){let l=r.aw(o.lat,-r.bX,r.bX),p=this.projection.project(o.lng,l);return new r.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,l){let p,y,v=this.centerPoint;if(this.projection.name==="globe"){let D=this.worldSize;p=(l.x-v.x)/D,y=(l.y-v.y)/D}else{let D=this.pointCoordinate(l),k=this.pointCoordinate(v);p=D.x-k.x,y=D.y-k.y}let C=this.locationCoordinate(o);this.setLocation(new r.aa(C.x-p,C.y-y))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,l){let p=l?r.bH(l,o.lat):void 0,y=this.projection.project(o.lng,o.lat);return new r.aa(y.x,y.y,p)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,l){let p=l??this._centerAltitude,y=[o.x,o.y,0,1],v=[o.x,o.y,1,1];r.ab.vec4.transformMat4(y,y,this.pixelMatrixInverse),r.ab.vec4.transformMat4(v,v,this.pixelMatrixInverse);let C=v[3];r.ab.vec4.scale(y,y,1/y[3]),r.ab.vec4.scale(v,v,1/C);let D=y[2],k=v[2];return{p0:y,p1:v,t:D===k?0:(p-D)/(k-D)}}screenPointToMercatorRay(o){let l=[o.x,o.y,0,1],p=[o.x,o.y,1,1];return r.ab.vec4.transformMat4(l,l,this.pixelMatrixInverse),r.ab.vec4.transformMat4(p,p,this.pixelMatrixInverse),r.ab.vec4.scale(l,l,1/l[3]),r.ab.vec4.scale(p,p,1/p[3]),l[2]=r.bH(l[2],this._center.lat)*this.worldSize,p[2]=r.bH(p[2],this._center.lat)*this.worldSize,r.ab.vec4.scale(l,l,1/this.worldSize),r.ab.vec4.scale(p,p,1/this.worldSize),new r.aq([l[0],l[1],l[2]],r.ab.vec3.normalize([],r.ab.vec3.sub([],p,l)))}rayIntersectionCoordinate(o){let{p0:l,p1:p,t:y}=o,v=r.bH(l[2],this._center.lat),C=r.bH(p[2],this._center.lat);return new r.aa(r.af(l[0],p[0],y)/this.worldSize,r.af(l[1],p[1],y)/this.worldSize,r.af(v,C,y))}pointCoordinate(o,l=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,l)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let l=this.projection.pointCoordinate3D(this,o.x,o.y);if(l)return new r.aa(l[0],l[1],l[2]);let p=0,y=this.horizonLineFromTop();if(o.y>y)return this.pointCoordinate(o);let v=.02*y,C=o.clone();for(let D=0;D<10&&y-p>v;D++){C.y=r.af(p,y,.66);let k=this.projection.pointCoordinate3D(this,C.x,C.y);k?(y=C.y,l=k):p=C.y}return l?new r.aa(l[0],l[1],l[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=r.bY)return!this.isPointAboveHorizon(o);let l=this.pointCoordinate(o);return l.y>=0&&l.y<=1}_coordinatePoint(o,l){let p=l&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,y=[o.x*this.worldSize,o.y*this.worldSize,p+o.toAltitude(),1];return r.ab.vec4.transformMat4(y,y,this.pixelMatrix),y[3]>0?new r.P(y[0]/y[3],y[1]/y[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:o,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,v=this.pointLocation3D(new r.P(l,o)),C=this.pointLocation3D(new r.P(y,o)),D=this.pointLocation3D(new r.P(y,p)),k=this.pointLocation3D(new r.P(l,p)),N=Math.min(v.lng,C.lng,D.lng,k.lng),B=Math.max(v.lng,C.lng,D.lng,k.lng),H=Math.min(v.lat,C.lat,D.lat,k.lat),U=Math.max(v.lat,C.lat,D.lat,k.lat),q=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,Q=(ie,re,ue,ge,pe)=>{let we=(ie+ue)/2,xe=(re+ge)/2,be=new r.P(we,xe),{lng:ve,lat:Ie}=this.pointLocation3D(be),Re=Math.max(0,N-ve,H-Ie,ve-B,Ie-U);N=Math.min(N,ve),B=Math.max(B,ve),H=Math.min(H,Ie),U=Math.max(U,Ie),(pe<ee||Re>q)&&(Q(ie,re,we,xe,pe+1),Q(we,xe,ue,ge,pe+1))};if(Q(l,o,y,o,1),Q(y,o,y,p,1),Q(y,p,l,p,1),Q(l,p,l,o,1),this.projection.name==="globe"){let[ie,re]=r.bZ(this);ie?(U=90,B=180,N=-180):re&&(H=-90,B=180,N=-180)}return new r.az(new r.bO(N,H),new r.bO(B,U))}_getBoundsRectangular(o,l){let{top:p,left:y}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,D=new r.P(y,p),k=new r.P(C,p),N=new r.P(C,v),B=new r.P(y,v),H=this.pointCoordinate(D,o),U=this.pointCoordinate(k,o),q=this.pointCoordinate(N,l),ee=this.pointCoordinate(B,l),Q=(ie,re)=>(re.y-ie.y)/(re.x-ie.x);return H.y>1&&U.y>=0?H=new r.aa((1-ee.y)/Q(ee,H)+ee.x,1):H.y<0&&U.y<=1&&(H=new r.aa(-ee.y/Q(ee,H)+ee.x,0)),U.y>1&&H.y>=0?U=new r.aa((1-q.y)/Q(q,U)+q.x,1):U.y<0&&H.y<=1&&(U=new r.aa(-q.y/Q(q,U)+q.x,0)),new r.az().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){let o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);let l=o.visibleDemTiles.reduce((p,y)=>{if(y.dem){let v=y.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*o.exaggeration(),l.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){let l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return o?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-r.bX,this.maxLat=r.bX,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.at(this.minLng)*this.tileSize,this.worldMaxX=r.at(this.maxLng)*this.tileSize,this.worldMinY=r.aA(this.maxLat)*this.tileSize,this.worldMaxY=r.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,l){return this.projection.createTileMatrix(this,l,o)}calculateDistanceTileData(o){let l=o.key,p=this._distanceTileDataCache;if(p[l])return p[l];let y=o.canonical,v=1/this.height,C=this.cameraWorldSize,D=C/this.zoomScale(y.z),k=(y.x+Math.pow(2,y.z)*o.wrap)*D,N=y.y*D,B=this.point;B.x*=C/this.worldSize,B.y*=C/this.worldSize;let H=this.angle,U=Math.sin(-H),q=-Math.cos(-H);return p[l]={bearing:[U,q],center:[(B.x-k)*v,(B.y-N)*v],scale:D/r.ag*v},p[l]}calculateFogTileMatrix(o){let l=o.key,p=this._fogTileMatrixCache;if(p[l])return p[l];let y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return r.ab.mat4.multiply(y,this.worldToFogMatrix,y),p[l]=new Float32Array(y),p[l]}calculateProjMatrix(o,l=!1,p=!1){let y=o.key,v;if(v=p?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,v[y])return v[y];let C=this.calculatePosMatrix(o,this.worldSize),D;return D=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,r.ab.mat4.multiply(C,D,C),v[y]=new Float32Array(C),v[y]}calculatePixelsToTileUnitsMatrix(o){let l=o.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];let y=r.b_(o,this);return p[l]=y,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let o=1/this.worldSize,l=r.ab.mat4.fromScaling([],[o,o,o]);return r.ab.mat4.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let o=this._elevation;this._updateCameraState();let l=r.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),y=this._camera.forward(),v=r.bH(1,this._center.lat);p[2]/=v,y[2]/=v,r.ab.vec3.normalize(y,y);let C=o.raycast(p,y,o.exaggeration());if(C){let D=r.ab.vec3.scaleAndAdd([],p,y,C),k=new r.aa(D[0],D[1],r.bH(D[2],r.aS(D[1]))),N=(k.z+r.ab.vec3.length([k.x-p[0],k.y-p[1],k.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;let l=this._elevation,p=r.bH(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(p),v=l.getAtPointOrZero(new r.aa(...y)),C=this.pixelsPerMeter/this.worldSize*v,D=this._minimumHeightOverTerrain(),k=y[2]-C;if(k<=D)if(k<0||o){let N=this.locationCoordinate(this._center,this._centerAltitude),B=[y[0],y[1],N.z-y[2]],H=r.ab.vec3.length(B);B[2]-=(D-k)/this._pixelsPerMercatorPixel;let U=r.ab.vec3.length(B);if(U===0)return;r.ab.vec3.scale(B,B,H/U*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],N.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){let U=this.center;return U.lat=r.aw(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(U.lng=r.aw(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}let l=this._unmodified,{x:p,y}=this.point,v=0,C=p,D=y,k=this.width/2,N=this.height/2,B=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(y-N<B&&(D=B+N),y+N>H&&(D=H-N),H-B<this.height&&(v=Math.max(v,this.height/(H-B)),D=(H+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let U=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,ee=this.worldSize/2-(U+q)/2;C=(p+ee+this.worldSize)%this.worldSize-ee,C-k<U&&(C=U+k),C+k>q&&(C=q-k),q-U<this.width&&(v=Math.max(v,this.width/(q-U)),C=(q+U)/2)}C===p&&D===y||(this.center=this.unproject(new r.P(C,D))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let o=this.centerOffset,l=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bH(1,this.center.lat)/r.bH(1,r.c8));let y=r.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let v=this.projection.zAxisUnit==="meters"?p:1,C=this._camera.getWorldToCamera(this.worldSize,v),D,k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-o.x/this.width,k[9]=2*o.y/this.height,this.isOrthographic){let Ie=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Re=Ie*this.aspect,Ye=-Re,$e=-Ie;Re-=o.x,Ye-=o.x,Ie+=o.y,$e+=o.y,D=this._camera.getCameraToClipOrthographic(Ye,Re,$e,Ie,this._nearZ,this._farZ),((Ae,ze,at,gt)=>{for(let St=0;St<16;St++)Ae[St]=Gh(ze[St],at[St],gt)})(D,D,k,Ot(this.pitch>=15?1:this.pitch/15))}else D=k;let N=r.ab.mat4.mul([],k,C),B=r.ab.mat4.mul([],D,C);if(this.projection.isReprojectedInTileSpace){let Ie=this.locationCoordinate(this.center),Re=r.ab.mat4.identity([]);r.ab.mat4.translate(Re,Re,[Ie.x*this.worldSize,Ie.y*this.worldSize,0]),r.ab.mat4.multiply(Re,Re,r.c0(this)),r.ab.mat4.translate(Re,Re,[-Ie.x*this.worldSize,-Ie.y*this.worldSize,0]),r.ab.mat4.multiply(B,B,Re),r.ab.mat4.multiply(N,N,Re),this.inverseAdjustmentMatrix=r.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ab.mat4.scale([],B,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=B,this.invProjMatrix=r.ab.mat4.invert(new Float64Array(16),this.projMatrix),l){let Ie=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ie[8]=2*-o.x/this.width,Ie[9]=2*o.y/this.height,this.expandedFarZProjMatrix=r.ab.mat4.mul([],Ie,C)}else this.expandedFarZProjMatrix=this.projMatrix;let H=r.ab.mat4.invert([],D);this.frustumCorners=r.c2.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);let U=new Float32Array(16);r.ab.mat4.identity(U),r.ab.mat4.scale(U,U,[1,-1,1]),r.ab.mat4.rotateX(U,U,this._pitch),r.ab.mat4.rotateZ(U,U,this.angle);let q=r.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ab.mat4.clone(q);let ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-o.x/this.width,q[9]=2*(o.y+ee)/this.height,this.skyboxMatrix=r.ab.mat4.multiply(U,q,U);let Q=this.point,ie=Q.x,re=Q.y,ue=this.width%2/2,ge=this.height%2/2,pe=Math.cos(this.angle),we=Math.sin(this.angle),xe=ie-Math.round(ie)+pe*ue+we*ge,be=re-Math.round(re)+pe*ge+we*ue,ve=new Float64Array(B);if(r.ab.mat4.translate(ve,ve,[xe>.5?xe-1:xe,be>.5?be-1:be,0]),this.alignedProjMatrix=ve,B=r.ab.mat4.create(),r.ab.mat4.scale(B,B,[this.width/2,-this.height/2,1]),r.ab.mat4.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=r.ab.mat4.create(),r.ab.mat4.scale(B,B,[1,-1,1]),r.ab.mat4.translate(B,B,[-1,-1,0]),r.ab.mat4.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=r.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},B=r.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.c3(this);let Ie=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ab.vec3.transformMat4(Ie,Ie,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let o=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,v=[o,o,l];r.ab.vec3.scale(v,v,y),r.ab.vec3.scale(p,p,-1),r.ab.vec3.multiply(p,p,v);let C=r.ab.mat4.create();r.ab.mat4.translate(C,C,p),r.ab.mat4.scale(C,C,v),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,l,y)}_computeCameraPosition(o){let l=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-o/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*v,y.y/this.worldSize-p[1]*v,o/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){let l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],y=o[2],v=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(v=Math.min((l-p)/y,1)),this._camera.position=r.ab.vec3.scaleAndAdd([],this._camera.position,o,v),this._updateStateFromCamera()}_updateStateFromCamera(){let o=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),v=r.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ai(this._maxPitch)),D=Math.max((o[2]-v)/Math.cos(p),C),k=this._zoomFromMercatorZ(D);r.ab.vec3.scaleAndAdd(o,o,l,D),this._pitch=r.aw(p,r.ai(this.minPitch),r.ai(this.maxPitch)),this.angle=r.bF(y,-Math.PI,Math.PI),this._setZoom(r.aw(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.aa(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){let o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let l=0,p=r.bY,y=0,v=1/0;for(;p-l>1e-6&&p>l;){let C=l+.5*(p-l),D=this.tileSize*Math.pow(2,C),k=this.getCameraToCenterDistance(this.projection,C,D),N=this.scaleZoom(k/(o*this.tileSize)),B=Math.abs(C-N);B<v&&(v=B,y=C),C<N?l=C:p=C}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,l){let p=Math.min(o.x,l.x),y=Math.max(o.x,l.x),v=Math.min(o.y,l.y),C=Math.max(o.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let D=[new r.P(p,v),new r.P(y,C),new r.P(p,C),new r.P(y,v)],k=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(let B of D){let H=this.pointRayIntersection(B);if(H.t<0)return!0;let U=this.rayIntersectionCoordinate(H);if(U.x<k||U.y<0||U.x>N||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(o,l){let p=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,o)),y=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){let o=function([l,p,y],v){let C=[l,p,y,1];r.ab.vec4.transformMat4(C,C,v);let D=C[3]=Math.max(C[3],1e-6);return C[0]/=D,C[1]/=D,C[2]/=D,C}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(o[0],o[1])}{let o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,o))}}getCameraToCenterDistance(o,l=this.zoom,p=this.worldSize){let y=r.b$(o,l,this.width,this.height,1024),v=o.pixelSpaceConversion(this.center.lat,p,y),C=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(C=Gh(1,C,Ot(this.pitch>=15?1:this.pitch/15))),C}getWorldToCameraMatrix(){let o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ab.mat4.multiply(o,o,this.globeMatrix),o}getFrustum(o){return r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}let nl=(f,o)=>{if(o>0&&f.terrain&&r.w("Cutoff is currently disabled on terrain"),o<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let l=f.transform,p=Math.max(Math.abs(l._zoom-(f.minCutoffZoom-1)),1),y=l.isLODDisabled(!1)?r.ac(60,45,l.pitch):r.ac(30,15,l.pitch),v=l._farZ-l._nearZ,C=o*l.height,D=((1-(k=y))*l.cameraToCenterDistance+k*(l._farZ+C))*p;var k;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(D-l._nearZ)/v,(D-C-l._nearZ)/v]}}},xo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Wp{constructor(o,l){this.aabb=o,this.lastCascade=l}}class Hs{add(o,l){let p=this.receivers[o.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],l.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],l.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],l.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],l.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],l.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],l.max[2])):this.receivers[o.key]=new Wp(l,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,l,p){let y=r.cd.fromPoints(o.points),v=0;for(let C in this.receivers){let D=this.receivers[C];if(!D||!y.intersectsAabb(D.aabb))continue;D.aabb.min=y.closestPoint(D.aabb.min),D.aabb.max=y.closestPoint(D.aabb.max);let k=D.aabb.getCorners();for(let N=0;N<p.length;N++){let B=!0;for(let H of k){let U=[H[0]*l,H[1]*l,H[2]];if(r.ab.vec3.transformMat4(U,U,p[N].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){B=!1;break}}if(D.lastCascade=N,v=Math.max(v,N),B)break}}return v+1}}class il{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Hs,this._depthMode=new an(o.context.gl.LEQUAL,an.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(xo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(xo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),o.tp.registerParameter(xo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,l){let p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;let y=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||y<=0||(this._shadowLayerCount=p.style.order.reduce((ee,Q)=>{let ie=p.style._mergedLayers[Q];return ee+(ie.hasShadowPass()&&!ie.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let v=p.context,C=xo.shadowMapResolution,D=xo.shadowMapResolution;if(this._cascades.length===0||xo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ee=0;ee<xo.cascadeCount;++ee){let Q=p._shadowMapDebug,ie=v.gl,re=v.createFramebuffer(C,D,Q,"texture"),ue=new r.T(v,{width:C,height:D,data:null},ie.DEPTH_COMPONENT16);if(re.depthAttachment.set(ue.texture),Q){let ge=new r.T(v,{width:C,height:D,data:null},ie.RGBA8);re.colorAttachment.set(ge.texture)}this._cascades.push({framebuffer:re,texture:ue,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bR,scale:0})}}this.shadowDirection=Nl(l);let k=0;if(o.elevation){let ee=o.elevation,Q=[1e4,-1e4];ee.visibleDemTiles.filter(ie=>ie.dem).forEach(ie=>{let re=ie.dem.tree;Q[0]=Math.min(Q[0],re.minimums[0]),Q[1]=Math.max(Q[1],re.maximums[0])}),Q[0]!==1e4&&(k=(Q[1]-Q[0])*ee.exaggeration())}let N=1.5*o.cameraToCenterDistance,B=3*N,H=new Float64Array(16);for(let ee=0;ee<this._cascades.length;++ee){let Q=this._cascades[ee],ie=o.height/50,re=1;xo.cascadeCount===1?re=B:ee===0?re=N:(ie=N,re=B);let[ue,ge]=rl(o,this.shadowDirection,ie,re,xo.shadowMapResolution,k);Q.scale=o.scale,Q.matrix=ue,Q.boundingSphereRadius=ge,r.ab.mat4.invert(H,Q.matrix),Q.frustum=r.bR.fromInvProjectionMatrix(H,1,0,!0),Q.far=re}let U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/xo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=xo.shadowMapResolution,this._uniformValues.u_shadowmap_0=Co.ShadowMap0,this._uniformValues.u_shadowmap_1=Co.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let q=p.transform.elevation;for(let ee of this._groundShadowTiles){let Q={min:0,max:0};if(q){let ie=q.getMinMaxForTile(ee);ie&&(Q=ie)}this.addShadowReceiver(ee.toUnwrapped(),Q.min,Q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,l){if(!this.enabled)return;let p=this.painter,y=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),y.viewport.set([0,0,xo.shadowMapResolution,xo.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){p.currentShadowCascade=v,y.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),y.clear({color:r.aj.white,depth:1});for(let C of o.order){let D=o._mergedLayers[C];if(!D.hasShadowPass()||D.isHidden(p.transform.zoom))continue;let k=o.getLayerSourceCache(D),N=k?l[k.id]:void 0;(D.type==="model"||N&&N.length)&&p.renderLayer(p,k,D,N)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let o=this.painter,l=o.style,p=o.context,y=l.directionalLight,v=l.ambientLight;if(!y||!v)return;let C=[],D=nl(o,o.longestCutoffRange);D.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),C.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&C.push("NORMAL_OFFSET");let k=fs(l,y,v),N=new an(p.gl.LEQUAL,an.ReadOnly,o.depthRangeFor3D);for(let B of this._groundShadowTiles){let H=B.toUnwrapped(),U=o.isTileAffectedByFog(B),q=o.getOrCreateProgram("groundShadow",{defines:C,overrideFog:U});this.setupShadows(H,q),o.uploadCommonUniforms(p,q,H,null,D);let ee={u_matrix:o.transform.calculateProjMatrix(H),u_ground_shadow_factor:k};q.draw(o,p.gl.TRIANGLES,N,Sn.disabled,$n.multiply,yn.disabled,ee,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,{},o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?$n.unblended:$n.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){let l=this.painter.transform,p=l.calculatePosMatrix(o,l.worldSize);return r.ab.mat4.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(o){return r.ab.mat4.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,l,p,y=0){if(!this.enabled)return;let v=this.painter.transform,C=this.painter.context,D=C.gl,k=this._uniformValues,N=new Float64Array(16),B=v.calculatePosMatrix(o,v.worldSize);for(let H=0;H<this._cascades.length;H++)r.ab.mat4.multiply(N,this._cascades[H].matrix,B),k[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(N),C.activeTexture.set(D.TEXTURE0+Co.ShadowMap0+H),this._cascades[H].texture.bind(D.NEAREST,D.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){let H=r.cc(o.canonical),U=2/v.tileSize*r.ag/xo.shadowMapResolution,q=U*this._cascades[0].boundingSphereRadius,ee=U*this._cascades[this._cascades.length-1].boundingSphereRadius,Q=(p==="vector-tile"?1:3)/Math.pow(2,y-o.canonical.z-(1-v.zoom+Math.floor(v.zoom)));k.u_shadow_normal_offset=[H,q*Q,ee*Q],k.u_shadow_bias=[6e-5,.0012,.012]}else k.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(C,k)}setupShadowsFromMatrix(o,l,p=!1){if(!this.enabled)return;let y=this.painter.context,v=y.gl,C=this._uniformValues,D=new Float64Array(16);for(let k=0;k<xo.cascadeCount;k++)r.ab.mat4.multiply(D,this._cascades[k].matrix,o),C[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),y.activeTexture.set(v.TEXTURE0+Co.ShadowMap0+k),this._cascades[k].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=p,p){let k=xo.normalOffset;C.u_shadow_normal_offset=[1,k,k],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(y,C)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,l,p,y){if(y[2]>=0)return{};let v=function(k,N,B){let H=B/(1<<k.canonical.z);return new r.cd([k.canonical.x*H+k.wrap*B,k.canonical.y*H+k.wrap*B,0],[(k.canonical.x+1)*H+k.wrap*B,(k.canonical.y+1)*H+k.wrap*B,N])}(o,l,p).getCorners(),C=l/-y[2];y[0]<0?(r.ab.vec3.add(v[0],v[0],[y[0]*C,0,0]),r.ab.vec3.add(v[3],v[3],[y[0]*C,0,0])):y[0]>0&&(r.ab.vec3.add(v[1],v[1],[y[0]*C,0,0]),r.ab.vec3.add(v[2],v[2],[y[0]*C,0,0])),y[1]<0?(r.ab.vec3.add(v[0],v[0],[0,y[1]*C,0]),r.ab.vec3.add(v[1],v[1],[0,y[1]*C,0])):y[1]>0&&(r.ab.vec3.add(v[2],v[2],[0,y[1]*C,0]),r.ab.vec3.add(v[3],v[3],[0,y[1]*C,0]));let D={};return D.vertices=v,D.planes=[ca(v[1],v[0],v[4]),ca(v[2],v[1],v[5]),ca(v[3],v[2],v[6]),ca(v[0],v[3],v[7])],D}addShadowReceiver(o,l,p){this._receivers.add(o,r.cd.fromTileIdAndHeight(o,l,p))}getMaxCascadeForTile(o){let l=this._receivers.get(o);return l&&l.lastCascade?l.lastCascade:0}}function ca(f,o,l){let p=r.ab.vec3.sub([],l,o),y=r.ab.vec3.sub([],f,o),v=r.ab.vec3.cross([],p,y),C=r.ab.vec3.length(v);return C===0?[0,0,1,0]:(r.ab.vec3.scale(v,v,1/C),[v[0],v[1],v[2],-r.ab.vec3.dot(v,o)])}function Nl(f){let o=f.properties.get("direction"),l=r.cb(o.x,o.y,o.z);l[2]=r.aw(l[2],0,75);let p=r.ce([l[0],l[1],l[2]]);return r.ab.vec3.fromValues(p.x,p.y,p.z)}function fs(f,o,l){let p=o.properties.get("color-use-theme")==="none",y=o.properties.get("color"),v=o.properties.get("intensity"),C=o.properties.get("direction"),D=[C.x,C.y,C.z],k=l.properties.get("color-use-theme")==="none",N=l.properties.get("color"),B=l.properties.get("intensity"),H=Math.max(r.ab.vec3.dot([0,0,1],D),0),U=[0,0,0];r.ab.vec3.scale(U,N.toRenderColor(k?null:f.getLut(o.scope)).toArray01Linear().slice(0,3),B);let q=[0,0,0];return r.ab.vec3.scale(q,y.toRenderColor(p?null:f.getLut(l.scope)).toArray01Linear().slice(0,3),H*v),r.cf([U[0]>0?U[0]/(U[0]+q[0]):0,U[1]>0?U[1]/(U[1]+q[1]):0,U[2]>0?U[2]/(U[2]+q[2]):0])}function rl(f,o,l,p,y,v){let C=f.zoom,D=f.scale,k=f.worldSize,N=1/k,B=f.aspect,H=Math.sqrt(1+B*B)*Math.tan(.5*f.fovX),U=H*H,q=p-l,ee=p+l,Q,ie;U>q/ee?(Q=p,ie=p*H):(Q=.5*ee*(1+U),ie=.5*Math.sqrt(q*q+2*(p*p+l*l)*U+ee*ee*U*U));let re=f.projection.pixelsPerMeter(f.center.lat,k),ue=f._camera.getCameraToWorldMercator(),ge=[0,0,-Q*N];r.ab.vec3.transformMat4(ge,ge,ue);let pe=ie*N,we=f._edgeInsets;if(!(we.left===0&&we.top===0&&we.right===0&&we.bottom===0||we.left===we.right&&we.top===we.bottom)){let Ct=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?re:1),pt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,l,p);pt[8]=2*-f.centerOffset.x/f.width,pt[9]=2*f.centerOffset.y/f.height;let lt=new Float64Array(16);r.ab.mat4.mul(lt,pt,Ct);let Nt=new Float64Array(16);r.ab.mat4.invert(Nt,lt);let Ht=r.bR.fromInvProjectionMatrix(Nt,k,C,!0);for(let Lt of Ht.points){let Wt=((xe=Lt)[0]/=D,xe[1]/=D,xe[2]=r.bH(xe[2],f._center.lat),xe);pe=Math.max(pe,r.ab.vec3.len(r.ab.vec3.subtract([],ge,Wt)))}}var xe;pe*=y/(y-1);let be=Math.acos(o[2]),ve=Math.atan2(-o[0],-o[1]),Ie=new tl;Ie.position=ge,Ie.setPitchBearing(be,ve);let Re=Ie.getWorldToCamera(k,re),Ye=pe*k,$e=Math.min(f._mercatorZfromZoom(17)*k*-2,-2*Ye),Ae=Ie.getCameraToClipOrthographic(-Ye,Ye,-Ye,Ye,$e,(Ye+v*re)/o[2]),ze=new Float64Array(16);r.ab.mat4.multiply(ze,Ae,Re);let at=r.ab.vec3.fromValues(Math.floor(1e6*ge[0])/1e6*k,Math.floor(1e6*ge[1])/1e6*k,0),gt=.5*y,St=[0,0,0];r.ab.vec3.transformMat4(St,at,ze),r.ab.vec3.scale(St,St,gt);let Ve=[Math.floor(St[0]),Math.floor(St[1]),Math.floor(St[2])],dt=[0,0,0];r.ab.vec3.sub(dt,St,Ve),r.ab.vec3.scale(dt,dt,-1/gt);let et=new Float64Array(16);return r.ab.mat4.identity(et),r.ab.mat4.translate(et,et,dt),r.ab.mat4.multiply(ze,et,ze),[ze,Ye]}class Yp extends r.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.numModelsLoading={}}loadModel(o,l){return r.aM(this.requestManager.transformRequest(l,r.R.Model).url).then(p=>{if(!p)return;let y=r.aN(p),v=new r.aO(o,void 0,void 0,y);return v.computeBoundsAndApplyParent(),v}).catch(p=>{if(p&&p.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${o} from ${l}: ${p.message}`)))})}load(o,l){this.models[l]||(this.models[l]={});let p=Object.keys(o);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+p.length;let y=[];for(let v of p)y.push(this.loadModel(v,o[v]));Promise.allSettled(y).then(v=>{for(let C=0;C<v.length;C++){let{status:D,value:k}=v[C];D==="fulfilled"&&k&&(this.models[l][p[C]]={model:k,numReferences:1})}this.numModelsLoading[l]-=p.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(v=>{this.fire(new r.y(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(let o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,l){return!!this.getModel(o,l)}getModel(o,l){return this.models[l]||(this.models[l]={}),this.models[l][o]?this.models[l][o].model:void 0}addModel(o,l,p){this.models[p]||(this.models[p]={}),this.hasModel(o,p)&&this.models[p][o].numReferences++,this.load({[o]:this.requestManager.normalizeModelURL(l)},p)}addModels(o,l){this.models[l]||(this.models[l]={});let p={};for(let y in o)this.models[l][y]={},p[y]=this.requestManager.normalizeModelURL(o[y]);this.load(p,l)}addModelsFromBucket(o,l){this.models[l]||(this.models[l]={});let p={};for(let y of o)this.hasModel(y,l)?this.models[l][y].numReferences++:p[y]=this.requestManager.normalizeModelURL(y);this.load(p,l)}removeModel(o,l){if(this.models[l]&&this.models[l][o]&&(this.models[l][o].numReferences--,this.models[l][o].numReferences===0)){let p=this.models[l][o].model;delete this.models[l][o],p.destroy()}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,l){this.models[l]||(this.models[l]={});for(let p in this.models[l])this.models[l][p].model&&this.models[l][p].model.upload(o.context)}}let gf=new r.a5({data:new r.a6(r.a3.colorTheme.data)}),ru={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function qh(f){return f=f||{},Object.assign(f,ru)}class Yu extends r.E{constructor(o){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=o,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(o=>{o.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=o.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=o.stylesheet.indoor.buildingFeaturesetId,this._scope=o.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:o=>(o.feature&&o.feature.properties.floorplan&&this.selectFloorplan(o.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(o){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(C,D){let[k,N]=C,{center:B,radius:H}=D,[U,q]=B,ee=Math.abs(k-U);return Math.sqrt((ee>180?360-ee:ee)**2+(N-q)**2)<=H}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.z("floorplangone")));let l={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=new r.P(this._map.transform.width/2,this._map.transform.height/2),y=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(o?y:p,l);v.length>0&&(this._selectedFloorplan&&v[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=v[0],this._floorplanSelected(!1)))}_floorplanSelected(o){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(v){let[[C,D],[k,N]]=v,B=(k-C+360)%360,H=B>180?360-B:B;return{center:[(C+H/2+360)%360,(D+N)/2],radius:Math.sqrt(H**2+(N-D)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});let l=this._floorplanStates[this._indoorData.id].selectedBuilding,p=this._floorplanStates[this._indoorData.id].selectedLevel,y;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(let v of this._indoorData.levels)v.id===this._selectedLevel.id&&(y=v.id);if(this.fire(new r.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:y})),l){let v=this._indoorData.buildings.find(C=>C.id===l);this._buildingSelected(v,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(p){let v=this._indoorData.levels.find(C=>C.id===p);this._updateLevels(v,o)}else o&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(o,l){l&&o&&o.extent&&this._map.fitBounds(o.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=o?o.id:void 0;let p=this._indoorData.levels.filter(y=>o.levels.includes(y.id));this.fire(new r.z("buildingselected",{buildingId:o.id,levels:p}))}_levelSelected(o){if(o==="overview")this._updateLevels(void 0,!0);else{let l=this._indoorData.levels.find(p=>p.id===o);this._updateLevels(l,!0)}this.fire(new r.z("levelselected",{levelId:o==="overview"?void 0:o}))}_updateLevels(o,l){if(!o)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(l&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function p(N){let B=N.indexOf("/floor/");if(B===-1)return N;let H=B+7,U=N.indexOf("/",H);return U===-1?N.slice(H):N.slice(H,U)}this._selectedLevel=o,this._floorplanStates[this._indoorData.id].selectedLevel=o?o.id:void 0;let y=[],v={},C={},D={},k={};for(let N of this._indoorData.levels)if(y.push(N.id),v[N.id]=N.height,C[N.id]=N.base,o){if(this.mergeFloors){let B=p(o.id),H=p(N.id);D[N.id]=H===B?"true":"false"}else D[N.id]=N.id===o.id?"true":"false";k[N.id]=N.base<o.base?"true":"false"}else k[N.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",D]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",k]),o&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!o.isUnderground),l&&o.extent)){let N=this._map.cameraForBounds(o.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),B=this._map.getZoom(),H=N.zoom?Math.abs(B-N.zoom):0;this._map.fitBounds(o.extent,H>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:B})}}selectFloorplan(o){let l={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],y=this._map.queryRenderedFeatures(p,l);if(y.length>0){for(let v of y)if(JSON.parse(v.properties["indoor-data"]).floorplanIDs.includes(o)){this._selectedFloorplan=v,this._floorplanSelected(!0);break}}}selectBuilding(o){let l=this._indoorData.buildings.find(p=>p.id===o);this._buildingSelected(l,!0)}selectLevel(o){this._levelSelected(o)}}function fc(f){if(!f.metadata||!f.metadata.content_area)return;let{left:o,top:l,width:p,height:y}=f.metadata.content_area;return[o,l,o+p,l+y]}let $s=(f,o)=>Te(f,o&&o.filter(l=>l.identifier!=="source.canvas")),_f=r.ay(li,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),Xp=r.ay(li,["setCenter","setZoom","setBearing","setPitch"]),yf=new Set(["background","sky","slot","custom"]),Xu={version:8,layers:[],sources:{}},vf={duration:300,delay:0};class Gs extends r.E{constructor(o,l={}){super(),this.map=o,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=r.l({},vf),this._buildingIndex=new jh(this),this.crossTileSymbolIndex=new Hh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new gi,this.dispatcher=l.dispatcher?l.dispatcher:new r.D(r.ci(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Nr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new r.cj(o._requestManager,l.localFontFamily?r.ck.all:l.localIdeographFontFamily?r.ck.ideographs:r.ck.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new Yp(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",r.cl());let p=this;this._rtlTextPluginCallback=Gs.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,C)=>{if(r.cm(v),C&&C.every(D=>D))for(let D in p._sourceCaches){let k=p._sourceCaches[D],N=k.getSource().type;N!=="vector"&&N!=="geojson"||k.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;let v=this.getOwnSource(y.sourceId);if(v&&v.vectorLayerIds)for(let C in this._layers){let D=this._layers[C];D.source===v.id&&this._validateLayer(D)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(r.f(o))return o;let l=r.cn(o);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${r.co(JSON.stringify(o))}`}_diffStyle(o,l,p){this.globalId=this._getGlobalId(o);let y=(v,C)=>{try{C(null,this.setState(v,p))}catch(D){C(D,!1)}};if(typeof o=="string"){let v=this.map._requestManager.normalizeStyleURL(o),C=this.map._requestManager.transformRequest(v,r.R.Style);r.n(C,(D,k)=>{D?this.fire(new r.y(D)):k&&y(k,l)})}else typeof o=="object"&&y(o,l)}loadURL(o,l={}){this.fire(new r.z("dataloading",{dataType:"style"}));let p=typeof l.validate=="boolean"?l.validate:!r.f(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,l.accessToken),this.resolvedImports.add(o);let y=this.importsCache.get(o);if(y)return this._load(y,p);let v=this.map._requestManager.transformRequest(o,r.R.Style);this._request=r.n(v,(C,D)=>{if(this._request=null,C)this.fire(new r.y(C));else if(D)return this.importsCache.set(o,D),this._load(D,p)})}loadJSON(o,l={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=r.q.frame(()=>{this._request=null,this._load(o,l.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(Xu,!1)}_loadImports(o,l,p){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let y=[];for(let v of o){let C=this._createFragmentStyle(v),D=new Promise(B=>{C.once("style.import.load",B),C.once("error",B)}).then(()=>this.mergeAll());if(y.push(D),this.resolvedImports.has(v.url)){C.loadEmpty();continue}let k=v.data||this.importsCache.get(v.url);k?(C.loadJSON(k,{validate:l}),this._isInternalStyle(k)&&(C.globalId=null)):v.url?C.loadURL(v.url,{validate:l}):C.loadEmpty();let N={style:C,id:v.id,config:v.config};if(p){let B=this.fragments.findIndex(({id:H})=>H===p);this.fragments=this.fragments.slice(0,B).concat(N).concat(this.fragments.slice(B))}else this.fragments.push(N)}return Promise.allSettled(y)}getImportGlobalIds(o=this,l=new Set){for(let p of o.fragments)p.style.globalId&&l.add(p.style.globalId),this.getImportGlobalIds(p.style,l);return[...l.values()]}_createFragmentStyle(o){let l=this.scope?r.aC(o.id,this.scope):o.id,p,y=this._initialConfig&&this._initialConfig[l];(o.config||y)&&(p=r.l({},o.config,y));let v=new Gs(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,l){let p=o.indoor?qh(o.schema):o.schema;if(this._isInternalStyle(o)){let C=r.l({},Xu,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(C,l)}if(this.updateConfig(this._config,p),l&&$s(this,Uo(o)))return;this._loaded=!0,this.stylesheet=r.cp(o);let y=()=>{for(let N in o.sources)this.addSource(N,o.sources[N],{validate:!1,isInitialLoad:!0});o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(o.glyphs,this.scope);let C=Uu(this.stylesheet.layers);if(this._order=C.map(N=>N.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let N=this.stylesheet.lights[0];this.light=new nt(N.properties,N.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new nt(this.stylesheet.light)),this._layers={};for(let N of C){let B=r.cu(N,this.scope,this._styleColorTheme.lut,this.options);B.configDependencies.size!==0&&this._configDependentLayers.add(B.fqid),B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B;let H=this.getOwnLayerSourceCache(B),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();H&&B.canCastShadows()&&U&&(H.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let D=this.stylesheet.terrain;D&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(D,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));let k=this.isRootStyle();o.imports?this._loadImports(o.imports,l).then(()=>{this._reloadImports(),this.fire(new r.z(k?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(k?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];let v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){let C=this._evaluateColorThemeData(v);this._loadColorTheme(C).then(()=>{y()}).catch(D=>{r.w(`Couldn't load color theme from the stylesheet: ${D}`),y()})}else this._styleColorTheme.lut=null,y()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,l,p,y,v,C,D,k,N,B,H={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(U=>{if(U.stylesheet){if(U.light!=null&&(o=U.light),U.stylesheet.lights)for(let q of U.stylesheet.lights)q.type==="ambient"&&U.ambientLight!=null&&(l=U.ambientLight),q.type==="directional"&&U.directionalLight!=null&&(p=U.directionalLight);y=this._prioritizeTerrain(y,U.terrain,U.stylesheet.terrain),U.stylesheet.fog&&U.fog!=null&&(v=U.fog),U.stylesheet.snow&&U.snow!=null&&(C=U.snow),U.stylesheet.rain&&U.rain!=null&&(D=U.rain),U.stylesheet.camera!=null&&(B=U.stylesheet.camera),U.stylesheet.projection!=null&&(k=U.stylesheet.projection),U.stylesheet.transition!=null&&(N=U.stylesheet.transition),H[U.scope]=U._styleColorTheme}}),this.light=o,this.ambientLight=l,this.directionalLight=p,this.fog=v,this.snow=C,this.rain=D,this._styleColorThemeForScope=H,y===null?delete this.terrain:this.terrain=y,this.camera=B||{"camera-projection":"perspective"},this.projection=k||{name:"mercator"},this.transition=r.l({},vf,N),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){let l=p=>{for(let y of p.fragments)l(y.style);o(p)};l(this)}_prioritizeTerrain(o,l,p){let y=o&&o.drapeRenderMode===0;return p===null?l&&l.drapeRenderMode===0?l:y?o:null:l!=null&&(!o||y||l&&l.drapeRenderMode===1)?l:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{o=this._prioritizeTerrain(o,l.terrain,l.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(o=l.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){let o={},l={},p={};this.forEachFragmentStyle(y=>{for(let v in y._sourceCaches){let C=r.aC(v,y.scope);o[C]=y._sourceCaches[v]}for(let v in y._otherSourceCaches){let C=r.aC(v,y.scope);l[C]=y._otherSourceCaches[v]}for(let v in y._symbolSourceCaches){let C=r.aC(v,y.scope);p[C]=y._symbolSourceCaches[v]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=p}mergeLayers(){let o={},l=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(let C of v._order){let D=v._layers[C];if(D.type==="slot"){let k=r.cq(C);if(o[k])continue;o[k]=[]}D.slot&&o[D.slot]?o[D.slot].push(D):l.push(D)}}),this._mergedOrder=[];let y=(v=[])=>{for(let C of v)if(C.type==="slot"){let D=r.cq(C.id);o[D]&&y(o[D]),this._mergedSlots.push(D)}else{let D=r.aC(C.id,C.scope);this._mergedOrder.push(D),p[D]=C,C.is3D()&&(this._has3DLayers=!0),C.type==="circle"&&(this._hasCircleLayers=!0),C.type==="symbol"&&(this._hasSymbolLayers=!0),C.type==="clip"&&(this._clipLayerPresent=!0)}};y(l),this._mergedOrder.sort((v,C)=>{let D=p[v],k=p[C];return D.hasInitialOcclusionOpacityProperties?k.is3D()?1:0:D.is3D()&&k.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=r.l({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(l,p,y){let v=r.l({},p);for(let D of Object.keys(r.a3.colorTheme))v[D]===void 0&&(v[D]=r.a3.colorTheme[D].default);let C=new r.a4(gf,l,new Map(y));return C.setTransitionOrValue(v,y),C.untransitioned().possiblyEvaluate(new r.a8(0))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,y)=>{let v="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let C=o;C.startsWith(v)||(C=v+C);let D="mapbox-reserved-lut",k=new Image;k.src=C,k.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},k.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void p();this._styleColorTheme.lutLoading=!1;let{width:N,height:B,data:H}=r.q.getImageData(k);if(B>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(N!==B*B)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(D)&&this.removeImage(D),this.addImage(D,{data:new r.r({width:N,height:B},H),pixelRatio:1,sdf:!1,usvg:!1,version:0});let U=this.imageManager.getImage(D,this.scope);U?(this._styleColorTheme.lut={image:U.data,data:o},p()):y(new Error("Missing LUT image."))}})}getLut(o){let l=this._styleColorThemeForScope[o];return l?l.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(l,p,y){let v,C,D,k=r.q.devicePixelRatio>1?"@2x":"",N=r.n(p.transformRequest(p.normalizeSpriteURL(l,k,".json"),r.R.SpriteJSON),(U,q)=>{N=null,D||(D=U,v=q,H())}),B=r.o(p.transformRequest(p.normalizeSpriteURL(l,k,".png"),r.R.SpriteImage),(U,q)=>{B=null,D||(D=U,C=q,H())});function H(){if(D)y(D);else if(v&&C){let U=r.q.getImageData(C),q={};for(let ee in v){let{width:Q,height:ie,x:re,y:ue,sdf:ge,pixelRatio:pe,stretchX:we,stretchY:xe,content:be}=v[ee],ve=new r.r({width:Q,height:ie});r.r.copy(U,ve,{x:re,y:ue},{x:0,y:0},{width:Q,height:ie},null),q[ee]={data:ve,pixelRatio:pe,sdf:ge,stretchX:we,stretchY:xe,content:be,usvg:!1}}y(null,q)}}return{cancel(){N&&(N.cancel(),N=null),B&&(B.cancel(),B=null)}}}(o,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new r.y(l));else if(p)for(let y in p)this.imageManager.addImage(y,this.scope,p[y]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}_loadIconset(o){if(!r.f(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);let l=this.map._spriteFormat==="auto";var p,y;this._spriteRequest=(y=(v,C)=>{if(this._spriteRequest=null,v)l?this._loadSprite(o):this.fire(new r.y(v));else if(C)for(let D in C)this.imageManager.addImage(D,this.scope,C[D]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bi((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(o),r.R.Iconset),(v,C)=>{if(v)return void y(v);let D={},k=r.cg(new r.bh(C));for(let N of k.icons){let B={version:1,pixelRatio:r.q.devicePixelRatio,content:fc(N),stretchX:N.metadata?N.metadata.stretch_x_areas:void 0,stretchY:N.metadata?N.metadata.stretch_y_areas:void 0,sdf:!1,usvg:!0,icon:N};D[N.name]=B}y(null,D)}))}_validateLayer(o){let l=this.getOwnSource(o.source);if(!l)return;let p=o.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new r.y(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,l)=>{let p=this.fragments[l];return p&&p.style&&(o.data=p.style.serialize()),o})}_serializeSources(){let o={};for(let l in this._sourceCaches){let p=this._sourceCaches[l].getSource();o[p.id]||(o[p.id]=p.serialize())}return o}_serializeLayers(o){let l=[];for(let p of o){let y=this._layers[p];y&&y.type!=="custom"&&l.push(y.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(let o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(let o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){let l=this.getOwnLayer(o);if(l)return l;this.fire(new r.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){let l=this.getOwnSource(o);if(l)return l;this.fire(new r.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,l){let p=this.map.painter;if(p)for(let y=o.minzoom||0;y<(o.maxzoom||25.5);y++){let v=o.getProgramIds();if(v)for(let C of v){let D=o.getDefaultProgramParams(C,l.zoom,this._styleColorTheme.lut);D&&(p.style=this,this.fog&&(p._fogVisible=!0,D.overrideFog=!0,p.getOrCreateProgram(C,D)),p._fogVisible=!1,D.overrideFog=!1,p.getOrCreateProgram(C,D),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(D.overrideRtt=!0,p.getOrCreateProgram(C,D)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);let l=this.calculateLightsBrightness();o.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));let p=this._changes.isDirty(),y=!1;if(this._changes.isDirty()){let C=this._changes.getLayerUpdatesByScope();for(let D in C){let{updatedIds:k,removedIds:N}=C[D];(k||N)&&(this._updateWorkerLayers(D,k,N),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}let v={};for(let C in this._mergedSourceCaches){let D=this._mergedSourceCaches[C];v[C]=D.used,D.used=!1,D.tileCoverLift=0}for(let C of this._mergedOrder){let D=this._mergedLayers[C];if(D.recalculate(o,this._availableImages),!D.isHidden(o.zoom)){let k=this.getLayerSourceCache(D);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,D.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(D,o)}):this.precompilePrograms(D,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();for(let C in v){let D=this._mergedSourceCaches[C];v[C]!==D.used&&D.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new r.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){let o=this._changes.getUpdatedImages();if(o.length){for(let l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],o);this._changes.resetUpdatedImages()}}_updateWorkerLayers(o,l,p){let y=this.getFragmentStyle(o);y&&this.dispatcher.broadcast("updateLayers",{layers:l?y._serializeLayers(l):[],scope:o,removedIds:p||[],options:y.options})}setState(o,l){if(this._checkLoaded(),$s(this,Uo(o)))return!1;(o=r.cp(o)).layers=Uu(o.layers);let p=function(C,D){if(!C)return[{command:li.setStyle,args:[D]}];let k=[];try{if(!r.bn(C.version,D.version))return[{command:li.setStyle,args:[D]}];if(r.bn(C.center,D.center)||k.push({command:li.setCenter,args:[D.center]}),r.bn(C.zoom,D.zoom)||k.push({command:li.setZoom,args:[D.zoom]}),r.bn(C.bearing,D.bearing)||k.push({command:li.setBearing,args:[D.bearing]}),r.bn(C.pitch,D.pitch)||k.push({command:li.setPitch,args:[D.pitch]}),r.bn(C.sprite,D.sprite)||k.push({command:li.setSprite,args:[D.sprite]}),r.bn(C.glyphs,D.glyphs)||k.push({command:li.setGlyphs,args:[D.glyphs]}),r.bn(C.imports,D.imports)||function(q=[],ee=[],Q){ee=ee||[];let ie=(q=q||[]).map(di),re=ee.map(di),ue=q.reduce(ii,{}),ge=ee.reduce(ii,{}),pe=ie.slice(),we,xe,be,ve;for(we=0,xe=0;we<ie.length;we++)be=ie[we],ge.hasOwnProperty(be)?xe++:(Q.push({command:li.removeImport,args:[be]}),pe.splice(pe.indexOf(be,xe),1));for(we=0,xe=0;we<re.length;we++)be=re[re.length-1-we],pe[pe.length-1-we]!==be&&(ue.hasOwnProperty(be)?(Q.push({command:li.removeImport,args:[be]}),pe.splice(pe.lastIndexOf(be,pe.length-xe),1)):xe++,ve=pe[pe.length-we],Q.push({command:li.addImport,args:[ge[be],ve]}),pe.splice(pe.length-we,0,be));for(let Ie of ee){let Re=ue[Ie.id];Re&&!r.bn(Re,Ie)&&Q.push({command:li.updateImport,args:[Ie.id,Ie]})}}(C.imports,D.imports,k),r.bn(C.transition,D.transition)||k.push({command:li.setTransition,args:[D.transition]}),r.bn(C.light,D.light)||k.push({command:li.setLight,args:[D.light]}),r.bn(C.fog,D.fog)||k.push({command:li.setFog,args:[D.fog]}),r.bn(C.snow,D.snow)||k.push({command:li.setSnow,args:[D.snow]}),r.bn(C.rain,D.rain)||k.push({command:li.setRain,args:[D.rain]}),r.bn(C.projection,D.projection)||k.push({command:li.setProjection,args:[D.projection]}),r.bn(C.lights,D.lights)||k.push({command:li.setLights,args:[D.lights]}),r.bn(C.camera,D.camera)||k.push({command:li.setCamera,args:[D.camera]}),!r.bn(C["color-theme"],D["color-theme"]))return[{command:li.setStyle,args:[D]}];let N={},B=[];(function(q,ee,Q,ie){let re;for(re in ee=ee||{},q=q||{})q.hasOwnProperty(re)&&(ee.hasOwnProperty(re)||oo(re,Q,ie));for(re in ee){if(!ee.hasOwnProperty(re))continue;let ue=ee[re];q.hasOwnProperty(re)?r.bn(q[re],ue)||(q[re].type==="geojson"&&ue.type==="geojson"&&ac(q,ee,re)?Q.push({command:li.setGeoJSONSourceData,args:[re,ue.data]}):wr(re,ee,Q,ie)):_i(re,ee,Q)}})(C.sources,D.sources,B,N);let H=[];C.layers&&C.layers.forEach(q=>{q.source&&N[q.source]?k.push({command:li.removeLayer,args:[q.id]}):H.push(q)});let U=C.terrain;U&&N[U.source]&&(k.push({command:li.setTerrain,args:[void 0]}),U=void 0),k=k.concat(B),r.bn(U,D.terrain)||k.push({command:li.setTerrain,args:[D.terrain]}),function(q,ee,Q){ee=ee||[];let ie=(q=q||[]).map(di),re=ee.map(di),ue=q.reduce(ii,{}),ge=ee.reduce(ii,{}),pe=ie.slice(),we=Object.create(null),xe,be,ve,Ie,Re,Ye,$e;for(xe=0,be=0;xe<ie.length;xe++)ve=ie[xe],ge.hasOwnProperty(ve)?be++:(Q.push({command:li.removeLayer,args:[ve]}),pe.splice(pe.indexOf(ve,be),1));for(xe=0,be=0;xe<re.length;xe++)ve=re[re.length-1-xe],pe[pe.length-1-xe]!==ve&&(ue.hasOwnProperty(ve)?(Q.push({command:li.removeLayer,args:[ve]}),pe.splice(pe.lastIndexOf(ve,pe.length-be),1)):be++,Ye=pe[pe.length-xe],Q.push({command:li.addLayer,args:[ge[ve],Ye]}),pe.splice(pe.length-xe,0,ve),we[ve]=!0);for(xe=0;xe<re.length;xe++)if(ve=re[xe],Ie=ue[ve],Re=ge[ve],!we[ve]&&!r.bn(Ie,Re))if(r.bn(Ie.source,Re.source)&&r.bn(Ie["source-layer"],Re["source-layer"])&&r.bn(Ie.type,Re.type)){for($e in Yt(Ie.layout,Re.layout,Q,ve,null,li.setLayoutProperty),Yt(Ie.paint,Re.paint,Q,ve,null,li.setPaintProperty),r.bn(Ie.slot,Re.slot)||Q.push({command:li.setSlot,args:[ve,Re.slot]}),r.bn(Ie.filter,Re.filter)||Q.push({command:li.setFilter,args:[ve,Re.filter]}),r.bn(Ie.minzoom,Re.minzoom)&&r.bn(Ie.maxzoom,Re.maxzoom)||Q.push({command:li.setLayerZoomRange,args:[ve,Re.minzoom,Re.maxzoom]}),Ie)Ie.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?Yt(Ie[$e],Re[$e],Q,ve,$e.slice(6),li.setPaintProperty):r.bn(Ie[$e],Re[$e])||Q.push({command:li.setLayerProperty,args:[ve,$e,Re[$e]]}));for($e in Re)Re.hasOwnProperty($e)&&!Ie.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?Yt(Ie[$e],Re[$e],Q,ve,$e.slice(6),li.setPaintProperty):r.bn(Ie[$e],Re[$e])||Q.push({command:li.setLayerProperty,args:[ve,$e,Re[$e]]}))}else Q.push({command:li.removeLayer,args:[ve]}),Ye=pe[pe.lastIndexOf(ve)+1],Q.push({command:li.addLayer,args:[Re,Ye]})}(H,D.layers,k)}catch(N){console.warn("Unable to compute style diff:",N),k=[{command:li.setStyle,args:[D]}]}return k}(this.serialize(),o).filter(C=>!(C.command in Xp));if(p.length===0)return!1;let y=p.filter(C=>!(C.command in _f));if(y.length>0)throw new Error(`Unimplemented: ${y.map(C=>C.command).join(", ")}.`);let v=[];return p.forEach(C=>{v.push(this[C.command].apply(this,C.args))}),l&&Promise.all(v).then(l),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(o,l){return this.getImage(o)?this.fire(new r.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,this.scope,l),this._afterImageUpdated(o),this)}updateImage(o,l,p=!1){this.imageManager.updateImage(o,this.scope,l),p&&this._afterImageUpdated(o)}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._afterImageUpdated(o),this):this.fire(new r.y(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(o),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(o,l,p={}){return this._checkLoaded(),this._validate(Fe,`models.${o}`,l,null,p)||(this.modelManager.addModel(o,l,this.scope),this._changes.setDirty()),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,l,p={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(Sl,`sources.${o}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);let y=Dl(o,l,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));let v=C=>{let D=(C?"symbol:":"other:")+y.id,k=r.aC(D,this.scope),N=this._sourceCaches[D]=new ls(k,y,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=N,N.onAdd(this.map)};v(!1),l.type!=="vector"&&l.type!=="geojson"||v(!0),y.onAdd&&y.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();let l=this.getOwnSource(o);if(!l)throw new Error("There is no source with this ID");for(let y in this._layers)if(this._layers[y].source===o)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new r.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));let p=this.getOwnSourceCaches(o);for(let y of p){let v=r.cq(y.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(y.id),y.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,l){this._checkLoaded(),this.getOwnSource(o).setData(l),this._changes.setDirty()}getOwnSource(o){let l=this.getOwnSourceCache(o);return l&&l.getSource()}getOwnSources(){let o=[];for(let l in this._otherSourceCaches){let p=this.getOwnSourceCache(l);p&&o.push(p.getSource())}return o}areTilesLoaded(){let o=this._mergedSourceCaches;for(let l in o){let p=o[l]._tiles;for(let y in p){let v=p[y];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;let l=this._getTransitionParameters();for(let y of o){if(this._validate(zu,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){let v=this.ambientLight;v.set(y),v.updateTransitions(l)}else this.ambientLight=new _o(y,Oi||(Oi=new r.a5({color:new r.a6(r.a3.properties_light_ambient.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let v=this.directionalLight;v.set(y),v.updateTransitions(l)}else this.directionalLight=new _o(y,Si||(Si=new r.a5({direction:new r.ak(r.a3.properties_light_directional.direction),color:new r.a6(r.a3.properties_light_directional.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_directional.intensity),"cast-shadows":new r.a6(r.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a6(r.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a6(r.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let p=new r.a8(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let o=this.directionalLight,l=this.ambientLight;if(!o||!l)return;let p=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),y=o.properties.get("color").toRenderColor(null).toArray01(),v=o.properties.get("intensity"),C=o.properties.get("direction"),D=1-r.cb(C.x,C.y,C.z)[2]/90,k=p(y)*v*D,N=l.properties.get("color").toRenderColor(null).toArray01(),B=l.properties.get("intensity"),H=p(N)*B;return Number(((k+H)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(!o)return this;if(r.cr(o)){let l=r.cs(o),p=this.fragments.find(({id:v})=>v===l);if(!p)throw new Error(`Style import '${o}' not found`);let y=r.cq(o);return p.style.getFragmentStyle(y)}{let l=this.fragments.find(({id:p})=>p===o);if(!l)throw new Error(`Style import '${o}' not found`);return l.style}}setFeaturesetSelectors(o){if(!o)return;let l={},p=(y,v="")=>`${y}::${v}`;this.featuresetSelectors={};for(let y in o){let v=this.featuresetSelectors[y]=[];for(let C of o[y].selectors){if(C.featureNamespace){let k=this.getOwnLayer(C.layer);if(!k){r.w(`Layer is undefined for selector: ${C.layer}`);continue}let N=p(k.source,k.sourceLayer);if(N in l&&l[N]!==C.featureNamespace){r.w(`"featureNamespace ${C.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}l[N]=C.featureNamespace}let D;if(C.properties)for(let k in C.properties){let N=r.U(C.properties[k]);N.result==="success"&&(D=D||{},D[k]=N.value)}v.push({layerId:C.layer,namespace:C.featureNamespace,properties:D})}}}getFeaturesetDescriptors(o){let l=this.getFragmentStyle(o);if(!l||!l.stylesheet.featuresets)return[];let p=[];for(let y in l.stylesheet.featuresets)p.push({featuresetId:y,importId:l.scope?l.scope:void 0});return p}getFeaturesetLayers(o,l){let p=this.getFragmentStyle(l),y=p.stylesheet.featuresets;if(!y||!y[o])return this.fire(new r.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];let v=[];for(let C of y[o].selectors){let D=p.getOwnLayer(C.layer);D&&v.push(D)}return v}getConfigProperty(o,l){let p=this.getFragmentStyle(o);if(!p)return null;let y=r.aC(l,p.scope),v=p.options.get(y),C=v?v.value||v.default:null;return C?C.serialize():null}setConfigProperty(o,l,p){let y=this.getFragmentStyle(o);if(!y)return;let v=y.stylesheet.indoor?qh(y.stylesheet.schema):y.stylesheet.schema;if(!v||!v[l])return;let C=r.U(p);if(C.result!=="success")return void $s(this,C.value);let D=C.value.expression,k=r.aC(l,y.scope),N=y.options.get(k);if(!N)return;let B,{minValue:H,maxValue:U,stepValue:q,type:ee,values:Q}=v[l],ie=r.U(v[l].default);ie.result==="success"&&(B=ie.value.expression),B?(this.options.set(k,lr(cn({},N),{value:D,default:B,minValue:H,maxValue:U,stepValue:q,type:ee,values:Q})),this.updateConfigDependencies(l)):this.fire(new r.y(new Error(`No schema defined for the config option "${l}" in the "${o}" fragment.`)))}getConfig(o){let l=this.getFragmentStyle(o);if(!l)return null;let p=l.stylesheet.schema;if(!p)return null;let y={};for(let v in p){let C=r.aC(v,l.scope),D=l.options.get(C),k=D?D.value||D.default:null;y[v]=k?k.serialize():null}return y}setConfig(o,l){let p=this.getFragmentStyle(o);p&&(p.updateConfig(l,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){let l=this.getFragmentStyle(o);return l?l.stylesheet.schema:null}setSchema(o,l){let p=this.getFragmentStyle(o);p&&(p.stylesheet.schema=l,p.updateConfig(p._config,l),this.updateConfigDependencies())}updateConfig(o,l){if(this._config=o,o||l)if(l)for(let p in l){let y,v,C=r.U(l[p].default);if(C.result==="success"&&(y=C.value.expression),o&&o[p]!==void 0){let U=r.U(o[p]);U.result==="success"&&(v=U.value.expression)}let{minValue:D,maxValue:k,stepValue:N,type:B,values:H}=l[p];if(y){let U=r.aC(p,this.scope);this.options.set(U,{default:y,value:v,minValue:D,maxValue:k,stepValue:N,type:B,values:H})}else this.fire(new r.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(o){for(let l of this._configDependentLayers){let p=this.getLayer(l);if(p){if(o&&!p.configDependencies.has(o))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(l=>{let p=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(p){let y=l._evaluateColorThemeData(p);(!l._styleColorTheme.lut&&y!==""||l._styleColorTheme.lut&&y!==l._styleColorTheme.lut.data)&&l.setColorTheme(p)}}),this._changes.setDirty()}addLayer(o,l,p={}){this._checkLoaded();let y=o.id;if(this._layers[y])return void this.fire(new r.y(new Error(`Layer with id "${y}" already exists on this map`)));let v;if(o.type==="custom"){if($s(this,r.ct(o)))return;v=r.cu(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(y,o.source),o=r.cp(o),o=r.l(o,{source:y})),this._validate(ce,`layers.${y}`,o,{arrayIndex:-1},p))return;v=r.cu(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let C=this._order.length;if(l){let B=this._order.indexOf(l);if(B===-1)return void this.fire(new r.y(new Error(`Layer with id "${l}" does not exist on this map.`)));v.slot===this._layers[l].slot?C=B:r.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,y),this._layerOrderChanged=!0,this._layers[y]=v;let D=this.getOwnLayerSourceCache(v),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&v.canCastShadows()&&k&&(D.castsShadows=!0);let N=this._changes.getRemovedLayer(v);if(N&&v.source&&D&&v.type!=="custom"){this._changes.discardLayerRemoval(v);let B=r.aC(v.source,v.scope);N.type!==v.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),D.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(o,l){this._checkLoaded();let p=this._checkLayer(o);if(!p||o===l)return;let y=this._order.indexOf(o);this._order.splice(y,1);let v=this._order.length;if(l){let C=this._order.indexOf(l);if(C===-1)return void this.fire(new r.y(new Error(`Layer with id "${l}" does not exist on this map.`)));p.slot===this._layers[l].slot?v=C:r.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();let l=this._checkLayer(o);if(!l)return;l.setEventedParent(null);let p=this._order.indexOf(o);this._order.splice(p,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);let y=this.getOwnLayerSourceCache(l);if(y&&y.castsShadows){let v=!1;for(let C in this._layers)if(this._layers[C].source===l.source&&this._layers[C].canCastShadows()){v=!0;break}y.castsShadows=v}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(let l in this._layers)if(this._layers[l].type===o)return!0;return!1}setLayerZoomRange(o,l,p){this._checkLoaded();let y=this._checkLayer(o);y&&(y.minzoom===l&&y.maxzoom===p||(l!=null&&(y.minzoom=l),p!=null&&(y.maxzoom=p),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,l){this._checkLoaded();let p=this._checkLayer(o);p&&p.slot!==l&&(p.slot=l,this._updateLayer(p))}setFilter(o,l,p={}){this._checkLoaded();let y=this._checkLayer(o);if(y&&!r.bn(y.filter,l))return l==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(_e,`layers.${y.id}.filter`,l,{layerType:y.type},p)||(y.filter=r.cp(l),this._updateLayer(y)))}getFilter(o){let l=this._checkLayer(o);if(l)return r.cp(l.filter)}setLayoutProperty(o,l,p,y={}){this._checkLoaded();let v=this._checkLayer(o);if(v&&!r.bn(v.getLayoutProperty(l),p)){if(p!=null&&(!y||y.validate!==!1)&&$s(v,Se.call(Uo,{key:`layers.${o}.layout.${l}`,layerType:v.type,objectKey:l,value:p,styleSpec:r.a3,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(l,p),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(o,l){let p=this._checkLayer(o);if(p)return p.getLayoutProperty(l)}setPaintProperty(o,l,p,y={}){this._checkLoaded();let v=this._checkLayer(o);if(!v||r.bn(v.getPaintProperty(l),p)||p!=null&&(!y||y.validate!==!1)&&$s(v,De.call(Uo,{key:`layers.${o}.paint.${l}`,layerType:v.type,objectKey:l,value:p,styleSpec:r.a3})))return;let C=v.setPaintProperty(l,p);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),C&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(o,l){let p=this._checkLayer(o);if(p)return p.getPaintProperty(l)}setFeatureState(o,l){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){let{featuresetId:k,importId:N}=o.target,B=this.getFragmentStyle(N),H=B.getFeaturesetLayers(k);for(let{source:U,sourceLayer:q}of H)B.setFeatureState({id:o.id,source:U,sourceLayer:q},l)}else if("layerId"in o.target){let{layerId:k}=o.target,N=this.getLayer(k);this.setFeatureState({id:o.id,source:N.source,sourceLayer:N.sourceLayer},l)}return}let p=o.source,y=o.sourceLayer,v=this._checkSource(p);if(!v)return;let C=v.type;if(C==="geojson"&&y)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(C==="vector"&&!y)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));let D=this.getOwnSourceCaches(p);for(let k of D)k.setFeatureState(y,o.id,l)}removeFeatureState(o,l){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){let{featuresetId:k,importId:N}=o.target,B=this.getFragmentStyle(N),H=B.getFeaturesetLayers(k);for(let{source:U,sourceLayer:q}of H)B.removeFeatureState({id:o.id,source:U,sourceLayer:q},l)}else if("layerId"in o.target){let{layerId:k}=o.target,N=this.getLayer(k);this.removeFeatureState({id:o.id,source:N.source,sourceLayer:N.sourceLayer},l)}return}let p=o.source,y=this._checkSource(p);if(!y)return;let v=y.type,C=v==="vector"?o.sourceLayer:void 0;if(v==="vector"&&!C)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));let D=this.getOwnSourceCaches(p);for(let k of D)k.removeFeatureState(C,o.id,l)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let v;if("featuresetId"in o.target){let{featuresetId:C,importId:D}=o.target,k=this.getFragmentStyle(D),N=k.getFeaturesetLayers(C);for(let{source:B,sourceLayer:H}of N){let U=k.getFeatureState({id:o.id,source:B,sourceLayer:H});if(U&&!v)v=U;else if(!r.bn(v,U))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){let{layerId:C}=o.target,D=this.getLayer(C);v=this.getFeatureState({id:o.id,source:D.source,sourceLayer:D.sourceLayer})}return v}let l=o.source,p=o.sourceLayer,y=this._checkSource(l);if(y){if(y.type!=="vector"||p)return o.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(p,o.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=r.l({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();let o=this.getTerrain(),l=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return r.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(o){for(let l of Object.values(this._mergedLayers))o(l)&&this._updateLayer(l)}_updateLayer(o){this._changes.updateLayer(o);let l=this.getLayerSourceCache(o),p=r.aC(o.source,o.scope),y=this._changes.getUpdatedSourceCaches();o.source&&!y[p]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),l.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){let l=D=>this._mergedLayers[D].is3D(),p=this.order,y={},v=[];for(let D=p.length-1;D>=0;D--){let k=p[D];if(l(k)){y[k]=D;for(let N of o){let B=N[k];if(B)for(let H of B)v.push(H)}}}v.sort((D,k)=>k.intersectionZ-D.intersectionZ);let C=[];for(let D=p.length-1;D>=0;D--){let k=p[D];if(l(k))for(let N=v.length-1;N>=0;N--){let B=v[N].feature;if(B.layer&&y[B.layer.id]<D)break;C.push(B),v.pop()}else for(let N of o){let B=N[k];if(B)for(let H of B)C.push(H.feature)}}return C}queryRenderedFeatures(o,l,p){let y;l&&!Array.isArray(l)&&l.filter&&(this._validate(_e,"queryRenderedFeatures.filter",l.filter,null,l),y=r.aZ(l.filter));let v={},C=B=>{if(yf.has(B.type))return;let H=this.getOwnLayerSourceCache(B),U=v[H.id]=v[H.id]||{sourceCache:H,layers:{},has3DLayers:!1};B.is3D()&&(U.has3DLayers=!0),U.layers[B.fqid]=U.layers[B.fqid]||{styleLayer:B,targets:[]},U.layers[B.fqid].targets.push({filter:y})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(let B of l.layers){let H=this._layers[B];if(!H)return this.fire(new r.y(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];C(H)}}else for(let B in this._layers)C(this._layers[B]);let D=this._queryRenderedFeatures(o,v,p),k=this._flattenAndSortRenderedFeatures(D),N=[];for(let B of k)r.cs(B.layer.id)===this.scope&&N.push(B);return N}queryRenderedFeatureset(o,l,p){let y;l&&!Array.isArray(l)&&l.filter&&(this._validate(_e,"queryRenderedFeatures.filter",l.filter,null,l),y=r.aZ(l.filter));let v="mock",C=[];if(l&&l.target)C.push(lr(cn({},l),{targetId:v,filter:y}));else{let N=this.getFeaturesetDescriptors();for(let B of N)C.push({targetId:v,filter:y,target:B});for(let{style:B}of this.fragments){let H=B.getFeaturesetDescriptors();for(let U of H)C.push({targetId:v,filter:y,target:U})}}let D=this.queryRenderedTargets(o,C,p),k=[];for(let N of D)for(let B of N.variants[v])k.push(new r.cw(N,B));return k}queryRenderedTargets(o,l,p){let y={},v=(D,k,N,B)=>{let H=y[k.id]=y[k.id]||{sourceCache:k,layers:{},has3DLayers:!1};H.layers[D.fqid]=H.layers[D.fqid]||{styleLayer:D,targets:[]},D.is3D()&&(H.has3DLayers=!0),H.layers[D.fqid].targets.push(B?lr(cn({},N),{namespace:B.namespace,properties:B.properties}):N)};for(let D of l)if("featuresetId"in D.target){let{featuresetId:k,importId:N}=D.target,B=this.getFragmentStyle(N),H=B.featuresetSelectors[k];if(!H){this.fire(new r.y(new Error(`The featureset '${k}' does not exist in the map's style and cannot be queried for features.`)));continue}for(let U of H){let q=B.getOwnLayer(U.layerId);q&&!yf.has(q.type)&&v(q,B.getOwnLayerSourceCache(q),D,U)}}else if("layerId"in D.target){let{layerId:k}=D.target,N=this.getLayer(k);if(!N||yf.has(N.type))continue;v(N,this.getLayerSourceCache(N),D)}let C=this._queryRenderedFeatures(o,y,p);return this._flattenAndSortRenderedFeatures(C)}_queryRenderedFeatures(o,l,p){let y=[],v=!!this.map._showQueryGeometry,C=wo.createFromScreenPoints(o,p);for(let D in l){let k=rc(C,l[D],this._availableImages,p,v);Object.keys(k).length&&y.push(k)}if(this.placement)for(let D in l){if(!l[D].sourceCache._onlySymbols)continue;let k=Xc(C.screenGeometry,l[D],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(k).length&&y.push(k)}return y}querySourceFeatures(o,l){let p=l&&l.filter;p&&this._validate(_e,"querySourceFeatures.filter",p,null,l);let y=[],v=this.getOwnSourceCaches(o);for(let C of v)y=y.concat(xi(C,l));return y}addSourceType(o,l,p){return Gs.getSourceType(o)?p(new Error(`A source type called "${o}" already exists.`)):(Gs.setSourceType(o,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:l.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,l,p={}){this._checkLoaded();let y=this.light.getLight(),v=!1;for(let D in o)if(!r.bn(o[D],y[D])){v=!0;break}if(!v)return;let C=this._getTransitionParameters();this.light.setLight(o,l,p),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,l=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=o,y=o.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){let D="terrain-dem-src";this.addSource(D,p.source),p=r.cp(p),p=r.l(p,{source:D})}let v=r.l({},p),C={};if(this.terrain&&y){v.source=this.terrain.get().source;let D=this.terrain?this.getFragmentStyle(this.terrain.scope):null;D&&(C.style=D.serialize())}if(this._validate(Yc,"terrain",v,C))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l),this.fire(new r.z("data",{dataType:"style"}))}else{let v=this.terrain,C=v.get();for(let D of Object.keys(r.a3.terrain))!p.hasOwnProperty(D)&&r.a3.terrain[D].default&&(p[D]=r.a3.terrain[D].default);for(let D in o)if(!r.bn(o[D],C[D])){v.set(o,this.options),this.stylesheet.terrain=o;let k=this._getTransitionParameters({duration:0});v.updateTransitions(k),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){let l=this.fog=new ki(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();let p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_createSnow(o){let l=this.snow=new qr(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();let p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_createRain(o){let l=this.rain=new Ho(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();let p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let l=this.fog;if(!r.bn(l.get(),o)){l.set(o,this.options),this.stylesheet.fog=l.get();let p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){let l=this.snow;if(!r.bn(l.get(),o)){l.set(o,this.options),this.stylesheet.snow=l.get();let p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){let l=this.rain;if(!r.bn(l.get(),o)){l.set(o,this.options),this.stylesheet.rain=l.get();let p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){let o=()=>{for(let y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(let y in this._sourceCaches)this._sourceCaches[y].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void o();let p=this._evaluateColorThemeData(l);this._loadColorTheme(p).then(()=>{this.fire(new r.z("colorthemeset")),o()}).catch(y=>{r.w(`Couldn't set color theme: ${y}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,l){let p=this.getFragmentStyle(o);p&&(p._styleColorTheme.colorThemeOverride=l,p._reloadColorTheme())}_getTransitionParameters(o){return{now:r.q.now(),transition:r.l(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;let o=[],l=[];for(let p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?o.push(p):l.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...l)}_createTerrain(o,l){let p=this.terrain=new ot(o,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let y=this._getTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(let o in this._layers){let l=this._layers[o];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(let o in this._layers){let l=this._layers[o];l.type==="symbol"&&this._updateLayer(l)}}_validate(o,l,p,y,v={}){if(v&&v.validate===!1)return!1;let C=r.l({},this.serialize());return $s(this,o.call(Uo,r.l({key:l,style:C,value:p,styleSpec:r.a3},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(let o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(o){let l=this.getSourceCaches(o);for(let p of l)p.clearTiles()}clearSources(){for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}reloadSource(o){let l=this.getSourceCaches(o);for(let p of l)p.resume(),p.reload()}reloadSources(){for(let o of this.getSources())o.reload&&o.reload()}updateSources(o){let l;this.directionalLight&&(l=Nl(this.directionalLight));for(let p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(o,void 0,void 0,l)}_generateCollisionBoxes(){for(let o in this._sourceCaches){let l=this._sourceCaches[o];l.resume(),l.reload()}}_updatePlacement(o,l,p,y,v,C,D=!1){let k=!1,N=!1,B={},H={};for(let U of this._mergedOrder){let q=this._mergedLayers[U];if(q.type!=="symbol")continue;let ee=r.aC(q.source,q.scope),Q=B[ee];if(!Q){let re=this.getLayerSourceCache(q);if(!re)continue;let ue=re.getRenderableIds(!0).map(ge=>re.getTileByID(ge));H[ee]=ue.slice(),Q=B[ee]=ue.sort((ge,pe)=>pe.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(pe.tileID)?-1:1))}let ie=this.crossTileSymbolIndex.addLayer(q,Q,l.center.lng,l.projection);k=k||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),D=D||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),l.zoom))&&(this.pauseablePlacement=new Ll(l,this._mergedOrder,D,p,y,v,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,H,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),N=!0),k&&this.pauseablePlacement.placement.setStale()),N||k){this._buildingIndex.onNewFrame(l.zoom);for(let U=0;U<this._mergedOrder.length;U++){let q=this._mergedLayers[this._mergedOrder[U]];if(q.type!=="symbol")continue;let ee=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,B[r.aC(q.source,q.scope)],U,ee?C:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(let o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,l){this._checkLoaded();let p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:v})=>v===o.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!l)return p.push(o),this._loadImports([o],!0);let y=p.findIndex(({id:v})=>v===l);return y===-1&&this.fire(new r.y(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,y).concat(o).concat(p.slice(y)),this._loadImports([o],!0,l)}updateImport(o,l){this._checkLoaded();let p=this.stylesheet.imports||[],y=this.getImportIndex(o);return y===-1?this:typeof l=="string"?(this.setImportUrl(o,l),this):(l.url&&l.url!==p[y].url&&this.setImportUrl(o,l.url),r.bn(l.config,p[y].config)||this.setImportConfig(o,l.config),r.bn(l.data,p[y].data)||this.setImportData(o,l.data),this)}moveImport(o,l){this._checkLoaded();let p=this.stylesheet.imports||[],y=this.getImportIndex(o);if(y===-1)return this;let v=this.getImportIndex(l);if(v===-1)return this;let C=p[y],D=this.fragments[y];return p=p.filter(({id:k})=>k!==o),this.fragments=this.fragments.filter(({id:k})=>k!==o),this.stylesheet.imports=p.slice(0,v).concat(C).concat(p.slice(v)),this.fragments=this.fragments.slice(0,v).concat(D).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(o,l){this._checkLoaded();let p=this.stylesheet.imports||[],y=this.getImportIndex(o);if(y===-1)return this;p[y].url=l;let v=this.fragments[y];return v.style=this._createFragmentStyle(p[y]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(l),this}setImportData(o,l){this._checkLoaded();let p=this.getImportIndex(o),y=this.stylesheet.imports||[];return p===-1?this:l?(this.fragments[p].style.setState(l),this._reloadImports(),this):(delete y[p].data,this.setImportUrl(o,y[p].url))}setImportConfig(o,l){this._checkLoaded();let p=this.getImportIndex(o),y=this.stylesheet.imports||[];if(p===-1)return this;l?y[p].config=l:delete y[p].config;let v=this.fragments[p],C=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=l,v.style.updateConfig(l,C),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();let l=this.stylesheet.imports||[],p=this.getImportIndex(o);p!==-1&&(l.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(o){let l=(this.stylesheet.imports||[]).findIndex(p=>p.id===o);return l===-1&&this.fire(new r.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),l}getLayer(o){return this._mergedLayers[o]}getSources(){let o=[];for(let l in this._mergedOtherSourceCaches){let p=this._mergedOtherSourceCaches[l];p&&o.push(p.getSource())}return o}getSource(o,l){let p=this.getSourceCache(o,l);return p&&p.getSource()}getLayerSource(o){let l=this.getLayerSourceCache(o);return l&&l.getSource()}getSourceCache(o,l){let p=r.aC(o,l);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(o){let l=r.aC(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);let l=[];return this._mergedOtherSourceCaches[o]&&l.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&l.push(this._mergedSymbolSourceCaches[o]),l}updateSourceCaches(){let o=this._changes.getUpdatedSourceCaches();for(let l in o){let p=o[l];p==="reload"?this.reloadSource(l):p==="clear"&&this.clearSource(l)}}updateLayers(o){let l=this._changes.getUpdatedPaintProperties();for(let p of l){let y=this.getLayer(p);y&&y.updateTransitions(o)}}getImages(o,l,p){this.imageManager.getImages(l.icons,l.scope,p),this._updateTilesForChangedImages();let y=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};y(this._otherSourceCaches[l.source]),y(this._symbolSourceCaches[l.source])}rasterizeImages(o,l,p){this.imageManager.rasterizeImages(l,p)}getGlyphs(o,l,p){this.glyphManager.getGlyphs(l.stacks,l.scope,p)}getResource(o,l,p){return r.cy(l,p)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){let l=[];return this._otherSourceCaches[o]&&l.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&l.push(this._symbolSourceCaches[o]),l}_isSourceCacheLoaded(o){let l=this.getOwnSourceCaches(o);return l.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${o}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,l){if(!this._clipLayerPresent&&o.type!=="fill-extrusion")return!1;let p=o.type==="fill-extrusion"&&o.sourceLayer==="building";if(o.is3D()){if(p||l&&l.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Gs.getSourceType=function(f){return Aa[f]},Gs.setSourceType=function(f,o){Aa[f]=o},Gs.registerForPluginStateChange=r.ch;var Ku=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,xf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,bf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ts="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",zl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Zh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ua=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Wh=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Yh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,pc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ka=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let mc=[];ol(Ku,mc),ol(bf,mc),ol(xf,mc);let qs={"_prelude_fog.vertex.glsl":Zh,"_prelude_terrain.vertex.glsl":zl,"_prelude_shadow.vertex.glsl":pc,"_prelude_fog.fragment.glsl":ua,"_prelude_shadow.fragment.glsl":ka,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Wh,"_prelude_raster_particle.glsl":Yh},La={};Qn("",zl),Qn(ua,Zh),Qn(ka,pc),Qn(Wh,""),Qn(Yh,"");let ou=Qn(xf,bf),Xh=Ku;var ha={background:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Qn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Qn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Qn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Qn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Qn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Qn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Qn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Qn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Qn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Qn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec2 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
halfwidth=(u_width_scale*a_z_offset_width.y)/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec2 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Qn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Qn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Qn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Qn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Qn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Qn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ts),skyboxGradient:Qn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ts),skyboxCapture:Qn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Qn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Qn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Qn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Qn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Qn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Qn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Qn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ol(f,o){let l=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let y=p.split(" ");for(let v of y)o.includes(v)||o.push(v)}}function Qn(f,o){let l=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,y=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);y&&(y=y.map(N=>{let B=N.split(" ");return B[B.length-1]}),y=[...new Set(y)]);let v={},C=[],D=[];if(f=f.replace(l,(N,B)=>(D.push(B),"")),(o=o.replace(l,(N,B)=>(C.push(B),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let k=[...mc];ol(f,k),ol(o,k);for(let N of[...C,...D])qs[N]||console.error(`Undefined include: ${N}`),La[N]||(La[N]=[],ol(qs[N],La[N])),k=[...k,...La[N]];return{fragmentSource:f=f.replace(p,(N,B,H,U,q)=>(v[q]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${H} ${U} ${q};
#else
uniform ${H} ${U} u_${q};
#endif
`:B==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${H} ${U} ${q} = u_${q};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${H} ${U} ${q};
#endif
`:B==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(p,(N,B,H,U,q)=>{let ee=U==="float"?"vec2":U,Q=q.match(/color/)?"color":ee;return B==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${H} ${U} a_${q};
#endif
`:v[q]?B==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${H} ${ee} a_${q};
out ${H} ${U} ${q};
#else
uniform ${H} ${U} u_${q};
#endif
`:B==="initialize"?Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${H} ${U} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${Q}(a_${q}, u_${q}_t);
#else
    ${H} ${U} ${q} = u_${q};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${H} ${U} a_${q};
    out ${H} ${U} ${q};
#endif
`:B==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:B==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${H} ${ee} a_${q};
#else
uniform ${H} ${U} u_${q};
#endif
`:B==="define-instanced"?Q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${H} ${U} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${H} ${ee} a_${q};
#else
uniform ${H} ${U} u_${q};
#endif
`:B==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${H} ${U} ${q} = a_${q};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${H} ${U} ${q} = a_${q};
#else
    ${H} ${U} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${H} ${U} ${q} = unpack_mix_${Q}(a_${q}, u_${q}_t);
#else
    ${H} ${U} ${q} = u_${q};
#endif
`}),staticAttributes:y,usedDefines:k,vertexIncludes:C,fragmentIncludes:D}}class sl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,l,p,y,v,C,D,k){this.context=o;let N=this.boundPaintVertexBuffers.length!==y.length;for(let H=0;!N&&H<y.length;H++)this.boundPaintVertexBuffers[H]!==y[H]&&(N=!0);let B=this.boundDynamicVertexBuffers.length!==D.length;for(let H=0;!B&&H<D.length;H++)this.boundDynamicVertexBuffers[H]!==D[H]&&(B=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||N||B||this.boundIndexBuffer!==v||this.boundVertexOffset!==C)this.freshBind(l,p,y,v,C,D,k);else{o.bindVertexArrayOES.set(this.vao);for(let H of D)H&&(H.bind(),k&&H.instanceCount&&H.setVertexAttribDivisor(o.gl,l,k));v&&v.dynamicDraw&&v.bind()}}freshBind(o,l,p,y,v,C,D){let k=o.numAttributes,N=this.context,B=N.gl;this.vao&&this.destroy(),this.vao=N.gl.createVertexArray(),N.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=C,l.enableAttributes(B,o),l.bind(),l.setVertexAttribPointers(B,o,v);for(let H of p)H.enableAttributes(B,o),H.bind(),H.setVertexAttribPointers(B,o,v);for(let H of C)H&&(H.enableAttributes(B,o),H.bind(),H.setVertexAttribPointers(B,o,v),D&&H.instanceCount&&H.setVertexAttribDivisor(B,o,D));y&&y.bind(),N.currentNumAttributes=k}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Kp(f,o){let l=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new r.aa(0,p/l).toLngLat().lat,new r.aa(0,(p+1)/l).toLngLat().lat]}function Ju(f,o,l,p,y,v,C){let D=f.context,k=D.gl,N=l.hillshadeFBO;if(!N)return;f.prepareDrawTile();let B=f.isTileAffectedByFog(o),H=f.getOrCreateProgram("hillshade",{overrideFog:B});D.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,N.colorAttachment.get());let U=((ie,re,ue,ge)=>{let pe=ue.paint.get("hillshade-shadow-color"),we=ue.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",xe=ue.paint.get("hillshade-highlight-color"),be=ue.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ve=ue.paint.get("hillshade-accent-color"),Ie=ue.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Re=ue.paint.get("hillshade-emissive-strength"),Ye=r.ai(ue.paint.get("hillshade-illumination-direction"));if(ue.paint.get("hillshade-illumination-anchor")==="viewport")Ye-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){let Ae=ie.style.directionalLight.properties.get("direction"),ze=r.cb(Ae.x,Ae.y,Ae.z);Ye=r.ai(ze[1])}let $e=!ie.options.moving;return{u_matrix:ge||ie.transform.calculateProjMatrix(re.tileID.toUnwrapped(),$e),u_image:0,u_latrange:Kp(0,re.tileID),u_light:[ue.paint.get("hillshade-exaggeration"),Ye],u_shadow:pe.toRenderColor(we?null:ue.lut),u_highlight:xe.toRenderColor(be?null:ue.lut),u_emissive_strength:Re,u_accent:ve.toRenderColor(Ie?null:ue.lut)}})(f,l,p,f.terrain?o.projMatrix:null);f.uploadCommonUniforms(D,H,o.toUnwrapped());let{tileBoundsBuffer:q,tileBoundsIndexBuffer:ee,tileBoundsSegments:Q}=f.getTileBoundsBuffers(l);H.draw(f,k.TRIANGLES,y,v,C,yn.disabled,U,p.id,q,ee,Q)}function gc(f,o,l){if(!o.needsDEMTextureUpload)return;let p=f.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||f.getTileTexture(l.stride);let v=l.getPixels();o.demTexture?o.demTexture.update(v,{premultiply:!1}):o.demTexture=new r.T(p,v,y.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function _c(f,o,l){let p=f.context,y=p.gl;if(!o.dem)return;let v=o.dem;if(p.activeTexture.set(y.TEXTURE1),gc(f,o,v),!o.demTexture)return;o.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);let C=v.dim;p.activeTexture.set(y.TEXTURE0);let D=o.hillshadeFBO;if(!D){let U=new r.T(p,{width:C,height:C,data:null},y.RGBA8);U.bind(y.LINEAR,y.CLAMP_TO_EDGE),D=o.hillshadeFBO=p.createFramebuffer(C,C,!0,"renderbuffer"),D.colorAttachment.set(U.texture)}p.bindFramebuffer.set(D.framebuffer),p.viewport.set([0,0,C,C]);let{tileBoundsBuffer:k,tileBoundsIndexBuffer:N,tileBoundsSegments:B}=f.getMercatorTileBoundsBuffers(),H=[];f.linearFloatFilteringSupported()&&H.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:H}).draw(f,y.TRIANGLES,an.disabled,Sn.disabled,$n.unblended,yn.disabled,((U,q)=>{let ee=q.stride,Q=r.ab.mat4.create();return r.ab.mat4.ortho(Q,0,r.ag,-r.ag,0,0,1),r.ab.mat4.translate(Q,Q,[0,-r.ag,0]),{u_matrix:Q,u_image:1,u_dimension:[ee,ee],u_zoom:U.overscaledZ}})(o.tileID,v),l.id,k,N,B),o.needsHillshadePrepare=!1}class Yi{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class h_ extends Yi{getDefault(){return r.aj.transparent}set(o){let l=this.current;(o.r!==l.r||o.g!==l.g||o.b!==l.b||o.a!==l.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Jp extends Yi{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Qp extends Yi{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Kh extends Yi{getDefault(){return[!0,!0,!0,!0]}set(o){let l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||o[3]!==l[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Jh extends Yi{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Qh extends Yi{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class wf extends Yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){let l=this.current;(o.func!==l.func||o.ref!==l.ref||o.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Cf extends Yi{getDefault(){let o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){let l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Mf extends Yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;o?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=o,this.dirty=!1}}class d_ extends Yi{getDefault(){return[0,1]}set(o){let l=this.current;(o[0]!==l[0]||o[1]!==l[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class _ extends Yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;o?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=o,this.dirty=!1}}class S extends Yi{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class z extends Yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;o?l.enable(l.BLEND):l.disable(l.BLEND),this.current=o,this.dirty=!1}}class Y extends Yi{getDefault(){let o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){let l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||o[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ne extends Yi{getDefault(){return r.aj.transparent}set(o){let l=this.current;(o.r!==l.r||o.g!==l.g||o.b!==l.b||o.a!==l.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ye extends Yi{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Ge extends Yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;o?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=o,this.dirty=!1}}class ht extends Yi{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class bt extends Yi{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let Zt=class extends Yi{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class vn extends Yi{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class ei extends Yi{getDefault(){let o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){let l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||o[3]!==l[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Pi extends Yi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Go extends Yi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Mo extends Yi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.bindTexture(l.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class zo extends Yi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ps extends Yi{getDefault(){return null}set(o){let l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class su extends Yi{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class f_ extends Yi{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class p_ extends Yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class m_ extends Yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ed extends Yi{constructor(o,l){super(o),this.context=o,this.parent=l}getDefault(){return null}}class Tf extends ed{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Qu extends ed{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class lo extends ed{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class al extends Qu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let em=(f,o,l)=>({u_matrix:f,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:l}),Ef=(f,o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:y,u_merc_center:v,u_image0:0,u_frustum_tl:C,u_frustum_tr:D,u_frustum_br:k,u_frustum_bl:N,u_globe_pos:B,u_globe_radius:H,u_viewport:U,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:ee});function Sf(f,o){return f!=null&&o!=null&&!(!f.hasData()||!o.hasData())&&f.demTexture!=null&&o.demTexture!=null&&f.tileID.key!==o.tileID.key}let Fa=new class{constructor(){this.operations={}}newMorphing(f,o,l,p,y){if(f in this.operations){let v=this.operations[f];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[f]={startTime:p,phase:0,duration:y,from:o,to:l,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;let o=this.operations[f];return{from:o.from,to:o.to,phase:o.phase}}update(f){for(let o in this.operations){let l=this.operations[o];for(l.phase=(f-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,f)){delete this.operations[o];break}}}_nextOp(f,o){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=o,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},ll={0:null,1:"TERRAIN_VERTEX_MORPHING"};function If(f,o,l){if(o===0)return 0;let p=o<1&&l===514?.25/o:1;return 6*Math.pow(1.5,22-f)*Math.max(o,1)*p}function au(f,o){let l=1<<f.z;return!o&&(f.x===0||f.x===l-1)||f.y===0||f.y===l-1}let Pf=f=>({u_matrix:f});function td(f,o,l,p,y){if(y>0){let v=r.q.now(),C=(v-f.timeAdded)/y,D=o?(v-o.timeAdded)/y:-1,k=l.getSource(),N=p.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),B=!o||Math.abs(o.tileID.overscaledZ-N)>Math.abs(f.tileID.overscaledZ-N),H=B&&f.refreshedUponExpiration?1:r.aw(B?C:1-D,0,1);return f.refreshedUponExpiration&&C>=1&&(f.refreshedUponExpiration=!1),o?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class yv extends ls{constructor(o){let l={type:"raster-dem",maxzoom:o.transform.maxZoom},p=new r.D(r.ci(),null),y=Dl("mock-dem",l,p,o.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,l){o.state="loaded",l(null)}}class vv extends ls{constructor(o){let l=Dl("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new r.D(r.ci(),null),o.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,l,p){if(o.freezeTileCoverage)return;this.transform=o;let y=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,C)=>{if(v[C.key]="",!this._tiles[C.key]){let D=new Bs(C,this._source.tileSize*C.overscaleFactor(),o.tileZoom);D.state="loaded",this._tiles[C.key]=D}return v},{});for(let v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(o){let l=this.proxyCachedFBO[o];if(l!==void 0){let p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class tm extends r.aG{constructor(o,l,p){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class nm extends r.cJ{constructor(o,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[p,y,v]=function(k){let N=new r.b4,B=new r.aU,H=131;N.reserve(17161),B.reserve(33800);let U=r.ag/128,q=r.ag+U/2,ee=q+U;for(let ie=-U;ie<ee;ie+=U)for(let re=-U;re<ee;re+=U){let ue=re<0||re>q||ie<0||ie>q?24575:0,ge=r.aw(Math.round(re),0,r.ag),pe=r.aw(Math.round(ie),0,r.ag);N.emplaceBack(ge+ue,pe)}let Q=(ie,re)=>{let ue=re*H+ie;B.emplaceBack(ue+1,ue,ue+H),B.emplaceBack(ue+H,ue+H+1,ue+1)};for(let ie=1;ie<129;ie++)for(let re=1;re<129;re++)Q(re,ie);return[0,129].forEach(ie=>{for(let re=0;re<130;re++)Q(re,ie),Q(ie,re)}),[N,B,32768]}(),C=o.context;this.gridBuffer=C.createVertexBuffer(p,r.b6.members),this.gridIndexBuffer=C.createIndexBuffer(y),this.gridSegments=r.b7.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=r.b7.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vv(l.map),this.orthoMatrix=r.ab.mat4.create(),r.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.ag,0,r.ag,0,1);let D=C.gl;this._overlapStencilMode=new Sn({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new yv(l.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,l,p){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);let y=o.terrain.properties,v=o.terrain.drapeRenderMode===0,C=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();let D=o.terrain&&o.terrain.scope,k=y.get("source"),N=v?this._mockSourceCache:o.getSourceCache(k,D);if(!N)return void r.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=N,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=C?this.calculateExaggeration(l):y.get("exaggeration"),!l.projection.requiresDraping&&C&&this._exaggeration===0)return void this._disable();this.enabled=!0;let B=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let H=this.getScaledDemTileSize();this.sourceCache.update(l,H,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);let l=this._previousCameraAltitude,p=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=p;let y=l!=null?p-l:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;let v=o.zoom,C=this._style.terrain;if(!this._previousUpdateTimestamp)return C.getExaggeration(v);let D=v-this._previousZoom,k=this._previousUpdateTimestamp,N=v;this._evaluationZoom!=null&&(N=this._evaluationZoom,Math.abs(v-N)>.5&&(D=.5*(v-N+D)),D*y<0&&(N+=D)),this._evaluationZoom=N;let B=C.getExaggeration(N),H=B===C.getExaggeration(Math.max(0,N-.1));if(H&&Math.abs(B-this._exaggeration)<.01)return B;let U=Math.min(.1,.00375*(this._updateTimestamp-k));return(H||B<.1||Math.abs(D)<1e-4)&&(U=Math.min(.2,4*U)),r.af(this._exaggeration,B,U)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(r.aa.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let y=this.proxyCoords=l.getIds().map(k=>{let N=l.getTileByID(k).tileID;return N.projMatrix=p.calculateProjMatrix(N.toUnwrapped()),N});(function(k,N){let B=N.transform.pointCoordinate(N.transform.getCameraPoint()),H=new r.P(B.x,B.y);k.sort((U,q)=>{if(q.overscaledZ-U.overscaledZ)return q.overscaledZ-U.overscaledZ;let ee=new r.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Q=new r.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ie=H.mult(1<<U.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(ee)-ie.distSqr(Q)})})(y,this.painter);let v=this.proxyToSource||{};this.proxyToSource={},y.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};let C=this._style._mergedSourceCaches;for(let k in C){let N=C[k];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,o[k],v),N.usedForTerrain))continue;let B=o[k];N.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[l.id]=y.map(k=>new tm(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;let D={};this._visibleDemTiles=[];for(let k of this.proxyCoords){let N=this.terrainTileForTile[k.key];if(!N)continue;let B=N.tileID.key;B in D||(this._visibleDemTiles.push(N),D[B]=B)}}_assignTerrainTiles(o){this._initializing||o.forEach(l=>{if(this.terrainTileForTile[l.key])return;let p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){let o=this.painter.context,l=o.gl;for(let p in this.terrainTileForTile){let y=this.terrainTileForTile[p],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(o.activeTexture.set(l.TEXTURE1),gc(this.painter,y,v))}}_prepareDemTileUniforms(o,l,p,y){if(!l||l.demTexture==null)return!1;let v=o.tileID.canonical,C=Math.pow(2,l.tileID.canonical.z-v.z),D=y||"";return p[`u_dem_tl${D}`]=[v.x*C%1,v.y*C%1],p[`u_dem_scale${D}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0,l=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;let v=y.dem.tree.minimums[0];return v>0&&o++,p+v},0);return o?l/o:0}_updateEmptyDEMTexture(){let o=this.painter.context,l=o.gl;o.activeTexture.set(l.TEXTURE2);let p=this._getLoadedAreaMinimum(),y=new r.cK({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new r.T(o,y,l.R32F,{premultiply:!1}),v}setupElevationDraw(o,l,p){let y=this.painter.context,v=y.gl,C={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};C.u_exaggeration=this.exaggeration();let D=null,k=null,N=1;if(p&&p.morphing&&this._useVertexMorphing){let q=p.morphing.srcDemTile,ee=p.morphing.dstDemTile;N=p.morphing.phase,q&&ee&&(this._prepareDemTileUniforms(o,q,C,"_prev")&&(k=q),this._prepareDemTileUniforms(o,ee,C)&&(D=ee))}let B=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST,H=null;var U;if(this.enabled?k&&D?(H=D.demTexture,y.activeTexture.set(v.TEXTURE4),k.demTexture.bind(B(k),v.CLAMP_TO_EDGE),C.u_dem_lerp=N):(D=this.terrainTileForTile[o.tileID.key],H=this._prepareDemTileUniforms(o,D,C)?D.demTexture:this.emptyDEMTexture):H=this.emptyDEMTexture,y.activeTexture.set(v.TEXTURE2),H&&(C.u_dem_size=(U=H).size[0]===1?1:U.size[0]-2,H.bind(B(D),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,l,C),p&&p.useMeterToDem&&D){let q=(1<<D.tileID.canonical.z)*r.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=q}if(p&&p.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(y,C),this.painter.transform.projection.name==="globe"){let q=this.globeUniformValues(this.painter.transform,o.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(y,q)}}globeUniformValues(o,l,p){let y=o.projection;return{u_tile_tl_up:y.upVector(l,0,0),u_tile_tr_up:y.upVector(l,r.ag,0),u_tile_br_up:y.upVector(l,r.ag,r.ag),u_tile_bl_up:y.upVector(l,0,r.ag),u_tile_up_scale:p?r.cL(1):y.upVectorScale(l,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){let l=this.painter,p=this.painter.context;o.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,v,C,D,k){if(y.transform.projection.name==="globe")(function(N,B,H,U,q){let ee=N.context,Q=ee.gl,ie,re,ue=N.transform,ge=r.cC(N,ee,ue),pe=(Ae,ze)=>{if(re===ze)return;let at=[ll[ze],"PROJECTION_GLOBE_VIEW"];ge&&at.push("CUSTOM_ANTIALIASING");let gt=N.isTileAffectedByFog(Ae);ie=N.getOrCreateProgram("globeRaster",{defines:at,overrideFog:gt}),re=ze},we=N.colorModeForRenderPass(),xe=new an(Q.LEQUAL,an.ReadWrite,N.depthRangeFor3D);Fa.update(q);let be=r.cD(ue),ve=[r.at(ue.center.lng),r.aA(ue.center.lat)],Ie=N.globeSharedBuffers,Re=[ue.width*r.q.devicePixelRatio,ue.height*r.q.devicePixelRatio],Ye=Float32Array.from(ue.globeMatrix),$e={useDenormalizedUpVectorScale:!0};{let Ae=N.transform,ze=If(Ae.zoom,B.exaggeration(),B.sourceCache._source.tileSize);re=-1;let at=Q.TRIANGLES;for(let gt of U){let St=H.getTile(gt),Ve=Sn.disabled,dt=B.prevTerrainTileForTile[gt.key],et=B.terrainTileForTile[gt.key];Sf(dt,et)&&Fa.newMorphing(gt.key,dt,et,q,250),ee.activeTexture.set(Q.TEXTURE0),St.texture&&St.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let Ct=Fa.getMorphValuesForProxy(gt.key),pt=Ct?1:0;Ct&&r.J($e,{morphing:{srcDemTile:Ct.from,dstDemTile:Ct.to,phase:r.cB(Ct.phase)}});let lt=r.cE(gt.canonical),Nt=r.cF(lt.getCenter().lat),Ht=r.cG(gt.canonical,lt,Nt,Ae.worldSize/Ae._pixelsPerMercatorPixel),Lt=r.bb(r.cH(gt.canonical)),Wt=Ef(Ae.expandedFarZProjMatrix,Ye,be,Lt,r.ae(Ae.zoom),ve,Ae.frustumCorners.TL,Ae.frustumCorners.TR,Ae.frustumCorners.BR,Ae.frustumCorners.BL,Ae.globeCenterInViewSpace,Ae.globeRadius,Re,ze,Ae._farZ,Ht);if(pe(gt,pt),ie&&(B.setupElevationDraw(St,ie,$e),N.uploadCommonUniforms(ee,ie,gt.toUnwrapped()),Ie)){let[Tn,hn,un]=Ie.getGridBuffers(Nt,ze!==0);ie.draw(N,at,xe,Ve,we,yn.backCCW,Wt,"globe_raster",Tn,hn,un)}}}if(Ie&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){let Ae=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&Ae.push("CUSTOM_ANTIALIASING"),ie=N.getOrCreateProgram("globeRaster",{defines:Ae});for(let ze of U){let{x:at,y:gt,z:St}=ze.canonical,Ve=gt===0,dt=gt===(1<<St)-1,[et,Ct,pt,lt]=Ie.getPoleBuffers(St,!1);if(lt&&(Ve||dt)){let Nt=H.getTile(ze);ee.activeTexture.set(Q.TEXTURE0),Nt.texture&&Nt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let Ht=r.cI(St,at,ue),Lt=r.bb(r.cH(ze.canonical)),Wt=(Tn,hn)=>Tn.draw(N,Q.TRIANGLES,xe,Sn.disabled,we,yn.disabled,Ef(ue.expandedFarZProjMatrix,Ht,Ht,Lt,0,ve,ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.globeCenterInViewSpace,ue.globeRadius,Re,0,ue._farZ),"globe_pole_raster",hn,pt,lt);B.setupElevationDraw(Nt,ie,$e),N.uploadCommonUniforms(ee,ie,ze.toUnwrapped()),Ve&&N.renderDefaultNorthPole&&Wt(ie,et),dt&&N.renderDefaultSouthPole&&(Ht=r.ab.mat4.scale(r.ab.mat4.create(),Ht,[1,-1,1]),Wt(ie,Ct))}}}})(y,v,C,D,k);else{let N=y.context,B=N.gl,H,U,q=y.shadowRenderer,ee=nl(y,y.longestCutoffRange),Q=we=>{if(U===we)return;let xe=[];xe.push(ll[we]),ee.shouldRenderCutoff&&xe.push("RENDER_CUTOFF"),q&&(xe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&xe.push("NORMAL_OFFSET")),H=y.getOrCreateProgram("terrainRaster",{defines:xe}),U=we},ie=y.colorModeForRenderPass(),re=new an(B.LEQUAL,an.ReadWrite,y.depthRangeFor3D);Fa.update(k);let ue=y.transform,ge=If(ue.zoom,v.exaggeration(),v.sourceCache._source.tileSize),pe=[0,0,0];if(q){let we=y.style.directionalLight,xe=y.style.ambientLight;we&&xe&&(pe=fs(y.style,we,xe))}{U=-1;let we=B.TRIANGLES,[xe,be]=[v.gridIndexBuffer,v.gridSegments];for(let ve of D){let Ie=C.getTile(ve),Re=Sn.disabled,Ye=v.prevTerrainTileForTile[ve.key],$e=v.terrainTileForTile[ve.key];Sf(Ye,$e)&&Fa.newMorphing(ve.key,Ye,$e,k,250),N.activeTexture.set(B.TEXTURE0),Ie.texture&&Ie.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);let Ae=Fa.getMorphValuesForProxy(ve.key),ze=Ae?1:0,at;Ae&&(at={morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:r.cB(Ae.phase)}});let gt=em(ve.projMatrix,au(ve.canonical,ue.renderWorldCopies)?ge/10:ge,pe);if(Q(ze),!H)continue;v.setupElevationDraw(Ie,H,at);let St=ve.toUnwrapped();q&&q.setupShadows(St,H),y.uploadCommonUniforms(N,H,St,null,ee),H.draw(y,we,re,Re,ie,yn.backCCW,gt,"terrain_raster",v.gridBuffer,xe,be)}}}}(l,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;let l=this.painter,p=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],C=this._drapedRenderBatches.shift(),D=l.style.order,k=[],N=0;for(let B of v){let H=y.getTileByID(B.proxyTileKey),U=y.proxyCachedFBO[B.key]?y.proxyCachedFBO[B.key][o]:void 0,q=U!==void 0?y.renderCache[U]:this.pool[N++],ee=U!==void 0;if(H.texture=q.tex,ee&&!q.dirty){k.push(H.tileID);continue}let Q;p.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(p.clear({color:r.aj.transparent,stencil:0}),q.dirty=!1);for(let ie=C.start;ie<=C.end;++ie){let re=l.style._mergedLayers[D[ie]];if(re.isHidden(l.transform.zoom))continue;let ue=l.style.getLayerSourceCache(re),ge=ue?this.proxyToSource[B.key][ue.id]:[B];if(!ge)continue;let pe=ge;p.viewport.set([0,0,q.fb.width,q.fb.height]),Q!==(ue?ue.id:null)&&(this._setupStencil(q,ge,re,ue),Q=ue?ue.id:null),l.renderLayer(l,ue,re,pe)}if(this._drapedRenderBatches.length===0)for(let ie of this._pendingGroundEffectLayers){let re=l.style._mergedLayers[D[ie]];if(re.isHidden(l.transform.zoom))continue;let ue=l.style.getLayerSourceCache(re),ge=ue?this.proxyToSource[B.key][ue.id]:[B];if(!ge)continue;let pe=ge;p.viewport.set([0,0,q.fb.width,q.fb.height]),Q!==(ue?ue.id:null)&&(this._setupStencil(q,ge,re,ue),Q=ue?ue.id:null),l.renderLayer(l,ue,re,pe)}this.renderedToTile?(q.dirty=!0,k.push(H.tileID)):ee||--N,N===5&&(N=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),C.end+1}postRender(){}isLayerOrderingCorrect(o){let l=o.order.length,p=-1,y=l;for(let v=0;v<l;++v)this._style.isLayerDraped(o._mergedLayers[o.order[v]])?p=Math.max(p,v):y=Math.min(y,v);return y>p}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{o=Math.min(o,l.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,l,p){if(!this._visibleDemTiles)return null;let y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{let C=v.tileID,D=1<<C.overscaledZ,{x:k,y:N}=C.canonical,B=k/D,H=(k+1)/D,U=N/D,q=(N+1)/D;return{minx:B,miny:U,maxx:H,maxy:q,t:v.dem.tree.raycastRoot(B,U,H,q,o,l,p),tile:v}});y.sort((v,C)=>(v.t!==null?v.t:Number.MAX_VALUE)-(C.t!==null?C.t:Number.MAX_VALUE));for(let v of y){if(v.t==null)return null;let C=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,o,l,p);if(C!=null)return C}return null}_createFBO(){let o=this.painter.context,l=o.gl,p=this.drapeBufferSize;o.activeTexture.set(l.TEXTURE0);let y=new r.T(o,{width:p[0],height:p[1],data:null},l.RGBA8);y.bind(l.LINEAR,l.CLAMP_TO_EDGE);let v=o.createFramebuffer(p[0],p[1],!0,null);return v.colorAttachment.set(y.texture),v.depthAttachment=new al(o,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{let l=this._style._mergedLayers[o],p=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(let p of this._style.getSources())if(p instanceof Pl){o=!0;break}if(!o)return;let l={};for(let p=0;p<this._style.order.length;++p){let y=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(y);if(v&&!l[v.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof r.a9){l[v.id]=!0;for(let C of this.proxyCoords){let D=this.proxyToSource[C.key][v.id];if(D)for(let k of D)this._clearRenderCacheForTile(v.id,k)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(let p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Ni){o=!0;break}if(!o)return;let l={};for(let p=0;p<this._style.order.length;++p){let y=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(y);if(!v||l[v.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;let C=y.paint.get("raster-fade-duration");for(let D of this.proxyCoords){let k=this.proxyToSource[D.key][v.id];if(k)for(let N of k){let B=td(v.getTile(N),v.findLoadedParent(N,0),v,this.painter.transform,C);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(v.id,N)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();let o=this._style.order,l=o.length;if(l===0)return;let p=[];this._pendingGroundEffectLayers=[];let y,v=0,C=this._style._mergedLayers[o[v]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++v<l;)C=this._style._mergedLayers[o[v]];for(;v<l;++v){let D=this._style._mergedLayers[o[v]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?y===void 0&&(y=v):(D.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),y!==void 0&&(p.push({start:y,end:v-1}),y=void 0)))}if(y!==void 0&&p.push({start:y,end:v-1}),p.length!==0){let D=p[p.length-1];this._pendingGroundEffectLayers.every(k=>k>D.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(o){let l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){let C=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let D=0;D<C.length;++D){let k=Object.values(C[D]);l.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();let p=this.proxyCoords,y=this._tilesDirty;for(let C=p.length-1;C>=0;C--){let D=p[C];if(l.getTileByID(D.key),l.proxyCachedFBO[D.key]!==void 0){let k=o[D.key],N=this.proxyToSource[D.key],B=0;for(let H in N){let U=N[H],q=k[H];if(!q||q.length!==U.length||U.some((ee,Q)=>ee!==q[Q]||y[H]&&y[H].hasOwnProperty(ee.key))){B=-1;break}++B}for(let H in l.proxyCachedFBO[D.key])l.renderCache[l.proxyCachedFBO[D.key][H]].dirty=B<0||B!==Object.values(k).length}}let v=[...this._drapedRenderBatches];v.sort((C,D)=>D.end-D.start-(C.end-C.start));for(let C of v)for(let D of p){if(l.proxyCachedFBO[D.key])continue;let k=l.renderCachePool.pop();k===void 0&&l.renderCache.length<50&&(k=l.renderCache.length,l.renderCache.push(this._createFBO())),k!==void 0&&(l.proxyCachedFBO[D.key]={},l.proxyCachedFBO[D.key][C.start]=k,l.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(o,l,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let v=this.painter.context,C=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let D;if(p.isTileClipped())D=l.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):Sn.disabled}_renderTileClippingMasks(o,l){let p=this.painter,y=this.painter.context,v=y.gl;p._tileClippingMaskIDs={},y.setColorMode($n.disabled),y.setDepthMode(an.disabled);let C=p.getOrCreateProgram("clippingMask");for(let D of o){let k=p._tileClippingMaskIDs[D.key]=--l;C.draw(p,v.TRIANGLES,an.disabled,new Sn({func:v.ALWAYS,mask:0},k,255,v.KEEP,v.KEEP,v.REPLACE),$n.disabled,yn.disabled,Pf(D.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(o){let l=this.painter.transform;if(o.x<0||o.x>l.width||o.y<0||o.y>l.height)return null;let p=[o.x,o.y,1,1];r.ab.vec4.transformMat4(p,p,l.pixelMatrixInverse),r.ab.vec4.scale(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;let y=l._camera.position,v=r.bH(1,l.center.lat),C=[y[0],y[1],y[2]/v,0],D=r.ab.vec3.subtract([],p.slice(0,3),C);r.ab.vec3.normalize(D,D);let k=this.raycast(C,D,this._exaggeration);return k!==null&&k?(r.ab.vec3.scaleAndAdd(C,C,D,k),C[3]=C[2],C[2]*=v,C):null}_setupProxiedCoordsForOrtho(o,l,p){if(o.getSource()instanceof r.aJ)return this._setupProxiedCoordsForImageSource(o,l,p);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};let y=this.proxiedCoords[o.id]=[],v=this.proxyCoords;for(let k=0;k<v.length;k++){let N=v[k],B=this._findTileCoveringTileID(N,o);if(B){let H=this._createProxiedId(N,B,p[N.key]&&p[N.key][o.id]);y.push(H),this.proxyToSource[N.key][o.id]=[H]}}let C=!1,D=new Set;for(let k=0;k<l.length;k++){let N=o.getTile(l[k]);if(!N||!N.hasData())continue;let B=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==N.tileID.canonical.z){let H=this.proxyToSource[B.tileID.key][o.id],U=this._createProxiedId(B.tileID,N,p[B.tileID.key]&&p[B.tileID.key][o.id]);H?H.splice(H.length-1,0,U):this.proxyToSource[B.tileID.key][o.id]=[U];let q=this.proxyToSource[B.tileID.key][o.id];D.has(q)||D.add(q),y.push(U),C=!0}}if(this._sourceTilesOverlap[o.id]=C,C&&this._debugParams.sortTilesHiZFirst)for(let k of D)k.sort((N,B)=>B.overscaledZ-N.overscaledZ)}_setupProxiedCoordsForImageSource(o,l,p){if(!o.getSource().loaded())return;let y=this.proxiedCoords[o.id]=[],v=this.proxyCoords,C=o.getSource(),D=C.tileID;if(!D)return;let k=new r.P(D.x,D.y)._div(1<<D.z),N=C.coordinates.map(r.aa.fromLngLat).reduce((H,U)=>(H.min.x=Math.min(H.min.x,U.x-k.x),H.min.y=Math.min(H.min.y,U.y-k.y),H.max.x=Math.max(H.max.x,U.x-k.x),H.max.y=Math.max(H.max.y,U.y-k.y),H),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(H,U)=>{let q=H.wrap+H.canonical.x/(1<<H.canonical.z),ee=H.canonical.y/(1<<H.canonical.z),Q=r.ag/(1<<H.canonical.z),ie=U.wrap+U.canonical.x/(1<<U.canonical.z),re=U.canonical.y/(1<<U.canonical.z);return q+Q<ie+N.min.x||q>ie+N.max.x||ee+Q<re+N.min.y||ee>re+N.max.y};for(let H=0;H<v.length;H++){let U=v[H];for(let q=0;q<l.length;q++){let ee=o.getTile(l[q]);if(!ee||!ee.hasData()||B(U,ee.tileID))continue;let Q=this._createProxiedId(U,ee,p[U.key]&&p[U.key][o.id]),ie=this.proxyToSource[U.key][o.id];ie?ie.push(Q):this.proxyToSource[U.key][o.id]=[Q],y.push(Q)}}}_createProxiedId(o,l,p){let y=this.orthoMatrix;if(p){let v=p.find(C=>C.key===l.tileID.key);if(v)return v}if(l.tileID.key!==o.key){let v=o.canonical.z-l.tileID.canonical.z,C,D,k;y=r.ab.mat4.create();let N=l.tileID.wrap-o.wrap<<o.overscaledZ;v>0?(C=r.ag>>v,D=C*((l.tileID.canonical.x<<v)-o.canonical.x+N),k=C*((l.tileID.canonical.y<<v)-o.canonical.y)):(C=r.ag<<-v,D=r.ag*(l.tileID.canonical.x-(o.canonical.x+N<<-v)),k=r.ag*(l.tileID.canonical.y-(o.canonical.y<<-v))),r.ab.mat4.ortho(y,0,C,0,C,0,1),r.ab.mat4.translate(y,y,[D,k,0])}return new tm(l.tileID,o.key,y)}_findTileCoveringTileID(o,l){let p=l.getTile(o);if(p&&p.hasData())return p;let y=this._findCoveringTileCache[l.id],v=y[o.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||v===null)return p;let C=p?p.tileID:o,D=C.overscaledZ,k=l.getSource().minzoom,N=[];if(!v){let H=l.getSource().maxzoom;if(o.canonical.z>=H){let U=o.canonical.z-H;l.getSource().reparseOverscaled?(D=Math.max(o.canonical.z+2,l.transform.tileZoom),C=new r.aG(D,o.wrap,H,o.canonical.x>>U,o.canonical.y>>U)):U!==0&&(D=H,C=new r.aG(D,o.wrap,H,o.canonical.x>>U,o.canonical.y>>U))}C.key!==o.key&&(N.push(C.key),p=l.getTile(C))}let B=H=>{N.forEach(U=>{y[U]=H}),N.length=0};for(D-=1;D>=k&&(!p||!p.hasData());D--){p&&B(p.tileID.key);let H=C.calculateScaledKey(D);if(p=l.getTileByID(H),p&&p.hasData())break;let U=y[H];if(U===null)break;U===void 0?N.push(H):p=l.getTileByID(U)}return B(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,l){let p=this._tilesDirty[o];p||(p=this._tilesDirty[o]={}),p[l.key]=!0}}function DC(f,o,l){let p=function(D,k,N){let B=r.ab.vec3.dot(k,D),H=r.ab.vec3.dot(N,[.2126,.7152,.0722]),U=(ee,Q,ie)=>(1-ie)*ee+ie*Q,q=U(1-.3*Math.min(H,1),1,Math.min(B+1,1));return U(.92,1,Math.asin(r.aw(k[2],-1,1))/Math.PI+.5)*q}(f,[0,0,1],o),y=[0,0,0];r.ab.vec3.scale(y,l.slice(0,3),p);let v=[0,0,0];r.ab.vec3.scale(v,o.slice(0,3),f[2]);let C=[0,0,0];return r.ab.vec3.add(C,y,v),r.cf(C)}let xv=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Df=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class bv{static cacheKey(o,l,p,y){let v=`${l}${y?y.cacheKey:""}`;for(let C of p)o.usedDefines.includes(C)&&(v+=`/${C}`);return v}constructor(o,l,p,y,v,C){let D=o.gl;this.program=D.createProgram(),this.configuration=y,this.name=l,this.fixedDefines=[...C];let k=y?y.getBinderAttributes():[],N=(p.staticAttributes||[]).concat(k),B=y?y.defines():[];B=B.concat(C.map(ie=>`#define ${ie}`));let H=`#version 300 es
`,U=H+B.concat("precision mediump float;",Xh,ou.fragmentSource).join(`
`);for(let ie of p.fragmentIncludes)U+=`
${qs[ie]}`;U+=`
${p.fragmentSource}`;let q=H+B.concat("precision highp float;",Xh,ou.vertexSource).join(`
`);for(let ie of p.vertexIncludes)q+=`
${qs[ie]}`;this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(q+=`
uniform int u_instanceID;
`),q+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(q=q.replaceAll("gl_InstanceID","u_instanceID"));let ee=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(ee,U),D.compileShader(ee),D.attachShader(this.program,ee);let Q=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())this.failedToCreate=!0;else{D.shaderSource(Q,q),D.compileShader(Q),D.attachShader(this.program,Q),this.attributes={},this.numAttributes=N.length;for(let ie=0;ie<this.numAttributes;ie++)if(N[ie]){let re=N[ie].startsWith("a_")?N[ie]:`a_${N[ie]}`;D.bindAttribLocation(this.program,ie,re),this.attributes[re]=ie}D.linkProgram(this.program),D.deleteShader(Q),D.deleteShader(ee),this.fixedUniforms=v(o),this.binderUniforms=y?y.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ie=>({u_instanceID:new r.bN(ie)}))(o)),(C.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(ie=>({u_dem:new r.bN(ie),u_dem_prev:new r.bN(ie),u_dem_tl:new r.bK(ie),u_dem_scale:new r.bM(ie),u_dem_tl_prev:new r.bK(ie),u_dem_scale_prev:new r.bM(ie),u_dem_size:new r.bM(ie),u_dem_lerp:new r.bM(ie),u_exaggeration:new r.bM(ie),u_depth:new r.bN(ie),u_depth_size_inv:new r.bK(ie),u_depth_range_unpack:new r.bK(ie),u_occluder_half_size:new r.bM(ie),u_occlusion_depth_offset:new r.bM(ie),u_meter_to_dem:new r.bM(ie),u_label_plane_matrix_inv:new r.bJ(ie)}))(o)),C.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new r.bL(ie),u_tile_tr_up:new r.bL(ie),u_tile_br_up:new r.bL(ie),u_tile_bl_up:new r.bL(ie),u_tile_up_scale:new r.bM(ie)}))(o)),C.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new r.bJ(ie),u_fog_range:new r.bK(ie),u_fog_color:new r.ca(ie),u_fog_horizon_blend:new r.bM(ie),u_fog_vertical_limit:new r.bK(ie),u_fog_temporal_offset:new r.bM(ie),u_frustum_tl:new r.bL(ie),u_frustum_tr:new r.bL(ie),u_frustum_br:new r.bL(ie),u_frustum_bl:new r.bL(ie),u_globe_pos:new r.bL(ie),u_globe_radius:new r.bM(ie),u_globe_transition:new r.bM(ie),u_is_globe:new r.bN(ie),u_viewport:new r.bK(ie)}))(o)),C.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ie=>({u_cutoff_params:new r.ca(ie)}))(o)),C.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ie=>({u_lighting_ambient_color:new r.bL(ie),u_lighting_directional_dir:new r.bL(ie),u_lighting_directional_color:new r.bL(ie),u_ground_radiance:new r.bL(ie)}))(o)),C.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ie=>({u_light_matrix_0:new r.bJ(ie),u_light_matrix_1:new r.bJ(ie),u_fade_range:new r.bK(ie),u_shadow_normal_offset:new r.bL(ie),u_shadow_intensity:new r.bM(ie),u_shadow_texel_size:new r.bM(ie),u_shadow_map_resolution:new r.bM(ie),u_shadow_direction:new r.bL(ie),u_shadow_bias:new r.bL(ie),u_shadowmap_0:new r.bN(ie),u_shadowmap_1:new r.bN(ie)}))(o))}}setTerrainUniformValues(o,l){if(!this.terrainUniforms)return;let p=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let y in l)p[y]&&p[y].set(this.program,y,l[y])}}setGlobeUniformValues(o,l){if(!this.globeUniforms)return;let p=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let y in l)p[y]&&p[y].set(this.program,y,l[y])}}setFogUniformValues(o,l){if(!this.fogUniforms)return;let p=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let y in l)p[y].set(this.program,y,l[y])}}setCutoffUniformValues(o,l){if(!this.cutoffUniforms)return;let p=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let y in l)p[y].set(this.program,y,l[y])}}setLightsUniformValues(o,l){if(!this.lightsUniforms)return;let p=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let y in l)p[y].set(this.program,y,l[y])}}setShadowUniformValues(o,l){if(this.failedToCreate||!this.shadowUniforms)return;let p=this.shadowUniforms;o.program.set(this.program);for(let y in l)p[y].set(this.program,y,l[y])}_drawDebugWireframe(o,l,p,y,v,C,D,k,N,B){let H=o.options.wireframe;if(H.terrain===!1&&H.layers2D===!1&&H.layers3D===!1)return;let U=o.context;if(!(!(!H.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!H.layers2D||o._terrain&&o._terrain.renderingToTexture||!xv.includes(this.name))||!(!H.layers3D||!Df.includes(this.name))))return;let q=U.gl,ee=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,v,U);if(!ee)return;let Q=[...this.fixedDefines];Q.push("DEBUG_WIREFRAME");let ie=o.getOrCreateProgram(this.name,{config:this.configuration,defines:Q});U.program.set(ie.program);let re=(pe,we,xe)=>{if(we[pe]&&xe[pe])for(let be in we[pe])xe[pe][be]&&xe[pe][be].set(xe.program,be,we[pe][be].current)};N&&N.setUniforms(ie.program,U,ie.binderUniforms,D,{zoom:k}),re("fixedUniforms",this,ie),re("terrainUniforms",this,ie),re("globeUniforms",this,ie),re("fogUniforms",this,ie),re("lightsUniforms",this,ie),re("shadowUniforms",this,ie),ee.bind(),U.setColorMode(new $n([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],r.aj.transparent,[!0,!0,!0,!1])),U.setDepthMode(new an(l.func===q.LESS?q.LEQUAL:l.func,an.ReadOnly,l.range)),U.setStencilMode(Sn.disabled);let ue=3*C.primitiveLength*2,ge=3*C.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){let pe=B||1;for(let we=0;we<pe;++we)ie.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),q.drawElements(q.LINES,ue,q.UNSIGNED_SHORT,ge)}else B&&B>1?q.drawElementsInstanced(q.LINES,ue,q.UNSIGNED_SHORT,ge,B):q.drawElements(q.LINES,ue,q.UNSIGNED_SHORT,ge);v.bind(),U.program.set(this.program),U.setDepthMode(l),U.setStencilMode(p),U.setColorMode(y)}checkUniforms(o,l,p){if(this.fixedDefines.includes(l)){for(let y of Object.keys(p))if(!p[y].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${y} not set but required by ${l} being defined`)}}draw(o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q,ie){let re=o.context,ue=re.gl;if(this.failedToCreate)return;re.program.set(this.program),re.setDepthMode(p),re.setStencilMode(y),re.setColorMode(v),re.setCullFace(C);for(let we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,D[we]);ee&&ee.setUniforms(this.program,re,this.binderUniforms,U,{zoom:q});let ge={[ue.POINTS]:1,[ue.LINES]:2,[ue.TRIANGLES]:3,[ue.LINE_STRIP]:1}[l];this.checkUniforms(k,"RENDER_SHADOWS",this.shadowUniforms);let pe=ie&&ie>0?1:void 0;for(let we of H.get()){let xe=we.vaos||(we.vaos={});if((xe[k]||(xe[k]=new sl)).bind(re,this,N,ee?ee.getPaintVertexBuffers():[],B,we.vertexOffset,Q||[],pe),this.forceManualRenderingForInstanceIDShaders){let be=ie||1;for(let ve=0;ve<be;++ve)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ve),B?ue.drawElements(l,we.primitiveLength*ge,ue.UNSIGNED_SHORT,we.primitiveOffset*ge*2):ue.drawArrays(l,we.vertexOffset,we.vertexLength)}else ie&&ie>1?ue.drawElementsInstanced(l,we.primitiveLength*ge,ue.UNSIGNED_SHORT,we.primitiveOffset*ge*2,ie):B?ue.drawElements(l,we.primitiveLength*ge,ue.UNSIGNED_SHORT,we.primitiveOffset*ge*2):ue.drawArrays(l,we.vertexOffset,we.vertexLength);l===ue.TRIANGLES&&B&&this._drawDebugWireframe(o,p,y,v,B,we,U,q,ee,ie)}}}function wv(f,o){let l=Math.pow(2,o.tileID.overscaledZ),p=o.tileSize*Math.pow(2,f.transform.tileZoom)/l,y=p*(o.tileID.canonical.x+o.tileID.wrap*l),v=p*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ar(o,1,f.transform.tileZoom),u_pixel_coord_upper:[y>>16,v>>16],u_pixel_coord_lower:[65535&y,65535&v]}}let Of={terrain:0,flat:1},OC=r.ab.mat4.create(),im=(f,o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q,ie,re)=>{let ue=o.style.light,ge=ue.properties.get("position"),pe=[ge.x,ge.y,ge.z],we=r.ab.mat3.create();ue.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(we,-o.transform.angle),r.ab.vec3.transformMat3(pe,pe,we));let xe=ue.properties.get("color"),be=o.transform,ve={u_matrix:f,u_lightpos:pe,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[xe.r,xe.g,xe.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:OC,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Of[N],u_base_type:Of[B],u_ao:y,u_edge_radius:v,u_width_scale:C,u_flood_light_color:ee,u_vertical_scale:Q,u_flood_light_intensity:ie,u_ground_shadow_factor:re};return be.projection.name==="globe"&&(ve.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],ve.u_zoom_transition=H,ve.u_inv_rot_matrix=q,ve.u_merc_center=U,ve.u_up_dir=be.projection.upVector(new r.bT(0,0,0),U[0]*r.ag,U[1]*r.ag),ve.u_height_lift=k),ve},g_=(f,o,l,p,y,v)=>({u_matrix:f,u_edge_radius:o,u_width_scale:l,u_vertical_scale:p,u_height_type:Of[y],u_base_type:Of[v]}),Af=(f,o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q,ie)=>{let re=im(f,o,l,p,y,v,C,D,N,B,H,U,q,ee,Q,ie,1,[0,0,0]),ue={u_height_factor:-Math.pow(2,D.overscaledZ)/k.tileSize/8};return r.l(re,wv(o,k),ue)},rm=(f,o)=>({u_matrix:f,u_emissive_strength:o}),nd=(f,o,l,p)=>r.l(rm(f,o),wv(l,p)),Cv=(f,o,l)=>({u_matrix:f,u_world:l,u_emissive_strength:o}),om=(f,o,l,p,y)=>r.l(nd(f,o,l,p),{u_world:y}),sm=(f,o,l,p)=>{let y=r.ag/l.tileSize;return{u_matrix:f,u_camera_to_center_distance:o.getCameraToCenterDistance(p),u_extrude_scale:[o.pixelsToGLUnits[0]/y,o.pixelsToGLUnits[1]/y]}},am=(f,o,l=1)=>({u_matrix:f,u_color:o.toRenderColor(null),u_overlay:0,u_overlay_scale:l}),Mv=r.ab.mat4.create(),AC=(f,o,l,p,y,v,C)=>{let D=f.transform,k=D.projection.name==="globe",N=k?r.cN(D.zoom,o.canonical)*D._pixelsPerMercatorPixel:r.ar(l,1,v),B={u_matrix:o.projMatrix,u_extrude_scale:N,u_intensity:C,u_inv_rot_matrix:Mv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){B.u_inv_rot_matrix=p,B.u_merc_center=y,B.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],B.u_zoom_transition=r.ae(D.zoom);let H=y[0]*r.ag,U=y[1]*r.ag;B.u_up_dir=D.projection.upVector(new r.bT(0,0,0),H,U)}return B};function eh(f,[o,l,p,y],[v,C]){if(v===C)return[0,0,0,0];let D=255*(f-1)/(f*(C-v));return[o*D,l*D,p*D,y*D]}function Rf(f,o,[l,p]){return l===p?0:.5/f+(o-l)*(f-1)/(f*(p-l))}let Xt=(f,o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q,ie,re,ue,ge,pe)=>({u_matrix:f,u_normalize_matrix:o,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:v,u_scale_parent:N,u_fade_t:B.mix,u_opacity:B.opacity*H.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:H.paint.get("raster-brightness-min"),u_brightness_high:H.paint.get("raster-brightness-max"),u_saturation_factor:r.cO(H.paint.get("raster-saturation")),u_contrast_factor:r.cP(H.paint.get("raster-contrast")),u_spin_weights:Tv(H.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:q,u_zoom_transition:C,u_merc_center:D,u_cutoff_params:k,u_colorization_mix:eh(r.cQ,Q,re),u_colorization_offset:Rf(r.cQ,ie,re),u_color_ramp:ee,u_texture_offset:[ge/(ue+2*ge),ue/(ue+2*ge)],u_texture_res:[ue+2*ge,ue+2*ge],u_emissive_strength:pe});function Tv(f){f*=Math.PI/180;let o=Math.sin(f),l=Math.cos(f);return[(2*l+1)/3,(-Math.sqrt(3)*o-l+1)/3,(Math.sqrt(3)*o-l+1)/3]}let th=.05,nh=(f,o,l,p,y,v,C,D,k,N,B,H)=>({u_matrix:f,u_normalize_matrix:o,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:v,u_scale_parent:N,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:H,u_zoom_transition:C,u_merc_center:D,u_cutoff_params:k}),ih=(f,o,l,p,y,v,C,D,k,N)=>({u_particle_texture:f,u_particle_texture_side_len:o,u_tile_offset:l,u_velocity:p,u_color_ramp:v,u_velocity_res:y,u_max_speed:C,u_uv_offset:D,u_data_scale:[255*k[0],255*k[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[th,th]}),sn=(f,o,l,p,y,v,C,D,k,N)=>({u_particle_texture:f,u_particle_texture_side_len:o,u_velocity:l,u_velocity_res:p,u_max_speed:y,u_speed_factor:v,u_reset_rate:C,u_rand_seed:Math.random(),u_uv_offset:D,u_data_scale:[255*k[0],255*k[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[th,th]}),lm=r.ab.mat4.create(),Ev=(f,o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q,ie,re,ue,ge,pe,we)=>{let xe=y.transform,be={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:xe.getCameraToCenterDistance(ue),u_rotate_symbol:+l,u_aspect_ratio:xe.width/xe.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:C,u_coord_matrix:D,u_is_text:+N,u_elevation_from_sea:k?1:0,u_pitch_with_map:+p,u_texsize:B,u_texsize_icon:H,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lm,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:lm,u_up_vector:[0,-1,0],u_color_adj_mat:ge,u_icon_transition:pe||0,u_gamma_scale:p?y.transform.getCameraToCenterDistance(ue)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:+U,u_scale_factor:we||1};return ue.name==="globe"&&(be.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],be.u_zoom_transition=ee,be.u_inv_rot_matrix=ie,be.u_merc_center=Q,be.u_camera_forward=xe._camera.forward(),be.u_ecef_origin=r.cR(xe.globeMatrix,q.toUnwrapped()),be.u_tile_matrix=Float32Array.from(xe.globeMatrix),be.u_up_vector=re),be},Sv=(f,o,l,p)=>({u_matrix:f,u_emissive_strength:o,u_opacity:l,u_color:p}),cm=(f,o,l,p,y,v,C,D,k)=>r.l(function(N,B,H,U,q,ee){let{width:Q,height:ie}=U.imageManager.getPixelSize(B),re=Math.pow(2,ee.tileID.overscaledZ),ue=ee.tileSize*Math.pow(2,U.transform.tileZoom)/re,ge=ue*(ee.tileID.canonical.x+ee.tileID.wrap*re),pe=ue*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[Q,ie],u_pattern_size:H.displaySize,u_pattern_units_to_pixels:q?[U.transform.width,-1*U.transform.height]:[1/r.ar(ee,1,U.transform.tileZoom),1/r.ar(ee,1,U.transform.tileZoom)],u_pixel_coord_upper:[ge>>16,pe>>16],u_pixel_coord_lower:[65535&ge,65535&pe]}}(0,v,C,p,D,k),{u_matrix:f,u_emissive_strength:o,u_opacity:l}),um=new Float32Array(r.ab.mat4.identity([])),hm=(f,o,l,p,y,v,C,D,k,N,B,H,U,q=[0,0,0],ee)=>{let Q=y.style.light,ie=Q.properties.get("position"),re=[-ie.x,-ie.y,ie.z],ue=r.ab.mat3.create();Q.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(ue,-y.transform.angle),r.ab.vec3.transformMat3(re,re,ue));let ge=B.alphaMode==="MASK",pe=Q.properties.get("color").toRenderColor(null),we=U.paint.get("model-ambient-occlusion-intensity"),xe=U.paint.get("model-color").constantOr(r.aj.white).toRenderColor(null),be=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:o,u_normal_matrix:l,u_node_matrix:p||um,u_lightpos:re,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_camera_pos:q,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+ge,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[C.r,C.g,C.b,C.a],u_emissiveFactor:[D[0],D[1],D[2],1],u_metallicFactor:k,u_roughnessFactor:N,u_baseColorTexture:Co.BaseColor,u_metallicRoughnessTexture:Co.MetallicRoughness,u_normalTexture:Co.Normal,u_occlusionTexture:Co.Occlusion,u_emissionTexture:Co.Emission,u_lutTexture:Co.LUT,u_color_mix:[xe.r,xe.g,xe.b,be],u_aoIntensity:we,u_emissive_strength:H,u_occlusionTextureTransform:ee||[0,0,0,0]}},Iv=(f,o=um,l=um)=>({u_matrix:f,u_instance:o,u_node_matrix:l}),RC={fillExtrusion:f=>({u_matrix:new r.bJ(f),u_lightpos:new r.bL(f),u_lightintensity:new r.bM(f),u_lightcolor:new r.bL(f),u_vertical_gradient:new r.bM(f),u_opacity:new r.bM(f),u_edge_radius:new r.bM(f),u_width_scale:new r.bM(f),u_ao:new r.bK(f),u_height_type:new r.bN(f),u_base_type:new r.bN(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_up_dir:new r.bL(f),u_height_lift:new r.bM(f),u_flood_light_color:new r.bL(f),u_vertical_scale:new r.bM(f),u_flood_light_intensity:new r.bM(f),u_ground_shadow_factor:new r.bL(f)}),fillExtrusionDepth:f=>({u_matrix:new r.bJ(f),u_edge_radius:new r.bM(f),u_width_scale:new r.bM(f),u_vertical_scale:new r.bM(f),u_height_type:new r.bN(f),u_base_type:new r.bN(f)}),fillExtrusionPattern:f=>({u_matrix:new r.bJ(f),u_lightpos:new r.bL(f),u_lightintensity:new r.bM(f),u_lightcolor:new r.bL(f),u_vertical_gradient:new r.bM(f),u_height_factor:new r.bM(f),u_edge_radius:new r.bM(f),u_width_scale:new r.bM(f),u_ao:new r.bK(f),u_height_type:new r.bN(f),u_base_type:new r.bN(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_up_dir:new r.bL(f),u_height_lift:new r.bM(f),u_image:new r.bN(f),u_texsize:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_tile_units_to_pixels:new r.bM(f),u_opacity:new r.bM(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new r.bJ(f),u_opacity:new r.bM(f),u_ao_pass:new r.bM(f),u_meter_to_tile:new r.bM(f),u_ao:new r.bK(f),u_flood_light_intensity:new r.bM(f),u_flood_light_color:new r.bL(f),u_attenuation:new r.bM(f),u_edge_radius:new r.bM(f),u_fb:new r.bN(f),u_fb_size:new r.bM(f),u_dynamic_offset:new r.bM(f)}),fill:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f)}),fillPattern:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_image:new r.bN(f),u_texsize:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_tile_units_to_pixels:new r.bM(f)}),fillOutline:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_world:new r.bK(f)}),fillOutlinePattern:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_world:new r.bK(f),u_image:new r.bN(f),u_texsize:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_tile_units_to_pixels:new r.bM(f)}),circle:r.cS,collisionBox:f=>({u_matrix:new r.bJ(f),u_camera_to_center_distance:new r.bM(f),u_extrude_scale:new r.bK(f)}),collisionCircle:f=>({u_matrix:new r.bJ(f),u_inv_matrix:new r.bJ(f),u_camera_to_center_distance:new r.bM(f),u_viewport_size:new r.bK(f)}),debug:f=>({u_color:new r.cz(f),u_matrix:new r.bJ(f),u_overlay:new r.bN(f),u_overlay_scale:new r.bM(f)}),clippingMask:f=>({u_matrix:new r.bJ(f)}),heatmap:f=>({u_extrude_scale:new r.bM(f),u_intensity:new r.bM(f),u_matrix:new r.bJ(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_up_dir:new r.bL(f)}),heatmapTexture:f=>({u_image:new r.bN(f),u_color_ramp:new r.bN(f),u_opacity:new r.bM(f)}),hillshade:f=>({u_matrix:new r.bJ(f),u_image:new r.bN(f),u_latrange:new r.bK(f),u_light:new r.bK(f),u_shadow:new r.cz(f),u_highlight:new r.cz(f),u_emissive_strength:new r.bM(f),u_accent:new r.cz(f)}),hillshadePrepare:f=>({u_matrix:new r.bJ(f),u_image:new r.bN(f),u_dimension:new r.bK(f),u_zoom:new r.bM(f)}),line:r.cT,linePattern:r.cU,raster:f=>({u_matrix:new r.bJ(f),u_normalize_matrix:new r.bJ(f),u_globe_matrix:new r.bJ(f),u_merc_matrix:new r.bJ(f),u_grid_matrix:new r.cA(f),u_tl_parent:new r.bK(f),u_scale_parent:new r.bM(f),u_fade_t:new r.bM(f),u_opacity:new r.bM(f),u_image0:new r.bN(f),u_image1:new r.bN(f),u_brightness_low:new r.bM(f),u_brightness_high:new r.bM(f),u_saturation_factor:new r.bM(f),u_contrast_factor:new r.bM(f),u_spin_weights:new r.bL(f),u_perspective_transform:new r.bK(f),u_raster_elevation:new r.bM(f),u_zoom_transition:new r.bM(f),u_merc_center:new r.bK(f),u_cutoff_params:new r.ca(f),u_colorization_mix:new r.ca(f),u_colorization_offset:new r.bM(f),u_color_ramp:new r.bN(f),u_texture_offset:new r.bK(f),u_texture_res:new r.bK(f),u_emissive_strength:new r.bM(f)}),rasterParticle:f=>({u_matrix:new r.bJ(f),u_normalize_matrix:new r.bJ(f),u_globe_matrix:new r.bJ(f),u_merc_matrix:new r.bJ(f),u_grid_matrix:new r.cA(f),u_tl_parent:new r.bK(f),u_scale_parent:new r.bM(f),u_fade_t:new r.bM(f),u_opacity:new r.bM(f),u_image0:new r.bN(f),u_image1:new r.bN(f),u_raster_elevation:new r.bM(f),u_zoom_transition:new r.bM(f),u_merc_center:new r.bK(f),u_cutoff_params:new r.ca(f)}),rasterParticleTexture:f=>({u_texture:new r.bN(f),u_opacity:new r.bM(f)}),rasterParticleDraw:f=>({u_particle_texture:new r.bN(f),u_particle_texture_side_len:new r.bM(f),u_tile_offset:new r.bK(f),u_velocity:new r.bN(f),u_color_ramp:new r.bN(f),u_velocity_res:new r.bK(f),u_max_speed:new r.bM(f),u_uv_offset:new r.bK(f),u_data_scale:new r.bK(f),u_data_offset:new r.bM(f),u_particle_pos_scale:new r.bM(f),u_particle_pos_offset:new r.bK(f)}),rasterParticleUpdate:f=>({u_particle_texture:new r.bN(f),u_particle_texture_side_len:new r.bM(f),u_velocity:new r.bN(f),u_velocity_res:new r.bK(f),u_max_speed:new r.bM(f),u_speed_factor:new r.bM(f),u_reset_rate:new r.bM(f),u_rand_seed:new r.bM(f),u_uv_offset:new r.bK(f),u_data_scale:new r.bK(f),u_data_offset:new r.bM(f),u_particle_pos_scale:new r.bM(f),u_particle_pos_offset:new r.bK(f)}),symbol:f=>({u_is_size_zoom_constant:new r.bN(f),u_is_size_feature_constant:new r.bN(f),u_size_t:new r.bM(f),u_size:new r.bM(f),u_camera_to_center_distance:new r.bM(f),u_rotate_symbol:new r.bN(f),u_aspect_ratio:new r.bM(f),u_fade_change:new r.bM(f),u_matrix:new r.bJ(f),u_label_plane_matrix:new r.bJ(f),u_coord_matrix:new r.bJ(f),u_is_text:new r.bN(f),u_elevation_from_sea:new r.bN(f),u_pitch_with_map:new r.bN(f),u_texsize:new r.bK(f),u_texsize_icon:new r.bK(f),u_texture:new r.bN(f),u_texture_icon:new r.bN(f),u_gamma_scale:new r.bM(f),u_device_pixel_ratio:new r.bM(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_camera_forward:new r.bL(f),u_tile_matrix:new r.bJ(f),u_up_vector:new r.bL(f),u_ecef_origin:new r.bL(f),u_is_halo:new r.bN(f),u_icon_transition:new r.bM(f),u_color_adj_mat:new r.bJ(f),u_scale_factor:new r.bM(f)}),background:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_opacity:new r.bM(f),u_color:new r.cz(f)}),backgroundPattern:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_opacity:new r.bM(f),u_image:new r.bN(f),u_pattern_tl:new r.bK(f),u_pattern_br:new r.bK(f),u_texsize:new r.bK(f),u_pattern_size:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_pattern_units_to_pixels:new r.bK(f)}),terrainRaster:f=>({u_matrix:new r.bJ(f),u_image0:new r.bN(f),u_skirt_height:new r.bM(f),u_ground_shadow_factor:new r.bL(f)}),skybox:f=>({u_matrix:new r.bJ(f),u_sun_direction:new r.bL(f),u_cubemap:new r.bN(f),u_opacity:new r.bM(f),u_temporal_offset:new r.bM(f)}),skyboxGradient:f=>({u_matrix:new r.bJ(f),u_color_ramp:new r.bN(f),u_center_direction:new r.bL(f),u_radius:new r.bM(f),u_opacity:new r.bM(f),u_temporal_offset:new r.bM(f)}),skyboxCapture:f=>({u_matrix_3f:new r.cA(f),u_sun_direction:new r.bL(f),u_sun_intensity:new r.bM(f),u_color_tint_r:new r.ca(f),u_color_tint_m:new r.ca(f),u_luminance:new r.bM(f)}),globeRaster:f=>({u_proj_matrix:new r.bJ(f),u_globe_matrix:new r.bJ(f),u_normalize_matrix:new r.bJ(f),u_merc_matrix:new r.bJ(f),u_zoom_transition:new r.bM(f),u_merc_center:new r.bK(f),u_image0:new r.bN(f),u_grid_matrix:new r.cA(f),u_skirt_height:new r.bM(f),u_far_z_cutoff:new r.bM(f),u_frustum_tl:new r.bL(f),u_frustum_tr:new r.bL(f),u_frustum_br:new r.bL(f),u_frustum_bl:new r.bL(f),u_globe_pos:new r.bL(f),u_globe_radius:new r.bM(f),u_viewport:new r.bK(f)}),globeAtmosphere:f=>({u_frustum_tl:new r.bL(f),u_frustum_tr:new r.bL(f),u_frustum_br:new r.bL(f),u_frustum_bl:new r.bL(f),u_horizon:new r.bM(f),u_transition:new r.bM(f),u_fadeout_range:new r.bM(f),u_color:new r.ca(f),u_high_color:new r.ca(f),u_space_color:new r.ca(f),u_temporal_offset:new r.bM(f),u_horizon_angle:new r.bM(f)}),model:f=>({u_matrix:new r.bJ(f),u_lighting_matrix:new r.bJ(f),u_normal_matrix:new r.bJ(f),u_node_matrix:new r.bJ(f),u_lightpos:new r.bL(f),u_lightintensity:new r.bM(f),u_lightcolor:new r.bL(f),u_camera_pos:new r.bL(f),u_opacity:new r.bM(f),u_baseColorFactor:new r.ca(f),u_emissiveFactor:new r.ca(f),u_metallicFactor:new r.bM(f),u_roughnessFactor:new r.bM(f),u_baseTextureIsAlpha:new r.bN(f),u_alphaMask:new r.bN(f),u_alphaCutoff:new r.bM(f),u_baseColorTexture:new r.bN(f),u_metallicRoughnessTexture:new r.bN(f),u_normalTexture:new r.bN(f),u_occlusionTexture:new r.bN(f),u_emissionTexture:new r.bN(f),u_lutTexture:new r.bN(f),u_color_mix:new r.ca(f),u_aoIntensity:new r.bM(f),u_emissive_strength:new r.bM(f),u_occlusionTextureTransform:new r.ca(f)}),modelDepth:f=>({u_matrix:new r.bJ(f),u_instance:new r.bJ(f),u_node_matrix:new r.bJ(f)}),groundShadow:f=>({u_matrix:new r.bJ(f),u_ground_shadow_factor:new r.bL(f)}),stars:f=>({u_matrix:new r.bJ(f),u_up:new r.bL(f),u_right:new r.bL(f),u_intensity_multiplier:new r.bM(f)}),snowParticle:f=>({u_modelview:new r.bJ(f),u_projection:new r.bJ(f),u_time:new r.bM(f),u_cam_pos:new r.bL(f),u_velocityConeAperture:new r.bM(f),u_velocity:new r.bM(f),u_horizontalOscillationRadius:new r.bM(f),u_horizontalOscillationRate:new r.bM(f),u_boxSize:new r.bM(f),u_billboardSize:new r.bM(f),u_simpleShapeParameters:new r.bK(f),u_screenSize:new r.bK(f),u_thinningCenterPos:new r.bK(f),u_thinningShape:new r.bL(f),u_thinningAffectedRatio:new r.bM(f),u_thinningParticleOffset:new r.bM(f),u_particleColor:new r.ca(f),u_direction:new r.bL(f)}),rainParticle:f=>({u_modelview:new r.bJ(f),u_projection:new r.bJ(f),u_time:new r.bM(f),u_cam_pos:new r.bL(f),u_texScreen:new r.bN(f),u_velocityConeAperture:new r.bM(f),u_velocity:new r.bM(f),u_boxSize:new r.bM(f),u_rainDropletSize:new r.bK(f),u_distortionStrength:new r.bM(f),u_rainDirection:new r.bL(f),u_color:new r.ca(f),u_screenSize:new r.bK(f),u_thinningCenterPos:new r.bK(f),u_thinningShape:new r.bL(f),u_thinningAffectedRatio:new r.bM(f),u_thinningParticleOffset:new r.bM(f),u_shapeDirectionalPower:new r.bM(f),u_shapeNormalPower:new r.bM(f),u_mode:new r.bM(f)}),vignette:f=>({u_vignetteShape:new r.bL(f),u_vignetteColor:new r.ca(f)}),occlusion:f=>({u_matrix:new r.bJ(f),u_anchorPos:new r.bL(f),u_screenSizePx:new r.bK(f),u_occluderSizePx:new r.bK(f),u_color:new r.ca(f)})},dm=(()=>{class f{constructor(l,p,y,v){this.id=f.uniqueIdxCounter,f.uniqueIdxCounter++,this.context=l;let C=l.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||v||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){this.id=f.uniqueIdxCounter,f.uniqueIdxCounter++;let p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return f.uniqueIdxCounter=0,f})(),__={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class y_{constructor(o,l,p,y,v,C){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=y,this.instanceCount=C,this.context=o;let D=o.gl;this.buffer=D.createBuffer(),o.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||v||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){let l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,l){for(let p=0;p<this.attributes.length;p++){let y=l.attributes[this.attributes[p].name];y!==void 0&&o.enableVertexAttribArray(y)}}setVertexAttribPointers(o,l,p){for(let y=0;y<this.attributes.length;y++){let v=this.attributes[y],C=l.attributes[v.name];C!==void 0&&o.vertexAttribPointer(C,v.components,o[__[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(o,l,p){for(let y=0;y<this.attributes.length;y++){let v=l.attributes[this.attributes[y].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(v,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class fm{constructor(o,l,p,y,v){this.context=o,this.width=l,this.height=p;let C=this.framebuffer=o.gl.createFramebuffer();y&&(this.colorAttachment=new Tf(o,C)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Qu(o,C):new lo(o,C))}destroy(){let o=this.context.gl;if(this.colorAttachment){let l=this.colorAttachment.get();l&&o.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let l=this.depthAttachment.get();l&&o.deleteRenderbuffer(l)}else{let l=this.depthAttachment.get();l&&o.deleteTexture(l)}o.deleteFramebuffer(this.framebuffer)}}class Zs{constructor(o,l){this.gl=o,this.clearColor=new h_(this),this.clearDepth=new Jp(this),this.clearStencil=new Qp(this),this.colorMask=new Kh(this),this.depthMask=new Jh(this),this.stencilMask=new Qh(this),this.stencilFunc=new wf(this),this.stencilOp=new Cf(this),this.stencilTest=new Mf(this),this.depthRange=new d_(this),this.depthTest=new _(this),this.depthFunc=new S(this),this.blend=new z(this),this.blendFunc=new Y(this),this.blendColor=new ne(this),this.blendEquation=new ye(this),this.cullFace=new Ge(this),this.cullFaceSide=new ht(this),this.frontFace=new bt(this),this.program=new Zt(this),this.activeTexture=new vn(this),this.viewport=new ei(this),this.bindFramebuffer=new Pi(this),this.bindRenderbuffer=new Go(this),this.bindTexture=new Mo(this),this.bindVertexBuffer=new zo(this),this.bindElementBuffer=new ps(this),this.bindVertexArrayOES=new su(this),this.pixelStoreUnpack=new f_(this),this.pixelStoreUnpackPremultiplyAlpha=new p_(this),this.pixelStoreUnpackFlipY=new m_(this),this.options=l?cn({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,l,p){return new dm(this,o,l,p)}createVertexBuffer(o,l,p,y,v){return new y_(this,o,l,p,y,v)}createRenderbuffer(o,l,p){let y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,o,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(o,l,p,y){return new fm(this,o,l,p,y)}clear({color:o,depth:l,stencil:p,colorMask:y}){let v=this.gl,C=0;o&&(C|=v.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set(y||[!0,!0,!0,!0])),l!==void 0&&(C|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(C|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),v.clear(C)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){r.bn(o.blendFunction,$n.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let cl;function v_(f,o,l,p,y,v,C){let D=f.context,k=D.gl,N=f.transform,B=f.getOrCreateProgram("collisionBox"),H=[],U=0,q=0;for(let pe=0;pe<p.length;pe++){let we=p[pe],xe=o.getTile(we),be=xe.getBucket(l);if(!be)continue;let ve=Ur(we,be,N),Ie=ve;y[0]===0&&y[1]===0||(Ie=f.translatePosMatrix(ve,xe,y,v));let Re=C?be.textCollisionBox:be.iconCollisionBox,Ye=be.collisionCircleArray;if(Ye.length>0){let $e=r.ab.mat4.create(),Ae=Ie;r.ab.mat4.mul($e,be.placementInvProjMatrix,N.glCoordMatrix),r.ab.mat4.mul($e,$e,be.placementViewportMatrix),H.push({circleArray:Ye,circleOffset:q,transform:Ae,invTransform:$e,projection:be.getProjection()}),U+=Ye.length/4,q=U}Re&&(f.terrain&&f.terrain.setupElevationDraw(xe,B),B.draw(f,k.LINES,an.disabled,Sn.disabled,f.colorModeForRenderPass(),yn.disabled,sm(Ie,N,xe,be.getProjection()),l.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,N.zoom,null,[Re.collisionVertexBuffer,Re.collisionVertexBufferExt]))}if(!C||!H.length)return;let ee=f.getOrCreateProgram("collisionCircle"),Q=new r.cV;Q.resize(4*U),Q._trim();let ie=0;for(let pe of H)for(let we=0;we<pe.circleArray.length/4;we++){let xe=4*we,be=pe.circleArray[xe+0],ve=pe.circleArray[xe+1],Ie=pe.circleArray[xe+2],Re=pe.circleArray[xe+3];Q.emplace(ie++,be,ve,Ie,Re,0),Q.emplace(ie++,be,ve,Ie,Re,1),Q.emplace(ie++,be,ve,Ie,Re,2),Q.emplace(ie++,be,ve,Ie,Re,3)}(!cl||cl.length<2*U)&&(cl=function(pe){let we=2*pe,xe=new r.aU;xe.resize(we),xe._trim();for(let be=0;be<we;be++){let ve=6*be;xe.uint16[ve+0]=4*be+0,xe.uint16[ve+1]=4*be+1,xe.uint16[ve+2]=4*be+2,xe.uint16[ve+3]=4*be+2,xe.uint16[ve+4]=4*be+3,xe.uint16[ve+5]=4*be+0}return xe}(U));let re=D.createIndexBuffer(cl,!0),ue=D.createVertexBuffer(Q,r.cW.members,!0);for(let pe of H){let we={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(ge=N).getCameraToCenterDistance(pe.projection),u_viewport_size:[ge.width,ge.height]};ee.draw(f,k.TRIANGLES,an.disabled,Sn.disabled,f.colorModeForRenderPass(),yn.disabled,we,l.id,ue,re,r.b7.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,N.zoom)}var ge;ue.destroy(),re.destroy()}let id=r.ab.mat4.create();function pm(f){let o=f._camera.getWorldToCamera(f.worldSize,1),l=r.ab.mat4.multiply([],o,f.globeMatrix);r.ab.mat4.invert(l,l);let p=[0,0,0],y=[0,1,0,0];return r.ab.vec4.transformMat4(y,y,l),p[0]=y[0],p[1]=y[1],p[2]=y[2],r.ab.vec3.normalize(p,p),p}function x_({width:f,height:o,anchor:l,textOffset:p,textScale:y},v){let{horizontalAlign:C,verticalAlign:D}=r.bD(l),k=-(C-.5)*f,N=-(D-.5)*o,B=r.bC(l,p);return new r.P((k/y+B[0])*v,(N/y+B[1])*v)}function Pv(f,o,l,p,y,v,C,D,k,N,B){let H=f.text.placedSymbolArray,U=f.text.dynamicLayoutVertexArray,q=f.icon.dynamicLayoutVertexArray,ee={},Q=f.getProjection(),ie=hc(D,Q,v),re=v.elevation,ue=Q.upVectorScale(D.canonical,v.center.lat,v.worldSize).metersToTile;U.clear();for(let ge=0;ge<H.length;ge++){let pe=H.get(ge),{tileAnchorX:we,tileAnchorY:xe,numGlyphs:be}=pe,ve=pe.hidden||!pe.crossTileID||f.allowVerticalPlacement&&!pe.placedOrientation?null:p[pe.crossTileID];if(ve){let Ie=0,Re=0,Ye=0;if(re){let et=re?re.getAtTileOffset(D,we,xe):0,[Ct,pt,lt]=Q.upVector(D.canonical,we,xe);Ie=et*Ct*ue,Re=et*pt*ue,Ye=et*lt*ue}let[$e,Ae,ze,at]=Wi(pe.projectedAnchorX+Ie,pe.projectedAnchorY+Re,pe.projectedAnchorZ+Ye,l?ie:C),gt=ff(v.getCameraToCenterDistance(Q),at),St=y.evaluateSizeForFeature(f.textSizeData,N,pe)*gt/r.bw;l&&(St*=f.tilePixelRatio/k);let Ve=x_(ve,St);l?({x:$e,y:Ae,z:ze}=Q.projectTilePoint(we+Ve.x,xe+Ve.y,D.canonical),[$e,Ae,ze]=Wi($e+Ie,Ae+Re,ze+Ye,C)):(o&&Ve._rotate(-v.angle),$e+=Ve.x,Ae+=Ve.y,ze=0);let dt=f.allowVerticalPlacement&&pe.placedOrientation===r.bq.vertical?Math.PI/2:0;for(let et=0;et<be;et++)r.bt(U,$e,Ae,ze,dt);B&&pe.associatedIconIndex>=0&&(ee[pe.associatedIconIndex]={x:$e,y:Ae,z:ze,angle:dt})}else uc(be,U)}if(B){q.clear();let ge=f.icon.placedSymbolArray;for(let pe=0;pe<ge.length;pe++){let we=ge.get(pe),{numGlyphs:xe}=we,be=ee[pe];if(we.hidden||!be)uc(xe,q);else{let{x:ve,y:Ie,z:Re,angle:Ye}=be;for(let $e=0;$e<xe;$e++)r.bt(q,ve,Ie,Re,Ye)}}f.icon.dynamicLayoutVertexBuffer.updateData(q)}f.text.dynamicLayoutVertexBuffer.updateData(U)}function Ws(f,o,l,p,y,v,C={}){let D=l.paint.get("icon-translate"),k=l.paint.get("text-translate"),N=l.paint.get("icon-translate-anchor"),B=l.paint.get("text-translate-anchor"),H=l.layout.get("icon-rotation-alignment"),U=l.layout.get("text-rotation-alignment"),q=l.layout.get("icon-pitch-alignment"),ee=l.layout.get("text-pitch-alignment"),Q=l.layout.get("icon-keep-upright"),ie=l.layout.get("text-keep-upright"),re=l.paint.get("icon-color-saturation"),ue=l.paint.get("icon-color-contrast"),ge=l.paint.get("icon-color-brightness-min"),pe=l.paint.get("icon-color-brightness-max"),we=l.layout.get("symbol-elevation-reference")==="sea",xe=f.context,be=xe.gl,ve=f.transform,Ie=H==="map",Re=U==="map",Ye=q==="map",$e=ee==="map",Ae=l.layout.get("symbol-sort-key").constantOr(1)!==void 0,ze=!1,at=f.depthModeForSublayer(0,an.ReadOnly),gt=[r.at(ve.center.lng),r.aA(ve.center.lat)],St=l.layout.get("text-variable-anchor"),Ve=ve.projection.name==="globe",dt=[],et=[0,-1,0];for(let Ct of p){let pt=o.getTile(Ct),lt=pt.getBucket(l);if(!lt||lt.projection.name==="mercator"&&Ve||lt.fullyClipped)continue;let Nt=lt.projection.name==="globe",Ht=Nt?r.ae(ve.zoom):0,Lt=hc(Ct,lt.getProjection(),ve),Wt=ve.calculatePixelsToTileUnitsMatrix(pt),Tn=St&&lt.hasTextData(),hn=lt.hasIconTextFit()&&Tn&&lt.hasIconData(),un=lt.getProjection().createInversionMatrix(ve,Ct.canonical),In=bn=>{ve.depthOcclusionForSymbolsAndCircles&&(l.hasInitialOcclusionOpacityProperties||f.terrain)&&(bn.push("DEPTH_D24"),bn.push("DEPTH_OCCLUSION"))},si=()=>{let bn=Ie&&l.layout.get("symbol-placement")!=="point",Ei=[];In(Ei);let Ir=bn||hn,ko=l.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&Ye&&Ei.push("PITCH_WITH_MAP_TERRAIN"),Nt&&(Ei.push("PROJECTION_GLOBE_VIEW"),Ir&&Ei.push("PROJECTED_POS_ON_VIEWPORT")),ko>0&&Ei.push("ICON_TRANSITION"),lt.icon.zOffsetVertexBuffer&&Ei.push("Z_OFFSET"),re===0&&ue===0&&ge===0&&pe===1||Ei.push("COLOR_ADJUSTMENT"),lt.sdfIcons&&Ei.push("RENDER_SDF");let Ks=lt.icon.programConfigurations.get(l.id),es=f.getOrCreateProgram("symbol",{config:Ks,defines:Ei}),To=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],eo=lt.iconSizeData,Br=r.bp(eo,ve.zoom),ar=Ye||ve.pitch!==0,Xi=Jo(Lt,pt.tileID.canonical,Ye,Ie,ve,lt.getProjection(),Wt),fi=Ao(Lt,pt.tileID.canonical,Ye,Ie,ve,lt.getProjection(),Wt),kr=f.translatePosMatrix(fi,pt,D,N,!0),Eo=f.translatePosMatrix(Lt,pt,D,N),nr=Ir?id:Xi,Zo=Ie&&!Ye&&!bn,da=et;!Ve&&!ve.mercatorFromTransition||Ie||(da=pm(ve));let Is=Nt?da:et,Cc=l.getColorAdjustmentMatrix(re,ue,ge,pe),Vl=Ev(eo.kind,Br,Zo,Ye,f,Eo,nr,kr,we,!1,To,[0,0],!0,Ct,Ht,gt,un,Is,lt.getProjection(),Cc,ko),ts=pt.imageAtlasTexture?pt.imageAtlasTexture:null,fa=l.layout.get("icon-size").constantOr(0)!==1||lt.iconsNeedLinear,Mc=lt.sdfIcons||f.options.rotating||f.options.zooming||fa||ar?be.LINEAR:be.NEAREST,fl=lt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,uh=f.terrain&&Ye&&bn?r.ab.mat4.invert(r.ab.mat4.create(),Xi):id;if(bn&&lt.icon){let qf=ve.elevation,$_=qf?qf.getAtTileOffsetFunc(Ct,ve.center.lat,ve.worldSize,lt.getProjection()):null,Am=Al(Lt,pt.tileID.canonical,Ye,Ie,ve,lt.getProjection(),Wt);Uh(lt,Lt,f,!1,Am,fi,Ye,Q,$_,Ct)}return{program:es,buffers:lt.icon,uniformValues:Vl,atlasTexture:ts,atlasTextureIcon:null,atlasInterpolation:Mc,atlasInterpolationIcon:null,isSDF:lt.sdfIcons,hasHalo:fl,tile:pt,labelPlaneMatrixInv:uh}},Gn=()=>{let bn=Re&&l.layout.get("symbol-placement")!=="point",Ei=[],Ir=bn||St||hn;f.terrainRenderModeElevated()&&$e&&Ei.push("PITCH_WITH_MAP_TERRAIN"),Nt&&(Ei.push("PROJECTION_GLOBE_VIEW"),Ir&&Ei.push("PROJECTED_POS_ON_VIEWPORT")),lt.text.zOffsetVertexBuffer&&Ei.push("Z_OFFSET"),lt.iconsInText&&Ei.push("RENDER_TEXT_AND_SYMBOL"),Ei.push("RENDER_SDF"),In(Ei);let ko=lt.text.programConfigurations.get(l.id),Ks=f.getOrCreateProgram("symbol",{config:ko,defines:Ei}),es,To=[0,0],eo=null,Br=lt.textSizeData;lt.iconsInText&&(To=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],eo=pt.imageAtlasTexture?pt.imageAtlasTexture:null,es=$e||ve.pitch!==0||f.options.rotating||f.options.zooming||Br.kind==="composite"||Br.kind==="camera"?be.LINEAR:be.NEAREST);let ar=pt.glyphAtlasTexture?pt.glyphAtlasTexture.size:[0,0],Xi=l.layout.get("text-size-scale-range"),fi=r.aw(f.scaleFactor,Xi[0],Xi[1]),kr=r.bp(Br,ve.zoom,fi),Eo=Jo(Lt,pt.tileID.canonical,$e,Re,ve,lt.getProjection(),Wt),nr=Ao(Lt,pt.tileID.canonical,$e,Re,ve,lt.getProjection(),Wt),Zo=f.translatePosMatrix(nr,pt,k,B,!0),da=f.translatePosMatrix(Lt,pt,k,B),Is=Ir?id:Eo,Cc=Re&&!$e&&!bn,Vl=et;!Ve&&!ve.mercatorFromTransition||Re||(Vl=pm(ve));let ts=Ev(Br.kind,kr,Cc,$e,f,da,Is,Zo,we,!0,ar,To,!0,Ct,Ht,gt,un,Nt?Vl:et,lt.getProjection(),null,null,fi),fa=pt.glyphAtlasTexture?pt.glyphAtlasTexture:null,Mc=be.LINEAR,fl=l.paint.get("text-halo-width").constantOr(1)!==0,uh=f.terrain&&$e&&bn?r.ab.mat4.invert(r.ab.mat4.create(),Eo):id;if(bn&&lt.text){let qf=ve.elevation,$_=qf?qf.getAtTileOffsetFunc(Ct,ve.center.lat,ve.worldSize,lt.getProjection()):null,Am=Al(Lt,pt.tileID.canonical,$e,Re,ve,lt.getProjection(),Wt);Uh(lt,Lt,f,!0,Am,nr,$e,ie,$_,Ct)}return{program:Ks,buffers:lt.text,uniformValues:ts,atlasTexture:fa,atlasTextureIcon:eo,atlasInterpolation:Mc,atlasInterpolationIcon:es,isSDF:!0,hasHalo:fl,tile:pt,labelPlaneMatrixInv:uh}},fr=lt.icon.segments.get().length,tr=lt.text.segments.get().length,Ai=fr&&!C.onlyText?si():null,Bi=tr&&!C.onlyIcons?Gn():null,qn=l.paint.get("icon-opacity").constantOr(1),ci=l.paint.get("text-opacity").constantOr(1);if(Ae&&lt.canOverlap){ze=!0;let bn=qn&&!C.onlyText?lt.icon.segments.get():[],Ei=ci&&!C.onlyIcons?lt.text.segments.get():[];for(let Ir of bn)dt.push({segments:new r.b7([Ir]),sortKey:Ir.sortKey,state:Ai});for(let Ir of Ei)dt.push({segments:new r.b7([Ir]),sortKey:Ir.sortKey,state:Bi})}else C.onlyText||dt.push({segments:qn?lt.icon.segments:new r.b7([]),sortKey:0,state:Ai}),C.onlyIcons||dt.push({segments:ci?lt.text.segments:new r.b7([]),sortKey:0,state:Bi})}ze&&dt.sort((Ct,pt)=>Ct.sortKey-pt.sortKey);for(let Ct of dt){let pt=Ct.state;if(pt)if(f.terrain?f.terrain.setupElevationDraw(pt.tile,pt.program,{useDepthForOcclusion:ve.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:pt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(ve.depthOcclusionForSymbolsAndCircles,pt.program),xe.activeTexture.set(be.TEXTURE0),pt.atlasTexture&&pt.atlasTexture.bind(pt.atlasInterpolation,be.CLAMP_TO_EDGE,!0),pt.atlasTextureIcon&&(xe.activeTexture.set(be.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,be.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,pt.program),pt.hasHalo){let lt=pt.uniformValues;lt.u_is_halo=1,_r(pt.buffers,Ct.segments,l,f,pt.program,at,y,v,lt,2),lt.u_is_halo=0}else{if(pt.isSDF){let lt=pt.uniformValues;pt.hasHalo&&(lt.u_is_halo=1,_r(pt.buffers,Ct.segments,l,f,pt.program,at,y,v,lt,1)),lt.u_is_halo=0}_r(pt.buffers,Ct.segments,l,f,pt.program,at,y,v,pt.uniformValues,1)}}}function _r(f,o,l,p,y,v,C,D,k,N){let B=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];y.draw(p,p.context.gl.TRIANGLES,v,C,D,yn.disabled,k,l.id,f.layoutVertexBuffer,f.indexBuffer,o,l.paint,p.transform.zoom,f.programConfigurations.get(l.id),B,N)}function kf(f,o,l,p,y,v,C){let D=f.context.gl,k=l.paint.get("fill-pattern"),N=l.is3D(),B=N?f.stencilModeFor3D():Sn.disabled,H=k&&k.constantOr(1),U,q,ee,Q,ie;C?(q=H&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=D.LINES):(q=H?"fillPattern":"fill",U=D.TRIANGLES);for(let re of p){let ue=o.getTile(re);if(H&&!ue.patternsLoaded())continue;let ge=ue.getBucket(l);if(!ge)continue;f.prepareDrawTile();let pe=ge.programConfigurations.get(l.id),we=f.isTileAffectedByFog(re),xe=f.getOrCreateProgram(q,{config:pe,overrideFog:we});H&&(f.context.activeTexture.set(D.TEXTURE0),ue.imageAtlasTexture&&ue.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),pe.updatePaintBuffers());let be=k.constantOr(null);if(be&&ue.imageAtlas){let Re=ue.imageAtlas,Ye=r.A.from(be),$e=Re.patternPositions[Ye.getSerializedPrimary()];$e&&pe.setConstantPatternPositions($e)}let ve=f.translatePosMatrix(re.projMatrix,ue,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),Ie=l.paint.get("fill-emissive-strength");if(C){Q=ge.indexBuffer2,ie=ge.segments2;let Re=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];ee=q==="fillOutlinePattern"&&H?om(ve,Ie,f,ue,Re):Cv(ve,Ie,Re)}else Q=ge.indexBuffer,ie=ge.segments,ee=H?nd(ve,Ie,f,ue):rm(ve,Ie);f.uploadCommonUniforms(f.context,xe,re.toUnwrapped()),xe.draw(f,U,y,N?B:f.stencilModeForClipping(re),v,yn.disabled,ee,l.id,ge.layoutVertexBuffer,Q,ie,l.paint,f.transform.zoom,pe,void 0)}}function rd(f,o,l,p,y,v,C,D){l.resetLayerRenderingStats(f);let k=f.context,N=k.gl,B=f.transform,H=l.paint.get("fill-extrusion-pattern"),U=H.constantOr(1),q=l.paint.get("fill-extrusion-opacity"),ee=f.style.enable3dLights(),Q=l.paint.get(ee&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ie=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q],re=l.layout.get("fill-extrusion-edge-radius"),ue=re>0&&!l.paint.get("fill-extrusion-rounded-roof"),ge=ue?0:re,pe=B.projection.name==="globe"?r.d3():0,we=B.projection.name==="globe",xe=we?r.ae(B.zoom):0,be=[r.at(B.center.lng),r.aA(B.center.lat)],ve=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ie=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(ve?null:l.lut).toArray01().slice(0,3),Re=l.paint.get("fill-extrusion-flood-light-intensity"),Ye=l.paint.get("fill-extrusion-vertical-scale"),$e=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ae=l.paint.get("fill-extrusion-height-alignment"),ze=l.paint.get("fill-extrusion-base-alignment"),at=nl(f,l.paint.get("fill-extrusion-cutoff-fade-range")),gt=[],St;we&&gt.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&gt.push("FAUX_AO"),ue&&gt.push("ZERO_ROOF_RADIUS"),D&&gt.push("HAS_CENTROID"),Re>0&&gt.push("FLOOD_LIGHT"),at.shouldRenderCutoff&&gt.push("RENDER_CUTOFF"),$e&&gt.push("RENDER_WALL_MODE");let Ve=f.renderPass==="shadow",dt=f.shadowRenderer,et=Ve&&!!dt;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Ct=[0,0,0];if(dt){let Nt=f.style.directionalLight,Ht=f.style.ambientLight;Nt&&Ht&&(Ct=fs(f.style,Nt,Ht)),Ve||(gt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),dt.useNormalOffset&&gt.push("NORMAL_OFFSET")),St=gt.concat(["SHADOWS_SINGLE_CASCADE"])}let pt=et?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",lt=l.getLayerRenderingStats();for(let Nt of p){let Ht=o.getTile(Nt),Lt=Ht.getBucket(l);if(!Lt||Lt.projection.name!==B.projection.name)continue;let Wt=!1;dt&&(Wt=dt.getMaxCascadeForTile(Nt.toUnwrapped())===0);let Tn=f.isTileAffectedByFog(Nt),hn=Lt.programConfigurations.get(l.id),un=f.getOrCreateProgram(pt,{config:hn,defines:Wt?St:gt,overrideFog:Tn});if(f.terrain&&f.terrain.setupElevationDraw(Ht,un,{useMeterToDem:!0}),!Lt.centroidVertexBuffer){let Bi=un.attributes.a_centroid_pos;Bi!==void 0&&N.vertexAttrib2f(Bi,0,0)}!Ve&&dt&&dt.setupShadows(Ht.tileID.toUnwrapped(),un,"vector-tile",Ht.tileID.overscaledZ),U&&(f.context.activeTexture.set(N.TEXTURE0),Ht.imageAtlasTexture&&Ht.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),hn.updatePaintBuffers());let In=H.constantOr(null);if(In&&Ht.imageAtlas){let Bi=Ht.imageAtlas,qn=r.A.from(In),ci=Bi.patternPositions[qn.getSerializedPrimary()];ci&&hn.setConstantPatternPositions(ci)}let si=l.paint.get("fill-extrusion-vertical-gradient"),Gn=1/Lt.tileToMeter,fr;if(Ve&&dt){if(sd(Ht.tileID,Lt,f))continue;let Bi=dt.calculateShadowPassMatrixFromTile(Ht.tileID.toUnwrapped());fr=g_(Bi,ge,Gn,Ye,Ae,ze)}else{let Bi=f.translatePosMatrix(Nt.expandedProjMatrix,Ht,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),qn=B.projection.createInversionMatrix(B,Nt.canonical);fr=U?Af(Bi,f,si,q,ie,ge,Gn,Nt,Ht,pe,Ae,ze,xe,be,qn,Ie,Ye):im(Bi,f,si,q,ie,ge,Gn,Nt,pe,Ae,ze,xe,be,qn,Ie,Ye,Re,Ct)}f.uploadCommonUniforms(k,un,Nt.toUnwrapped(),null,at);let tr=Lt.segments;if(B.projection.name==="mercator"&&!Ve&&(tr=Lt.getVisibleSegments(Ht.tileID,f.terrain,f.transform.getFrustum(0)),!tr.get().length))continue;if(lt)if(Ve)for(let Bi of tr.get())lt.numRenderedVerticesInShadowPass+=Bi.primitiveLength;else for(let Bi of tr.get())lt.numRenderedVerticesInTransparentPass+=Bi.primitiveLength;let Ai=[];(f.terrain||D)&&Ai.push(Lt.centroidVertexBuffer),we&&Ai.push(Lt.layoutVertexExtBuffer),$e&&Ai.push(Lt.wallVertexBuffer),un.draw(f,k.gl.TRIANGLES,y,v,C,yn.backCCW,fr,l.id,Lt.layoutVertexBuffer,Lt.indexBuffer,tr,l.paint,f.transform.zoom,hn,Ai)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function rh(f,o,l,p,y,v,C,D,k,N,B,H,U,q,ee,Q,ie,re,ue){let ge=f.context,pe=ge.gl,we=f.transform,xe=f.transform.zoom,be=[],ve=nl(f,l.paint.get("fill-extrusion-cutoff-fade-range"));N==="clear"?(be.push("CLEAR_SUBPASS"),ue&&(be.push("CLEAR_FROM_TEXTURE"),ge.activeTexture.set(pe.TEXTURE0),ue.bind(pe.LINEAR,pe.CLAMP_TO_EDGE))):N==="sdf"&&be.push("SDF_SUBPASS"),ie&&be.push("HAS_CENTROID"),ve.shouldRenderCutoff&&be.push("RENDER_CUTOFF");let Ie=l.layout.get("fill-extrusion-edge-radius"),Re=(Ye,$e,Ae,ze,at)=>{let gt=$e.programConfigurations.get(l.id),St=f.isTileAffectedByFog(Ye),Ve=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:gt,defines:be,overrideFog:St}),dt=((Ct,pt,lt,Nt,Ht,Lt,Wt,Tn,hn,un,In)=>({u_matrix:pt,u_opacity:lt,u_ao_pass:Nt?1:0,u_meter_to_tile:Ht,u_ao:Lt,u_flood_light_intensity:Wt,u_flood_light_color:Tn,u_attenuation:hn,u_edge_radius:un,u_fb:0,u_fb_size:In,u_dynamic_offset:1}))(0,ze,B,k,at,[H,U*at],q,ee,Q,xe>=17?0:Ie*at,ue?ue.size[0]:0),et=[];ie&&et.push($e.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ge,Ve,Ye.toUnwrapped(),null,ve),Ve.draw(f,ge.gl.TRIANGLES,y,v,C,D,dt,l.id,$e.vertexBuffer,$e.indexBuffer,Ae,l.paint,xe,gt,et)};for(let Ye of p){let $e=o.getTile(Ye),Ae=$e.getBucket(l);if(!Ae||Ae.projection.name!==we.projection.name||!Ae.groundEffect||Ae.groundEffect&&!Ae.groundEffect.hasData())continue;let ze=Ae.groundEffect,at=1/Ae.tileToMeter;{let gt=f.translatePosMatrix(Ye.projMatrix,$e,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),St=ze.getDefaultSegment();Re(Ye,ze,St,gt,at)}if(re)for(let gt=0;gt<4;gt++){let St=r.d4[gt](Ye),Ve=o.getTile(St);if(!Ve)continue;let dt=Ve.getBucket(l);if(!dt||dt.projection.name!==we.projection.name||!dt.groundEffect||dt.groundEffect&&!dt.groundEffect.hasData())continue;let et=dt.groundEffect,Ct,pt;gt===0?(Ct=[-r.ag,0,0],pt=1):gt===1?(Ct=[r.ag,0,0],pt=0):gt===2?(Ct=[0,-r.ag,0],pt=3):(Ct=[0,r.ag,0],pt=2);let lt=et.regionSegments[pt];if(!lt)continue;let Nt=new Float32Array(16);r.ab.mat4.translate(Nt,Ye.projMatrix,Ct),Re(Ye,et,lt,f.translatePosMatrix(Nt,$e,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),at)}}}function Dv(f,o,l,p,y,v,C){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();let D=v?v.findDEMTileFor(l):null;if(!(D&&D.dem||C))return;v&&D&&D.dem&&p.selfDEMTileTimestamp!==D.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=D.dem._timestamp);let k=re=>new r.P(Math.ceil((re+r.d7)*r.d8),0),N=re=>{let ue=o.getSource().minzoom,ge=we=>{let xe=o.getTileByID(we);if(xe&&xe.hasData())return xe.getBucket(y)},pe=[0,-1,1];for(let we of pe){if(re.overscaledZ+we<ue)continue;let xe=ge(re.calculateScaledKey(re.overscaledZ+we));if(xe)return xe}},B=[0,0,0],H=(re,ue)=>(B[0]=Math.min(re.min.y,ue.min.y),B[1]=Math.max(re.max.y,ue.max.y),B[2]=r.ag-ue.min.x>re.max.x?ue.min.x-r.ag:re.max.x,B),U=(re,ue)=>(B[0]=Math.min(re.min.x,ue.min.x),B[1]=Math.max(re.max.x,ue.max.x),B[2]=r.ag-ue.min.y>re.max.y?ue.min.y-r.ag:re.max.y,B),q=[(re,ue)=>H(re,ue),(re,ue)=>H(ue,re),(re,ue)=>U(re,ue),(re,ue)=>U(ue,re)],ee=(re,ue,ge,pe,we,xe,be)=>{if(!v)return 0;let ve=[[xe?ge:re,xe?re:ge,0],[xe?ge:ue,xe?ue:ge,0]],Ie=be<0?r.ag+be:be,Re=[xe?Ie:(re+ue)/2,xe?(re+ue)/2:Ie,0];return ge===0&&be<0||ge!==0&&be>0?v.getForTilePoints(we,[Re],!0,pe):ve.push(Re),v.getForTilePoints(l,ve,!0,D),Math.max(ve[0][2],ve[1][2],Re[2])/v.exaggeration()};for(let re=0;re<4;re++){let ue=p.borderFeatureIndices[re];if(ue.length===0)continue;let ge=r.d4[re](l),pe=N(ge);if(!(pe&&pe instanceof r.d5))continue;let we=v?v.findDEMTileFor(ge):null;if(!(we&&we.dem||C)||(v&&we&&we.dem&&p.borderDEMTileTimestamp[re]!==we.dem._timestamp&&(p.borderDoneWithNeighborZ[re]=-1,p.borderDEMTileTimestamp[re]=we.dem._timestamp),p.borderDoneWithNeighborZ[re]===pe.canonical.z))continue;pe.centroidVertexArray.length===0&&pe.createCentroidsBuffer();let xe=(re<2?1:5)-re,be=pe.borderDoneWithNeighborZ[xe]!==p.canonical.z,ve=pe.borderFeatureIndices[xe],Ie=0;if(p.canonical.z!==pe.canonical.z){for(let Re of ue)p.showCentroid(p.featuresOnBorder[Re]);if(be)for(let Re of ve)pe.showCentroid(pe.featuresOnBorder[Re]);p.borderDoneWithNeighborZ[re]=pe.canonical.z,pe.borderDoneWithNeighborZ[xe]=p.canonical.z}for(let Re of ue){let Ye=p.featuresOnBorder[Re],$e=p.centroidData[Ye.centroidDataIndex],Ae=Ye.borders[re],ze;for(;Ie<ve.length;){ze=pe.featuresOnBorder[ve[Ie]];let at=ze.borders[xe];if(at[1]>Ae[0]+3||at[0]>Ae[0]-3)break;pe.showCentroid(ze),Ie++}if(ze&&Ie<ve.length){let at=Ie,gt=0;for(;!(ze.borders[xe][0]>Ae[1]-3)&&(gt++,++Ie!==ve.length);)ze=pe.featuresOnBorder[ve[Ie]];ze=pe.featuresOnBorder[ve[at]];let St=!1;if(gt>=1){let et=ze.borders[xe];Math.abs(Ae[0]-et[0])<3&&Math.abs(Ae[1]-et[1])<3&&(gt=1,St=!0,Ie=at+1)}else if(gt===0){p.showCentroid(Ye);continue}let Ve=pe.centroidData[ze.centroidDataIndex];C&&St&&(((Q=$e).flags|(ie=Ve).flags)&r.d6?(Q.flags|=r.d6,ie.flags|=r.d6):(Q.flags&=~r.d6,ie.flags&=~r.d6));let dt=Ye.intersectsCount()>1||ze.intersectsCount()>1;if(gt>1)Ie=at,$e.centroidXY=Ve.centroidXY=new r.P(0,0);else if(we&&we.dem&&!dt){let et=q[re]($e,Ve),Ct=re%2?r.ag-1:0,pt=ee(et[0],Math.min(r.ag-1,et[1]),Ct,we,ge,re<2,et[2]);$e.centroidXY=Ve.centroidXY=k(pt)}else dt?$e.centroidXY=Ve.centroidXY=new r.P(0,0):($e.centroidXY=p.encodeBorderCentroid(Ye),Ve.centroidXY=pe.encodeBorderCentroid(ze));p.writeCentroidToBuffer($e),pe.writeCentroidToBuffer(Ve)}else p.showCentroid(Ye)}p.borderDoneWithNeighborZ[re]=pe.canonical.z,pe.borderDoneWithNeighborZ[xe]=p.canonical.z}var Q,ie;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}let Ov=[1,0,0],kC=[0,1,0],od=[0,0,1];function sd(f,o,l){let p=l.transform,y=l.shadowRenderer;if(!y)return!0;let v=f.toUnwrapped(),C=p.tileSize*y._cascades[l.currentShadowCascade].scale,D=o.maxHeight;if(p.elevation){let Q=p.elevation.getMinMaxForTile(f);Q&&(D+=Q.max)}let k=[...y.shadowDirection];k[2]=-k[2];let N=y.computeSimplifiedTileShadowVolume(v,D,C,k);if(!N)return!1;let B=[Ov,kC,od,k,[k[0],0,k[2]],[0,k[1],k[2]]],H=p.projection.name==="globe",U=p.scaleZoom(C),q=r.bR.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,U,!H),ee=y.getCurrentCascadeFrustum();return q.intersectsPrecise(N.vertices,N.planes,B)===0||ee.intersectsPrecise(N.vertices,N.planes,B)===0}function Et(f){return[f[0]*r.d9,f[1]*r.d9,f[2]*r.d9,0]}function Gt(f,o,l,p,y,v,C,D,k){let N=p.getSource(),B=l.globeSharedBuffers;if(!B)return;let H,U,q;if(o&&(H=p.getTile(o)),N instanceof r.aJ?(U=N.texture,q=r.cI(0,0,l.transform)):H&&o&&(U=H.texture,q=r.cI(o.canonical.z,o.canonical.x,l.transform)),!U||!q)return;f||(q=r.ab.mat4.scale(r.ab.mat4.create(),q,[1,-1,1]));let ee=l.context,Q=ee.gl,ie=y.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR,re=l.colorModeForDrapableLayerRenderPass(v),ue=C.defines;ue.push("GLOBE_POLES");let ge=new an(Q.LEQUAL,an.ReadWrite,l.depthRangeFor3D),pe=Float32Array.from(l.transform.expandedFarZProjMatrix),we=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),ee.activeTexture.set(Q.TEXTURE0),U.bind(ie,Q.CLAMP_TO_EDGE),ee.activeTexture.set(Q.TEXTURE1),U.bind(ie,Q.CLAMP_TO_EDGE),U.useMipmap&&ee.extTextureFilterAnisotropic&&l.transform.pitch>20&&Q.texParameterf(Q.TEXTURE_2D,ee.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ee.extTextureFilterAnisotropicMax);let[xe,be,ve,Ie]=o?B.getPoleBuffers(o.canonical.z,!1):B.getPoleBuffers(0,!0),Re=y.paint.get("raster-elevation"),Ye;f?(Ye=xe,l.renderDefaultNorthPole=Re!==0):(Ye=be,l.renderDefaultSouthPole=Re!==0);let $e=Et(C.mix),Ae=((at,gt,St,Ve,dt,et,Ct,pt,lt,Nt,Ht,Lt,Wt)=>Xt(at,gt,St,new Float32Array(16),new Float32Array(9),[0,0],Ve,[0,0],[0,0,0,0],1,{opacity:1,mix:0},et,[0,0],pt,2,Nt,Ht,Lt,1,0,Wt))(pe,we,q,r.ae(l.transform.zoom),0,y,0,Re,0,$e,C.offset,C.range,v),ze=l.getOrCreateProgram("raster",{defines:ue});l.uploadCommonUniforms(ee,ze,null),ze.draw(l,Q.TRIANGLES,ge,k,re,D,Ae,y.id,Ye,ve,Ie)}function ad(f){let o=f._nearZ,l=f.projection.farthestPixelDistance(f),p=l-o,y=.2*f.height,v=o+y;return[o,l,(v-y-o)/p,(v-o)/p]}function Ar(f,o,l,p){if(f)return o instanceof hr&&f instanceof Kc?o.getTextureDescriptor(f,l,!0):{texture:f.texture,mix:Et(p.mix),offset:p.offset,buffer:0,tileSize:1}}var qe=r.da([{name:"a_index",type:"Int16",components:1}]);class Av{constructor(o,l,p,y){let v={width:p[0],height:p[1],data:null},C=o.gl;this.targetColorTexture=new r.T(o,v,C.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(o,v,C.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(l,y),this.lastInvalidatedAt=0}updateParticleTexture(o,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let p=this.context.gl,y=l.width*l.height;this.particleTexture0=new r.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1});let v=new r.db;v.reserve(y);for(let C=0;C<y;C++)v.emplaceBack(C);this.particleIndexBuffer=this.context.createVertexBuffer(v,qe.members,!0),this.particleSegment=r.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function mm(f,o,l){if(!f)return null;let p=o.getTextureDescriptor(f,l,!0);if(!p)return null;let{texture:y,mix:v,offset:C,tileSize:D,buffer:k,format:N}=p;if(!y||!N)return null;let B=!1;return N==="uint32"&&(B=!0,v[3]=0,v=eh(r.dc,v,[0,l.paint.get("raster-particle-max-speed")]),C=Rf(r.dc,C,[0,l.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[k/(D+2*k),D/(D+2*k)],tileSize:D,scalarData:B,scale:v,offset:C,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function b_(f){let o=f._nearZ,l=f.projection.farthestPixelDistance(f),p=l-o,y=.2*f.height,v=o+y;return[o,l,(v-y-o)/p,(v-o)/p]}let Rv=new r.aj(1,0,0,1),kv=new r.aj(0,1,0,1),Lv=new r.aj(0,0,1,1),ld=new r.aj(1,0,1,1),LC=new r.aj(0,1,1,1);function cd(f,o,l,p,y,v,C){let D=f.context,k=f.transform,N=D.gl,B=k.projection.name==="globe",H=B?["PROJECTION_GLOBE_VIEW"]:[],U=r.ab.mat4.clone(l.projMatrix);if(B&&r.ae(k.zoom)>0){let $e=r.ba(l.canonical,k),Ae=r.dd($e);U=r.ab.mat4.multiply(new Float32Array(16),k.globeMatrix,Ae),r.ab.mat4.multiply(U,k.projMatrix,U)}let q=r.ab.mat4.create();q[12]+=2*y/(r.q.devicePixelRatio*k.width),q[13]+=2*v/(r.q.devicePixelRatio*k.height),r.ab.mat4.multiply(U,q,U);let ee=f.getOrCreateProgram("debug",{defines:H}),Q=o.getTileByID(l.key);f.terrain&&f.terrain.setupElevationDraw(Q,ee);let ie=an.disabled,re=Sn.disabled,ue=f.colorModeForRenderPass(),ge="$debug";D.activeTexture.set(N.TEXTURE0),f.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),B?Q._makeGlobeTileDebugBuffers(f.context,k):Q._makeDebugTileBoundsBuffers(f.context,k.projection);let pe=Q._tileDebugBuffer||f.debugBuffer,we=Q._tileDebugIndexBuffer||f.debugIndexBuffer,xe=Q._tileDebugSegments||f.debugSegments;if(ee.draw(f,N.LINE_STRIP,ie,re,ue,yn.disabled,am(U,p),ge,pe,we,xe,null,null,null,[Q._globeTileDebugBorderBuffer]),C){let $e=Q.latestRawTileData,Ae=Math.floor(($e&&$e.byteLength||0)/1024),ze=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ze+=` => ${l.overscaledZ}`),ze+=` ${Q.state}`,ze+=` ${Ae}kb`,function(at,gt){at.initDebugOverlayCanvas();let St=at.debugOverlayCanvas,Ve=at.context.gl,dt=at.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,St.width,St.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(gt,5,5),dt.strokeText(gt,5,5),at.debugOverlayTexture.update(St),at.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(f,ze)}let be=o.getTile(l).tileSize,ve=512/Math.min(be,512)*(l.overscaledZ/k.zoom)*.5,Ie=Q._tileDebugTextBuffer||f.debugBuffer,Re=Q._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Ye=Q._tileDebugTextSegments||f.debugSegments;ee.draw(f,N.TRIANGLES,ie,re,$n.alphaBlended,yn.disabled,am(U,r.aj.transparent,ve),ge,Ie,Re,Ye,null,null,null,[Q._globeTileDebugTextBuffer])}function w_(f,o,l,p){ud(f,0,o+l/2,f.transform.width,l,p)}function Lf(f,o,l,p){ud(f,o-l/2,0,l,f.transform.height,p)}function ud(f,o,l,p,y,v){let C=f.context,D=C.gl;D.enable(D.SCISSOR_TEST),D.scissor(o*r.q.devicePixelRatio,l*r.q.devicePixelRatio,p*r.q.devicePixelRatio,y*r.q.devicePixelRatio),C.clear({color:v}),D.disable(D.SCISSOR_TEST)}let Fv=r.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Nv}=Fv;function ul(f,o,l,p){f.emplaceBack(o,l,p)}class Ff{constructor(o){this.vertexArray=new r.de,this.indices=new r.aU,ul(this.vertexArray,-1,-1,1),ul(this.vertexArray,1,-1,1),ul(this.vertexArray,-1,1,1),ul(this.vertexArray,1,1,1),ul(this.vertexArray,-1,-1,-1),ul(this.vertexArray,1,-1,-1),ul(this.vertexArray,-1,1,-1),ul(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Nv),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=r.b7.simpleSegment(0,0,36,12)}}function Es(f,o,l,p,y,v){let C=f.context.gl,D=o.paint.get("sky-atmosphere-color"),k=o.paint.get("sky-atmosphere-halo-color"),N=o.paint.get("sky-atmosphere-sun-intensity"),B=((H,U,q,ee,Q)=>({u_matrix_3f:H,u_sun_direction:U,u_sun_intensity:q,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(r.ab.mat3.fromMat4(r.ab.mat3.create(),p),y,N,D,k);C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+v,o.skyboxTexture,0),l.draw(f,C.TRIANGLES,an.disabled,Sn.disabled,$n.unblended,yn.frontCW,B,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}let zv=r.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class FC{constructor(o){let l=new r.df;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);let p=new r.aU;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(l,zv.members),this.indexBuffer=o.createIndexBuffer(p),this.segments=r.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Ss=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class NC{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Nf{constructor(o){this.colorModeAlphaBlendedWriteRGB=new $n([1,Fl,1,Fl],r.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new $n([1,0,1,0],r.aj.transparent,[!1,!1,!1,!0]),this.params=new NC,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){let l=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new FC(l);let p=this.params.sizeRange,y=this.params.intensityRange,v=function(B){let H=r.di(30),U=[];for(let q=0;q<B;++q){let ee=2*Math.PI*H(),Q=Math.acos(1-2*H())-.5*Math.PI;U.push(r.ab.vec3.fromValues(Math.cos(Q)*Math.cos(ee),Math.cos(Q)*Math.sin(ee),Math.sin(Q)))}return U}(this.params.starsCount),C=r.di(300),D=new r.dg,k=new r.aU,N=0;for(let B=0;B<v.length;++B){let H=r.ab.vec3.scale([],v[B],200),U=Math.max(0,1+.01*p*(1*C()-.5)),q=Math.max(0,1+.01*y*(1*C()-.5));D.emplaceBack(H[0],H[1],H[2],-1,-1,U,q),D.emplaceBack(H[0],H[1],H[2],1,-1,U,q),D.emplaceBack(H[0],H[1],H[2],1,1,U,q),D.emplaceBack(H[0],H[1],H[2],-1,1,U,q),k.emplaceBack(N+0,N+1,N+2),k.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=l.createVertexBuffer(D,Ss.members),this.starsIdx=l.createIndexBuffer(k),this.starsSegments=r.b7.simpleSegment(0,0,D.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,l){let p=o.context,y=p.gl,v=o.transform,C=new an(y.LEQUAL,an.ReadOnly,[0,1]),D=r.ae(v.zoom),k=o.style.getLut(l.scope),N=l.properties.get("color-use-theme")==="none",B=l.properties.get("color").toRenderColor(N?null:k).toArray01(),H=l.properties.get("high-color-use-theme")==="none",U=l.properties.get("high-color").toRenderColor(H?null:k).toArray01(),q=l.properties.get("space-color-use-theme")==="none",ee=l.properties.get("space-color").toRenderColor(q?null:k).toArray01PremultipliedAlpha(),Q=5e-4,ie=r.dh(l.properties.get("horizon-blend"),0,1,Q,.25),re=r.cC(o,p,v)&&ie===Q?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,ue=o.frameCounter/1e3%1,ge=r.ab.vec3.length(v.globeCenterInViewSpace),pe=Math.sqrt(Math.pow(ge,2)-Math.pow(re,2)),we=Math.acos(pe/ge),xe=be=>{let ve=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];be&&ve.push("ALPHA_PASS");let Ie=o.getOrCreateProgram("globeAtmosphere",{defines:ve}),Re=(($e,Ae,ze,at,gt,St,Ve,dt,et,Ct,pt,lt)=>({u_frustum_tl:$e,u_frustum_tr:Ae,u_frustum_br:ze,u_frustum_bl:at,u_horizon:gt,u_transition:St,u_fadeout_range:Ve,u_color:dt,u_high_color:et,u_space_color:Ct,u_temporal_offset:pt,u_horizon_angle:lt}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,D,ie,B,U,ee,ue,we);o.uploadCommonUniforms(p,Ie);let Ye=this.atmosphereBuffer;Ye&&Ie.draw(o,y.TRIANGLES,C,Sn.disabled,be?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,yn.backCW,Re,be?"atmosphere_glow_alpha":"atmosphere_glow",Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)};xe(!1),xe(!0)}drawStars(o,l){let p=r.aw(l.properties.get("star-intensity"),0,1);if(p===0)return;let y=o.context,v=y.gl,C=o.transform,D=o.getOrCreateProgram("stars"),k=r.ab.quat.identity([]);r.ab.quat.rotateX(k,k,-C._pitch),r.ab.quat.rotateZ(k,k,-C.angle),r.ab.quat.rotateX(k,k,r.ai(C._center.lat)),r.ab.quat.rotateY(k,k,-r.ai(C._center.lng));let N=r.ab.mat4.fromQuat(new Float32Array(16),k),B=r.ab.mat4.multiply([],C.starsProjMatrix,N),H=r.ab.mat3.fromMat4([],N),U=r.ab.mat3.invert([],H),q=[0,1,0];r.ab.vec3.transformMat3(q,q,U),r.ab.vec3.scale(q,q,this.params.sizeMultiplier);let ee=[1,0,0];r.ab.vec3.transformMat3(ee,ee,U),r.ab.vec3.scale(ee,ee,this.params.sizeMultiplier);let Q=(ie=q,re=ee,ue=p,{u_matrix:Float32Array.from(B),u_up:ie,u_right:re,u_intensity_multiplier:ue});var ie,re,ue;o.uploadCommonUniforms(y,D),this.starsVx&&this.starsIdx&&D.draw(o,v.TRIANGLES,an.disabled,Sn.disabled,this.colorModeAlphaBlendedWriteRGB,yn.disabled,Q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function sr(f,o){let l=[...f],p=o.cameraWorldSizeForFog/o.worldSize,y=r.ab.mat4.identity([]);return r.ab.mat4.scale(y,y,[p,p,1]),r.ab.mat4.multiply(l,y,l),r.ab.mat4.multiply(l,o.worldToFogMatrix,l),l}function Ti(f,o,l,p,y){let v=l.material,C=p.context,{baseColorTexture:D,metallicRoughnessTexture:k}=v.pbrMetallicRoughness,{normalTexture:N,occlusionTexture:B,emissionTexture:H}=v;function U(ee,Q,ie){if(ee&&(f.push(Q),C.activeTexture.set(C.gl.TEXTURE0+ie),ee.gfxTexture)){let{minFilter:re,magFilter:ue,wrapS:ge,wrapT:pe}=ee.sampler;ee.gfxTexture.bindExtraParam(re,ue,ge,pe)}}U(D,"HAS_TEXTURE_u_baseColorTexture",Co.BaseColor),U(k,"HAS_TEXTURE_u_metallicRoughnessTexture",Co.MetallicRoughness),U(N,"HAS_TEXTURE_u_normalTexture",Co.Normal),U(B,"HAS_TEXTURE_u_occlusionTexture",Co.Occlusion),U(H,"HAS_TEXTURE_u_emissionTexture",Co.Emission),y&&(y.texture||(y.texture=new r.dk(p.context,y.image,[y.image.height,y.image.height,y.image.height],C.gl.RGBA8)),C.activeTexture.set(C.gl.TEXTURE0+Co.LUT),y.texture&&y.texture.bind(C.gl.LINEAR,C.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(l.texcoordBuffer)),l.colorBuffer&&(f.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(l.colorBuffer)),l.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(l.normalBuffer)),l.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(l.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES");let q=p.shadowRenderer;q&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&f.push("NORMAL_OFFSET"))}function zf(f,o,l,p,y,v){let C=l.paint.get("model-opacity").constantOr(1),D=o.context,k=new an(o.context.gl.LEQUAL,an.ReadWrite,o.depthRangeFor3D),N=o.transform,B=f.mesh,H=B.material,U=H.pbrMetallicRoughness,q=o.style.fog,ee;ee=o.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:r.ab.mat4.multiply([],p.zScaleMatrix,f.nodeModelMatrix),r.ab.mat4.multiply(ee,p.negCameraPosMatrix,ee);let Q=r.ab.mat4.invert([],ee);r.ab.mat4.transpose(Q,Q);let ie=l.paint.get("model-color-use-theme").constantOr("default")==="none",re=l.paint.get("model-emissive-strength").constantOr(0),ue=hm(new Float32Array(f.worldViewProjection),new Float32Array(ee),new Float32Array(Q),null,o,C,U.baseColorFactor.toRenderColor(null),H.emissiveFactor,U.metallicFactor,U.roughnessFactor,H,re,l),ge={defines:[]},pe=[],we=o.shadowRenderer;we&&(we.useNormalOffset=!1),Ti(ge.defines,pe,B,o,ie?null:l.lut);let xe=null;if(q){let Ie=sr(f.nodeModelMatrix,o.transform);if(xe=new Float32Array(Ie),N.projection.name!=="globe"){let Re=B.aabb.min,Ye=B.aabb.max,[$e,Ae]=q.getOpacityForBounds(Ie,Re[0],Re[1],Ye[0],Ye[1]);ge.overrideFog=$e>=$t||Ae>=$t}}let be=nl(o,l.paint.get("model-cutoff-fade-range"));be.shouldRenderCutoff&&ge.defines.push("RENDER_CUTOFF");let ve=o.getOrCreateProgram("model",ge);o.uploadCommonUniforms(D,ve,null,xe,be),o.renderPass!=="shadow"&&we&&we.setupShadowsFromMatrix(f.nodeModelMatrix,ve),ve.draw(o,D.gl.TRIANGLES,k,y,v,B.material.doubleSided?yn.disabled:yn.backCCW,ue,l.id,B.vertexBuffer,B.indexBuffer,B.segments,l.paint,o.transform.zoom,void 0,pe)}function yc(f,o,l,p,y,v,C){let D;D=f.projection.name==="globe"?r.dl(l,f):[...l],r.ab.mat4.multiply(D,D,o.matrix);let k=r.ab.mat4.multiply([],p,D);if(o.meshes)for(let N of o.meshes){if(N.material.alphaMode!=="BLEND"){C.push({mesh:N,depth:0,modelIndex:y,worldViewProjection:k,nodeModelMatrix:D});continue}let B=r.ab.vec3.transformMat4([],N.centroid,k);B[2]>0&&v.push({mesh:N,depth:B[2],modelIndex:y,worldViewProjection:k,nodeModelMatrix:D})}if(o.children)for(let N of o.children)yc(f,N,l,p,y,v,C)}function hd(f,o,l,p){let y=l.shadowRenderer;if(!y)return;let v=y.getShadowPassDepthMode(),C=y.getShadowPassColorMode(),D=y.calculateShadowPassMatrixFromMatrix(o),k=Iv(D);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,v,Sn.disabled,C,yn.backCCW,k,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,l.transform.zoom,void 0,void 0)}function dd(f,o,l){let p=o.updateZoomBasedPaintProperties(),y=function(v,C,D){let k,N,B,H=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&H>0){let U=v.terrain,q=U.findDEMTileFor(D);q&&q.dem?k=r.dn.create(U,D,q):H=0}if(H===0&&(C.terrainElevationMin=0,C.terrainElevationMax=0),H===C.validForExaggeration&&(H===0||k&&k._demTile&&k._demTile.tileID===C.validForDEMTile.id&&k._dem._timestamp===C.validForDEMTile.timestamp))return!1;for(let U in C.instancesPerModel){let q=C.instancesPerModel[U];for(let ee=0;ee<q.instancedDataArray.length;++ee){let Q=(k?H*k.getElevationAt(0|q.instancedDataArray.float32[16*ee],0|q.instancedDataArray.float32[16*ee+1],!0,!0):0)+q.instancesEvaluatedElevation[ee];q.instancedDataArray.float32[16*ee+6]=Q,N=N?Math.min(C.terrainElevationMin,Q):Q,B=B?Math.max(C.terrainElevationMax,Q):Q}}return C.terrainElevationMin=N||0,C.terrainElevationMax=B||0,C.validForExaggeration=H,C.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,o,l);(p||y)&&(o.uploaded=!1,o.upload(f.context))}let Na={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cd([0,0,0],[r.ag,r.ag,0])};function C_(f,o){let l=1<<f.canonical.z,p=o.getFreeCameraOptions().position,y=o.elevation,v=f.canonical.x/l,C=(f.canonical.x+1)/l,D=f.canonical.y/l,k=(f.canonical.y+1)/l,N=o._centerAltitude;if(y){let q=y.getMinMaxForTile(f);q&&q.max>N&&(N=q.max)}let B=r.aw(p.x,v,C)-p.x,H=r.aw(p.y,D,k)-p.y,U=r.bH(N,o.center.lat)-p.z;return o._zoomFromMercatorZ(Math.sqrt(B*B+H*H+U*U))}function vc(f,o,l,p,y,v,C){let D=f.context,k=f.renderPass==="shadow",N=f.shadowRenderer,B=k&&N?N.getShadowPassDepthMode():new an(D.gl.LEQUAL,an.ReadWrite,f.depthRangeFor3D),H=f.isTileAffectedByFog(v);if(l.meshes)for(let U of l.meshes){let q=["MODEL_POSITION_ON_GPU"],ee=[],Q,ie,re;p.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");let ue=nl(f,o.paint.get("model-cutoff-fade-range"));if(ue.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),k&&N)Q=f.getOrCreateProgram("modelDepth",{defines:q}),ie=Iv(C.shadowTileMatrix,C.shadowTileMatrix,Float32Array.from(l.matrix)),re=N.getShadowPassColorMode();else{Ti(q,ee,U,f,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),Q=f.getOrCreateProgram("model",{defines:q,overrideFog:H});let pe=U.material,we=pe.pbrMetallicRoughness,xe=o.paint.get("model-opacity").constantOr(1),be=o.paint.get("model-emissive-strength").constantOr(0);ie=hm(v.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,f,xe,we.baseColorFactor.toRenderColor(null),pe.emissiveFactor,we.metallicFactor,we.roughnessFactor,pe,be,o,y),N&&(C.shadowUniformsInitialized?Q.setShadowUniformValues(D,N.getShadowUniformValues()):(N.setupShadows(v.toUnwrapped(),Q,"model-tile",v.overscaledZ),C.shadowUniformsInitialized=!0)),re=ue.shouldRenderCutoff||xe<1||pe.alphaMode!=="OPAQUE"?$n.alphaBlended:$n.unblended}f.uploadCommonUniforms(D,Q,v.toUnwrapped(),null,ue);let ge=U.material.doubleSided?yn.disabled:yn.backCCW;if(p.instancedDataArray.length>20)ee.push(p.instancedDataBuffer),Q.draw(f,D.gl.TRIANGLES,B,Sn.disabled,re,ge,ie,o.id,U.vertexBuffer,U.indexBuffer,U.segments,o.paint,f.transform.zoom,void 0,ee,p.instancedDataArray.length);else{let pe=k?"u_instance":"u_normal_matrix";for(let we=0;we<p.instancedDataArray.length;++we)ie[pe]=new Float32Array(p.instancedDataArray.arrayBuffer,64*we,16),Q.draw(f,D.gl.TRIANGLES,B,Sn.disabled,re,ge,ie,o.id,U.vertexBuffer,U.indexBuffer,U.segments,o.paint,f.transform.zoom,void 0,ee)}}if(l.children)for(let U of l.children)vc(f,o,U,p,y,v,C)}let lu=[1,-1,1];function cu(f,o,l,p){if(!l.modelManager)return!0;let y=l.modelManager;if(!l.shadowRenderer)return!0;let v=l.shadowRenderer,C=o.aabb,D=!0,k=f.maxHeight;if(k===0){let B=0;for(let H in f.instancesPerModel){let U=y.getModel(H,p);U?B=Math.max(B,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):D=!1}k=f.maxScale*B*1.41+f.maxVerticalOffset,D&&(f.maxHeight=k)}C.max[2]=k,C.min[2]+=f.terrainElevationMin,C.max[2]+=f.terrainElevationMax,r.ab.vec3.transformMat4(C.min,C.min,o.tileMatrix),r.ab.vec3.transformMat4(C.max,C.max,o.tileMatrix);let N=C.intersects(v.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=N===2),N===0}function gm(f,o){let l=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],y=f.uniformValues.u_cutoff_params[2],v=f.uniformValues.u_cutoff_params[3];return p===l||v===y?1:r.aw(((o-l)/(p-l)-y)/(v-y),0,1)}function _m(f,o,l,p){if(o.pitch<20)return 1;let y=o.getWorldToCameraMatrix();r.ab.mat4.multiply(y,y,f);let v=r.ab.vec4.fromValues(l.min[0],l.min[1],l.min[2],1),C=r.ab.vec4.transformMat4(r.ab.vec4.create(),v,y),D=C,k=C;v[1]=l.max[1],C=r.ab.vec4.transformMat4(r.ab.vec4.create(),v,y),D=C[1]<D[1]?C:D,k=C[1]>k[1]?C:k,v[0]=l.max[0],C=r.ab.vec4.transformMat4(r.ab.vec4.create(),v,y),D=C[1]<D[1]?C:D,k=C[1]>k[1]?C:k,v[1]=l.min[1],C=r.ab.vec4.transformMat4(r.ab.vec4.create(),v,y),D=C[1]<D[1]?C:D,k=C[1]>k[1]?C:k;let N=r.aw(p[0],0,1),B=100*o.pixelsPerMeter*r.aw(p[1],0,1),H=r.aw(p[2],0,1),U=r.ab.vec4.lerp(r.ab.vec4.create(),D,k,N),q=Math.tan(.5*o.fovX),ee=-U[2]*q;if(B===0)return U[1]<-Math.abs(ee)?H:1;let Q=(-Math.abs(ee)-U[1])/B,ie=(ue,ge,pe)=>(1-pe)*ue+pe*ge,re=r.aw(ie(1,H,Q),H,1);return ie(1,re,r.aw((o.pitch-20)/20,0,1))}class M_{}class T_{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,l,p){{let H=this._storage.get(l.id);if(H)return H.lastUsedFrameIdx=o,H.buf}let y=p.gl,v=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),C=new ArrayBuffer(v),D=new Int16Array(C);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(C));let k=new r.dq;for(let H=0;H<v/2;H+=3){let U=D[H],q=D[H+1],ee=D[H+2];k.emplaceBack(U,q),k.emplaceBack(q,ee),k.emplaceBack(ee,U)}let N=p.bindVertexArrayOES.current,B=new M_;return B.buf=new dm(p,k),B.lastUsedFrameIdx=o,this._storage.set(l.id,B),p.bindVertexArrayOES.set(N),B.buf}update(o){for(let[l,p]of this._storage)o-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(l))}destroy(){for(let[o,l]of this._storage)l.buf.destroy(),this._storage.delete(o)}}class E_{constructor(o){this.occluderSize=30,this.depthOffset=-1e-4,o.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}let uu=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class S_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Bf{constructor(o,l){this.revealStart=11,this.revealRange=2,o.registerParameter(this,[...l,"Reveal"],"revealStart",{min:0,max:17,step:.05}),o.registerParameter(this,[...l,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}let I_=r.da([{type:"Float32",name:"a_pos_2f",components:2}]);class P_{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,l){let p=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){let C=new r.dr,D=new r.aU;C.emplaceBack(-1,-1),C.emplaceBack(1,-1),C.emplaceBack(1,1),C.emplaceBack(-1,1),D.emplaceBack(0,1,2),D.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(C,I_.members),this.vignetteIdx=o.context.createIndexBuffer(D)}let y=r.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,p);let C={u_vignetteShape:(v={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};p.draw(o,o.context.gl.TRIANGLES,an.disabled,Sn.disabled,$n.alphaBlended,yn.disabled,C,"vignette",this.vignetteVx,this.vignetteIdx,y,{})}var v}}class qo{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,l){let p=o.getFreeCameraOptions().position,y=p.toAltitude(),v=p.toLngLat(),C=r.ai(v.lng),D=r.ai(v.lat),k=o.pixelsPerMeter/l,N=C*r.ds,B=r.ds*Math.log(Math.tan(Math.PI/4+D/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{let H=-this._offsetYPrev+B,U=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+N)*k,this._accumulatedOffsetY+=H*k,this._accumulatedElevation+=U*k,this._offsetXPrev=N,this._offsetYPrev=B,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ym(f,o){return[-(f[0]-Math.floor(f[0]/o)*o),-(f[1]-Math.floor(f[1]/o)*o),-(f[2]-Math.floor(f[2]/o)*o)]}function vm(f){let o=r.di(1323123451230),l=[];for(let p=0;p<f;++p){let y=2*o()-1,v=2*o()-1,C=2*o()-1;l.push(r.ab.vec3.fromValues(y,v,C))}return l}function za(f,o,l,p,y){let v=r.aw((y-l)/(p-l),0,1);return(1-v)*f+v*o}class hu{constructor(o){this._movement=new qo,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new P_,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,l){let p=o.transform;this._movement.update(p,this._ppmScaleFactor);let y=p.starsProjMatrix,v=r.ab.quat.identity([]);r.ab.quat.rotateX(v,v,r.ai(90)-p._pitch),r.ab.quat.rotateZ(v,v,-p.angle);let C=r.ab.mat4.fromQuat(new Float32Array(16),v),D=r.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),k=r.ab.mat4.transpose([],D),N=r.ab.mat4.multiply([],k,C),B=Date.now()/1e3;return this._accumulatedTimeFromStart+=(B-this._prevTime)*l,this._prevTime=B,{projectionMatrix:y,modelviewMatrix:N}}}class D_ extends hu{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Bf(o.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){let l=o.context;if(!this.particlesVx){let p=vm(this.particlesCount),y=new r.dt,v=new r.aU,C=0,D=r.di(1323123451230);for(let k=0;k<p.length;++k){let N=p[k],B=[2*D()-1,D(),D(),D()];y.emplaceBack(N[0],N[1],N[2],-1,-1,...B),y.emplaceBack(N[0],N[1],N[2],1,-1,...B),y.emplaceBack(N[0],N[1],N[2],1,1,...B),y.emplaceBack(N[0],N[1],N[2],-1,1,...B),v.emplaceBack(C+0,C+1,C+2),v.emplaceBack(C+0,C+2,C+3),C+=4}this.particlesVx=l.createVertexBuffer(y,uu.members),this.particlesIdx=l.createIndexBuffer(v)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;let l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=o.transform.zoom;if(l.revealStart>p)return;let y=za(0,1,l.revealStart,l.revealStart+l.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;let v=structuredClone(this._params),C=[-v.direction.x,v.direction.y,-100];r.ab.vec3.normalize(C,C);let D=structuredClone(this._vignetteParams);D.strength*=y,v.overrideStyleParameters||(v.intensity=o.style.rain.state.density,v.timeFactor=o.style.rain.state.intensity,v.color=structuredClone(o.style.rain.state.color),C=structuredClone(o.style.rain.state.direction),v.screenThinning.intensity=o.style.rain.state.centerThinning,v.dropletSizeX=o.style.rain.state.dropletSize[0],v.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],v.distortionStrength=100*o.style.rain.state.distortionStrength,D.strength=1,D.color=structuredClone(o.style.rain.state.vignetteColor));let k=this.updateOnRender(o,v.timeFactor),N=o.context,B=N.gl,H=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new r.T(N,{width:o.width,height:o.height,data:null},B.RGBA8)),v.distortionStrength>0&&(N.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),B.copyTexSubImage2D(B.TEXTURE_2D,0,0,0,0,0,o.width,o.height));let U=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(N,U),N.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);let q=[v.color.r,v.color.g,v.color.b,v.color.a],ee=(Q,ie)=>{let re=ym(this._movement.getPosition(),Q),ue=v.dropletSizeX,ge=v.dropletSizeX*v.dropletSizeYScale,pe=o.width/2,we=o.height/2,xe=za(0,v.screenThinning.start,0,1,v.screenThinning.intensity),be=za(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),ve=za(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),Ie=(Re={modelview:k.modelviewMatrix,projection:k.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:Q,rainDropletSize:[ue,ge],distortionStrength:v.distortionStrength,rainDirection:C,color:q,screenSize:[H.width,H.height],thinningCenterPos:[pe,we],thinningShape:[xe,be,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:ve,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:ie?0:1},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_texScreen:0,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_boxSize:Re.boxSize,u_rainDropletSize:Re.rainDropletSize,u_distortionStrength:Re.distortionStrength,u_rainDirection:Re.rainDirection,u_color:Re.color,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_shapeDirectionalPower:Re.shapeDirectionalPower,u_shapeNormalPower:Re.shapeNormalPower,u_mode:Re.mode});var Re;let Ye=Math.round(y*v.intensity*this.particlesCount),$e=r.b7.simpleSegment(0,0,4*Ye,2*Ye);U.draw(o,B.TRIANGLES,an.disabled,Sn.disabled,$n.alphaBlended,yn.disabled,Ie,"rain_particles",this.particlesVx,this.particlesIdx,$e,{})};v.distortionStrength>0&&ee(v.boxSize,!0),ee(v.boxSize,!1),this._vignette.draw(o,D)}}let O_=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class A_ extends hu{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Bf(o.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){let l=o.context;if(!this.particlesVx){let p=vm(this.particlesCount),y=new r.du,v=new r.aU,C=0,D=r.di(1323123451230);for(let k=0;k<p.length;++k){let N=p[k],B=D(),H=D(),U=D(),q=[k/p.length,B,H,U],ee=[D(),D()];y.emplaceBack(N[0],N[1],N[2],-1,-1,...q,...ee),y.emplaceBack(N[0],N[1],N[2],1,-1,...q,...ee),y.emplaceBack(N[0],N[1],N[2],1,1,...q,...ee),y.emplaceBack(N[0],N[1],N[2],-1,1,...q,...ee),v.emplaceBack(C+0,C+1,C+2),v.emplaceBack(C+0,C+2,C+3),C+=4}this.particlesVx=l.createVertexBuffer(y,O_.members),this.particlesIdx=l.createIndexBuffer(v)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;let l=structuredClone(this._params),p=[-l.direction.x,l.direction.y,-100];r.ab.vec3.normalize(p,p);let y=structuredClone(this._vignetteParams),v=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},C=o.transform.zoom;if(v.revealStart>C)return;let D=za(0,1,v.revealStart,v.revealStart+v.revealRange,C);y.strength*=D,l.overrideStyleParameters||(l.intensity=o.style.snow.state.density,l.timeFactor=o.style.snow.state.intensity,l.color=structuredClone(o.style.snow.state.color),p=structuredClone(o.style.snow.state.direction),l.screenThinning.intensity=o.style.snow.state.centerThinning,l.billboardSize=2.79*o.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(o.style.snow.state.vignetteColor));let k=this.updateOnRender(o,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;let N=o.context,B=N.gl,H=o.transform,U=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(N,U),((q,ee,Q)=>{let ie=ym(this._movement.getPosition(),q),re=H.width/2,ue=H.height/2,ge=za(0,Q.screenThinning.start,0,1,Q.screenThinning.intensity),pe=za(.001,Q.screenThinning.range,0,1,Q.screenThinning.intensity),we=za(0,Q.screenThinning.particleOffset,0,1,Q.screenThinning.intensity),xe=(be={modelview:k.modelviewMatrix,projection:k.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:Q.velocityConeAperture,velocity:Q.velocity,horizontalOscillationRadius:Q.horizontalOscillationRadius,horizontalOscillationRate:Q.horizontalOscillationRate,boxSize:q,billboardSize:1*Q.billboardSize,simpleShapeParameters:[Q.shapeFadeStart,Q.shapeFadePower],screenSize:[H.width,H.height],thinningCenterPos:[re,ue],thinningShape:[ge,pe,Math.pow(10,Q.screenThinning.fadePower)],thinningAffectedRatio:Q.screenThinning.affectedRatio,thinningParticleOffset:we,color:[Q.color.r,Q.color.g,Q.color.b,Q.color.a],direction:p},{u_modelview:Float32Array.from(be.modelview),u_projection:Float32Array.from(be.projection),u_time:be.time,u_cam_pos:be.camPos,u_velocityConeAperture:be.velocityConeAperture,u_velocity:be.velocity,u_horizontalOscillationRadius:be.horizontalOscillationRadius,u_horizontalOscillationRate:be.horizontalOscillationRate,u_boxSize:be.boxSize,u_billboardSize:be.billboardSize,u_simpleShapeParameters:be.simpleShapeParameters,u_screenSize:be.screenSize,u_thinningCenterPos:be.thinningCenterPos,u_thinningShape:be.thinningShape,u_thinningAffectedRatio:be.thinningAffectedRatio,u_thinningParticleOffset:be.thinningParticleOffset,u_particleColor:be.color,u_direction:be.direction});var be;let ve=Math.round(D*Q.intensity*this.particlesCount),Ie=r.b7.simpleSegment(0,0,4*ve,2*ve);this.particlesVx&&this.particlesIdx&&U.draw(o,B.TRIANGLES,an.disabled,Sn.disabled,$n.alphaBlended,yn.disabled,xe,"snow_particles",this.particlesVx,this.particlesIdx,Ie,{})})(l.boxSize,0,l),this._vignette.draw(o,y)}}let xc={symbol:function(f,o,l,p,y){if(f.renderPass!=="translucent")return;let v=Sn.disabled,C=f.colorModeForRenderPass(),D=l.layout.get("text-variable-anchor"),k=l.layout.get("text-size-scale-range"),N=r.aw(f.scaleFactor,k[0],k[1]);D&&function(U,q,ee,Q,ie,re,ue,ge){let pe=q.transform,we=ie==="map",xe=re==="map";for(let be of U){let ve=Q.getTile(be),Ie=ve.getBucket(ee);if(!Ie||!Ie.text||!Ie.text.segments.get().length)continue;let Re=r.bp(Ie.textSizeData,pe.zoom,ge),Ye=hc(be,Ie.getProjection(),pe),$e=pe.calculatePixelsToTileUnitsMatrix(ve),Ae=Jo(Ye,ve.tileID.canonical,xe,we,pe,Ie.getProjection(),$e),ze=Ie.hasIconTextFit()&&Ie.hasIconData();if(Re){let at=Math.pow(2,pe.zoom-ve.tileID.overscaledZ);Pv(Ie,we,xe,ue,r.cX,pe,Ae,be,at,Re,ze)}}}(p,f,l,o,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),y,N);let B=l.paint.get("icon-opacity").constantOr(1)!==0,H=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(B||H)?Ws(f,o,l,p,v,C):(B&&Ws(f,o,l,p,v,C,{onlyIcons:!0}),H&&Ws(f,o,l,p,v,C,{onlyText:!0})),o.map.showCollisionBoxes&&(v_(f,o,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),v_(f,o,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(f,o,l,p){if(f.renderPass!=="translucent")return;let y=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),C=l.paint.get("circle-stroke-opacity"),D=l.layout.get("circle-sort-key").constantOr(1)!==void 0,k=l.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(v.constantOr(1)===0||C.constantOr(1)===0))return;let N=f.context,B=N.gl,H=f.transform,U=f.depthModeForSublayer(0,an.ReadOnly),q=Sn.disabled,ee=f.colorModeForDrapableLayerRenderPass(k),Q=H.projection.name==="globe",ie=[r.at(H.center.lng),r.aA(H.center.lat)],re=[];for(let ge=0;ge<p.length;ge++){let pe=p[ge],we=o.getTile(pe),xe=we.getBucket(l);if(!xe||xe.projection.name!==H.projection.name)continue;let be=xe.programConfigurations.get(l.id),ve=r.cY(l),Ie=f.isTileAffectedByFog(pe);Q&&ve.push("PROJECTION_GLOBE_VIEW"),ve.push("DEPTH_D24"),f.terrain&&H.depthOcclusionForSymbolsAndCircles&&ve.push("DEPTH_OCCLUSION");let Re=f.getOrCreateProgram("circle",{config:be,defines:ve,overrideFog:Ie}),Ye=xe.layoutVertexBuffer,$e=xe.globeExtVertexBuffer,Ae=xe.indexBuffer,ze=H.projection.createInversionMatrix(H,pe.canonical),at={programConfiguration:be,program:Re,layoutVertexBuffer:Ye,globeExtVertexBuffer:$e,indexBuffer:Ae,uniformValues:r.cZ(f,pe,we,ze,ie,l),tile:we};if(D){let gt=xe.segments.get();for(let St of gt)re.push({segments:new r.b7([St]),sortKey:St.sortKey,state:at})}else re.push({segments:xe.segments,sortKey:0,state:at})}D&&re.sort((ge,pe)=>ge.sortKey-pe.sortKey);let ue={useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles};for(let ge of re){let{programConfiguration:pe,program:we,layoutVertexBuffer:xe,globeExtVertexBuffer:be,indexBuffer:ve,uniformValues:Ie,tile:Re}=ge.state,Ye=ge.segments;f.terrain&&f.terrain.setupElevationDraw(Re,we,ue),f.uploadCommonUniforms(N,we,Re.tileID.toUnwrapped()),we.draw(f,B.TRIANGLES,U,q,ee,yn.disabled,Ie,l.id,xe,ve,Ye,l.paint,H.zoom,pe,[be])}},heatmap:function(f,o,l,p){if(l.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){let y=f.context,v=y.gl,C=Sn.disabled,D=new $n([v.ONE,v.ONE,v.ONE,v.ONE],r.aj.transparent,[!0,!0,!0,!0]);(function(q,ee,Q,ie){let re=q.gl,ue=ee.width*ie,ge=ee.height*ie;q.activeTexture.set(re.TEXTURE1),q.viewport.set([0,0,ue,ge]);let pe=Q.heatmapFbo;if(!pe||pe&&(pe.width!==ue||pe.height!==ge)){pe&&pe.destroy();let we=re.createTexture();re.bindTexture(re.TEXTURE_2D,we),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),pe=Q.heatmapFbo=q.createFramebuffer(ue,ge,!0,null),function(xe,be,ve,Ie,Re,Ye){let $e=xe.gl;$e.texImage2D($e.TEXTURE_2D,0,xe.extRenderToTextureHalfFloat?$e.RGBA16F:$e.RGBA,Re,Ye,0,$e.RGBA,xe.extRenderToTextureHalfFloat?$e.HALF_FLOAT:$e.UNSIGNED_BYTE,null),Ie.colorAttachment.set(ve)}(q,0,we,pe,ue,ge)}else re.bindTexture(re.TEXTURE_2D,pe.colorAttachment.get()),q.bindFramebuffer.set(pe.framebuffer)})(y,f,l,f.transform.projection.name==="globe"?.5:.25),y.clear({color:r.aj.transparent});let k=f.transform,N=k.projection.name==="globe",B=N?["PROJECTION_GLOBE_VIEW"]:[],H=N?yn.frontCCW:yn.disabled,U=[r.at(k.center.lng),r.aA(k.center.lat)];for(let q=0;q<p.length;q++){let ee=p[q];if(o.hasRenderableParent(ee))continue;let Q=o.getTile(ee),ie=Q.getBucket(l);if(!ie||ie.projection.name!==k.projection.name)continue;let re=f.isTileAffectedByFog(ee),ue=ie.programConfigurations.get(l.id),ge=f.getOrCreateProgram("heatmap",{config:ue,defines:B,overrideFog:re}),{zoom:pe}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Q,ge),f.uploadCommonUniforms(y,ge,ee.toUnwrapped());let we=k.projection.createInversionMatrix(k,ee.canonical);ge.draw(f,v.TRIANGLES,an.disabled,C,D,H,AC(f,ee,Q,we,U,pe,l.paint.get("heatmap-intensity")),l.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,l.paint,f.transform.zoom,ue,N?[ie.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,v){let C=y.context,D=C.gl,k=v.heatmapFbo;if(!k)return;C.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,k.colorAttachment.get()),C.activeTexture.set(D.TEXTURE1);let N=v.colorRampTexture;N||(N=v.colorRampTexture=new r.T(C,v.colorRamp,D.RGBA8)),N.bind(D.LINEAR,D.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,D.TRIANGLES,an.disabled,Sn.disabled,y.colorModeForRenderPass(),yn.disabled,((B,H,U,q)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,v),v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(f,l))},line:function(f,o,l,p){if(f.renderPass!=="translucent")return;let y=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(y.constantOr(1)===0||v.constantOr(1)===0)return;let C=l.paint.get("line-emissive-strength"),D=l.paint.get("line-occlusion-opacity"),k=l.layout.get("line-elevation-reference"),N=l.layout.get("line-width-unit")==="meters",B=k==="sea",H=f.context,U=H.gl,q=!l.isDraped();if(q&&f.transform.projection.name==="globe")return;let ee=l.layout.get("line-cross-slope"),Q=ee!==void 0,ie=ee<1,re=q?new an(f.depthOcclusion?U.GREATER:U.LEQUAL,an.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,an.ReadOnly),ue=f.colorModeForDrapableLayerRenderPass(C),ge=f.terrain&&f.terrain.renderingToTexture,pe=ge?1:r.q.devicePixelRatio,we=l.paint.get("line-dasharray"),xe=we.constantOr(1),be=l.layout.get("line-cap"),ve=we.constantOr(null),Ie=be.constantOr(null),Re=l.paint.get("line-pattern"),Ye=Re.constantOr(1),$e=Re.constantOr(null),Ae=l.paint.get("line-opacity").constantOr(1),ze=!Ye&&Ae!==1||f.depthOcclusion&&D>0&&D<1,at=l.paint.get("line-gradient"),gt=Ye?"linePattern":"line",St=r.c_(l),Ve;if(ge&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ze=!1),D!==0&&f.depthOcclusion){let et=l.paint._values["line-opacity"];et&&et.value&&et.value.kind==="constant"?Ve=et.value:r.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}if(q&&(f.forceTerrainMode=!0),!q&&D!==0&&f.terrain&&!ge)return void r.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`);let dt=ze&&q?f.stencilModeFor3D():Sn.disabled;q&&(St.push("ELEVATED"),Q&&St.push(ie?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),B&&St.push("ELEVATION_REFERENCE_SEA")),v.value.kind!=="constant"&&v.value.isLineProgressConstant===!1&&St.push("VARIABLE_LINE_WIDTH");for(let et of p){let Ct=o.getTile(et);if(Ye&&!Ct.patternsLoaded())continue;let pt=Ct.getBucket(l);if(!pt)continue;f.prepareDrawTile();let lt=pt.programConfigurations.get(l.id),Nt=f.isTileAffectedByFog(et),Ht=f.getOrCreateProgram(gt,{config:lt,defines:St,overrideFog:Nt,overrideRtt:!q&&void 0});if($e&&Ct.imageAtlas){let Gn=r.A.from($e),fr=Ct.imageAtlas.patternPositions[Gn.getSerializedPrimary()];fr&&lt.setConstantPatternPositions(fr)}if(!Ye&&ve&&Ie&&Ct.lineAtlas){let Gn=Ct.lineAtlas.getDash(ve,Ie);Gn&&lt.setConstantPatternPositions(Gn)}let[Lt,Wt]=l.paint.get("line-trim-offset");(Ie==="round"||Ie==="square")&&Lt!==Wt&&(Lt===0&&(Lt-=1),Wt===1&&(Wt+=1));let Tn=ge?et.projMatrix:null,hn=N?1/pt.tileToMeter/r.ar(Ct,1,f.transform.zoom):1,un=N?1/pt.tileToMeter/r.ar(Ct,1,Math.floor(f.transform.zoom)):1,In=Ye?r.c$(f,Ct,l,Tn,pe,hn,un,[Lt,Wt]):r.d0(f,Ct,l,Tn,pt.lineClipsArray.length,pe,hn,un,[Lt,Wt]);if(at){let Gn=pt.gradients[l.id],fr=Gn.texture;if(l.gradientVersion!==Gn.version){let tr=256;if(l.stepInterpolant){let Ai=o.getSource().maxzoom,Bi=et.canonical.z===Ai?Math.ceil(1<<f.transform.maxZoom-et.canonical.z):1;tr=r.aw(r.d1(pt.maxLineLength/r.ag*1024*Bi),256,H.maxTextureSize)}Gn.gradient=r.d2({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:tr,image:Gn.gradient||void 0,clips:pt.lineClipsArray}),Gn.texture?Gn.texture.update(Gn.gradient):Gn.texture=new r.T(H,Gn.gradient,U.RGBA8),Gn.version=l.gradientVersion,fr=Gn.texture}H.activeTexture.set(U.TEXTURE1),fr.bind(l.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}xe&&(H.activeTexture.set(U.TEXTURE0),Ct.lineAtlasTexture&&Ct.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),lt.updatePaintBuffers()),Ye&&(H.activeTexture.set(U.TEXTURE0),Ct.imageAtlasTexture&&Ct.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),lt.updatePaintBuffers()),q&&!B&&f.terrain.setupElevationDraw(Ct,Ht),f.uploadCommonUniforms(H,Ht,et.toUnwrapped());let si=Gn=>{Ve!=null&&(Ve.value=Ae*D),Ht.draw(f,U.TRIANGLES,re,Gn,ue,yn.disabled,In,l.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,l.paint,f.transform.zoom,lt,[pt.layoutVertexBuffer2,pt.patternVertexBuffer,pt.zOffsetVertexBuffer]),Ve!=null&&(Ve.value=Ae)};if(ze&&!q){let Gn=f.stencilModeForClipping(et).ref;Gn===0&&ge&&H.clear({stencil:0});let fr={func:U.EQUAL,mask:255};In.u_alpha_discard_threshold=.8,si(new Sn(fr,Gn,255,U.KEEP,U.KEEP,U.INVERT)),In.u_alpha_discard_threshold=0,si(new Sn(fr,Gn,255,U.KEEP,U.KEEP,U.KEEP))}else ze&&q&&(In.u_alpha_discard_threshold=.001),si(q?dt:f.stencilModeForClipping(et))}q&&(f.forceTerrainMode=!1),ze&&(f.resetStencilClippingMasks(),ge&&H.clear({stencil:0})),D===0||f.depthOcclusion||ge||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,o,l,p){let y=l.paint.get("fill-color"),v=l.paint.get("fill-opacity"),C=l.is3D(),D=new an(f.context.gl.LEQUAL,an.ReadWrite,f.depthRangeFor3D);if(v.constantOr(1)===0)return;let k=l.paint.get("fill-emissive-strength"),N=f.colorModeForDrapableLayerRenderPass(k),B=l.paint.get("fill-pattern"),H=f.opaquePassEnabledForLayer()&&!B.constantOr(1)&&y.constantOr(r.aj.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===H){let U=C?D:f.depthModeForSublayer(1,f.renderPass==="opaque"?an.ReadWrite:an.ReadOnly);kf(f,o,l,p,U,N,!1)}if(!C&&f.renderPass==="translucent"&&l.paint.get("fill-antialias")){let U=C?D:f.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,an.ReadOnly);kf(f,o,l,p,U,N,!0)}},"fill-extrusion":function(f,o,l,p){let y=l.paint.get("fill-extrusion-opacity"),v=f.context,C=v.gl,D=f.terrain,k=D&&D.renderingToTexture;if(y===0)return;let N=f.conflationActive&&f.style.isLayerClipped(l,o.getSource()),B=f.style.order.indexOf(l.fqid);if(N&&function(H,U,q,ee,Q){for(let ie of ee){let re=U.getTile(ie).getBucket(q);re&&(re.updateReplacement(ie,H.replacementSource,Q),re.uploadCentroid(H.context))}}(f,o,l,p,B),D||N)for(let H of p){let U=o.getTile(H).getBucket(l);U&&Dv(f.context,o,H,U,l,D,N)}if(f.renderPass==="shadow"&&f.shadowRenderer){let H=f.shadowRenderer;if(D&&y<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.a9)return;let U=H.getShadowPassDepthMode(),q=H.getShadowPassColorMode();rd(f,o,l,p,U,Sn.disabled,q,N)}else if(f.renderPass==="translucent"){let H=!l.paint.get("fill-extrusion-pattern").constantOr(1),U=l.paint.get("fill-extrusion-color").constantOr(r.aj.white);if(!k&&U.a!==0){let q=new an(f.context.gl.LEQUAL,an.ReadWrite,f.depthRangeFor3D);y===1&&H?rd(f,o,l,p,q,Sn.disabled,$n.unblended,N):(rd(f,o,l,p,q,Sn.disabled,$n.disabled,N),rd(f,o,l,p,q,f.stencilModeFor3D(),f.colorModeForRenderPass(),N),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&H&&(!D&&f.transform.projection.name!=="globe"||k)){let q=l.paint.get("fill-extrusion-opacity"),ee=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ie=l.paint.get("fill-extrusion-flood-light-intensity"),re=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ue=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(re?null:l.lut).toArray01().slice(0,3),ge=ee>0&&Q>0,pe=ie>0,we=(be,ve,Ie)=>(1-Ie)*be+Ie*ve,xe=be=>{let ve=f.depthModeForSublayer(1,an.ReadOnly,C.LEQUAL,!0),Ie=l.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=we(.1,3,Ie),Ye=f._showOverdrawInspector;if(!Ye){let $e=new Sn({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),Ae=new $n([C.ONE,C.ONE,C.ONE,C.ONE],r.aj.transparent,[!1,!1,!1,!0],C.MIN);rh(f,o,l,p,ve,$e,Ae,yn.disabled,be,"sdf",q,ee,Q,ie,ue,Re,N,!1)}{let $e=Ye?Sn.disabled:new Sn({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),Ae=Ye?f.colorModeForRenderPass():new $n([C.ONE_MINUS_DST_ALPHA,C.DST_ALPHA,C.ONE,C.ONE],r.aj.transparent,[!0,!0,!0,!0]);rh(f,o,l,p,ve,$e,Ae,yn.disabled,be,"color",q,ee,Q,ie,ue,Re,N,!1)}};if(k){let be=(ve,Ie,Re)=>{let Ye=f.depthModeForSublayer(1,an.ReadOnly,C.LEQUAL,!1),$e=l.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ae=we(.1,3,$e);{let ze=new $n([C.ONE,C.ONE,C.ONE,C.ONE],r.aj.transparent,[!1,!1,!1,!0]);rh(f,o,l,p,Ye,Sn.disabled,ze,yn.disabled,ve,"clear",q,ee,Q,ie,ue,Ae,N,Ie)}{let ze=new Sn({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),at=new $n([C.ONE,C.ONE,C.ONE,C.ONE],r.aj.transparent,[!1,!1,!1,!0],C.MIN);rh(f,o,l,p,Ye,ze,at,yn.disabled,ve,"sdf",q,ee,Q,ie,ue,Ae,N,Ie)}{let ze=ve?C.ZERO:C.ONE_MINUS_DST_ALPHA,at=new Sn({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),gt=new $n([ze,C.DST_ALPHA,C.ONE_MINUS_DST_ALPHA,C.ZERO],r.aj.transparent,[!0,!0,!0,!0]);rh(f,o,l,p,Ye,at,gt,yn.disabled,ve,"color",q,ee,Q,ie,ue,Ae,N,Ie)}{let ze=new $n([C.ONE,C.ONE,C.ONE,ve?C.ZERO:C.ONE],r.aj.transparent,[!1,!1,!1,!0],ve?C.FUNC_ADD:C.MAX);rh(f,o,l,p,Ye,Sn.disabled,ze,yn.disabled,ve,"clear",q,ee,Q,ie,ue,Ae,N,Ie,Re)}};if(ge||pe){let ve;if(f.prepareDrawTile(),D){let Ie=D.drapeBufferSize[0],Re=D.drapeBufferSize[1];ve=D.framebufferCopyTexture,ve&&(!ve||ve.size[0]===Ie&&ve.size[1]===Re)||(ve&&ve.destroy(),ve=D.framebufferCopyTexture=new r.T(v,new r.r({width:Ie,height:Re}),C.RGBA8)),ve.bind(C.LINEAR,C.CLAMP_TO_EDGE),C.copyTexSubImage2D(C.TEXTURE_2D,0,0,0,0,0,Ie,Re)}ge&&be(!0,!1,ve),pe&&be(!1,!0,ve)}}else ge&&xe(!0),pe&&xe(!1),(ge||pe)&&f.resetStencilClippingMasks()}}},hillshade:function(f,o,l,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;let y=f.context,v=f.terrain&&f.terrain.renderingToTexture,[C,D]=f.renderPass!=="translucent"||v?[{},p]:f.stencilConfigForOverlap(p);for(let k of D){let N=o.getTile(k);if(N.needsHillshadePrepare&&f.renderPass==="offscreen")_c(f,N,l);else if(f.renderPass==="translucent"){let B=f.depthModeForSublayer(0,an.ReadOnly),H=l.paint.get("hillshade-emissive-strength"),U=f.colorModeForDrapableLayerRenderPass(H),q=v&&f.terrain?f.terrain.stencilModeForRTTOverlap(k):C[k.overscaledZ];Ju(f,k,N,l,B,q,U)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,o,l,p,y,v){if(f.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;let C=f.transform.projection.name==="globe",D=l.paint.get("raster-elevation")!==0,k=D&&C;if(f.renderElevatedRasterBackface&&!k)return;let N=f.context,B=N.gl,H=o.getSource(),U=function(xe,be,ve,Ie){let Re=be.paint.get("raster-color"),Ye=xe.type==="raster-array",$e=[],Ae=be.paint.get("raster-resampling"),ze=be.paint.get("raster-color-mix"),at=be.paint.get("raster-color-range"),gt=[ze[0],ze[1],ze[2],0],St=ze[3],Ve=Ae==="nearest"?Ie.NEAREST:Ie.LINEAR;if(Ye&&($e.push("RASTER_ARRAY"),Re||$e.push("RASTER_COLOR"),Ae==="linear"&&$e.push("RASTER_ARRAY_LINEAR"),Ve=Ie.NEAREST,!at&&xe.rasterLayers)){let dt=xe.rasterLayers.find(({id:et})=>et===be.sourceLayer);dt&&dt.fields&&dt.fields.range&&(at=dt.fields.range)}if(at=at||[0,1],Re){$e.push("RASTER_COLOR"),ve.activeTexture.set(Ie.TEXTURE2),be.updateColorRamp(at);let dt=be.colorRampTexture;dt||(dt=be.colorRampTexture=new r.T(ve,be.colorRamp,Ie.RGBA8)),dt.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}return{mix:gt,range:at,offset:St,defines:$e,resampling:Ve}}(H,l,N,B);if(H instanceof r.aJ&&!p.length&&!C)return;let q=l.paint.get("raster-emissive-strength"),ee=f.colorModeForDrapableLayerRenderPass(q),Q=f.terrain&&f.terrain.renderingToTexture,ie=!f.options.moving,re=l.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(H instanceof r.aJ&&!p.length&&(H.onNorthPole||H.onSouthPole)){let xe=D?f.stencilModeFor3D():Sn.disabled;return void Gt(!!H.onNorthPole,null,f,o,l,q,U,yn.disabled,xe)}if(!p.length)return;let[ue,ge]=H instanceof r.aJ||Q?[{},p]:f.stencilConfigForOverlap(p),pe=ge[ge.length-1].overscaledZ;k&&U.defines.push("PROJECTION_GLOBE_VIEW"),D&&U.defines.push("RENDER_CUTOFF");let we=(xe,be,ve)=>{for(let Ie of xe){let Re=Ie.toUnwrapped(),Ye=o.getTile(Ie);if(Q&&(!Ye||!Ye.hasData()))continue;N.activeTexture.set(B.TEXTURE0);let $e=Ar(Ye,H,l,U);if(!$e||!$e.texture)continue;let{texture:Ae,mix:ze,offset:at,tileSize:gt,buffer:St}=$e,Ve,dt;Q?(Ve=an.disabled,dt=Ie.projMatrix):D?(Ve=new an(B.LEQUAL,an.ReadWrite,f.depthRangeFor3D),dt=C?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Re,ie)):(Ve=f.depthModeForSublayer(Ie.overscaledZ-pe,l.paint.get("raster-opacity")===1?an.ReadWrite:an.ReadOnly,B.LESS),dt=f.transform.calculateProjMatrix(Re,ie));let et=f.terrain&&Q?f.terrain.stencilModeForRTTOverlap(Ie):ue[Ie.overscaledZ],Ct=v?0:l.paint.get("raster-fade-duration");Ye.registerFadeDuration(Ct);let pt=o.findLoadedParent(Ie,0),lt=td(Ye,pt,o,f.transform,Ct),Nt,Ht;f.terrain&&f.terrain.prepareDrawTile(),N.activeTexture.set(B.TEXTURE0),Ae.bind(re,B.CLAMP_TO_EDGE),N.activeTexture.set(B.TEXTURE1),pt?(pt.texture&&pt.texture.bind(re,B.CLAMP_TO_EDGE),Nt=Math.pow(2,pt.tileID.overscaledZ-Ye.tileID.overscaledZ),Ht=[Ye.tileID.canonical.x*Nt%1,Ye.tileID.canonical.y*Nt%1]):Ae.bind(re,B.CLAMP_TO_EDGE),Ae.useMipmap&&N.extTextureFilterAnisotropic&&f.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);let Lt=f.transform,Wt,Tn=D?ad(Lt):[0,0,0,0],hn,un,In,si,Gn,fr=0;if(k&&H instanceof r.aJ&&H.coordinates.length>3)hn=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0)))),un=Float32Array.from(Lt.globeMatrix),In=Float32Array.from(r.cD(Lt)),si=[r.at(Lt.center.lng),r.aA(Lt.center.lat)],Wt=H.elevatedGlobePerspectiveTransform,Gn=H.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){let qn=r.cE(Ie.canonical);fr=r.cF(qn.getCenter().lat),hn=Float32Array.from(r.bb(r.cH(Ie.canonical))),un=Float32Array.from(Lt.globeMatrix),In=Float32Array.from(r.cD(Lt)),si=[r.at(Lt.center.lng),r.aA(Lt.center.lat)],Wt=[0,0],Gn=Float32Array.from(r.cG(Ie.canonical,qn,fr,Lt.worldSize/Lt._pixelsPerMercatorPixel))}else Wt=H instanceof r.aJ?H.perspectiveTransform:[0,0],hn=new Float32Array(16),un=new Float32Array(9),In=new Float32Array(16),si=[0,0],Gn=new Float32Array(9);let tr=Xt(dt,hn,un,In,Gn,Ht||[0,0],r.ae(f.transform.zoom),si,Tn,Nt||1,lt,l,Wt,D?l.paint.get("raster-elevation"):0,2,ze,at,U.range,gt,St,q),Ai=f.isTileAffectedByFog(Ie),Bi=f.getOrCreateProgram("raster",{defines:U.defines,overrideFog:Ai});if(f.uploadCommonUniforms(N,Bi,Re),H instanceof r.aJ){let qn=H.elevatedGlobeVertexBuffer,ci=H.elevatedGlobeIndexBuffer;if(Q||!C)H.boundsBuffer&&H.boundsSegments&&Bi.draw(f,B.TRIANGLES,Ve,Sn.disabled,ee,yn.disabled,tr,l.id,H.boundsBuffer,f.quadTriangleIndexBuffer,H.boundsSegments);else if(qn&&ci){let bn=Lt.zoom<=r.c6?H.elevatedGlobeSegments:H.getSegmentsForLongitude(Lt.center.lng);bn&&Bi.draw(f,B.TRIANGLES,Ve,Sn.disabled,ee,be,tr,l.id,qn,ci,bn)}}else if(k){Ve=new an(B.LEQUAL,an.ReadOnly,f.depthRangeFor3D);let qn=f.globeSharedBuffers;if(qn){let[ci,bn,Ei]=qn.getGridBuffers(fr,!1);Bi.draw(f,B.TRIANGLES,Ve,ve||et,f.colorModeForRenderPass(),be,tr,l.id,ci,bn,Ei)}}else{let{tileBoundsBuffer:qn,tileBoundsIndexBuffer:ci,tileBoundsSegments:bn}=f.getTileBoundsBuffers(Ye);Bi.draw(f,B.TRIANGLES,Ve,et,ee,yn.disabled,tr,l.id,qn,ci,bn)}}if(!(H instanceof r.aJ)&&k)for(let Ie of xe){let Re=Ie.canonical.y===(1<<Ie.canonical.z)-1;Ie.canonical.y===0&&Gt(!0,Ie,f,o,l,q,U,be,ve||Sn.disabled),Re&&Gt(!1,Ie,f,o,l,q,U,be===yn.frontCW?yn.backCW:yn.frontCW,ve||Sn.disabled)}};k?we(ge,f.renderElevatedRasterBackface?yn.backCW:yn.frontCW,f.stencilModeFor3D()):we(ge,yn.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,o,l,p,y,v){f.renderPass==="offscreen"&&function(C,D,k,N){if(!N.length)return;let B=C.context,H=B.gl,U=D.getSource();if(!(U instanceof hr))return;let q=Math.ceil(Math.sqrt(k.paint.get("raster-particle-count"))),ee=k.particlePositionRGBAImage;if(!ee||ee.width!==q){let ge=function(pe){let we=pe*pe,xe=new Uint8Array(4*we),be=function(Ie){return Ie|=0,Ie=Math.imul(2747636419^Ie,2654435769),Ie=Math.imul(Ie^Ie>>>16,2654435769),((Ie=Math.imul(Ie^Ie>>>16,2654435769))>>>0)/4294967296},ve=1/1.1;for(let Ie=0;Ie<we;Ie++){let Re=ve*(be(2*Ie+0)+th),Ye=ve*(be(2*Ie+1)+th),$e=255*Re%1,Ae=255*Ye%1,ze=$e,at=Ye-Ae/255,gt=Ae;xe[4*Ie+0]=255*(Re-$e/255),xe[4*Ie+1]=255*ze,xe[4*Ie+2]=255*at,xe[4*Ie+3]=255*gt}return xe}(q);ee=k.particlePositionRGBAImage=new r.r({width:q,height:q},ge)}let Q=k.particleFramebuffer;Q?Q.width!==q&&(Q.destroy(),Q=k.particleFramebuffer=B.createFramebuffer(q,q,!0,null)):Q=k.particleFramebuffer=B.createFramebuffer(q,q,!0,null);let ie=[];for(let ge of N){let pe=D.getTile(ge);if(!(pe instanceof Kc))continue;let we=mm(pe,U,k);if(!we)continue;let xe=[pe.tileSize,pe.tileSize],be=k.tileFramebuffer;be||(be=k.tileFramebuffer=B.createFramebuffer(xe[0],xe[1],!0,null));let ve=pe.rasterParticleState;ve||(ve=pe.rasterParticleState=new Av(B,ge,xe,ee));let Ie=ve.update(k.lastInvalidatedAt);ve.particleTextureDimension!==q&&ve.updateParticleTexture(ge,ee);let Re=ve.targetColorTexture;ve.targetColorTexture=ve.backgroundColorTexture,ve.backgroundColorTexture=Re;let Ye=ve.particleTexture0;ve.particleTexture0=ve.particleTexture1,ve.particleTexture1=Ye,ie.push([ge,we,ve,Ie])}if(ie.length===0)return;let re=r.q.now(),ue=k.previousDrawTimestamp?.001*(re-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=re,k.hasColorMap()){B.activeTexture.set(H.TEXTURE0+2);let ge=k.colorRampTexture;ge||(ge=k.colorRampTexture=new r.T(B,k.colorRamp,H.RGBA8)),ge.bind(H.LINEAR,H.CLAMP_TO_EDGE)}B.bindFramebuffer.set(k.tileFramebuffer.framebuffer),function(ge,pe,we){let xe=ge.context,be=xe.gl,ve=pe.tileFramebuffer;xe.activeTexture.set(be.TEXTURE0);let Ie={u_texture:0,u_opacity:1.05*(Ye=pe.paint.get("raster-particle-fade-opacity-factor"))/(Ye+.05)},Re=ge.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ye;for(let $e of we){let[,,Ae,ze]=$e;ve.colorAttachment.set(Ae.targetColorTexture.texture),xe.viewport.set([0,0,ve.width,ve.height]),xe.clear({color:r.aj.transparent}),ze&&(Ae.backgroundColorTexture.bind(be.NEAREST,be.CLAMP_TO_EDGE),Re.draw(ge,be.TRIANGLES,an.disabled,Sn.disabled,$n.alphaBlended,yn.disabled,Ie,pe.id,ge.viewportBuffer,ge.quadTriangleIndexBuffer,ge.viewportSegments))}}(C,k,ie),function(ge,pe,we,xe){let be=ge.context,ve=be.gl,Ie=we.tileFramebuffer,Re=ge.transform.projection.name==="globe",Ye=we.paint.get("raster-particle-max-speed");for(let $e of xe){let[Ae,ze,at]=$e;be.activeTexture.set(ve.TEXTURE0+0),ze.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),Ie.colorAttachment.set(at.targetColorTexture.texture);let gt=ge.getOrCreateProgram("rasterParticleDraw",{defines:ze.defines,overrideFog:!1});be.activeTexture.set(ve.TEXTURE0+1);let St=ze.scalarData?[]:[0,1,2,3].map(et=>r.d4[et](Ae));St.push(Ae);let Ve=Ae.canonical.x,dt=Ae.canonical.y;for(let et of St){let Ct=pe.getTile(Re?et.wrapped():et);if(!Ct)continue;let pt=Ct.rasterParticleState;if(!pt)continue;let lt=et.canonical.x+(1<<et.canonical.z)*(et.wrap-Ae.wrap),Nt=et.canonical.y;pt.particleTexture0.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);let Ht=ih(1,pt.particleTexture0.size[0],[lt-Ve,Nt-dt],0,ze.texture.size,2,Ye,ze.textureOffset,ze.scale,ze.offset);gt.draw(ge,ve.POINTS,an.disabled,Sn.disabled,$n.alphaBlended,yn.disabled,Ht,we.id,pt.particleIndexBuffer,void 0,pt.particleSegment)}}}(C,D,k,ie),B.bindFramebuffer.set(k.particleFramebuffer.framebuffer),function(ge,pe,we,xe){let be=ge.context,ve=be.gl,Ie=pe.paint.get("raster-particle-max-speed"),Re=xe*pe.paint.get("raster-particle-speed-factor")*.15,Ye=function(Ae){return Math.pow(Ae,6)}(.01+1*pe.paint.get("raster-particle-reset-rate-factor")),$e=pe.particleFramebuffer;be.viewport.set([0,0,$e.width,$e.height]);for(let Ae of we){let[,ze,at]=Ae;be.activeTexture.set(ve.TEXTURE0+0),ze.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),be.activeTexture.set(ve.TEXTURE0+1);let gt=at.particleTexture0;gt.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);let St=sn(1,gt.size[0],0,ze.texture.size,Ie,Re,Ye,ze.textureOffset,ze.scale,ze.offset);$e.colorAttachment.set(at.particleTexture1.texture),be.clear({color:r.aj.transparent}),ge.getOrCreateProgram("rasterParticleUpdate",{defines:ze.defines}).draw(ge,ve.TRIANGLES,an.disabled,Sn.disabled,$n.unblended,yn.disabled,St,pe.id,ge.viewportBuffer,ge.quadTriangleIndexBuffer,ge.viewportSegments)}}(C,k,ie,ue)}(f,o,l,p),f.renderPass==="translucent"&&(function(C,D,k,N,B){let H=C.context,U=H.gl,q=D.getSource().tileSize,ee=5*(1-r.ac(r.bY,r.bY+1,C.transform.zoom))*q+k.paint.get("raster-particle-elevation"),Q=!C.options.moving,ie=C.transform.projection.name==="globe";if(!N.length)return;let[re,ue]=C.stencilConfigForOverlap(N),ge=[];ie&&ge.push("PROJECTION_GLOBE_VIEW");let pe=C.stencilModeFor3D();for(let we of ue){let xe=we.toUnwrapped(),be=D.getTile(we);if(!be.rasterParticleState)continue;let ve=be.rasterParticleState,Ie=100;be.registerFadeDuration(Ie);let Re=D.findLoadedParent(we,0),Ye=td(be,Re,D,C.transform,Ie),$e,Ae;C.terrain&&C.terrain.prepareDrawTile(),H.activeTexture.set(U.TEXTURE0),ve.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),H.activeTexture.set(U.TEXTURE1),Re&&Re.rasterParticleState?(Re.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),$e=Math.pow(2,Re.tileID.overscaledZ-be.tileID.overscaledZ),Ae=[be.tileID.canonical.x*$e%1,be.tileID.canonical.y*$e%1]):ve.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let ze=ie?Float32Array.from(C.transform.expandedFarZProjMatrix):C.transform.calculateProjMatrix(xe,Q),at=C.transform,gt=b_(at),St=r.cE(we.canonical),Ve=r.cF(St.getCenter().lat),dt,et,Ct,pt,lt;ie?(dt=Float32Array.from(r.bb(r.cH(we.canonical))),et=Float32Array.from(at.globeMatrix),Ct=Float32Array.from(r.cD(at)),pt=[r.at(at.center.lng),r.aA(at.center.lat)],lt=Float32Array.from(r.cG(we.canonical,St,Ve,at.worldSize/at._pixelsPerMercatorPixel))):(dt=new Float32Array(16),et=new Float32Array(9),Ct=new Float32Array(16),pt=[0,0],lt=new Float32Array(9));let Nt=nh(ze,dt,et,Ct,lt,Ae||[0,0],r.ae(C.transform.zoom),pt,gt,$e||1,Ye,ee),Ht=C.isTileAffectedByFog(we),Lt=C.getOrCreateProgram("rasterParticle",{defines:ge,overrideFog:Ht});if(C.uploadCommonUniforms(H,Lt,xe),ie){let Wt=new an(U.LEQUAL,an.ReadOnly,C.depthRangeFor3D),Tn=0,hn=C.globeSharedBuffers;if(hn){let[un,In,si]=hn.getGridBuffers(Ve,Tn!==0);Lt.draw(C,U.TRIANGLES,Wt,pe,$n.alphaBlended,C.renderElevatedRasterBackface?yn.frontCCW:yn.backCCW,Nt,k.id,un,In,si)}}else{let Wt=C.depthModeForSublayer(0,an.ReadOnly),Tn=re[we.overscaledZ],{tileBoundsBuffer:hn,tileBoundsIndexBuffer:un,tileBoundsSegments:In}=C.getTileBoundsBuffers(be);Lt.draw(C,U.TRIANGLES,Wt,Tn,$n.alphaBlended,yn.disabled,Nt,k.id,hn,un,In)}}C.resetStencilClippingMasks()}(f,o,l,p),f.style.map.triggerRepaint())},background:function(f,o,l,p){let y=l.paint.get("background-color"),v=l.paint.get("background-color-use-theme").constantOr("default")==="none",C=l.paint.get("background-opacity"),D=l.paint.get("background-emissive-strength"),k=l.paint.get("background-pitch-alignment")==="viewport";if(C===0)return;let N=f.context,B=N.gl,H=f.transform,U=H.tileSize,q=l.paint.get("background-pattern"),ee;if(q!==void 0&&(q===null||(ee=f.imageManager.getPattern(q.toString(),l.scope,f.style.getLut(l.scope)),!ee)))return;let Q=!q&&y.a===1&&C===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Q)return;let ie=Sn.disabled,re=f.depthModeForSublayer(0,Q==="opaque"?an.ReadWrite:an.ReadOnly),ue=f.colorModeForDrapableLayerRenderPass(D),ge=q?"backgroundPattern":"background",pe,we=p;if(we||(pe=f.getBackgroundTiles(),we=Object.values(pe).map(xe=>xe.tileID)),q&&(N.activeTexture.set(B.TEXTURE0),f.imageManager.bind(f.context,l.scope)),k){let xe=f.getOrCreateProgram(ge,{overrideFog:!1,overrideRtt:!0}),be=new Float32Array(r.ab.mat4.identity([])),ve=new r.aG(0,0,0,0,0),Ie=q?cm(be,D,C,f,0,l.scope,ee,k,{tileID:ve,tileSize:U}):Sv(be,D,C,y.toRenderColor(v?null:l.lut));xe.draw(f,B.TRIANGLES,re,ie,ue,yn.disabled,Ie,l.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(let xe of we){let be=f.isTileAffectedByFog(xe),ve=f.getOrCreateProgram(ge,{overrideFog:be}),Ie=xe.toUnwrapped(),Re=p?xe.projMatrix:f.transform.calculateProjMatrix(Ie);f.prepareDrawTile();let Ye=o?o.getTile(xe):pe?pe[xe.key]:new Bs(xe,U,H.zoom,f),$e=q?cm(Re,D,C,f,0,l.scope,ee,k,{tileID:xe,tileSize:U}):Sv(Re,D,C,y.toRenderColor(v?null:l.lut));f.uploadCommonUniforms(N,ve,Ie);let{tileBoundsBuffer:Ae,tileBoundsIndexBuffer:ze,tileBoundsSegments:at}=f.getTileBoundsBuffers(Ye);ve.draw(f,B.TRIANGLES,re,ie,ue,yn.disabled,$e,l.id,Ae,ze,at)}},sky:function(f,o,l){let p=f._atmosphere?r.ae(f.transform.zoom):1,y=l.paint.get("sky-opacity")*p;if(y===0)return;let v=f.context,C=l.paint.get("sky-type"),D=new an(v.gl.LEQUAL,an.ReadOnly,[0,1]),k=f.frameCounter/1e3%1;C==="atmosphere"?f.renderPass==="offscreen"?l.needsSkyboxCapture(f)&&(function(N,B,H,U){let q=N.context,ee=q.gl,Q=B.skyboxFbo;if(!Q){Q=B.skyboxFbo=q.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new Ff(q),B.skyboxTexture=q.gl.createTexture(),ee.bindTexture(ee.TEXTURE_CUBE_MAP,B.skyboxTexture),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MAG_FILTER,ee.LINEAR);for(let ge=0;ge<6;++ge)ee.texImage2D(ee.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,ee.RGBA,32,32,0,ee.RGBA,ee.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(Q.framebuffer),q.viewport.set([0,0,32,32]);let ie=B.getCenter(N,!0),re=N.getOrCreateProgram("skyboxCapture"),ue=new Float64Array(16);r.ab.mat4.identity(ue),r.ab.mat4.rotateY(ue,ue,.5*-Math.PI),Es(N,B,re,ue,ie,0),r.ab.mat4.identity(ue),r.ab.mat4.rotateY(ue,ue,.5*Math.PI),Es(N,B,re,ue,ie,1),r.ab.mat4.identity(ue),r.ab.mat4.rotateX(ue,ue,.5*-Math.PI),Es(N,B,re,ue,ie,2),r.ab.mat4.identity(ue),r.ab.mat4.rotateX(ue,ue,.5*Math.PI),Es(N,B,re,ue,ie,3),r.ab.mat4.identity(ue),Es(N,B,re,ue,ie,4),r.ab.mat4.identity(ue),r.ab.mat4.rotateY(ue,ue,Math.PI),Es(N,B,re,ue,ie,5),q.viewport.set([0,0,N.width,N.height])}(f,l),l.markSkyboxValid(f)):f.renderPass==="sky"&&function(N,B,H,U,q){let ee=N.context,Q=ee.gl,ie=N.transform,re=N.getOrCreateProgram("skybox");ee.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,B.skyboxTexture);let ue=((ge,pe,we,xe,be)=>({u_matrix:ge,u_sun_direction:pe,u_cubemap:0,u_opacity:xe,u_temporal_offset:be}))(ie.skyboxMatrix,B.getCenter(N,!1),0,U,q);N.uploadCommonUniforms(ee,re),re.draw(N,Q.TRIANGLES,H,Sn.disabled,N.colorModeForRenderPass(),yn.backCW,ue,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,l,D,y,k):C==="gradient"&&f.renderPass==="sky"&&function(N,B,H,U,q){let ee=N.context,Q=ee.gl,ie=N.transform,re=N.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Ff(ee)),ee.activeTexture.set(Q.TEXTURE0);let ue=B.colorRampTexture;ue||(ue=B.colorRampTexture=new r.T(ee,B.colorRamp,Q.RGBA8)),ue.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let ge=((pe,we,xe,be,ve)=>({u_matrix:pe,u_color_ramp:0,u_center_direction:we,u_radius:r.ai(xe),u_opacity:be,u_temporal_offset:ve}))(ie.skyboxMatrix,B.getCenter(N,!1),B.paint.get("sky-gradient-radius"),U,q);N.uploadCommonUniforms(ee,re),re.draw(N,Q.TRIANGLES,H,Sn.disabled,N.colorModeForRenderPass(),yn.backCW,ge,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,l,D,y,k)},debug:function(f,o,l,p,y,v){for(let C=0;C<l.length;C++)if(y){let N=new r.aj(p.r*.8,p.g*.8,p.b*.8,1);cd(f,o,l[C],p,-1,-1,v),cd(f,o,l[C],p,-1,1,v),cd(f,o,l[C],p,1,1,v),cd(f,o,l[C],p,1,-1,v),cd(f,o,l[C],N,0,0,v)}else cd(f,o,l[C],p,0,0,v)},custom:function(f,o,l,p){let y=f.context,v=l.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&l.isDraped(o)){if(f.renderPass==="offscreen"){let C=v.prerender;if(C){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){let D=f.transform.pointMerc;C.call(v,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.ae(f.transform.zoom),[D.x,D.y],f.transform.pixelsPerMeterRatio)}else C.call(v,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){let D=v.renderToTile;if(D){let k=p[0].canonical,N=new r.aa(k.x+p[0].wrap*(1<<k.z),k.y,k.z);y.setDepthMode(an.disabled),y.setStencilMode(Sn.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),D.call(v,y.gl,N),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(Sn.disabled);let C=v.renderingMode==="3d"?new an(f.context.gl.LEQUAL,an.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,an.ReadOnly);if(y.setDepthMode(C),f.transform.projection.name==="globe"){let D=f.transform.pointMerc;v.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.ae(f.transform.zoom),[D.x,D.y],f.transform.pixelsPerMeterRatio)}else v.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,o,l,p){if(f.renderPass==="opaque")return;let y=l.paint.get("model-opacity").constantOr(1);if(y===0)return;let v=l.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!v||f.terrain&&y<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof r.a9))return;let C=f.shadowRenderer,D=l.paint.get("model-receive-shadows");C&&(C.useNormalOffset=!0,D||(C.enabled=!1));let k=()=>{C&&(C.useNormalOffset=!0,D||(C.enabled=!0))},N=o.getSource();if(f.renderPass==="light-beam"&&N.type!=="batched-model")return;if(N.type==="vector"||N.type==="geojson")return function(re,ue,ge,pe,we){let xe=re.transform;if(xe.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${xe.projection.name} projection is not yet implemented`);let be=xe.getFreeCameraOptions().position;if(!re.modelManager)return;let ve=re.modelManager;ge.modelManager=ve;let Ie=re.shadowRenderer;if(!ge._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let Re=ge._unevaluatedLayout._values["model-id"],Ye=cn({},ge.layout.get("model-id").parameters),$e=re.style.order.indexOf(ge.fqid);for(let Ae of pe){let ze=ue.getTile(Ae).getBucket(ge);if(!ze||ze.projection.name!==xe.projection.name)continue;let at=ze.getModelUris();at&&!ze.modelsRequested&&(ve.addModelsFromBucket(at,we),ze.modelsRequested=!0);let gt=C_(Ae,xe);Ye.zoom=gt;let St=Re.possiblyEvaluate(Ye);if(dd(re,ze,Ae),Na.shadowUniformsInitialized=!1,Na.useSingleShadowCascade=!!Ie&&Ie.getMaxCascadeForTile(Ae.toUnwrapped())===0,re.renderPass==="shadow"&&Ie){if(re.currentShadowCascade===1&&ze.isInsideFirstShadowMapFrustum)continue;let et=xe.calculatePosMatrix(Ae.toUnwrapped(),xe.worldSize);if(Na.tileMatrix.set(et),Na.shadowTileMatrix=Float32Array.from(Ie.calculateShadowPassMatrixFromMatrix(et)),Na.aabb.min.fill(0),Na.aabb.max[0]=Na.aabb.max[1]=r.ag,Na.aabb.max[2]=0,cu(ze,Na,re,ge.scope))continue}let Ve=1<<Ae.canonical.z,dt=[((be.x-Ae.wrap)*Ve-Ae.canonical.x)*r.ag,(be.y*Ve-Ae.canonical.y)*r.ag,be.z*Ve*r.ag];re.conflationActive&&Object.keys(ze.instancesPerModel).length>0&&re.style.isLayerClipped(ge,ue.getSource())&&ze.updateReplacement(Ae,re.replacementSource,$e,we)&&(ze.uploaded=!1,ze.upload(re.context));for(let et in ze.instancesPerModel){let Ct=ze.instancesPerModel[et];Ct.features.length>0&&(et=St.evaluate(Ct.features[0].feature,{}));let pt=ve.getModel(et,we);if(pt&&pt.uploaded)for(let lt of pt.nodes)vc(re,ge,lt,Ct,dt,Ae,Na)}}}(f,o,l,p,N.type==="vector"?l.scope:""),void k();if(!N.loaded())return;if(N.type==="batched-model")return function(re,ue,ge,pe){ge.resetLayerRenderingStats(re);let we=re.context,xe=re.transform,be=re.style.fog,ve=re.shadowRenderer;if(xe.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${xe.projection.name} projection is not yet implemented`);let Ie=re.transform.getFreeCameraOptions().position,Re=r.ab.vec3.scale([],[Ie.x,Ie.y,Ie.z],re.transform.worldSize),Ye=r.ab.vec3.negate([],Re),$e=r.ab.mat4.identity([]),Ae=r.dj(xe.center.lat,xe.zoom),ze=r.ab.mat4.fromScaling([],[1,1,1/Ae]);r.ab.mat4.translate($e,$e,Ye);let at=ge.paint.get("model-opacity").constantOr(1),gt=new an(we.gl.LEQUAL,an.ReadWrite,re.depthRangeFor3D),St=new an(we.gl.LEQUAL,an.ReadOnly,re.depthRangeFor3D),Ve=new r.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),dt=re.renderPass==="shadow",et=dt&&ve?ve.getCurrentCascadeFrustum():xe.getFrustum(xe.scaleZoom(xe.worldSize)),Ct=ge.paint.get("model-front-cutoff"),pt=Ct[2]<1,lt=nl(re,ge.paint.get("model-cutoff-fade-range")),Nt=ge.getLayerRenderingStats();(function(Ht,Lt,Wt,Tn){let hn=Ht.terrain?Ht.terrain.exaggeration():0,un=Ht.transform.zoom;for(let In of Tn){let si=Lt.getTile(In).getBucket(Wt);si&&(Ht.conflationActive&&si.updateReplacement(In,Ht.replacementSource),si.evaluateScale(Ht,Wt),Ht.terrain&&hn>0&&si.elevationUpdate(Ht.terrain,hn,In,Wt.source),si.needsReEvaluation(Ht,un,Wt)&&si.evaluate(Wt))}})(re,ue,ge,pe),function(){let Ht,Lt,Wt;pt?(Ht=pe.length-1,Lt=-1,Wt=-1):(Ht=0,Lt=pe.length,Wt=1);let Tn=new Float64Array(16),hn=r.ab.vec3.create(),un=new r.P(0,0);for(let In=Ht;In!==Lt;In+=Wt){let si=pe[In],Gn=ue.getTile(si).getBucket(ge);if(!Gn||!Gn.uploaded)continue;let fr=!1;ve&&(fr=ve.getMaxCascadeForTile(si.toUnwrapped())===0);let tr=xe.calculatePosMatrix(si.toUnwrapped(),xe.worldSize),Ai=Gn.modelTraits;!dt&&pt&&(r.ab.mat4.invert(Tn,tr),r.ab.vec3.transformMat4(hn,Re,Tn),un.x=hn[0],un.y=hn[1]);let Bi=[];for(let qn of Gn.getNodesInfo()){if(qn.hiddenByReplacement||!qn.node.meshes)continue;let ci=qn.node,bn=0;re.terrain&&ci.elevation&&(bn=ci.elevation*re.terrain.exaggeration());let Ei=(()=>{let fi=qn.aabb;return Ve.min=[...fi.min],Ve.max=[...fi.max],Ve.min[2]+=bn,Ve.max[2]+=bn,r.ab.vec3.transformMat4(Ve.min,Ve.min,tr),r.ab.vec3.transformMat4(Ve.max,Ve.max,tr),Ve})(),Ir=qn.evaluatedScale;if(Ir[0]<=1&&Ir[1]<=1&&Ir[2]<=1&&Ei.intersects(et)===0)continue;if(!dt&&pt){let fi=.16666666666666666;qn.cameraCollisionOpacity=Re[0]>Ei.min[0]&&Re[0]<Ei.max[0]&&Re[1]>Ei.min[1]&&Re[1]<Ei.max[1]&&Re[2]*Ae<Ei.max[2]&&ci.footprint&&r.bA(un,ci.footprint)?Math.max(qn.cameraCollisionOpacity-fi,0):Math.min(1,qn.cameraCollisionOpacity+fi)}let ko=[...tr],Ks=ci.anchor?ci.anchor[0]:0,es=ci.anchor?ci.anchor[1]:0;r.ab.mat4.translate(ko,ko,[Ks*(Ir[0]-1),es*(Ir[1]-1),bn]),r.ab.vec3.exactEquals(Ir,r.dm)||r.ab.mat4.scale(ko,ko,Ir);let To=r.ab.mat4.multiply([],ko,ci.matrix),eo=r.ab.mat4.multiply([],xe.expandedFarZProjMatrix,To),Br=r.ab.mat4.multiply([],xe.expandedFarZProjMatrix,ko),ar=r.ab.vec4.transformMat4([],[Ks,es,bn,1],eo)[2];ci.hidden=!1;let Xi=at;dt||(pt&&(Xi*=qn.cameraCollisionOpacity,Xi*=_m(ko,xe,qn.aabb,Ct)),Xi*=gm(lt,ar)),Xi!==0?Bi.push({nodeInfo:qn,depth:ar,opacity:Xi,wvpForNode:eo,wvpForTile:Br,nodeModelMatrix:To,tileModelMatrix:ko}):ci.hidden=!0}dt||Bi.sort((qn,ci)=>!pt||qn.opacity===1&&ci.opacity===1?qn.depth<ci.depth?-1:1:qn.opacity===1?-1:ci.opacity===1?1:qn.depth>ci.depth?-1:1);for(let qn of Bi){let ci=qn.nodeInfo,bn=ci.node,Ei=r.ab.mat4.multiply([],ze,qn.tileModelMatrix);r.ab.mat4.multiply(Ei,$e,Ei);let Ir=r.ab.mat4.invert([],Ei);r.ab.mat4.transpose(Ir,Ir),r.ab.mat4.scale(Ir,Ir,lu),Ei=r.ab.mat4.multiply(Ei,Ei,bn.matrix);let ko=re.renderPass==="light-beam",Ks=ge.paint.get("model-color-use-theme").constantOr("default")==="none",es=Ai&r.dp.HasMapboxMeshFeatures,To=es?0:ci.evaluatedRMEA[0][2];for(let eo=0;eo<bn.meshes.length;++eo){let Br=bn.meshes[eo],ar=eo===bn.lightMeshIndex,Xi=qn.wvpForNode;if(ar){if(!ko&&!re.terrain&&re.shadowRenderer){re.currentLayer<re.firstLightBeamLayer&&(re.firstLightBeamLayer=re.currentLayer);continue}Xi=qn.wvpForTile}else if(ko)continue;let fi={defines:[]},kr=[];if(!dt&&ve&&(ve.useNormalOffset=!!Br.normalBuffer),Ti(fi.defines,kr,Br,re,Ks?null:ge.lut),es||fi.defines.push("DIFFUSE_SHADED"),fr&&fi.defines.push("SHADOWS_SINGLE_CASCADE"),Nt&&(dt?Nt.numRenderedVerticesInShadowPass+=Br.vertexArray.length:Nt.numRenderedVerticesInTransparentPass+=Br.vertexArray.length),dt){hd(Br,qn.nodeModelMatrix,re,ge);continue}let Eo=null;if(be){let Vl=sr(qn.nodeModelMatrix,re.transform);if(Eo=new Float32Array(Vl),xe.projection.name!=="globe"){let ts=Br.aabb.min,fa=Br.aabb.max,[Mc,fl]=be.getOpacityForBounds(Vl,ts[0],ts[1],fa[0],fa[1]);fi.overrideFog=Mc>=$t||fl>=$t}}let nr=Br.material,Zo;nr.occlusionTexture&&nr.occlusionTexture.offsetScale&&(Zo=nr.occlusionTexture.offsetScale,fi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let da=re.getOrCreateProgram("model",fi);!dt&&ve&&ve.setupShadowsFromMatrix(qn.tileModelMatrix,da,ve.useNormalOffset),re.uploadCommonUniforms(we,da,null,Eo);let Is=nr.pbrMetallicRoughness;Is.metallicFactor=.9,Is.roughnessFactor=.5;let Cc=hm(new Float32Array(Xi),new Float32Array(Ei),new Float32Array(Ir),new Float32Array(bn.matrix),re,qn.opacity,Is.baseColorFactor.toRenderColor(null),nr.emissiveFactor,Is.metallicFactor,Is.roughnessFactor,nr,To,ge,[0,0,0],Zo);!ar&&(ci.hasTranslucentParts||qn.opacity<1)&&da.draw(re,we.gl.TRIANGLES,gt,Sn.disabled,$n.disabled,yn.backCCW,Cc,ge.id,Br.vertexBuffer,Br.indexBuffer,Br.segments,ge.paint,re.transform.zoom,void 0,kr),da.draw(re,we.gl.TRIANGLES,ar?St:gt,Sn.disabled,ar||qn.opacity<1||ci.hasTranslucentParts?$n.alphaBlended:$n.unblended,yn.backCCW,Cc,ge.id,Br.vertexBuffer,Br.indexBuffer,Br.segments,ge.paint,re.transform.zoom,void 0,kr)}}}}()}(f,o,l,p),void k();if(N.type!=="model")return;let B=N.getModels(),H=[],U=f.transform.getFreeCameraOptions().position,q=r.ab.vec3.scale([],[U.x,U.y,U.z],f.transform.worldSize);r.ab.vec3.negate(q,q);let ee=[],Q=[],ie=0;for(let re of B){let ue=l.paint.get("model-rotation").constantOr(null),ge=l.paint.get("model-scale").constantOr(null),pe=l.paint.get("model-translation").constantOr(null);re.computeModelMatrix(f,ue,ge,pe,!0,!0,!1);let we=r.ab.mat4.identity([]),xe=r.dj(re.position.lat,f.transform.zoom),be=r.ab.mat4.fromScaling([],[1,1,1/xe]);r.ab.mat4.translate(we,we,q),H.push({zScaleMatrix:be,negCameraPosMatrix:we});for(let ve of re.nodes)yc(f.transform,ve,re.matrix,f.transform.expandedFarZProjMatrix,ie,ee,Q);ie++}if(ee.sort((re,ue)=>ue.depth-re.depth),f.renderPass!=="shadow"){if(y===1)for(let re of Q)zf(re,f,l,H[re.modelIndex],Sn.disabled,f.colorModeForRenderPass());else{for(let re of Q)zf(re,f,l,H[re.modelIndex],Sn.disabled,$n.disabled);for(let re of Q)zf(re,f,l,H[re.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(let re of ee)zf(re,f,l,H[re.modelIndex],Sn.disabled,f.colorModeForRenderPass());k()}else{for(let re of Q)hd(re.mesh,re.nodeModelMatrix,f,l);for(let re of ee)hd(re.mesh,re.nodeModelMatrix,f,l);k()}}},xm={model:function(f,o,l){let p=o.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,p.type==="vector"?f.scope:""));if(p.type==="batched-model"||p.type!=="model")return;let y=p.getModels();for(let v of y)v.upload(l.context)},raster:function(f,o,l){let p=o.getSource();if(!(p instanceof hr&&p.loaded()))return;let y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;let v=f.paint.get("raster-array-band")||p.getInitialBand(y);if(v==null)return;let C=o.getIds().map(D=>o.getTileByID(D));for(let D of C)D.updateNeeded(y,v)&&p.prepareTile(D,y,v)},"raster-particle":function(f,o,l){let p=o.getSource();if(!(p instanceof hr&&p.loaded()))return;let y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;let v=f.paint.get("raster-particle-array-band")||p.getInitialBand(y);if(v==null)return;let C=o.getIds().map(D=>o.getTileByID(D));for(let D of C)D.updateNeeded(y,v)&&p.prepareTile(D,y,v)}};class R_{constructor(o,l,p,y,v){this.context=new Zs(o,l),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let C=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let k of C)this._debugParams.enabledLayers[k]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let k of C)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],k);this.occlusionParams=new E_(v),this.setup(),this.numSublayers=ls.maxUnderzooming+ls.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new il(this),this._wireframeDebugCache=new T_,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let D=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,D,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y}updateTerrain(o,l){let p=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new nm(this,o));let y=this._terrain;this.transform.elevation=p?y:null,y.update(o,this.transform,l),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(o){let l=o.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[p,y]=l.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);let v=p+.78*(y-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new nm(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,l){if(this.width=o*r.q.devicePixelRatio,this.height=l*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let p of this.style.order)this.style._mergedLayers[p].resize()}setup(){let o=this.context,l=new r.b4;l.emplaceBack(0,0),l.emplaceBack(r.ag,0),l.emplaceBack(0,r.ag),l.emplaceBack(r.ag,r.ag),this.tileExtentBuffer=o.createVertexBuffer(l,r.b6.members),this.tileExtentSegments=r.b7.simpleSegment(0,0,4,2);let p=new r.b4;p.emplaceBack(0,0),p.emplaceBack(r.ag,0),p.emplaceBack(0,r.ag),p.emplaceBack(r.ag,r.ag),this.debugBuffer=o.createVertexBuffer(p,r.b6.members),this.debugSegments=r.b7.simpleSegment(0,0,4,5);let y=new r.b4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(y,r.b6.members),this.viewportSegments=r.b7.simpleSegment(0,0,4,2);let v=new r.aT;v.emplaceBack(0,0,0,0),v.emplaceBack(r.ag,0,r.ag,0),v.emplaceBack(0,r.ag,0,r.ag),v.emplaceBack(r.ag,r.ag,r.ag,r.ag),this.mercatorBoundsBuffer=o.createVertexBuffer(v,r.b9.members),this.mercatorBoundsSegments=r.b7.simpleSegment(0,0,4,2);let C=new r.aU;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(C);let D=new r.b5;for(let N of[0,1,3,2,0])D.emplaceBack(N);this.debugIndexBuffer=o.createIndexBuffer(D),this.emptyTexture=new r.T(o,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=r.ab.mat4.create();let k=this.context.gl;this.stencilClearMode=new Sn({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,an.disabled,this.stencilClearMode,$n.disabled,yn.disabled,Pf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,l,p){if(!l||this.currentStencilSource===l.id||!o.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(let k of p)if(this._tileClippingMaskIDs[k.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=l.id;let y=this.context,v=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode($n.disabled),y.setDepthMode(an.disabled);let C=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let D of p){let k=l.getTile(D),N=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:H,tileBoundsSegments:U}=this.getTileBoundsBuffers(k);C.draw(this,v.TRIANGLES,an.disabled,new Sn({func:v.ALWAYS,mask:0},N,255,v.KEEP,v.KEEP,v.REPLACE),$n.disabled,yn.disabled,Pf(D.projMatrix),"$clipping",B,H,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let o=this.nextStencilID++,l=this.context.gl;return new Sn({func:l.NOTEQUAL,mask:255},o,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);let l=this.context.gl;return new Sn({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(o){let l=this.context.gl,p=o.sort((C,D)=>D.overscaledZ-C.overscaledZ),y=p[p.length-1].overscaledZ,v=p[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();let C={};for(let D=0;D<v;D++)C[D+y]=new Sn({func:l.GEQUAL,mask:255},D+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[C,p]}return[{[y]:Sn.disabled},p]}colorModeForRenderPass(){let o=this.context.gl;return this._showOverdrawInspector?new $n([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new r.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$n.unblended:$n.alphaBlended}colorModeForDrapableLayerRenderPass(o){let l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new $n([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new r.aj(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,l,p,y=!1){if(this.depthOcclusion)return new an(this.context.gl.GREATER,an.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return an.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new an(p||this.context.gl.LEQUAL,l,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let o=this.context.gl,l=Math.ceil(this.width),p=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),v=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&p!==0&&(this.depthFBO=new fm(this.context,l,p,!1,"texture"),this.depthTexture=new r.T(this.context,{width:l,height:p,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),o.bindTexture(o.TEXTURE_2D,v),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,l,p,0,0,l,p,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,l)=>o+l/this._fpsHistory.length,0))}render(o,l){let p=r.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=l;let y=this.style._mergedLayers,v=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(Ae=>{let ze=y[Ae];return!(ze.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ze.type]}),C=!1,D=!1;for(let Ae of v){let ze=y[Ae];ze.type==="circle"&&(C=!0),ze.type==="symbol"&&(ze.hasInitialOcclusionOpacityProperties?D=!0:C=!0)}let k=v.map(Ae=>y[Ae]),N=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let B=0,H=!1;for(let Ae in N){let ze=N[Ae];ze.used&&(ze.prepare(this.context),ze.getSource().usedInConflation&&++B)}let U=!1;for(let Ae of k)Ae.isHidden(this.transform.zoom)||(Ae.type==="clip"&&(U=!0),this.prepareLayer(Ae));let q={},ee={},Q={},ie={},re={};for(let Ae in N){let ze=N[Ae];q[Ae]=ze.getVisibleCoordinates(),ee[Ae]=q[Ae].slice().reverse(),Q[Ae]=ze.getVisibleCoordinates(!0).reverse(),ie[Ae]=ze.getShadowCasterCoordinates(),re[Ae]=ze.sortCoordinatesByDistance(q[Ae])}let ue=Ae=>{let ze=this.style.getLayerSourceCache(Ae);return ze&&ze.used?ze.getSource():null};if(B||U||this._clippingActiveLastFrame){let Ae=[],ze=[],at=0;for(let gt of k)this.isSourceForClippingOrConflation(gt,ue(gt))&&(Ae.push(gt),ze.push(at)),at++;if(Ae&&(U||Ae.length>1)||this._clippingActiveLastFrame){U=!1;let gt=[];for(let St=0;St<Ae.length;St++){let Ve=Ae[St],dt=ze[St],et=this.style.getLayerSourceCache(Ve);if(!et||!et.used||!et.getSource().usedInConflation&&Ve.type!=="clip")continue;let Ct=r.dx,pt=r.by.None,lt=[],Nt=!0;if(Ve.type==="clip"){Ct=dt;for(let Ht of Ve.layout.get("clip-layer-types"))pt|=Ht==="model"?r.by.Model:Ht==="symbol"?r.by.Symbol:r.by.FillExtrusion;for(let Ht of Ve.layout.get("clip-layer-scope"))lt.push(Ht);Ve.isHidden(this.transform.zoom)?Nt=!1:U=!0}Nt&&gt.push({layer:Ve.fqid,cache:et,order:Ct,clipMask:pt,clipScope:lt})}this.replacementSource.setSources(gt),H=!0}}this._clippingActiveLastFrame=U,H||this.replacementSource.clear(),this.conflationActive=H,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ae=0;Ae<k.length;Ae++){let ze=k[Ae],at=ze.cutoffRange();if(this.longestCutoffRange=Math.max(at,this.longestCutoffRange),at>0){let gt=ue(ze);gt&&(this.minCutoffZoom=Math.max(gt.minzoom,this.minCutoffZoom)),ze.minzoom&&(this.minCutoffZoom=Math.max(ze.minzoom,this.minCutoffZoom))}ze.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ae),this._lastOcclusionLayer=Ae)}let ge=this.style&&this.style.fog;ge?(this._fogVisible=ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Q),this.opaquePassCutoff=0);let pe=this._shadowRenderer;if(pe){pe.updateShadowParameters(this.transform,this.style.directionalLight);for(let Ae in N)for(let ze of q[Ae]){let at={min:0,max:0};this.terrain&&(at=this.terrain.getMinMaxForTile(ze)||at),pe.addShadowReceiver(ze.toUnwrapped(),at.min,at.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Nf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);let we=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(we&&!this._snow&&(this._snow=new A_(this)),!we&&this._snow&&(this._snow.destroy(),delete this._snow),xe&&!this._rain&&(this._rain=new D_(this)),!xe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!on.has(this.context.gl))return;this.renderPass="offscreen";for(let Ae of k){let ze=o.getLayerSourceCache(Ae);if(!Ae.hasOffscreenPass()||Ae.isHidden(this.transform.zoom))continue;let at=ze?ee[ze.id]:void 0;(Ae.type==="custom"||Ae.type==="raster"||Ae.type==="raster-particle"||Ae.isSky()||at&&at.length)&&this.renderLayer(this,ze,Ae,at)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ie)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let be=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ve=(()=>{if(l.showOverdrawInspector)return r.aj.black;let Ae=this.style.fog;if(Ae&&this.transform.projection.supportsFog){let ze=this.style.getLut(Ae.scope);if(!be){let at=Ae.properties.get("color-use-theme")==="none",gt=Ae.properties.get("color").toRenderColor(at?null:ze).toArray01();return new r.aj(...gt)}if(be){let at=Ae.properties.get("space-color-use-theme")==="none",gt=Ae.properties.get("space-color").toRenderColor(at?null:ze).toArray01();return new r.aj(...gt)}}return r.aj.transparent})();if(this.context.clear({color:ve,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&be&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){let Ae=k[this.currentLayer],ze=o.getLayerSourceCache(Ae);if(Ae.isSky())continue;let at=ze?(Ae.is3D()?re:ee)[ze.id]:void 0;this._renderTileClippingMasks(Ae,ze,at),this.renderLayer(this,ze,Ae,at)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&be&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){let Ae=k[this.currentLayer],ze=o.getLayerSourceCache(Ae);Ae.isSky()&&this.renderLayer(this,ze,Ae,ze?ee[ze.id]:void 0)}function Ie(Ae,ze){let at;return ze&&(at=(Ae.type==="symbol"?Q:Ae.is3D()?re:ee)[ze.id]),at}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){let Ae=k[this.currentLayer];if(Ae.type==="raster"||Ae.type==="raster-particle"){let ze=o.getLayerSourceCache(Ae);this.renderLayer(this,ze,Ae,Ie(Ae,ze))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Re=0;pe&&(Re=pe.getShadowCastingLayerCount());let Ye=!1,$e=-1;for(let Ae=0;Ae<v.length;++Ae){let ze=k[Ae];ze.isHidden(this.transform.zoom)||ze.is3D()&&($e=Ae)}for(D&&$e===-1&&(C=!0);this.currentLayer<v.length;){let Ae=k[this.currentLayer],ze=o.getLayerSourceCache(Ae);if(Ae.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ae)){if(Ae.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(C&&!Ye&&this.terrain&&!this.transform.isOrthographic&&(Ye=!0,this.blitDepth()),D&&$e!==-1&&this.currentLayer===$e+1&&!this.transform.isOrthographic&&this.blitDepth(),Ae.is3D()||this.terrain||this._renderTileClippingMasks(Ae,ze,ze?q[ze.id]:void 0),this.renderLayer(this,ze,Ae,Ie(Ae,ze)),!this.terrain&&pe&&Re>0&&Ae.hasShadowPass()&&--Re==0&&(pe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let at=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=at;this.currentLayer++){let gt=k[this.currentLayer];if(!gt.hasLightBeamPass())continue;let St=o.getLayerSourceCache(gt);this.renderLayer(this,St,gt,St?ee[St.id]:void 0)}this.currentLayer=at,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let at=this.currentLayer;this.depthOcclusion=!0;for(let gt of this.layersWithOcclusionOpacity){this.currentLayer=gt;let St=k[this.currentLayer],Ve=o.getLayerSourceCache(St),dt=Ve?ee[Ve.id]:void 0;St.is3D()||this.terrain||this._renderTileClippingMasks(St,Ve,Ve?q[Ve.id]:void 0),this.renderLayer(this,Ve,St,dt)}this.depthOcclusion=!1,this.currentLayer=at,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ae=null;k.forEach(ze=>{let at=o.getLayerSourceCache(ze);at&&!ze.isHidden(this.transform.zoom)&&at.getVisibleCoordinates().length&&(!Ae||Ae.getSource().maxzoom<at.getSource().maxzoom)&&(Ae=at)}),Ae&&this.options.showTileBoundaries&&xc.debug(this,Ae,Ae.getVisibleCoordinates(),r.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&xc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ae){let ze=Ae.transform.padding;w_(Ae,Ae.transform.height-(ze.top||0),3,Rv),w_(Ae,ze.bottom||0,3,kv),Lf(Ae,ze.left||0,3,Lv),Lf(Ae,Ae.transform.width-(ze.right||0),3,ld);let at=Ae.transform.centerPoint;(function(gt,St,Ve,dt){ud(gt,St-1,Ve-10,2,20,dt),ud(gt,St-10,Ve-1,20,2,dt)})(Ae,at.x,Ae.transform.height-at.y,LC)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),H||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);let{unsupportedLayers:l}=this.transform.projection,p=!l||!l.includes(o.type);if(xm[o.type]&&(p||this.terrain&&o.type==="custom")){let y=this.style.getLayerSourceCache(o);xm[o.type](o,y,this)}this.gpuTimingEnd()}renderLayer(o,l,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(p.type)&&(!o.terrain||p.type!=="custom")||p.type==="clip"||xc[p.type](o,l,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;let l=this.context.extTimerQuery,p=this.context.gl,y=this.gpuTimers[o.id];y||(y=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:p.createQuery()}),y.calls++,p.beginQuery(l.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let o=this.context.extTimerQuery,l=this.context.gl,p=l.createQuery();this.deferredRenderGpuTimeQueries.push(p),l.beginQuery(o.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){let o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){let l={};for(let p in o){let y=o[p],v=this.context.extTimerQuery,C=v.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(y.query),l[p]=C}return l}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;let l=this.context.gl,p=0;for(let y of o)p+=l.getQueryParameter(y,l.QUERY_RESULT)/1e6,l.deleteQuery(y);return p}translatePosMatrix(o,l,p,y,v){if(!p[0]&&!p[1])return o;let C=v?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(C){let N=Math.sin(C),B=Math.cos(C);p=[p[0]*B-p[1]*N,p[0]*N+p[1]*B]}let D=[v?p[0]:r.ar(l,p[0],this.transform.zoom),v?p[1]:r.ar(l,p[1],this.transform.zoom),0],k=new Float32Array(16);return r.ab.mat4.translate(k,o,D),k}saveTileTexture(o){let l=o.size[0],p=this._tileTextures[l];p?p.push(o):this._tileTextures[l]=[o]}getTileTexture(o){let l=this._tileTextures[o];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,l,p){let y=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,v=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||y||l!==void 0&&!l||v.push("FOG","FOG_DITHERING"),y&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(o,l){this.cache=this.cache||{};let p=l&&l.defines||[],y=l&&l.config,v=this.currentGlobalDefines(o,l&&l.overrideFog,l&&l.overrideRtt).concat(p),C=bv.cacheKey(ha[o],o,v,y);return this.cache[C]||(this.cache[C]=new bv(this.context,o,ha[o],y,RC[o],v)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,l){if(this.style.enable3dLights()){let p=this.style.directionalLight,y=this.style.ambientLight;if(p&&y){let v=((C,D,k)=>{let N=C.properties.get("direction"),B=C.properties.get("color-use-theme")==="none",H=C.properties.get("color").toRenderColor(B?null:k.getLut(C.scope)).toArray01(),U=C.properties.get("intensity"),q=D.properties.get("color-use-theme")==="none",ee=D.properties.get("color").toRenderColor(q?null:k.getLut(D.scope)).toArray01(),Q=D.properties.get("intensity"),ie=[N.x,N.y,N.z],re=r.cM(ee,Q),ue=r.cM(H,U);return{u_lighting_ambient_color:re,u_lighting_directional_dir:ie,u_lighting_directional_color:ue,u_ground_radiance:DC(ie,ue,re)}})(p,y,this.style);l.setLightsUniformValues(o,v)}}}uploadCommonUniforms(o,l,p,y,v){if(this.uploadCommonLightUniforms(o,l),this.terrain&&this.terrain.renderingToTexture)return;let C=this.style.fog;if(C){let D=C.getOpacity(this.transform.pitch),k=((N,B,H,U,q,ee,Q,ie,re,ue,ge,pe)=>{let we=N.transform,xe=B.properties.get("color-use-theme")==="none",be=B.properties.get("color").toRenderColor(xe?null:N.style.getLut(B.scope)).toArray01();be[3]=U;let ve=N.frameCounter/1e3%1,[Ie,Re]=B.properties.get("vertical-range");return{u_fog_matrix:H?we.calculateFogTileMatrix(H):pe||N.identityMat,u_fog_range:B.getFovAdjustedRange(we._fov),u_fog_color:be,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ie,Re),Re],u_fog_temporal_offset:ve,u_frustum_tl:q,u_frustum_tr:ee,u_frustum_br:Q,u_frustum_bl:ie,u_globe_pos:re,u_globe_radius:ue,u_viewport:ge,u_globe_transition:r.ae(we.zoom),u_is_globe:+(we.projection.name==="globe")}})(this,C,p,D,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],y);l.setFogUniformValues(o,k)}v&&l.setCutoffUniformValues(o,v.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){let o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){let o=this.context.gl,l=o.createTexture();return o.bindTexture(o.TEXTURE_2D,l),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let o=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(let y of p)l[y.key]=o[y.key]||new Bs(y,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,l){return!(!o.is3D()||o.type!=="clip"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[o.key];return l||(this._cachedTileFogOpacities[o.key]=l=this.style.fog.getOpacityForTile(o)),l[0]>=$t||l[1]>=$t}setupDepthForOcclusion(o,l,p){let y=this.context,v=y.gl,C=!!p;var D;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(v.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((D=this.depthRangeFor3D)[1]-D[0]),-1-2*D[0]/(D[1]-D[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),y.activeTexture.set(v.TEXTURE0),C||l.setTerrainUniformValues(y,p)}}function bm(f,o){let l=!1,p=null,y=()=>{p=null,l&&(f(),p=setTimeout(y,o),l=!1)};return()=>(l=!0,p||y(),p)}class wm{constructor(o){this._hashName=o&&encodeURIComponent(o),r.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=bm(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let o=this._map;if(!o)return"";let l=Cm(o);if(this._hashName){let p=this._hashName,y=!1,v=location.hash.slice(1).split("&").map(C=>{let D=C.split("=")[0];return D===p?(y=!0,`${D}=${l}`):C}).filter(C=>C);return y||v.push(`${p}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){let o=location.hash.replace("#","");if(this._hashName){let l;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return o.split("/")}_onHashChange(){let o=this._map;if(!o)return!1;let l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){let p=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(l[3]||0):o.getBearing();return o.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Cm(f,o){let l=f.getCenter(),p=Math.round(100*f.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),C=Math.round(l.lng*v)/v,D=Math.round(l.lat*v)/v,k=f.getBearing(),N=f.getPitch(),B=o?`/${C}/${D}/${p}`:`${p}/${D}/${C}`;return(k||N)&&(B+="/"+Math.round(10*k)/10),N&&(B+=`/${Math.round(N)}`),B}let fd={linearity:.3,easing:r.dy(0,0,.3,1)},Bv=r.l({deceleration:2500,maxSpeed:1400},fd),Vv=r.l({deceleration:20,maxSpeed:1400},fd),jv=r.l({deceleration:1e3,maxSpeed:360},fd),Uv=r.l({deceleration:1e3,maxSpeed:90},fd);class Hv{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:o})}_drainInertiaBuffer(){let o=this._inertiaBuffer,l=r.q.now();for(;o.length>0&&l-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let l={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);let p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(l.pan.mag()){let v=jf(l.pan.mag(),p,r.l({},Bv,o||{}));y.offset=l.pan.mult(v.amount/l.pan.mag()),y.center=this._map.transform.center,Vf(y,v)}if(l.zoom){let v=jf(l.zoom,p,Vv);y.zoom=this._map.transform.zoom+v.amount,Vf(y,v)}if(l.bearing){let v=jf(l.bearing,p,jv);y.bearing=this._map.transform.bearing+r.aw(v.amount,-179,179),Vf(y,v)}if(l.pitch){let v=jf(l.pitch,p,Uv);y.pitch=this._map.transform.pitch+v.amount,Vf(y,v)}if(y.zoom||y.bearing){let v=l.pinchAround===void 0?l.around:l.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Vf(f,o){(!f.duration||f.duration<o.duration)&&(f.duration=o.duration,f.easing=o.easing)}function jf(f,o,l){let{maxSpeed:p,linearity:y,deceleration:v}=l,C=r.aw(f*y/(o/1e3),-p,p),D=Math.abs(C)/(v*y);return{easing:l.easing,duration:1e3*D,amount:C*(D/2)}}class Ys extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,l,p,y={}){let v=yt(l.getCanvasContainer(),p),C=l.unproject(v);super(o,r.l({point:v,lngLat:C,originalEvent:p},y)),this._defaultPrevented=!1,this.target=l}}class Uf extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,l,p){let y=o==="touchend"?p.changedTouches:p.touches,v=rn(l.getCanvasContainer(),y),C=v.map(k=>l.unproject(k)),D=v.reduce((k,N,B,H)=>k.add(N.div(H.length)),new r.P(0,0));super(o,{points:v,point:D,lngLats:C,lngLat:l.unproject(D),originalEvent:p}),this._defaultPrevented=!1}}class $v extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class Gv{constructor(o,l){this._map=o,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new $v(this._map,o))}mousedown(o,l){return this._mousedownPos=l,this._firePreventable(new Ys(o.type,this._map,o))}mouseup(o){this._map.fire(new Ys(o.type,this._map,o))}preclick(o){let l=r.l({},o);l.type="preclick",this._map.fire(new Ys(l.type,this._map,l))}click(o,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Ys(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Ys(o.type,this._map,o))}mouseover(o){this._map.fire(new Ys(o.type,this._map,o))}mouseout(o){this._map.fire(new Ys(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Uf(o.type,this._map,o))}touchmove(o){this._map.fire(new Uf(o.type,this._map,o))}touchend(o){this._map.fire(new Uf(o.type,this._map,o))}touchcancel(o){this._map.fire(new Uf(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qv{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Ys(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ys("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Ys(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zv{constructor(o,l){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,l){this.isEnabled()&&o.shiftKey&&o.button===0&&(st(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(o,l){if(!this._active)return;let p=l,y=this._startPos,v=this._lastPos;if(!y||!v||v.equals(p)||!this._box&&p.dist(y)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=ae("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));let C=Math.min(y.x,p.x),D=Math.max(y.x,p.x),k=Math.min(y.y,p.y),N=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${k}px)`,this._box.style.width=D-C+"px",this._box.style.height=N-k+"px")})}mouseupWindow(o,l){if(!this._active)return;let p=this._startPos,y=l;if(p&&o.button===0){if(this.reset(),xt(),p.x!==y.x||p.y!==y.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:o})),{cameraAnimation:v=>v.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ut(),delete this._startPos,delete this._lastPos}_fireEvent(o,l){return this._map.fire(new r.z(o,{originalEvent:l}))}}function k_(f,o){let l={};for(let p=0;p<f.length;p++)l[f[p].identifier]=o[p];return l}class zC{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){let v=new r.P(0,0);for(let C of y)v._add(C);return v.div(y.length)}(l),this.touches=k_(p,l)))}touchmove(o,l,p){if(this.aborted||!this.centroid)return;let y=k_(p,l);for(let v in this.touches){let C=y[v];(!C||C.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(o,l,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){let y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Rr{constructor(o){this.singleTap=new zC(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,l,p){this.singleTap.touchstart(o,l,p)}touchmove(o,l,p){this.singleTap.touchmove(o,l,p)}touchend(o,l,p){let y=this.singleTap.touchend(o,l,p);if(y){let v=o.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(y)<30;if(v&&C||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Wv{constructor(){this._zoomIn=new Rr({numTouches:1,numTaps:2}),this._zoomOut=new Rr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,l,p){this._zoomIn.touchstart(o,l,p),this._zoomOut.touchstart(o,l,p)}touchmove(o,l,p){this._zoomIn.touchmove(o,l,p),this._zoomOut.touchmove(o,l,p)}touchend(o,l,p){let y=this._zoomIn.touchend(o,l,p),v=this._zoomOut.touchend(o,l,p);return y?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(y)},{originalEvent:o})}):v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(v)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let BC={0:1,2:2};class L_{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,l){return!1}_move(o,l){return{}}mousedown(o,l){if(this._lastPoint)return;let p=Dt(o);this._correctButton(o,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(o,l){let p=this._lastPoint;if(p){if(o.preventDefault(),this._eventButton!=null&&function(y,v){let C=BC[v];return y.buttons===void 0||(y.buttons&C)!==C}(o,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(o){this._lastPoint&&Dt(o)===this._eventButton&&(this._moved&&xt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hf extends L_{mousedown(o,l){super.mousedown(o,l),this._lastPoint&&(this._active=!0)}_correctButton(o,l){return l===0&&!o.ctrlKey}_move(o,l){return{around:l,panDelta:l.sub(o)}}}class F_ extends L_{_correctButton(o,l){return l===0&&o.ctrlKey||l===2}_move(o,l){let p=.8*(l.x-o.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(o){o.preventDefault()}}class Mm extends L_{_correctButton(o,l){return l===0&&o.ctrlKey||l===2}_move(o,l){let p=-.5*(l.y-o.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(o){o.preventDefault()}}class Tm{constructor(o,l){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),r.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(o,l,p){return this._calculateTransform(o,l,p)}touchmove(o,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!r.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,l,p)}}touchend(o,l,p){this._calculateTransform(o,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,l,p){p.length>0&&(this._active=!0);let y=k_(p,l),v=new r.P(0,0),C=new r.P(0,0),D=0;for(let N in y){let B=y[N],H=this._touches[N];H&&(v._add(B),C._add(B.sub(H)),D++,y[N]=B)}if(this._touches=y,D<this._minTouches||!C.mag())return;let k=C.div(D);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(D),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ae("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class hl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,l,p){return{}}touchstart(o,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(o,l,p){let y=this._firstTwoTouches;if(!y)return;o.preventDefault();let[v,C]=y,D=oh(p,l,v),k=oh(p,l,C);if(!D||!k)return;let N=this._aroundCenter?null:D.add(k).div(2);return this._move([D,k],N,o)}touchend(o,l,p){if(!this._firstTwoTouches)return;let[y,v]=this._firstTwoTouches,C=oh(p,l,y),D=oh(p,l,v);C&&D||(this._active&&xt(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function oh(f,o,l){for(let p=0;p<f.length;p++)if(f[p].identifier===l)return o[p]}function Hr(f,o){return Math.log(f/o)/Math.LN2}class Bl extends hl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,l){let p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Hr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hr(this._distance,p),pinchAround:l}}}function Em(f,o){return 180*f.angleWith(o)/Math.PI}class Sm extends hl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,l){let p=this._vector;if(this._vector=o[0].sub(o[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Em(this._vector,p),pinchAround:l}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());let l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;let y=Em(o,p);return Math.abs(y)<l}}function Im(f){return Math.abs(f.y)>Math.abs(f.x)}class VC extends hl{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Im(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,l,p){let y=this._lastPoints;if(!y)return;let v=o[0].sub(y[0]),C=o[1].sub(y[1]);return this._map._cooperativeGestures&&!r.dz()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,C,p.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(v.y+C.y)/2*-.5})}gestureBeginsVertically(o,l,p){if(this._valid!==void 0)return this._valid;let y=o.mag()>=2,v=l.mag()>=2;if(!y&&!v)return;if(!y||!v)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;let C=o.y>0==l.y>0;return Im(o)&&Im(l)&&C}}let $f={panStep:100,bearingStep:15,pitchStep:10};class jC{constructor(){let o=$f;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let l=0,p=0,y=0,v=0,C=0;switch(o.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),v=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),v=1);break;case 38:o.shiftKey?y=1:(o.preventDefault(),C=-1);break;case 40:o.shiftKey?y=-1:(o.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:D=>{let k=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:UC,zoom:l?Math.round(k)+l*(o.shiftKey?2:1):k,bearing:D.getBearing()+p*this._bearingStep,pitch:D.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-C*this._panStep],center:D.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function UC(f){return f*(2-f)}let Pm=4.000244140625,N_=1/450;class pd{constructor(o,l){this._map=o,this._el=o.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=N_,r.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||r.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY,p=r.q.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%Pm==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(y*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),o.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=o,this._delta-=l,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let l=yt(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let l=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){let N=this._type==="wheel"&&Math.abs(this._delta)>Pm?this._wheelZoomRate:this._defaultZoomRate,B=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&B!==0&&(B=1/B);let H=l(),U=Math.pow(2,H),q=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(q*B))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let p=typeof this._targetZoom=="number"?this._targetZoom:l(),y=this._startZoom,v=this._easing,C,D=!1;if(this._type==="wheel"&&y&&v){let N=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),B=v(N);C=r.af(y,p,B),N<1?this._frameId||(this._frameId=!0):D=!0}else C=p,D=!0;this._active=!0,D&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let k=C-l();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!D,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let l=r.dA;if(this._prevEase){let p=this._prevEase,y=(r.q.now()-p.start)/p.duration,v=p.easing(y+.01)-p.easing(y),C=.27/Math.sqrt(v*v+1e-4)*.01,D=Math.sqrt(.0729-C*C);l=r.dy(C,D,.25,1)}return this._prevEase={start:r.q.now(),duration:o,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ae("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class md{constructor(o,l){this._clickZoom=o,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,l){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(o.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dl{constructor(){this._tap=new Rr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,l,p){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(o,l,p))}touchmove(o,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;let y=l[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,o.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(o,l,p)}touchend(o,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(o,l,p)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class du{constructor(o,l,p){this._el=o,this._mousePan=l,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class sh{constructor(o,l,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fu{constructor(o,l,p,y){this._el=o,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Dm=f=>f.zoom||f.drag||f.pitch||f.rotate;class HC extends r.z{}class $C{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,l){let p=r.ab.vec3.sub([],l,o);this.radius=r.ab.vec3.length(p[2]<0?r.ab.vec3.div([],p,this.constants):[p[0],p[1],0])}projectRay(o){r.ab.vec3.div(o,o,this.constants),r.ab.vec3.normalize(o,o),r.ab.vec3.mul(o,o,this.constants);let l=r.ab.vec3.scale([],o,this.radius);if(l[2]>0){let p=r.ab.vec3.scale([],[0,0,1],r.ab.vec3.dot(l,[0,0,1])),y=r.ab.vec3.scale([],r.ab.vec3.normalize([],[l[0],l[1],0]),this.radius),v=r.ab.vec3.add([],l,r.ab.vec3.scale([],r.ab.vec3.sub([],r.ab.vec3.add([],y,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function Om(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Yv{constructor(o,l){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hv(o),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new $C,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),r.aP(["handleEvent","handleWindowEvent"],this);let p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(let[y,v,C]of this._listeners){let D=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(v,D,C)}}destroy(){for(let[o,l,p]of this._listeners){let y=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(l,y,p)}}_addDefaultHandlers(o){let l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new Gv(l,o));let y=l.boxZoom=new Zv(l,o);this._add("boxZoom",y);let v=new Wv,C=new bc;l.doubleClickZoom=new md(C,v),this._add("tapZoom",v),this._add("clickZoom",C);let D=new dl;this._add("tapDragZoom",D);let k=l.touchPitch=new VC(l);this._add("touchPitch",k);let N=new F_(o),B=new Mm(o);l.dragRotate=new sh(o,N,B),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);let H=new Hf(o),U=new Tm(l,o);l.dragPan=new du(p,H,U),this._add("mousePan",H),this._add("touchPan",U,["touchZoom","touchRotate"]);let q=new Sm,ee=new Bl;l.touchZoomRotate=new fu(p,ee,q,D),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new qv(l));let Q=l.scrollZoom=new pd(l,this);this._add("scrollZoom",Q,["mousePan"]);let ie=l.keyboard=new jC;this._add("keyboard",ie);for(let re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[re]&&l[re].enable(o[re])}_add(o,l,p){this._handlers.push({handlerName:o,handler:l,allowed:p}),this._handlersById[o]=l}stop(o){if(!this._updatingCamera){for(let{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Dm(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,l,p){for(let y in o)if(y!==p&&(!l||l.indexOf(y)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){let l=[];for(let p of o)this._el.contains(p.target)&&l.push(p);return l}handleEvent(o,l){this._updatingCamera=!0;let p=o.type==="renderFrame",y=p?void 0:o,v={needsRenderFrame:!1},C={},D={},k=o.touches?this._getMapTouches(o.touches):void 0,N=k?rn(this._el,k):p?void 0:yt(this._el,o);for(let{handlerName:U,handler:q,allowed:ee}of this._handlers){if(!q.isEnabled())continue;let Q;this._blockedByActive(D,ee,U)?q.reset():q[l||o.type]&&(Q=q[l||o.type](o,N,k),this.mergeHandlerResult(v,C,Q,U,y),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||q.isActive())&&(D[U]=q)}let B={};for(let U in this._previousActiveHandlers)D[U]||(B[U]=y);this._previousActiveHandlers=D,(Object.keys(B).length||Om(v))&&(this._changes.push([v,C,B]),this._triggerRenderFrame()),(Object.keys(D).length||Om(v))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:H}=v;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(o,l,p,y,v){if(!p)return;r.l(o,p);let C={handlerName:y,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(l.zoom=C),p.panDelta!==void 0&&(l.drag=C),p.pitchDelta!==void 0&&(l.pitch=C),p.bearingDelta!==void 0&&(l.rotate=C)}_applyChanges(){let o={},l={},p={};for(let[y,v,C]of this._changes)y.panDelta&&(o.panDelta=(o.panDelta||new r.P(0,0))._add(y.panDelta)),y.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(o.around=y.around),y.aroundCoord!==void 0&&(o.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(o.pinchAround=y.pinchAround),y.noInertia&&(o.noInertia=y.noInertia),r.l(l,v),r.l(p,C);this._updateMapTransform(o,l,p),this._changes=[]}_updateMapTransform(o,l,p){let y=this._map,v=y.transform,C=ue=>[ue.x,ue.y,ue.z];if((ue=>{let ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!Om(o)){let ue=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),ue!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&y._stop(!0),!Om(o))return void this._fireEvents(l,p,!0);let{panDelta:D,zoomDelta:k,bearingDelta:N,pitchDelta:B,around:H,aroundCoord:U,pinchAround:q}=o;v._isCameraConstrained&&(k>0&&(k=0),v._isCameraConstrained=!1),q!==void 0&&(H=q),(k||(ue=>l[ue]&&!this._eventsInProgress[ue])("drag"))&&H&&(this._dragOrigin=C(v.pointCoordinate3D(H)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),H=H||y.transform.centerPoint,N&&(v.bearing+=N),B&&(v.pitch+=B),v._updateCameraState();let ee=[0,0,0];if(D)if(v.projection.name==="mercator"){let ue=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(H).dir),ge=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(H.sub(D)).dir);ee[0]=ge[0]-ue[0],ee[1]=ge[1]-ue[1]}else{let ue=v.pointCoordinate(H);if(v.projection.name==="globe"){D=D.rotate(-v.angle);let ge=v._pixelsPerMercatorPixel/v.worldSize;ee[0]=-D.x*r.dB(r.aS(ue.y))*ge,ee[1]=-D.y*r.dB(v.center.lat)*ge}else{let ge=v.pointCoordinate(H.sub(D));ue&&ge&&(ee[0]=ge.x-ue.x,ee[1]=ge.y-ue.y)}}let Q=v.zoom,ie=[0,0,0];if(k){let ue=C(U||v.pointCoordinate3D(H)),ge={dir:r.ab.vec3.normalize([],r.ab.vec3.sub([],ue,v._camera.position))};if(ge.dir[2]<0){let pe=v.zoomDeltaToMovement(ue,k);r.ab.vec3.scale(ie,ge.dir,pe)}}let re=r.ab.vec3.add(ee,ee,ie);v._translateCameraConstrained(re),k&&Math.abs(v.zoom-Q)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(l,p,!0)}_fireEvents(o,l,p){let y=Dm(this._eventsInProgress),v=Dm(o),C={};for(let B in o){let{originalEvent:H}=o[B];this._eventsInProgress[B]||(C[`${B}start`]=H),this._eventsInProgress[B]=o[B]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(let B in C)this._fireEvent(B,C[B]);v&&this._fireEvent("move",v.originalEvent);for(let B in o){let{originalEvent:H}=o[B];this._fireEvent(B,H)}let D={},k;for(let B in this._eventsInProgress){let{handlerName:H,originalEvent:U}=this._eventsInProgress[B];this._handlersById[H].isActive()||(delete this._eventsInProgress[B],k=l[H]||U,D[`${B}end`]=k)}for(let B in D)this._fireEvent(B,D[B]);let N=Dm(this._eventsInProgress);if(p&&(y||v)&&!N){this._updatingCamera=!0;let B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;B?(H(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:k})):(this._map.fire(new r.z("moveend",{originalEvent:k})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,l){this._map.fire(new r.z(o,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new HC("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Qo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class z_ extends r.E{constructor(o,l){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,r.aP(["_renderFrameCallback"],this)}getCenter(){return new r.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(o,l){return this.jumpTo({center:o},l)}panBy(o,l,p){return o=r.P.convert(o).mult(-1),this.panTo(this.transform.center,r.l({offset:o},l),p)}panTo(o,l,p){return this.easeTo(r.l({center:o},l),p)}getZoom(){return this.transform.zoom}setZoom(o,l){return this.jumpTo({zoom:o},l),this}zoomTo(o,l,p){return this.easeTo(r.l({zoom:o},l),p)}zoomIn(o,l){return this.zoomTo(this.getZoom()+1,o,l),this}zoomOut(o,l){return this.zoomTo(this.getZoom()-1,o,l),this}getBearing(){return this.transform.bearing}setBearing(o,l){return this.jumpTo({bearing:o},l),this}getPadding(){return this.transform.padding}setPadding(o,l){return this.jumpTo({padding:o},l),this}rotateTo(o,l,p){return this.easeTo(r.l({bearing:o},l),p)}resetNorth(o,l){return this.rotateTo(0,r.l({duration:1e3},o),l),this}resetNorthPitch(o,l){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},o),l),this}snapToNorth(o,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,l):this}getPitch(){return this.transform.pitch}setPitch(o,l){return this.jumpTo({pitch:o},l),this}cameraForBounds(o,l){o=r.az.convert(o);let p=l&&l.bearing||0,y=l&&l.pitch||0,v=o.getNorthWest(),C=o.getSouthEast();return this._cameraForBounds(this.transform,v,C,p,y,l)}_extendPadding(o){let l={top:0,right:0,bottom:0,left:0};return o==null?r.l({},l,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:r.l({},l,o)}_extendCameraOptions(o){return(o=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,l){let p=l.max[0]-l.min[0],y=l.max[1]-l.min[1];return p/y>o.aspect?p/(2*Math.tan(.5*o.fovX)*o.aspect):y/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,l,p,y,v,C){let D=o.clone(),k=this._extendCameraOptions(C);D.bearing=y,D.pitch=v;let N=r.bO.convert(l),B=r.bO.convert(p),H=.5*(N.lat+B.lat),U=.5*(N.lng+B.lng),q=r.dC(H,U),ee=r.ab.vec3.normalize([],q),Q=r.ab.vec3.normalize([],r.ab.vec3.cross([],ee,[0,1,0])),ie=r.ab.vec3.cross([],Q,ee),re=[Q[0],Q[1],Q[2],0,ie[0],ie[1],ie[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],ue=[q,r.dC(N.lat,N.lng),r.dC(B.lat,N.lng),r.dC(B.lat,B.lng),r.dC(N.lat,B.lng),r.dC(H,N.lng),r.dC(H,B.lng),r.dC(N.lat,U),r.dC(B.lat,U)],ge=r.cd.fromPoints(ue.map(et=>[r.ab.vec3.dot(Q,et),r.ab.vec3.dot(ie,et),r.ab.vec3.dot(ee,et)])),pe=r.ab.vec3.transformMat4([],ge.center,re);r.ab.vec3.squaredLength(pe)===0&&r.ab.vec3.set(pe,0,0,1),r.ab.vec3.normalize(pe,pe),r.ab.vec3.scale(pe,pe,r.ax),D.center=r.dD(pe);let we=D.getWorldToCameraMatrix(),xe=r.ab.mat4.invert(new Float64Array(16),we);ge=r.cd.applyTransform(ge,r.ab.mat4.multiply([],we,re));let be=this._extendAABB(ge,D,k,y);if(!be)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ge=be,r.ab.vec3.transformMat4(pe,pe,we);let ve=.5*(ge.max[2]-ge.min[2]),Ie=this._minimumAABBFrustumDistance(D,ge),Re=r.ab.vec3.scale([],[0,0,1],ve),Ye=r.ab.vec3.add(Re,pe,Re),$e=Ie+(D.pitch===0?0:r.ab.vec3.distance(pe,Ye)),Ae=D.globeCenterInViewSpace,ze=r.ab.vec3.sub([],pe,[Ae[0],Ae[1],Ae[2]]);r.ab.vec3.normalize(ze,ze),r.ab.vec3.scale(ze,ze,$e);let at=r.ab.vec3.add([],pe,ze);r.ab.vec3.transformMat4(at,at,xe);let gt=r.ds/r.ax,St=r.ab.vec3.length(at),Ve=r.bH(Math.max(St*gt-r.ds,Number.EPSILON),0),dt=Math.min(D.zoomFromMercatorZAdjusted(Ve),k.maxZoom);return dt>.5*(r.c6+r.bY)?(D.setProjection({name:"mercator"}),D.zoom=dt,this._cameraForBounds(D,l,p,y,v,C)):{center:D.center,zoom:dt,bearing:y,pitch:v}}_extendAABB(o,l,p,y){let v=.5*((p.padding.left||0)+(p.padding.right||0)),C=.5*((p.padding.top||0)+(p.padding.bottom||0)),D=C,k=v,N=v,B=C,H=l.width-(k+N),U=l.height-(D+B),q=r.ab.vec3.sub([],o.max,o.min),ee=Math.min(H/q[0],U/q[1]),Q=Math.min(l.scaleZoom(l.scale*ee),p.maxZoom);if(isNaN(Q))return null;let ie=l.scale/l.zoomScale(Q),re=new r.cd([o.min[0]-k*ie,o.min[1]-B*ie,o.min[2]],[o.max[0]+N*ie,o.max[1]+D*ie,o.max[2]]),ue=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new r.P(p.offset.x,p.offset.y):r.P.convert(p.offset)).rotate(-r.ai(y));return re.center[0]-=ue.x*ie,re.center[1]+=ue.y*ie,re}queryTerrainElevation(o,l){let p=this.transform.elevation;return p?(l=r.l({},{exaggerated:!0},l),p.getAtPoint(r.aa.fromLngLat(o),null,l.exaggerated)):null}_cameraForBounds(o,l,p,y,v,C){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,l,p,y,v,C);let D=o.clone(),k=this._extendCameraOptions(C);D.bearing=y,D.pitch=v;let N=r.bO.convert(l),B=r.bO.convert(p),H=new r.bO(N.lng,B.lat),U=new r.bO(B.lng,N.lat),q=D.project(N),ee=D.project(B),Q=this.queryTerrainElevation(N),ie=this.queryTerrainElevation(B),re=this.queryTerrainElevation(H),ue=this.queryTerrainElevation(U),ge=[[q.x,q.y,Math.min(Q||0,ie||0,re||0,ue||0)],[ee.x,ee.y,Math.max(Q||0,ie||0,re||0,ue||0)]],pe=r.cd.fromPoints(ge),we=D.getWorldToCameraMatrix(),xe=r.ab.mat4.invert(new Float64Array(16),we);pe=r.cd.applyTransform(pe,we);let be=this._extendAABB(pe,D,k,y);if(!be)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=be;let ve=.5*r.ab.vec3.sub([],pe.max,pe.min)[2],Ie=this._minimumAABBFrustumDistance(D,pe),Re=[0,0,1,0];r.ab.vec4.transformMat4(Re,Re,we),r.ab.vec4.normalize(Re,Re);let Ye=r.ab.vec3.scale([],Re,Ie+ve),$e=r.ab.vec3.add([],pe.center,Ye);r.ab.vec3.transformMat4(pe.center,pe.center,xe),r.ab.vec3.transformMat4($e,$e,xe);let Ae=D.unproject(new r.P(pe.center[0],pe.center[1])),ze=r.dE(D.projection,Ae),at=Math.pow(2,ze),gt=Math.min(D._zoomFromMercatorZ($e[2]*D.pixelsPerMeter*at/D.worldSize),k.maxZoom);return D.mercatorFromTransition&&gt<.5*(r.c6+r.bY)?(D.setProjection({name:"globe"}),D.zoom=gt,this._cameraForBounds(D,l,p,y,v,C)):{center:Ae,zoom:gt,bearing:y,pitch:v}}fitBounds(o,l,p){let y=this.cameraForBounds(o,l);return this._fitInternal(y,l,p)}fitScreenCoordinates(o,l,p,y,v){let C=r.P.convert(o),D=r.P.convert(l),k=new r.P(Math.min(C.x,D.x),Math.min(C.y,D.y)),N=new r.P(Math.max(C.x,D.x),Math.max(C.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(C,D))return this;let B=this.transform.pointLocation3D(k),H=this.transform.pointLocation3D(N),U=this.transform.pointLocation3D(new r.P(k.x,N.y)),q=this.transform.pointLocation3D(new r.P(N.x,k.y)),ee=[Math.min(B.lng,H.lng,U.lng,q.lng),Math.min(B.lat,H.lat,U.lat,q.lat)],Q=[Math.max(B.lng,H.lng,U.lng,q.lng),Math.max(B.lat,H.lat,U.lat,q.lat)],ie=y&&y.pitch?y.pitch:this.getPitch(),re=this._cameraForBounds(this.transform,ee,Q,p,ie,y);return this._fitInternal(re,y,v)}_fitInternal(o,l,p){return o?(l=r.l(o,l)).linear?this.easeTo(l,p):this.flyTo(l,p):this}jumpTo(o,l){this.stop();let p=o.preloadOnly?this.transform.clone():this.transform,y=!1,v=!1,C=!1;"zoom"in o&&p.zoom!==+o.zoom&&(y=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=r.bO.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(v=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(C=!0,p.pitch=+o.pitch);let D=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!p.isPaddingEqual(D))if(o.retainPadding===!1){let k=p.clone();k.padding=D,p.setLocationAtPoint(p.center,k.centerPoint)}else p.padding=D;return o.preloadOnly?(this._preloadTiles(p),this):(this.fire(new r.z("movestart",l)).fire(new r.z("move",l)),y&&this.fire(new r.z("zoomstart",l)).fire(new r.z("zoom",l)).fire(new r.z("zoomend",l)),v&&this.fire(new r.z("rotatestart",l)).fire(new r.z("rotate",l)).fire(new r.z("rotateend",l)),C&&this.fire(new r.z("pitchstart",l)).fire(new r.z("pitch",l)).fire(new r.z("pitchend",l)),this.fire(new r.z("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Qo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,l){let p=this.transform;if(!p.projection.supportsFreeCamera)return r.w(Qo),this;this.stop();let y=p.zoom,v=p.pitch,C=p.bearing;p.setFreeCameraOptions(o);let D=y!==p.zoom,k=v!==p.pitch,N=C!==p.bearing;return this.fire(new r.z("movestart",l)).fire(new r.z("move",l)),D&&this.fire(new r.z("zoomstart",l)).fire(new r.z("zoom",l)).fire(new r.z("zoomend",l)),N&&this.fire(new r.z("rotatestart",l)).fire(new r.z("rotate",l)).fire(new r.z("rotateend",l)),k&&this.fire(new r.z("pitchstart",l)).fire(new r.z("pitch",l)).fire(new r.z("pitchend",l)),this.fire(new r.z("moveend",l)),this}easeTo(o,l){this._stop(!1,o.easeId),((o=r.l({offset:[0,0],duration:500,easing:r.dA},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);let p=this.transform,y=this.getZoom(),v=this.getBearing(),C=this.getPitch(),D=this.getPadding(),k="zoom"in o?+o.zoom:y,N="bearing"in o?this._normalizeBearing(o.bearing,v):v,B="pitch"in o?+o.pitch:C,H=this._extendPadding(o.padding),U=r.P.convert(o.offset),q,ee,Q;if(p.projection.name==="globe"){let Re=r.aa.fromLngLat(p.center),Ye=U.rotate(-p.angle);Re.x+=Ye.x/p.worldSize,Re.y+=Ye.y/p.worldSize;let $e=Re.toLngLat(),Ae=r.bO.convert(o.center||$e);this._normalizeCenter(Ae),q=p.centerPoint.add(Ye),ee=new r.P(Re.x,Re.y).mult(p.worldSize),Q=new r.P(r.at(Ae.lng),r.aA(Ae.lat)).mult(p.worldSize).sub(ee)}else{q=p.centerPoint.add(U);let Re=p.pointLocation(q),Ye=r.bO.convert(o.center||Re);this._normalizeCenter(Ye),ee=p.project(Re),Q=p.project(Ye).sub(ee)}let ie=p.zoomScale(k-y),re,ue;o.around&&(re=r.bO.convert(o.around),ue=p.locationPoint(re));let ge=this._zooming||k!==y,pe=this._rotating||v!==N,we=this._pitching||B!==C,xe=!p.isPaddingEqual(H),be=o.retainPadding===!1?p.clone():p,ve=Re=>Ye=>{if(ge&&(Re.zoom=r.af(y,k,Ye)),pe&&(Re.bearing=r.af(v,N,Ye)),we&&(Re.pitch=r.af(C,B,Ye)),xe&&(be.interpolatePadding(D,H,Ye),q=be.centerPoint.add(U)),re)Re.setLocationAtPoint(re,ue);else{let $e=Re.zoomScale(Re.zoom-y),Ae=k>y?Math.min(2,ie):Math.max(.5,ie),ze=Math.pow(Ae,1-Ye),at=Re.unproject(ee.add(Q.mult(Ye*ze)).mult($e));Re.setLocationAtPoint(Re.renderWorldCopies?at.wrap():at,q)}return o.preloadOnly||this._fireMoveEvents(l),Re};if(o.preloadOnly){let Re=this._emulate(ve,o.duration,p);return this._preloadTiles(Re),this}let Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ge,this._rotating=pe,this._pitching=we,this._padding=xe,this._easeId=o.easeId,this._prepareEase(l,o.noMoveStart,Ie),this._ease(ve(p),Re=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(l,Re)},o),this}_prepareEase(o,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||p.moving||this.fire(new r.z("movestart",o)),this._zooming&&!p.zooming&&this.fire(new r.z("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new r.z("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new r.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new r.z("move",o)),this._zooming&&this.fire(new r.z("zoom",o)),this._rotating&&this.fire(new r.z("rotate",o)),this._pitching&&this.fire(new r.z("pitch",o))}_afterEase(o,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let p=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new r.z("zoomend",o)),y&&this.fire(new r.z("rotateend",o)),v&&this.fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o))}flyTo(o,l){if(this._prefersReducedMotion(o)){let et=r.ay(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(et,l)}this.stop(),o=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.dA},o);let p=this.transform,y=this.getZoom(),v=this.getBearing(),C=this.getPitch(),D=this.getPadding(),k="zoom"in o?r.aw(+o.zoom,p.minZoom,p.maxZoom):y,N="bearing"in o?this._normalizeBearing(o.bearing,v):v,B="pitch"in o?+o.pitch:C,H=this._extendPadding(o.padding),U=p.zoomScale(k-y),q=r.P.convert(o.offset),ee=p.centerPoint.add(q),Q=p.pointLocation(ee),ie=r.bO.convert(o.center||Q);this._normalizeCenter(ie);let re=p.project(Q),ue=p.project(ie).sub(re),ge=o.curve,pe=Math.max(p.width,p.height),we=pe/U,xe=ue.mag();if("minZoom"in o){let et=r.aw(Math.min(o.minZoom,y,k),p.minZoom,p.maxZoom),Ct=pe/p.zoomScale(et-y);ge=Math.sqrt(Ct/xe*2)}let be=ge*ge;function ve(et){let Ct=(we*we-pe*pe+(et?-1:1)*be*be*xe*xe)/(2*(et?we:pe)*be*xe);return Math.log(Math.sqrt(Ct*Ct+1)-Ct)}function Ie(et){return(Math.exp(et)-Math.exp(-et))/2}function Re(et){return(Math.exp(et)+Math.exp(-et))/2}let Ye=ve(0),$e=function(et){return Re(Ye)/Re(Ye+ge*et)},Ae=function(et){return pe*((Re(Ye)*(Ie(Ct=Ye+ge*et)/Re(Ct))-Ie(Ye))/be)/xe;var Ct},ze=(ve(1)-Ye)/ge;if(Math.abs(xe)<1e-6||!isFinite(ze)){if(Math.abs(pe-we)<1e-6)return this.easeTo(o,l);let et=we<pe?-1:1;ze=Math.abs(Math.log(we/pe))/ge,Ae=function(){return 0},$e=function(Ct){return Math.exp(et*ge*Ct)}}o.duration="duration"in o?+o.duration:1e3*ze/("screenSpeed"in o?+o.screenSpeed/ge:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);let at=v!==N,gt=B!==C,St=!p.isPaddingEqual(H),Ve=o.retainPadding===!1?p.clone():p,dt=et=>Ct=>{let pt=Ct*ze,lt=1/$e(pt);et.zoom=Ct===1?k:y+et.scaleZoom(lt),at&&(et.bearing=r.af(v,N,Ct)),gt&&(et.pitch=r.af(C,B,Ct)),St&&(Ve.interpolatePadding(D,H,Ct),ee=Ve.centerPoint.add(q));let Nt=Ct===1?ie:et.unproject(re.add(ue.mult(Ae(pt))).mult(lt));return et.setLocationAtPoint(et.renderWorldCopies?Nt.wrap():Nt,ee),et._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(l),et};if(o.preloadOnly){let et=this._emulate(dt,o.duration,p);return this._preloadTiles(et),this}return this._zooming=!0,this._rotating=at,this._pitching=gt,this._padding=St,this._prepareEase(l,!1),this._ease(dt(p),()=>this._afterEase(l),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!o){let p=this.handlers;p&&p.stop(!1)}return this}_ease(o,l,p){p.animate===!1||p.duration===0?(o(1),l()):(this._easeStart=r.q.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let o=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,l){o=r.bF(o,-180,180);let p=Math.abs(o-l);return Math.abs(o-360-l)<p&&(o-=360),Math.abs(o+360-l)<p&&(o+=360),o}_normalizeCenter(o){let l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;let p=o.lng-l.center.lng;o.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,l,p){let y=Math.ceil(15*l/1e3),v=[],C=o(p.clone());for(let D=0;D<=y;D++){let k=C(D/y);v.push(k.clone())}return v}_preloadTiles(o,l){}}class B_{constructor(o={}){this.options=o,r.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){let l=this.options&&this.options.compact,p=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=ae("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ae("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);let y=ae("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",p),this._innerContainer=ae("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));let l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(o){let p=l.reduce((y,v,C)=>(v.value&&(y+=`${v.key}=${v.value}${C<l.length-1?"&":""}`),y),"?");o.href=`${r.e.FEEDBACK_URL}/${p}#${Cm(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){let y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}let l=this._map.style._mergedSourceCaches;for(let y in l){let v=l[y];if(v.used){let C=v.getSource();C.attribution&&o.indexOf(C.attribution)<0&&o.push(C.attribution)}}o.sort((y,v)=>y.length-v.length),o=o.filter((y,v)=>{for(let C=v+1;C<o.length;C++)if(o[C].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));let p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xv{constructor(){r.aP(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=ae("div","mapboxgl-ctrl");let l=ae("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(let l in o){let p=o[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){let o=this._container.children;if(o.length){let l=o[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class ah{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){let l=++this._id;return this._queue.push({callback:o,id:l,cancelled:!1}),l}remove(o){let l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(let y of p)if(y.id===o)return void(y.cancelled=!0)}run(o=0){let l=this._currentlyRunning=this._queue;this._queue=[];for(let p of l)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class V_{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;let l=r.cB((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,l,p){this._start=this.getValue(l),this._end=o,this._startTime=l,this._endTime=l+p}}let Ba={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Va=["mouseenter","mouseover","mouseleave","mouseout"];class lh extends r.z{constructor(o,l,p,y){let{point:v,lngLat:C,originalEvent:D,target:k}=o;super(o.type,{point:v,lngLat:C,originalEvent:D,target:k}),this.preventDefault=()=>{o.preventDefault()},this.id=l,this.interaction=p,this.feature=y}}class ch{constructor(o){this.map=o,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.delegatedHandlers=new Map,this.handleType=this.handleType.bind(this)}add(o,l){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);let{type:p,filter:y}=l;y&&this.filters.set(o,r.aZ(y));let v=this.interactionsByType.get(p)||new Map;if(v.size===0){if(Va.includes(p)){let{mousemove:C,mouseout:D}=this._createDelegatedHandlers(o,l);this.map.on("mousemove",C),this.map.on("mouseout",D),this.delegatedHandlers.set(o,{mousemove:C,mouseout:D})}else this.map.on(p,this.handleType);this.interactionsByType.set(p,v)}v.set(o,l),this.typeById.set(o,p)}get(o){let l=this.typeById.get(o);if(!l)return;let p=this.interactionsByType.get(l);return p?p.get(o):void 0}remove(o){let l=this.typeById.get(o);if(!l)return;this.typeById.delete(o),this.filters.delete(o);let p=this.interactionsByType.get(l);if(p){if(p.delete(o),this.delegatedHandlers.has(o)){let{mousemove:y,mouseout:v}=this.delegatedHandlers.get(o);this.map.off("mousemove",y),this.map.off("mouseout",v),this.delegatedHandlers.delete(o)}p.size===0&&this.map.off(l,this.handleType)}}queryTargets(o,l){let p=[];for(let[y,v]of l)v.target&&p.push({targetId:y,target:v.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(o,p,this.map.transform)}handleType(o,l){let p=this.interactionsByType.get(o.type),y=Array.from(p).reverse();l=l||this.queryTargets(o.point,y);let v=!1;for(let C of l){for(let[D,k]of y){if(!k.target)continue;let N=C.variants?C.variants[D]:null;if(N){for(let B of N){let H=new r.cw(C,B);if(k.handler(new lh(o,D,k,H))!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(let[C,D]of y){let{handler:k,target:N}=D;if(!N&&k(new lh(o,C,D,null))!==!1)break}}_createDelegatedHandlers(o,l){switch(l.type){case"mouseenter":case"mouseover":{let p=!1,y=new Set;return{mousemove:v=>{let C=this.queryTargets(v.point,[[o,l]]),D=new Set;if(!C.length)return p=!1,void y.clear();let k=[];for(let N of C)y.has(N.id)||(D.add(N.id),k.push(N));p&&!k.length||(p=!0,y=D,v.type=l.type,this.handleType(v,k))},mouseout:()=>{p=!1,y.clear()}}}case"mouseleave":case"mouseout":{let p=[];return{mousemove:y=>{let v=this.queryTargets(y.point,[[o,l]]);if(!v.length)return y.type=l.type,this.handleType(y,p),void(p=v);let C=[],D=new Set(v.map(k=>k.id));for(let k of p)D.has(k.id)||C.push(k);C.length&&(y.type=l.type,this.handleType(y,C)),p=v},mouseout:y=>{p.length&&(y.type=l.type,this.handleType(y,p),p=[])}}}}}}function gd(f,o){if(Array.isArray(f)&&Array.isArray(o)){let l=new Set(f),p=new Set(o);return l.size===p.size&&f.every(y=>p.has(y))}return r.bn(f,o)}let j_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},bi={showCompass:!0,showZoom:!0,visualizePitch:!1};class pu{constructor(o,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new F_({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,p&&(this.mousePitch=new Mm({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),r.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(o,l){this.mouseRotate.mousedown(o,l),this.mousePitch&&this.mousePitch.mousedown(o,l),st()}move(o,l){let p=this.map,y=this.mouseRotate.mousemoveWindow(o,l),v=y&&y.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){let C=this.mousePitch.mousemoveWindow(o,l),D=C&&C.pitchDelta;D&&p.setPitch(p.getPitch()+D)}}off(){let o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ut(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(r.l({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),yt(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,yt(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=rn(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=rn(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Kv(f,o,l){if(f=new r.bO(f.lng,f.lat),o){let p=new r.bO(f.lng-360,f.lat),y=new r.bO(f.lng+360,f.lat),v=360*Math.ceil(Math.abs(f.lng-l.center.lng)/360),C=l.locationPoint(f).distSqr(o),D=o.x<0||o.y<0||o.x>l.width||o.y>l.height;l.locationPoint(p).distSqr(o)<C&&(D||Math.abs(p.lng-l.center.lng)<v)?f=p:l.locationPoint(y).distSqr(o)<C&&(D||Math.abs(y.lng-l.center.lng)<v)&&(f=y)}for(;Math.abs(f.lng-l.center.lng)>180;){let p=l.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;f.lng>l.center.lng?f.lng-=360:f.lng+=360}return f}let U_={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Gf extends r.E{constructor(o,l){if(super(),(o instanceof HTMLElement||l)&&(o=r.l({element:o},l)),r.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=r.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=ae("div");let v=41,C=27,D=Ze("svg",{display:"block",height:v*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${v}`},this._element),k=Ze("radialGradient",{id:"shadowGradient"},Ze("defs",{},D));Ze("stop",{offset:"10%","stop-opacity":.4},k),Ze("stop",{offset:"100%","stop-opacity":.05},k),Ze("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),Ze("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),Ze("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),Ze("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=r.P.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});let p=this._element.classList;for(let v in U_)p.remove(`mapboxgl-marker-anchor-${v}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);let y=o&&o.className?o.className.trim().split(/\s+/):[];p.add(...y),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){let o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=r.bO.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){let y=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){let l=o.code,p=o.charCode||o.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(o){let l=o.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let o=this._map,l=this._pos;if(!o||!l)return!1;let p=o.unproject(l),y=o.getFreeCameraOptions();if(!y.position)return!1;let v=y.position.toLngLat();return v.distanceTo(p)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){let o=this._map;if(!o)return;let l=this._pos;if(!l||l.x<0||l.x>o.transform.width||l.y<0||l.y>o.transform.height)return void this._clearFadeTimer();let p=o.unproject(l),y;o._showingGlobe()&&r.dH(o.transform,this._lngLat)?y=0:(y=1-o._queryFogOpacity(p),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let o=this._pos;if(!o||!this._map)return;let l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${U_[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){let o=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!o||p!=="map")return"";if(!l._showingGlobe()){let k=l.getPitch();return k?`rotateX(${k}deg)`:""}let y=r.c4(r.dI(l.transform,this._lngLat)),v=o.sub(r.dJ(l.transform)),C=Math.abs(v.x)+Math.abs(v.y);if(C===0)return"";let D=y/C;return`rotateX(${-v.y*D}deg) rotateY(${v.x*D}deg)`}_calculateZTransform(){let o=this._pos,l=this._map;if(!l||!o)return"";let p=0,y=this.getRotationAlignment();if(y==="map")if(l._showingGlobe()){let v=l.project(new r.bO(this._lngLat.lng,this._lngLat.lat+.001)),C=l.project(new r.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);p=r.c4(Math.atan2(C.y,C.x))-90}else p=-l.getBearing();else if(y==="horizon"){let v=r.ac(4,6,l.getZoom()),C=r.dJ(l.transform);C.y+=v*l.transform.height;let D=o.sub(C),k=r.c4(Math.atan2(D.y,D.x));p=(k>90?k-270:k+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);let l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Kv(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=r.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){let l=this._map;if(!l)return;let p=this._pointerdownPos,y=this._positionDelta;if(p&&y){if(!this._isDragging){let v=this._clickTolerance||l._clickTolerance;if(o.point.dist(p)<v)return;this._isDragging=!0}this._pos=o.point.sub(y),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(o){let l=this._map,p=this._pos;l&&p&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(p),this._pointerdownPos=o.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;let l=this._map;return l&&(o?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let mu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},wc={maxWidth:100,unit:"metric"},ms={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Xs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Bo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function H_(f=new r.P(0,0),o="bottom"){if(typeof f=="number"){let l=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(o){case"top":return new r.P(0,f);case"top-left":return new r.P(l,l);case"top-right":return new r.P(-l,l);case"bottom":return new r.P(0,-f);case"bottom-left":return new r.P(l,-l);case"bottom-right":return new r.P(-l,-l);case"left":return new r.P(f,0);case"right":return new r.P(-f,0)}return new r.P(0,0)}return f instanceof r.P||Array.isArray(f)?r.P.convert(f):r.P.convert(f[o]||[0,0])}return{version:w,supported:le.supported,setRTLTextPlugin:r.dK,getRTLTextPluginStatus:r.dL,Map:class extends z_{constructor(f){F.mark(A.create);let o=f;if((f=r.l({},j_,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&r.dF(window)&&(f.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new dc(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new ah,this._domRenderTaskQueue=new ah,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aV(),this._locale=r.l({},Ba,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new V_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new ln(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?cn({},f.contextCreateOptions):{},typeof f.container=="string"){let l=document.getElementById(f.container);if(!l)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=l}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,r.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new S_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Yv(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||r.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new Yu(this),f.hash&&(this._hash=new wm(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});let l=f.bounds;l&&(this.resize(),this.fitBounds(l,r.l({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new B_({customAttribution:f.customAttribution})),this._logoControl=new Xv,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new r.z(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new r.z(`${l.dataType}dataloading`,l))}),this._interactions=new ch(this)}_getMapId(){return this._mapId}addControl(f,o){if(o===void 0&&(o=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let l=f.onAdd(this);this._controls.push(f);let p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let o=this._controls.indexOf(f);return o>-1&&this._controls.splice(o,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let o=!this._moving;return o&&this.fire(new r.z("movestart",f)).fire(new r.z("move",f)),this.fire(new r.z("resize",f)),o&&this.fire(new r.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(r.az.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(o=>o==="auto"?navigator.language:o):f}setLanguage(f){let o=this._parseLanguage(f);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(let l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let f=this.transform,o=f.projection.name,l;o==="globe"&&f.zoom>=r.bY?(f.setMercatorFromTransition(),l=!0):o==="mercator"&&f.zoom<r.bY&&(f.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,o){return this._updateProjection(f||o||{name:"mercator"})}_updateProjection(f){let o;return o=f.name==="globe"&&this.transform.zoom>=r.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(r.bO.convert(f))}unproject(f){return this.transform.pointLocation3D(r.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,o,l){let p=y=>{let v=[];if(Array.isArray(o)){let C=o.filter(D=>this.getLayer(D));v=C.length?this.queryRenderedFeatures(y,{layers:C}):[]}else v=this.queryRenderedFeatures(y,{target:o});return v};if(f==="mouseenter"||f==="mouseover"){let y=!1;return{listener:l,targets:o,delegates:{mousemove:C=>{let D=p(C.point);D.length?y||(y=!0,l.call(this,new Ys(f,this,C.originalEvent,{features:D}))):y=!1},mouseout:()=>{y=!1}}}}if(f==="mouseleave"||f==="mouseout"){let y=!1;return{listener:l,targets:o,delegates:{mousemove:D=>{p(D.point).length?y=!0:y&&(y=!1,l.call(this,new Ys(f,this,D.originalEvent)))},mouseout:D=>{y&&(y=!1,l.call(this,new Ys(f,this,D.originalEvent)))}}}}{let y=v=>{let C=p(v.point);C.length&&(v.features=C,l.call(this,v),delete v.features)};return{listener:l,targets:o,delegates:{[f]:y}}}}on(f,o,l){if(typeof o=="function"||l===void 0)return super.on(f,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let p=this._createDelegatedListener(f,o,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(let y in p.delegates)this.on(y,p.delegates[y]);return this}once(f,o,l){if(typeof o=="function"||l===void 0)return super.once(f,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let p=this._createDelegatedListener(f,o,l);for(let y in p.delegates)this.once(y,p.delegates[y]);return this}off(f,o,l){if(typeof o=="function"||l===void 0)return super.off(f,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;let p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(y=>{for(let v=0;v<y.length;v++){let C=y[v];if(C.listener===l&&gd(C.targets,o)){for(let D in C.delegates)this.off(D,C.delegates[D]);return y.splice(v,1),this}}})(p),this}queryRenderedFeatures(f,o){if(!this.style)return[];if(f===void 0||f instanceof r.P||Array.isArray(f)||o!==void 0||(o=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!o){let v=this.style.queryRenderedFeatures(f,void 0,this.transform),C=this.style.queryRenderedFeatureset(f,void 0,this.transform);return v.concat(C)}let l=!0;if(o.target&&(l=this._isTargetValid(o.target),l&&!o.layers))return this.style.queryRenderedFeatureset(f,o,this.transform);let p=!0;if(o.layers&&Array.isArray(o.layers)){for(let v of o.layers)if(!this._isValidId(v)){p=!1;break}if(p&&!o.target)return this.style.queryRenderedFeatures(f,o,this.transform)}let y=[];return p&&(y=y.concat(this.style.queryRenderedFeatures(f,o,this.transform))),l&&(y=y.concat(this.style.queryRenderedFeatureset(f,o,this.transform))),y}querySourceFeatures(f,o){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,o)}isPointOnSurface(f){let{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&r.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(f))}addInteraction(f,o){return this._interactions.add(f,o),this}removeInteraction(f){return this._interactions.remove(f),this}setStyle(f,o){return o=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&f&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(f,(l,p)=>{l?(r.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(f,o)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(f,o))}_getUIString(f){let o=this._locale[f];if(o==null)throw new Error(`Missing UI string '${f}'`);return o}_updateStyle(f,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){let l=r.l({},o);o&&o.config&&(l.initialConfig=o.config,delete l.config),this.style=new Gs(this,l).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.cr(f)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(let o of f)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(f)}addSource(f,o){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,o),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,o,l){this._lazyInitEmptyStyle(),this.style.addSourceType(f,o,l)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,o,{pixelRatio:l=1,sdf:p=!1,stretchX:y,stretchY:v,content:C}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){let{width:D,height:k,data:N}=r.q.getImageData(o);this.style.addImage(f,{data:new r.r({width:D,height:k},N),pixelRatio:l,stretchX:y,stretchY:v,content:C,sdf:p,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:D,height:k}=o,N=o;this.style.addImage(f,{data:new r.r({width:D,height:k},new Uint8Array(N.data)),pixelRatio:l,stretchX:y,stretchY:v,content:C,sdf:p,usvg:!1,version:0,userImage:N}),N.onAdd&&N.onAdd(this,f)}}updateImage(f,o){this._lazyInitEmptyStyle();let l=this.style.getImage(f);if(!l)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let p=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?r.q.getImageData(o):o,{width:y,height:v,data:C}=p;if(y===void 0||v===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(l.usvg?l.icon.usvg_tree.width:l.data.width)||v!==(l.usvg?l.icon.usvg_tree.height:l.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${y}, ${v})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`)));let D=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap),k=!1;l.usvg?(l.data=new r.r({width:y,height:v},new Uint8Array(C)),l.usvg=!1,l.icon=void 0,k=!0):l.data.replace(C,D),this.style.updateImage(f,l,k)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,o){r.o(this._requestManager.transformRequest(f,r.R.Image),(l,p)=>{o(l,p instanceof HTMLImageElement?r.q.getImageData(p):p)})}listImages(){return this.style.listImages()}addModel(f,o){this._lazyInitEmptyStyle(),this.style.addModel(f,o)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,o){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,o),this._update(!0)):this}getSlot(f){let o=this.getLayer(f);return o&&o.slot||null}setSlot(f,o){return this.style.setSlot(f,o),this.style.mergeLayers(),this._update(!0)}addImport(f,o){return this.style.addImport(f,o),this}updateImport(f,o){return typeof o!="string"&&o.id!==f?(this.removeImport(f),this.addImport(o)):(this.style.updateImport(f,o),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,o){return this.style.moveImport(f,o),this._update(!0)}moveLayer(f,o){return this._isValidId(f)?(this.style.moveLayer(f,o),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;let o=this.style.getOwnLayer(f);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,o,l){return this._isValidId(f)?(this.style.setLayerZoomRange(f,o,l),this._update(!0)):this}setFilter(f,o,l={}){return this._isValidId(f)?(this.style.setFilter(f,o,l),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,o,l,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,o,l,p),this._update(!0)):this}getPaintProperty(f,o){return this._isValidId(f)?this.style.getPaintProperty(f,o):null}setLayoutProperty(f,o,l,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,o,l,p),this._update(!0)):this}getLayoutProperty(f,o){return this._isValidId(f)?this.style.getLayoutProperty(f,o):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,o){return this.style.setSchema(f,o),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,o){return this.style.setConfig(f,o),this._update(!0)}getConfigProperty(f,o){return this.style.getConfigProperty(f,o)}setConfigProperty(f,o,l){return this.style.setConfigProperty(f,o,l),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){let o=f[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,o),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bO.convert(f),this.transform):0}setFeatureState(f,o){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,o),this._update())}removeFeatureState(f,o){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,o),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;let f=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300,l,p,y,v=this._container;for(;v&&(!p||!y);){let C=window.getComputedStyle(v).transform;C&&C!=="none"&&(l=C.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(y=l[3])),v=v.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=y?Math.abs(o/y):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=ae("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();let o=this._canvasContainer=ae("div","mapboxgl-canvas-container",f);this._canvas=ae("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let l=this._controlContainer=ae("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{p[y]=ae("div",`mapboxgl-ctrl-${y}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,o){let l=r.q.devicePixelRatio||1;this._canvas.width=l*Math.ceil(f),this._canvas.height=l*Math.ceil(o),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${o}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){let o=this._markers.indexOf(f);o!==-1&&this._markers.splice(o,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){let o=this._popups.indexOf(f);o!==-1&&this._popups.splice(o,1)}_setupPainter(){let f=r.l({},le.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",f);o?(Zn(o,!0),this.painter=new R_(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(o)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let o;this.fire(new r.z("renderstart")),++this._frameId;let l=this.painter.context.extTimerQuery,p=r.q.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=y.createQuery(),y.beginQuery(l.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let N=this.transform.zoom,B=this.transform.pitch,H=r.q.now(),U=new r.a8(N,{now:H,fadeDuration:v,pitch:B,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(p),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(p);let D=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),D&&(this._placementDirty=D.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,F.mark(A.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){let N=r.q.now()-p;y.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{let B=y.getQueryParameter(o,y.QUERY_RESULT)/1e6;y.deleteQuery(o),this.fire(new r.z("gpu-timing-frame",{cpuTime:N,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){let N=this.painter.collectGpuTimers();setTimeout(()=>{let B=this.painter.queryGpuTimers(N);this.fire(new r.z("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){let N=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let B=this.painter.queryGpuTimeDeferredRender(N);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:B}))},50)}let k=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(k||this._repaint)this.triggerRepaint();else{let N=this.idle();if(N&&(C=this._updateAverageElevation(p,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let B=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,F.mark(A.fullLoad),this._performanceMetricsCollection&&mr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(let o of this._markers)f&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(let o of this._popups)!f||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(f,o=!1){let l=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);let p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(o||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){let y=this.transform.averageElevation,v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;let C=Math.abs(y-v);if(C>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(v),l(v);this._averageElevation.easeTo(v,f,300)}else if(C>1e-4)return this._averageElevation.jumpTo(v),l(v)}return!!this._averageElevation.isEasing(f)&&l(this._averageElevation.getValue(f))}_authenticate(){Ee(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===er||f.status===401)){let o=this.painter.context.gl;Zn(o,!1),this._logoControl instanceof Xv&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&_n(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){let f=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());let l=this.painter.context.gl,p=l.createFramebuffer();function y(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);let C=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,C),C}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(y(f),o.canvasCopies.map(y),o.timeStamps)}_canvasPixelComparison(f,o,l){let p=l[1]-l[0],y=f.length/4;for(let v=0;v<o.length;v++){let C=o[v],D=0;for(let k=0;k<C.length;k+=4)C[k]===f[k]&&C[k+1]===f[k+1]&&C[k+2]===f[k+2]&&C[k+3]===f[k+3]&&(D+=1);p+=(l[v+2]-l[v+1])*(1-D/y)}return p}remove(){this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),on.delete(this.painter.context.gl),gr.remove(),Ft.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=r.q.frame(o=>{let l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(o)}))}_preloadTiles(f){let o=this.style?this.style.getSourceCaches():[];return r.bl(o,(l,p)=>l._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,o){r.dG(f,o)}get version(){return w}},NavigationControl:class{constructor(f={}){this.options=r.l({},bi,f),this._container=ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(r.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),ae("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),ae("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{let l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:o}):l.resetNorth({},{originalEvent:o}))}),this._compassIcon=ae("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let f=this._map;if(!f)return;let o=f.getZoom(),l=o===f.getMaxZoom(),p=o===f.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){let f=this._map;if(!f)return;let o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pu(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){let f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,o){let l=ae("button",f,this._container);return l.type="button",l.addEventListener("click",o),l}_setButtonTitle(f,o){if(!this._map)return;let l=this._map._getUIString(`NavigationControl.${o}`);f.setAttribute("aria-label",l),f.firstElementChild&&f.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends r.E{constructor(f={}){super();let o=navigator.geolocation;this.options=r.l({geolocation:o},mu,f),r.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=bm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){let o=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,f(l)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>o(l.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(f){let o=this._map.getMaxBounds(),l=f.coords;return!!o&&(l.longitude<o.getWest()||l.longitude>o.getEast()||l.latitude<o.getSouth()||l.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",f)),this._finish()}}_updateCamera(f){let o=new r.bO(f.coords.longitude,f.coords.latitude),l=f.coords.accuracy,p=this._map.getBearing(),y=r.l({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(l),y,{geolocateSource:!0})}_updateMarker(f){if(f){let o=new r.bO(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let f=this._map.transform,o=r.bH(1,f._center.lat)*f.worldSize,l=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=ae("button","mapboxgl-ctrl-geolocate",this._container),ae("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ae("div","mapboxgl-user-location"),this._dotElement.appendChild(ae("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ae("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Gf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ae("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:B_,ScaleControl:class{constructor(f={}){this.options=r.l({},wc,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let f=this.options.maxWidth||100,o=this._map,l=o._containerHeight/2,p=o._containerWidth/2-f/2,y=o.unproject([p,l]),v=o.unproject([p+f,l]),C=y.distanceTo(v);if(this.options.unit==="imperial"){let D=3.2808*C;D>5280?this._setScale(f,D/5280,"mile"):this._setScale(f,D,"foot")}else this.options.unit==="nautical"?this._setScale(f,C/1852,"nautical-mile"):C>=1e3?this._setScale(f,C/1e3,"kilometer"):this._setScale(f,C,"meter")}_setScale(f,o,l){this._map._requestDomTask(()=>{let p=function(v){let C=Math.pow(10,`${Math.floor(v)}`.length-1),D=v/C;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(k){let N=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*N)/N}(D),C*D}(o),y=p/o;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${ms[l]}`,this._container.style.width=f*y+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=ae("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:r.w("Full screen control 'container' must be a DOM element.")),r.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let f=this._fullscreenButton=ae("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ae("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(f){super(),this.options=r.l(Object.create(Xs),f),r.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=r.bO.convert(f),this._pos=null,this._trackPointer=!1,this._update();let o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let o=document.createDocumentFragment(),l=document.createElement("body"),p;for(l.innerHTML=f;p=l.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=ae("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(f),this.options.closeButton){let l=this._closeButton=ae("button","mapboxgl-popup-close-button",o);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let o;return this._classList.delete(f)?o=!1:(this._classList.add(f),o=!0),this._updateClassList(),o}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;let o=this._map,l=this._container,p=this._pos;if(!o||!l||!p)return"bottom";let y=l.offsetWidth,v=l.offsetHeight,C=p.x<y/2,D=p.x>o.transform.width-y/2;if(p.y+f<v)return C?"top-left":D?"top-right":"top";if(p.y>o.transform.height-v){if(C)return"bottom-left";if(D)return"bottom-right"}return C?"left":D?"right":"bottom"}_updateClassList(){let f=this._container;if(!f)return;let o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),f.className=o.join(" ")}_update(f){let o=this._map,l=this._content;if(!o||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=ae("div","mapboxgl-popup",o.getContainer()),this._tip=ae("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Kv(this._lngLat,this._pos,o.transform)),!this._trackPointer||f){let y=this._pos=this._trackPointer&&f instanceof r.P?f:o.project(this._lngLat),v=H_(this.options.offset),C=this._anchor=this._getAnchor(v.y),D=H_(this.options.offset,C),k=y.add(D).round();o._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${U_[C]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&o._showingGlobe()){let y=r.dH(o.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(Bo);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Gf,Style:Gs,LngLat:r.bO,LngLatBounds:r.az,Point:r.P,MercatorCoordinate:r.aa,FreeCameraOptions:iu,Evented:r.E,config:r.e,prewarm:r.dM,clearPrewarmedResources:r.dN,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(f){r.e.ACCESS_TOKEN=f},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(f){r.e.API_URL=f},get workerCount(){return r.dO.workerCount},set workerCount(f){r.dO.workerCount=f},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){r.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){r.dP(f)},get workerUrl(){return r.dQ.workerUrl},set workerUrl(f){r.dQ.workerUrl=f},get workerClass(){return r.dQ.workerClass},set workerClass(f){r.dQ.workerClass=f},get workerParams(){return r.dQ.workerParams},set workerParams(f){r.dQ.workerParams=f},get dracoUrl(){return r.dR()},set dracoUrl(f){r.dS(f)},get meshoptUrl(){return r.dT()},set meshoptUrl(f){r.dU(f)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var h=n;return h})});var sj=Ui((OP,AP)=>{"use strict";(function(e,t){typeof OP=="object"&&typeof AP<"u"?AP.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis<"u"?globalThis:e||self).dayjs_plugin_relativeTime=t()})(OP,function(){"use strict";return function(e,t,n){e=e||{};var s=t.prototype,h={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function r(A,F,$,K){return s.fromToBase(A,F,$,K)}n.en.relativeTime=h,s.fromToBase=function(A,F,$,K,se){for(var le,ae,Ze,Ue=$.$locale().relativeTime||h,ft=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],Xe=ft.length,st=0;st<Xe;st+=1){var Ut=ft[st];Ut.d&&(le=K?n(A).diff($,Ut.d,!0):$.diff(A,Ut.d,!0));var Bt=(e.rounding||Math.round)(Math.abs(le));if(Ze=le>0,Bt<=Ut.r||!Ut.r){Bt<=1&&st>0&&(Ut=ft[st-1]);var xt=Ue[Ut.l];se&&(Bt=se(""+Bt)),ae=typeof xt=="string"?xt.replace("%d",Bt):xt(Bt,F,Ut.l,Ze);break}}if(F)return ae;var yt=Ze?Ue.future:Ue.past;return typeof yt=="function"?yt(ae):yt.replace("%s",ae)},s.to=function(A,F){return r(A,F,this,!0)},s.from=function(A,F){return r(A,F,this)};var w=function(A){return A.$u?n.utc():n()};s.toNow=function(A){return this.to(w(this),A)},s.fromNow=function(A){return this.from(w(this),A)}}})});var aj=Ui((RP,kP)=>{"use strict";(function(e,t){typeof RP=="object"&&typeof kP<"u"?kP.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis<"u"?globalThis:e||self).dayjs_plugin_utc=t()})(RP,function(){"use strict";var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(s,h,r){var w=h.prototype;r.utc=function(ae){var Ze={date:ae,utc:!0,args:arguments};return new h(Ze)},w.utc=function(ae){var Ze=r(this.toDate(),{locale:this.$L,utc:!0});return ae?Ze.add(this.utcOffset(),e):Ze},w.local=function(){return r(this.toDate(),{locale:this.$L,utc:!1})};var A=w.parse;w.parse=function(ae){ae.utc&&(this.$u=!0),this.$utils().u(ae.$offset)||(this.$offset=ae.$offset),A.call(this,ae)};var F=w.init;w.init=function(){if(this.$u){var ae=this.$d;this.$y=ae.getUTCFullYear(),this.$M=ae.getUTCMonth(),this.$D=ae.getUTCDate(),this.$W=ae.getUTCDay(),this.$H=ae.getUTCHours(),this.$m=ae.getUTCMinutes(),this.$s=ae.getUTCSeconds(),this.$ms=ae.getUTCMilliseconds()}else F.call(this)};var $=w.utcOffset;w.utcOffset=function(ae,Ze){var Ue=this.$utils().u;if(Ue(ae))return this.$u?0:Ue(this.$offset)?$.call(this):this.$offset;if(typeof ae=="string"&&(ae=function(Ut){Ut===void 0&&(Ut="");var Bt=Ut.match(t);if(!Bt)return null;var xt=(""+Bt[0]).match(n)||["-",0,0],yt=xt[0],rn=60*+xt[1]+ +xt[2];return rn===0?0:yt==="+"?rn:-rn}(ae),ae===null))return this;var ft=Math.abs(ae)<=16?60*ae:ae,Xe=this;if(Ze)return Xe.$offset=ft,Xe.$u=ae===0,Xe;if(ae!==0){var st=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(Xe=this.local().add(ft+st,e)).$offset=ft,Xe.$x.$localOffset=st}else Xe=this.utc();return Xe};var K=w.format;w.format=function(ae){var Ze=ae||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return K.call(this,Ze)},w.valueOf=function(){var ae=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*ae},w.isUTC=function(){return!!this.$u},w.toISOString=function(){return this.toDate().toISOString()},w.toString=function(){return this.toDate().toUTCString()};var se=w.toDate;w.toDate=function(ae){return ae==="s"&&this.$offset?r(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():se.call(this)};var le=w.diff;w.diff=function(ae,Ze,Ue){if(ae&&this.$u===ae.$u)return le.call(this,ae,Ze,Ue);var ft=this.local(),Xe=r(ae).local();return le.call(ft,Xe,Ze,Ue)}}})});function hT(e,t){return Object.is(e,t)}var is=null,Ty=!1,dT=1,_l=Symbol("SIGNAL");function ir(e){let t=is;return is=e,t}function dR(){return is}function m9(){return Ty}var ep={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function qx(e){if(Ty)throw new Error("");if(is===null)return;is.consumerOnSignalRead(e);let t=is.nextProducerIndex++;if(Wx(is),t<is.producerNode.length&&is.producerNode[t]!==e&&Ey(is)){let n=is.producerNode[t];Zx(n,is.producerIndexOfThis[t])}is.producerNode[t]!==e&&(is.producerNode[t]=e,is.producerIndexOfThis[t]=Ey(is)?gR(e,is,t):0),is.producerLastReadVersion[t]=e.version}function g9(){dT++}function fT(e){if(!(Ey(e)&&!e.dirty)&&!(!e.dirty&&e.lastCleanEpoch===dT)){if(!e.producerMustRecompute(e)&&!Iy(e)){cT(e);return}e.producerRecomputeValue(e),cT(e)}}function fR(e){if(e.liveConsumerNode===void 0)return;let t=Ty;Ty=!0;try{for(let n of e.liveConsumerNode)n.dirty||mR(n)}finally{Ty=t}}function pR(){return is?.consumerAllowSignalWrites!==!1}function mR(e){e.dirty=!0,fR(e),e.consumerMarkedDirty?.(e)}function cT(e){e.dirty=!1,e.lastCleanEpoch=dT}function Xm(e){return e&&(e.nextProducerIndex=0),ir(e)}function Sy(e,t){if(ir(t),!(!e||e.producerNode===void 0||e.producerIndexOfThis===void 0||e.producerLastReadVersion===void 0)){if(Ey(e))for(let n=e.nextProducerIndex;n<e.producerNode.length;n++)Zx(e.producerNode[n],e.producerIndexOfThis[n]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Iy(e){Wx(e);for(let t=0;t<e.producerNode.length;t++){let n=e.producerNode[t],s=e.producerLastReadVersion[t];if(s!==n.version||(fT(n),s!==n.version))return!0}return!1}function Km(e){if(Wx(e),Ey(e))for(let t=0;t<e.producerNode.length;t++)Zx(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function gR(e,t,n){if(_R(e),e.liveConsumerNode.length===0&&yR(e))for(let s=0;s<e.producerNode.length;s++)e.producerIndexOfThis[s]=gR(e.producerNode[s],e,s);return e.liveConsumerIndexOfThis.push(n),e.liveConsumerNode.push(t)-1}function Zx(e,t){if(_R(e),e.liveConsumerNode.length===1&&yR(e))for(let s=0;s<e.producerNode.length;s++)Zx(e.producerNode[s],e.producerIndexOfThis[s]);let n=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[n],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[n],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){let s=e.liveConsumerIndexOfThis[t],h=e.liveConsumerNode[t];Wx(h),h.producerIndexOfThis[s]=t}}function Ey(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function Wx(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}function _R(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}function yR(e){return e.producerNode!==void 0}function vR(e){let t=Object.create(_9);t.computation=e;let n=()=>{if(fT(t),qx(t),t.value===Gx)throw t.error;return t.value};return n[_l]=t,n}var aT=Symbol("UNSET"),lT=Symbol("COMPUTING"),Gx=Symbol("ERRORED"),_9=lr(cn({},ep),{value:aT,dirty:!0,error:null,equal:hT,producerMustRecompute(e){return e.value===aT||e.value===lT},producerRecomputeValue(e){if(e.value===lT)throw new Error("Detected cycle in computations.");let t=e.value;e.value=lT;let n=Xm(e),s;try{s=e.computation()}catch(h){s=Gx,e.error=h}finally{Sy(e,n)}if(t!==aT&&t!==Gx&&s!==Gx&&e.equal(t,s)){e.value=t;return}e.value=s,e.version++}});function y9(){throw new Error}var xR=y9;function bR(){xR()}function wR(e){xR=e}var v9=null;function CR(e){let t=Object.create(pT);t.value=e;let n=()=>(qx(t),t.value);return n[_l]=t,n}function Yx(e,t){pR()||bR(),e.equal(e.value,t)||(e.value=t,x9(e))}function MR(e,t){pR()||bR(),Yx(e,t(e.value))}var pT=lr(cn({},ep),{equal:hT,value:void 0});function x9(e){e.version++,g9(),fR(e),v9?.()}function TR(e,t,n){let s=Object.create(b9);n&&(s.consumerAllowSignalWrites=!0),s.fn=e,s.schedule=t;let h=F=>{s.cleanupFn=F};function r(F){return F.fn===null&&F.schedule===null}function w(F){r(F)||(Km(F),F.cleanupFn(),F.fn=null,F.schedule=null,F.cleanupFn=uT)}let A=()=>{if(s.fn===null)return;if(m9())throw new Error("Schedulers cannot synchronously execute watches while scheduling.");if(s.dirty=!1,s.hasRun&&!Iy(s))return;s.hasRun=!0;let F=Xm(s);try{s.cleanupFn(),s.cleanupFn=uT,s.fn(h)}finally{Sy(s,F)}};return s.ref={notify:()=>mR(s),run:A,cleanup:()=>s.cleanupFn(),destroy:()=>w(s),[_l]:s},s.ref}var uT=()=>{},b9=lr(cn({},ep),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule!==null&&e.schedule(e.ref)},hasRun:!1,cleanupFn:uT});function ui(e){return typeof e=="function"}function Jm(e){let n=e(s=>{Error.call(s),s.stack=new Error().stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Xx=Jm(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:
${n.map((s,h)=>`${h+1}) ${s.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=n});function tp(e,t){if(e){let n=e.indexOf(t);0<=n&&e.splice(n,1)}}var to=class e{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;let{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(let r of n)r.remove(this);else n.remove(this);let{initialTeardown:s}=this;if(ui(s))try{s()}catch(r){t=r instanceof Xx?r.errors:[r]}let{_finalizers:h}=this;if(h){this._finalizers=null;for(let r of h)try{ER(r)}catch(w){t=t??[],w instanceof Xx?t=[...t,...w.errors]:t.push(w)}}if(t)throw new Xx(t)}}add(t){var n;if(t&&t!==this)if(this.closed)ER(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}}_hasParent(t){let{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){let{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){let{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&tp(n,t)}remove(t){let{_finalizers:n}=this;n&&tp(n,t),t instanceof e&&t._removeParent(this)}};to.EMPTY=(()=>{let e=new to;return e.closed=!0,e})();var mT=to.EMPTY;function Kx(e){return e instanceof to||e&&"closed"in e&&ui(e.remove)&&ui(e.add)&&ui(e.unsubscribe)}function ER(e){ui(e)?e():e.unsubscribe()}var Dc={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Qm={setTimeout(e,t,...n){let{delegate:s}=Qm;return s?.setTimeout?s.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){let{delegate:t}=Qm;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Jx(e){Qm.setTimeout(()=>{let{onUnhandledError:t}=Dc;if(t)t(e);else throw e})}function np(){}var SR=gT("C",void 0,void 0);function IR(e){return gT("E",void 0,e)}function PR(e){return gT("N",e,void 0)}function gT(e,t,n){return{kind:e,value:t,error:n}}var ip=null;function eg(e){if(Dc.useDeprecatedSynchronousErrorHandling){let t=!ip;if(t&&(ip={errorThrown:!1,error:null}),e(),t){let{errorThrown:n,error:s}=ip;if(ip=null,n)throw s}}else e()}function DR(e){Dc.useDeprecatedSynchronousErrorHandling&&ip&&(ip.errorThrown=!0,ip.error=e)}var rp=class extends to{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Kx(t)&&t.add(this)):this.destination=M9}static create(t,n,s){return new tg(t,n,s)}next(t){this.isStopped?yT(PR(t),this):this._next(t)}error(t){this.isStopped?yT(IR(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?yT(SR,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},w9=Function.prototype.bind;function _T(e,t){return w9.call(e,t)}var vT=class{constructor(t){this.partialObserver=t}next(t){let{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(s){Qx(s)}}error(t){let{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(s){Qx(s)}else Qx(t)}complete(){let{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){Qx(n)}}},tg=class extends rp{constructor(t,n,s){super();let h;if(ui(t)||!t)h={next:t??void 0,error:n??void 0,complete:s??void 0};else{let r;this&&Dc.useDeprecatedNextContext?(r=Object.create(t),r.unsubscribe=()=>this.unsubscribe(),h={next:t.next&&_T(t.next,r),error:t.error&&_T(t.error,r),complete:t.complete&&_T(t.complete,r)}):h=t}this.destination=new vT(h)}};function Qx(e){Dc.useDeprecatedSynchronousErrorHandling?DR(e):Jx(e)}function C9(e){throw e}function yT(e,t){let{onStoppedNotification:n}=Dc;n&&Qm.setTimeout(()=>n(e,t))}var M9={closed:!0,next:np,error:C9,complete:np};var ng=typeof Symbol=="function"&&Symbol.observable||"@@observable";function ma(e){return e}function xT(...e){return bT(e)}function bT(e){return e.length===0?ma:e.length===1?e[0]:function(n){return e.reduce((s,h)=>h(s),n)}}var Qi=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){let s=new e;return s.source=this,s.operator=n,s}subscribe(n,s,h){let r=E9(n)?n:new tg(n,s,h);return eg(()=>{let{operator:w,source:A}=this;r.add(w?w.call(r,A):A?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(n){try{return this._subscribe(n)}catch(s){n.error(s)}}forEach(n,s){return s=OR(s),new s((h,r)=>{let w=new tg({next:A=>{try{n(A)}catch(F){r(F),w.unsubscribe()}},error:r,complete:h});this.subscribe(w)})}_subscribe(n){var s;return(s=this.source)===null||s===void 0?void 0:s.subscribe(n)}[ng](){return this}pipe(...n){return bT(n)(this)}toPromise(n){return n=OR(n),new n((s,h)=>{let r;this.subscribe(w=>r=w,w=>h(w),()=>s(r))})}}return e.create=t=>new e(t),e})();function OR(e){var t;return(t=e??Dc.Promise)!==null&&t!==void 0?t:Promise}function T9(e){return e&&ui(e.next)&&ui(e.error)&&ui(e.complete)}function E9(e){return e&&e instanceof rp||T9(e)&&Kx(e)}function wT(e){return ui(e?.lift)}function Ri(e){return t=>{if(wT(t))return t.lift(function(n){try{return e(n,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function Di(e,t,n,s,h){return new CT(e,t,n,s,h)}var CT=class extends rp{constructor(t,n,s,h,r,w){super(t),this.onFinalize=r,this.shouldUnsubscribe=w,this._next=n?function(A){try{n(A)}catch(F){t.error(F)}}:super._next,this._error=h?function(A){try{h(A)}catch(F){t.error(F)}finally{this.unsubscribe()}}:super._error,this._complete=s?function(){try{s()}catch(A){t.error(A)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:n}=this;super.unsubscribe(),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}}};function ig(){return Ri((e,t)=>{let n=null;e._refCount++;let s=Di(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount){n=null;return}let h=e._connection,r=n;n=null,h&&(!r||h===r)&&h.unsubscribe(),t.unsubscribe()});e.subscribe(s),s.closed||(n=e.connect())})}var rg=class extends Qi{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,wT(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){let t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new to;let n=this.getSubject();t.add(this.source.subscribe(Di(n,void 0,()=>{this._teardown(),n.complete()},s=>{this._teardown(),n.error(s)},()=>this._teardown()))),t.closed&&(this._connection=null,t=to.EMPTY)}return t}refCount(){return ig()(this)}};var og={schedule(e){let t=requestAnimationFrame,n=cancelAnimationFrame,{delegate:s}=og;s&&(t=s.requestAnimationFrame,n=s.cancelAnimationFrame);let h=t(r=>{n=void 0,e(r)});return new to(()=>n?.(h))},requestAnimationFrame(...e){let{delegate:t}=og;return(t?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){let{delegate:t}=og;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};var AR=Jm(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ii=(()=>{class e extends Qi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){let s=new e1(this,this);return s.operator=n,s}_throwIfClosed(){if(this.closed)throw new AR}next(n){eg(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let s of this.currentObservers)s.next(n)}})}error(n){eg(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;let{observers:s}=this;for(;s.length;)s.shift().error(n)}})}complete(){eg(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){let{hasError:s,isStopped:h,observers:r}=this;return s||h?mT:(this.currentObservers=null,r.push(n),new to(()=>{this.currentObservers=null,tp(r,n)}))}_checkFinalizedStatuses(n){let{hasError:s,thrownError:h,isStopped:r}=this;s?n.error(h):r&&n.complete()}asObservable(){let n=new Qi;return n.source=this,n}}return e.create=(t,n)=>new e1(t,n),e})(),e1=class extends Ii{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.next)===null||s===void 0||s.call(n,t)}error(t){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.error)===null||s===void 0||s.call(n,t)}complete(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)}_subscribe(t){var n,s;return(s=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&s!==void 0?s:mT}};var po=class extends Ii{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){let n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){let{hasError:t,thrownError:n,_value:s}=this;if(t)throw n;return this._throwIfClosed(),s}next(t){super.next(this._value=t)}};var Py={now(){return(Py.delegate||Date).now()},delegate:void 0};var ga=class extends Ii{constructor(t=1/0,n=1/0,s=Py){super(),this._bufferSize=t,this._windowTime=n,this._timestampProvider=s,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=n===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,n)}next(t){let{isStopped:n,_buffer:s,_infiniteTimeWindow:h,_timestampProvider:r,_windowTime:w}=this;n||(s.push(t),!h&&s.push(r.now()+w)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();let n=this._innerSubscribe(t),{_infiniteTimeWindow:s,_buffer:h}=this,r=h.slice();for(let w=0;w<r.length&&!t.closed;w+=s?1:2)t.next(r[w]);return this._checkFinalizedStatuses(t),n}_trimBuffer(){let{_bufferSize:t,_timestampProvider:n,_buffer:s,_infiniteTimeWindow:h}=this,r=(h?1:2)*t;if(t<1/0&&r<s.length&&s.splice(0,s.length-r),!h){let w=n.now(),A=0;for(let F=1;F<s.length&&s[F]<=w;F+=2)A=F;A&&s.splice(0,A+1)}}};var t1=class extends to{constructor(t,n){super()}schedule(t,n=0){return this}};var Dy={setInterval(e,t,...n){let{delegate:s}=Dy;return s?.setInterval?s.setInterval(e,t,...n):setInterval(e,t,...n)},clearInterval(e){let{delegate:t}=Dy;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};var sg=class extends t1{constructor(t,n){super(t,n),this.scheduler=t,this.work=n,this.pending=!1}schedule(t,n=0){if(this.closed)return this;this.state=t;let s=this.id,h=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(h,s,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(h,this.id,n),this}requestAsyncId(t,n,s=0){return Dy.setInterval(t.flush.bind(t,this),s)}recycleAsyncId(t,n,s=0){if(s!=null&&this.delay===s&&this.pending===!1)return n;Dy.clearInterval(n)}execute(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let s=this._execute(t,n);if(s)return s;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,n){let s=!1,h;try{this.work(t)}catch(r){s=!0,h=r||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),h}unsubscribe(){if(!this.closed){let{id:t,scheduler:n}=this,{actions:s}=n;this.work=this.state=this.scheduler=null,this.pending=!1,tp(s,this),t!=null&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,super.unsubscribe()}}};var ag=class e{constructor(t,n=e.now){this.schedulerActionCtor=t,this.now=n}schedule(t,n=0,s){return new this.schedulerActionCtor(this,t).schedule(s,n)}};ag.now=Py.now;var lg=class extends ag{constructor(t,n=ag.now){super(t,n),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){let{actions:n}=this;if(this._active){n.push(t);return}let s;this._active=!0;do if(s=t.execute(t.state,t.delay))break;while(t=n.shift());if(this._active=!1,s){for(;t=n.shift();)t.unsubscribe();throw s}}};var ph=new lg(sg),RR=ph;var n1=class extends sg{constructor(t,n){super(t,n),this.scheduler=t,this.work=n}requestAsyncId(t,n,s=0){return s!==null&&s>0?super.requestAsyncId(t,n,s):(t.actions.push(this),t._scheduled||(t._scheduled=og.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,n,s=0){if(s!=null&&s>0||s==null&&this.delay>0)return super.recycleAsyncId(t,n,s);t.actions.some(h=>h.id===n)||(og.cancelAnimationFrame(n),t._scheduled=void 0)}};var i1=class extends lg{flush(t){this._active=!0;let n=this._scheduled;this._scheduled=void 0;let{actions:s}=this,h;t=t||s.shift();do if(h=t.execute(t.state,t.delay))break;while((t=s[0])&&t.id===n&&s.shift());if(this._active=!1,h){for(;(t=s[0])&&t.id===n&&s.shift();)t.unsubscribe();throw h}}};var vu=new i1(n1);var Ds=new Qi(e=>e.complete());function r1(e){return e&&ui(e.schedule)}function MT(e){return e[e.length-1]}function o1(e){return ui(MT(e))?e.pop():void 0}function Ul(e){return r1(MT(e))?e.pop():void 0}function s1(e,t){return typeof MT(e)=="number"?e.pop():t}function Hl(e,t,n,s){var h=arguments.length,r=h<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,n):s,w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(e,t,n,s);else for(var A=e.length-1;A>=0;A--)(w=e[A])&&(r=(h<3?w(r):h>3?w(t,n,r):w(t,n))||r);return h>3&&r&&Object.defineProperty(t,n,r),r}function LR(e,t,n,s){function h(r){return r instanceof n?r:new n(function(w){w(r)})}return new(n||(n=Promise))(function(r,w){function A(K){try{$(s.next(K))}catch(se){w(se)}}function F(K){try{$(s.throw(K))}catch(se){w(se)}}function $(K){K.done?r(K.value):h(K.value).then(A,F)}$((s=s.apply(e,t||[])).next())})}function kR(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],s=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function op(e){return this instanceof op?(this.v=e,this):new op(e)}function FR(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(e,t||[]),h,r=[];return h=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),A("next"),A("throw"),A("return",w),h[Symbol.asyncIterator]=function(){return this},h;function w(ae){return function(Ze){return Promise.resolve(Ze).then(ae,se)}}function A(ae,Ze){s[ae]&&(h[ae]=function(Ue){return new Promise(function(ft,Xe){r.push([ae,Ue,ft,Xe])>1||F(ae,Ue)})},Ze&&(h[ae]=Ze(h[ae])))}function F(ae,Ze){try{$(s[ae](Ze))}catch(Ue){le(r[0][3],Ue)}}function $(ae){ae.value instanceof op?Promise.resolve(ae.value.v).then(K,se):le(r[0][2],ae)}function K(ae){F("next",ae)}function se(ae){F("throw",ae)}function le(ae,Ze){ae(Ze),r.shift(),r.length&&F(r[0][0],r[0][1])}}function NR(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof kR=="function"?kR(e):e[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(r){n[r]=e[r]&&function(w){return new Promise(function(A,F){w=e[r](w),h(A,F,w.done,w.value)})}}function h(r,w,A,F){Promise.resolve(F).then(function($){r({value:$,done:A})},w)}}var cg=e=>e&&typeof e.length=="number"&&typeof e!="function";function a1(e){return ui(e?.then)}function l1(e){return ui(e[ng])}function c1(e){return Symbol.asyncIterator&&ui(e?.[Symbol.asyncIterator])}function u1(e){return new TypeError(`You provided ${e!==null&&typeof e=="object"?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function S9(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var h1=S9();function d1(e){return ui(e?.[h1])}function f1(e){return FR(this,arguments,function*(){let n=e.getReader();try{for(;;){let{value:s,done:h}=yield op(n.read());if(h)return yield op(void 0);yield yield op(s)}}finally{n.releaseLock()}})}function p1(e){return ui(e?.getReader)}function no(e){if(e instanceof Qi)return e;if(e!=null){if(l1(e))return I9(e);if(cg(e))return P9(e);if(a1(e))return D9(e);if(c1(e))return zR(e);if(d1(e))return O9(e);if(p1(e))return A9(e)}throw u1(e)}function I9(e){return new Qi(t=>{let n=e[ng]();if(ui(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function P9(e){return new Qi(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function D9(e){return new Qi(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Jx)})}function O9(e){return new Qi(t=>{for(let n of e)if(t.next(n),t.closed)return;t.complete()})}function zR(e){return new Qi(t=>{R9(e,t).catch(n=>t.error(n))})}function A9(e){return zR(f1(e))}function R9(e,t){var n,s,h,r;return LR(this,void 0,void 0,function*(){try{for(n=NR(e);s=yield n.next(),!s.done;){let w=s.value;if(t.next(w),t.closed)return}}catch(w){h={error:w}}finally{try{s&&!s.done&&(r=n.return)&&(yield r.call(n))}finally{if(h)throw h.error}}t.complete()})}function Ua(e,t,n,s=0,h=!1){let r=t.schedule(function(){n(),h?e.add(this.schedule(null,s)):this.unsubscribe()},s);if(e.add(r),!h)return r}function m1(e,t=0){return Ri((n,s)=>{n.subscribe(Di(s,h=>Ua(s,e,()=>s.next(h),t),()=>Ua(s,e,()=>s.complete(),t),h=>Ua(s,e,()=>s.error(h),t)))})}function g1(e,t=0){return Ri((n,s)=>{s.add(e.schedule(()=>n.subscribe(s),t))})}function BR(e,t){return no(e).pipe(g1(t),m1(t))}function VR(e,t){return no(e).pipe(g1(t),m1(t))}function jR(e,t){return new Qi(n=>{let s=0;return t.schedule(function(){s===e.length?n.complete():(n.next(e[s++]),n.closed||this.schedule())})})}function UR(e,t){return new Qi(n=>{let s;return Ua(n,t,()=>{s=e[h1](),Ua(n,t,()=>{let h,r;try{({value:h,done:r}=s.next())}catch(w){n.error(w);return}r?n.complete():n.next(h)},0,!0)}),()=>ui(s?.return)&&s.return()})}function _1(e,t){if(!e)throw new Error("Iterable cannot be null");return new Qi(n=>{Ua(n,t,()=>{let s=e[Symbol.asyncIterator]();Ua(n,t,()=>{s.next().then(h=>{h.done?n.complete():n.next(h.value)})},0,!0)})})}function HR(e,t){return _1(f1(e),t)}function ug(e,t){if(e!=null){if(l1(e))return BR(e,t);if(cg(e))return jR(e,t);if(a1(e))return VR(e,t);if(c1(e))return _1(e,t);if(d1(e))return UR(e,t);if(p1(e))return HR(e,t)}throw u1(e)}function cr(e,t){return t?ug(e,t):no(e)}function yi(...e){let t=Ul(e);return cr(e,t)}function hg(e,t){let n=ui(e)?e:()=>e,s=h=>h.error(n());return new Qi(t?h=>t.schedule(s,0,h):s)}function TT(e){return!!e&&(e instanceof Qi||ui(e.lift)&&ui(e.subscribe))}var mh=Jm(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function $R(e){return e instanceof Date&&!isNaN(e)}function ti(e,t){return Ri((n,s)=>{let h=0;n.subscribe(Di(s,r=>{s.next(e.call(t,r,h++))}))})}var{isArray:k9}=Array;function L9(e,t){return k9(t)?e(...t):e(t)}function dg(e){return ti(t=>L9(e,t))}var{isArray:F9}=Array,{getPrototypeOf:N9,prototype:z9,keys:B9}=Object;function y1(e){if(e.length===1){let t=e[0];if(F9(t))return{args:t,keys:null};if(V9(t)){let n=B9(t);return{args:n.map(s=>t[s]),keys:n}}}return{args:e,keys:null}}function V9(e){return e&&typeof e=="object"&&N9(e)===z9}function v1(e,t){return e.reduce((n,s,h)=>(n[s]=t[h],n),{})}function Oy(...e){let t=Ul(e),n=o1(e),{args:s,keys:h}=y1(e);if(s.length===0)return cr([],t);let r=new Qi(j9(s,t,h?w=>v1(h,w):ma));return n?r.pipe(dg(n)):r}function j9(e,t,n=ma){return s=>{GR(t,()=>{let{length:h}=e,r=new Array(h),w=h,A=h;for(let F=0;F<h;F++)GR(t,()=>{let $=cr(e[F],t),K=!1;$.subscribe(Di(s,se=>{r[F]=se,K||(K=!0,A--),A||s.next(n(r.slice()))},()=>{--w||s.complete()}))},s)},s)}}function GR(e,t,n){e?Ua(n,e,t):t()}function qR(e,t,n,s,h,r,w,A){let F=[],$=0,K=0,se=!1,le=()=>{se&&!F.length&&!$&&t.complete()},ae=Ue=>$<s?Ze(Ue):F.push(Ue),Ze=Ue=>{r&&t.next(Ue),$++;let ft=!1;no(n(Ue,K++)).subscribe(Di(t,Xe=>{h?.(Xe),r?ae(Xe):t.next(Xe)},()=>{ft=!0},void 0,()=>{if(ft)try{for($--;F.length&&$<s;){let Xe=F.shift();w?Ua(t,w,()=>Ze(Xe)):Ze(Xe)}le()}catch(Xe){t.error(Xe)}}))};return e.subscribe(Di(t,ae,()=>{se=!0,le()})),()=>{A?.()}}function Xr(e,t,n=1/0){return ui(t)?Xr((s,h)=>ti((r,w)=>t(s,r,h,w))(no(e(s,h))),n):(typeof t=="number"&&(n=t),Ri((s,h)=>qR(s,h,e,n)))}function xu(e=1/0){return Xr(ma,e)}function ZR(){return xu(1)}function Pd(...e){return ZR()(cr(e,Ul(e)))}function x1(e){return new Qi(t=>{no(e()).subscribe(t)})}function Ay(...e){let t=o1(e),{args:n,keys:s}=y1(e),h=new Qi(r=>{let{length:w}=n;if(!w){r.complete();return}let A=new Array(w),F=w,$=w;for(let K=0;K<w;K++){let se=!1;no(n[K]).subscribe(Di(r,le=>{se||(se=!0,$--),A[K]=le},()=>F--,void 0,()=>{(!F||!se)&&($||r.next(s?v1(s,A):A),r.complete())}))}});return t?h.pipe(dg(t)):h}var U9=["addListener","removeListener"],H9=["addEventListener","removeEventListener"],$9=["on","off"];function bo(e,t,n,s){if(ui(n)&&(s=n,n=void 0),s)return bo(e,t,n).pipe(dg(s));let[h,r]=Z9(e)?H9.map(w=>A=>e[w](t,A,n)):G9(e)?U9.map(WR(e,t)):q9(e)?$9.map(WR(e,t)):[];if(!h&&cg(e))return Xr(w=>bo(w,t,n))(no(e));if(!h)throw new TypeError("Invalid event target");return new Qi(w=>{let A=(...F)=>w.next(1<F.length?F:F[0]);return h(A),()=>r(A)})}function WR(e,t){return n=>s=>e[n](t,s)}function G9(e){return ui(e.addListener)&&ui(e.removeListener)}function q9(e){return ui(e.on)&&ui(e.off)}function Z9(e){return ui(e.addEventListener)&&ui(e.removeEventListener)}function Mr(e=0,t,n=RR){let s=-1;return t!=null&&(r1(t)?n=t:s=t),new Qi(h=>{let r=$R(e)?+e-n.now():e;r<0&&(r=0);let w=0;return n.schedule(function(){h.closed||(h.next(w++),0<=s?this.schedule(void 0,s):h.complete())},r)})}function ET(e=0,t=ph){return e<0&&(e=0),Mr(e,e,t)}function ST(...e){let t=Ul(e),n=s1(e,1/0),s=e;return s.length?s.length===1?no(s[0]):xu(n)(cr(s,t)):Ds}var{isArray:W9}=Array;function YR(e){return e.length===1&&W9(e[0])?e[0]:e}function io(e,t){return Ri((n,s)=>{let h=0;n.subscribe(Di(s,r=>e.call(t,r,h++)&&s.next(r)))})}function Dd(e){return Ri((t,n)=>{let s=null,h=!1,r;s=t.subscribe(Di(n,void 0,void 0,w=>{r=no(e(w,Dd(e)(t))),s?(s.unsubscribe(),s=null,r.subscribe(n)):h=!0})),h&&(s.unsubscribe(),s=null,r.subscribe(n))})}function XR(e,t,n,s,h){return(r,w)=>{let A=n,F=t,$=0;r.subscribe(Di(w,K=>{let se=$++;F=A?e(F,K,se):(A=!0,K),s&&w.next(F)},h&&(()=>{A&&w.next(F),w.complete()})))}}function gh(e,t){return ui(t)?Xr(e,t,1):Xr(e,1)}function yl(e,t=ph){return Ri((n,s)=>{let h=null,r=null,w=null,A=()=>{if(h){h.unsubscribe(),h=null;let $=r;r=null,s.next($)}};function F(){let $=w+e,K=t.now();if(K<$){h=this.schedule(void 0,$-K),s.add(h);return}A()}n.subscribe(Di(s,$=>{r=$,w=t.now(),h||(h=t.schedule(F,e),s.add(h))},()=>{A(),s.complete()},void 0,()=>{r=h=null}))})}function Od(e){return Ri((t,n)=>{let s=!1;t.subscribe(Di(n,h=>{s=!0,n.next(h)},()=>{s||n.next(e),n.complete()}))})}function Qs(e){return e<=0?()=>Ds:Ri((t,n)=>{let s=0;t.subscribe(Di(n,h=>{++s<=e&&(n.next(h),e<=s&&n.complete())}))})}function KR(){return Ri((e,t)=>{e.subscribe(Di(t,np))})}function Ry(e){return ti(()=>e)}function IT(e,t){return t?n=>Pd(t.pipe(Qs(1),KR()),n.pipe(IT(e))):Xr((n,s)=>e(n,s).pipe(Qs(1),Ry(n)))}function _a(e,t=ph){let n=Mr(e,t);return IT(()=>n)}function Ad(e,t=ma){return e=e??Y9,Ri((n,s)=>{let h,r=!0;n.subscribe(Di(s,w=>{let A=t(w);(r||!e(h,A))&&(r=!1,h=A,s.next(w))}))})}function Y9(e,t){return e===t}function b1(e=X9){return Ri((t,n)=>{let s=!1;t.subscribe(Di(n,h=>{s=!0,n.next(h)},()=>s?n.complete():n.error(e())))})}function X9(){return new mh}function Rd(e){return Ri((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}function mo(e,t){let n=arguments.length>=2;return s=>s.pipe(e?io((h,r)=>e(h,r,s)):ma,Qs(1),n?Od(t):b1(()=>new mh))}function kd(e){return e<=0?()=>Ds:Ri((t,n)=>{let s=[];t.subscribe(Di(n,h=>{s.push(h),e<s.length&&s.shift()},()=>{for(let h of s)n.next(h);n.complete()},void 0,()=>{s=null}))})}function PT(e,t){let n=arguments.length>=2;return s=>s.pipe(e?io((h,r)=>e(h,r,s)):ma,kd(1),n?Od(t):b1(()=>new mh))}function JR(...e){let t=Ul(e),n=s1(e,1/0);return e=YR(e),Ri((s,h)=>{xu(n)(cr([s,...e],t)).subscribe(h)})}function DT(...e){return JR(...e)}function OT(e,t){return Ri(XR(e,t,arguments.length>=2,!0))}function AT(...e){let t=Ul(e);return Ri((n,s)=>{(t?Pd(e,n,t):Pd(e,n)).subscribe(s)})}function Vr(e,t){return Ri((n,s)=>{let h=null,r=0,w=!1,A=()=>w&&!h&&s.complete();n.subscribe(Di(s,F=>{h?.unsubscribe();let $=0,K=r++;no(e(F,K)).subscribe(h=Di(s,se=>s.next(t?t(F,se,K,$++):se),()=>{h=null,A()}))},()=>{w=!0,A()}))})}function sp(e){return Ri((t,n)=>{no(e).subscribe(Di(n,()=>n.complete(),np)),!n.closed&&t.subscribe(n)})}function pi(e,t,n){let s=ui(e)||t||n?{next:e,error:t,complete:n}:e;return s?Ri((h,r)=>{var w;(w=s.subscribe)===null||w===void 0||w.call(s);let A=!0;h.subscribe(Di(r,F=>{var $;($=s.next)===null||$===void 0||$.call(s,F),r.next(F)},()=>{var F;A=!1,(F=s.complete)===null||F===void 0||F.call(s),r.complete()},F=>{var $;A=!1,($=s.error)===null||$===void 0||$.call(s,F),r.error(F)},()=>{var F,$;A&&((F=s.unsubscribe)===null||F===void 0||F.call(s)),($=s.finalize)===null||$===void 0||$.call(s)}))}):ma}var RT={leading:!0,trailing:!1};function QR(e,t=RT){return Ri((n,s)=>{let{leading:h,trailing:r}=t,w=!1,A=null,F=null,$=!1,K=()=>{F?.unsubscribe(),F=null,r&&(ae(),$&&s.complete())},se=()=>{F=null,$&&s.complete()},le=Ze=>F=no(e(Ze)).subscribe(Di(s,K,se)),ae=()=>{if(w){w=!1;let Ze=A;A=null,s.next(Ze),!$&&le(Ze)}};n.subscribe(Di(s,Ze=>{w=!0,A=Ze,!(F&&!F.closed)&&(h?ae():le(Ze))},()=>{$=!0,!(r&&w&&F&&!F.closed)&&s.complete()}))})}function kT(e,t=ph,n=RT){let s=Mr(e,t);return QR(()=>s,n)}var Gk="https://g.co/ng/security#xss",Un=class extends Error{code;constructor(t,n){super(cb(t,n)),this.code=t}};function cb(e,t){return`${`NG0${Math.abs(e)}`}${t?": "+t:""}`}var qk=Symbol("InputSignalNode#UNSET"),K9=lr(cn({},pT),{transformFn:void 0,applyValueToInputSignal(e,t){Yx(e,t)}});function Zk(e,t){let n=Object.create(K9);n.value=e,n.transformFn=t?.transform;function s(){if(qx(n),n.value===qk)throw new Un(-950,!1);return n.value}return s[_l]=n,s}function Ky(e){return{toString:e}.toString()}var w1="__parameters__";function J9(e){return function(...n){if(e){let s=e(...n);for(let h in s)this[h]=s[h]}}}function Wk(e,t,n){return Ky(()=>{let s=J9(t);function h(...r){if(this instanceof h)return s.apply(this,r),this;let w=new h(...r);return A.annotation=w,A;function A(F,$,K){let se=F.hasOwnProperty(w1)?F[w1]:Object.defineProperty(F,w1,{value:[]})[w1];for(;se.length<=K;)se.push(null);return(se[K]=se[K]||[]).push(w),F}}return n&&(h.prototype=Object.create(n.prototype)),h.prototype.ngMetadataName=e,h.annotationCls=h,h})}var va=globalThis;function Kr(e){for(let t in e)if(e[t]===Kr)return t;throw Error("Could not find renamed property on target object.")}function ya(e){if(typeof e=="string")return e;if(Array.isArray(e))return"["+e.map(ya).join(", ")+"]";if(e==null)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;let t=e.toString();if(t==null)return""+t;let n=t.indexOf(`
`);return n===-1?t:t.substring(0,n)}function ek(e,t){return e==null||e===""?t===null?"":t:t==null||t===""?e:e+" "+t}var Q9=Kr({__forward_ref__:Kr});function tS(e){return e.__forward_ref__=tS,e.toString=function(){return ya(this())},e}function $l(e){return Yk(e)?e():e}function Yk(e){return typeof e=="function"&&e.hasOwnProperty(Q9)&&e.__forward_ref__===tS}function wn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function wa(e){return{providers:e.providers||[],imports:e.imports||[]}}function ub(e){return tk(e,Kk)||tk(e,Jk)}function Xk(e){return ub(e)!==null}function tk(e,t){return e.hasOwnProperty(t)?e[t]:null}function e7(e){let t=e&&(e[Kk]||e[Jk]);return t||null}function nk(e){return e&&(e.hasOwnProperty(ik)||e.hasOwnProperty(t7))?e[ik]:null}var Kk=Kr({\u0275prov:Kr}),ik=Kr({\u0275inj:Kr}),Jk=Kr({ngInjectableDef:Kr}),t7=Kr({ngInjectorDef:Kr}),Hn=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(t,n){this._desc=t,this.\u0275prov=void 0,typeof n=="number"?this.__NG_ELEMENT_ID__=n:n!==void 0&&(this.\u0275prov=wn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function Qk(e){return e&&!!e.\u0275providers}var n7=Kr({\u0275cmp:Kr}),i7=Kr({\u0275dir:Kr}),nS=Kr({\u0275pipe:Kr}),r7=Kr({\u0275mod:Kr}),k1=Kr({\u0275fac:Kr}),Ny=Kr({__NG_ELEMENT_ID__:Kr}),rk=Kr({__NG_ENV_ID__:Kr});function lp(e){return typeof e=="string"?e:e==null?"":String(e)}function o7(e){return typeof e=="function"?e.name||e.toString():typeof e=="object"&&e!=null&&typeof e.type=="function"?e.type.name||e.type.toString():lp(e)}function s7(e,t){let n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Un(-200,e)}function iS(e,t){throw new Un(-201,!1)}var Zi=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Zi||{}),qT;function eL(){return qT}function Ha(e){let t=qT;return qT=e,t}function tL(e,t,n){let s=ub(e);if(s&&s.providedIn=="root")return s.value===void 0?s.value=s.factory():s.value;if(n&Zi.Optional)return null;if(t!==void 0)return t;iS(e,"Injector")}var a7={},By=a7,ZT="__NG_DI_FLAG__",L1="ngTempTokenPath",l7="ngTokenPath",c7=/\n/gm,u7="\u0275",ok="__source",_g;function h7(){return _g}function Ld(e){let t=_g;return _g=e,t}function d7(e,t=Zi.Default){if(_g===void 0)throw new Un(-203,!1);return _g===null?tL(e,void 0,t):_g.get(e,t&Zi.Optional?null:void 0,t)}function Bn(e,t=Zi.Default){return(eL()||d7)($l(e),t)}function Qt(e,t=Zi.Default){return Bn(e,hb(t))}function hb(e){return typeof e>"u"||typeof e=="number"?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function WT(e){let t=[];for(let n=0;n<e.length;n++){let s=$l(e[n]);if(Array.isArray(s)){if(s.length===0)throw new Un(900,!1);let h,r=Zi.Default;for(let w=0;w<s.length;w++){let A=s[w],F=f7(A);typeof F=="number"?F===-1?h=A.token:r|=F:h=A}t.push(Bn(h,r))}else t.push(Bn(s))}return t}function nL(e,t){return e[ZT]=t,e.prototype[ZT]=t,e}function f7(e){return e[ZT]}function p7(e,t,n,s){let h=e[L1];throw t[ok]&&h.unshift(t[ok]),e.message=m7(`
`+e.message,h,n,s),e[l7]=h,e[L1]=null,e}function m7(e,t,n,s=null){e=e&&e.charAt(0)===`
`&&e.charAt(1)==u7?e.slice(2):e;let h=ya(t);if(Array.isArray(t))h=t.map(ya).join(" -> ");else if(typeof t=="object"){let r=[];for(let w in t)if(t.hasOwnProperty(w)){let A=t[w];r.push(w+":"+(typeof A=="string"?JSON.stringify(A):ya(A)))}h=`{${r.join(", ")}}`}return`${n}${s?"("+s+")":""}[${h}]: ${e.replace(c7,`
  `)}`}var db=nL(Wk("Optional"),8);var rS=nL(Wk("SkipSelf"),4);function cp(e,t){let n=e.hasOwnProperty(k1);return n?e[k1]:null}function g7(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){let h=e[s],r=t[s];if(n&&(h=n(h),r=n(r)),r!==h)return!1}return!0}function _7(e){return e.flat(Number.POSITIVE_INFINITY)}function oS(e,t){e.forEach(n=>Array.isArray(n)?oS(n,t):t(n))}function iL(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function F1(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function y7(e,t,n,s){let h=e.length;if(h==t)e.push(n,s);else if(h===1)e.push(s,e[0]),e[0]=n;else{for(h--,e.push(e[h-1],e[h]);h>t;){let r=h-2;e[h]=e[r],h--}e[t]=n,e[t+1]=s}}function v7(e,t,n){let s=Jy(e,t);return s>=0?e[s|1]=n:(s=~s,y7(e,s,t,n)),s}function LT(e,t){let n=Jy(e,t);if(n>=0)return e[n|1]}function Jy(e,t){return x7(e,t,1)}function x7(e,t,n){let s=0,h=e.length>>n;for(;h!==s;){let r=s+(h-s>>1),w=e[r<<n];if(t===w)return r<<n;w>t?h=r:s=r+1}return~(h<<n)}var Vy={},Gl=[],vg=new Hn(""),rL=new Hn("",-1),oL=new Hn(""),N1=class{get(t,n=By){if(n===By){let s=new Error(`NullInjectorError: No provider for ${ya(t)}!`);throw s.name="NullInjectorError",s}return n}};function sL(e,t){let n=e[r7]||null;if(!n&&t===!0)throw new Error(`Type ${ya(e)} does not have '\u0275mod' property.`);return n}function Nd(e){return e[n7]||null}function aL(e){return e[i7]||null}function lL(e){return e[nS]||null}function cL(e){let t=Nd(e)||aL(e)||lL(e);return t!==null?t.standalone:!1}function fb(e){return{\u0275providers:e}}function b7(...e){return{\u0275providers:uL(!0,e),\u0275fromNgModule:!0}}function uL(e,...t){let n=[],s=new Set,h,r=w=>{n.push(w)};return oS(t,w=>{let A=w;XT(A,r,[],s)&&(h||=[],h.push(A))}),h!==void 0&&hL(h,r),n}function hL(e,t){for(let n=0;n<e.length;n++){let{ngModule:s,providers:h}=e[n];sS(h,r=>{t(r,s)})}}function XT(e,t,n,s){if(e=$l(e),!e)return!1;let h=null,r=nk(e),w=!r&&Nd(e);if(!r&&!w){let F=e.ngModule;if(r=nk(F),r)h=F;else return!1}else{if(w&&!w.standalone)return!1;h=e}let A=s.has(h);if(w){if(A)return!1;if(s.add(h),w.dependencies){let F=typeof w.dependencies=="function"?w.dependencies():w.dependencies;for(let $ of F)XT($,t,n,s)}}else if(r){if(r.imports!=null&&!A){s.add(h);let $;try{oS(r.imports,K=>{XT(K,t,n,s)&&($||=[],$.push(K))})}finally{}$!==void 0&&hL($,t)}if(!A){let $=cp(h)||(()=>new h);t({provide:h,useFactory:$,deps:Gl},h),t({provide:oL,useValue:h,multi:!0},h),t({provide:vg,useValue:()=>Bn(h),multi:!0},h)}let F=r.providers;if(F!=null&&!A){let $=e;sS(F,K=>{t(K,$)})}}else return!1;return h!==e&&e.providers!==void 0}function sS(e,t){for(let n of e)Qk(n)&&(n=n.\u0275providers),Array.isArray(n)?sS(n,t):t(n)}var w7=Kr({provide:String,useValue:Kr});function dL(e){return e!==null&&typeof e=="object"&&w7 in e}function C7(e){return!!(e&&e.useExisting)}function M7(e){return!!(e&&e.useFactory)}function KT(e){return typeof e=="function"}var pb=new Hn(""),I1={},T7={},FT;function aS(){return FT===void 0&&(FT=new N1),FT}var xa=class{},jy=class extends xa{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(t,n,s,h){super(),this.parent=n,this.source=s,this.scopes=h,QT(t,w=>this.processProvider(w)),this.records.set(rL,fg(void 0,this)),h.has("environment")&&this.records.set(xa,fg(void 0,this));let r=this.records.get(pb);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(oL,Gl,Zi.Self))}destroy(){Ly(this),this._destroyed=!0;let t=ir(null);try{for(let s of this._ngOnDestroyHooks)s.ngOnDestroy();let n=this._onDestroyHooks;this._onDestroyHooks=[];for(let s of n)s()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),ir(t)}}onDestroy(t){return Ly(this),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){Ly(this);let n=Ld(this),s=Ha(void 0),h;try{return t()}finally{Ld(n),Ha(s)}}get(t,n=By,s=Zi.Default){if(Ly(this),t.hasOwnProperty(rk))return t[rk](this);s=hb(s);let h,r=Ld(this),w=Ha(void 0);try{if(!(s&Zi.SkipSelf)){let F=this.records.get(t);if(F===void 0){let $=O7(t)&&ub(t);$&&this.injectableDefInScope($)?F=fg(JT(t),I1):F=null,this.records.set(t,F)}if(F!=null)return this.hydrate(t,F)}let A=s&Zi.Self?aS():this.parent;return n=s&Zi.Optional&&n===By?null:n,A.get(t,n)}catch(A){if(A.name==="NullInjectorError"){if((A[L1]=A[L1]||[]).unshift(ya(t)),r)throw A;return p7(A,t,"R3InjectorError",this.source)}else throw A}finally{Ha(w),Ld(r)}}resolveInjectorInitializers(){let t=ir(null),n=Ld(this),s=Ha(void 0),h;try{let r=this.get(vg,Gl,Zi.Self);for(let w of r)w()}finally{Ld(n),Ha(s),ir(t)}}toString(){let t=[],n=this.records;for(let s of n.keys())t.push(ya(s));return`R3Injector[${t.join(", ")}]`}processProvider(t){t=$l(t);let n=KT(t)?t:$l(t&&t.provide),s=S7(t);if(!KT(t)&&t.multi===!0){let h=this.records.get(n);h||(h=fg(void 0,I1,!0),h.factory=()=>WT(h.multi),this.records.set(n,h)),n=t,h.multi.push(t)}this.records.set(n,s)}hydrate(t,n){let s=ir(null);try{return n.value===I1&&(n.value=T7,n.value=n.factory()),typeof n.value=="object"&&n.value&&D7(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}finally{ir(s)}}injectableDefInScope(t){if(!t.providedIn)return!1;let n=$l(t.providedIn);return typeof n=="string"?n==="any"||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){let n=this._onDestroyHooks.indexOf(t);n!==-1&&this._onDestroyHooks.splice(n,1)}};function JT(e){let t=ub(e),n=t!==null?t.factory:cp(e);if(n!==null)return n;if(e instanceof Hn)throw new Un(204,!1);if(e instanceof Function)return E7(e);throw new Un(204,!1)}function E7(e){if(e.length>0)throw new Un(204,!1);let n=e7(e);return n!==null?()=>n.factory(e):()=>new e}function S7(e){if(dL(e))return fg(void 0,e.useValue);{let t=I7(e);return fg(t,I1)}}function I7(e,t,n){let s;if(KT(e)){let h=$l(e);return cp(h)||JT(h)}else if(dL(e))s=()=>$l(e.useValue);else if(M7(e))s=()=>e.useFactory(...WT(e.deps||[]));else if(C7(e))s=()=>Bn($l(e.useExisting));else{let h=$l(e&&(e.useClass||e.provide));if(P7(e))s=()=>new h(...WT(e.deps));else return cp(h)||JT(h)}return s}function Ly(e){if(e.destroyed)throw new Un(205,!1)}function fg(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function P7(e){return!!e.deps}function D7(e){return e!==null&&typeof e=="object"&&typeof e.ngOnDestroy=="function"}function O7(e){return typeof e=="function"||typeof e=="object"&&e instanceof Hn}function QT(e,t){for(let n of e)Array.isArray(n)?QT(n,t):n&&Qk(n)?QT(n.\u0275providers,t):t(n)}function $a(e,t){e instanceof jy&&Ly(e);let n,s=Ld(e),h=Ha(void 0);try{return t()}finally{Ld(s),Ha(h)}}function fL(){return eL()!==void 0||h7()!=null}function lS(e){if(!fL())throw new Un(-203,!1)}function A7(e){let t=va.ng;if(t&&t.\u0275compilerFacade)return t.\u0275compilerFacade;throw new Error("JIT compiler unavailable")}function R7(e){return typeof e=="function"}var Ch=0,wi=1,mi=2,ta=3,Ac=4,kc=5,Uy=6,z1=7,_s=8,xg=9,yh=10,ys=11,Hy=12,sk=13,Sg=14,Rc=15,up=16,pg=17,vh=18,Qy=19,pL=20,Fd=21,P1=22,hp=23,vl=24,vs=25,mL=1;var dp=7,B1=8,bg=9,ea=10,V1=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(V1||{});function _h(e){return Array.isArray(e)&&typeof e[mL]=="object"}function Mh(e){return Array.isArray(e)&&e[mL]===!0}function cS(e){return(e.flags&4)!==0}function mb(e){return e.componentOffset>-1}function gb(e){return(e.flags&1)===1}function e0(e){return!!e.template}function eE(e){return(e[mi]&512)!==0}var tE=class{previousValue;currentValue;firstChange;constructor(t,n,s){this.previousValue=t,this.currentValue=n,this.firstChange=s}isFirstChange(){return this.firstChange}};function gL(e,t,n,s){t!==null?t.applyValueToInputSignal(t,s):e[n]=s}var Os=(()=>{let e=()=>_L;return e.ngInherit=!0,e})();function _L(e){return e.type.prototype.ngOnChanges&&(e.setInput=L7),k7}function k7(){let e=vL(this),t=e?.current;if(t){let n=e.previous;if(n===Vy)e.previous=t;else for(let s in t)n[s]=t[s];e.current=null,this.ngOnChanges(t)}}function L7(e,t,n,s,h){let r=this.declaredInputs[s],w=vL(e)||F7(e,{previous:Vy,current:null}),A=w.current||(w.current={}),F=w.previous,$=F[r];A[r]=new tE($&&$.currentValue,n,F===Vy),gL(e,t,h,n)}var yL="__ngSimpleChanges__";function vL(e){return e[yL]||null}function F7(e,t){return e[yL]=t}var ak=null;var bu=function(e,t,n){ak?.(e,t,n)},xL="svg",N7="math";function xl(e){for(;Array.isArray(e);)e=e[Ch];return e}function bL(e,t){return xl(t[e])}function Zl(e,t){return xl(t[e.index])}function uS(e,t){return e.data[t]}function wL(e,t){return e[t]}function Cu(e,t){let n=t[e];return _h(n)?n:n[Ch]}function z7(e){return(e[mi]&4)===4}function hS(e){return(e[mi]&128)===128}function B7(e){return Mh(e[ta])}function zd(e,t){return t==null?null:e[t]}function CL(e){e[pg]=0}function dS(e){e[mi]&1024||(e[mi]|=1024,hS(e)&&t0(e))}function V7(e,t){for(;e>0;)t=t[Sg],e--;return t}function _b(e){return!!(e[mi]&9216||e[vl]?.dirty)}function nE(e){e[yh].changeDetectionScheduler?.notify(9),e[mi]&64&&(e[mi]|=1024),_b(e)&&t0(e)}function t0(e){e[yh].changeDetectionScheduler?.notify(0);let t=fp(e);for(;t!==null&&!(t[mi]&8192||(t[mi]|=8192,!hS(t)));)t=fp(t)}function ML(e,t){if((e[mi]&256)===256)throw new Un(911,!1);e[Fd]===null&&(e[Fd]=[]),e[Fd].push(t)}function j7(e,t){if(e[Fd]===null)return;let n=e[Fd].indexOf(t);n!==-1&&e[Fd].splice(n,1)}function fp(e){let t=e[ta];return Mh(t)?t[ta]:t}var Fi={lFrame:kL(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var iE=!1;function U7(){return Fi.lFrame.elementDepthCount}function H7(){Fi.lFrame.elementDepthCount++}function $7(){Fi.lFrame.elementDepthCount--}function TL(){return Fi.bindingsEnabled}function G7(){return Fi.skipHydrationRootTNode!==null}function q7(e){return Fi.skipHydrationRootTNode===e}function Z7(){Fi.skipHydrationRootTNode=null}function pr(){return Fi.lFrame.lView}function Ca(){return Fi.lFrame.tView}function Hi(e){return Fi.lFrame.contextLView=e,e[_s]}function $i(e){return Fi.lFrame.contextLView=null,e}function Ma(){let e=EL();for(;e!==null&&e.type===64;)e=e.parent;return e}function EL(){return Fi.lFrame.currentTNode}function W7(){let e=Fi.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}function vp(e,t){let n=Fi.lFrame;n.currentTNode=e,n.isParent=t}function fS(){return Fi.lFrame.isParent}function SL(){Fi.lFrame.isParent=!1}function Y7(){return Fi.lFrame.contextLView}function IL(){return iE}function j1(e){let t=iE;return iE=e,t}function PL(){let e=Fi.lFrame,t=e.bindingRootIndex;return t===-1&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function X7(){return Fi.lFrame.bindingIndex}function K7(e){return Fi.lFrame.bindingIndex=e}function n0(){return Fi.lFrame.bindingIndex++}function DL(e){let t=Fi.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function J7(){return Fi.lFrame.inI18n}function Q7(e,t){let n=Fi.lFrame;n.bindingIndex=n.bindingRootIndex=e,rE(t)}function eH(){return Fi.lFrame.currentDirectiveIndex}function rE(e){Fi.lFrame.currentDirectiveIndex=e}function tH(e){let t=Fi.lFrame.currentDirectiveIndex;return t===-1?null:e[t]}function OL(){return Fi.lFrame.currentQueryIndex}function pS(e){Fi.lFrame.currentQueryIndex=e}function nH(e){let t=e[wi];return t.type===2?t.declTNode:t.type===1?e[kc]:null}function AL(e,t,n){if(n&Zi.SkipSelf){let h=t,r=e;for(;h=h.parent,h===null&&!(n&Zi.Host);)if(h=nH(r),h===null||(r=r[Sg],h.type&10))break;if(h===null)return!1;t=h,e=r}let s=Fi.lFrame=RL();return s.currentTNode=t,s.lView=e,!0}function mS(e){let t=RL(),n=e[wi];Fi.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function RL(){let e=Fi.lFrame,t=e===null?null:e.child;return t===null?kL(e):t}function kL(e){let t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return e!==null&&(e.child=t),t}function LL(){let e=Fi.lFrame;return Fi.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}var FL=LL;function gS(){let e=LL();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function iH(e){return(Fi.lFrame.contextLView=V7(e,Fi.lFrame.contextLView))[_s]}function jd(){return Fi.lFrame.selectedIndex}function pp(e){Fi.lFrame.selectedIndex=e}function NL(){let e=Fi.lFrame;return uS(e.tView,e.selectedIndex)}function Vo(){Fi.lFrame.currentNamespace=xL}function Wl(){rH()}function rH(){Fi.lFrame.currentNamespace=null}function oH(){return Fi.lFrame.currentNamespace}var zL=!0;function yb(){return zL}function vb(e){zL=e}function sH(e,t,n){let{ngOnChanges:s,ngOnInit:h,ngDoCheck:r}=t.type.prototype;if(s){let w=_L(t);(n.preOrderHooks??=[]).push(e,w),(n.preOrderCheckHooks??=[]).push(e,w)}h&&(n.preOrderHooks??=[]).push(0-e,h),r&&((n.preOrderHooks??=[]).push(e,r),(n.preOrderCheckHooks??=[]).push(e,r))}function xb(e,t){for(let n=t.directiveStart,s=t.directiveEnd;n<s;n++){let r=e.data[n].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:A,ngAfterViewInit:F,ngAfterViewChecked:$,ngOnDestroy:K}=r;w&&(e.contentHooks??=[]).push(-n,w),A&&((e.contentHooks??=[]).push(n,A),(e.contentCheckHooks??=[]).push(n,A)),F&&(e.viewHooks??=[]).push(-n,F),$&&((e.viewHooks??=[]).push(n,$),(e.viewCheckHooks??=[]).push(n,$)),K!=null&&(e.destroyHooks??=[]).push(n,K)}}function D1(e,t,n){BL(e,t,3,n)}function O1(e,t,n,s){(e[mi]&3)===n&&BL(e,t,n,s)}function NT(e,t){let n=e[mi];(n&3)===t&&(n&=16383,n+=1,e[mi]=n)}function BL(e,t,n,s){let h=s!==void 0?e[pg]&65535:0,r=s??-1,w=t.length-1,A=0;for(let F=h;F<w;F++)if(typeof t[F+1]=="number"){if(A=t[F],s!=null&&A>=s)break}else t[F]<0&&(e[pg]+=65536),(A<r||r==-1)&&(aH(e,n,t,F),e[pg]=(e[pg]&4294901760)+F+2),F++}function lk(e,t){bu(4,e,t);let n=ir(null);try{t.call(e)}finally{ir(n),bu(5,e,t)}}function aH(e,t,n,s){let h=n[s]<0,r=n[s+1],w=h?-n[s]:n[s],A=e[w];h?e[mi]>>14<e[pg]>>16&&(e[mi]&3)===t&&(e[mi]+=16384,lk(A,r)):lk(A,r)}var yg=-1,$y=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(t,n,s){this.factory=t,this.canSeeViewProviders=n,this.injectImpl=s}};function lH(e){return e instanceof $y}function cH(e){return(e.flags&8)!==0}function uH(e){return(e.flags&16)!==0}function oE(e,t,n){let s=0;for(;s<n.length;){let h=n[s];if(typeof h=="number"){if(h!==0)break;s++;let r=n[s++],w=n[s++],A=n[s++];e.setAttribute(t,w,A,r)}else{let r=h,w=n[++s];hH(r)?e.setProperty(t,r,w):e.setAttribute(t,r,w),s++}}return s}function VL(e){return e===3||e===4||e===6}function hH(e){return e.charCodeAt(0)===64}function _S(e,t){if(!(t===null||t.length===0))if(e===null||e.length===0)e=t.slice();else{let n=-1;for(let s=0;s<t.length;s++){let h=t[s];typeof h=="number"?n=h:n===0||(n===-1||n===2?ck(e,n,h,null,t[++s]):ck(e,n,h,null,null))}}return e}function ck(e,t,n,s,h){let r=0,w=e.length;if(t===-1)w=-1;else for(;r<e.length;){let A=e[r++];if(typeof A=="number"){if(A===t){w=-1;break}else if(A>t){w=r-1;break}}}for(;r<e.length;){let A=e[r];if(typeof A=="number")break;if(A===n){if(s===null){h!==null&&(e[r+1]=h);return}else if(s===e[r+1]){e[r+2]=h;return}}r++,s!==null&&r++,h!==null&&r++}w!==-1&&(e.splice(w,0,t),r=w+1),e.splice(r++,0,n),s!==null&&e.splice(r++,0,s),h!==null&&e.splice(r++,0,h)}var zT={},sE=class{injector;parentInjector;constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,s){s=hb(s);let h=this.injector.get(t,zT,s);return h!==zT||n===zT?h:this.parentInjector.get(t,n,s)}};function jL(e){return e!==yg}function U1(e){return e&32767}function dH(e){return e>>16}function H1(e,t){let n=dH(e),s=t;for(;n>0;)s=s[Sg],n--;return s}var aE=!0;function $1(e){let t=aE;return aE=e,t}var fH=256,UL=fH-1,HL=5,pH=0,wu={};function mH(e,t,n){let s;typeof n=="string"?s=n.charCodeAt(0)||0:n.hasOwnProperty(Ny)&&(s=n[Ny]),s==null&&(s=n[Ny]=pH++);let h=s&UL,r=1<<h;t.data[e+(h>>HL)]|=r}function $L(e,t){let n=GL(e,t);if(n!==-1)return n;let s=t[wi];s.firstCreatePass&&(e.injectorIndex=t.length,BT(s.data,e),BT(t,null),BT(s.blueprint,null));let h=yS(e,t),r=e.injectorIndex;if(jL(h)){let w=U1(h),A=H1(h,t),F=A[wi].data;for(let $=0;$<8;$++)t[r+$]=A[w+$]|F[w+$]}return t[r+8]=h,r}function BT(e,t){e.push(0,0,0,0,0,0,0,0,t)}function GL(e,t){return e.injectorIndex===-1||e.parent&&e.parent.injectorIndex===e.injectorIndex||t[e.injectorIndex+8]===null?-1:e.injectorIndex}function yS(e,t){if(e.parent&&e.parent.injectorIndex!==-1)return e.parent.injectorIndex;let n=0,s=null,h=t;for(;h!==null;){if(s=XL(h),s===null)return yg;if(n++,h=h[Sg],s.injectorIndex!==-1)return s.injectorIndex|n<<16}return yg}function gH(e,t,n){mH(e,t,n)}function _H(e,t){if(t==="class")return e.classes;if(t==="style")return e.styles;let n=e.attrs;if(n){let s=n.length,h=0;for(;h<s;){let r=n[h];if(VL(r))break;if(r===0)h=h+2;else if(typeof r=="number")for(h++;h<s&&typeof n[h]=="string";)h++;else{if(r===t)return n[h+1];h=h+2}}}return null}function qL(e,t,n){if(n&Zi.Optional||e!==void 0)return e;iS(t,"NodeInjector")}function ZL(e,t,n,s){if(n&Zi.Optional&&s===void 0&&(s=null),!(n&(Zi.Self|Zi.Host))){let h=e[xg],r=Ha(void 0);try{return h?h.get(t,s,n&Zi.Optional):tL(t,s,n&Zi.Optional)}finally{Ha(r)}}return qL(s,t,n)}function WL(e,t,n,s=Zi.Default,h){if(e!==null){if(t[mi]&2048&&!(s&Zi.Self)){let w=bH(e,t,n,s,wu);if(w!==wu)return w}let r=YL(e,t,n,s,wu);if(r!==wu)return r}return ZL(t,n,s,h)}function YL(e,t,n,s,h){let r=vH(n);if(typeof r=="function"){if(!AL(t,e,s))return s&Zi.Host?qL(h,n,s):ZL(t,n,s,h);try{let w;if(w=r(s),w==null&&!(s&Zi.Optional))iS(n);else return w}finally{FL()}}else if(typeof r=="number"){let w=null,A=GL(e,t),F=yg,$=s&Zi.Host?t[Rc][kc]:null;for((A===-1||s&Zi.SkipSelf)&&(F=A===-1?yS(e,t):t[A+8],F===yg||!hk(s,!1)?A=-1:(w=t[wi],A=U1(F),t=H1(F,t)));A!==-1;){let K=t[wi];if(uk(r,A,K.data)){let se=yH(A,t,n,w,s,$);if(se!==wu)return se}F=t[A+8],F!==yg&&hk(s,t[wi].data[A+8]===$)&&uk(r,A,t)?(w=K,A=U1(F),t=H1(F,t)):A=-1}}return h}function yH(e,t,n,s,h,r){let w=t[wi],A=w.data[e+8],F=s==null?mb(A)&&aE:s!=w&&(A.type&3)!==0,$=h&Zi.Host&&r===A,K=A1(A,w,n,F,$);return K!==null?wg(t,w,K,A):wu}function A1(e,t,n,s,h){let r=e.providerIndexes,w=t.data,A=r&1048575,F=e.directiveStart,$=e.directiveEnd,K=r>>20,se=s?A:A+K,le=h?A+K:$;for(let ae=se;ae<le;ae++){let Ze=w[ae];if(ae<F&&n===Ze||ae>=F&&Ze.type===n)return ae}if(h){let ae=w[F];if(ae&&e0(ae)&&ae.type===n)return F}return null}function wg(e,t,n,s){let h=e[n],r=t.data;if(lH(h)){let w=h;w.resolving&&s7(o7(r[n]));let A=$1(w.canSeeViewProviders);w.resolving=!0;let F,$=w.injectImpl?Ha(w.injectImpl):null,K=AL(e,s,Zi.Default);try{h=e[n]=w.factory(void 0,r,e,s),t.firstCreatePass&&n>=s.directiveStart&&sH(n,r[n],t)}finally{$!==null&&Ha($),$1(A),w.resolving=!1,FL()}}return h}function vH(e){if(typeof e=="string")return e.charCodeAt(0)||0;let t=e.hasOwnProperty(Ny)?e[Ny]:void 0;return typeof t=="number"?t>=0?t&UL:xH:t}function uk(e,t,n){let s=1<<e;return!!(n[t+(e>>HL)]&s)}function hk(e,t){return!(e&Zi.Self)&&!(e&Zi.Host&&t)}var ap=class{_tNode;_lView;constructor(t,n){this._tNode=t,this._lView=n}get(t,n,s){return WL(this._tNode,this._lView,t,hb(s),n)}};function xH(){return new ap(Ma(),pr())}function bb(e){return Ky(()=>{let t=e.prototype.constructor,n=t[k1]||lE(t),s=Object.prototype,h=Object.getPrototypeOf(e.prototype).constructor;for(;h&&h!==s;){let r=h[k1]||lE(h);if(r&&r!==n)return r;h=Object.getPrototypeOf(h)}return r=>new r})}function lE(e){return Yk(e)?()=>{let t=lE($l(e));return t&&t()}:cp(e)}function bH(e,t,n,s,h){let r=e,w=t;for(;r!==null&&w!==null&&w[mi]&2048&&!(w[mi]&512);){let A=YL(r,w,n,s|Zi.Self,wu);if(A!==wu)return A;let F=r.parent;if(!F){let $=w[pL];if($){let K=$.get(n,wu,s);if(K!==wu)return K}F=XL(w),w=w[Sg]}r=F}return h}function XL(e){let t=e[wi],n=t.type;return n===2?t.declTNode:n===1?e[kc]:null}function vS(e){return _H(Ma(),e)}function dk(e,t=null,n=null,s){let h=KL(e,t,n,s);return h.resolveInjectorInitializers(),h}function KL(e,t=null,n=null,s,h=new Set){let r=[n||Gl,b7(e)];return s=s||(typeof e=="object"?void 0:ya(e)),new jy(r,t||aS(),s||null,h)}var ba=class e{static THROW_IF_NOT_FOUND=By;static NULL=new N1;static create(t,n){if(Array.isArray(t))return dk({name:""},n,t,"");{let s=t.name??"";return dk({name:s},t.parent,t.providers,s)}}static \u0275prov=wn({token:e,providedIn:"any",factory:()=>Bn(rL)});static __NG_ELEMENT_ID__=-1};var wH=new Hn("");wH.__NG_ELEMENT_ID__=e=>{let t=Ma();if(t===null)throw new Un(204,!1);if(t.type&2)return t.value;if(e&Zi.Optional)return null;throw new Un(204,!1)};var JL=!1,i0=(()=>{class e{static __NG_ELEMENT_ID__=CH;static __NG_ENV_ID__=n=>n}return e})(),G1=class extends i0{_lView;constructor(t){super(),this._lView=t}onDestroy(t){return ML(this._lView,t),()=>j7(this._lView,t)}};function CH(){return new G1(pr())}var mp=class{},xS=new Hn("",{providedIn:"root",factory:()=>!1});var QL=new Hn(""),e3=new Hn(""),Su=(()=>{class e{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new po(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let n=this.taskId++;return this.pendingTasks.add(n),n}has(n){return this.pendingTasks.has(n)}remove(n){this.pendingTasks.delete(n),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=wn({token:e,providedIn:"root",factory:()=>new e})}return e})();var cE=class extends Ii{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(t=!1){super(),this.__isAsync=t,fL()&&(this.destroyRef=Qt(i0,{optional:!0})??void 0,this.pendingTasks=Qt(Su,{optional:!0})??void 0)}emit(t){let n=ir(null);try{super.next(t)}finally{ir(n)}}subscribe(t,n,s){let h=t,r=n||(()=>null),w=s;if(t&&typeof t=="object"){let F=t;h=F.next?.bind(F),r=F.error?.bind(F),w=F.complete?.bind(F)}this.__isAsync&&(r=this.wrapInTimeout(r),h&&(h=this.wrapInTimeout(h)),w&&(w=this.wrapInTimeout(w)));let A=super.subscribe({next:h,error:r,complete:w});return t instanceof to&&t.add(A),A}wrapInTimeout(t){return n=>{let s=this.pendingTasks?.add();setTimeout(()=>{t(n),s!==void 0&&this.pendingTasks?.remove(s)})}}},go=cE;function Gy(...e){}function t3(e){let t,n;function s(){e=Gy;try{n!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(n),t!==void 0&&clearTimeout(t)}catch{}}return t=setTimeout(()=>{e(),s()}),typeof requestAnimationFrame=="function"&&(n=requestAnimationFrame(()=>{e(),s()})),()=>s()}function fk(e){return queueMicrotask(()=>e()),()=>{e=Gy}}var bS="isAngularZone",q1=bS+"_ID",MH=0,$r=class e{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new go(!1);onMicrotaskEmpty=new go(!1);onStable=new go(!1);onError=new go(!1);constructor(t){let{enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:h=!1,scheduleInRootZone:r=JL}=t;if(typeof Zone>"u")throw new Un(908,!1);Zone.assertZonePatched();let w=this;w._nesting=0,w._outer=w._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(w._inner=w._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(w._inner=w._inner.fork(Zone.longStackTraceZoneSpec)),w.shouldCoalesceEventChangeDetection=!h&&s,w.shouldCoalesceRunChangeDetection=h,w.callbackScheduled=!1,w.scheduleInRootZone=r,SH(w)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(bS)===!0}static assertInAngularZone(){if(!e.isInAngularZone())throw new Un(909,!1)}static assertNotInAngularZone(){if(e.isInAngularZone())throw new Un(909,!1)}run(t,n,s){return this._inner.run(t,n,s)}runTask(t,n,s,h){let r=this._inner,w=r.scheduleEventTask("NgZoneEvent: "+h,t,TH,Gy,Gy);try{return r.runTask(w,n,s)}finally{r.cancelTask(w)}}runGuarded(t,n,s){return this._inner.runGuarded(t,n,s)}runOutsideAngular(t){return this._outer.run(t)}},TH={};function wS(e){if(e._nesting==0&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function EH(e){if(e.isCheckStableRunning||e.callbackScheduled)return;e.callbackScheduled=!0;function t(){t3(()=>{e.callbackScheduled=!1,uE(e),e.isCheckStableRunning=!0,wS(e),e.isCheckStableRunning=!1})}e.scheduleInRootZone?Zone.root.run(()=>{t()}):e._outer.run(()=>{t()}),uE(e)}function SH(e){let t=()=>{EH(e)},n=MH++;e._inner=e._inner.fork({name:"angular",properties:{[bS]:!0,[q1]:n,[q1+n]:!0},onInvokeTask:(s,h,r,w,A,F)=>{if(IH(F))return s.invokeTask(r,w,A,F);try{return pk(e),s.invokeTask(r,w,A,F)}finally{(e.shouldCoalesceEventChangeDetection&&w.type==="eventTask"||e.shouldCoalesceRunChangeDetection)&&t(),mk(e)}},onInvoke:(s,h,r,w,A,F,$)=>{try{return pk(e),s.invoke(r,w,A,F,$)}finally{e.shouldCoalesceRunChangeDetection&&!e.callbackScheduled&&!PH(F)&&t(),mk(e)}},onHasTask:(s,h,r,w)=>{s.hasTask(r,w),h===r&&(w.change=="microTask"?(e._hasPendingMicrotasks=w.microTask,uE(e),wS(e)):w.change=="macroTask"&&(e.hasPendingMacrotasks=w.macroTask))},onHandleError:(s,h,r,w)=>(s.handleError(r,w),e.runOutsideAngular(()=>e.onError.emit(w)),!1)})}function uE(e){e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&e.callbackScheduled===!0?e.hasPendingMicrotasks=!0:e.hasPendingMicrotasks=!1}function pk(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function mk(e){e._nesting--,wS(e)}var Z1=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new go;onMicrotaskEmpty=new go;onStable=new go;onError=new go;run(t,n,s){return t.apply(n,s)}runGuarded(t,n,s){return t.apply(n,s)}runOutsideAngular(t){return t()}runTask(t,n,s,h){return t.apply(n,s)}};function IH(e){return n3(e,"__ignore_ng_zone__")}function PH(e){return n3(e,"__scheduler_tick__")}function n3(e,t){return!Array.isArray(e)||e.length!==1?!1:e[0]?.data?.[t]===!0}function DH(e="zone.js",t){return e==="noop"?new Z1:e==="zone.js"?new $r(t):e}var Mu=class{_console=console;handleError(t){this._console.error("ERROR",t)}},OH=new Hn("",{providedIn:"root",factory:()=>{let e=Qt($r),t=Qt(Mu);return n=>e.runOutsideAngular(()=>t.handleError(n))}});function gk(e,t){return Zk(e,t)}function AH(e){return Zk(qk,e)}var i3=(gk.required=AH,gk);function RH(){return Ig(Ma(),pr())}function Ig(e,t){return new Po(Zl(e,t))}var Po=(()=>{class e{nativeElement;constructor(n){this.nativeElement=n}static __NG_ELEMENT_ID__=RH}return e})();function kH(e){return e instanceof Po?e.nativeElement:e}function LH(){return this._results[Symbol.iterator]()}var hE=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new Ii}constructor(t=!1){this._emitDistinctChangesOnly=t}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){this.dirty=!1;let s=_7(t);(this._changesDetected=!g7(this._results,s,n))&&(this._results=s,this.length=s.length,this.last=s[this.length-1],this.first=s[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=LH};function r3(e){return(e.flags&128)===128}var o3=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(o3||{}),CS=new Map,FH=0;function NH(){return FH++}function zH(e){CS.set(e[Qy],e)}function s3(e){return CS.get(e)||null}function dE(e){CS.delete(e[Qy])}var fE=class{lViewId;nodeIndex;native;component;directives;localRefs;get lView(){return s3(this.lViewId)}constructor(t,n,s){this.lViewId=t,this.nodeIndex=n,this.native=s}};function a3(e){let t=VT(e);if(t){if(_h(t)){let n=t,s,h,r;if(l3(e)){if(s=jH(n,e),s==-1)throw new Error("The provided component was not found in the application");h=e}else if(BH(e)){if(s=UH(n,e),s==-1)throw new Error("The provided directive was not found in the application");r=HH(s,n)}else if(s=yk(n,e),s==-1)return null;let w=xl(n[s]),A=VT(w),F=A&&!Array.isArray(A)?A:_k(n,s,w);if(h&&F.component===void 0&&(F.component=h,ql(F.component,F)),r&&F.directives===void 0){F.directives=r;for(let $=0;$<r.length;$++)ql(r[$],F)}ql(F.native,F),t=F}}else{let n=e,s=n;for(;s=s.parentNode;){let h=VT(s);if(h){let r=Array.isArray(h)?h:h.lView;if(!r)return null;let w=yk(r,n);if(w>=0){let A=xl(r[w]),F=_k(r,w,A);ql(A,F),t=F;break}}}}return t||null}function _k(e,t,n){return new fE(e[Qy],t,n)}var pE="__ngContext__";function ql(e,t){_h(t)?(e[pE]=t[Qy],zH(t)):e[pE]=t}function VT(e){let t=e[pE];return typeof t=="number"?s3(t):t||null}function l3(e){return e&&e.constructor&&e.constructor.\u0275cmp}function BH(e){return e&&e.constructor&&e.constructor.\u0275dir}function yk(e,t){let n=e[wi];for(let s=vs;s<n.bindingStartIndex;s++)if(xl(e[s])===t)return s;return-1}function VH(e){if(e.child)return e.child;if(e.next)return e.next;for(;e.parent&&!e.parent.next;)e=e.parent;return e.parent&&e.parent.next}function jH(e,t){let n=e[wi].components;if(n)for(let s=0;s<n.length;s++){let h=n[s];if(Cu(h,e)[_s]===t)return h}else if(Cu(vs,e)[_s]===t)return vs;return-1}function UH(e,t){let n=e[wi].firstChild;for(;n;){let s=n.directiveStart,h=n.directiveEnd;for(let r=s;r<h;r++)if(e[r]===t)return n.index;n=VH(n)}return-1}function HH(e,t){let n=t[wi].data[e];if(n.directiveStart===0)return Gl;let s=[];for(let h=n.directiveStart;h<n.directiveEnd;h++){let r=t[h];l3(r)||s.push(r)}return s}function c3(e){return h3(e[Hy])}function u3(e){return h3(e[Ac])}function h3(e){for(;e!==null&&!Mh(e);)e=e[Ac];return e}var mE;function d3(e){mE=e}function f3(){if(mE!==void 0)return mE;if(typeof document<"u")return document;throw new Un(210,!1)}var MS=new Hn("",{providedIn:"root",factory:()=>$H}),$H="ng",TS=new Hn(""),Th=new Hn("",{providedIn:"platform",factory:()=>"unknown"});var ES=new Hn("",{providedIn:"root",factory:()=>f3().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var GH="h",qH="b";var p3=!1,ZH=new Hn("",{providedIn:"root",factory:()=>p3});var SS=function(e){return e[e.CHANGE_DETECTION=0]="CHANGE_DETECTION",e[e.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",e}(SS||{}),wb=new Hn(""),vk=new Set;function Iu(e){vk.has(e)||(vk.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}var mg=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(mg||{}),m3=(()=>{class e{impl=null;execute(){this.impl?.execute()}static \u0275prov=wn({token:e,providedIn:"root",factory:()=>new e})}return e})(),WH=[mg.EarlyRead,mg.Write,mg.MixedReadWrite,mg.Read],YH=(()=>{class e{ngZone=Qt($r);scheduler=Qt(mp);errorHandler=Qt(Mu,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){Qt(wb,{optional:!0})}execute(){this.executing=!0;for(let n of WH)for(let s of this.sequences)if(!(s.erroredOrDestroyed||!s.hooks[n]))try{s.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>s.hooks[n](s.pipelinedValue),s.snapshot))}catch(h){s.erroredOrDestroyed=!0,this.errorHandler?.handleError(h)}this.executing=!1;for(let n of this.sequences)n.afterRun(),n.once&&(this.sequences.delete(n),n.destroy());for(let n of this.deferredRegistrations)this.sequences.add(n);this.deferredRegistrations.size>0&&this.scheduler.notify(8),this.deferredRegistrations.clear()}register(n){this.executing?this.deferredRegistrations.add(n):(this.sequences.add(n),this.scheduler.notify(7))}unregister(n){this.executing&&this.sequences.has(n)?(n.erroredOrDestroyed=!0,n.pipelinedValue=void 0,n.once=!0):(this.sequences.delete(n),this.deferredRegistrations.delete(n))}maybeTrace(n,s){return s?s.run(SS.AFTER_NEXT_RENDER,n):n()}static \u0275prov=wn({token:e,providedIn:"root",factory:()=>new e})}return e})(),gE=class{impl;hooks;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(t,n,s,h,r=null){this.impl=t,this.hooks=n,this.once=s,this.snapshot=r,this.unregisterOnDestroy=h?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.()}};function IS(e,t){!t?.injector&&lS(IS);let n=t?.injector??Qt(ba);return Iu("NgAfterNextRender"),KH(e,n,t,!0)}function XH(e,t){if(e instanceof Function){let n=[void 0,void 0,void 0,void 0];return n[t]=e,n}else return[e.earlyRead,e.write,e.mixedReadWrite,e.read]}function KH(e,t,n,s){let h=t.get(m3);h.impl??=t.get(YH);let r=t.get(wb,null,{optional:!0}),w=n?.phase??mg.MixedReadWrite,A=n?.manualCleanup!==!0?t.get(i0):null,F=new gE(h.impl,XH(e,w),s,A,r?.snapshot(null));return h.impl.register(F),F}var JH=()=>null;function PS(e,t,n=!1){return JH(e,t,n)}var Tu=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Tu||{}),C1;function QH(){if(C1===void 0&&(C1=null,va.trustedTypes))try{C1=va.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return C1}function Cb(e){return QH()?.createHTML(e)||e}var M1;function g3(){if(M1===void 0&&(M1=null,va.trustedTypes))try{M1=va.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return M1}function xk(e){return g3()?.createHTML(e)||e}function bk(e){return g3()?.createScriptURL(e)||e}var xh=class{changingThisBreaksApplicationSecurity;constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Gk})`}},_E=class extends xh{getTypeName(){return"HTML"}},yE=class extends xh{getTypeName(){return"Style"}},vE=class extends xh{getTypeName(){return"Script"}},xE=class extends xh{getTypeName(){return"URL"}},bE=class extends xh{getTypeName(){return"ResourceURL"}};function Lc(e){return e instanceof xh?e.changingThisBreaksApplicationSecurity:e}function Eh(e,t){let n=e$(e);if(n!=null&&n!==t){if(n==="ResourceURL"&&t==="URL")return!0;throw new Error(`Required a safe ${t}, got a ${n} (see ${Gk})`)}return n===t}function e$(e){return e instanceof xh&&e.getTypeName()||null}function _3(e){return new _E(e)}function y3(e){return new yE(e)}function v3(e){return new vE(e)}function x3(e){return new xE(e)}function b3(e){return new bE(e)}function t$(e){let t=new CE(e);return n$()?new wE(t):t}var wE=class{inertDocumentHelper;constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{let n=new window.DOMParser().parseFromString(Cb(t),"text/html").body;return n===null?this.inertDocumentHelper.getInertBodyElement(t):(n.firstChild?.remove(),n)}catch{return null}}},CE=class{defaultDoc;inertDocument;constructor(t){this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(t){let n=this.inertDocument.createElement("template");return n.innerHTML=Cb(t),n}};function n$(){try{return!!new window.DOMParser().parseFromString(Cb(""),"text/html")}catch{return!1}}var i$=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Mb(e){return e=String(e),e.match(i$)?e:"unsafe:"+e}function Sh(e){let t={};for(let n of e.split(","))t[n]=!0;return t}function r0(...e){let t={};for(let n of e)for(let s in n)n.hasOwnProperty(s)&&(t[s]=!0);return t}var w3=Sh("area,br,col,hr,img,wbr"),C3=Sh("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),M3=Sh("rp,rt"),r$=r0(M3,C3),o$=r0(C3,Sh("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),s$=r0(M3,Sh("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),wk=r0(w3,o$,s$,r$),T3=Sh("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),a$=Sh("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),l$=Sh("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),c$=r0(T3,a$,l$),u$=Sh("script,style,template"),ME=class{sanitizedSomething=!1;buf=[];sanitizeChildren(t){let n=t.firstChild,s=!0,h=[];for(;n;){if(n.nodeType===Node.ELEMENT_NODE?s=this.startElement(n):n.nodeType===Node.TEXT_NODE?this.chars(n.nodeValue):this.sanitizedSomething=!0,s&&n.firstChild){h.push(n),n=f$(n);continue}for(;n;){n.nodeType===Node.ELEMENT_NODE&&this.endElement(n);let r=d$(n);if(r){n=r;break}n=h.pop()}}return this.buf.join("")}startElement(t){let n=Ck(t).toLowerCase();if(!wk.hasOwnProperty(n))return this.sanitizedSomething=!0,!u$.hasOwnProperty(n);this.buf.push("<"),this.buf.push(n);let s=t.attributes;for(let h=0;h<s.length;h++){let r=s.item(h),w=r.name,A=w.toLowerCase();if(!c$.hasOwnProperty(A)){this.sanitizedSomething=!0;continue}let F=r.value;T3[A]&&(F=Mb(F)),this.buf.push(" ",w,'="',Mk(F),'"')}return this.buf.push(">"),!0}endElement(t){let n=Ck(t).toLowerCase();wk.hasOwnProperty(n)&&!w3.hasOwnProperty(n)&&(this.buf.push("</"),this.buf.push(n),this.buf.push(">"))}chars(t){this.buf.push(Mk(t))}};function h$(e,t){return(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function d$(e){let t=e.nextSibling;if(t&&e!==t.previousSibling)throw E3(t);return t}function f$(e){let t=e.firstChild;if(t&&h$(e,t))throw E3(t);return t}function Ck(e){let t=e.nodeName;return typeof t=="string"?t:"FORM"}function E3(e){return new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`)}var p$=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,m$=/([^\#-~ |!])/g;function Mk(e){return e.replace(/&/g,"&amp;").replace(p$,function(t){let n=t.charCodeAt(0),s=t.charCodeAt(1);return"&#"+((n-55296)*1024+(s-56320)+65536)+";"}).replace(m$,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var T1;function DS(e,t){let n=null;try{T1=T1||t$(e);let s=t?String(t):"";n=T1.getInertBodyElement(s);let h=5,r=s;do{if(h===0)throw new Error("Failed to sanitize html because the input is unstable");h--,s=r,r=n.innerHTML,n=T1.getInertBodyElement(s)}while(s!==r);let A=new ME().sanitizeChildren(Tk(n)||n);return Cb(A)}finally{if(n){let s=Tk(n)||n;for(;s.firstChild;)s.firstChild.remove()}}}function Tk(e){return"content"in e&&g$(e)?e.content:null}function g$(e){return e.nodeType===Node.ELEMENT_NODE&&e.nodeName==="TEMPLATE"}var Fc=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Fc||{});function Wo(e){let t=AS();return t?xk(t.sanitize(Fc.HTML,e)||""):Eh(e,"HTML")?xk(Lc(e)):DS(f3(),lp(e))}function jo(e){let t=AS();return t?t.sanitize(Fc.URL,e)||"":Eh(e,"URL")?Lc(e):Mb(lp(e))}function OS(e){let t=AS();if(t)return bk(t.sanitize(Fc.RESOURCE_URL,e)||"");if(Eh(e,"ResourceURL"))return bk(Lc(e));throw new Un(904,!1)}function _$(e,t){return t==="src"&&(e==="embed"||e==="frame"||e==="iframe"||e==="media"||e==="script")||t==="href"&&(e==="base"||e==="link")?OS:jo}function S3(e,t,n){return _$(t,n)(e)}function AS(){let e=pr();return e&&e[yh].sanitizer}var y$=/^>|^->|<!--|-->|--!>|<!-$/g,v$=/(<|>)/g,x$="\u200B$1\u200B";function b$(e){return e.replace(y$,t=>t.replace(v$,x$))}function I3(e){return e instanceof Function?e():e}var Bd=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(Bd||{}),bh=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(bh||{}),w$;function RS(e,t){return w$(e,t)}function gg(e,t,n,s,h){if(s!=null){let r,w=!1;Mh(s)?r=s:_h(s)&&(w=!0,s=s[Ch]);let A=xl(s);e===0&&n!==null?h==null?A3(t,n,A):W1(t,n,A,h||null,!0):e===1&&n!==null?W1(t,n,A,h||null,!0):e===2?z$(t,A,w):e===3&&t.destroyNode(A),r!=null&&V$(t,e,r,n,h)}}function C$(e,t){return e.createText(t)}function M$(e,t,n){e.setValue(t,n)}function T$(e,t){return e.createComment(b$(t))}function P3(e,t,n){return e.createElement(t,n)}function E$(e,t){D3(e,t),t[Ch]=null,t[kc]=null}function S$(e,t,n,s,h,r){s[Ch]=h,s[kc]=t,Sb(e,s,n,1,h,r)}function D3(e,t){t[yh].changeDetectionScheduler?.notify(10),Sb(e,t,t[ys],2,null,null)}function I$(e){let t=e[Hy];if(!t)return jT(e[wi],e);for(;t;){let n=null;if(_h(t))n=t[Hy];else{let s=t[ea];s&&(n=s)}if(!n){for(;t&&!t[Ac]&&t!==e;)_h(t)&&jT(t[wi],t),t=t[ta];t===null&&(t=e),_h(t)&&jT(t[wi],t),n=t&&t[Ac]}t=n}}function P$(e,t,n,s){let h=ea+s,r=n.length;s>0&&(n[h-1][Ac]=t),s<r-ea?(t[Ac]=n[h],iL(n,ea+s,t)):(n.push(t),t[Ac]=null),t[ta]=n;let w=t[up];w!==null&&n!==w&&O3(w,t);let A=t[vh];A!==null&&A.insertView(e),nE(t),t[mi]|=128}function O3(e,t){let n=e[bg],s=t[ta];if(_h(s))e[mi]|=V1.HasTransplantedViews;else{let h=s[ta][Rc];t[Rc]!==h&&(e[mi]|=V1.HasTransplantedViews)}n===null?e[bg]=[t]:n.push(t)}function kS(e,t){let n=e[bg],s=n.indexOf(t);n.splice(s,1)}function qy(e,t){if(e.length<=ea)return;let n=ea+t,s=e[n];if(s){let h=s[up];h!==null&&h!==e&&kS(h,s),t>0&&(e[n-1][Ac]=s[Ac]);let r=F1(e,ea+t);E$(s[wi],s);let w=r[vh];w!==null&&w.detachView(r[wi]),s[ta]=null,s[Ac]=null,s[mi]&=-129}return s}function Tb(e,t){if(!(t[mi]&256)){let n=t[ys];n.destroyNode&&Sb(e,t,n,3,null,null),I$(t)}}function jT(e,t){if(t[mi]&256)return;let n=ir(null);try{t[mi]&=-129,t[mi]|=256,t[vl]&&Km(t[vl]),O$(e,t),D$(e,t),t[wi].type===1&&t[ys].destroy();let s=t[up];if(s!==null&&Mh(t[ta])){s!==t[ta]&&kS(s,t);let h=t[vh];h!==null&&h.detachView(e)}dE(t)}finally{ir(n)}}function D$(e,t){let n=e.cleanup,s=t[z1];if(n!==null)for(let w=0;w<n.length-1;w+=2)if(typeof n[w]=="string"){let A=n[w+3];A>=0?s[A]():s[-A].unsubscribe(),w+=2}else{let A=s[n[w+1]];n[w].call(A)}s!==null&&(t[z1]=null);let h=t[Fd];if(h!==null){t[Fd]=null;for(let w=0;w<h.length;w++){let A=h[w];A()}}let r=t[hp];if(r!==null){t[hp]=null;for(let w of r)w.destroy()}}function O$(e,t){let n;if(e!=null&&(n=e.destroyHooks)!=null)for(let s=0;s<n.length;s+=2){let h=t[n[s]];if(!(h instanceof $y)){let r=n[s+1];if(Array.isArray(r))for(let w=0;w<r.length;w+=2){let A=h[r[w]],F=r[w+1];bu(4,A,F);try{F.call(A)}finally{bu(5,A,F)}}else{bu(4,h,r);try{r.call(h)}finally{bu(5,h,r)}}}}}function A$(e,t,n){return R$(e,t.parent,n)}function R$(e,t,n){let s=t;for(;s!==null&&s.type&168;)t=s,s=t.parent;if(s===null)return n[Ch];{let{componentOffset:h}=s;if(h>-1){let{encapsulation:r}=e.data[s.directiveStart+h];if(r===Tu.None||r===Tu.Emulated)return null}return Zl(s,n)}}function W1(e,t,n,s,h){e.insertBefore(t,n,s,h)}function A3(e,t,n){e.appendChild(t,n)}function Ek(e,t,n,s,h){s!==null?W1(e,t,n,s,h):A3(e,t,n)}function R3(e,t){return e.parentNode(t)}function k$(e,t){return e.nextSibling(t)}function L$(e,t,n){return N$(e,t,n)}function F$(e,t,n){return e.type&40?Zl(e,n):null}var N$=F$,Sk;function Eb(e,t,n,s){let h=A$(e,s,t),r=t[ys],w=s.parent||t[kc],A=L$(w,s,t);if(h!=null)if(Array.isArray(n))for(let F=0;F<n.length;F++)Ek(r,h,n[F],A,!1);else Ek(r,h,n,A,!1);Sk!==void 0&&Sk(r,s,t,n,h)}function Fy(e,t){if(t!==null){let n=t.type;if(n&3)return Zl(t,e);if(n&4)return TE(-1,e[t.index]);if(n&8){let s=t.child;if(s!==null)return Fy(e,s);{let h=e[t.index];return Mh(h)?TE(-1,h):xl(h)}}else{if(n&128)return Fy(e,t.next);if(n&32)return RS(t,e)()||xl(e[t.index]);{let s=k3(e,t);if(s!==null){if(Array.isArray(s))return s[0];let h=fp(e[Rc]);return Fy(h,s)}else return Fy(e,t.next)}}}return null}function k3(e,t){if(t!==null){let s=e[Rc][kc],h=t.projection;return s.projection[h]}return null}function TE(e,t){let n=ea+e+1;if(n<t.length){let s=t[n],h=s[wi].firstChild;if(h!==null)return Fy(s,h)}return t[dp]}function z$(e,t,n){e.removeChild(null,t,n)}function LS(e,t,n,s,h,r,w){for(;n!=null;){if(n.type===128){n=n.next;continue}let A=s[n.index],F=n.type;if(w&&t===0&&(A&&ql(xl(A),s),n.flags|=2),(n.flags&32)!==32)if(F&8)LS(e,t,n.child,s,h,r,!1),gg(t,e,h,A,r);else if(F&32){let $=RS(n,s),K;for(;K=$();)gg(t,e,h,K,r);gg(t,e,h,A,r)}else F&16?B$(e,t,s,n,h,r):gg(t,e,h,A,r);n=w?n.projectionNext:n.next}}function Sb(e,t,n,s,h,r){LS(n,s,e.firstChild,t,h,r,!1)}function B$(e,t,n,s,h,r){let w=n[Rc],F=w[kc].projection[s.projection];if(Array.isArray(F))for(let $=0;$<F.length;$++){let K=F[$];gg(t,e,h,K,r)}else{let $=F,K=w[ta];r3(s)&&($.flags|=128),LS(e,t,$,K,h,r,!0)}}function V$(e,t,n,s,h){let r=n[dp],w=xl(n);r!==w&&gg(t,e,s,r,h);for(let A=ea;A<n.length;A++){let F=n[A];Sb(F[wi],F,e,t,s,r)}}function j$(e,t,n,s,h){if(t)h?e.addClass(n,s):e.removeClass(n,s);else{let r=s.indexOf("-")===-1?void 0:bh.DashCase;h==null?e.removeStyle(n,s,r):(typeof h=="string"&&h.endsWith("!important")&&(h=h.slice(0,-10),r|=bh.Important),e.setStyle(n,s,h,r))}}function U$(e,t,n){e.setAttribute(t,"style",n)}function L3(e,t,n){n===""?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function F3(e,t,n){let{mergedAttrs:s,classes:h,styles:r}=n;s!==null&&oE(e,t,s),h!==null&&L3(e,t,h),r!==null&&U$(e,t,r)}function H$(e,t,n){let s=e.length;for(;;){let h=e.indexOf(t,n);if(h===-1)return h;if(h===0||e.charCodeAt(h-1)<=32){let r=t.length;if(h+r===s||e.charCodeAt(h+r)<=32)return h}n=h+1}}var N3="ng-template";function $$(e,t,n,s){let h=0;if(s){for(;h<t.length&&typeof t[h]=="string";h+=2)if(t[h]==="class"&&H$(t[h+1].toLowerCase(),n,0)!==-1)return!0}else if(FS(e))return!1;if(h=t.indexOf(1,h),h>-1){let r;for(;++h<t.length&&typeof(r=t[h])=="string";)if(r.toLowerCase()===n)return!0}return!1}function FS(e){return e.type===4&&e.value!==N3}function G$(e,t,n){let s=e.type===4&&!n?N3:e.value;return t===s}function q$(e,t,n){let s=4,h=e.attrs,r=h!==null?Y$(h):0,w=!1;for(let A=0;A<t.length;A++){let F=t[A];if(typeof F=="number"){if(!w&&!Oc(s)&&!Oc(F))return!1;if(w&&Oc(F))continue;w=!1,s=F|s&1;continue}if(!w)if(s&4){if(s=2|s&1,F!==""&&!G$(e,F,n)||F===""&&t.length===1){if(Oc(s))return!1;w=!0}}else if(s&8){if(h===null||!$$(e,h,F,n)){if(Oc(s))return!1;w=!0}}else{let $=t[++A],K=Z$(F,h,FS(e),n);if(K===-1){if(Oc(s))return!1;w=!0;continue}if($!==""){let se;if(K>r?se="":se=h[K+1].toLowerCase(),s&2&&$!==se){if(Oc(s))return!1;w=!0}}}}return Oc(s)||w}function Oc(e){return(e&1)===0}function Z$(e,t,n,s){if(t===null)return-1;let h=0;if(s||!n){let r=!1;for(;h<t.length;){let w=t[h];if(w===e)return h;if(w===3||w===6)r=!0;else if(w===1||w===2){let A=t[++h];for(;typeof A=="string";)A=t[++h];continue}else{if(w===4)break;if(w===0){h+=4;continue}}h+=r?1:2}return-1}else return X$(t,e)}function W$(e,t,n=!1){for(let s=0;s<t.length;s++)if(q$(e,t[s],n))return!0;return!1}function Y$(e){for(let t=0;t<e.length;t++){let n=e[t];if(VL(n))return t}return e.length}function X$(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){let s=e[n];if(typeof s=="number")return-1;if(s===t)return n;n++}return-1}function Ik(e,t){return e?":not("+t.trim()+")":t}function K$(e){let t=e[0],n=1,s=2,h="",r=!1;for(;n<e.length;){let w=e[n];if(typeof w=="string")if(s&2){let A=e[++n];h+="["+w+(A.length>0?'="'+A+'"':"")+"]"}else s&8?h+="."+w:s&4&&(h+=" "+w);else h!==""&&!Oc(w)&&(t+=Ik(r,h),h=""),s=w,r=r||!Oc(s);n++}return h!==""&&(t+=Ik(r,h)),t}function J$(e){return e.map(K$).join(",")}function Q$(e){let t=[],n=[],s=1,h=2;for(;s<e.length;){let r=e[s];if(typeof r=="string")h===2?r!==""&&t.push(r,e[++s]):h===8&&n.push(r);else{if(!Oc(h))break;h=r}s++}return{attrs:t,classes:n}}var Pu={};function Qe(e=1){z3(Ca(),pr(),jd()+e,!1)}function z3(e,t,n,s){if(!s)if((t[mi]&3)===3){let r=e.preOrderCheckHooks;r!==null&&D1(t,r,n)}else{let r=e.preOrderHooks;r!==null&&O1(t,r,0,n)}pp(n)}function Fn(e,t=Zi.Default){let n=pr();if(n===null)return Bn(e,t);let s=Ma();return WL(s,n,$l(e),t)}function B3(){let e="invalid";throw new Error(e)}function V3(e,t,n,s,h,r){let w=ir(null);try{let A=null;h&Bd.SignalBased&&(A=t[s][_l]),A!==null&&A.transformFn!==void 0&&(r=A.transformFn(r)),h&Bd.HasDecoratorInputTransform&&(r=e.inputTransforms[s].call(t,r)),e.setInput!==null?e.setInput(t,A,r,n,s):gL(t,A,s,r)}finally{ir(w)}}function eG(e,t){let n=e.hostBindingOpCodes;if(n!==null)try{for(let s=0;s<n.length;s++){let h=n[s];if(h<0)pp(~h);else{let r=h,w=n[++s],A=n[++s];Q7(w,r);let F=t[r];A(2,F)}}}finally{pp(-1)}}function Ib(e,t,n,s,h,r,w,A,F,$,K){let se=t.blueprint.slice();return se[Ch]=h,se[mi]=s|4|128|8|64|1024,($!==null||e&&e[mi]&2048)&&(se[mi]|=2048),CL(se),se[ta]=se[Sg]=e,se[_s]=n,se[yh]=w||e&&e[yh],se[ys]=A||e&&e[ys],se[xg]=F||e&&e[xg]||null,se[kc]=r,se[Qy]=NH(),se[Uy]=K,se[pL]=$,se[Rc]=t.type==2?e[Rc]:se,se}function o0(e,t,n,s,h){let r=e.data[t];if(r===null)r=tG(e,t,n,s,h),J7()&&(r.flags|=32);else if(r.type&64){r.type=n,r.value=s,r.attrs=h;let w=W7();r.injectorIndex=w===null?-1:w.injectorIndex}return vp(r,!0),r}function tG(e,t,n,s,h){let r=EL(),w=fS(),A=w?r:r&&r.parent,F=e.data[t]=aG(e,A,n,t,s,h);return e.firstChild===null&&(e.firstChild=F),r!==null&&(w?r.child==null&&F.parent!==null&&(r.child=F):r.next===null&&(r.next=F,F.prev=r)),F}function j3(e,t,n,s){if(n===0)return-1;let h=t.length;for(let r=0;r<n;r++)t.push(s),e.blueprint.push(s),e.data.push(null);return h}function U3(e,t,n,s,h){let r=jd(),w=s&2;try{pp(-1),w&&t.length>vs&&z3(e,t,vs,!1),bu(w?2:0,h),n(s,h)}finally{pp(r),bu(w?3:1,h)}}function NS(e,t,n){if(cS(t)){let s=ir(null);try{let h=t.directiveStart,r=t.directiveEnd;for(let w=h;w<r;w++){let A=e.data[w];if(A.contentQueries){let F=n[w];A.contentQueries(1,F,w)}}}finally{ir(s)}}}function zS(e,t,n){TL()&&(pG(e,t,n,Zl(n,t)),(n.flags&64)===64&&G3(e,t,n))}function BS(e,t,n=Zl){let s=t.localNames;if(s!==null){let h=t.index+1;for(let r=0;r<s.length;r+=2){let w=s[r+1],A=w===-1?n(t,e):e[w];e[h++]=A}}}function H3(e){let t=e.tView;return t===null||t.incompleteFirstPass?e.tView=VS(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function VS(e,t,n,s,h,r,w,A,F,$,K){let se=vs+s,le=se+h,ae=nG(se,le),Ze=typeof $=="function"?$():$;return ae[wi]={type:e,blueprint:ae,template:n,queries:null,viewQuery:A,declTNode:t,data:ae.slice().fill(null,se),bindingStartIndex:se,expandoStartIndex:le,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof w=="function"?w():w,firstChild:null,schemas:F,consts:Ze,incompleteFirstPass:!1,ssrId:K}}function nG(e,t){let n=[];for(let s=0;s<t;s++)n.push(s<e?null:Pu);return n}function iG(e,t,n,s){let r=s.get(ZH,p3)||n===Tu.ShadowDom,w=e.selectRootElement(t,r);return rG(w),w}function rG(e){oG(e)}var oG=()=>null;function sG(e,t,n,s){let h=Y3(t);h.push(n),e.firstCreatePass&&X3(e).push(s,h.length-1)}function aG(e,t,n,s,h,r){let w=t?t.injectorIndex:-1,A=0;return G7()&&(A|=128),{type:n,index:s,insertBeforeIndex:null,injectorIndex:w,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:A,providerIndexes:0,value:h,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function Pk(e,t,n,s,h){for(let r in t){if(!t.hasOwnProperty(r))continue;let w=t[r];if(w===void 0)continue;s??={};let A,F=Bd.None;Array.isArray(w)?(A=w[0],F=w[1]):A=w;let $=r;if(h!==null){if(!h.hasOwnProperty(r))continue;$=h[r]}e===0?Dk(s,n,$,A,F):Dk(s,n,$,A)}return s}function Dk(e,t,n,s,h){let r;e.hasOwnProperty(n)?(r=e[n]).push(t,s):r=e[n]=[t,s],h!==void 0&&r.push(h)}function lG(e,t,n){let s=t.directiveStart,h=t.directiveEnd,r=e.data,w=t.attrs,A=[],F=null,$=null;for(let K=s;K<h;K++){let se=r[K],le=n?n.get(se):null,ae=le?le.inputs:null,Ze=le?le.outputs:null;F=Pk(0,se.inputs,K,F,ae),$=Pk(1,se.outputs,K,$,Ze);let Ue=F!==null&&w!==null&&!FS(t)?TG(F,K,w):null;A.push(Ue)}F!==null&&(F.hasOwnProperty("class")&&(t.flags|=8),F.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=A,t.inputs=F,t.outputs=$}function cG(e){return e==="class"?"className":e==="for"?"htmlFor":e==="formaction"?"formAction":e==="innerHtml"?"innerHTML":e==="readonly"?"readOnly":e==="tabindex"?"tabIndex":e}function uG(e,t,n,s,h,r,w,A){let F=Zl(t,n),$=t.inputs,K;!A&&$!=null&&(K=$[s])?(US(e,n,K,s,h),mb(t)&&hG(n,t.index)):t.type&3?(s=cG(s),h=w!=null?w(h,t.value||"",s):h,r.setProperty(F,s,h)):t.type&12}function hG(e,t){let n=Cu(t,e);n[mi]&16||(n[mi]|=64)}function jS(e,t,n,s){if(TL()){let h=s===null?null:{"":-1},r=gG(e,n),w,A;r===null?w=A=null:[w,A]=r,w!==null&&$3(e,t,n,w,h,A),h&&_G(n,s,h)}n.mergedAttrs=_S(n.mergedAttrs,n.attrs)}function $3(e,t,n,s,h,r){for(let $=0;$<s.length;$++)gH($L(n,t),e,s[$].type);vG(n,e.data.length,s.length);for(let $=0;$<s.length;$++){let K=s[$];K.providersResolver&&K.providersResolver(K)}let w=!1,A=!1,F=j3(e,t,s.length,null);for(let $=0;$<s.length;$++){let K=s[$];n.mergedAttrs=_S(n.mergedAttrs,K.hostAttrs),xG(e,n,t,F,K),yG(F,K,h),K.contentQueries!==null&&(n.flags|=4),(K.hostBindings!==null||K.hostAttrs!==null||K.hostVars!==0)&&(n.flags|=64);let se=K.type.prototype;!w&&(se.ngOnChanges||se.ngOnInit||se.ngDoCheck)&&((e.preOrderHooks??=[]).push(n.index),w=!0),!A&&(se.ngOnChanges||se.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(n.index),A=!0),F++}lG(e,n,r)}function dG(e,t,n,s,h){let r=h.hostBindings;if(r){let w=e.hostBindingOpCodes;w===null&&(w=e.hostBindingOpCodes=[]);let A=~t.index;fG(w)!=A&&w.push(A),w.push(n,s,r)}}function fG(e){let t=e.length;for(;t>0;){let n=e[--t];if(typeof n=="number"&&n<0)return n}return 0}function pG(e,t,n,s){let h=n.directiveStart,r=n.directiveEnd;mb(n)&&bG(t,n,e.data[h+n.componentOffset]),e.firstCreatePass||$L(n,t),ql(s,t);let w=n.initialInputs;for(let A=h;A<r;A++){let F=e.data[A],$=wg(t,e,A,n);if(ql($,t),w!==null&&MG(t,A-h,$,F,n,w),e0(F)){let K=Cu(n.index,t);K[_s]=wg(t,e,A,n)}}}function G3(e,t,n){let s=n.directiveStart,h=n.directiveEnd,r=n.index,w=eH();try{pp(r);for(let A=s;A<h;A++){let F=e.data[A],$=t[A];rE(A),(F.hostBindings!==null||F.hostVars!==0||F.hostAttrs!==null)&&mG(F,$)}}finally{pp(-1),rE(w)}}function mG(e,t){e.hostBindings!==null&&e.hostBindings(1,t)}function gG(e,t){let n=e.directiveRegistry,s=null,h=null;if(n)for(let r=0;r<n.length;r++){let w=n[r];if(W$(t,w.selectors,!1))if(s||(s=[]),e0(w))if(w.findHostDirectiveDefs!==null){let A=[];h=h||new Map,w.findHostDirectiveDefs(w,A,h),s.unshift(...A,w);let F=A.length;EE(e,t,F)}else s.unshift(w),EE(e,t,0);else h=h||new Map,w.findHostDirectiveDefs?.(w,s,h),s.push(w)}return s===null?null:[s,h]}function EE(e,t,n){t.componentOffset=n,(e.components??=[]).push(t.index)}function _G(e,t,n){if(t){let s=e.localNames=[];for(let h=0;h<t.length;h+=2){let r=n[t[h+1]];if(r==null)throw new Un(-301,!1);s.push(t[h],r)}}}function yG(e,t,n){if(n){if(t.exportAs)for(let s=0;s<t.exportAs.length;s++)n[t.exportAs[s]]=e;e0(t)&&(n[""]=e)}}function vG(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function xG(e,t,n,s,h){e.data[s]=h;let r=h.factory||(h.factory=cp(h.type,!0)),w=new $y(r,e0(h),Fn);e.blueprint[s]=w,n[s]=w,dG(e,t,s,j3(e,n,h.hostVars,Pu),h)}function q3(e){let t=16;return e.signals?t=4096:e.onPush&&(t=64),t}function bG(e,t,n){let s=Zl(t,e),h=H3(n),r=e[yh].rendererFactory,w=Pb(e,Ib(e,h,null,q3(n),s,t,null,r.createRenderer(s,n),null,null,null));e[t.index]=w}function wG(e,t,n,s,h,r){let w=Zl(e,t);CG(t[ys],w,r,e.value,n,s,h)}function CG(e,t,n,s,h,r,w){if(r==null)e.removeAttribute(t,h,n);else{let A=w==null?lp(r):w(r,s||"",h);e.setAttribute(t,h,A,n)}}function MG(e,t,n,s,h,r){let w=r[t];if(w!==null)for(let A=0;A<w.length;){let F=w[A++],$=w[A++],K=w[A++],se=w[A++];V3(s,n,F,$,K,se)}}function TG(e,t,n){let s=null,h=0;for(;h<n.length;){let r=n[h];if(r===0){h+=4;continue}else if(r===5){h+=2;continue}if(typeof r=="number")break;if(e.hasOwnProperty(r)){s===null&&(s=[]);let w=e[r];for(let A=0;A<w.length;A+=3)if(w[A]===t){s.push(r,w[A+1],w[A+2],n[h+1]);break}}h+=2}return s}function Z3(e,t,n,s){return[e,!0,0,t,null,s,null,n,null,null]}function W3(e,t){let n=e.contentQueries;if(n!==null){let s=ir(null);try{for(let h=0;h<n.length;h+=2){let r=n[h],w=n[h+1];if(w!==-1){let A=e.data[w];pS(r),A.contentQueries(2,t[w],w)}}}finally{ir(s)}}}function Pb(e,t){return e[Hy]?e[sk][Ac]=t:e[Hy]=t,e[sk]=t,t}function SE(e,t,n){pS(0);let s=ir(null);try{t(e,n)}finally{ir(s)}}function Y3(e){return e[z1]??=[]}function X3(e){return e.cleanup??=[]}function K3(e,t){let n=e[xg],s=n?n.get(Mu,null):null;s&&s.handleError(t)}function US(e,t,n,s,h){for(let r=0;r<n.length;){let w=n[r++],A=n[r++],F=n[r++],$=t[w],K=e.data[w];V3(K,$,s,A,F,h)}}function J3(e,t,n){let s=bL(t,e);M$(e[ys],s,n)}function EG(e,t){let n=Cu(t,e),s=n[wi];SG(s,n);let h=n[Ch];h!==null&&n[Uy]===null&&(n[Uy]=PS(h,n[xg])),HS(s,n,n[_s])}function SG(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}function HS(e,t,n){mS(t);try{let s=e.viewQuery;s!==null&&SE(1,s,n);let h=e.template;h!==null&&U3(e,t,h,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),t[vh]?.finishViewCreation(e),e.staticContentQueries&&W3(e,t),e.staticViewQueries&&SE(2,e.viewQuery,n);let r=e.components;r!==null&&IG(t,r)}catch(s){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),s}finally{t[mi]&=-5,gS()}}function IG(e,t){for(let n=0;n<t.length;n++)EG(e,t[n])}function Db(e,t,n,s){let h=ir(null);try{let r=t.tView,A=e[mi]&4096?4096:16,F=Ib(e,r,n,A,null,t,null,null,s?.injector??null,s?.embeddedViewInjector??null,s?.dehydratedView??null),$=e[t.index];F[up]=$;let K=e[vh];return K!==null&&(F[vh]=K.createEmbeddedView(r)),HS(r,F,n),F}finally{ir(h)}}function Q3(e,t){let n=ea+t;if(n<e.length)return e[n]}function Zy(e,t){return!t||t.firstChild===null||r3(e)}function Ob(e,t,n,s=!0){let h=t[wi];if(P$(h,t,e,n),s){let w=TE(n,e),A=t[ys],F=R3(A,e[dp]);F!==null&&S$(h,e[kc],A,t,F,w)}let r=t[Uy];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function eF(e,t){let n=qy(e,t);return n!==void 0&&Tb(n[wi],n),n}function Y1(e,t,n,s,h=!1){for(;n!==null;){if(n.type===128){n=h?n.projectionNext:n.next;continue}let r=t[n.index];r!==null&&s.push(xl(r)),Mh(r)&&PG(r,s);let w=n.type;if(w&8)Y1(e,t,n.child,s);else if(w&32){let A=RS(n,t),F;for(;F=A();)s.push(F)}else if(w&16){let A=k3(t,n);if(Array.isArray(A))s.push(...A);else{let F=fp(t[Rc]);Y1(F[wi],F,A,s,!0)}}n=h?n.projectionNext:n.next}return s}function PG(e,t){for(let n=ea;n<e.length;n++){let s=e[n],h=s[wi].firstChild;h!==null&&Y1(s[wi],s,h,t)}e[dp]!==e[Ch]&&t.push(e[dp])}var tF=[];function DG(e){return e[vl]??OG(e)}function OG(e){let t=tF.pop()??Object.create(RG);return t.lView=e,t}function AG(e){e.lView[vl]!==e&&(e.lView=null,tF.push(e))}var RG=lr(cn({},ep),{consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{t0(e.lView)},consumerOnSignalRead(){this.lView[vl]=this}});function kG(e){let t=e[vl]??Object.create(LG);return t.lView=e,t}var LG=lr(cn({},ep),{consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{let t=fp(e.lView);for(;t&&!nF(t[wi]);)t=fp(t);t&&dS(t)},consumerOnSignalRead(){this.lView[vl]=this}});function nF(e){return e.type!==2}function iF(e){if(e[hp]===null)return;let t=!0;for(;t;){let n=!1;for(let s of e[hp])s.dirty&&(n=!0,s.zone===null||Zone.current===s.zone?s.run():s.zone.run(()=>s.run()));t=n&&!!(e[mi]&8192)}}var FG=100;function rF(e,t=!0,n=0){let h=e[yh].rendererFactory,r=!1;r||h.begin?.();try{NG(e,n)}catch(w){throw t&&K3(e,w),w}finally{r||h.end?.()}}function NG(e,t){let n=IL();try{j1(!0),IE(e,t);let s=0;for(;_b(e);){if(s===FG)throw new Un(103,!1);s++,IE(e,1)}}finally{j1(n)}}function zG(e,t,n,s){let h=t[mi];if((h&256)===256)return;let r=!1,w=!1;mS(t);let A=!0,F=null,$=null;r||(nF(e)?($=DG(t),F=Xm($)):dR()===null?(A=!1,$=kG(t),F=Xm($)):t[vl]&&(Km(t[vl]),t[vl]=null));try{CL(t),K7(e.bindingStartIndex),n!==null&&U3(e,t,n,2,s);let K=(h&3)===3;if(!r)if(K){let ae=e.preOrderCheckHooks;ae!==null&&D1(t,ae,null)}else{let ae=e.preOrderHooks;ae!==null&&O1(t,ae,0,null),NT(t,0)}if(w||BG(t),iF(t),oF(t,0),e.contentQueries!==null&&W3(e,t),!r)if(K){let ae=e.contentCheckHooks;ae!==null&&D1(t,ae)}else{let ae=e.contentHooks;ae!==null&&O1(t,ae,1),NT(t,1)}eG(e,t);let se=e.components;se!==null&&aF(t,se,0);let le=e.viewQuery;if(le!==null&&SE(2,le,s),!r)if(K){let ae=e.viewCheckHooks;ae!==null&&D1(t,ae)}else{let ae=e.viewHooks;ae!==null&&O1(t,ae,2),NT(t,2)}if(e.firstUpdatePass===!0&&(e.firstUpdatePass=!1),t[P1]){for(let ae of t[P1])ae();t[P1]=null}r||(t[mi]&=-73)}catch(K){throw r||t0(t),K}finally{$!==null&&(Sy($,F),A&&AG($)),gS()}}function oF(e,t){for(let n=c3(e);n!==null;n=u3(n))for(let s=ea;s<n.length;s++){let h=n[s];sF(h,t)}}function BG(e){for(let t=c3(e);t!==null;t=u3(t)){if(!(t[mi]&V1.HasTransplantedViews))continue;let n=t[bg];for(let s=0;s<n.length;s++){let h=n[s];dS(h)}}}function VG(e,t,n){let s=Cu(t,e);sF(s,n)}function sF(e,t){hS(e)&&IE(e,t)}function IE(e,t){let s=e[wi],h=e[mi],r=e[vl],w=!!(t===0&&h&16);if(w||=!!(h&64&&t===0),w||=!!(h&1024),w||=!!(r?.dirty&&Iy(r)),w||=!1,r&&(r.dirty=!1),e[mi]&=-9217,w)zG(s,e,s.template,e[_s]);else if(h&8192){iF(e),oF(e,1);let A=s.components;A!==null&&aF(e,A,1)}}function aF(e,t,n){for(let s=0;s<t.length;s++)VG(e,t[s],n)}function $S(e,t){let n=IL()?64:1088;for(e[yh].changeDetectionScheduler?.notify(t);e;){e[mi]|=n;let s=fp(e);if(eE(e)&&!s)return e;e=s}return null}var gp=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let t=this._lView,n=t[wi];return Y1(n,t,n.firstChild,[])}constructor(t,n,s=!0){this._lView=t,this._cdRefInjectingView=n,this.notifyErrorHandler=s}get context(){return this._lView[_s]}get dirty(){return!!(this._lView[mi]&9280)||!!this._lView[vl]?.dirty}set context(t){this._lView[_s]=t}get destroyed(){return(this._lView[mi]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let t=this._lView[ta];if(Mh(t)){let n=t[B1],s=n?n.indexOf(this):-1;s>-1&&(qy(t,s),F1(n,s))}this._attachedToViewContainer=!1}Tb(this._lView[wi],this._lView)}onDestroy(t){ML(this._lView,t)}markForCheck(){$S(this._cdRefInjectingView||this._lView,4)}markForRefresh(){dS(this._cdRefInjectingView||this._lView)}detach(){this._lView[mi]&=-129}reattach(){nE(this._lView),this._lView[mi]|=128}detectChanges(){this._lView[mi]|=1024,rF(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Un(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let t=eE(this._lView),n=this._lView[up];n!==null&&!t&&kS(n,this._lView),D3(this._lView[wi],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Un(902,!1);this._appRef=t;let n=eE(this._lView),s=this._lView[up];s!==null&&!n&&O3(s,this._lView),nE(this._lView)}},_p=(()=>{class e{static __NG_ELEMENT_ID__=HG}return e})(),jG=_p,UG=class extends jG{_declarationLView;_declarationTContainer;elementRef;constructor(t,n,s){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=s}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n)}createEmbeddedViewImpl(t,n,s){let h=Db(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:n,dehydratedView:s});return new gp(h)}};function HG(){return GS(Ma(),pr())}function GS(e,t){return e.type&4?new UG(t,e,Ig(e,t)):null}var efe=new RegExp(`^(\\d+)*(${qH}|${GH})*(.*)`);var $G=()=>null;function Wy(e,t){return $G(e,t)}var PE=class{},X1=class{},DE=class{resolveComponentFactory(t){throw Error(`No component factory found for ${ya(t)}.`)}},Cg=class{static NULL=new DE},Mg=class{},s0=(()=>{class e{destroyNode=null;static __NG_ELEMENT_ID__=()=>GG()}return e})();function GG(){let e=pr(),t=Ma(),n=Cu(t.index,e);return(_h(n)?n:e)[ys]}var qG=(()=>{class e{static \u0275prov=wn({token:e,providedIn:"root",factory:()=>null})}return e})();function K1(e,t,n){let s=n?e.styles:null,h=n?e.classes:null,r=0;if(t!==null)for(let w=0;w<t.length;w++){let A=t[w];if(typeof A=="number")r=A;else if(r==1)h=ek(h,A);else if(r==2){let F=A,$=t[++w];s=ek(s,F+": "+$+";")}}n?e.styles=s:e.stylesWithoutHost=s,n?e.classes=h:e.classesWithoutHost=h}var J1=class extends Cg{ngModule;constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){let n=Nd(t);return new Tg(n,this.ngModule)}};function Ok(e,t){let n=[];for(let s in e){if(!e.hasOwnProperty(s))continue;let h=e[s];if(h===void 0)continue;let r=Array.isArray(h),w=r?h[0]:h,A=r?h[1]:Bd.None;t?n.push({propName:w,templateName:s,isSignal:(A&Bd.SignalBased)!==0}):n.push({propName:w,templateName:s})}return n}function ZG(e){let t=e.toLowerCase();return t==="svg"?xL:t==="math"?N7:null}var Tg=class extends X1{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;get inputs(){let t=this.componentDef,n=t.inputTransforms,s=Ok(t.inputs,!0);if(n!==null)for(let h of s)n.hasOwnProperty(h.propName)&&(h.transform=n[h.propName]);return s}get outputs(){return Ok(this.componentDef.outputs,!1)}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=J$(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}create(t,n,s,h){let r=ir(null);try{h=h||this.ngModule;let w=h instanceof xa?h:h?.injector;w&&this.componentDef.getStandaloneInjector!==null&&(w=this.componentDef.getStandaloneInjector(w)||w);let A=w?new sE(t,w):t,F=A.get(Mg,null);if(F===null)throw new Un(407,!1);let $=A.get(qG,null),K=A.get(mp,null),se={rendererFactory:F,sanitizer:$,changeDetectionScheduler:K},le=F.createRenderer(null,this.componentDef),ae=this.componentDef.selectors[0][0]||"div",Ze=s?iG(le,s,this.componentDef.encapsulation,A):P3(le,ae,ZG(ae)),Ue=512;this.componentDef.signals?Ue|=4096:this.componentDef.onPush||(Ue|=16);let ft=null;Ze!==null&&(ft=PS(Ze,A,!0));let Xe=VS(0,null,null,1,0,null,null,null,null,null,null),st=Ib(null,Xe,null,Ue,null,null,se,le,A,null,ft);mS(st);let Ut,Bt,xt=null;try{let yt=this.componentDef,rn,Dt=null;yt.findHostDirectiveDefs?(rn=[],Dt=new Map,yt.findHostDirectiveDefs(yt,rn,Dt),rn.push(yt)):rn=[yt];let Tt=WG(st,Ze);xt=YG(Tt,Ze,yt,rn,st,se,le),Bt=uS(Xe,vs),Ze&&JG(le,yt,Ze,s),n!==void 0&&QG(Bt,this.ngContentSelectors,n),Ut=KG(xt,yt,rn,Dt,st,[eq]),HS(Xe,st,null)}catch(yt){throw xt!==null&&dE(xt),dE(st),yt}finally{gS()}return new OE(this.componentType,Ut,Ig(Bt,st),st,Bt)}finally{ir(r)}}},OE=class extends PE{location;_rootLView;_tNode;instance;hostView;changeDetectorRef;componentType;previousInputValues=null;constructor(t,n,s,h,r){super(),this.location=s,this._rootLView=h,this._tNode=r,this.instance=n,this.hostView=this.changeDetectorRef=new gp(h,void 0,!1),this.componentType=t}setInput(t,n){let s=this._tNode.inputs,h;if(s!==null&&(h=s[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),n))return;let r=this._rootLView;US(r[wi],r,h,t,n),this.previousInputValues.set(t,n);let w=Cu(this._tNode.index,r);$S(w,1)}}get injector(){return new ap(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}};function WG(e,t){let n=e[wi],s=vs;return e[s]=t,o0(n,s,2,"#host",null)}function YG(e,t,n,s,h,r,w){let A=h[wi];XG(s,e,t,w);let F=null;t!==null&&(F=PS(t,h[xg]));let $=r.rendererFactory.createRenderer(t,n),K=Ib(h,H3(n),null,q3(n),h[e.index],e,r,$,null,null,F);return A.firstCreatePass&&EE(A,e,s.length-1),Pb(h,K),h[e.index]=K}function XG(e,t,n,s){for(let h of e)t.mergedAttrs=_S(t.mergedAttrs,h.hostAttrs);t.mergedAttrs!==null&&(K1(t,t.mergedAttrs,!0),n!==null&&F3(s,n,t))}function KG(e,t,n,s,h,r){let w=Ma(),A=h[wi],F=Zl(w,h);$3(A,h,w,n,null,s);for(let K=0;K<n.length;K++){let se=w.directiveStart+K,le=wg(h,A,se,w);ql(le,h)}G3(A,h,w),F&&ql(F,h);let $=wg(h,A,w.directiveStart+w.componentOffset,w);if(e[_s]=h[_s]=$,r!==null)for(let K of r)K($,t);return NS(A,w,h),$}function JG(e,t,n,s){if(s)oE(e,n,["ng-version","19.0.5"]);else{let{attrs:h,classes:r}=Q$(t.selectors[0]);h&&oE(e,n,h),r&&r.length>0&&L3(e,n,r.join(" "))}}function QG(e,t,n){let s=e.projection=[];for(let h=0;h<t.length;h++){let r=n[h];s.push(r!=null&&r.length?Array.from(r):null)}}function eq(){let e=Ma();xb(pr()[wi],e)}var Ud=(()=>{class e{static __NG_ELEMENT_ID__=tq}return e})();function tq(){let e=Ma();return cF(e,pr())}var nq=Ud,lF=class extends nq{_lContainer;_hostTNode;_hostLView;constructor(t,n,s){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=s}get element(){return Ig(this._hostTNode,this._hostLView)}get injector(){return new ap(this._hostTNode,this._hostLView)}get parentInjector(){let t=yS(this._hostTNode,this._hostLView);if(jL(t)){let n=H1(t,this._hostLView),s=U1(t),h=n[wi].data[s+8];return new ap(h,n)}else return new ap(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){let n=Ak(this._lContainer);return n!==null&&n[t]||null}get length(){return this._lContainer.length-ea}createEmbeddedView(t,n,s){let h,r;typeof s=="number"?h=s:s!=null&&(h=s.index,r=s.injector);let w=Wy(this._lContainer,t.ssrId),A=t.createEmbeddedViewImpl(n||{},r,w);return this.insertImpl(A,h,Zy(this._hostTNode,w)),A}createComponent(t,n,s,h,r){let w=t&&!R7(t),A;if(w)A=n;else{let Ze=n||{};A=Ze.index,s=Ze.injector,h=Ze.projectableNodes,r=Ze.environmentInjector||Ze.ngModuleRef}let F=w?t:new Tg(Nd(t)),$=s||this.parentInjector;if(!r&&F.ngModule==null){let Ue=(w?$:this.parentInjector).get(xa,null);Ue&&(r=Ue)}let K=Nd(F.componentType??{}),se=Wy(this._lContainer,K?.id??null),le=se?.firstChild??null,ae=F.create($,h,le,r);return this.insertImpl(ae.hostView,A,Zy(this._hostTNode,se)),ae}insert(t,n){return this.insertImpl(t,n,!0)}insertImpl(t,n,s){let h=t._lView;if(B7(h)){let A=this.indexOf(t);if(A!==-1)this.detach(A);else{let F=h[ta],$=new lF(F,F[kc],F[ta]);$.detach($.indexOf(t))}}let r=this._adjustIndex(n),w=this._lContainer;return Ob(w,h,r,s),t.attachToViewContainerRef(),iL(UT(w),r,t),t}move(t,n){return this.insert(t,n)}indexOf(t){let n=Ak(this._lContainer);return n!==null?n.indexOf(t):-1}remove(t){let n=this._adjustIndex(t,-1),s=qy(this._lContainer,n);s&&(F1(UT(this._lContainer),n),Tb(s[wi],s))}detach(t){let n=this._adjustIndex(t,-1),s=qy(this._lContainer,n);return s&&F1(UT(this._lContainer),n)!=null?new gp(s):null}_adjustIndex(t,n=0){return t??this.length+n}};function Ak(e){return e[B1]}function UT(e){return e[B1]||(e[B1]=[])}function cF(e,t){let n,s=t[e.index];return Mh(s)?n=s:(n=Z3(s,t,null,e),t[e.index]=n,Pb(t,n)),rq(n,t,e,s),new lF(n,e,t)}function iq(e,t){let n=e[ys],s=n.createComment(""),h=Zl(t,e),r=R3(n,h);return W1(n,r,s,k$(n,h),!1),s}var rq=aq,oq=()=>!1;function sq(e,t,n){return oq(e,t,n)}function aq(e,t,n,s){if(e[dp])return;let h;n.type&8?h=xl(s):h=iq(t,n),e[dp]=h}var AE=class e{queryList;matches=null;constructor(t){this.queryList=t}clone(){return new e(this.queryList)}setDirty(){this.queryList.setDirty()}},RE=class e{queries;constructor(t=[]){this.queries=t}createEmbeddedView(t){let n=t.queries;if(n!==null){let s=t.contentQueries!==null?t.contentQueries[0]:n.length,h=[];for(let r=0;r<s;r++){let w=n.getByIndex(r),A=this.queries[w.indexInDeclarationView];h.push(A.clone())}return new e(h)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)qS(t,n).matches!==null&&this.queries[n].setDirty()}},kE=class{flags;read;predicate;constructor(t,n,s=null){this.flags=n,this.read=s,typeof t=="string"?this.predicate=mq(t):this.predicate=t}},LE=class e{queries;constructor(t=[]){this.queries=t}elementStart(t,n){for(let s=0;s<this.queries.length;s++)this.queries[s].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let s=0;s<this.length;s++){let h=n!==null?n.length:0,r=this.getByIndex(s).embeddedTView(t,h);r&&(r.indexInDeclarationView=s,n!==null?n.push(r):n=[r])}return n!==null?new e(n):null}template(t,n){for(let s=0;s<this.queries.length;s++)this.queries[s].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}},FE=class e{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(t,n=-1){this.metadata=t,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new e(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let n=this._declarationNodeIndex,s=t.parent;for(;s!==null&&s.type&8&&s.index!==n;)s=s.parent;return n===(s!==null?s.index:-1)}return this._appliesToNextNode}matchTNode(t,n){let s=this.metadata.predicate;if(Array.isArray(s))for(let h=0;h<s.length;h++){let r=s[h];this.matchTNodeWithReadOption(t,n,lq(n,r)),this.matchTNodeWithReadOption(t,n,A1(n,t,r,!1,!1))}else s===_p?n.type&4&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,A1(n,t,s,!1,!1))}matchTNodeWithReadOption(t,n,s){if(s!==null){let h=this.metadata.read;if(h!==null)if(h===Po||h===Ud||h===_p&&n.type&4)this.addMatch(n.index,-2);else{let r=A1(n,t,h,!1,!1);r!==null&&this.addMatch(n.index,r)}else this.addMatch(n.index,s)}}addMatch(t,n){this.matches===null?this.matches=[t,n]:this.matches.push(t,n)}};function lq(e,t){let n=e.localNames;if(n!==null){for(let s=0;s<n.length;s+=2)if(n[s]===t)return n[s+1]}return null}function cq(e,t){return e.type&11?Ig(e,t):e.type&4?GS(e,t):null}function uq(e,t,n,s){return n===-1?cq(t,e):n===-2?hq(e,t,s):wg(e,e[wi],n,t)}function hq(e,t,n){if(n===Po)return Ig(t,e);if(n===_p)return GS(t,e);if(n===Ud)return cF(t,e)}function uF(e,t,n,s){let h=t[vh].queries[s];if(h.matches===null){let r=e.data,w=n.matches,A=[];for(let F=0;w!==null&&F<w.length;F+=2){let $=w[F];if($<0)A.push(null);else{let K=r[$];A.push(uq(t,K,w[F+1],n.metadata.read))}}h.matches=A}return h.matches}function NE(e,t,n,s){let h=e.queries.getByIndex(n),r=h.matches;if(r!==null){let w=uF(e,t,h,n);for(let A=0;A<r.length;A+=2){let F=r[A];if(F>0)s.push(w[A/2]);else{let $=r[A+1],K=t[-F];for(let se=ea;se<K.length;se++){let le=K[se];le[up]===le[ta]&&NE(le[wi],le,$,s)}if(K[bg]!==null){let se=K[bg];for(let le=0;le<se.length;le++){let ae=se[le];NE(ae[wi],ae,$,s)}}}}}return s}function dq(e,t){return e[vh].queries[t].queryList}function fq(e,t,n){let s=new hE((n&4)===4);return sG(e,t,s,s.destroy),(t[vh]??=new RE).queries.push(new AE(s))-1}function pq(e,t,n){let s=Ca();return s.firstCreatePass&&(gq(s,new kE(e,t,n),-1),(t&2)===2&&(s.staticViewQueries=!0)),fq(s,pr(),t)}function mq(e){return e.split(",").map(t=>t.trim())}function gq(e,t,n){e.queries===null&&(e.queries=new LE),e.queries.track(new FE(t,n))}function qS(e,t){return e.queries.getByIndex(t)}function _q(e,t){let n=e[wi],s=qS(n,t);return s.crossesNgTemplate?NE(n,e,t,[]):uF(n,e,s,t)}function Ln(e,t){Iu("NgSignals");let n=CR(e),s=n[_l];return t?.equal&&(s.equal=t.equal),n.set=h=>Yx(s,h),n.update=h=>MR(s,h),n.asReadonly=yq.bind(n),n}function yq(){let e=this[_l];if(e.readonlyFn===void 0){let t=()=>this();t[_l]=e,e.readonlyFn=t}return e.readonlyFn}function vq(e){let t=[],n=new Map;function s(h){let r=n.get(h);if(!r){let w=e(h);n.set(h,r=w.then(Cq))}return r}return Q1.forEach((h,r)=>{let w=[];h.templateUrl&&w.push(s(h.templateUrl).then($=>{h.template=$}));let A=typeof h.styles=="string"?[h.styles]:h.styles||[];if(h.styles=A,h.styleUrl&&h.styleUrls?.length)throw new Error("@Component cannot define both `styleUrl` and `styleUrls`. Use `styleUrl` if the component has one stylesheet, or `styleUrls` if it has multiple");if(h.styleUrls?.length){let $=h.styles.length,K=h.styleUrls;h.styleUrls.forEach((se,le)=>{A.push(""),w.push(s(se).then(ae=>{A[$+le]=ae,K.splice(K.indexOf(se),1),K.length==0&&(h.styleUrls=void 0)}))})}else h.styleUrl&&w.push(s(h.styleUrl).then($=>{A.push($),h.styleUrl=void 0}));let F=Promise.all(w).then(()=>Mq(r));t.push(F)}),bq(),Promise.all(t).then(()=>{})}var Q1=new Map,xq=new Set;function bq(){let e=Q1;return Q1=new Map,e}function wq(){return Q1.size===0}function Cq(e){return typeof e=="string"?e:e.text()}function Mq(e){xq.delete(e)}var Vd=class{},Yy=class{};var eb=class extends Vd{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new J1(this);constructor(t,n,s,h=!0){super(),this.ngModuleType=t,this._parent=n;let r=sL(t);this._bootstrapComponents=I3(r.bootstrap),this._r3Injector=KL(t,n,[{provide:Vd,useValue:this},{provide:Cg,useValue:this.componentFactoryResolver},...s],ya(t),new Set(["environment"])),h&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}},tb=class extends Yy{moduleType;constructor(t){super(),this.moduleType=t}create(t){return new eb(this.moduleType,t,[])}};function Tq(e,t,n){return new eb(e,t,n,!1)}var zE=class extends Vd{injector;componentFactoryResolver=new J1(this);instance=null;constructor(t){super();let n=new jy([...t.providers,{provide:Vd,useValue:this},{provide:Cg,useValue:this.componentFactoryResolver}],t.parent||aS(),t.debugName,new Set(["environment"]));this.injector=n,t.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}};function Ab(e,t,n=null){return new zE({providers:e,parent:t,debugName:n,runEnvironmentInitializers:!0}).injector}var Eq=(()=>{class e{_injector;cachedInjectors=new Map;constructor(n){this._injector=n}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){let s=uL(!1,n.type),h=s.length>0?Ab([s],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,h)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(let n of this.cachedInjectors.values())n!==null&&n.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=wn({token:e,providedIn:"environment",factory:()=>new e(Bn(xa))})}return e})();function Ci(e){return Ky(()=>{let t=dF(e),n=lr(cn({},t),{decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===o3.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:t.standalone?h=>h.get(Eq).getOrCreateStandaloneInjector(n):null,getExternalStyles:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Tu.Emulated,styles:e.styles||Gl,_:null,schemas:e.schemas||null,tView:null,id:""});t.standalone&&Iu("NgStandalone"),fF(n);let s=e.dependencies;return n.directiveDefs=kk(s,!1),n.pipeDefs=kk(s,!0),n.id=Pq(n),n})}function Sq(e){return Nd(e)||aL(e)}function Iq(e){return e!==null}function Ta(e){return Ky(()=>({type:e.type,bootstrap:e.bootstrap||Gl,declarations:e.declarations||Gl,imports:e.imports||Gl,exports:e.exports||Gl,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Rk(e,t){if(e==null)return Vy;let n={};for(let s in e)if(e.hasOwnProperty(s)){let h=e[s],r,w,A=Bd.None;Array.isArray(h)?(A=h[0],r=h[1],w=h[2]??r):(r=h,w=h),t?(n[r]=A!==Bd.None?[s,A]:s,t[r]=w):n[r]=s}return n}function Ih(e){return Ky(()=>{let t=dF(e);return fF(t),t})}function hF(e){return{type:e.type,name:e.name,factory:null,pure:e.pure!==!1,standalone:e.standalone??!0,onDestroy:e.type.prototype.ngOnDestroy||null}}function dF(e){let t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||Vy,exportAs:e.exportAs||null,standalone:e.standalone??!0,signals:e.signals===!0,selectors:e.selectors||Gl,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Rk(e.inputs,t),outputs:Rk(e.outputs),debugInfo:null}}function fF(e){e.features?.forEach(t=>t(e))}function kk(e,t){if(!e)return null;let n=t?lL:Sq;return()=>(typeof e=="function"?e():e).map(s=>n(s)).filter(Iq)}function Pq(e){let t=0,n=typeof e.consts=="function"?"":e.consts,s=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,n,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery];for(let r of s.join("|"))t=Math.imul(31,t)+r.charCodeAt(0)<<0;return t+=2147483648,"c"+t}function ZS(e){let t=e.inputConfig,n={};for(let s in t)if(t.hasOwnProperty(s)){let h=t[s];Array.isArray(h)&&h[3]&&(n[s]=h[3])}e.inputTransforms=n}function pF(e){return Oq(e)?Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e:!1}function Dq(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{let n=e[Symbol.iterator](),s;for(;!(s=n.next()).done;)t(s.value)}}function Oq(e){return e!==null&&(typeof e=="function"||typeof e=="object")}function Aq(e,t,n){return e[t]=n}function wh(e,t,n){let s=e[t];return Object.is(s,n)?!1:(e[t]=n,!0)}function Rq(e,t,n,s){let h=wh(e,t,n);return wh(e,t+1,s)||h}function kq(e){return(e.flags&32)===32}function Lq(e,t,n,s,h,r,w,A,F){let $=t.consts,K=o0(t,e,4,w||null,A||null);jS(t,n,K,zd($,F)),xb(t,K);let se=K.tView=VS(2,K,s,h,r,t.directiveRegistry,t.pipeRegistry,null,t.schemas,$,null);return t.queries!==null&&(t.queries.template(t,K),se.queries=t.queries.embeddedTView(K)),K}function BE(e,t,n,s,h,r,w,A,F,$){let K=n+vs,se=t.firstCreatePass?Lq(K,t,e,s,h,r,w,A,F):t.data[K];vp(se,!1);let le=Fq(t,e,se,n);yb()&&Eb(t,e,le,se),ql(le,e);let ae=Z3(le,e,le,se);return e[K]=ae,Pb(e,ae),sq(ae,se,e),gb(se)&&zS(t,e,se),F!=null&&BS(e,se,$),se}function Mi(e,t,n,s,h,r,w,A){let F=pr(),$=Ca(),K=zd($.consts,r);return BE(F,$,e,t,n,s,h,K,w,A),Mi}var Fq=Nq;function Nq(e,t,n,s){return vb(!0),t[ys].createComment("")}var Rb=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();var WS=new Hn(""),a0=new Hn(""),kb=(()=>{class e{_ngZone;registry;_isZoneStable=!0;_callbacks=[];taskTrackingZone=null;constructor(n,s,h){this._ngZone=n,this.registry=s,YS||(zq(h),h.addToWindow(s)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{$r.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;this._callbacks.length!==0;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb()}});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(s=>s.updateCb&&s.updateCb(n)?(clearTimeout(s.timeoutId),!1):!0)}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,s,h){let r=-1;s&&s>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(w=>w.timeoutId!==r),n()},s)),this._callbacks.push({doneCb:n,timeoutId:r,updateCb:h})}whenStable(n,s,h){if(h&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,s,h),this._runCallbacksIfReady()}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,s,h){return[]}static \u0275fac=function(s){return new(s||e)(Bn($r),Bn(Lb),Bn(a0))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})(),Lb=(()=>{class e{_applications=new Map;registerApplication(n,s){this._applications.set(n,s)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,s=!0){return YS?.findTestabilityInTree(this,n,s)??null}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function zq(e){YS=e}var YS;function xp(e){return!!e&&typeof e.then=="function"}function XS(e){return!!e&&typeof e.subscribe=="function"}var Fb=new Hn("");var mF=(()=>{class e{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((n,s)=>{this.resolve=n,this.reject=s});appInits=Qt(Fb,{optional:!0})??[];injector=Qt(ba);constructor(){}runInitializers(){if(this.initialized)return;let n=[];for(let h of this.appInits){let r=$a(this.injector,h);if(xp(r))n.push(r);else if(XS(r)){let w=new Promise((A,F)=>{r.subscribe({complete:A,error:F})});n.push(w)}}let s=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{s()}).catch(h=>{this.reject(h)}),n.length===0&&s(),this.initialized=!0}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),gF=(()=>{class e{static \u0275prov=wn({token:e,providedIn:"root",factory:()=>new nb})}return e})(),nb=class{queuedEffectCount=0;queues=new Map;schedule(t){this.enqueue(t)}enqueue(t){let n=t.zone;this.queues.has(n)||this.queues.set(n,new Set);let s=this.queues.get(n);s.has(t)||(this.queuedEffectCount++,s.add(t))}flush(){for(;this.queuedEffectCount>0;)for(let[t,n]of this.queues)t===null?this.flushQueue(n):t.run(()=>this.flushQueue(n))}flushQueue(t){for(let n of t)t.delete(n),this.queuedEffectCount--,n.run()}},Nb=new Hn("");function Bq(){wR(()=>{throw new Un(600,!1)})}function Vq(e){return e.isBoundToModule}var jq=10;function Uq(e,t,n){try{let s=n();return xp(s)?s.catch(h=>{throw t.runOutsideAngular(()=>e.handleError(h)),h}):s}catch(s){throw t.runOutsideAngular(()=>e.handleError(s)),s}}function _F(e,t){return Array.isArray(t)?t.reduce(_F,e):cn(cn({},e),t)}var Eu=(()=>{class e{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=Qt(OH);afterRenderManager=Qt(m3);zonelessEnabled=Qt(xS);rootEffectScheduler=Qt(gF);dirtyFlags=0;deferredDirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new Ii;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=Qt(Su).hasPendingTasks.pipe(ti(n=>!n));constructor(){Qt(wb,{optional:!0})}whenStable(){let n;return new Promise(s=>{n=this.isStable.subscribe({next:h=>{h&&s()}})}).finally(()=>{n.unsubscribe()})}_injector=Qt(xa);_rendererFactory=null;get injector(){return this._injector}bootstrap(n,s){let h=n instanceof X1;if(!this._injector.get(mF).done){let le=!h&&cL(n),ae=!1;throw new Un(405,ae)}let w;h?w=n:w=this._injector.get(Cg).resolveComponentFactory(n),this.componentTypes.push(w.componentType);let A=Vq(w)?void 0:this._injector.get(Vd),F=s||w.selector,$=w.create(ba.NULL,[],F,A),K=$.location.nativeElement,se=$.injector.get(WS,null);return se?.registerApplication(K),$.onDestroy(()=>{this.detachView($.hostView),R1(this.components,$),se?.unregisterApplication(K)}),this._loadComponent($),$}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick=()=>{if(this.tracingSnapshot!==null){let s=this.tracingSnapshot;this.tracingSnapshot=null,s.run(SS.CHANGE_DETECTION,this._tick),s.dispose();return}if(this._runningTick)throw new Un(101,!1);let n=ir(null);try{this._runningTick=!0,this.synchronize()}catch(s){this.internalErrorHandler(s)}finally{this._runningTick=!1,ir(n),this.afterTick.next()}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Mg,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let n=0;for(;this.dirtyFlags!==0&&n++<jq;)this.synchronizeOnce()}synchronizeOnce(){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let n=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:s,notifyErrorHandler:h}of this.allViews)Hq(s,h,n,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:n})=>_b(n))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(n){let s=n;this._views.push(s),s.attachToAppRef(this)}detachView(n){let s=n;R1(this._views,s),s.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(Nb,[]).forEach(h=>h(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>R1(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Un(406,!1);let n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function R1(e,t){let n=e.indexOf(t);n>-1&&e.splice(n,1)}function Hq(e,t,n,s){if(!n&&!_b(e))return;rF(e,t,n&&!s?0:1)}function xr(e,t,n,s){let h=pr(),r=n0();if(wh(h,r,t)){let w=Ca(),A=NL();wG(A,h,e,t,n,s)}return xr}function $q(e,t,n,s){return wh(e,n0(),n)?t+lp(n)+s:Pu}function Gq(e,t,n,s,h,r){let w=X7(),A=Rq(e,w,n,h);return DL(2),A?t+lp(n)+s+lp(h)+r:Pu}function E1(e,t){return e<<17|t<<2}function yp(e){return e>>17&32767}function qq(e){return(e&2)==2}function Zq(e,t){return e&131071|t<<17}function VE(e){return e|2}function Eg(e){return(e&131068)>>2}function HT(e,t){return e&-131069|t<<2}function Wq(e){return(e&1)===1}function jE(e){return e|1}function Yq(e,t,n,s,h,r){let w=r?t.classBindings:t.styleBindings,A=yp(w),F=Eg(w);e[s]=n;let $=!1,K;if(Array.isArray(n)){let se=n;K=se[1],(K===null||Jy(se,K)>0)&&($=!0)}else K=n;if(h)if(F!==0){let le=yp(e[A+1]);e[s+1]=E1(le,A),le!==0&&(e[le+1]=HT(e[le+1],s)),e[A+1]=Zq(e[A+1],s)}else e[s+1]=E1(A,0),A!==0&&(e[A+1]=HT(e[A+1],s)),A=s;else e[s+1]=E1(F,0),A===0?A=s:e[F+1]=HT(e[F+1],s),F=s;$&&(e[s+1]=VE(e[s+1])),Lk(e,K,s,!0),Lk(e,K,s,!1),Xq(t,K,e,s,r),w=E1(A,F),r?t.classBindings=w:t.styleBindings=w}function Xq(e,t,n,s,h){let r=h?e.residualClasses:e.residualStyles;r!=null&&typeof t=="string"&&Jy(r,t)>=0&&(n[s+1]=jE(n[s+1]))}function Lk(e,t,n,s){let h=e[n+1],r=t===null,w=s?yp(h):Eg(h),A=!1;for(;w!==0&&(A===!1||r);){let F=e[w],$=e[w+1];Kq(F,t)&&(A=!0,e[w+1]=s?jE($):VE($)),w=s?yp($):Eg($)}A&&(e[n+1]=s?VE(h):jE(h))}function Kq(e,t){return e===null||t==null||(Array.isArray(e)?e[1]:e)===t?!0:Array.isArray(e)&&typeof t=="string"?Jy(e,t)>=0:!1}function jt(e,t,n){let s=pr(),h=n0();if(wh(s,h,t)){let r=Ca(),w=NL();uG(r,w,s,e,t,s[ys],n,!1)}return jt}function Fk(e,t,n,s,h){let r=t.inputs,w=h?"class":"style";US(e,n,r[w],w,s)}function fn(e,t,n){return yF(e,t,n,!1),fn}function Do(e,t){return yF(e,t,null,!0),Do}function yF(e,t,n,s){let h=pr(),r=Ca(),w=DL(2);if(r.firstUpdatePass&&Qq(r,e,w,s),t!==Pu&&wh(h,w,t)){let A=r.data[jd()];rZ(r,A,h,h[ys],e,h[w+1]=oZ(t,n),s,w)}}function Jq(e,t){return t>=e.expandoStartIndex}function Qq(e,t,n,s){let h=e.data;if(h[n+1]===null){let r=h[jd()],w=Jq(e,n);sZ(r,s)&&t===null&&!w&&(t=!1),t=eZ(h,r,t,s),Yq(h,r,t,n,w,s)}}function eZ(e,t,n,s){let h=tH(e),r=s?t.residualClasses:t.residualStyles;if(h===null)(s?t.classBindings:t.styleBindings)===0&&(n=$T(null,e,t,n,s),n=Xy(n,t.attrs,s),r=null);else{let w=t.directiveStylingLast;if(w===-1||e[w]!==h)if(n=$T(h,e,t,n,s),r===null){let F=tZ(e,t,s);F!==void 0&&Array.isArray(F)&&(F=$T(null,e,t,F[1],s),F=Xy(F,t.attrs,s),nZ(e,t,s,F))}else r=iZ(e,t,s)}return r!==void 0&&(s?t.residualClasses=r:t.residualStyles=r),n}function tZ(e,t,n){let s=n?t.classBindings:t.styleBindings;if(Eg(s)!==0)return e[yp(s)]}function nZ(e,t,n,s){let h=n?t.classBindings:t.styleBindings;e[yp(h)]=s}function iZ(e,t,n){let s,h=t.directiveEnd;for(let r=1+t.directiveStylingLast;r<h;r++){let w=e[r].hostAttrs;s=Xy(s,w,n)}return Xy(s,t.attrs,n)}function $T(e,t,n,s,h){let r=null,w=n.directiveEnd,A=n.directiveStylingLast;for(A===-1?A=n.directiveStart:A++;A<w&&(r=t[A],s=Xy(s,r.hostAttrs,h),r!==e);)A++;return e!==null&&(n.directiveStylingLast=A),s}function Xy(e,t,n){let s=n?1:2,h=-1;if(t!==null)for(let r=0;r<t.length;r++){let w=t[r];typeof w=="number"?h=w:h===s&&(Array.isArray(e)||(e=e===void 0?[]:["",e]),v7(e,w,n?!0:t[++r]))}return e===void 0?null:e}function rZ(e,t,n,s,h,r,w,A){if(!(t.type&3))return;let F=e.data,$=F[A+1],K=Wq($)?Nk(F,t,n,h,Eg($),w):void 0;if(!ib(K)){ib(r)||qq($)&&(r=Nk(F,null,n,h,A,w));let se=bL(jd(),n);j$(s,w,se,h,r)}}function Nk(e,t,n,s,h,r){let w=t===null,A;for(;h>0;){let F=e[h],$=Array.isArray(F),K=$?F[1]:F,se=K===null,le=n[h+1];le===Pu&&(le=se?Gl:void 0);let ae=se?LT(le,s):K===s?le:void 0;if($&&!ib(ae)&&(ae=LT(F,s)),ib(ae)&&(A=ae,w))return A;let Ze=e[h+1];h=w?yp(Ze):Eg(Ze)}if(t!==null){let F=r?t.residualClasses:t.residualStyles;F!=null&&(A=LT(F,s))}return A}function ib(e){return e!==void 0}function oZ(e,t){return e==null||e===""||(typeof t=="string"?e=e+t:typeof e=="object"&&(e=ya(Lc(e)))),e}function sZ(e,t){return(e.flags&(t?8:16))!==0}var UE=class{destroy(t){}updateValue(t,n){}swap(t,n){let s=Math.min(t,n),h=Math.max(t,n),r=this.detach(h);if(h-s>1){let w=this.detach(s);this.attach(s,r),this.attach(h,w)}else this.attach(s,r)}move(t,n){this.attach(n,this.detach(t))}};function GT(e,t,n,s,h){return e===n&&Object.is(t,s)?1:Object.is(h(e,t),h(n,s))?-1:0}function aZ(e,t,n){let s,h,r=0,w=e.length-1,A=void 0;if(Array.isArray(t)){let F=t.length-1;for(;r<=w&&r<=F;){let $=e.at(r),K=t[r],se=GT(r,$,r,K,n);if(se!==0){se<0&&e.updateValue(r,K),r++;continue}let le=e.at(w),ae=t[F],Ze=GT(w,le,F,ae,n);if(Ze!==0){Ze<0&&e.updateValue(w,ae),w--,F--;continue}let Ue=n(r,$),ft=n(w,le),Xe=n(r,K);if(Object.is(Xe,ft)){let st=n(F,ae);Object.is(st,Ue)?(e.swap(r,w),e.updateValue(w,ae),F--,w--):e.move(w,r),e.updateValue(r,K),r++;continue}if(s??=new rb,h??=Bk(e,r,w,n),HE(e,s,r,Xe))e.updateValue(r,K),r++,w++;else if(h.has(Xe))s.set(Ue,e.detach(r)),w--;else{let st=e.create(r,t[r]);e.attach(r,st),r++,w++}}for(;r<=F;)zk(e,s,n,r,t[r]),r++}else if(t!=null){let F=t[Symbol.iterator](),$=F.next();for(;!$.done&&r<=w;){let K=e.at(r),se=$.value,le=GT(r,K,r,se,n);if(le!==0)le<0&&e.updateValue(r,se),r++,$=F.next();else{s??=new rb,h??=Bk(e,r,w,n);let ae=n(r,se);if(HE(e,s,r,ae))e.updateValue(r,se),r++,w++,$=F.next();else if(!h.has(ae))e.attach(r,e.create(r,se)),r++,w++,$=F.next();else{let Ze=n(r,K);s.set(Ze,e.detach(r)),w--}}}for(;!$.done;)zk(e,s,n,e.length,$.value),$=F.next()}for(;r<=w;)e.destroy(e.detach(w--));s?.forEach(F=>{e.destroy(F)})}function HE(e,t,n,s){return t!==void 0&&t.has(s)?(e.attach(n,t.get(s)),t.delete(s),!0):!1}function zk(e,t,n,s,h){if(HE(e,t,s,n(s,h)))e.updateValue(s,h);else{let r=e.create(s,h);e.attach(s,r)}}function Bk(e,t,n,s){let h=new Set;for(let r=t;r<=n;r++)h.add(s(r,e.at(r)));return h}var rb=class{kvMap=new Map;_vMap=void 0;has(t){return this.kvMap.has(t)}delete(t){if(!this.has(t))return!1;let n=this.kvMap.get(t);return this._vMap!==void 0&&this._vMap.has(n)?(this.kvMap.set(t,this._vMap.get(n)),this._vMap.delete(n)):this.kvMap.delete(t),!0}get(t){return this.kvMap.get(t)}set(t,n){if(this.kvMap.has(t)){let s=this.kvMap.get(t);this._vMap===void 0&&(this._vMap=new Map);let h=this._vMap;for(;h.has(s);)s=h.get(s);h.set(s,n)}else this.kvMap.set(t,n)}forEach(t){for(let[n,s]of this.kvMap)if(t(s,n),this._vMap!==void 0){let h=this._vMap;for(;h.has(s);)s=h.get(s),t(s,n)}}};function Ga(e,t){Iu("NgControlFlow");let n=pr(),s=n0(),h=n[s]!==Pu?n[s]:-1,r=h!==-1?ob(n,vs+h):void 0,w=0;if(wh(n,s,e)){let A=ir(null);try{if(r!==void 0&&eF(r,w),e!==-1){let F=vs+e,$=ob(n,F),K=ZE(n[wi],F),se=Wy($,K.tView.ssrId),le=Db(n,K,t,{dehydratedView:se});Ob($,le,w,Zy(K,se))}}finally{ir(A)}}else if(r!==void 0){let A=Q3(r,w);A!==void 0&&(A[_s]=t)}}var $E=class{lContainer;$implicit;$index;constructor(t,n,s){this.lContainer=t,this.$implicit=n,this.$index=s}get $count(){return this.lContainer.length-ea}};function vF(e){return e}function xF(e,t){return t}var GE=class{hasEmptyBlock;trackByFn;liveCollection;constructor(t,n,s){this.hasEmptyBlock=t,this.trackByFn=n,this.liveCollection=s}};function Hd(e,t,n,s,h,r,w,A,F,$,K,se,le){Iu("NgControlFlow");let ae=pr(),Ze=Ca(),Ue=F!==void 0,ft=pr(),Xe=A?w.bind(ft[Rc][_s]):w,st=new GE(Ue,Xe);ft[vs+e]=st,BE(ae,Ze,e+1,t,n,s,h,zd(Ze.consts,r)),Ue&&BE(ae,Ze,e+2,F,$,K,se,zd(Ze.consts,le))}var qE=class extends UE{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(t,n,s){super(),this.lContainer=t,this.hostLView=n,this.templateTNode=s}get length(){return this.lContainer.length-ea}at(t){return this.getLView(t)[_s].$implicit}attach(t,n){let s=n[Uy];this.needsIndexUpdate||=t!==this.length,Ob(this.lContainer,n,t,Zy(this.templateTNode,s))}detach(t){return this.needsIndexUpdate||=t!==this.length-1,lZ(this.lContainer,t)}create(t,n){let s=Wy(this.lContainer,this.templateTNode.tView.ssrId),h=Db(this.hostLView,this.templateTNode,new $E(this.lContainer,n,t),{dehydratedView:s});return this.operationsCounter?.recordCreate(),h}destroy(t){Tb(t[wi],t),this.operationsCounter?.recordDestroy()}updateValue(t,n){this.getLView(t)[_s].$implicit=n}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let t=0;t<this.length;t++)this.getLView(t)[_s].$index=t}getLView(t){return cZ(this.lContainer,t)}};function $d(e){let t=ir(null),n=jd();try{let s=pr(),h=s[wi],r=s[n],w=n+1,A=ob(s,w);if(r.liveCollection===void 0){let $=ZE(h,w);r.liveCollection=new qE(A,s,$)}else r.liveCollection.reset();let F=r.liveCollection;if(aZ(F,e,r.trackByFn),F.updateIndexes(),r.hasEmptyBlock){let $=n0(),K=F.length===0;if(wh(s,$,K)){let se=n+2,le=ob(s,se);if(K){let ae=ZE(h,se),Ze=Wy(le,ae.tView.ssrId),Ue=Db(s,ae,void 0,{dehydratedView:Ze});Ob(le,Ue,0,Zy(ae,Ze))}else eF(le,0)}}}finally{ir(t)}}function ob(e,t){return e[t]}function lZ(e,t){return qy(e,t)}function cZ(e,t){return Q3(e,t)}function ZE(e,t){return uS(e,t)}function uZ(e,t,n,s,h,r){let w=t.consts,A=zd(w,h),F=o0(t,e,2,s,A);return jS(t,n,F,zd(w,r)),F.attrs!==null&&K1(F,F.attrs,!1),F.mergedAttrs!==null&&K1(F,F.mergedAttrs,!0),t.queries!==null&&t.queries.elementStart(t,F),F}function ut(e,t,n,s){let h=pr(),r=Ca(),w=vs+e,A=h[ys],F=r.firstCreatePass?uZ(w,r,h,t,n,s):r.data[w],$=hZ(r,h,F,A,t,e);h[w]=$;let K=gb(F);return vp(F,!0),F3(A,$,F),!kq(F)&&yb()&&Eb(r,h,$,F),U7()===0&&ql($,h),H7(),K&&(zS(r,h,F),NS(r,F,h)),s!==null&&BS(h,F),ut}function _t(){let e=Ma();fS()?SL():(e=e.parent,vp(e,!1));let t=e;q7(t)&&Z7(),$7();let n=Ca();return n.firstCreatePass&&(xb(n,e),cS(e)&&n.queries.elementEnd(e)),t.classesWithoutHost!=null&&cH(t)&&Fk(n,t,pr(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&uH(t)&&Fk(n,t,pr(),t.stylesWithoutHost,!1),_t}function qt(e,t,n,s){return ut(e,t,n,s),_t(),qt}var hZ=(e,t,n,s,h,r)=>(vb(!0),P3(s,h,oH()));function dZ(e,t,n,s,h){let r=t.consts,w=zd(r,s),A=o0(t,e,8,"ng-container",w);w!==null&&K1(A,w,!0);let F=zd(r,h);return jS(t,n,A,F),t.queries!==null&&t.queries.elementStart(t,A),A}function Du(e,t,n){let s=pr(),h=Ca(),r=e+vs,w=h.firstCreatePass?dZ(r,h,s,t,n):h.data[r];vp(w,!0);let A=fZ(h,s,w,e);return s[r]=A,yb()&&Eb(h,s,A,w),ql(A,s),gb(w)&&(zS(h,s,w),NS(h,w,s)),n!=null&&BS(s,w),Du}function Ou(){let e=Ma(),t=Ca();return fS()?SL():(e=e.parent,vp(e,!1)),t.firstCreatePass&&(xb(t,e),cS(e)&&t.queries.elementEnd(e)),Ou}var fZ=(e,t,n,s)=>(vb(!0),T$(t[ys],""));function Pr(){return pr()}var sb="en-US";var pZ=sb;function mZ(e){typeof e=="string"&&(pZ=e.toLowerCase().replace(/_/g,"-"))}var gZ=(e,t,n)=>{};function Yn(e,t,n,s){let h=pr(),r=Ca(),w=Ma();return yZ(r,h,h[ys],w,e,t,s),Yn}function _Z(e,t,n,s){let h=e.cleanup;if(h!=null)for(let r=0;r<h.length-1;r+=2){let w=h[r];if(w===n&&h[r+1]===s){let A=t[z1],F=h[r+2];return A.length>F?A[F]:null}typeof w=="string"&&(r+=2)}return null}function yZ(e,t,n,s,h,r,w){let A=gb(s),$=e.firstCreatePass&&X3(e),K=t[_s],se=Y3(t),le=!0;if(s.type&3||w){let Ue=Zl(s,t),ft=w?w(Ue):Ue,Xe=se.length,st=w?Bt=>w(xl(Bt[s.index])):s.index,Ut=null;if(!w&&A&&(Ut=_Z(e,t,h,s.index)),Ut!==null){let Bt=Ut.__ngLastListenerFn__||Ut;Bt.__ngNextListenerFn__=r,Ut.__ngLastListenerFn__=r,le=!1}else{r=jk(s,t,K,r),gZ(Ue,h,r);let Bt=n.listen(ft,h,r);se.push(r,Bt),$&&$.push(h,st,Xe,Xe+1)}}else r=jk(s,t,K,r);let ae=s.outputs,Ze;if(le&&ae!==null&&(Ze=ae[h])){let Ue=Ze.length;if(Ue)for(let ft=0;ft<Ue;ft+=2){let Xe=Ze[ft],st=Ze[ft+1],xt=t[Xe][st].subscribe(r),yt=se.length;se.push(r,xt),$&&$.push(h,s.index,yt,-(yt+1))}}}function Vk(e,t,n,s){let h=ir(null);try{return bu(6,t,n),n(s)!==!1}catch(r){return K3(e,r),!1}finally{bu(7,t,n),ir(h)}}function jk(e,t,n,s){return function h(r){if(r===Function)return s;let w=e.componentOffset>-1?Cu(e.index,t):t;$S(w,5);let A=Vk(t,n,s,r),F=h.__ngNextListenerFn__;for(;F;)A=Vk(t,n,F,r)&&A,F=F.__ngNextListenerFn__;return A}}function nn(e=1){return iH(e)}function Lr(e,t,n){pq(e,t,n)}function Dr(e){let t=pr(),n=Ca(),s=OL();pS(s+1);let h=qS(n,s);if(e.dirty&&z7(t)===((h.metadata.flags&2)===2)){if(h.matches===null)e.reset([]);else{let r=_q(t,s);e.reset(r,kH),e.notifyOnChanges()}return!0}return!1}function Or(){return dq(pr(),OL())}function vZ(e,t,n,s){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=s}function zb(e){let t=Y7();return wL(t,vs+e)}function xn(e,t=""){let n=pr(),s=Ca(),h=e+vs,r=s.firstCreatePass?o0(s,h,1,t,null):s.data[h],w=xZ(s,n,r,t,e);n[h]=w,yb()&&Eb(s,n,w,r),vp(r,!1)}var xZ=(e,t,n,s,h)=>(vb(!0),C$(t[ys],s));function rr(e){return As("",e,""),rr}function As(e,t,n){let s=pr(),h=$q(s,e,t,n);return h!==Pu&&J3(s,jd(),h),As}function KS(e,t,n,s,h){let r=pr(),w=Gq(r,e,t,n,s,h);return w!==Pu&&J3(r,jd(),w),KS}function bF(e,t,n,s){return wF(pr(),PL(),e,t,n,s)}function bZ(e,t){let n=e[t];return n===Pu?void 0:n}function wF(e,t,n,s,h,r){let w=t+n;return wh(e,w,h)?Aq(e,w+1,r?s.call(r,h):s(h)):bZ(e,w+1)}function Bb(e,t){let n=Ca(),s,h=e+vs;n.firstCreatePass?(s=wZ(t,n.pipeRegistry),n.data[h]=s,s.onDestroy&&(n.destroyHooks??=[]).push(h,s.onDestroy)):s=n.data[h];let r=s.factory||(s.factory=cp(s.type,!0)),w,A=Ha(Fn);try{let F=$1(!1),$=r();return $1(F),vZ(n,pr(),h,$),$}finally{Ha(A)}}function wZ(e,t){if(t)for(let n=t.length-1;n>=0;n--){let s=t[n];if(e===s.name)return s}}function Vb(e,t,n){let s=e+vs,h=pr(),r=wL(h,s);return CZ(h,s)?wF(h,PL(),t,r.transform,n,r):r.transform(n)}function CZ(e,t){return e[wi].data[t].pure}var S1=null;function MZ(e){S1!==null&&(e.defaultEncapsulation!==S1.defaultEncapsulation||e.preserveWhitespaces!==S1.preserveWhitespaces)||(S1=e)}var WE=class{ngModuleFactory;componentFactories;constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}},jb=(()=>{class e{compileModuleSync(n){return new tb(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){let s=this.compileModuleSync(n),h=sL(n),r=I3(h.declarations).reduce((w,A)=>{let F=Nd(A);return F&&w.push(new Tg(F)),w},[]);return new WE(s,r)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),TZ=new Hn("");function EZ(e,t,n){let s=new tb(n);return Promise.resolve(s)}function Uk(e){for(let t=e.length-1;t>=0;t--)if(e[t]!==void 0)return e[t]}var SZ=(()=>{class e{zone=Qt($r);changeDetectionScheduler=Qt(mp);applicationRef=Qt(Eu);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function IZ({ngZoneFactory:e,ignoreChangesOutsideZone:t,scheduleInRootZone:n}){return e??=()=>new $r(lr(cn({},CF()),{scheduleInRootZone:n})),[{provide:$r,useFactory:e},{provide:vg,multi:!0,useFactory:()=>{let s=Qt(SZ,{optional:!0});return()=>s.initialize()}},{provide:vg,multi:!0,useFactory:()=>{let s=Qt(PZ);return()=>{s.initialize()}}},t===!0?{provide:QL,useValue:!0}:[],{provide:e3,useValue:n??JL}]}function CF(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}var PZ=(()=>{class e{subscription=new to;initialized=!1;zone=Qt($r);pendingTasks=Qt(Su);initialize(){if(this.initialized)return;this.initialized=!0;let n=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(n=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{$r.assertNotInAngularZone(),queueMicrotask(()=>{n!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(n),n=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{$r.assertInAngularZone(),n??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var DZ=(()=>{class e{appRef=Qt(Eu);taskService=Qt(Su);ngZone=Qt($r);zonelessEnabled=Qt(xS);tracing=Qt(wb,{optional:!0});disableScheduling=Qt(QL,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new to;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(q1):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Qt(e3,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Z1||!this.zoneIsDefined)}notify(n){if(!this.zonelessEnabled&&n===5)return;let s=!1;switch(n){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 8:{this.appRef.deferredDirtyFlags|=8;break}case 6:{this.appRef.dirtyFlags|=2,s=!0;break}case 13:{this.appRef.dirtyFlags|=16,s=!0;break}case 14:{this.appRef.dirtyFlags|=2,s=!0;break}case 12:{s=!0;break}case 10:case 9:case 7:case 11:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(s))return;let h=this.useMicrotaskScheduler?fk:t3;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>h(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>h(()=>this.tick()))}shouldScheduleTick(n){return!(this.disableScheduling&&!n||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(q1+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let n=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(s){throw this.taskService.remove(n),s}finally{this.cleanup()}this.useMicrotaskScheduler=!0,fk(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(n)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let n=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(n)}}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function OZ(){return typeof $localize<"u"&&$localize.locale||sb}var JS=new Hn("",{providedIn:"root",factory:()=>Qt(JS,Zi.Optional|Zi.SkipSelf)||OZ()});var ab=new Hn(""),AZ=new Hn("");function ky(e){return!e.moduleRef}function RZ(e){let t=ky(e)?e.r3Injector:e.moduleRef.injector,n=t.get($r);return n.run(()=>{ky(e)?e.r3Injector.resolveInjectorInitializers():e.moduleRef.resolveInjectorInitializers();let s=t.get(Mu,null),h;if(n.runOutsideAngular(()=>{h=n.onError.subscribe({next:r=>{s.handleError(r)}})}),ky(e)){let r=()=>t.destroy(),w=e.platformInjector.get(ab);w.add(r),t.onDestroy(()=>{h.unsubscribe(),w.delete(r)})}else{let r=()=>e.moduleRef.destroy(),w=e.platformInjector.get(ab);w.add(r),e.moduleRef.onDestroy(()=>{R1(e.allPlatformModules,e.moduleRef),h.unsubscribe(),w.delete(r)})}return Uq(s,n,()=>{let r=t.get(mF);return r.runInitializers(),r.donePromise.then(()=>{let w=t.get(JS,sb);if(mZ(w||sb),!t.get(AZ,!0))return ky(e)?t.get(Eu):(e.allPlatformModules.push(e.moduleRef),e.moduleRef);if(ky(e)){let F=t.get(Eu);return e.rootComponent!==void 0&&F.bootstrap(e.rootComponent),F}else return kZ(e.moduleRef,e.allPlatformModules),e.moduleRef})})})}function kZ(e,t){let n=e.injector.get(Eu);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(s=>n.bootstrap(s));else if(e.instance.ngDoBootstrap)e.instance.ngDoBootstrap(n);else throw new Un(-403,!1);t.push(e)}var MF=(()=>{class e{_injector;_modules=[];_destroyListeners=[];_destroyed=!1;constructor(n){this._injector=n}bootstrapModuleFactory(n,s){let h=s?.scheduleInRootZone,r=()=>DH(s?.ngZone,lr(cn({},CF({eventCoalescing:s?.ngZoneEventCoalescing,runCoalescing:s?.ngZoneRunCoalescing})),{scheduleInRootZone:h})),w=s?.ignoreChangesOutsideZone,A=[IZ({ngZoneFactory:r,ignoreChangesOutsideZone:w}),{provide:mp,useExisting:DZ}],F=Tq(n.moduleType,this.injector,A);return RZ({moduleRef:F,allPlatformModules:this._modules,platformInjector:this.injector})}bootstrapModule(n,s=[]){let h=_F({},s);return EZ(this.injector,h,n).then(r=>this.bootstrapModuleFactory(r,h))}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Un(404,!1);this._modules.slice().forEach(s=>s.destroy()),this._destroyListeners.forEach(s=>s());let n=this._injector.get(ab,null);n&&(n.forEach(s=>s()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static \u0275fac=function(s){return new(s||e)(Bn(ba))};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),zy=null,TF=new Hn("");function LZ(e){if(zy&&!zy.get(TF,!1))throw new Un(400,!1);Bq(),zy=e;let t=e.get(MF);return zZ(e),t}function QS(e,t,n=[]){let s=`Platform: ${t}`,h=new Hn(s);return(r=[])=>{let w=EF();if(!w||w.injector.get(TF,!1)){let A=[...n,...r,{provide:h,useValue:!0}];e?e(A):LZ(FZ(A,s))}return NZ(h)}}function FZ(e=[],t){return ba.create({name:t,providers:[{provide:pb,useValue:"platform"},{provide:ab,useValue:new Set([()=>zy=null])},...e]})}function NZ(e){let t=EF();if(!t)throw new Un(401,!1);return t}function EF(){return zy?.get(MF)??null}function zZ(e){let t=e.get(TS,null);$a(e,()=>{t?.forEach(n=>n())})}var Gd=(()=>{class e{static __NG_ELEMENT_ID__=BZ}return e})();function BZ(e){return VZ(Ma(),pr(),(e&16)===16)}function VZ(e,t,n){if(mb(e)&&!n){let s=Cu(e.index,t);return new gp(s,s)}else if(e.type&175){let s=t[Rc];return new gp(s,t)}return null}var YE=class{constructor(){}supports(t){return pF(t)}create(t){return new XE(t)}},jZ=(e,t)=>t,XE=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(t){this._trackByFn=t||jZ}forEachItem(t){let n;for(n=this._itHead;n!==null;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,s=this._removalsHead,h=0,r=null;for(;n||s;){let w=!s||n&&n.currentIndex<Hk(s,h,r)?n:s,A=Hk(w,h,r),F=w.currentIndex;if(w===s)h--,s=s._nextRemoved;else if(n=n._next,w.previousIndex==null)h++;else{r||(r=[]);let $=A-h,K=F-h;if($!=K){for(let le=0;le<$;le++){let ae=le<r.length?r[le]:r[le]=0,Ze=ae+le;K<=Ze&&Ze<$&&(r[le]=ae+1)}let se=w.previousIndex;r[se]=K-$}}A!==F&&t(w,A,F)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;n!==null;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;n!==null;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;n!==null;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;n!==null;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;n!==null;n=n._nextIdentityChange)t(n)}diff(t){if(t==null&&(t=[]),!pF(t))throw new Un(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let n=this._itHead,s=!1,h,r,w;if(Array.isArray(t)){this.length=t.length;for(let A=0;A<this.length;A++)r=t[A],w=this._trackByFn(A,r),n===null||!Object.is(n.trackById,w)?(n=this._mismatch(n,r,w,A),s=!0):(s&&(n=this._verifyReinsertion(n,r,w,A)),Object.is(n.item,r)||this._addIdentityChange(n,r)),n=n._next}else h=0,Dq(t,A=>{w=this._trackByFn(h,A),n===null||!Object.is(n.trackById,w)?(n=this._mismatch(n,A,w,h),s=!0):(s&&(n=this._verifyReinsertion(n,A,w,h)),Object.is(n.item,A)||this._addIdentityChange(n,A)),n=n._next,h++}),this.length=h;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;t!==null;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;t!==null;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;t!==null;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,s,h){let r;return t===null?r=this._itTail:(r=t._prev,this._remove(t)),t=this._unlinkedRecords===null?null:this._unlinkedRecords.get(s,null),t!==null?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,r,h)):(t=this._linkedRecords===null?null:this._linkedRecords.get(s,h),t!==null?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,r,h)):t=this._addAfter(new KE(n,s),r,h)),t}_verifyReinsertion(t,n,s,h){let r=this._unlinkedRecords===null?null:this._unlinkedRecords.get(s,null);return r!==null?t=this._reinsertAfter(r,t._prev,h):t.currentIndex!=h&&(t.currentIndex=h,this._addToMoves(t,h)),t}_truncate(t){for(;t!==null;){let n=t._next;this._addToRemovals(this._unlink(t)),t=n}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,s){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(t);let h=t._prevRemoved,r=t._nextRemoved;return h===null?this._removalsHead=r:h._nextRemoved=r,r===null?this._removalsTail=h:r._prevRemoved=h,this._insertAfter(t,n,s),this._addToMoves(t,s),t}_moveAfter(t,n,s){return this._unlink(t),this._insertAfter(t,n,s),this._addToMoves(t,s),t}_addAfter(t,n,s){return this._insertAfter(t,n,s),this._additionsTail===null?this._additionsTail=this._additionsHead=t:this._additionsTail=this._additionsTail._nextAdded=t,t}_insertAfter(t,n,s){let h=n===null?this._itHead:n._next;return t._next=h,t._prev=n,h===null?this._itTail=t:h._prev=t,n===null?this._itHead=t:n._next=t,this._linkedRecords===null&&(this._linkedRecords=new lb),this._linkedRecords.put(t),t.currentIndex=s,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){this._linkedRecords!==null&&this._linkedRecords.remove(t);let n=t._prev,s=t._next;return n===null?this._itHead=s:n._next=s,s===null?this._itTail=n:s._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail===null?this._movesTail=this._movesHead=t:this._movesTail=this._movesTail._nextMoved=t),t}_addToRemovals(t){return this._unlinkedRecords===null&&(this._unlinkedRecords=new lb),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=t:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=t,t}},KE=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(t,n){this.item=t,this.trackById=n}},JE=class{_head=null;_tail=null;add(t){this._head===null?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let s;for(s=this._head;s!==null;s=s._nextDup)if((n===null||n<=s.currentIndex)&&Object.is(s.trackById,t))return s;return null}remove(t){let n=t._prevDup,s=t._nextDup;return n===null?this._head=s:n._nextDup=s,s===null?this._tail=n:s._prevDup=n,this._head===null}},lb=class{map=new Map;put(t){let n=t.trackById,s=this.map.get(n);s||(s=new JE,this.map.set(n,s)),s.add(t)}get(t,n){let s=t,h=this.map.get(s);return h?h.get(t,n):null}remove(t){let n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function Hk(e,t,n){let s=e.previousIndex;if(s===null)return s;let h=0;return n&&s<n.length&&(h=n[s]),s+t+h}function $k(){return new eI([new YE])}var eI=(()=>{class e{factories;static \u0275prov=wn({token:e,providedIn:"root",factory:$k});constructor(n){this.factories=n}static create(n,s){if(s!=null){let h=s.factories.slice();n=n.concat(h)}return new e(n)}static extend(n){return{provide:e,useFactory:s=>e.create(n,s||$k()),deps:[[e,new rS,new db]]}}find(n){let s=this.factories.find(h=>h.supports(n));if(s!=null)return s;throw new Un(901,!1)}}return e})();var SF=QS(null,"core",[]),IF=(()=>{class e{constructor(n){}static \u0275fac=function(s){return new(s||e)(Bn(Eu))};static \u0275mod=Ta({type:e});static \u0275inj=wa({})}return e})();function Pg(e){return typeof e=="boolean"?e:e!=null&&e!=="false"}function tI(e,t){Iu("NgSignals");let n=vR(e);return t?.equal&&(n[_l].equal=t.equal),n}function Ub(e){let t=ir(null);try{return e()}finally{ir(t)}}var PF=(()=>{class e{view;node;constructor(n,s){this.view=n,this.node=s}static __NG_ELEMENT_ID__=UZ}return e})();function UZ(){return new PF(pr(),Ma())}var HZ=!1,$Z=(()=>{class e extends nb{pendingTasks=Qt(Su);taskId=null;schedule(n){super.schedule(n),this.taskId===null&&(this.taskId=this.pendingTasks.add(),queueMicrotask(()=>this.flush()))}flush(){try{super.flush()}finally{this.taskId!==null&&(this.pendingTasks.remove(this.taskId),this.taskId=null)}}static \u0275prov=wn({token:e,providedIn:"root",factory:()=>new e})}return e})(),QE=class{scheduler;effectFn;zone;injector;unregisterOnDestroy;watcher;constructor(t,n,s,h,r,w){this.scheduler=t,this.effectFn=n,this.zone=s,this.injector=r,this.watcher=TR(A=>this.runEffect(A),()=>this.schedule(),w),this.unregisterOnDestroy=h?.onDestroy(()=>this.destroy())}runEffect(t){try{this.effectFn(t)}catch(n){this.injector.get(Mu,null,{optional:!0})?.handleError(n)}}run(){this.watcher.run()}schedule(){this.scheduler.schedule(this)}destroy(){this.watcher.destroy(),this.unregisterOnDestroy?.()}};function GZ(){}function qZ(e,t){Iu("NgSignals"),!t?.injector&&lS(GZ);let n=t?.injector??Qt(ba),s=t?.manualCleanup!==!0?n.get(i0):null,h=new QE(n.get($Z),e,typeof Zone>"u"?null:Zone.current,s,n,t?.allowSignalWrites??!1),r=n.get(Gd,null,{optional:!0});return!r||!(r._lView[mi]&8)?h.watcher.notify():(r._lView[P1]??=[]).push(h.watcher.notify),h}var ZZ=HZ;var eS=class{[_l];constructor(t){this[_l]=t}destroy(){this[_l].destroy()}};function bl(e,t){if(ZZ)return qZ(e,t);Iu("NgSignals"),!t?.injector&&lS(bl);let n=t?.injector??Qt(ba),s=t?.manualCleanup!==!0?n.get(i0):null,h,r=n.get(PF,null,{optional:!0}),w=n.get(mp);return r!==null&&!t?.forceRoot?(h=XZ(r.view,w,e),s instanceof G1&&s._lView===r.view&&(s=null)):h=KZ(e,n.get(gF),w),h.injector=n,s!==null&&(h.onDestroyFn=s.onDestroy(()=>h.destroy())),new eS(h)}var DF=lr(cn({},ep),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,hasRun:!1,cleanupFns:void 0,zone:null,onDestroyFn:Gy,run(){if(this.dirty=!1,this.hasRun&&!Iy(this))return;this.hasRun=!0;let e=s=>(this.cleanupFns??=[]).push(s),t=Xm(this),n=j1(!1);try{this.maybeCleanup(),this.fn(e)}finally{j1(n),Sy(this,t)}},maybeCleanup(){if(this.cleanupFns?.length)try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[]}}}),WZ=lr(cn({},DF),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(13)},destroy(){Km(this),this.onDestroyFn(),this.maybeCleanup()}}),YZ=lr(cn({},DF),{consumerMarkedDirty(){this.view[mi]|=8192,t0(this.view),this.notifier.notify(14)},destroy(){Km(this),this.onDestroyFn(),this.maybeCleanup(),this.view[hp]?.delete(this)}});function XZ(e,t,n){let s=Object.create(YZ);return s.view=e,s.zone=typeof Zone<"u"?Zone.current:null,s.notifier=t,s.fn=n,e[hp]??=new Set,e[hp].add(s),s.consumerMarkedDirty(s),s}function KZ(e,t,n){let s=Object.create(WZ);return s.fn=e,s.scheduler=t,s.notifier=n,s.zone=typeof Zone<"u"?Zone.current:null,s.scheduler.schedule(s),s.notifier.notify(13),s}function OF(e){let t=Nd(e);if(!t)return null;let n=new Tg(t);return{get selector(){return n.selector},get type(){return n.componentType},get inputs(){return n.inputs},get outputs(){return n.outputs},get ngContentSelectors(){return n.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}var FF=null;function bp(){return FF}function NF(e){FF??=e}var Hb=class{};var rs=new Hn(""),cI=(()=>{class e{historyGo(n){throw new Error("")}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:()=>Qt(JZ),providedIn:"platform"})}return e})(),zF=new Hn(""),JZ=(()=>{class e extends cI{_location;_history;_doc=Qt(rs);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return bp().getBaseHref(this._doc)}onPopState(n){let s=bp().getGlobalEventTarget(this._doc,"window");return s.addEventListener("popstate",n,!1),()=>s.removeEventListener("popstate",n)}onHashChange(n){let s=bp().getGlobalEventTarget(this._doc,"window");return s.addEventListener("hashchange",n,!1),()=>s.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,s,h){this._history.pushState(n,s,h)}replaceState(n,s,h){this._history.replaceState(n,s,h)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function uI(e,t){if(e.length==0)return t;if(t.length==0)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,n==2?e+t.substring(1):n==1?e+t:e+"/"+t}function AF(e){let t=e.match(/#|\?|$/),n=t&&t.index||e.length,s=n-(e[n-1]==="/"?1:0);return e.slice(0,s)+e.slice(n)}function Ph(e){return e&&e[0]!=="?"?"?"+e:e}var Dh=(()=>{class e{historyGo(n){throw new Error("")}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:()=>Qt(hI),providedIn:"root"})}return e})(),BF=new Hn(""),hI=(()=>{class e extends Dh{_platformLocation;_baseHref;_removeListenerFns=[];constructor(n,s){super(),this._platformLocation=n,this._baseHref=s??this._platformLocation.getBaseHrefFromDOM()??Qt(rs).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return uI(this._baseHref,n)}path(n=!1){let s=this._platformLocation.pathname+Ph(this._platformLocation.search),h=this._platformLocation.hash;return h&&n?`${s}${h}`:s}pushState(n,s,h,r){let w=this.prepareExternalUrl(h+Ph(r));this._platformLocation.pushState(n,s,w)}replaceState(n,s,h,r){let w=this.prepareExternalUrl(h+Ph(r));this._platformLocation.replaceState(n,s,w)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static \u0275fac=function(s){return new(s||e)(Bn(cI),Bn(BF,8))};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),VF=(()=>{class e extends Dh{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(n,s){super(),this._platformLocation=n,s!=null&&(this._baseHref=s)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let s=this._platformLocation.hash??"#";return s.length>0?s.substring(1):s}prepareExternalUrl(n){let s=uI(this._baseHref,n);return s.length>0?"#"+s:s}pushState(n,s,h,r){let w=this.prepareExternalUrl(h+Ph(r));w.length==0&&(w=this._platformLocation.pathname),this._platformLocation.pushState(n,s,w)}replaceState(n,s,h,r){let w=this.prepareExternalUrl(h+Ph(r));w.length==0&&(w=this._platformLocation.pathname),this._platformLocation.replaceState(n,s,w)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static \u0275fac=function(s){return new(s||e)(Bn(cI),Bn(BF,8))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})(),Og=(()=>{class e{_subject=new Ii;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(n){this._locationStrategy=n;let s=this._locationStrategy.getBaseHref();this._basePath=tW(AF(RF(s))),this._locationStrategy.onPopState(h=>{this._subject.next({url:this.path(!0),pop:!0,state:h.state,type:h.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,s=""){return this.path()==this.normalize(n+Ph(s))}normalize(n){return e.stripTrailingSlash(eW(this._basePath,RF(n)))}prepareExternalUrl(n){return n&&n[0]!=="/"&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,s="",h=null){this._locationStrategy.pushState(h,"",n,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Ph(s)),h)}replaceState(n,s="",h=null){this._locationStrategy.replaceState(h,"",n,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Ph(s)),h)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription??=this.subscribe(s=>{this._notifyUrlChangeListeners(s.url,s.state)}),()=>{let s=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(s,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",s){this._urlChangeListeners.forEach(h=>h(n,s))}subscribe(n,s,h){return this._subject.subscribe({next:n,error:s??void 0,complete:h??void 0})}static normalizeQueryParams=Ph;static joinWithSlash=uI;static stripTrailingSlash=AF;static \u0275fac=function(s){return new(s||e)(Bn(Dh))};static \u0275prov=wn({token:e,factory:()=>QZ(),providedIn:"root"})}return e})();function QZ(){return new Og(Bn(Dh))}function eW(e,t){if(!e||!t.startsWith(e))return t;let n=t.substring(e.length);return n===""||["/",";","?","#"].includes(n[0])?n:t}function RF(e){return e.replace(/\/index.html$/,"")}function tW(e){if(new RegExp("^(https?:)?//").test(e)){let[,n]=e.split(/\/\/[^\/]+/);return n}return e}function $b(e,t){t=encodeURIComponent(t);for(let n of e.split(";")){let s=n.indexOf("="),[h,r]=s==-1?[n,""]:[n.slice(0,s),n.slice(s+1)];if(h.trim()===t)return decodeURIComponent(r)}return null}var nI=class{$implicit;ngForOf;index;count;constructor(t,n,s,h){this.$implicit=t,this.ngForOf=n,this.index=s,this.count=h}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},jF=(()=>{class e{_viewContainer;_template;_differs;set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(n,s,h){this._viewContainer=n,this._template=s,this._differs=h}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let n=this._ngForOf;if(!this._differ&&n)if(0)try{}catch{}else this._differ=this._differs.find(n).create(this.ngForTrackBy)}if(this._differ){let n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){let s=this._viewContainer;n.forEachOperation((h,r,w)=>{if(h.previousIndex==null)s.createEmbeddedView(this._template,new nI(h.item,this._ngForOf,-1,-1),w===null?void 0:w);else if(w==null)s.remove(r===null?void 0:r);else if(r!==null){let A=s.get(r);s.move(A,w),kF(A,h)}});for(let h=0,r=s.length;h<r;h++){let A=s.get(h).context;A.index=h,A.count=r,A.ngForOf=this._ngForOf}n.forEachIdentityChange(h=>{let r=s.get(h.currentIndex);kF(r,h)})}static ngTemplateContextGuard(n,s){return!0}static \u0275fac=function(s){return new(s||e)(Fn(Ud),Fn(_p),Fn(eI))};static \u0275dir=Ih({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return e})();function kF(e,t){e.context.$implicit=t.item}var xs=(()=>{class e{_viewContainer;_context=new iI;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(n,s){this._viewContainer=n,this._thenTemplateRef=s}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){LF("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){LF("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(n,s){return!0}static \u0275fac=function(s){return new(s||e)(Fn(Ud),Fn(_p))};static \u0275dir=Ih({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return e})(),iI=class{$implicit=null;ngIf=null};function LF(e,t){if(!!!(!t||t.createEmbeddedView))throw new Error(`${e} must be a TemplateRef, but received '${ya(t)}'.`)}function nW(e,t){return new Un(2100,!1)}var rI=class{createSubscription(t,n){return Ub(()=>t.subscribe({next:n,error:s=>{throw s}}))}dispose(t){Ub(()=>t.unsubscribe())}},oI=class{createSubscription(t,n){return t.then(n,s=>{throw s})}dispose(t){}},iW=new oI,rW=new rI,UF=(()=>{class e{_ref;_latestValue=null;markForCheckOnValueUpdate=!0;_subscription=null;_obj=null;_strategy=null;constructor(n){this._ref=n}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(n){if(!this._obj){if(n)try{this.markForCheckOnValueUpdate=!1,this._subscribe(n)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return n!==this._obj?(this._dispose(),this.transform(n)):this._latestValue}_subscribe(n){this._obj=n,this._strategy=this._selectStrategy(n),this._subscription=this._strategy.createSubscription(n,s=>this._updateLatestValue(n,s))}_selectStrategy(n){if(xp(n))return iW;if(XS(n))return rW;throw nW(e,n)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(n,s){n===this._obj&&(this._latestValue=s,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static \u0275fac=function(s){return new(s||e)(Fn(Gd,16))};static \u0275pipe=hF({name:"async",type:e,pure:!1})}return e})();var HF=(()=>{class e{static \u0275fac=function(s){return new(s||e)};static \u0275mod=Ta({type:e});static \u0275inj=wa({})}return e})(),dI="browser",oW="server";function sW(e){return e===dI}function Gb(e){return e===oW}var $F=(()=>{class e{static \u0275prov=wn({token:e,providedIn:"root",factory:()=>sW(Qt(Th))?new sI(Qt(rs),window):new aI})}return e})(),sI=class{document;window;offset=()=>[0,0];constructor(t,n){this.document=t,this.window=n}setOffset(t){Array.isArray(t)?this.offset=()=>t:this.offset=t}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(t){this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){let n=aW(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){this.window.history.scrollRestoration=t}scrollToElement(t){let n=t.getBoundingClientRect(),s=n.left+this.window.pageXOffset,h=n.top+this.window.pageYOffset,r=this.offset();this.window.scrollTo(s-r[0],h-r[1])}};function aW(e,t){let n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if(typeof e.createTreeWalker=="function"&&e.body&&typeof e.body.attachShadow=="function"){let s=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT),h=s.currentNode;for(;h;){let r=h.shadowRoot;if(r){let w=r.getElementById(t)||r.querySelector(`[name="${t}"]`);if(w)return w}h=s.nextNode()}}return null}var aI=class{setOffset(t){}getScrollPosition(){return[0,0]}scrollToPosition(t){}scrollToAnchor(t){}setHistoryScrollRestoration(t){}},Dg=class{};var c0=class{},Zb=class{},Oh=class e{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(t){t?typeof t=="string"?this.lazyInit=()=>{this.headers=new Map,t.split(`
`).forEach(n=>{let s=n.indexOf(":");if(s>0){let h=n.slice(0,s),r=n.slice(s+1).trim();this.addHeaderEntry(h,r)}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((n,s)=>{this.addHeaderEntry(s,n)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([n,s])=>{this.setHeaderEntries(n,s)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();let n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof e?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){let n=new e;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof e?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){let n=t.name.toLowerCase();switch(t.op){case"a":case"s":let s=t.value;if(typeof s=="string"&&(s=[s]),s.length===0)return;this.maybeSetNormalizedName(t.name,n);let h=(t.op==="a"?this.headers.get(n):void 0)||[];h.push(...s),this.headers.set(n,h);break;case"d":let r=t.value;if(!r)this.headers.delete(n),this.normalizedNames.delete(n);else{let w=this.headers.get(n);if(!w)return;w=w.filter(A=>r.indexOf(A)===-1),w.length===0?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,w)}break}}addHeaderEntry(t,n){let s=t.toLowerCase();this.maybeSetNormalizedName(t,s),this.headers.has(s)?this.headers.get(s).push(n):this.headers.set(s,[n])}setHeaderEntries(t,n){let s=(Array.isArray(n)?n:[n]).map(r=>r.toString()),h=t.toLowerCase();this.headers.set(h,s),this.maybeSetNormalizedName(t,h)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}};var pI=class{encodeKey(t){return GF(t)}encodeValue(t){return GF(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}};function lW(e,t){let n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(h=>{let r=h.indexOf("="),[w,A]=r==-1?[t.decodeKey(h),""]:[t.decodeKey(h.slice(0,r)),t.decodeValue(h.slice(r+1))],F=n.get(w)||[];F.push(A),n.set(w,F)}),n}var cW=/%(\d[a-f0-9])/gi,uW={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function GF(e){return encodeURIComponent(e).replace(cW,(t,n)=>uW[n]??t)}function qb(e){return`${e}`}var Zd=class e{map;encoder;updates=null;cloneFrom=null;constructor(t={}){if(this.encoder=t.encoder||new pI,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=lW(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{let s=t.fromObject[n],h=Array.isArray(s)?s.map(qb):[qb(s)];this.map.set(n,h)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();let n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){let n=[];return Object.keys(t).forEach(s=>{let h=t[s];Array.isArray(h)?h.forEach(r=>{n.push({param:s,value:r,op:"a"})}):n.push({param:s,value:h,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{let n=this.encoder.encodeKey(t);return this.map.get(t).map(s=>n+"="+this.encoder.encodeValue(s)).join("&")}).filter(t=>t!=="").join("&")}clone(t){let n=new e({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":let n=(t.op==="a"?this.map.get(t.param):void 0)||[];n.push(qb(t.value)),this.map.set(t.param,n);break;case"d":if(t.value!==void 0){let s=this.map.get(t.param)||[],h=s.indexOf(qb(t.value));h!==-1&&s.splice(h,1),s.length>0?this.map.set(t.param,s):this.map.delete(t.param)}else{this.map.delete(t.param);break}}}),this.cloneFrom=this.updates=null)}};var mI=class{map=new Map;set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}};function hW(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function qF(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function ZF(e){return typeof Blob<"u"&&e instanceof Blob}function WF(e){return typeof FormData<"u"&&e instanceof FormData}function dW(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}var l0=class e{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(t,n,s,h){this.url=n,this.method=t.toUpperCase();let r;if(hW(this.method)||h?(this.body=s!==void 0?s:null,r=h):r=s,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new Oh,this.context??=new mI,!this.params)this.params=new Zd,this.urlWithParams=n;else{let w=this.params.toString();if(w.length===0)this.urlWithParams=n;else{let A=n.indexOf("?"),F=A===-1?"?":A<n.length-1?"&":"";this.urlWithParams=n+F+w}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||qF(this.body)||ZF(this.body)||WF(this.body)||dW(this.body)?this.body:this.body instanceof Zd?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||WF(this.body)?null:ZF(this.body)?this.body.type||null:qF(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Zd?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(t={}){let n=t.method||this.method,s=t.url||this.url,h=t.responseType||this.responseType,r=t.transferCache??this.transferCache,w=t.body!==void 0?t.body:this.body,A=t.withCredentials??this.withCredentials,F=t.reportProgress??this.reportProgress,$=t.headers||this.headers,K=t.params||this.params,se=t.context??this.context;return t.setHeaders!==void 0&&($=Object.keys(t.setHeaders).reduce((le,ae)=>le.set(ae,t.setHeaders[ae]),$)),t.setParams&&(K=Object.keys(t.setParams).reduce((le,ae)=>le.set(ae,t.setParams[ae]),K)),new e(n,s,w,{params:K,headers:$,context:se,reportProgress:F,responseType:h,withCredentials:A,transferCache:r})}},Wd=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(Wd||{}),u0=class{headers;status;statusText;url;ok;type;constructor(t,n=200,s="OK"){this.headers=t.headers||new Oh,this.status=t.status!==void 0?t.status:n,this.statusText=t.statusText||s,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}},Wb=class e extends u0{constructor(t={}){super(t)}type=Wd.ResponseHeader;clone(t={}){return new e({headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},h0=class e extends u0{body;constructor(t={}){super(t),this.body=t.body!==void 0?t.body:null}type=Wd.Response;clone(t={}){return new e({body:t.body!==void 0?t.body:this.body,headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},qd=class extends u0{name="HttpErrorResponse";message;error;ok=!1;constructor(t){super(t,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${t.url||"(unknown url)"}`:this.message=`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}},QF=200,fW=204;function fI(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials,transferCache:e.transferCache}}var d0=(()=>{class e{handler;constructor(n){this.handler=n}request(n,s,h={}){let r;if(n instanceof l0)r=n;else{let F;h.headers instanceof Oh?F=h.headers:F=new Oh(h.headers);let $;h.params&&(h.params instanceof Zd?$=h.params:$=new Zd({fromObject:h.params})),r=new l0(n,s,h.body!==void 0?h.body:null,{headers:F,context:h.context,params:$,reportProgress:h.reportProgress,responseType:h.responseType||"json",withCredentials:h.withCredentials,transferCache:h.transferCache})}let w=yi(r).pipe(gh(F=>this.handler.handle(F)));if(n instanceof l0||h.observe==="events")return w;let A=w.pipe(io(F=>F instanceof h0));switch(h.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return A.pipe(ti(F=>{if(F.body!==null&&!(F.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return F.body}));case"blob":return A.pipe(ti(F=>{if(F.body!==null&&!(F.body instanceof Blob))throw new Error("Response is not a Blob.");return F.body}));case"text":return A.pipe(ti(F=>{if(F.body!==null&&typeof F.body!="string")throw new Error("Response is not a string.");return F.body}));case"json":default:return A.pipe(ti(F=>F.body))}case"response":return A;default:throw new Error(`Unreachable: unhandled observe type ${h.observe}}`)}}delete(n,s={}){return this.request("DELETE",n,s)}get(n,s={}){return this.request("GET",n,s)}head(n,s={}){return this.request("HEAD",n,s)}jsonp(n,s){return this.request("JSONP",n,{params:new Zd().append(s,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,s={}){return this.request("OPTIONS",n,s)}patch(n,s,h={}){return this.request("PATCH",n,fI(h,s))}post(n,s,h={}){return this.request("POST",n,fI(h,s))}put(n,s,h={}){return this.request("PUT",n,fI(h,s))}static \u0275fac=function(s){return new(s||e)(Bn(c0))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})(),pW=/^\)\]\}',?\n/,mW="X-Request-URL";function YF(e){if(e.url)return e.url;let t=mW.toLocaleLowerCase();return e.headers.get(t)}var gW=(()=>{class e{fetchImpl=Qt(gI,{optional:!0})?.fetch??((...n)=>globalThis.fetch(...n));ngZone=Qt($r);handle(n){return new Qi(s=>{let h=new AbortController;return this.doRequest(n,h.signal,s).then(_I,r=>s.error(new qd({error:r}))),()=>h.abort()})}doRequest(n,s,h){return My(this,null,function*(){let r=this.createRequestInit(n),w;try{let ae=this.ngZone.runOutsideAngular(()=>this.fetchImpl(n.urlWithParams,cn({signal:s},r)));_W(ae),h.next({type:Wd.Sent}),w=yield ae}catch(ae){h.error(new qd({error:ae,status:ae.status??0,statusText:ae.statusText,url:n.urlWithParams,headers:ae.headers}));return}let A=new Oh(w.headers),F=w.statusText,$=YF(w)??n.urlWithParams,K=w.status,se=null;if(n.reportProgress&&h.next(new Wb({headers:A,status:K,statusText:F,url:$})),w.body){let ae=w.headers.get("content-length"),Ze=[],Ue=w.body.getReader(),ft=0,Xe,st,Ut=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>My(this,null,function*(){for(;;){let{done:xt,value:yt}=yield Ue.read();if(xt)break;if(Ze.push(yt),ft+=yt.length,n.reportProgress){st=n.responseType==="text"?(st??"")+(Xe??=new TextDecoder).decode(yt,{stream:!0}):void 0;let rn=()=>h.next({type:Wd.DownloadProgress,total:ae?+ae:void 0,loaded:ft,partialText:st});Ut?Ut.run(rn):rn()}}}));let Bt=this.concatChunks(Ze,ft);try{let xt=w.headers.get("Content-Type")??"";se=this.parseBody(n,Bt,xt)}catch(xt){h.error(new qd({error:xt,headers:new Oh(w.headers),status:w.status,statusText:w.statusText,url:YF(w)??n.urlWithParams}));return}}K===0&&(K=se?QF:0),K>=200&&K<300?(h.next(new h0({body:se,headers:A,status:K,statusText:F,url:$})),h.complete()):h.error(new qd({error:se,headers:A,status:K,statusText:F,url:$}))})}parseBody(n,s,h){switch(n.responseType){case"json":let r=new TextDecoder().decode(s).replace(pW,"");return r===""?null:JSON.parse(r);case"text":return new TextDecoder().decode(s);case"blob":return new Blob([s],{type:h});case"arraybuffer":return s.buffer}}createRequestInit(n){let s={},h=n.withCredentials?"include":void 0;if(n.headers.forEach((r,w)=>s[r]=w.join(",")),n.headers.has("Accept")||(s.Accept="application/json, text/plain, */*"),!n.headers.has("Content-Type")){let r=n.detectContentTypeHeader();r!==null&&(s["Content-Type"]=r)}return{body:n.serializeBody(),method:n.method,headers:s,credentials:h}}concatChunks(n,s){let h=new Uint8Array(s),r=0;for(let w of n)h.set(w,r),r+=w.length;return h}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})(),gI=class{};function _I(){}function _W(e){e.then(_I,_I)}function eN(e,t){return t(e)}function yW(e,t){return(n,s)=>t.intercept(n,{handle:h=>e(h,s)})}function vW(e,t,n){return(s,h)=>$a(n,()=>t(s,r=>e(r,h)))}var xW=new Hn(""),yI=new Hn(""),bW=new Hn(""),tN=new Hn("",{providedIn:"root",factory:()=>!0});function wW(){let e=null;return(t,n)=>{e===null&&(e=(Qt(xW,{optional:!0})??[]).reduceRight(yW,eN));let s=Qt(Su);if(Qt(tN)){let r=s.add();return e(t,n).pipe(Rd(()=>s.remove(r)))}else return e(t,n)}}var XF=(()=>{class e extends c0{backend;injector;chain=null;pendingTasks=Qt(Su);contributeToStability=Qt(tN);constructor(n,s){super(),this.backend=n,this.injector=s}handle(n){if(this.chain===null){let s=Array.from(new Set([...this.injector.get(yI),...this.injector.get(bW,[])]));this.chain=s.reduceRight((h,r)=>vW(h,r,this.injector),eN)}if(this.contributeToStability){let s=this.pendingTasks.add();return this.chain(n,h=>this.backend.handle(h)).pipe(Rd(()=>this.pendingTasks.remove(s)))}else return this.chain(n,s=>this.backend.handle(s))}static \u0275fac=function(s){return new(s||e)(Bn(Zb),Bn(xa))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})();var CW=/^\)\]\}',?\n/;function MW(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}var KF=(()=>{class e{xhrFactory;constructor(n){this.xhrFactory=n}handle(n){if(n.method==="JSONP")throw new Un(-2800,!1);let s=this.xhrFactory;return(s.\u0275loadImpl?cr(s.\u0275loadImpl()):yi(null)).pipe(Vr(()=>new Qi(r=>{let w=s.build();if(w.open(n.method,n.urlWithParams),n.withCredentials&&(w.withCredentials=!0),n.headers.forEach((Ue,ft)=>w.setRequestHeader(Ue,ft.join(","))),n.headers.has("Accept")||w.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){let Ue=n.detectContentTypeHeader();Ue!==null&&w.setRequestHeader("Content-Type",Ue)}if(n.responseType){let Ue=n.responseType.toLowerCase();w.responseType=Ue!=="json"?Ue:"text"}let A=n.serializeBody(),F=null,$=()=>{if(F!==null)return F;let Ue=w.statusText||"OK",ft=new Oh(w.getAllResponseHeaders()),Xe=MW(w)||n.url;return F=new Wb({headers:ft,status:w.status,statusText:Ue,url:Xe}),F},K=()=>{let{headers:Ue,status:ft,statusText:Xe,url:st}=$(),Ut=null;ft!==fW&&(Ut=typeof w.response>"u"?w.responseText:w.response),ft===0&&(ft=Ut?QF:0);let Bt=ft>=200&&ft<300;if(n.responseType==="json"&&typeof Ut=="string"){let xt=Ut;Ut=Ut.replace(CW,"");try{Ut=Ut!==""?JSON.parse(Ut):null}catch(yt){Ut=xt,Bt&&(Bt=!1,Ut={error:yt,text:Ut})}}Bt?(r.next(new h0({body:Ut,headers:Ue,status:ft,statusText:Xe,url:st||void 0})),r.complete()):r.error(new qd({error:Ut,headers:Ue,status:ft,statusText:Xe,url:st||void 0}))},se=Ue=>{let{url:ft}=$(),Xe=new qd({error:Ue,status:w.status||0,statusText:w.statusText||"Unknown Error",url:ft||void 0});r.error(Xe)},le=!1,ae=Ue=>{le||(r.next($()),le=!0);let ft={type:Wd.DownloadProgress,loaded:Ue.loaded};Ue.lengthComputable&&(ft.total=Ue.total),n.responseType==="text"&&w.responseText&&(ft.partialText=w.responseText),r.next(ft)},Ze=Ue=>{let ft={type:Wd.UploadProgress,loaded:Ue.loaded};Ue.lengthComputable&&(ft.total=Ue.total),r.next(ft)};return w.addEventListener("load",K),w.addEventListener("error",se),w.addEventListener("timeout",se),w.addEventListener("abort",se),n.reportProgress&&(w.addEventListener("progress",ae),A!==null&&w.upload&&w.upload.addEventListener("progress",Ze)),w.send(A),r.next({type:Wd.Sent}),()=>{w.removeEventListener("error",se),w.removeEventListener("abort",se),w.removeEventListener("load",K),w.removeEventListener("timeout",se),n.reportProgress&&(w.removeEventListener("progress",ae),A!==null&&w.upload&&w.upload.removeEventListener("progress",Ze)),w.readyState!==w.DONE&&w.abort()}})))}static \u0275fac=function(s){return new(s||e)(Bn(Dg))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})(),nN=new Hn(""),TW="XSRF-TOKEN",EW=new Hn("",{providedIn:"root",factory:()=>TW}),SW="X-XSRF-TOKEN",IW=new Hn("",{providedIn:"root",factory:()=>SW}),Yb=class{},PW=(()=>{class e{doc;platform;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(n,s,h){this.doc=n,this.platform=s,this.cookieName=h}getToken(){if(this.platform==="server")return null;let n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=$b(n,this.cookieName),this.lastCookieString=n),this.lastToken}static \u0275fac=function(s){return new(s||e)(Bn(rs),Bn(Th),Bn(EW))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})();function DW(e,t){let n=e.url.toLowerCase();if(!Qt(nN)||e.method==="GET"||e.method==="HEAD"||n.startsWith("http://")||n.startsWith("https://"))return t(e);let s=Qt(Yb).getToken(),h=Qt(IW);return s!=null&&!e.headers.has(h)&&(e=e.clone({headers:e.headers.set(h,s)})),t(e)}var iN=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(iN||{});function OW(e,t){return{\u0275kind:e,\u0275providers:t}}function rN(...e){let t=[d0,KF,XF,{provide:c0,useExisting:XF},{provide:Zb,useFactory:()=>Qt(gW,{optional:!0})??Qt(KF)},{provide:yI,useValue:DW,multi:!0},{provide:nN,useValue:!0},{provide:Yb,useClass:PW}];for(let n of e)t.push(...n.\u0275providers);return fb(t)}var JF=new Hn("");function oN(){return OW(iN.LegacyInterceptors,[{provide:JF,useFactory:wW},{provide:yI,useExisting:JF,multi:!0}])}var xI=class extends Hb{supportsDOMEvents=!0},bI=class e extends xI{static makeCurrent(){NF(new e)}onAndCancel(t,n,s){return t.addEventListener(n,s),()=>{t.removeEventListener(n,s)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.remove()}createElement(t,n){return n=n||this.getDefaultDocument(),n.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return n==="window"?window:n==="document"?t:n==="body"?t.body:null}getBaseHref(t){let n=AW();return n==null?null:RW(n)}resetBaseElement(){f0=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return $b(document.cookie,t)}},f0=null;function AW(){return f0=f0||document.querySelector("base"),f0?f0.getAttribute("href"):null}function RW(e){return new URL(e,document.baseURI).pathname}var wI=class{addToWindow(t){va.getAngularTestability=(s,h=!0)=>{let r=t.findTestabilityInTree(s,h);if(r==null)throw new Un(5103,!1);return r},va.getAllAngularTestabilities=()=>t.getAllTestabilities(),va.getAllAngularRootElements=()=>t.getAllRootElements();let n=s=>{let h=va.getAllAngularTestabilities(),r=h.length,w=function(){r--,r==0&&s()};h.forEach(A=>{A.whenStable(w)})};va.frameworkStabilizers||(va.frameworkStabilizers=[]),va.frameworkStabilizers.push(n)}findTestabilityInTree(t,n,s){if(n==null)return null;let h=t.getTestability(n);return h??(s?bp().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},kW=(()=>{class e{build(){return new XMLHttpRequest}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})(),CI=new Hn(""),dN=(()=>{class e{_zone;_plugins;_eventNameToPlugin=new Map;constructor(n,s){this._zone=s,n.forEach(h=>{h.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,s,h){return this._findPluginFor(s).addEventListener(n,s,h)}getZone(){return this._zone}_findPluginFor(n){let s=this._eventNameToPlugin.get(n);if(s)return s;if(s=this._plugins.find(r=>r.supports(n)),!s)throw new Un(5101,!1);return this._eventNameToPlugin.set(n,s),s}static \u0275fac=function(s){return new(s||e)(Bn(CI),Bn($r))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})(),Kb=class{_doc;constructor(t){this._doc=t}manager},Xb="ng-app-id";function aN(e){for(let t of e)t.remove()}function lN(e,t){let n=t.createElement("style");return n.textContent=e,n}function LW(e,t,n,s){let h=e.head?.querySelectorAll(`style[${Xb}="${t}"],link[${Xb}="${t}"]`);if(h)for(let r of h)r.removeAttribute(Xb),r instanceof HTMLLinkElement?s.set(r.href.slice(r.href.lastIndexOf("/")+1),{usage:0,elements:[r]}):r.textContent&&n.set(r.textContent,{usage:0,elements:[r]})}function MI(e,t){let n=t.createElement("link");return n.setAttribute("rel","stylesheet"),n.setAttribute("href",e),n}var fN=(()=>{class e{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(n,s,h,r={}){this.doc=n,this.appId=s,this.nonce=h,this.isServer=Gb(r),LW(n,s,this.inline,this.external),this.hosts.add(n.head)}addStyles(n,s){for(let h of n)this.addUsage(h,this.inline,lN);s?.forEach(h=>this.addUsage(h,this.external,MI))}removeStyles(n,s){for(let h of n)this.removeUsage(h,this.inline);s?.forEach(h=>this.removeUsage(h,this.external))}addUsage(n,s,h){let r=s.get(n);r?r.usage++:s.set(n,{usage:1,elements:[...this.hosts].map(w=>this.addElement(w,h(n,this.doc)))})}removeUsage(n,s){let h=s.get(n);h&&(h.usage--,h.usage<=0&&(aN(h.elements),s.delete(n)))}ngOnDestroy(){for(let[,{elements:n}]of[...this.inline,...this.external])aN(n);this.hosts.clear()}addHost(n){this.hosts.add(n);for(let[s,{elements:h}]of this.inline)h.push(this.addElement(n,lN(s,this.doc)));for(let[s,{elements:h}]of this.external)h.push(this.addElement(n,MI(s,this.doc)))}removeHost(n){this.hosts.delete(n)}addElement(n,s){return this.nonce&&s.setAttribute("nonce",this.nonce),this.isServer&&s.setAttribute(Xb,this.appId),n.appendChild(s)}static \u0275fac=function(s){return new(s||e)(Bn(rs),Bn(MS),Bn(ES,8),Bn(Th))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})(),vI={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},EI=/%COMP%/g,pN="%COMP%",FW=`_nghost-${pN}`,NW=`_ngcontent-${pN}`,zW=!0,BW=new Hn("",{providedIn:"root",factory:()=>zW});function VW(e){return NW.replace(EI,e)}function jW(e){return FW.replace(EI,e)}function mN(e,t){return t.map(n=>n.replace(EI,e))}var cN=(()=>{class e{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(n,s,h,r,w,A,F,$=null){this.eventManager=n,this.sharedStylesHost=s,this.appId=h,this.removeStylesOnCompDestroy=r,this.doc=w,this.platformId=A,this.ngZone=F,this.nonce=$,this.platformIsServer=Gb(A),this.defaultRenderer=new p0(n,w,F,this.platformIsServer)}createRenderer(n,s){if(!n||!s)return this.defaultRenderer;this.platformIsServer&&s.encapsulation===Tu.ShadowDom&&(s=lr(cn({},s),{encapsulation:Tu.Emulated}));let h=this.getOrCreateRenderer(n,s);return h instanceof Jb?h.applyToHost(n):h instanceof m0&&h.applyStyles(),h}getOrCreateRenderer(n,s){let h=this.rendererByCompId,r=h.get(s.id);if(!r){let w=this.doc,A=this.ngZone,F=this.eventManager,$=this.sharedStylesHost,K=this.removeStylesOnCompDestroy,se=this.platformIsServer;switch(s.encapsulation){case Tu.Emulated:r=new Jb(F,$,s,this.appId,K,w,A,se);break;case Tu.ShadowDom:return new TI(F,$,n,s,w,A,this.nonce,se);default:r=new m0(F,$,s,K,w,A,se);break}h.set(s.id,r)}return r}ngOnDestroy(){this.rendererByCompId.clear()}static \u0275fac=function(s){return new(s||e)(Bn(dN),Bn(fN),Bn(MS),Bn(BW),Bn(rs),Bn(Th),Bn($r),Bn(ES))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})(),p0=class{eventManager;doc;ngZone;platformIsServer;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,n,s,h){this.eventManager=t,this.doc=n,this.ngZone=s,this.platformIsServer=h}destroy(){}destroyNode=null;createElement(t,n){return n?this.doc.createElementNS(vI[n]||n,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,n){(uN(t)?t.content:t).appendChild(n)}insertBefore(t,n,s){t&&(uN(t)?t.content:t).insertBefore(n,s)}removeChild(t,n){n.remove()}selectRootElement(t,n){let s=typeof t=="string"?this.doc.querySelector(t):t;if(!s)throw new Un(-5104,!1);return n||(s.textContent=""),s}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,s,h){if(h){n=h+":"+n;let r=vI[h];r?t.setAttributeNS(r,n,s):t.setAttribute(n,s)}else t.setAttribute(n,s)}removeAttribute(t,n,s){if(s){let h=vI[s];h?t.removeAttributeNS(h,n):t.removeAttribute(`${s}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,s,h){h&(bh.DashCase|bh.Important)?t.style.setProperty(n,s,h&bh.Important?"important":""):t.style[n]=s}removeStyle(t,n,s){s&bh.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,s){t!=null&&(t[n]=s)}setValue(t,n){t.nodeValue=n}listen(t,n,s){if(typeof t=="string"&&(t=bp().getGlobalEventTarget(this.doc,t),!t))throw new Error(`Unsupported event target ${t} for event ${n}`);return this.eventManager.addEventListener(t,n,this.decoratePreventDefault(s))}decoratePreventDefault(t){return n=>{if(n==="__ngUnwrap__")return t;(this.platformIsServer?this.ngZone.runGuarded(()=>t(n)):t(n))===!1&&n.preventDefault()}}};function uN(e){return e.tagName==="TEMPLATE"&&e.content!==void 0}var TI=class extends p0{sharedStylesHost;hostEl;shadowRoot;constructor(t,n,s,h,r,w,A,F){super(t,r,w,F),this.sharedStylesHost=n,this.hostEl=s,this.shadowRoot=s.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let $=mN(h.id,h.styles);for(let se of $){let le=document.createElement("style");A&&le.setAttribute("nonce",A),le.textContent=se,this.shadowRoot.appendChild(le)}let K=h.getExternalStyles?.();if(K)for(let se of K){let le=MI(se,r);A&&le.setAttribute("nonce",A),this.shadowRoot.appendChild(le)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,s){return super.insertBefore(this.nodeOrShadowRoot(t),n,s)}removeChild(t,n){return super.removeChild(null,n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},m0=class extends p0{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(t,n,s,h,r,w,A,F){super(t,r,w,A),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=h,this.styles=F?mN(F,s.styles):s.styles,this.styleUrls=s.getExternalStyles?.(F)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Jb=class extends m0{contentAttr;hostAttr;constructor(t,n,s,h,r,w,A,F){let $=h+"-"+s.id;super(t,n,s,r,w,A,F,$),this.contentAttr=VW($),this.hostAttr=jW($)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){let s=super.createElement(t,n);return super.setAttribute(s,this.contentAttr,""),s}},UW=(()=>{class e extends Kb{constructor(n){super(n)}supports(n){return!0}addEventListener(n,s,h){return n.addEventListener(s,h,!1),()=>this.removeEventListener(n,s,h)}removeEventListener(n,s,h){return n.removeEventListener(s,h)}static \u0275fac=function(s){return new(s||e)(Bn(rs))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})(),hN=["alt","control","meta","shift"],HW={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},$W={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey},GW=(()=>{class e extends Kb{constructor(n){super(n)}supports(n){return e.parseEventName(n)!=null}addEventListener(n,s,h){let r=e.parseEventName(s),w=e.eventCallback(r.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>bp().onAndCancel(n,r.domEventName,w))}static parseEventName(n){let s=n.toLowerCase().split("."),h=s.shift();if(s.length===0||!(h==="keydown"||h==="keyup"))return null;let r=e._normalizeKey(s.pop()),w="",A=s.indexOf("code");if(A>-1&&(s.splice(A,1),w="code."),hN.forEach($=>{let K=s.indexOf($);K>-1&&(s.splice(K,1),w+=$+".")}),w+=r,s.length!=0||r.length===0)return null;let F={};return F.domEventName=h,F.fullKey=w,F}static matchEventFullKeyCode(n,s){let h=HW[n.key]||n.key,r="";return s.indexOf("code.")>-1&&(h=n.code,r="code."),h==null||!h?!1:(h=h.toLowerCase(),h===" "?h="space":h==="."&&(h="dot"),hN.forEach(w=>{if(w!==h){let A=$W[w];A(n)&&(r+=w+".")}}),r+=h,r===s)}static eventCallback(n,s,h){return r=>{e.matchEventFullKeyCode(r,n)&&h.runGuarded(()=>s(r))}}static _normalizeKey(n){return n==="esc"?"escape":n}static \u0275fac=function(s){return new(s||e)(Bn(rs))};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})();function qW(){bI.makeCurrent()}function ZW(){return new Mu}function WW(){return d3(document),document}var YW=[{provide:Th,useValue:dI},{provide:TS,useValue:qW,multi:!0},{provide:rs,useFactory:WW,deps:[]}],gN=QS(SF,"browser",YW),XW=new Hn(""),KW=[{provide:a0,useClass:wI,deps:[]},{provide:WS,useClass:kb,deps:[$r,Lb,a0]},{provide:kb,useClass:kb,deps:[$r,Lb,a0]}],JW=[{provide:pb,useValue:"root"},{provide:Mu,useFactory:ZW,deps:[]},{provide:CI,useClass:UW,multi:!0,deps:[rs,$r,Th]},{provide:CI,useClass:GW,multi:!0,deps:[rs]},cN,fN,dN,{provide:Mg,useExisting:cN},{provide:Dg,useClass:kW,deps:[]},[]],_N=(()=>{class e{constructor(n){}static \u0275fac=function(s){return new(s||e)(Bn(XW,12))};static \u0275mod=Ta({type:e});static \u0275inj=wa({providers:[...JW,...KW],imports:[HF,IF]})}return e})();var Qb=(()=>{class e{_doc;constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}static \u0275fac=function(s){return new(s||e)(Bn(rs))};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var zc=(()=>{class e{static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:function(s){let h=null;return s?h=new(s||e):h=Bn(QW),h},providedIn:"root"})}return e})(),QW=(()=>{class e extends zc{_doc;constructor(n){super(),this._doc=n}sanitize(n,s){if(s==null)return null;switch(n){case Fc.NONE:return s;case Fc.HTML:return Eh(s,"HTML")?Lc(s):DS(this._doc,String(s)).toString();case Fc.STYLE:return Eh(s,"Style")?Lc(s):s;case Fc.SCRIPT:if(Eh(s,"Script"))return Lc(s);throw new Un(5200,!1);case Fc.URL:return Eh(s,"URL")?Lc(s):Mb(String(s));case Fc.RESOURCE_URL:if(Eh(s,"ResourceURL"))return Lc(s);throw new Un(5201,!1);default:throw new Un(5202,!1)}}bypassSecurityTrustHtml(n){return _3(n)}bypassSecurityTrustStyle(n){return y3(n)}bypassSecurityTrustScript(n){return v3(n)}bypassSecurityTrustUrl(n){return x3(n)}bypassSecurityTrustResourceUrl(n){return b3(n)}static \u0275fac=function(s){return new(s||e)(Bn(rs))};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Gi="primary",P0=Symbol("RouteTitle"),OI=class{params;constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){let n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){let n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}};function Ng(e){return new OI(e)}function eY(e,t,n){let s=n.path.split("/");if(s.length>e.length||n.pathMatch==="full"&&(t.hasChildren()||s.length<e.length))return null;let h={};for(let r=0;r<s.length;r++){let w=s[r],A=e[r];if(w[0]===":")h[w.substring(1)]=A;else if(w!==A.path)return null}return{consumed:e.slice(0,s.length),posParams:h}}function tY(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Au(e[n],t[n]))return!1;return!0}function Au(e,t){let n=e?AI(e):void 0,s=t?AI(t):void 0;if(!n||!s||n.length!=s.length)return!1;let h;for(let r=0;r<n.length;r++)if(h=n[r],!IN(e[h],t[h]))return!1;return!0}function AI(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function IN(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;let n=[...e].sort(),s=[...t].sort();return n.every((h,r)=>s[r]===h)}else return e===t}function PN(e){return e.length>0?e[e.length-1]:null}function Xd(e){return TT(e)?e:xp(e)?cr(Promise.resolve(e)):yi(e)}var nY={exact:ON,subset:AN},DN={exact:iY,subset:rY,ignored:()=>!0};function yN(e,t,n){return nY[n.paths](e.root,t.root,n.matrixParams)&&DN[n.queryParams](e.queryParams,t.queryParams)&&!(n.fragment==="exact"&&e.fragment!==t.fragment)}function iY(e,t){return Au(e,t)}function ON(e,t,n){if(!Mp(e.segments,t.segments)||!nw(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(let s in t.children)if(!e.children[s]||!ON(e.children[s],t.children[s],n))return!1;return!0}function rY(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>IN(e[n],t[n]))}function AN(e,t,n){return RN(e,t,t.segments,n)}function RN(e,t,n,s){if(e.segments.length>n.length){let h=e.segments.slice(0,n.length);return!(!Mp(h,n)||t.hasChildren()||!nw(h,n,s))}else if(e.segments.length===n.length){if(!Mp(e.segments,n)||!nw(e.segments,n,s))return!1;for(let h in t.children)if(!e.children[h]||!AN(e.children[h],t.children[h],s))return!1;return!0}else{let h=n.slice(0,e.segments.length),r=n.slice(e.segments.length);return!Mp(e.segments,h)||!nw(e.segments,h,s)||!e.children[Gi]?!1:RN(e.children[Gi],t,r,s)}}function nw(e,t,n){return t.every((s,h)=>DN[n](e[h].parameters,s.parameters))}var Rh=class{root;queryParams;fragment;_queryParamMap;constructor(t=new Fr([],{}),n={},s=null){this.root=t,this.queryParams=n,this.fragment=s}get queryParamMap(){return this._queryParamMap??=Ng(this.queryParams),this._queryParamMap}toString(){return aY.serialize(this)}},Fr=class{segments;children;parent=null;constructor(t,n){this.segments=t,this.children=n,Object.values(n).forEach(s=>s.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return iw(this)}},Cp=class{path;parameters;_parameterMap;constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap??=Ng(this.parameters),this._parameterMap}toString(){return LN(this)}};function oY(e,t){return Mp(e,t)&&e.every((n,s)=>Au(n.parameters,t[s].parameters))}function Mp(e,t){return e.length!==t.length?!1:e.every((n,s)=>n.path===t[s].path)}function sY(e,t){let n=[];return Object.entries(e.children).forEach(([s,h])=>{s===Gi&&(n=n.concat(t(h,s)))}),Object.entries(e.children).forEach(([s,h])=>{s!==Gi&&(n=n.concat(t(h,s)))}),n}var D0=(()=>{class e{static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:()=>new zg,providedIn:"root"})}return e})(),zg=class{parse(t){let n=new kI(t);return new Rh(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){let n=`/${g0(t.root,!0)}`,s=uY(t.queryParams),h=typeof t.fragment=="string"?`#${lY(t.fragment)}`:"";return`${n}${s}${h}`}},aY=new zg;function iw(e){return e.segments.map(t=>LN(t)).join("/")}function g0(e,t){if(!e.hasChildren())return iw(e);if(t){let n=e.children[Gi]?g0(e.children[Gi],!1):"",s=[];return Object.entries(e.children).forEach(([h,r])=>{h!==Gi&&s.push(`${h}:${g0(r,!1)}`)}),s.length>0?`${n}(${s.join("//")})`:n}else{let n=sY(e,(s,h)=>h===Gi?[g0(e.children[Gi],!1)]:[`${h}:${g0(s,!1)}`]);return Object.keys(e.children).length===1&&e.children[Gi]!=null?`${iw(e)}/${n[0]}`:`${iw(e)}/(${n.join("//")})`}}function kN(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ew(e){return kN(e).replace(/%3B/gi,";")}function lY(e){return encodeURI(e)}function RI(e){return kN(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function rw(e){return decodeURIComponent(e)}function vN(e){return rw(e.replace(/\+/g,"%20"))}function LN(e){return`${RI(e.path)}${cY(e.parameters)}`}function cY(e){return Object.entries(e).map(([t,n])=>`;${RI(t)}=${RI(n)}`).join("")}function uY(e){let t=Object.entries(e).map(([n,s])=>Array.isArray(s)?s.map(h=>`${ew(n)}=${ew(h)}`).join("&"):`${ew(n)}=${ew(s)}`).filter(n=>n);return t.length?`?${t.join("&")}`:""}var hY=/^[^\/()?;#]+/;function SI(e){let t=e.match(hY);return t?t[0]:""}var dY=/^[^\/()?;=#]+/;function fY(e){let t=e.match(dY);return t?t[0]:""}var pY=/^[^=?&#]+/;function mY(e){let t=e.match(pY);return t?t[0]:""}var gY=/^[^&#]+/;function _Y(e){let t=e.match(gY);return t?t[0]:""}var kI=class{url;remaining;constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Fr([],{}):new Fr([],this.parseChildren())}parseQueryParams(){let t={};if(this.consumeOptional("?"))do this.parseQueryParam(t);while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let s={};return this.peekStartsWith("(")&&(s=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(s[Gi]=new Fr(t,n)),s}parseSegment(){let t=SI(this.remaining);if(t===""&&this.peekStartsWith(";"))throw new Un(4009,!1);return this.capture(t),new Cp(rw(t),this.parseMatrixParams())}parseMatrixParams(){let t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){let n=fY(this.remaining);if(!n)return;this.capture(n);let s="";if(this.consumeOptional("=")){let h=SI(this.remaining);h&&(s=h,this.capture(s))}t[rw(n)]=rw(s)}parseQueryParam(t){let n=mY(this.remaining);if(!n)return;this.capture(n);let s="";if(this.consumeOptional("=")){let w=_Y(this.remaining);w&&(s=w,this.capture(s))}let h=vN(n),r=vN(s);if(t.hasOwnProperty(h)){let w=t[h];Array.isArray(w)||(w=[w],t[h]=w),w.push(r)}else t[h]=r}parseParens(t){let n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let s=SI(this.remaining),h=this.remaining[s.length];if(h!=="/"&&h!==")"&&h!==";")throw new Un(4010,!1);let r;s.indexOf(":")>-1?(r=s.slice(0,s.indexOf(":")),this.capture(r),this.capture(":")):t&&(r=Gi);let w=this.parseChildren();n[r]=Object.keys(w).length===1?w[Gi]:new Fr([],w),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return this.peekStartsWith(t)?(this.remaining=this.remaining.substring(t.length),!0):!1}capture(t){if(!this.consumeOptional(t))throw new Un(4011,!1)}};function FN(e){return e.segments.length>0?new Fr([],{[Gi]:e}):e}function NN(e){let t={};for(let[s,h]of Object.entries(e.children)){let r=NN(h);if(s===Gi&&r.segments.length===0&&r.hasChildren())for(let[w,A]of Object.entries(r.children))t[w]=A;else(r.segments.length>0||r.hasChildren())&&(t[s]=r)}let n=new Fr(e.segments,t);return yY(n)}function yY(e){if(e.numberOfChildren===1&&e.children[Gi]){let t=e.children[Gi];return new Fr(e.segments.concat(t.segments),t.children)}return e}function Tp(e){return e instanceof Rh}function vY(e,t,n=null,s=null){let h=zN(e);return BN(h,t,n,s)}function zN(e){let t;function n(r){let w={};for(let F of r.children){let $=n(F);w[F.outlet]=$}let A=new Fr(r.url,w);return r===e&&(t=A),A}let s=n(e.root),h=FN(s);return t??h}function BN(e,t,n,s){let h=e;for(;h.parent;)h=h.parent;if(t.length===0)return II(h,h,h,n,s);let r=xY(t);if(r.toRoot())return II(h,h,new Fr([],{}),n,s);let w=bY(r,h,e),A=w.processChildren?v0(w.segmentGroup,w.index,r.commands):jN(w.segmentGroup,w.index,r.commands);return II(h,w.segmentGroup,A,n,s)}function ow(e){return typeof e=="object"&&e!=null&&!e.outlets&&!e.segmentPath}function w0(e){return typeof e=="object"&&e!=null&&e.outlets}function II(e,t,n,s,h){let r={};s&&Object.entries(s).forEach(([F,$])=>{r[F]=Array.isArray($)?$.map(K=>`${K}`):`${$}`});let w;e===t?w=n:w=VN(e,t,n);let A=FN(NN(w));return new Rh(A,r,h)}function VN(e,t,n){let s={};return Object.entries(e.children).forEach(([h,r])=>{r===t?s[h]=n:s[h]=VN(r,t,n)}),new Fr(e.segments,s)}var sw=class{isAbsolute;numberOfDoubleDots;commands;constructor(t,n,s){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=s,t&&s.length>0&&ow(s[0]))throw new Un(4003,!1);let h=s.find(w0);if(h&&h!==PN(s))throw new Un(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function xY(e){if(typeof e[0]=="string"&&e.length===1&&e[0]==="/")return new sw(!0,0,e);let t=0,n=!1,s=e.reduce((h,r,w)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let A={};return Object.entries(r.outlets).forEach(([F,$])=>{A[F]=typeof $=="string"?$.split("/"):$}),[...h,{outlets:A}]}if(r.segmentPath)return[...h,r.segmentPath]}return typeof r!="string"?[...h,r]:w===0?(r.split("/").forEach((A,F)=>{F==0&&A==="."||(F==0&&A===""?n=!0:A===".."?t++:A!=""&&h.push(A))}),h):[...h,r]},[]);return new sw(n,t,s)}var kg=class{segmentGroup;processChildren;index;constructor(t,n,s){this.segmentGroup=t,this.processChildren=n,this.index=s}};function bY(e,t,n){if(e.isAbsolute)return new kg(t,!0,0);if(!n)return new kg(t,!1,NaN);if(n.parent===null)return new kg(n,!0,0);let s=ow(e.commands[0])?0:1,h=n.segments.length-1+s;return wY(n,h,e.numberOfDoubleDots)}function wY(e,t,n){let s=e,h=t,r=n;for(;r>h;){if(r-=h,s=s.parent,!s)throw new Un(4005,!1);h=s.segments.length}return new kg(s,!1,h-r)}function CY(e){return w0(e[0])?e[0].outlets:{[Gi]:e}}function jN(e,t,n){if(e??=new Fr([],{}),e.segments.length===0&&e.hasChildren())return v0(e,t,n);let s=MY(e,t,n),h=n.slice(s.commandIndex);if(s.match&&s.pathIndex<e.segments.length){let r=new Fr(e.segments.slice(0,s.pathIndex),{});return r.children[Gi]=new Fr(e.segments.slice(s.pathIndex),e.children),v0(r,0,h)}else return s.match&&h.length===0?new Fr(e.segments,{}):s.match&&!e.hasChildren()?LI(e,t,n):s.match?v0(e,0,h):LI(e,t,n)}function v0(e,t,n){if(n.length===0)return new Fr(e.segments,{});{let s=CY(n),h={};if(Object.keys(s).some(r=>r!==Gi)&&e.children[Gi]&&e.numberOfChildren===1&&e.children[Gi].segments.length===0){let r=v0(e.children[Gi],t,n);return new Fr(e.segments,r.children)}return Object.entries(s).forEach(([r,w])=>{typeof w=="string"&&(w=[w]),w!==null&&(h[r]=jN(e.children[r],t,w))}),Object.entries(e.children).forEach(([r,w])=>{s[r]===void 0&&(h[r]=w)}),new Fr(e.segments,h)}}function MY(e,t,n){let s=0,h=t,r={match:!1,pathIndex:0,commandIndex:0};for(;h<e.segments.length;){if(s>=n.length)return r;let w=e.segments[h],A=n[s];if(w0(A))break;let F=`${A}`,$=s<n.length-1?n[s+1]:null;if(h>0&&F===void 0)break;if(F&&$&&typeof $=="object"&&$.outlets===void 0){if(!bN(F,$,w))return r;s+=2}else{if(!bN(F,{},w))return r;s++}h++}return{match:!0,pathIndex:h,commandIndex:s}}function LI(e,t,n){let s=e.segments.slice(0,t),h=0;for(;h<n.length;){let r=n[h];if(w0(r)){let F=TY(r.outlets);return new Fr(s,F)}if(h===0&&ow(n[0])){let F=e.segments[t];s.push(new Cp(F.path,xN(n[0]))),h++;continue}let w=w0(r)?r.outlets[Gi]:`${r}`,A=h<n.length-1?n[h+1]:null;w&&A&&ow(A)?(s.push(new Cp(w,xN(A))),h+=2):(s.push(new Cp(w,{})),h++)}return new Fr(s,{})}function TY(e){let t={};return Object.entries(e).forEach(([n,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(t[n]=LI(new Fr([],{}),0,s))}),t}function xN(e){let t={};return Object.entries(e).forEach(([n,s])=>t[n]=`${s}`),t}function bN(e,t,n){return e==n.path&&Au(t,n.parameters)}var x0="imperative",bs=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(bs||{}),Yl=class{id;url;constructor(t,n){this.id=t,this.url=n}},Bg=class extends Yl{type=bs.NavigationStart;navigationTrigger;restoredState;constructor(t,n,s="imperative",h=null){super(t,n),this.navigationTrigger=s,this.restoredState=h}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Xl=class extends Yl{urlAfterRedirects;type=bs.NavigationEnd;constructor(t,n,s){super(t,n),this.urlAfterRedirects=s}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Cl=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(Cl||{}),aw=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(aw||{}),Ah=class extends Yl{reason;code;type=bs.NavigationCancel;constructor(t,n,s,h){super(t,n),this.reason=s,this.code=h}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Yd=class extends Yl{reason;code;type=bs.NavigationSkipped;constructor(t,n,s,h){super(t,n),this.reason=s,this.code=h}},C0=class extends Yl{error;target;type=bs.NavigationError;constructor(t,n,s,h){super(t,n),this.error=s,this.target=h}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},lw=class extends Yl{urlAfterRedirects;state;type=bs.RoutesRecognized;constructor(t,n,s,h){super(t,n),this.urlAfterRedirects=s,this.state=h}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},FI=class extends Yl{urlAfterRedirects;state;type=bs.GuardsCheckStart;constructor(t,n,s,h){super(t,n),this.urlAfterRedirects=s,this.state=h}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},NI=class extends Yl{urlAfterRedirects;state;shouldActivate;type=bs.GuardsCheckEnd;constructor(t,n,s,h,r){super(t,n),this.urlAfterRedirects=s,this.state=h,this.shouldActivate=r}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},zI=class extends Yl{urlAfterRedirects;state;type=bs.ResolveStart;constructor(t,n,s,h){super(t,n),this.urlAfterRedirects=s,this.state=h}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},BI=class extends Yl{urlAfterRedirects;state;type=bs.ResolveEnd;constructor(t,n,s,h){super(t,n),this.urlAfterRedirects=s,this.state=h}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},VI=class{route;type=bs.RouteConfigLoadStart;constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},jI=class{route;type=bs.RouteConfigLoadEnd;constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},UI=class{snapshot;type=bs.ChildActivationStart;constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},HI=class{snapshot;type=bs.ChildActivationEnd;constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},$I=class{snapshot;type=bs.ActivationStart;constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},GI=class{snapshot;type=bs.ActivationEnd;constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},cw=class{routerEvent;position;anchor;type=bs.Scroll;constructor(t,n,s){this.routerEvent=t,this.position=n,this.anchor=s}toString(){let t=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${t}')`}},M0=class{},Vg=class{url;navigationBehaviorOptions;constructor(t,n){this.url=t,this.navigationBehaviorOptions=n}};function EY(e,t){return e.providers&&!e._injector&&(e._injector=Ab(e.providers,t,`Route: ${e.path}`)),e._injector??t}function Bc(e){return e.outlet||Gi}function SY(e,t){let n=e.filter(s=>Bc(s)===t);return n.push(...e.filter(s=>Bc(s)!==t)),n}function O0(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){let n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}var qI=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return O0(this.route?.snapshot)??this.rootInjector}constructor(t){this.rootInjector=t,this.children=new A0(this.rootInjector)}},A0=(()=>{class e{rootInjector;contexts=new Map;constructor(n){this.rootInjector=n}onChildOutletCreated(n,s){let h=this.getOrCreateContext(n);h.outlet=s,this.contexts.set(n,h)}onChildOutletDestroyed(n){let s=this.getContext(n);s&&(s.outlet=null,s.attachRef=null)}onOutletDeactivated(){let n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let s=this.getContext(n);return s||(s=new qI(this.rootInjector),this.contexts.set(n,s)),s}getContext(n){return this.contexts.get(n)||null}static \u0275fac=function(s){return new(s||e)(Bn(xa))};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),uw=class{_root;constructor(t){this._root=t}get root(){return this._root.value}parent(t){let n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){let n=ZI(t,this._root);return n?n.children.map(s=>s.value):[]}firstChild(t){let n=ZI(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){let n=WI(t,this._root);return n.length<2?[]:n[n.length-2].children.map(h=>h.value).filter(h=>h!==t)}pathFromRoot(t){return WI(t,this._root).map(n=>n.value)}};function ZI(e,t){if(e===t.value)return t;for(let n of t.children){let s=ZI(e,n);if(s)return s}return null}function WI(e,t){if(e===t.value)return[t];for(let n of t.children){let s=WI(e,n);if(s.length)return s.unshift(t),s}return[]}var wl=class{value;children;constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}};function Rg(e){let t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}var hw=class extends uw{snapshot;constructor(t,n){super(t),this.snapshot=n,i2(this,t)}toString(){return this.snapshot.toString()}};function UN(e){let t=IY(e),n=new po([new Cp("",{})]),s=new po({}),h=new po({}),r=new po({}),w=new po(""),A=new Ea(n,s,r,w,h,Gi,e,t.root);return A.snapshot=t.root,new hw(new wl(A,[]),t)}function IY(e){let t={},n={},s={},h="",r=new Lg([],t,s,h,n,Gi,e,null,{});return new fw("",new wl(r,[]))}var Ea=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(t,n,s,h,r,w,A,F){this.urlSubject=t,this.paramsSubject=n,this.queryParamsSubject=s,this.fragmentSubject=h,this.dataSubject=r,this.outlet=w,this.component=A,this._futureSnapshot=F,this.title=this.dataSubject?.pipe(ti($=>$[P0]))??yi(void 0),this.url=t,this.params=n,this.queryParams=s,this.fragment=h,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(ti(t=>Ng(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(ti(t=>Ng(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function dw(e,t,n="emptyOnly"){let s,{routeConfig:h}=e;return t!==null&&(n==="always"||h?.path===""||!t.component&&!t.routeConfig?.loadComponent)?s={params:cn(cn({},t.params),e.params),data:cn(cn({},t.data),e.data),resolve:cn(cn(cn(cn({},e.data),t.data),h?.data),e._resolvedData)}:s={params:cn({},e.params),data:cn({},e.data),resolve:cn(cn({},e.data),e._resolvedData??{})},h&&$N(h)&&(s.resolve[P0]=h.title),s}var Lg=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[P0]}constructor(t,n,s,h,r,w,A,F,$){this.url=t,this.params=n,this.queryParams=s,this.fragment=h,this.data=r,this.outlet=w,this.component=A,this.routeConfig=F,this._resolve=$}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Ng(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Ng(this.queryParams),this._queryParamMap}toString(){let t=this.url.map(s=>s.toString()).join("/"),n=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${t}', path:'${n}')`}},fw=class extends uw{url;constructor(t,n){super(n),this.url=t,i2(this,n)}toString(){return HN(this._root)}};function i2(e,t){t.value._routerState=e,t.children.forEach(n=>i2(e,n))}function HN(e){let t=e.children.length>0?` { ${e.children.map(HN).join(", ")} } `:"";return`${e.value}${t}`}function PI(e){if(e.snapshot){let t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Au(t.queryParams,n.queryParams)||e.queryParamsSubject.next(n.queryParams),t.fragment!==n.fragment&&e.fragmentSubject.next(n.fragment),Au(t.params,n.params)||e.paramsSubject.next(n.params),tY(t.url,n.url)||e.urlSubject.next(n.url),Au(t.data,n.data)||e.dataSubject.next(n.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function YI(e,t){let n=Au(e.params,t.params)&&oY(e.url,t.url),s=!e.parent!=!t.parent;return n&&!s&&(!e.parent||YI(e.parent,t.parent))}function $N(e){return typeof e.title=="string"||e.title===null}var PY=new Hn(""),r2=(()=>{class e{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Gi;activateEvents=new go;deactivateEvents=new go;attachEvents=new go;detachEvents=new go;routerOutletData=i3(void 0);parentContexts=Qt(A0);location=Qt(Ud);changeDetector=Qt(Gd);inputBinder=Qt(yw,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(n){if(n.name){let{firstChange:s,previousValue:h}=n.name;if(s)return;this.isTrackedInParentContexts(h)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(h)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Un(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Un(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Un(4012,!1);this.location.detach();let n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,s){this.activated=n,this._activatedRoute=s,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){let n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,s){if(this.isActivated)throw new Un(4013,!1);this._activatedRoute=n;let h=this.location,w=n.snapshot.component,A=this.parentContexts.getOrCreateContext(this.name).children,F=new XI(n,A,h.injector,this.routerOutletData);this.activated=h.createComponent(w,{index:h.length,injector:F,environmentInjector:s}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(s){return new(s||e)};static \u0275dir=Ih({type:e,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Os]})}return e})(),XI=class e{route;childContexts;parent;outletData;__ngOutletInjector(t){return new e(this.route,this.childContexts,t,this.outletData)}constructor(t,n,s,h){this.route=t,this.childContexts=n,this.parent=s,this.outletData=h}get(t,n){return t===Ea?this.route:t===A0?this.childContexts:t===PY?this.outletData:this.parent.get(t,n)}},yw=new Hn(""),wN=(()=>{class e{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){let{activatedRoute:s}=n,h=Oy([s.queryParams,s.params,s.data]).pipe(Vr(([r,w,A],F)=>(A=cn(cn(cn({},r),w),A),F===0?yi(A):Promise.resolve(A)))).subscribe(r=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==s||s.component===null){this.unsubscribeFromRouteData(n);return}let w=OF(s.component);if(!w){this.unsubscribeFromRouteData(n);return}for(let{templateName:A}of w.inputs)n.activatedComponentRef.setInput(A,r[A])});this.outletDataSubscriptions.set(n,h)}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})();function DY(e,t,n){let s=T0(e,t._root,n?n._root:void 0);return new hw(s,t)}function T0(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){let s=n.value;s._futureSnapshot=t.value;let h=OY(e,t,n);return new wl(s,h)}else{if(e.shouldAttach(t.value)){let r=e.retrieve(t.value);if(r!==null){let w=r.route;return w.value._futureSnapshot=t.value,w.children=t.children.map(A=>T0(e,A)),w}}let s=AY(t.value),h=t.children.map(r=>T0(e,r));return new wl(s,h)}}function OY(e,t,n){return t.children.map(s=>{for(let h of n.children)if(e.shouldReuseRoute(s.value,h.value.snapshot))return T0(e,s,h);return T0(e,s)})}function AY(e){return new Ea(new po(e.url),new po(e.params),new po(e.queryParams),new po(e.fragment),new po(e.data),e.outlet,e.component,e)}var E0=class{redirectTo;navigationBehaviorOptions;constructor(t,n){this.redirectTo=t,this.navigationBehaviorOptions=n}},GN="ngNavigationCancelingError";function pw(e,t){let{redirectTo:n,navigationBehaviorOptions:s}=Tp(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,h=qN(!1,Cl.Redirect);return h.url=n,h.navigationBehaviorOptions=s,h}function qN(e,t){let n=new Error(`NavigationCancelingError: ${e||""}`);return n[GN]=!0,n.cancellationCode=t,n}function RY(e){return ZN(e)&&Tp(e.url)}function ZN(e){return!!e&&e[GN]}var kY=(e,t,n,s)=>ti(h=>(new KI(t,h.targetRouterState,h.currentRouterState,n,s).activate(e),h)),KI=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(t,n,s,h,r){this.routeReuseStrategy=t,this.futureState=n,this.currState=s,this.forwardEvent=h,this.inputBindingEnabled=r}activate(t){let n=this.futureState._root,s=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,s,t),PI(this.futureState.root),this.activateChildRoutes(n,s,t)}deactivateChildRoutes(t,n,s){let h=Rg(n);t.children.forEach(r=>{let w=r.value.outlet;this.deactivateRoutes(r,h[w],s),delete h[w]}),Object.values(h).forEach(r=>{this.deactivateRouteAndItsChildren(r,s)})}deactivateRoutes(t,n,s){let h=t.value,r=n?n.value:null;if(h===r)if(h.component){let w=s.getContext(h.outlet);w&&this.deactivateChildRoutes(t,n,w.children)}else this.deactivateChildRoutes(t,n,s);else r&&this.deactivateRouteAndItsChildren(n,s)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){let s=n.getContext(t.value.outlet),h=s&&t.value.component?s.children:n,r=Rg(t);for(let w of Object.values(r))this.deactivateRouteAndItsChildren(w,h);if(s&&s.outlet){let w=s.outlet.detach(),A=s.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:w,route:t,contexts:A})}}deactivateRouteAndOutlet(t,n){let s=n.getContext(t.value.outlet),h=s&&t.value.component?s.children:n,r=Rg(t);for(let w of Object.values(r))this.deactivateRouteAndItsChildren(w,h);s&&(s.outlet&&(s.outlet.deactivate(),s.children.onOutletDeactivated()),s.attachRef=null,s.route=null)}activateChildRoutes(t,n,s){let h=Rg(n);t.children.forEach(r=>{this.activateRoutes(r,h[r.value.outlet],s),this.forwardEvent(new GI(r.value.snapshot))}),t.children.length&&this.forwardEvent(new HI(t.value.snapshot))}activateRoutes(t,n,s){let h=t.value,r=n?n.value:null;if(PI(h),h===r)if(h.component){let w=s.getOrCreateContext(h.outlet);this.activateChildRoutes(t,n,w.children)}else this.activateChildRoutes(t,n,s);else if(h.component){let w=s.getOrCreateContext(h.outlet);if(this.routeReuseStrategy.shouldAttach(h.snapshot)){let A=this.routeReuseStrategy.retrieve(h.snapshot);this.routeReuseStrategy.store(h.snapshot,null),w.children.onOutletReAttached(A.contexts),w.attachRef=A.componentRef,w.route=A.route.value,w.outlet&&w.outlet.attach(A.componentRef,A.route.value),PI(A.route.value),this.activateChildRoutes(t,null,w.children)}else w.attachRef=null,w.route=h,w.outlet&&w.outlet.activateWith(h,w.injector),this.activateChildRoutes(t,null,w.children)}else this.activateChildRoutes(t,null,s)}},mw=class{path;route;constructor(t){this.path=t,this.route=this.path[this.path.length-1]}},Fg=class{component;route;constructor(t,n){this.component=t,this.route=n}};function LY(e,t,n){let s=e._root,h=t?t._root:null;return _0(s,h,n,[s.value])}function FY(e){let t=e.routeConfig?e.routeConfig.canActivateChild:null;return!t||t.length===0?null:{node:e,guards:t}}function Ug(e,t){let n=Symbol(),s=t.get(e,n);return s===n?typeof e=="function"&&!Xk(e)?e:t.get(e):s}function _0(e,t,n,s,h={canDeactivateChecks:[],canActivateChecks:[]}){let r=Rg(t);return e.children.forEach(w=>{NY(w,r[w.value.outlet],n,s.concat([w.value]),h),delete r[w.value.outlet]}),Object.entries(r).forEach(([w,A])=>b0(A,n.getContext(w),h)),h}function NY(e,t,n,s,h={canDeactivateChecks:[],canActivateChecks:[]}){let r=e.value,w=t?t.value:null,A=n?n.getContext(e.value.outlet):null;if(w&&r.routeConfig===w.routeConfig){let F=zY(w,r,r.routeConfig.runGuardsAndResolvers);F?h.canActivateChecks.push(new mw(s)):(r.data=w.data,r._resolvedData=w._resolvedData),r.component?_0(e,t,A?A.children:null,s,h):_0(e,t,n,s,h),F&&A&&A.outlet&&A.outlet.isActivated&&h.canDeactivateChecks.push(new Fg(A.outlet.component,w))}else w&&b0(t,A,h),h.canActivateChecks.push(new mw(s)),r.component?_0(e,null,A?A.children:null,s,h):_0(e,null,n,s,h);return h}function zY(e,t,n){if(typeof n=="function")return n(e,t);switch(n){case"pathParamsChange":return!Mp(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Mp(e.url,t.url)||!Au(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!YI(e,t)||!Au(e.queryParams,t.queryParams);case"paramsChange":default:return!YI(e,t)}}function b0(e,t,n){let s=Rg(e),h=e.value;Object.entries(s).forEach(([r,w])=>{h.component?t?b0(w,t.children.getContext(r),n):b0(w,null,n):b0(w,t,n)}),h.component?t&&t.outlet&&t.outlet.isActivated?n.canDeactivateChecks.push(new Fg(t.outlet.component,h)):n.canDeactivateChecks.push(new Fg(null,h)):n.canDeactivateChecks.push(new Fg(null,h))}function R0(e){return typeof e=="function"}function BY(e){return typeof e=="boolean"}function VY(e){return e&&R0(e.canLoad)}function jY(e){return e&&R0(e.canActivate)}function UY(e){return e&&R0(e.canActivateChild)}function HY(e){return e&&R0(e.canDeactivate)}function $Y(e){return e&&R0(e.canMatch)}function WN(e){return e instanceof mh||e?.name==="EmptyError"}var tw=Symbol("INITIAL_VALUE");function jg(){return Vr(e=>Oy(e.map(t=>t.pipe(Qs(1),AT(tw)))).pipe(ti(t=>{for(let n of t)if(n!==!0){if(n===tw)return tw;if(n===!1||GY(n))return n}return!0}),io(t=>t!==tw),Qs(1)))}function GY(e){return Tp(e)||e instanceof E0}function qY(e,t){return Xr(n=>{let{targetSnapshot:s,currentSnapshot:h,guards:{canActivateChecks:r,canDeactivateChecks:w}}=n;return w.length===0&&r.length===0?yi(lr(cn({},n),{guardsResult:!0})):ZY(w,s,h,e).pipe(Xr(A=>A&&BY(A)?WY(s,r,e,t):yi(A)),ti(A=>lr(cn({},n),{guardsResult:A})))})}function ZY(e,t,n,s){return cr(e).pipe(Xr(h=>QY(h.component,h.route,n,t,s)),mo(h=>h!==!0,!0))}function WY(e,t,n,s){return cr(t).pipe(gh(h=>Pd(XY(h.route.parent,s),YY(h.route,s),JY(e,h.path,n),KY(e,h.route,n))),mo(h=>h!==!0,!0))}function YY(e,t){return e!==null&&t&&t(new $I(e)),yi(!0)}function XY(e,t){return e!==null&&t&&t(new UI(e)),yi(!0)}function KY(e,t,n){let s=t.routeConfig?t.routeConfig.canActivate:null;if(!s||s.length===0)return yi(!0);let h=s.map(r=>x1(()=>{let w=O0(t)??n,A=Ug(r,w),F=jY(A)?A.canActivate(t,e):$a(w,()=>A(t,e));return Xd(F).pipe(mo())}));return yi(h).pipe(jg())}function JY(e,t,n){let s=t[t.length-1],r=t.slice(0,t.length-1).reverse().map(w=>FY(w)).filter(w=>w!==null).map(w=>x1(()=>{let A=w.guards.map(F=>{let $=O0(w.node)??n,K=Ug(F,$),se=UY(K)?K.canActivateChild(s,e):$a($,()=>K(s,e));return Xd(se).pipe(mo())});return yi(A).pipe(jg())}));return yi(r).pipe(jg())}function QY(e,t,n,s,h){let r=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!r||r.length===0)return yi(!0);let w=r.map(A=>{let F=O0(t)??h,$=Ug(A,F),K=HY($)?$.canDeactivate(e,t,n,s):$a(F,()=>$(e,t,n,s));return Xd(K).pipe(mo())});return yi(w).pipe(jg())}function eX(e,t,n,s){let h=t.canLoad;if(h===void 0||h.length===0)return yi(!0);let r=h.map(w=>{let A=Ug(w,e),F=VY(A)?A.canLoad(t,n):$a(e,()=>A(t,n));return Xd(F)});return yi(r).pipe(jg(),YN(s))}function YN(e){return xT(pi(t=>{if(typeof t!="boolean")throw pw(e,t)}),ti(t=>t===!0))}function tX(e,t,n,s){let h=t.canMatch;if(!h||h.length===0)return yi(!0);let r=h.map(w=>{let A=Ug(w,e),F=$Y(A)?A.canMatch(t,n):$a(e,()=>A(t,n));return Xd(F)});return yi(r).pipe(jg(),YN(s))}var S0=class{segmentGroup;constructor(t){this.segmentGroup=t||null}},I0=class extends Error{urlTree;constructor(t){super(),this.urlTree=t}};function Ag(e){return hg(new S0(e))}function nX(e){return hg(new Un(4e3,!1))}function iX(e){return hg(qN(!1,Cl.GuardRejected))}var JI=class{urlSerializer;urlTree;constructor(t,n){this.urlSerializer=t,this.urlTree=n}lineralizeSegments(t,n){let s=[],h=n.root;for(;;){if(s=s.concat(h.segments),h.numberOfChildren===0)return yi(s);if(h.numberOfChildren>1||!h.children[Gi])return nX(`${t.redirectTo}`);h=h.children[Gi]}}applyRedirectCommands(t,n,s,h,r){if(typeof n!="string"){let A=n,{queryParams:F,fragment:$,routeConfig:K,url:se,outlet:le,params:ae,data:Ze,title:Ue}=h,ft=$a(r,()=>A({params:ae,data:Ze,queryParams:F,fragment:$,routeConfig:K,url:se,outlet:le,title:Ue}));if(ft instanceof Rh)throw new I0(ft);n=ft}let w=this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,s);if(n[0]==="/")throw new I0(w);return w}applyRedirectCreateUrlTree(t,n,s,h){let r=this.createSegmentGroup(t,n.root,s,h);return new Rh(r,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){let s={};return Object.entries(t).forEach(([h,r])=>{if(typeof r=="string"&&r[0]===":"){let A=r.substring(1);s[h]=n[A]}else s[h]=r}),s}createSegmentGroup(t,n,s,h){let r=this.createSegments(t,n.segments,s,h),w={};return Object.entries(n.children).forEach(([A,F])=>{w[A]=this.createSegmentGroup(t,F,s,h)}),new Fr(r,w)}createSegments(t,n,s,h){return n.map(r=>r.path[0]===":"?this.findPosParam(t,r,h):this.findOrReturn(r,s))}findPosParam(t,n,s){let h=s[n.path.substring(1)];if(!h)throw new Un(4001,!1);return h}findOrReturn(t,n){let s=0;for(let h of n){if(h.path===t.path)return n.splice(s),h;s++}return t}},QI={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function rX(e,t,n,s,h){let r=XN(e,t,n);return r.matched?(s=EY(t,s),tX(s,t,n,h).pipe(ti(w=>w===!0?r:cn({},QI)))):yi(r)}function XN(e,t,n){if(t.path==="**")return oX(n);if(t.path==="")return t.pathMatch==="full"&&(e.hasChildren()||n.length>0)?cn({},QI):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};let h=(t.matcher||eY)(n,e,t);if(!h)return cn({},QI);let r={};Object.entries(h.posParams??{}).forEach(([A,F])=>{r[A]=F.path});let w=h.consumed.length>0?cn(cn({},r),h.consumed[h.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:h.consumed,remainingSegments:n.slice(h.consumed.length),parameters:w,positionalParamSegments:h.posParams??{}}}function oX(e){return{matched:!0,parameters:e.length>0?PN(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}function CN(e,t,n,s){return n.length>0&&lX(e,n,s)?{segmentGroup:new Fr(t,aX(s,new Fr(n,e.children))),slicedSegments:[]}:n.length===0&&cX(e,n,s)?{segmentGroup:new Fr(e.segments,sX(e,n,s,e.children)),slicedSegments:n}:{segmentGroup:new Fr(e.segments,e.children),slicedSegments:n}}function sX(e,t,n,s){let h={};for(let r of n)if(vw(e,t,r)&&!s[Bc(r)]){let w=new Fr([],{});h[Bc(r)]=w}return cn(cn({},s),h)}function aX(e,t){let n={};n[Gi]=t;for(let s of e)if(s.path===""&&Bc(s)!==Gi){let h=new Fr([],{});n[Bc(s)]=h}return n}function lX(e,t,n){return n.some(s=>vw(e,t,s)&&Bc(s)!==Gi)}function cX(e,t,n){return n.some(s=>vw(e,t,s))}function vw(e,t,n){return(e.hasChildren()||t.length>0)&&n.pathMatch==="full"?!1:n.path===""}function uX(e,t,n){return t.length===0&&!e.children[n]}var e2=class{};function hX(e,t,n,s,h,r,w="emptyOnly"){return new t2(e,t,n,s,h,w,r).recognize()}var dX=31,t2=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(t,n,s,h,r,w,A){this.injector=t,this.configLoader=n,this.rootComponentType=s,this.config=h,this.urlTree=r,this.paramsInheritanceStrategy=w,this.urlSerializer=A,this.applyRedirects=new JI(this.urlSerializer,this.urlTree)}noMatchError(t){return new Un(4002,`'${t.segmentGroup}'`)}recognize(){let t=CN(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(ti(({children:n,rootSnapshot:s})=>{let h=new wl(s,n),r=new fw("",h),w=vY(s,[],this.urlTree.queryParams,this.urlTree.fragment);return w.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(w),{state:r,tree:w}}))}match(t){let n=new Lg([],Object.freeze({}),Object.freeze(cn({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Gi,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,t,Gi,n).pipe(ti(s=>({children:s,rootSnapshot:n})),Dd(s=>{if(s instanceof I0)return this.urlTree=s.urlTree,this.match(s.urlTree.root);throw s instanceof S0?this.noMatchError(s):s}))}processSegmentGroup(t,n,s,h,r){return s.segments.length===0&&s.hasChildren()?this.processChildren(t,n,s,r):this.processSegment(t,n,s,s.segments,h,!0,r).pipe(ti(w=>w instanceof wl?[w]:[]))}processChildren(t,n,s,h){let r=[];for(let w of Object.keys(s.children))w==="primary"?r.unshift(w):r.push(w);return cr(r).pipe(gh(w=>{let A=s.children[w],F=SY(n,w);return this.processSegmentGroup(t,F,A,w,h)}),OT((w,A)=>(w.push(...A),w)),Od(null),PT(),Xr(w=>{if(w===null)return Ag(s);let A=KN(w);return fX(A),yi(A)}))}processSegment(t,n,s,h,r,w,A){return cr(n).pipe(gh(F=>this.processSegmentAgainstRoute(F._injector??t,n,F,s,h,r,w,A).pipe(Dd($=>{if($ instanceof S0)return yi(null);throw $}))),mo(F=>!!F),Dd(F=>{if(WN(F))return uX(s,h,r)?yi(new e2):Ag(s);throw F}))}processSegmentAgainstRoute(t,n,s,h,r,w,A,F){return Bc(s)!==w&&(w===Gi||!vw(h,r,s))?Ag(h):s.redirectTo===void 0?this.matchSegmentAgainstRoute(t,h,s,r,w,F):this.allowRedirects&&A?this.expandSegmentAgainstRouteUsingRedirect(t,h,n,s,r,w,F):Ag(h)}expandSegmentAgainstRouteUsingRedirect(t,n,s,h,r,w,A){let{matched:F,parameters:$,consumedSegments:K,positionalParamSegments:se,remainingSegments:le}=XN(n,h,r);if(!F)return Ag(n);typeof h.redirectTo=="string"&&h.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>dX&&(this.allowRedirects=!1));let ae=new Lg(r,$,Object.freeze(cn({},this.urlTree.queryParams)),this.urlTree.fragment,MN(h),Bc(h),h.component??h._loadedComponent??null,h,TN(h)),Ze=dw(ae,A,this.paramsInheritanceStrategy);ae.params=Object.freeze(Ze.params),ae.data=Object.freeze(Ze.data);let Ue=this.applyRedirects.applyRedirectCommands(K,h.redirectTo,se,ae,t);return this.applyRedirects.lineralizeSegments(h,Ue).pipe(Xr(ft=>this.processSegment(t,s,n,ft.concat(le),w,!1,A)))}matchSegmentAgainstRoute(t,n,s,h,r,w){let A=rX(n,s,h,t,this.urlSerializer);return s.path==="**"&&(n.children={}),A.pipe(Vr(F=>F.matched?(t=s._injector??t,this.getChildConfig(t,s,h).pipe(Vr(({routes:$})=>{let K=s._loadedInjector??t,{parameters:se,consumedSegments:le,remainingSegments:ae}=F,Ze=new Lg(le,se,Object.freeze(cn({},this.urlTree.queryParams)),this.urlTree.fragment,MN(s),Bc(s),s.component??s._loadedComponent??null,s,TN(s)),Ue=dw(Ze,w,this.paramsInheritanceStrategy);Ze.params=Object.freeze(Ue.params),Ze.data=Object.freeze(Ue.data);let{segmentGroup:ft,slicedSegments:Xe}=CN(n,le,ae,$);if(Xe.length===0&&ft.hasChildren())return this.processChildren(K,$,ft,Ze).pipe(ti(Ut=>new wl(Ze,Ut)));if($.length===0&&Xe.length===0)return yi(new wl(Ze,[]));let st=Bc(s)===r;return this.processSegment(K,$,ft,Xe,st?Gi:r,!0,Ze).pipe(ti(Ut=>new wl(Ze,Ut instanceof wl?[Ut]:[])))}))):Ag(n)))}getChildConfig(t,n,s){return n.children?yi({routes:n.children,injector:t}):n.loadChildren?n._loadedRoutes!==void 0?yi({routes:n._loadedRoutes,injector:n._loadedInjector}):eX(t,n,s,this.urlSerializer).pipe(Xr(h=>h?this.configLoader.loadChildren(t,n).pipe(pi(r=>{n._loadedRoutes=r.routes,n._loadedInjector=r.injector})):iX(n))):yi({routes:[],injector:t})}};function fX(e){e.sort((t,n)=>t.value.outlet===Gi?-1:n.value.outlet===Gi?1:t.value.outlet.localeCompare(n.value.outlet))}function pX(e){let t=e.value.routeConfig;return t&&t.path===""}function KN(e){let t=[],n=new Set;for(let s of e){if(!pX(s)){t.push(s);continue}let h=t.find(r=>s.value.routeConfig===r.value.routeConfig);h!==void 0?(h.children.push(...s.children),n.add(h)):t.push(s)}for(let s of n){let h=KN(s.children);t.push(new wl(s.value,h))}return t.filter(s=>!n.has(s))}function MN(e){return e.data||{}}function TN(e){return e.resolve||{}}function mX(e,t,n,s,h,r){return Xr(w=>hX(e,t,n,s,w.extractedUrl,h,r).pipe(ti(({state:A,tree:F})=>lr(cn({},w),{targetSnapshot:A,urlAfterRedirects:F}))))}function gX(e,t){return Xr(n=>{let{targetSnapshot:s,guards:{canActivateChecks:h}}=n;if(!h.length)return yi(n);let r=new Set(h.map(F=>F.route)),w=new Set;for(let F of r)if(!w.has(F))for(let $ of JN(F))w.add($);let A=0;return cr(w).pipe(gh(F=>r.has(F)?_X(F,s,e,t):(F.data=dw(F,F.parent,e).resolve,yi(void 0))),pi(()=>A++),kd(1),Xr(F=>A===w.size?yi(n):Ds))})}function JN(e){let t=e.children.map(n=>JN(n)).flat();return[e,...t]}function _X(e,t,n,s){let h=e.routeConfig,r=e._resolve;return h?.title!==void 0&&!$N(h)&&(r[P0]=h.title),yX(r,e,t,s).pipe(ti(w=>(e._resolvedData=w,e.data=dw(e,e.parent,n).resolve,null)))}function yX(e,t,n,s){let h=AI(e);if(h.length===0)return yi({});let r={};return cr(h).pipe(Xr(w=>vX(e[w],t,n,s).pipe(mo(),pi(A=>{if(A instanceof E0)throw pw(new zg,A);r[w]=A}))),kd(1),Ry(r),Dd(w=>WN(w)?Ds:hg(w)))}function vX(e,t,n,s){let h=O0(t)??s,r=Ug(e,h),w=r.resolve?r.resolve(t,n):$a(h,()=>r(t,n));return Xd(w)}function DI(e){return Vr(t=>{let n=e(t);return n?cr(n).pipe(ti(()=>t)):yi(t)})}var QN=(()=>{class e{buildTitle(n){let s,h=n.root;for(;h!==void 0;)s=this.getResolvedTitleForRoute(h)??s,h=h.children.find(r=>r.outlet===Gi);return s}getResolvedTitleForRoute(n){return n.data[P0]}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:()=>Qt(xX),providedIn:"root"})}return e})(),xX=(()=>{class e extends QN{title;constructor(n){super(),this.title=n}updateTitle(n){let s=this.buildTitle(n);s!==void 0&&this.title.setTitle(s)}static \u0275fac=function(s){return new(s||e)(Bn(Qb))};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),k0=new Hn("",{providedIn:"root",factory:()=>({})}),bX=(()=>{class e{static \u0275fac=function(s){return new(s||e)};static \u0275cmp=Ci({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(s,h){s&1&&qt(0,"router-outlet")},dependencies:[r2],encapsulation:2})}return e})();function o2(e){let t=e.children&&e.children.map(o2),n=t?lr(cn({},e),{children:t}):cn({},e);return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==Gi&&(n.component=bX),n}var gw=new Hn(""),s2=(()=>{class e{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=Qt(jb);loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return yi(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);let s=Xd(n.loadComponent()).pipe(ti(ez),pi(r=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=r}),Rd(()=>{this.componentLoaders.delete(n)})),h=new rg(s,()=>new Ii).pipe(ig());return this.componentLoaders.set(n,h),h}loadChildren(n,s){if(this.childrenLoaders.get(s))return this.childrenLoaders.get(s);if(s._loadedRoutes)return yi({routes:s._loadedRoutes,injector:s._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(s);let r=wX(s,this.compiler,n,this.onLoadEndListener).pipe(Rd(()=>{this.childrenLoaders.delete(s)})),w=new rg(r,()=>new Ii).pipe(ig());return this.childrenLoaders.set(s,w),w}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function wX(e,t,n,s){return Xd(e.loadChildren()).pipe(ti(ez),Xr(h=>h instanceof Yy||Array.isArray(h)?yi(h):cr(t.compileModuleAsync(h))),ti(h=>{s&&s(e);let r,w,A=!1;return Array.isArray(h)?(w=h,A=!0):(r=h.create(n).injector,w=r.get(gw,[],{optional:!0,self:!0}).flat()),{routes:w.map(o2),injector:r}}))}function CX(e){return e&&typeof e=="object"&&"default"in e}function ez(e){return CX(e)?e.default:e}var a2=(()=>{class e{static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:()=>Qt(MX),providedIn:"root"})}return e})(),MX=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,s){return n}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),tz=new Hn(""),nz=new Hn("");function TX(e,t,n){let s=e.get(nz),h=e.get(rs);return e.get($r).runOutsideAngular(()=>{if(!h.startViewTransition||s.skipNextTransition)return s.skipNextTransition=!1,new Promise($=>setTimeout($));let r,w=new Promise($=>{r=$}),A=h.startViewTransition(()=>(r(),EX(e))),{onViewTransitionCreated:F}=s;return F&&$a(e,()=>F({transition:A,from:t,to:n})),w})}function EX(e){return new Promise(t=>{IS({read:()=>setTimeout(t)},{injector:e})})}var iz=new Hn(""),l2=(()=>{class e{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new Ii;transitionAbortSubject=new Ii;configLoader=Qt(s2);environmentInjector=Qt(xa);urlSerializer=Qt(D0);rootContexts=Qt(A0);location=Qt(Og);inputBindingEnabled=Qt(yw,{optional:!0})!==null;titleStrategy=Qt(QN);options=Qt(k0,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=Qt(a2);createViewTransition=Qt(tz,{optional:!0});navigationErrorHandler=Qt(iz,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>yi(void 0);rootComponentType=null;constructor(){let n=h=>this.events.next(new VI(h)),s=h=>this.events.next(new jI(h));this.configLoader.onLoadEndListener=s,this.configLoader.onLoadStartListener=n}complete(){this.transitions?.complete()}handleNavigationRequest(n){let s=++this.navigationId;this.transitions?.next(lr(cn(cn({},this.transitions.value),n),{id:s}))}setupNavigations(n,s,h){return this.transitions=new po({id:0,currentUrlTree:s,currentRawUrl:s,extractedUrl:this.urlHandlingStrategy.extract(s),urlAfterRedirects:this.urlHandlingStrategy.extract(s),rawUrl:s,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:x0,restoredState:null,currentSnapshot:h.snapshot,targetSnapshot:null,currentRouterState:h,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(io(r=>r.id!==0),ti(r=>lr(cn({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),Vr(r=>{let w=!1,A=!1;return yi(r).pipe(Vr(F=>{if(this.navigationId>r.id)return this.cancelNavigationTransition(r,"",Cl.SupersededByNewNavigation),Ds;this.currentTransition=r,this.currentNavigation={id:F.id,initialUrl:F.rawUrl,extractedUrl:F.extractedUrl,targetBrowserUrl:typeof F.extras.browserUrl=="string"?this.urlSerializer.parse(F.extras.browserUrl):F.extras.browserUrl,trigger:F.source,extras:F.extras,previousNavigation:this.lastSuccessfulNavigation?lr(cn({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let $=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),K=F.extras.onSameUrlNavigation??n.onSameUrlNavigation;if(!$&&K!=="reload"){let se="";return this.events.next(new Yd(F.id,this.urlSerializer.serialize(F.rawUrl),se,aw.IgnoredSameUrlNavigation)),F.resolve(!1),Ds}if(this.urlHandlingStrategy.shouldProcessUrl(F.rawUrl))return yi(F).pipe(Vr(se=>{let le=this.transitions?.getValue();return this.events.next(new Bg(se.id,this.urlSerializer.serialize(se.extractedUrl),se.source,se.restoredState)),le!==this.transitions?.getValue()?Ds:Promise.resolve(se)}),mX(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),pi(se=>{r.targetSnapshot=se.targetSnapshot,r.urlAfterRedirects=se.urlAfterRedirects,this.currentNavigation=lr(cn({},this.currentNavigation),{finalUrl:se.urlAfterRedirects});let le=new lw(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(le)}));if($&&this.urlHandlingStrategy.shouldProcessUrl(F.currentRawUrl)){let{id:se,extractedUrl:le,source:ae,restoredState:Ze,extras:Ue}=F,ft=new Bg(se,this.urlSerializer.serialize(le),ae,Ze);this.events.next(ft);let Xe=UN(this.rootComponentType).snapshot;return this.currentTransition=r=lr(cn({},F),{targetSnapshot:Xe,urlAfterRedirects:le,extras:lr(cn({},Ue),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=le,yi(r)}else{let se="";return this.events.next(new Yd(F.id,this.urlSerializer.serialize(F.extractedUrl),se,aw.IgnoredByUrlHandlingStrategy)),F.resolve(!1),Ds}}),pi(F=>{let $=new FI(F.id,this.urlSerializer.serialize(F.extractedUrl),this.urlSerializer.serialize(F.urlAfterRedirects),F.targetSnapshot);this.events.next($)}),ti(F=>(this.currentTransition=r=lr(cn({},F),{guards:LY(F.targetSnapshot,F.currentSnapshot,this.rootContexts)}),r)),qY(this.environmentInjector,F=>this.events.next(F)),pi(F=>{if(r.guardsResult=F.guardsResult,F.guardsResult&&typeof F.guardsResult!="boolean")throw pw(this.urlSerializer,F.guardsResult);let $=new NI(F.id,this.urlSerializer.serialize(F.extractedUrl),this.urlSerializer.serialize(F.urlAfterRedirects),F.targetSnapshot,!!F.guardsResult);this.events.next($)}),io(F=>F.guardsResult?!0:(this.cancelNavigationTransition(F,"",Cl.GuardRejected),!1)),DI(F=>{if(F.guards.canActivateChecks.length)return yi(F).pipe(pi($=>{let K=new zI($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(K)}),Vr($=>{let K=!1;return yi($).pipe(gX(this.paramsInheritanceStrategy,this.environmentInjector),pi({next:()=>K=!0,complete:()=>{K||this.cancelNavigationTransition($,"",Cl.NoDataFromResolver)}}))}),pi($=>{let K=new BI($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(K)}))}),DI(F=>{let $=K=>{let se=[];K.routeConfig?.loadComponent&&!K.routeConfig._loadedComponent&&se.push(this.configLoader.loadComponent(K.routeConfig).pipe(pi(le=>{K.component=le}),ti(()=>{})));for(let le of K.children)se.push(...$(le));return se};return Oy($(F.targetSnapshot.root)).pipe(Od(null),Qs(1))}),DI(()=>this.afterPreactivation()),Vr(()=>{let{currentSnapshot:F,targetSnapshot:$}=r,K=this.createViewTransition?.(this.environmentInjector,F.root,$.root);return K?cr(K).pipe(ti(()=>r)):yi(r)}),ti(F=>{let $=DY(n.routeReuseStrategy,F.targetSnapshot,F.currentRouterState);return this.currentTransition=r=lr(cn({},F),{targetRouterState:$}),this.currentNavigation.targetRouterState=$,r}),pi(()=>{this.events.next(new M0)}),kY(this.rootContexts,n.routeReuseStrategy,F=>this.events.next(F),this.inputBindingEnabled),Qs(1),pi({next:F=>{w=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Xl(F.id,this.urlSerializer.serialize(F.extractedUrl),this.urlSerializer.serialize(F.urlAfterRedirects))),this.titleStrategy?.updateTitle(F.targetRouterState.snapshot),F.resolve(!0)},complete:()=>{w=!0}}),sp(this.transitionAbortSubject.pipe(pi(F=>{throw F}))),Rd(()=>{!w&&!A&&this.cancelNavigationTransition(r,"",Cl.SupersededByNewNavigation),this.currentTransition?.id===r.id&&(this.currentNavigation=null,this.currentTransition=null)}),Dd(F=>{if(A=!0,ZN(F))this.events.next(new Ah(r.id,this.urlSerializer.serialize(r.extractedUrl),F.message,F.cancellationCode)),RY(F)?this.events.next(new Vg(F.url,F.navigationBehaviorOptions)):r.resolve(!1);else{let $=new C0(r.id,this.urlSerializer.serialize(r.extractedUrl),F,r.targetSnapshot??void 0);try{let K=$a(this.environmentInjector,()=>this.navigationErrorHandler?.($));if(K instanceof E0){let{message:se,cancellationCode:le}=pw(this.urlSerializer,K);this.events.next(new Ah(r.id,this.urlSerializer.serialize(r.extractedUrl),se,le)),this.events.next(new Vg(K.redirectTo,K.navigationBehaviorOptions))}else throw this.events.next($),F}catch(K){this.options.resolveNavigationPromiseOnError?r.resolve(!1):r.reject(K)}}return Ds}))}))}cancelNavigationTransition(n,s,h){let r=new Ah(n.id,this.urlSerializer.serialize(n.extractedUrl),s,h);this.events.next(r),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let n=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),s=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return n.toString()!==s?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function SX(e){return e!==x0}var IX=(()=>{class e{static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:()=>Qt(PX),providedIn:"root"})}return e})(),n2=class{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}},PX=(()=>{class e extends n2{static \u0275fac=(()=>{let n;return function(h){return(n||(n=bb(e)))(h||e)}})();static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),rz=(()=>{class e{static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:()=>Qt(DX),providedIn:"root"})}return e})(),DX=(()=>{class e extends rz{location=Qt(Og);urlSerializer=Qt(D0);options=Qt(k0,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=Qt(a2);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Rh;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=UN(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(s=>{s.type==="popstate"&&n(s.url,s.state)})}handleRouterEvent(n,s){if(n instanceof Bg)this.stateMemento=this.createStateMemento();else if(n instanceof Yd)this.rawUrlTree=s.initialUrl;else if(n instanceof lw){if(this.urlUpdateStrategy==="eager"&&!s.extras.skipLocationChange){let h=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl);this.setBrowserUrl(s.targetBrowserUrl??h,s)}}else n instanceof M0?(this.currentUrlTree=s.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl),this.routerState=s.targetRouterState,this.urlUpdateStrategy==="deferred"&&!s.extras.skipLocationChange&&this.setBrowserUrl(s.targetBrowserUrl??this.rawUrlTree,s)):n instanceof Ah&&(n.code===Cl.GuardRejected||n.code===Cl.NoDataFromResolver)?this.restoreHistory(s):n instanceof C0?this.restoreHistory(s,!0):n instanceof Xl&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,s){let h=n instanceof Rh?this.urlSerializer.serialize(n):n;if(this.location.isCurrentPathEqualTo(h)||s.extras.replaceUrl){let r=this.browserPageId,w=cn(cn({},s.extras.state),this.generateNgRouterState(s.id,r));this.location.replaceState(h,"",w)}else{let r=cn(cn({},s.extras.state),this.generateNgRouterState(s.id,this.browserPageId+1));this.location.go(h,"",r)}}restoreHistory(n,s=!1){if(this.canceledNavigationResolution==="computed"){let h=this.browserPageId,r=this.currentPageId-h;r!==0?this.location.historyGo(r):this.currentUrlTree===n.finalUrl&&r===0&&(this.resetState(n),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(s&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,s){return this.canceledNavigationResolution==="computed"?{navigationId:n,\u0275routerPageId:s}:{navigationId:n}}static \u0275fac=(()=>{let n;return function(h){return(n||(n=bb(e)))(h||e)}})();static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),y0=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(y0||{});function oz(e,t){e.events.pipe(io(n=>n instanceof Xl||n instanceof Ah||n instanceof C0||n instanceof Yd),ti(n=>n instanceof Xl||n instanceof Yd?y0.COMPLETE:(n instanceof Ah?n.code===Cl.Redirect||n.code===Cl.SupersededByNewNavigation:!1)?y0.REDIRECTING:y0.FAILED),io(n=>n!==y0.REDIRECTING),Qs(1)).subscribe(()=>{t()})}var OX={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},AX={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},qa=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=Qt(Rb);stateManager=Qt(rz);options=Qt(k0,{optional:!0})||{};pendingTasks=Qt(Su);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=Qt(l2);urlSerializer=Qt(D0);location=Qt(Og);urlHandlingStrategy=Qt(a2);_events=new Ii;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=Qt(IX);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=Qt(gw,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!Qt(yw,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}eventsSubscription=new to;subscribeToNavigationEvents(){let n=this.navigationTransitions.events.subscribe(s=>{try{let h=this.navigationTransitions.currentTransition,r=this.navigationTransitions.currentNavigation;if(h!==null&&r!==null){if(this.stateManager.handleRouterEvent(s,r),s instanceof Ah&&s.code!==Cl.Redirect&&s.code!==Cl.SupersededByNewNavigation)this.navigated=!0;else if(s instanceof Xl)this.navigated=!0;else if(s instanceof Vg){let w=s.navigationBehaviorOptions,A=this.urlHandlingStrategy.merge(s.url,h.currentRawUrl),F=cn({browserUrl:h.extras.browserUrl,info:h.extras.info,skipLocationChange:h.extras.skipLocationChange,replaceUrl:h.extras.replaceUrl||this.urlUpdateStrategy==="eager"||SX(h.source)},w);this.scheduleNavigation(A,x0,null,F,{resolve:h.resolve,reject:h.reject,promise:h.promise})}}kX(s)&&this._events.next(s)}catch(h){this.navigationTransitions.transitionAbortSubject.next(h)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),x0,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,s)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(n,"popstate",s)},0)})}navigateToSyncWithBrowser(n,s,h){let r={replaceUrl:!0},w=h?.navigationId?h:null;if(h){let F=cn({},h);delete F.navigationId,delete F.\u0275routerPageId,Object.keys(F).length!==0&&(r.state=F)}let A=this.parseUrl(n);this.scheduleNavigation(A,s,w,r)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(o2),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,s={}){let{relativeTo:h,queryParams:r,fragment:w,queryParamsHandling:A,preserveFragment:F}=s,$=F?this.currentUrlTree.fragment:w,K=null;switch(A??this.options.defaultQueryParamsHandling){case"merge":K=cn(cn({},this.currentUrlTree.queryParams),r);break;case"preserve":K=this.currentUrlTree.queryParams;break;default:K=r||null}K!==null&&(K=this.removeEmptyProps(K));let se;try{let le=h?h.snapshot:this.routerState.snapshot.root;se=zN(le)}catch{(typeof n[0]!="string"||n[0][0]!=="/")&&(n=[]),se=this.currentUrlTree.root}return BN(se,n,K,$??null)}navigateByUrl(n,s={skipLocationChange:!1}){let h=Tp(n)?n:this.parseUrl(n),r=this.urlHandlingStrategy.merge(h,this.rawUrlTree);return this.scheduleNavigation(r,x0,null,s)}navigate(n,s={skipLocationChange:!1}){return RX(n),this.navigateByUrl(this.createUrlTree(n,s),s)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,s){let h;if(s===!0?h=cn({},OX):s===!1?h=cn({},AX):h=s,Tp(n))return yN(this.currentUrlTree,n,h);let r=this.parseUrl(n);return yN(this.currentUrlTree,r,h)}removeEmptyProps(n){return Object.entries(n).reduce((s,[h,r])=>(r!=null&&(s[h]=r),s),{})}scheduleNavigation(n,s,h,r,w){if(this.disposed)return Promise.resolve(!1);let A,F,$;w?(A=w.resolve,F=w.reject,$=w.promise):$=new Promise((se,le)=>{A=se,F=le});let K=this.pendingTasks.add();return oz(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(K))}),this.navigationTransitions.handleNavigationRequest({source:s,restoredState:h,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:r,resolve:A,reject:F,promise:$,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),$.catch(se=>Promise.reject(se))}static \u0275fac=function(s){return new(s||e)};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function RX(e){for(let t=0;t<e.length;t++)if(e[t]==null)throw new Un(4008,!1)}function kX(e){return!(e instanceof M0)&&!(e instanceof Vg)}var sz=(()=>{class e{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new Ii;constructor(n,s,h,r,w,A){this.router=n,this.route=s,this.tabIndexAttribute=h,this.renderer=r,this.el=w,this.locationStrategy=A;let F=w.nativeElement.tagName?.toLowerCase();this.isAnchorElement=F==="a"||F==="area",this.isAnchorElement?this.subscription=n.events.subscribe($=>{$ instanceof Xl&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(n){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(n){n==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Tp(n)?this.routerLinkInput=n:this.routerLinkInput=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0"))}onClick(n,s,h,r,w){let A=this.urlTree;if(A===null||this.isAnchorElement&&(n!==0||s||h||r||w||typeof this.target=="string"&&this.target!="_self"))return!0;let F={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(A,F),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let n=this.urlTree;this.href=n!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(n)):null;let s=this.href===null?null:S3(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",s)}applyAttributeValue(n,s){let h=this.renderer,r=this.el.nativeElement;s!==null?h.setAttribute(r,n,s):h.removeAttribute(r,n)}get urlTree(){return this.routerLinkInput===null?null:Tp(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(s){return new(s||e)(Fn(qa),Fn(Ea),vS("tabindex"),Fn(s0),Fn(Po),Fn(Dh))};static \u0275dir=Ih({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(s,h){s&1&&Yn("click",function(w){return h.onClick(w.button,w.ctrlKey,w.shiftKey,w.altKey,w.metaKey)}),s&2&&xr("target",h.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Pg],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Pg],replaceUrl:[2,"replaceUrl","replaceUrl",Pg],routerLink:"routerLink"},features:[ZS,Os]})}return e})();var _w=class{};var LX=(()=>{class e{router;injector;preloadingStrategy;loader;subscription;constructor(n,s,h,r,w){this.router=n,this.injector=h,this.preloadingStrategy=r,this.loader=w}setUpPreloading(){this.subscription=this.router.events.pipe(io(n=>n instanceof Xl),gh(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,s){let h=[];for(let r of s){r.providers&&!r._injector&&(r._injector=Ab(r.providers,n,`Route: ${r.path}`));let w=r._injector??n,A=r._loadedInjector??w;(r.loadChildren&&!r._loadedRoutes&&r.canLoad===void 0||r.loadComponent&&!r._loadedComponent)&&h.push(this.preloadConfig(w,r)),(r.children||r._loadedRoutes)&&h.push(this.processRoutes(A,r.children??r._loadedRoutes))}return cr(h).pipe(xu())}preloadConfig(n,s){return this.preloadingStrategy.preload(s,()=>{let h;s.loadChildren&&s.canLoad===void 0?h=this.loader.loadChildren(n,s):h=yi(null);let r=h.pipe(Xr(w=>w===null?yi(void 0):(s._loadedRoutes=w.routes,s._loadedInjector=w.injector,this.processRoutes(w.injector??n,w.routes))));if(s.loadComponent&&!s._loadedComponent){let w=this.loader.loadComponent(s);return cr([r,w]).pipe(xu())}else return r})}static \u0275fac=function(s){return new(s||e)(Bn(qa),Bn(jb),Bn(xa),Bn(_w),Bn(s2))};static \u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),az=new Hn(""),FX=(()=>{class e{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource="imperative";restoredId=0;store={};constructor(n,s,h,r,w={}){this.urlSerializer=n,this.transitions=s,this.viewportScroller=h,this.zone=r,this.options=w,w.scrollPositionRestoration||="disabled",w.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof Bg?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Xl?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof Yd&&n.code===aw.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof cw&&(n.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(n.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,s){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new cw(n,this.lastSource==="popstate"?this.store[this.restoredId]:null,s))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(s){B3()};static \u0275prov=wn({token:e,factory:e.\u0275fac})}return e})();function NX(e){return e.routerState.root}function L0(e,t){return{\u0275kind:e,\u0275providers:t}}function zX(){let e=Qt(ba);return t=>{let n=e.get(Eu);if(t!==n.components[0])return;let s=e.get(qa),h=e.get(lz);e.get(c2)===1&&s.initialNavigation(),e.get(cz,null,Zi.Optional)?.setUpPreloading(),e.get(az,null,Zi.Optional)?.init(),s.resetRootComponentType(n.componentTypes[0]),h.closed||(h.next(),h.complete(),h.unsubscribe())}}var lz=new Hn("",{factory:()=>new Ii}),c2=new Hn("",{providedIn:"root",factory:()=>1});function BX(){return L0(2,[{provide:c2,useValue:0},{provide:Fb,multi:!0,deps:[ba],useFactory:t=>{let n=t.get(zF,Promise.resolve());return()=>n.then(()=>new Promise(s=>{let h=t.get(qa),r=t.get(lz);oz(h,()=>{s(!0)}),t.get(l2).afterPreactivation=()=>(s(!0),r.closed?yi(void 0):r),h.initialNavigation()}))}}])}function VX(){return L0(3,[{provide:Fb,multi:!0,useFactory:()=>{let t=Qt(qa);return()=>{t.setUpLocationChangeListener()}}},{provide:c2,useValue:2}])}var cz=new Hn("");function jX(e){return L0(0,[{provide:cz,useExisting:LX},{provide:_w,useExisting:e}])}function UX(){return L0(8,[wN,{provide:yw,useExisting:wN}])}function HX(e){let t=[{provide:tz,useValue:TX},{provide:nz,useValue:cn({skipNextTransition:!!e?.skipInitialTransition},e)}];return L0(9,t)}var EN=new Hn("ROUTER_FORROOT_GUARD"),$X=[Og,{provide:D0,useClass:zg},qa,A0,{provide:Ea,useFactory:NX,deps:[qa]},s2,[]],u2=(()=>{class e{constructor(n){}static forRoot(n,s){return{ngModule:e,providers:[$X,[],{provide:gw,multi:!0,useValue:n},{provide:EN,useFactory:WX,deps:[[qa,new db,new rS]]},s?.errorHandler?{provide:iz,useValue:s.errorHandler}:[],{provide:k0,useValue:s||{}},s?.useHash?qX():ZX(),GX(),s?.preloadingStrategy?jX(s.preloadingStrategy).\u0275providers:[],s?.initialNavigation?YX(s):[],s?.bindToComponentInputs?UX().\u0275providers:[],s?.enableViewTransitions?HX().\u0275providers:[],XX()]}}static forChild(n){return{ngModule:e,providers:[{provide:gw,multi:!0,useValue:n}]}}static \u0275fac=function(s){return new(s||e)(Bn(EN,8))};static \u0275mod=Ta({type:e});static \u0275inj=wa({})}return e})();function GX(){return{provide:az,useFactory:()=>{let e=Qt($F),t=Qt($r),n=Qt(k0),s=Qt(l2),h=Qt(D0);return n.scrollOffset&&e.setOffset(n.scrollOffset),new FX(h,s,e,t,n)}}}function qX(){return{provide:Dh,useClass:VF}}function ZX(){return{provide:Dh,useClass:hI}}function WX(e){return"guarded"}function YX(e){return[e.initialNavigation==="disabled"?VX().\u0275providers:[],e.initialNavigation==="enabledBlocking"?BX().\u0275providers:[]]}var SN=new Hn("");function XX(){return[{provide:SN,useFactory:zX},{provide:Nb,multi:!0,useExisting:SN}]}function gz(){return{baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}var $g=gz();function KX(e){$g=e}var JX=/[&<>"']/,QX=/[&<>"']/g,eK=/[<>"']|&(?!#?\w+;)/,tK=/[<>"']|&(?!#?\w+;)/g,nK={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},uz=e=>nK[e];function ws(e,t){if(t){if(JX.test(e))return e.replace(QX,uz)}else if(eK.test(e))return e.replace(tK,uz);return e}var iK=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function _z(e){return e.replace(iK,(t,n)=>(n=n.toLowerCase(),n==="colon"?":":n.charAt(0)==="#"?n.charAt(1)==="x"?String.fromCharCode(parseInt(n.substring(2),16)):String.fromCharCode(+n.substring(1)):""))}var rK=/(^|[^\[])\^/g;function Jr(e,t){e=typeof e=="string"?e:e.source,t=t||"";let n={replace:(s,h)=>(h=h.source||h,h=h.replace(rK,"$1"),e=e.replace(s,h),n),getRegex:()=>new RegExp(e,t)};return n}var oK=/[^\w:]/g,sK=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function hz(e,t,n){if(e){let s;try{s=decodeURIComponent(_z(n)).replace(oK,"").toLowerCase()}catch{return null}if(s.indexOf("javascript:")===0||s.indexOf("vbscript:")===0||s.indexOf("data:")===0)return null}t&&!sK.test(n)&&(n=uK(t,n));try{n=encodeURI(n).replace(/%25/g,"%")}catch{return null}return n}var xw={},aK=/^[^:]+:\/*[^/]*$/,lK=/^([^:]+:)[\s\S]*$/,cK=/^([^:]+:\/*[^/]*)[\s\S]*$/;function uK(e,t){xw[" "+e]||(aK.test(e)?xw[" "+e]=e+"/":xw[" "+e]=bw(e,"/",!0)),e=xw[" "+e];let n=e.indexOf(":")===-1;return t.substring(0,2)==="//"?n?t:e.replace(lK,"$1")+t:t.charAt(0)==="/"?n?t:e.replace(cK,"$1")+t:e+t}var ww={exec:function(){}};function Vc(e){let t=1,n,s;for(;t<arguments.length;t++){n=arguments[t];for(s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}function dz(e,t){let n=e.replace(/\|/g,(r,w,A)=>{let F=!1,$=w;for(;--$>=0&&A[$]==="\\";)F=!F;return F?"|":" |"}),s=n.split(/ \|/),h=0;if(s[0].trim()||s.shift(),s.length>0&&!s[s.length-1].trim()&&s.pop(),s.length>t)s.splice(t);else for(;s.length<t;)s.push("");for(;h<s.length;h++)s[h]=s[h].trim().replace(/\\\|/g,"|");return s}function bw(e,t,n){let s=e.length;if(s===0)return"";let h=0;for(;h<s;){let r=e.charAt(s-h-1);if(r===t&&!n)h++;else if(r!==t&&n)h++;else break}return e.slice(0,s-h)}function hK(e,t){if(e.indexOf(t[1])===-1)return-1;let n=e.length,s=0,h=0;for(;h<n;h++)if(e[h]==="\\")h++;else if(e[h]===t[0])s++;else if(e[h]===t[1]&&(s--,s<0))return h;return-1}function yz(e){e&&e.sanitize&&!e.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function fz(e,t){if(t<1)return"";let n="";for(;t>1;)t&1&&(n+=e),t>>=1,e+=e;return n+e}function pz(e,t,n,s){let h=t.href,r=t.title?ws(t.title):null,w=e[1].replace(/\\([\[\]])/g,"$1");if(e[0].charAt(0)!=="!"){s.state.inLink=!0;let A={type:"link",raw:n,href:h,title:r,text:w,tokens:s.inlineTokens(w,[])};return s.state.inLink=!1,A}return{type:"image",raw:n,href:h,title:r,text:ws(w)}}function dK(e,t){let n=e.match(/^(\s+)(?:```)/);if(n===null)return t;let s=n[1];return t.split(`
`).map(h=>{let r=h.match(/^\s+/);if(r===null)return h;let[w]=r;return w.length>=s.length?h.slice(s.length):h}).join(`
`)}var F0=class{constructor(t){this.options=t||$g}space(t){let n=this.rules.block.newline.exec(t);if(n&&n[0].length>0)return{type:"space",raw:n[0]}}code(t){let n=this.rules.block.code.exec(t);if(n){let s=n[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:n[0],codeBlockStyle:"indented",text:this.options.pedantic?s:bw(s,`
`)}}}fences(t){let n=this.rules.block.fences.exec(t);if(n){let s=n[0],h=dK(s,n[3]||"");return{type:"code",raw:s,lang:n[2]?n[2].trim():n[2],text:h}}}heading(t){let n=this.rules.block.heading.exec(t);if(n){let s=n[2].trim();if(/#$/.test(s)){let r=bw(s,"#");(this.options.pedantic||!r||/ $/.test(r))&&(s=r.trim())}let h={type:"heading",raw:n[0],depth:n[1].length,text:s,tokens:[]};return this.lexer.inline(h.text,h.tokens),h}}hr(t){let n=this.rules.block.hr.exec(t);if(n)return{type:"hr",raw:n[0]}}blockquote(t){let n=this.rules.block.blockquote.exec(t);if(n){let s=n[0].replace(/^ *>[ \t]?/gm,"");return{type:"blockquote",raw:n[0],tokens:this.lexer.blockTokens(s,[]),text:s}}}list(t){let n=this.rules.block.list.exec(t);if(n){let s,h,r,w,A,F,$,K,se,le,ae,Ze,Ue=n[1].trim(),ft=Ue.length>1,Xe={type:"list",raw:"",ordered:ft,start:ft?+Ue.slice(0,-1):"",loose:!1,items:[]};Ue=ft?`\\d{1,9}\\${Ue.slice(-1)}`:`\\${Ue}`,this.options.pedantic&&(Ue=ft?Ue:"[*+-]");let st=new RegExp(`^( {0,3}${Ue})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;t&&(Ze=!1,!(!(n=st.exec(t))||this.rules.block.hr.test(t)));){if(s=n[0],t=t.substring(s.length),K=n[2].split(`
`,1)[0],se=t.split(`
`,1)[0],this.options.pedantic?(w=2,ae=K.trimLeft()):(w=n[2].search(/[^ ]/),w=w>4?1:w,ae=K.slice(w),w+=n[1].length),F=!1,!K&&/^ *$/.test(se)&&(s+=se+`
`,t=t.substring(se.length+1),Ze=!0),!Ze){let Bt=new RegExp(`^ {0,${Math.min(3,w-1)}}(?:[*+-]|\\d{1,9}[.)])((?: [^\\n]*)?(?:\\n|$))`),xt=new RegExp(`^ {0,${Math.min(3,w-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),yt=new RegExp(`^( {0,${Math.min(3,w-1)}})(\`\`\`|~~~)`);for(;t&&(le=t.split(`
`,1)[0],K=le,this.options.pedantic&&(K=K.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(yt.test(K)||this.rules.block.heading.test(K)||Bt.test(K)||xt.test(t)));){if(K.search(/[^ ]/)>=w||!K.trim())ae+=`
`+K.slice(w);else if(!F)ae+=`
`+K;else break;!F&&!K.trim()&&(F=!0),s+=le+`
`,t=t.substring(le.length+1)}}Xe.loose||($?Xe.loose=!0:/\n *\n *$/.test(s)&&($=!0)),this.options.gfm&&(h=/^\[[ xX]\] /.exec(ae),h&&(r=h[0]!=="[ ] ",ae=ae.replace(/^\[[ xX]\] +/,""))),Xe.items.push({type:"list_item",raw:s,task:!!h,checked:r,loose:!1,text:ae}),Xe.raw+=s}Xe.items[Xe.items.length-1].raw=s.trimRight(),Xe.items[Xe.items.length-1].text=ae.trimRight(),Xe.raw=Xe.raw.trimRight();let Ut=Xe.items.length;for(A=0;A<Ut;A++){this.lexer.state.top=!1,Xe.items[A].tokens=this.lexer.blockTokens(Xe.items[A].text,[]);let Bt=Xe.items[A].tokens.filter(yt=>yt.type==="space"),xt=Bt.every(yt=>{let rn=yt.raw.split(""),Dt=0;for(let Tt of rn)if(Tt===`
`&&(Dt+=1),Dt>1)return!0;return!1});!Xe.loose&&Bt.length&&xt&&(Xe.loose=!0,Xe.items[A].loose=!0)}return Xe}}html(t){let n=this.rules.block.html.exec(t);if(n){let s={type:"html",raw:n[0],pre:!this.options.sanitizer&&(n[1]==="pre"||n[1]==="script"||n[1]==="style"),text:n[0]};return this.options.sanitize&&(s.type="paragraph",s.text=this.options.sanitizer?this.options.sanitizer(n[0]):ws(n[0]),s.tokens=[],this.lexer.inline(s.text,s.tokens)),s}}def(t){let n=this.rules.block.def.exec(t);if(n)return n[3]&&(n[3]=n[3].substring(1,n[3].length-1)),{type:"def",tag:n[1].toLowerCase().replace(/\s+/g," "),raw:n[0],href:n[2],title:n[3]}}table(t){let n=this.rules.block.table.exec(t);if(n){let s={type:"table",header:dz(n[1]).map(h=>({text:h})),align:n[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:n[3]&&n[3].trim()?n[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(s.header.length===s.align.length){s.raw=n[0];let h=s.align.length,r,w,A,F;for(r=0;r<h;r++)/^ *-+: *$/.test(s.align[r])?s.align[r]="right":/^ *:-+: *$/.test(s.align[r])?s.align[r]="center":/^ *:-+ *$/.test(s.align[r])?s.align[r]="left":s.align[r]=null;for(h=s.rows.length,r=0;r<h;r++)s.rows[r]=dz(s.rows[r],s.header.length).map($=>({text:$}));for(h=s.header.length,w=0;w<h;w++)s.header[w].tokens=[],this.lexer.inline(s.header[w].text,s.header[w].tokens);for(h=s.rows.length,w=0;w<h;w++)for(F=s.rows[w],A=0;A<F.length;A++)F[A].tokens=[],this.lexer.inline(F[A].text,F[A].tokens);return s}}}lheading(t){let n=this.rules.block.lheading.exec(t);if(n){let s={type:"heading",raw:n[0],depth:n[2].charAt(0)==="="?1:2,text:n[1],tokens:[]};return this.lexer.inline(s.text,s.tokens),s}}paragraph(t){let n=this.rules.block.paragraph.exec(t);if(n){let s={type:"paragraph",raw:n[0],text:n[1].charAt(n[1].length-1)===`
`?n[1].slice(0,-1):n[1],tokens:[]};return this.lexer.inline(s.text,s.tokens),s}}text(t){let n=this.rules.block.text.exec(t);if(n){let s={type:"text",raw:n[0],text:n[0],tokens:[]};return this.lexer.inline(s.text,s.tokens),s}}escape(t){let n=this.rules.inline.escape.exec(t);if(n)return{type:"escape",raw:n[0],text:ws(n[1])}}tag(t){let n=this.rules.inline.tag.exec(t);if(n)return!this.lexer.state.inLink&&/^<a /i.test(n[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(n[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(n[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(n[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:n[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):ws(n[0]):n[0]}}link(t){let n=this.rules.inline.link.exec(t);if(n){let s=n[2].trim();if(!this.options.pedantic&&/^</.test(s)){if(!/>$/.test(s))return;let w=bw(s.slice(0,-1),"\\");if((s.length-w.length)%2===0)return}else{let w=hK(n[2],"()");if(w>-1){let F=(n[0].indexOf("!")===0?5:4)+n[1].length+w;n[2]=n[2].substring(0,w),n[0]=n[0].substring(0,F).trim(),n[3]=""}}let h=n[2],r="";if(this.options.pedantic){let w=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(h);w&&(h=w[1],r=w[3])}else r=n[3]?n[3].slice(1,-1):"";return h=h.trim(),/^</.test(h)&&(this.options.pedantic&&!/>$/.test(s)?h=h.slice(1):h=h.slice(1,-1)),pz(n,{href:h&&h.replace(this.rules.inline._escapes,"$1"),title:r&&r.replace(this.rules.inline._escapes,"$1")},n[0],this.lexer)}}reflink(t,n){let s;if((s=this.rules.inline.reflink.exec(t))||(s=this.rules.inline.nolink.exec(t))){let h=(s[2]||s[1]).replace(/\s+/g," ");if(h=n[h.toLowerCase()],!h||!h.href){let r=s[0].charAt(0);return{type:"text",raw:r,text:r}}return pz(s,h,s[0],this.lexer)}}emStrong(t,n,s=""){let h=this.rules.inline.emStrong.lDelim.exec(t);if(!h||h[3]&&s.match(/[\p{L}\p{N}]/u))return;let r=h[1]||h[2]||"";if(!r||r&&(s===""||this.rules.inline.punctuation.exec(s))){let w=h[0].length-1,A,F,$=w,K=0,se=h[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(se.lastIndex=0,n=n.slice(-1*t.length+w);(h=se.exec(n))!=null;){if(A=h[1]||h[2]||h[3]||h[4]||h[5]||h[6],!A)continue;if(F=A.length,h[3]||h[4]){$+=F;continue}else if((h[5]||h[6])&&w%3&&!((w+F)%3)){K+=F;continue}if($-=F,$>0)continue;if(F=Math.min(F,F+$+K),Math.min(w,F)%2){let ae=t.slice(1,w+h.index+F);return{type:"em",raw:t.slice(0,w+h.index+F+1),text:ae,tokens:this.lexer.inlineTokens(ae,[])}}let le=t.slice(2,w+h.index+F-1);return{type:"strong",raw:t.slice(0,w+h.index+F+1),text:le,tokens:this.lexer.inlineTokens(le,[])}}}}codespan(t){let n=this.rules.inline.code.exec(t);if(n){let s=n[2].replace(/\n/g," "),h=/[^ ]/.test(s),r=/^ /.test(s)&&/ $/.test(s);return h&&r&&(s=s.substring(1,s.length-1)),s=ws(s,!0),{type:"codespan",raw:n[0],text:s}}}br(t){let n=this.rules.inline.br.exec(t);if(n)return{type:"br",raw:n[0]}}del(t){let n=this.rules.inline.del.exec(t);if(n)return{type:"del",raw:n[0],text:n[2],tokens:this.lexer.inlineTokens(n[2],[])}}autolink(t,n){let s=this.rules.inline.autolink.exec(t);if(s){let h,r;return s[2]==="@"?(h=ws(this.options.mangle?n(s[1]):s[1]),r="mailto:"+h):(h=ws(s[1]),r=h),{type:"link",raw:s[0],text:h,href:r,tokens:[{type:"text",raw:h,text:h}]}}}url(t,n){let s;if(s=this.rules.inline.url.exec(t)){let h,r;if(s[2]==="@")h=ws(this.options.mangle?n(s[0]):s[0]),r="mailto:"+h;else{let w;do w=s[0],s[0]=this.rules.inline._backpedal.exec(s[0])[0];while(w!==s[0]);h=ws(s[0]),s[1]==="www."?r="http://"+h:r=h}return{type:"link",raw:s[0],text:h,href:r,tokens:[{type:"text",raw:h,text:h}]}}}inlineText(t,n){let s=this.rules.inline.text.exec(t);if(s){let h;return this.lexer.state.inRawBlock?h=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(s[0]):ws(s[0]):s[0]:h=ws(this.options.smartypants?n(s[0]):s[0]),{type:"text",raw:s[0],text:h}}}},ai={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:ww,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};ai._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;ai._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;ai.def=Jr(ai.def).replace("label",ai._label).replace("title",ai._title).getRegex();ai.bullet=/(?:[*+-]|\d{1,9}[.)])/;ai.listItemStart=Jr(/^( *)(bull) */).replace("bull",ai.bullet).getRegex();ai.list=Jr(ai.list).replace(/bull/g,ai.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+ai.def.source+")").getRegex();ai._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";ai._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;ai.html=Jr(ai.html,"i").replace("comment",ai._comment).replace("tag",ai._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();ai.paragraph=Jr(ai._paragraph).replace("hr",ai.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ai._tag).getRegex();ai.blockquote=Jr(ai.blockquote).replace("paragraph",ai.paragraph).getRegex();ai.normal=Vc({},ai);ai.gfm=Vc({},ai.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"});ai.gfm.table=Jr(ai.gfm.table).replace("hr",ai.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ai._tag).getRegex();ai.gfm.paragraph=Jr(ai._paragraph).replace("hr",ai.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",ai.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ai._tag).getRegex();ai.pedantic=Vc({},ai.normal,{html:Jr(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",ai._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ww,paragraph:Jr(ai.normal._paragraph).replace("hr",ai.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",ai.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});var Nn={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:ww,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[^*]+(?=[^*])|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:ww,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};Nn._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";Nn.punctuation=Jr(Nn.punctuation).replace(/punctuation/g,Nn._punctuation).getRegex();Nn.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;Nn.escapedEmSt=/\\\*|\\_/g;Nn._comment=Jr(ai._comment).replace("(?:-->|$)","-->").getRegex();Nn.emStrong.lDelim=Jr(Nn.emStrong.lDelim).replace(/punct/g,Nn._punctuation).getRegex();Nn.emStrong.rDelimAst=Jr(Nn.emStrong.rDelimAst,"g").replace(/punct/g,Nn._punctuation).getRegex();Nn.emStrong.rDelimUnd=Jr(Nn.emStrong.rDelimUnd,"g").replace(/punct/g,Nn._punctuation).getRegex();Nn._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;Nn._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;Nn._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;Nn.autolink=Jr(Nn.autolink).replace("scheme",Nn._scheme).replace("email",Nn._email).getRegex();Nn._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;Nn.tag=Jr(Nn.tag).replace("comment",Nn._comment).replace("attribute",Nn._attribute).getRegex();Nn._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;Nn._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;Nn._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;Nn.link=Jr(Nn.link).replace("label",Nn._label).replace("href",Nn._href).replace("title",Nn._title).getRegex();Nn.reflink=Jr(Nn.reflink).replace("label",Nn._label).replace("ref",ai._label).getRegex();Nn.nolink=Jr(Nn.nolink).replace("ref",ai._label).getRegex();Nn.reflinkSearch=Jr(Nn.reflinkSearch,"g").replace("reflink",Nn.reflink).replace("nolink",Nn.nolink).getRegex();Nn.normal=Vc({},Nn);Nn.pedantic=Vc({},Nn.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:Jr(/^!?\[(label)\]\((.*?)\)/).replace("label",Nn._label).getRegex(),reflink:Jr(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Nn._label).getRegex()});Nn.gfm=Vc({},Nn.normal,{escape:Jr(Nn.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/});Nn.gfm.url=Jr(Nn.gfm.url,"i").replace("email",Nn.gfm._extended_email).getRegex();Nn.breaks=Vc({},Nn.gfm,{br:Jr(Nn.br).replace("{2,}","*").getRegex(),text:Jr(Nn.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});function fK(e){return e.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201C").replace(/"/g,"\u201D").replace(/\.{3}/g,"\u2026")}function mz(e){let t="",n,s,h=e.length;for(n=0;n<h;n++)s=e.charCodeAt(n),Math.random()>.5&&(s="x"+s.toString(16)),t+="&#"+s+";";return t}var Kd=class e{constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||$g,this.options.tokenizer=this.options.tokenizer||new F0,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={block:ai.normal,inline:Nn.normal};this.options.pedantic?(n.block=ai.pedantic,n.inline=Nn.pedantic):this.options.gfm&&(n.block=ai.gfm,this.options.breaks?n.inline=Nn.breaks:n.inline=Nn.gfm),this.tokenizer.rules=n}static get rules(){return{block:ai,inline:Nn}}static lex(t,n){return new e(n).lex(t)}static lexInline(t,n){return new e(n).inlineTokens(t)}lex(t){t=t.replace(/\r\n|\r/g,`
`),this.blockTokens(t,this.tokens);let n;for(;n=this.inlineQueue.shift();)this.inlineTokens(n.src,n.tokens);return this.tokens}blockTokens(t,n=[]){this.options.pedantic?t=t.replace(/\t/g,"    ").replace(/^ +$/gm,""):t=t.replace(/^( *)(\t+)/gm,(A,F,$)=>F+"    ".repeat($.length));let s,h,r,w;for(;t;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(A=>(s=A.call({lexer:this},t,n))?(t=t.substring(s.raw.length),n.push(s),!0):!1))){if(s=this.tokenizer.space(t)){t=t.substring(s.raw.length),s.raw.length===1&&n.length>0?n[n.length-1].raw+=`
`:n.push(s);continue}if(s=this.tokenizer.code(t)){t=t.substring(s.raw.length),h=n[n.length-1],h&&(h.type==="paragraph"||h.type==="text")?(h.raw+=`
`+s.raw,h.text+=`
`+s.text,this.inlineQueue[this.inlineQueue.length-1].src=h.text):n.push(s);continue}if(s=this.tokenizer.fences(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.heading(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.hr(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.blockquote(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.list(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.html(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.def(t)){t=t.substring(s.raw.length),h=n[n.length-1],h&&(h.type==="paragraph"||h.type==="text")?(h.raw+=`
`+s.raw,h.text+=`
`+s.raw,this.inlineQueue[this.inlineQueue.length-1].src=h.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title});continue}if(s=this.tokenizer.table(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.lheading(t)){t=t.substring(s.raw.length),n.push(s);continue}if(r=t,this.options.extensions&&this.options.extensions.startBlock){let A=1/0,F=t.slice(1),$;this.options.extensions.startBlock.forEach(function(K){$=K.call({lexer:this},F),typeof $=="number"&&$>=0&&(A=Math.min(A,$))}),A<1/0&&A>=0&&(r=t.substring(0,A+1))}if(this.state.top&&(s=this.tokenizer.paragraph(r))){h=n[n.length-1],w&&h.type==="paragraph"?(h.raw+=`
`+s.raw,h.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=h.text):n.push(s),w=r.length!==t.length,t=t.substring(s.raw.length);continue}if(s=this.tokenizer.text(t)){t=t.substring(s.raw.length),h=n[n.length-1],h&&h.type==="text"?(h.raw+=`
`+s.raw,h.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=h.text):n.push(s);continue}if(t){let A="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(A);break}else throw new Error(A)}}return this.state.top=!0,n}inline(t,n){this.inlineQueue.push({src:t,tokens:n})}inlineTokens(t,n=[]){let s,h,r,w=t,A,F,$;if(this.tokens.links){let K=Object.keys(this.tokens.links);if(K.length>0)for(;(A=this.tokenizer.rules.inline.reflinkSearch.exec(w))!=null;)K.includes(A[0].slice(A[0].lastIndexOf("[")+1,-1))&&(w=w.slice(0,A.index)+"["+fz("a",A[0].length-2)+"]"+w.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(A=this.tokenizer.rules.inline.blockSkip.exec(w))!=null;)w=w.slice(0,A.index)+"["+fz("a",A[0].length-2)+"]"+w.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(A=this.tokenizer.rules.inline.escapedEmSt.exec(w))!=null;)w=w.slice(0,A.index)+"++"+w.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;t;)if(F||($=""),F=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(K=>(s=K.call({lexer:this},t,n))?(t=t.substring(s.raw.length),n.push(s),!0):!1))){if(s=this.tokenizer.escape(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.tag(t)){t=t.substring(s.raw.length),h=n[n.length-1],h&&s.type==="text"&&h.type==="text"?(h.raw+=s.raw,h.text+=s.text):n.push(s);continue}if(s=this.tokenizer.link(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(s.raw.length),h=n[n.length-1],h&&s.type==="text"&&h.type==="text"?(h.raw+=s.raw,h.text+=s.text):n.push(s);continue}if(s=this.tokenizer.emStrong(t,w,$)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.codespan(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.br(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.del(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.autolink(t,mz)){t=t.substring(s.raw.length),n.push(s);continue}if(!this.state.inLink&&(s=this.tokenizer.url(t,mz))){t=t.substring(s.raw.length),n.push(s);continue}if(r=t,this.options.extensions&&this.options.extensions.startInline){let K=1/0,se=t.slice(1),le;this.options.extensions.startInline.forEach(function(ae){le=ae.call({lexer:this},se),typeof le=="number"&&le>=0&&(K=Math.min(K,le))}),K<1/0&&K>=0&&(r=t.substring(0,K+1))}if(s=this.tokenizer.inlineText(r,fK)){t=t.substring(s.raw.length),s.raw.slice(-1)!=="_"&&($=s.raw.slice(-1)),F=!0,h=n[n.length-1],h&&h.type==="text"?(h.raw+=s.raw,h.text+=s.text):n.push(s);continue}if(t){let K="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(K);break}else throw new Error(K)}}return n}},N0=class{constructor(t){this.options=t||$g}code(t,n,s){let h=(n||"").match(/\S*/)[0];if(this.options.highlight){let r=this.options.highlight(t,h);r!=null&&r!==t&&(s=!0,t=r)}return t=t.replace(/\n$/,"")+`
`,h?'<pre><code class="'+this.options.langPrefix+ws(h,!0)+'">'+(s?t:ws(t,!0))+`</code></pre>
`:"<pre><code>"+(s?t:ws(t,!0))+`</code></pre>
`}blockquote(t){return`<blockquote>
${t}</blockquote>
`}html(t){return t}heading(t,n,s,h){if(this.options.headerIds){let r=this.options.headerPrefix+h.slug(s);return`<h${n} id="${r}">${t}</h${n}>
`}return`<h${n}>${t}</h${n}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(t,n,s){let h=n?"ol":"ul",r=n&&s!==1?' start="'+s+'"':"";return"<"+h+r+`>
`+t+"</"+h+`>
`}listitem(t){return`<li>${t}</li>
`}checkbox(t){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(t){return`<p>${t}</p>
`}table(t,n){return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow(t){return`<tr>
${t}</tr>
`}tablecell(t,n){let s=n.header?"th":"td";return(n.align?`<${s} align="${n.align}">`:`<${s}>`)+t+`</${s}>
`}strong(t){return`<strong>${t}</strong>`}em(t){return`<em>${t}</em>`}codespan(t){return`<code>${t}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(t){return`<del>${t}</del>`}link(t,n,s){if(t=hz(this.options.sanitize,this.options.baseUrl,t),t===null)return s;let h='<a href="'+ws(t)+'"';return n&&(h+=' title="'+n+'"'),h+=">"+s+"</a>",h}image(t,n,s){if(t=hz(this.options.sanitize,this.options.baseUrl,t),t===null)return s;let h=`<img src="${t}" alt="${s}"`;return n&&(h+=` title="${n}"`),h+=this.options.xhtml?"/>":">",h}text(t){return t}},Cw=class{strong(t){return t}em(t){return t}codespan(t){return t}del(t){return t}html(t){return t}text(t){return t}link(t,n,s){return""+s}image(t,n,s){return""+s}br(){return""}},Mw=class{constructor(){this.seen={}}serialize(t){return t.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(t,n){let s=t,h=0;if(this.seen.hasOwnProperty(s)){h=this.seen[t];do h++,s=t+"-"+h;while(this.seen.hasOwnProperty(s))}return n||(this.seen[t]=h,this.seen[s]=0),s}slug(t,n={}){let s=this.serialize(t);return this.getNextSafeSlug(s,n.dryrun)}},Jd=class e{constructor(t){this.options=t||$g,this.options.renderer=this.options.renderer||new N0,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Cw,this.slugger=new Mw}static parse(t,n){return new e(n).parse(t)}static parseInline(t,n){return new e(n).parseInline(t)}parse(t,n=!0){let s="",h,r,w,A,F,$,K,se,le,ae,Ze,Ue,ft,Xe,st,Ut,Bt,xt,yt,rn=t.length;for(h=0;h<rn;h++){if(ae=t[h],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[ae.type]&&(yt=this.options.extensions.renderers[ae.type].call({parser:this},ae),yt!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(ae.type))){s+=yt||"";continue}switch(ae.type){case"space":continue;case"hr":{s+=this.renderer.hr();continue}case"heading":{s+=this.renderer.heading(this.parseInline(ae.tokens),ae.depth,_z(this.parseInline(ae.tokens,this.textRenderer)),this.slugger);continue}case"code":{s+=this.renderer.code(ae.text,ae.lang,ae.escaped);continue}case"table":{for(se="",K="",A=ae.header.length,r=0;r<A;r++)K+=this.renderer.tablecell(this.parseInline(ae.header[r].tokens),{header:!0,align:ae.align[r]});for(se+=this.renderer.tablerow(K),le="",A=ae.rows.length,r=0;r<A;r++){for($=ae.rows[r],K="",F=$.length,w=0;w<F;w++)K+=this.renderer.tablecell(this.parseInline($[w].tokens),{header:!1,align:ae.align[w]});le+=this.renderer.tablerow(K)}s+=this.renderer.table(se,le);continue}case"blockquote":{le=this.parse(ae.tokens),s+=this.renderer.blockquote(le);continue}case"list":{for(Ze=ae.ordered,Ue=ae.start,ft=ae.loose,A=ae.items.length,le="",r=0;r<A;r++)st=ae.items[r],Ut=st.checked,Bt=st.task,Xe="",st.task&&(xt=this.renderer.checkbox(Ut),ft?st.tokens.length>0&&st.tokens[0].type==="paragraph"?(st.tokens[0].text=xt+" "+st.tokens[0].text,st.tokens[0].tokens&&st.tokens[0].tokens.length>0&&st.tokens[0].tokens[0].type==="text"&&(st.tokens[0].tokens[0].text=xt+" "+st.tokens[0].tokens[0].text)):st.tokens.unshift({type:"text",text:xt}):Xe+=xt),Xe+=this.parse(st.tokens,ft),le+=this.renderer.listitem(Xe,Bt,Ut);s+=this.renderer.list(le,Ze,Ue);continue}case"html":{s+=this.renderer.html(ae.text);continue}case"paragraph":{s+=this.renderer.paragraph(this.parseInline(ae.tokens));continue}case"text":{for(le=ae.tokens?this.parseInline(ae.tokens):ae.text;h+1<rn&&t[h+1].type==="text";)ae=t[++h],le+=`
`+(ae.tokens?this.parseInline(ae.tokens):ae.text);s+=n?this.renderer.paragraph(le):le;continue}default:{let Dt='Token with "'+ae.type+'" type was not found.';if(this.options.silent){console.error(Dt);return}else throw new Error(Dt)}}}return s}parseInline(t,n){n=n||this.renderer;let s="",h,r,w,A=t.length;for(h=0;h<A;h++){if(r=t[h],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[r.type]&&(w=this.options.extensions.renderers[r.type].call({parser:this},r),w!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(r.type))){s+=w||"";continue}switch(r.type){case"escape":{s+=n.text(r.text);break}case"html":{s+=n.html(r.text);break}case"link":{s+=n.link(r.href,r.title,this.parseInline(r.tokens,n));break}case"image":{s+=n.image(r.href,r.title,r.text);break}case"strong":{s+=n.strong(this.parseInline(r.tokens,n));break}case"em":{s+=n.em(this.parseInline(r.tokens,n));break}case"codespan":{s+=n.codespan(r.text);break}case"br":{s+=n.br();break}case"del":{s+=n.del(this.parseInline(r.tokens,n));break}case"text":{s+=n.text(r.text);break}default:{let F='Token with "'+r.type+'" type was not found.';if(this.options.silent){console.error(F);return}else throw new Error(F)}}}return s}};function On(e,t,n){if(typeof e>"u"||e===null)throw new Error("marked(): input parameter is undefined or null");if(typeof e!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if(typeof t=="function"&&(n=t,t=null),t=Vc({},On.defaults,t||{}),yz(t),n){let s=t.highlight,h;try{h=Kd.lex(e,t)}catch(A){return n(A)}let r=function(A){let F;if(!A)try{t.walkTokens&&On.walkTokens(h,t.walkTokens),F=Jd.parse(h,t)}catch($){A=$}return t.highlight=s,A?n(A):n(null,F)};if(!s||s.length<3||(delete t.highlight,!h.length))return r();let w=0;On.walkTokens(h,function(A){A.type==="code"&&(w++,setTimeout(()=>{s(A.text,A.lang,function(F,$){if(F)return r(F);$!=null&&$!==A.text&&(A.text=$,A.escaped=!0),w--,w===0&&r()})},0))}),w===0&&r();return}try{let s=Kd.lex(e,t);return t.walkTokens&&On.walkTokens(s,t.walkTokens),Jd.parse(s,t)}catch(s){if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,t.silent)return"<p>An error occurred:</p><pre>"+ws(s.message+"",!0)+"</pre>";throw s}}On.options=On.setOptions=function(e){return Vc(On.defaults,e),KX(On.defaults),On};On.getDefaults=gz;On.defaults=$g;On.use=function(...e){let t=Vc({},...e),n=On.defaults.extensions||{renderers:{},childTokens:{}},s;e.forEach(h=>{if(h.extensions&&(s=!0,h.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if(r.renderer){let w=n.renderers?n.renderers[r.name]:null;w?n.renderers[r.name]=function(...A){let F=r.renderer.apply(this,A);return F===!1&&(F=w.apply(this,A)),F}:n.renderers[r.name]=r.renderer}if(r.tokenizer){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");n[r.level]?n[r.level].unshift(r.tokenizer):n[r.level]=[r.tokenizer],r.start&&(r.level==="block"?n.startBlock?n.startBlock.push(r.start):n.startBlock=[r.start]:r.level==="inline"&&(n.startInline?n.startInline.push(r.start):n.startInline=[r.start]))}r.childTokens&&(n.childTokens[r.name]=r.childTokens)})),h.renderer){let r=On.defaults.renderer||new N0;for(let w in h.renderer){let A=r[w];r[w]=(...F)=>{let $=h.renderer[w].apply(r,F);return $===!1&&($=A.apply(r,F)),$}}t.renderer=r}if(h.tokenizer){let r=On.defaults.tokenizer||new F0;for(let w in h.tokenizer){let A=r[w];r[w]=(...F)=>{let $=h.tokenizer[w].apply(r,F);return $===!1&&($=A.apply(r,F)),$}}t.tokenizer=r}if(h.walkTokens){let r=On.defaults.walkTokens;t.walkTokens=function(w){h.walkTokens.call(this,w),r&&r.call(this,w)}}s&&(t.extensions=n),On.setOptions(t)})};On.walkTokens=function(e,t){for(let n of e)switch(t.call(On,n),n.type){case"table":{for(let s of n.header)On.walkTokens(s.tokens,t);for(let s of n.rows)for(let h of s)On.walkTokens(h.tokens,t);break}case"list":{On.walkTokens(n.items,t);break}default:On.defaults.extensions&&On.defaults.extensions.childTokens&&On.defaults.extensions.childTokens[n.type]?On.defaults.extensions.childTokens[n.type].forEach(function(s){On.walkTokens(n[s],t)}):n.tokens&&On.walkTokens(n.tokens,t)}};On.parseInline=function(e,t){if(typeof e>"u"||e===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof e!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");t=Vc({},On.defaults,t||{}),yz(t);try{let n=Kd.lexInline(e,t);return t.walkTokens&&On.walkTokens(n,t.walkTokens),Jd.parseInline(n,t)}catch(n){if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t.silent)return"<p>An error occurred:</p><pre>"+ws(n.message+"",!0)+"</pre>";throw n}};On.Parser=Jd;On.parser=Jd.parse;On.Renderer=N0;On.TextRenderer=Cw;On.Lexer=Kd;On.lexer=Kd.lex;On.Tokenizer=F0;On.Slugger=Mw;On.parse=On;var ype=On.options,vpe=On.setOptions,xpe=On.use,bpe=On.walkTokens,wpe=On.parseInline;var Cpe=Jd.parse,Mpe=Kd.lex;var pK=nS;function mK(e){return!!e[pK]}var gK=Symbol("__destroy"),wz=Symbol("__decoratorApplied");function Cz(e){return typeof e=="string"?Symbol(`__destroy__${e}`):gK}function _K(e){e.prototype[wz]=!0}function Mz(e,t){e[t]||(e[t]=new Ii)}function Tz(e,t){e[t]&&(e[t].next(),e[t].complete(),e[t]=null)}function Ez(e){e instanceof to&&e.unsubscribe()}function yK(e){Array.isArray(e)&&e.forEach(Ez)}function Sz(e,t){return function(){if(e&&e.call(this),Tz(this,Cz()),t.arrayName&&yK(this[t.arrayName]),t.checkProperties)for(let n in this)t.blackList?.includes(n)||Ez(this[n])}}function vK(e,t){e.prototype.ngOnDestroy=Sz(e.prototype.ngOnDestroy,t)}function xK(e,t){let n=e.\u0275pipe;n.onDestroy=Sz(n.onDestroy,t)}function Kl(e={}){return t=>{mK(t)?xK(t,e):vK(t,e),_K(t)}}var vz=7,xz=Symbol("CheckerHasBeenSet");function bK(e,t){e[xz]||wK()||(bz(()=>cr(Promise.resolve()).pipe(Xr(()=>{let n;try{n=a3(e)}catch{n=null}let s=n?.lView;if(s==null)return Ds;let h=s[vz]||(s[vz]=[]),r=new Ii;return h.push(function(){bz(()=>{r.next(),r.complete()})}),r}),Xr(()=>Promise.resolve())).subscribe(()=>{(t.observed??t.observers.length>0)&&console.warn(CK(e))})),e[xz]=!0)}function wK(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]"}function bz(e){let t=va.Zone;return!!t&&typeof t.root?.run=="function"?t.root.run(e):e()}function CK(e){return`
  The ${e.constructor.name} still has subscriptions that haven't been unsubscribed.
  This may happen if the class extends another class decorated with @UntilDestroy().
  The child class implements its own ngOnDestroy() method but doesn't call super.ngOnDestroy().
  Let's look at the following example:
  @UntilDestroy()
  @Directive()
  export abstract class BaseDirective {}
  @Component({ template: '' })
  export class ConcreteComponent extends BaseDirective implements OnDestroy {
    constructor() {
      super();
      someObservable$.pipe(untilDestroyed(this)).subscribe();
    }
    ngOnDestroy(): void {
      // Some logic here...
    }
  }
  The BaseDirective.ngOnDestroy() will not be called since Angular will call ngOnDestroy()
  on the ConcreteComponent, but not on the BaseDirective.
  One of the solutions is to declare an empty ngOnDestroy method on the BaseDirective:
  @UntilDestroy()
  @Directive()
  export abstract class BaseDirective {
    ngOnDestroy(): void {}
  }
  @Component({ template: '' })
  export class ConcreteComponent extends BaseDirective implements OnDestroy {
    constructor() {
      super();
      someObservable$.pipe(untilDestroyed(this)).subscribe();
    }
    ngOnDestroy(): void {
      // Some logic here...
      super.ngOnDestroy();
    }
  }
  `}var h2=!1;function MK(e,t,n){let s=e[t];if(h2&&typeof s!="function")throw new Error(`${e.constructor.name} is using untilDestroyed but doesn't implement ${t}`);Mz(e,n),e[t]=function(){s.apply(this,arguments),Tz(this,n),e[t]=s}}function na(e,t){return n=>{let s=Cz(t);typeof t=="string"?MK(e,t,s):(h2&&TK(e),Mz(e,s));let h=e[s];return h2&&bK(e,h),n.pipe(sp(h))}}function TK(e){let t=Object.getPrototypeOf(e);if(!(wz in t))throw new Error("untilDestroyed operator cannot be used inside directives or components or providers that are not decorated with UntilDestroy decorator")}var d2="https://manage.chronomaps.net",Iz="M848mzHlYh36iWPJ1Y9PxxxIburb5z5z";var Tw=class{constructor(t,n,s,h){this.endpoint=t,this.token=n,this.id=s,this.name=h,this.rows=[],this.hasRows=!1}fetchRows(t,n=!1){return!this.hasRows||n?t.get(`${this.endpoint}/api/database/rows/table/${this.id}/?user_field_names=true&size=100`,{headers:{Authorization:`Token ${this.token}`}}).pipe(ti(s=>s.results),pi(s=>{this.rows=s,this.hasRows=!0}),ti(()=>this)):cr([this])}};var z0=class{constructor(t,n,s,h){this.endpoint=t,this.token=n,this.database=s,this.http=h,this.tables=new ga(1)}fetchTables(){return this.http.get(`${this.endpoint}/api/database/tables/database/${this.database}/`,{headers:{Authorization:`Token ${this.token}`}}).pipe(ti(t=>t.map(n=>new Tw(this.endpoint,this.token,n.id,n.name))),pi(t=>{this.tables.next(t)}))}getTable(t,n=!1){return this.tables.pipe(mo(),ti(s=>s.find(h=>h.name===t)),Vr(s=>s?s.fetchRows(this.http,n):cr([])))}};var Qd=fh(B0());var Jl=class{static setLayerSource(t,n,s){let h=t.getStyle()?.layers||[],r=h.findIndex(F=>F.id===n),w=h[r],A=h[r+1]&&h[r+1].id;w.source=s,w["source-layer"]&&delete w["source-layer"],t.removeLayer(n),t.addLayer(w,A)}static parseMapView(t){if(!t)return{};let n=t.split("#")[1];if(!n)return{};let s=n.split("/");if(s!==null){let h={zoom:parseFloat(s[0]),center:{lat:parseFloat(s[1]),lon:parseFloat(s[2])}};return s.length>3&&(h.bearing=parseFloat(s[3]),isNaN(h.bearing)&&(h.bearing=void 0)),s.length>4&&(h.pitch=parseFloat(s[4]),isNaN(h.pitch)&&(h.pitch=void 0)),h}else return{}}};var Ew={day:e=>(0,Qd.default)(e).format("MMMM D, YYYY"),month:e=>(0,Qd.default)(e).format("MMMM YYYY"),year:e=>(0,Qd.default)(e).format("YYYY"),hour:e=>(0,Qd.default)(e).format("MMMM D, YYYY h:mm a")},m2=class{},g2=class extends m2{constructor(){super(...arguments),this.relatedItems=[],this.cx=0,this.cy=0,this.k=0,this.indexes=[]}},_2=class extends z0{constructor(t,n,s){super(d2,n.Database_Token,n.Database_ID,s),this.slug=Ln(""),this.editor_name=Ln(""),this.editor_email=Ln(""),this.pitch=Ln(""),this.title=Ln(""),this.subtitle=Ln(""),this.infobarTitle=Ln(""),this.infobarSubtitle=Ln(""),this.infobarContent=Ln(""),this.contributeMessage=Ln(""),this.mapView=Ln(""),this.logo=Ln(""),this.thumbnail=Ln(""),this.parentLink=Ln(".."),this.showTooltips=Ln(!0),this.altTimestampLabel=Ln(""),this.postDateFormat=Ln(""),this.altDateFormat=Ln(""),this.primaryColor=Ln(""),this.secondaryColor=Ln(""),this.newEntryForm=Ln(""),this.disableTimeline=Ln(!1),this.imageItemMarkers=Ln(!0),this.mapStyle=Ln(""),this.backgroundMapStyle=Ln(""),this.mapboxKey=Ln(""),this.Map_BG=Ln(""),this.Map_BG_Bounds=Ln(""),this.HotSpotsGeoJson=Ln(null),this.timelineItems=Ln([]),this.lastModified=Ln(new Date),this.minDate=Ln(new Date),this.maxDate=Ln(new Date),this.allLayers=[],this.nonces=[],this.authors=Ln({}),this.ready=new ga(1),this.ready_=!1,this.id=n.id,this.directoryId=t,this.title.set(n.Title),this.slug.set(n.URL_Slug),this.editor_name.set(n.Editor_Name),this.editor_email.set(n.Editor_Email),this.pitch.set(n.Pitch)}fetchMeta(){return this.fetchTables().pipe(pi(()=>{this.getTable("Settings").subscribe(t=>{let n={};if(t?.rows.forEach(s=>{n[s.Key]={value:s.Value,images:s.Image}}),n.Title?.value&&n.Title?.value!=="New Chronomap"&&this.title.set(n.Title?.value||""),this.subtitle.set(n.Subtitle?.value||""),this.infobarTitle.set(n.Infobar_Title?.value||this.title()),this.infobarSubtitle.set(n.Infobar_Subtitle?.value||this.subtitle()),this.infobarContent.set(n.Infobar_Content?.value||""),this.contributeMessage.set(n.Contribute_Message?.value||""),this.mapView.set(n.Default_Map_View?.value||""),this.logo.set(n.Logo?.images?.[0]?.url||""),this.thumbnail.set(n.Thumbnail?.images?.[0]?.url||""),this.parentLink.set(n.Parent_Link?.value||".."),this.mapStyle.set(n.Map_Style?.value||""),this.backgroundMapStyle.set(n.Background_Map_Style?.value||""),this.mapboxKey.set(n.Mapbox_Key?.value||""),this.showTooltips.set(n.Show_Tooltips?.value==="true"),this.altTimestampLabel.set(n.Alt_Timestamp_Label?.value||""),this.postDateFormat.set(n.Post_Date_Format?.value||""),this.altDateFormat.set(n.Alt_Date_Format?.value||""),this.primaryColor.set(n.Primary_Color?.value||""),this.secondaryColor.set(n.Secondary_Color?.value||""),this.newEntryForm.set(n.New_Entry_Form?.value||""),this.Map_BG.set(n.Map_BG?.images?.[0]?.url||""),this.Map_BG_Bounds.set(n.Map_BG_Bounds?.value||""),this.disableTimeline.set(n.Disable_Timeline?.value==="true"),this.imageItemMarkers.set(n.Image_Item_Markers?.value==="true"),n.HotSpotsGeoJson?.value)try{this.HotSpotsGeoJson.set(JSON.parse(n.HotSpotsGeoJson.value))}catch{this.HotSpotsGeoJson.set(null)}else this.HotSpotsGeoJson.set(null)})}))}fetchContent(t=!1){return this.ready_&&!t?this.ready:(console.log("FETCH CONTENT",this.title(),this.ready_,t),this.ready_=!0,Ay([this.getTable("MapLayers"),this.getTable("Authors"),this.getTable("Content",t)]).pipe(ti(([n,s,h])=>{this.allLayers=[];let r={};n?.rows.forEach(F=>{let $=F.On_Layers.map(K=>K.value)||[];$.forEach(K=>{this.allLayers.includes(K)||this.allLayers.push(K)}),r[F.Name]=$});let w={};s?.rows.forEach(F=>{w[F.Name]={name:F.Name,email:F.Email,status:F.Status?.value}}),this.authors.set(w),this.nonces=[];let A=[];return h?.rows.forEach(F=>{let $={id:F.id,title:F.Title,notes:F.Notes,post_timestamp:F.Post_Timestamp?(0,Qd.default)(F.Post_Timestamp).toDate():null,status:F.Status?.value,type:F.Type?.value,youtube_video_id:F.Youtube_Video_Id,content:F.Content,image:F.Image?.[0]?.url,audio:F.Audio?.[0]?.url,name:F.Name||"Full Name",username:F.Username||"username",profile_image:F.Profile_Image?.[0]?.url||"/assets/img/default-profile-img.svg",like_count:F.Like_Count||0,comment_count:F.Comment_Count||0,link_title:F.Link_Title,link_domain:F.Link_Domain,geo:F.Geo,map_layers:[],off_map_layers:[],nonce:F.Nonce,authors:F.Authors?.map(se=>w[se.value])||[],tags:F.Tags?.map(se=>se.value)||[],related:F.Related,lastModified:(0,Qd.default)(F.Last_Modified).toDate()};try{$.extraProperties=F.Properties?JSON.parse(F.Properties):{}}catch{$.extraProperties={}}$.extraProperties=Object.keys($.extraProperties).map(se=>[se,$.extraProperties[se]]),$.alt_post_timestamp=F.Alt_Post_Timestamp?(0,Qd.default)(F.Alt_Post_Timestamp).toDate():$.post_timestamp,F.Map_Layer.forEach(se=>{let le=se.value;r[le]&&r[le].forEach(ae=>{$.map_layers.includes(ae)||$.map_layers.push(ae)})}),this.allLayers.forEach(se=>{$.map_layers.includes(se)||$.off_map_layers.push(se)}),$.nonce&&this.nonces.push($.nonce);let K=$;K.status==="Published"&&K.authors.find(se=>se.status==="Editor"||se.status==="Contributor")&&(!this.disableTimeline()&&!K.post_timestamp&&!K.alt_post_timestamp||A.push(K))}),A.forEach(F=>{F.related=F.related.map($=>A.find(K=>K.id===$.id)||{}).filter($=>!!$.id)}),this.disableTimeline()?A.sort((F,$)=>(Jl.parseMapView(F.geo).center?.lon||0)-(Jl.parseMapView($.geo).center?.lon||0)):A.sort((F,$)=>F.post_timestamp.getTime()-$.post_timestamp.getTime())}),pi(n=>{this.allContentItems=n;let s=n.map((A,F)=>{let $=new g2;Object.assign($,A),this.disableTimeline()||($.timestamp=$.post_timestamp||$.alt_post_timestamp,$.formattedPostTimestamp=(Ew[this.postDateFormat()]||Ew.year)(A.post_timestamp),$.formattedAltPostTimestamp=(Ew[this.altTimestampLabel()]||Ew.year)(A.alt_post_timestamp));let K=$.authors.map(se=>se.name);if(K.length>1){let se=K.pop();K[K.length-1]+=` and ${se}`}return $.formattedAuthors=K.join(", "),$}),h=null,r=null;s.forEach((A,F)=>{A.index=F,A.next=s[F+1]||null,A.prev=s[F-1]||null,A.post_timestamp&&((!h||A.post_timestamp<h)&&(h=A.post_timestamp),(!r||A.post_timestamp>r)&&(r=A.post_timestamp)),A.relatedItems=A.related.map($=>s.find(K=>K.id===$.id)||{}).filter($=>!!$)}),h=h||new Date,r=r||new Date;let w=(r.getTime()-h.getTime())/10;this.minDate.set(new Date(h.getTime()-w)),this.maxDate.set(new Date(r.getTime()+w)),this.lastModified.set(s.map(A=>A.lastModified).reduce((A,F)=>A>F?A:F,new Date(1970,1,1))),this.timelineItems.set(s),console.log("GOT CONTENT ITEMS",this.title(),s.length,this.allContentItems.length),this.ready.next(!0),this.ready.complete()})))}},y2=class extends z0{constructor(t,n){super(d2,Iz,t,n),this.chronomaps=Ln([]),this.title=Ln(""),this.subtitle=Ln(""),this.titleImageUrl=Ln(""),this.description=Ln(""),this.fullDescription=Ln(""),this.logos=Ln([]),this.logoLinks=Ln([]),this.primaryColor=Ln("#000000"),this.secondaryColor=Ln("#ffffff"),this.zoomFrom=Ln(1900),this.zoomUntil=Ln(2100),this.url=Ln("")}fetchMaps(){this.fetchTables().subscribe(),this.getTable("Settings").subscribe(t=>{let n={};t?.rows.forEach(s=>{n[s.Key]={value:s.Value,images:s.Image}}),this.title.set(n.Title?.value||""),this.subtitle.set(n.Subtitle?.value||""),this.titleImageUrl.set(n.Title_Image?.images?.[0]?.url||""),this.description.set(n.Description.value),this.fullDescription.set(n.Full_Description.value),this.logos.set((n.Logos?.images||[]).map(s=>s.url)),this.logoLinks.set(n.Logos?.value?.split(",")||[]),this.primaryColor.set(n.Primary_Color.value),this.secondaryColor.set(n.Secondary_Color.value),this.zoomFrom.set(n.Zoom_From.value),this.zoomUntil.set(n.Zoom_Until.value),this.url.set(n.URL.value)}),this.getTable("Chronomaps").subscribe(t=>{this.chronomaps.set(t?.rows.filter(n=>n.Status?.value==="Published").map(n=>new _2(this.database,n,this.http))||[])})}},ef=(()=>{class e{constructor(n){this.http=n,this.currentDbId=0}fetchData(n){this.currentDbId!==n&&(console.log("fetching data for",n),this.currentDbId=n,this.directory=new y2(n,this.http),this.directory.fetchMaps())}static{this.\u0275fac=function(s){return new(s||e)(Bn(d0))}}static{this.\u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var tf=(()=>{class e{constructor(n){this.document=n,this.mobile=Ln(!1),this.desktop=Ln(!1),this.window&&bo(this.window,"resize").subscribe(()=>{this._check()}),this._check()}get window(){return this.document.defaultView}_check(){this.window?.innerWidth?(this.mobile.set(this.window.innerWidth<1e3),this.desktop.set(!this.mobile())):(this.mobile.set(!1),this.desktop.set(!0))}static{this.\u0275fac=function(s){return new(s||e)(Bn(rs))}}static{this.\u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var b5=fh(B0());var EK={value:()=>{}};function Dz(){for(var e=0,t=arguments.length,n={},s;e<t;++e){if(!(s=arguments[e]+"")||s in n||/[\s.]/.test(s))throw new Error("illegal type: "+s);n[s]=[]}return new Pw(n)}function Pw(e){this._=e}function SK(e,t){return e.trim().split(/^|\s+/).map(function(n){var s="",h=n.indexOf(".");if(h>=0&&(s=n.slice(h+1),n=n.slice(0,h)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:s}})}Pw.prototype=Dz.prototype={constructor:Pw,on:function(e,t){var n=this._,s=SK(e+"",n),h,r=-1,w=s.length;if(arguments.length<2){for(;++r<w;)if((h=(e=s[r]).type)&&(h=IK(n[h],e.name)))return h;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++r<w;)if(h=(e=s[r]).type)n[h]=Pz(n[h],e.name,t);else if(t==null)for(h in n)n[h]=Pz(n[h],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Pw(e)},call:function(e,t){if((h=arguments.length-2)>0)for(var n=new Array(h),s=0,h,r;s<h;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=this._[e],s=0,h=r.length;s<h;++s)r[s].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var s=this._[e],h=0,r=s.length;h<r;++h)s[h].value.apply(t,n)}};function IK(e,t){for(var n=0,s=e.length,h;n<s;++n)if((h=e[n]).name===t)return h.value}function Pz(e,t,n){for(var s=0,h=e.length;s<h;++s)if(e[s].name===t){e[s]=EK,e=e.slice(0,s).concat(e.slice(s+1));break}return n!=null&&e.push({name:t,value:n}),e}var V0=Dz;var Dw="http://www.w3.org/1999/xhtml",v2={svg:"http://www.w3.org/2000/svg",xhtml:Dw,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function kh(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),v2.hasOwnProperty(t)?{space:v2[t],local:e}:e}function PK(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Dw&&t.documentElement.namespaceURI===Dw?t.createElement(e):t.createElementNS(n,e)}}function DK(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Ow(e){var t=kh(e);return(t.local?DK:PK)(t)}function OK(){}function Ep(e){return e==null?OK:function(){return this.querySelector(e)}}function Oz(e){typeof e!="function"&&(e=Ep(e));for(var t=this._groups,n=t.length,s=new Array(n),h=0;h<n;++h)for(var r=t[h],w=r.length,A=s[h]=new Array(w),F,$,K=0;K<w;++K)(F=r[K])&&($=e.call(F,F.__data__,K,r))&&("__data__"in F&&($.__data__=F.__data__),A[K]=$);return new Lo(s,this._parents)}function x2(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function AK(){return[]}function j0(e){return e==null?AK:function(){return this.querySelectorAll(e)}}function RK(e){return function(){return x2(e.apply(this,arguments))}}function Az(e){typeof e=="function"?e=RK(e):e=j0(e);for(var t=this._groups,n=t.length,s=[],h=[],r=0;r<n;++r)for(var w=t[r],A=w.length,F,$=0;$<A;++$)(F=w[$])&&(s.push(e.call(F,F.__data__,$,w)),h.push(F));return new Lo(s,h)}function U0(e){return function(){return this.matches(e)}}function Aw(e){return function(t){return t.matches(e)}}var kK=Array.prototype.find;function LK(e){return function(){return kK.call(this.children,e)}}function FK(){return this.firstElementChild}function Rz(e){return this.select(e==null?FK:LK(typeof e=="function"?e:Aw(e)))}var NK=Array.prototype.filter;function zK(){return Array.from(this.children)}function BK(e){return function(){return NK.call(this.children,e)}}function kz(e){return this.selectAll(e==null?zK:BK(typeof e=="function"?e:Aw(e)))}function Lz(e){typeof e!="function"&&(e=U0(e));for(var t=this._groups,n=t.length,s=new Array(n),h=0;h<n;++h)for(var r=t[h],w=r.length,A=s[h]=[],F,$=0;$<w;++$)(F=r[$])&&e.call(F,F.__data__,$,r)&&A.push(F);return new Lo(s,this._parents)}function Rw(e){return new Array(e.length)}function Fz(){return new Lo(this._enter||this._groups.map(Rw),this._parents)}function H0(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}H0.prototype={constructor:H0,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Nz(e){return function(){return e}}function VK(e,t,n,s,h,r){for(var w=0,A,F=t.length,$=r.length;w<$;++w)(A=t[w])?(A.__data__=r[w],s[w]=A):n[w]=new H0(e,r[w]);for(;w<F;++w)(A=t[w])&&(h[w]=A)}function jK(e,t,n,s,h,r,w){var A,F,$=new Map,K=t.length,se=r.length,le=new Array(K),ae;for(A=0;A<K;++A)(F=t[A])&&(le[A]=ae=w.call(F,F.__data__,A,t)+"",$.has(ae)?h[A]=F:$.set(ae,F));for(A=0;A<se;++A)ae=w.call(e,r[A],A,r)+"",(F=$.get(ae))?(s[A]=F,F.__data__=r[A],$.delete(ae)):n[A]=new H0(e,r[A]);for(A=0;A<K;++A)(F=t[A])&&$.get(le[A])===F&&(h[A]=F)}function UK(e){return e.__data__}function zz(e,t){if(!arguments.length)return Array.from(this,UK);var n=t?jK:VK,s=this._parents,h=this._groups;typeof e!="function"&&(e=Nz(e));for(var r=h.length,w=new Array(r),A=new Array(r),F=new Array(r),$=0;$<r;++$){var K=s[$],se=h[$],le=se.length,ae=HK(e.call(K,K&&K.__data__,$,s)),Ze=ae.length,Ue=A[$]=new Array(Ze),ft=w[$]=new Array(Ze),Xe=F[$]=new Array(le);n(K,se,Ue,ft,Xe,ae,t);for(var st=0,Ut=0,Bt,xt;st<Ze;++st)if(Bt=Ue[st]){for(st>=Ut&&(Ut=st+1);!(xt=ft[Ut])&&++Ut<Ze;);Bt._next=xt||null}}return w=new Lo(w,s),w._enter=A,w._exit=F,w}function HK(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Bz(){return new Lo(this._exit||this._groups.map(Rw),this._parents)}function Vz(e,t,n){var s=this.enter(),h=this,r=this.exit();return typeof e=="function"?(s=e(s),s&&(s=s.selection())):s=s.append(e+""),t!=null&&(h=t(h),h&&(h=h.selection())),n==null?r.remove():n(r),s&&h?s.merge(h).order():h}function jz(e){for(var t=e.selection?e.selection():e,n=this._groups,s=t._groups,h=n.length,r=s.length,w=Math.min(h,r),A=new Array(h),F=0;F<w;++F)for(var $=n[F],K=s[F],se=$.length,le=A[F]=new Array(se),ae,Ze=0;Ze<se;++Ze)(ae=$[Ze]||K[Ze])&&(le[Ze]=ae);for(;F<h;++F)A[F]=n[F];return new Lo(A,this._parents)}function Uz(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var s=e[t],h=s.length-1,r=s[h],w;--h>=0;)(w=s[h])&&(r&&w.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(w,r),r=w);return this}function Hz(e){e||(e=$K);function t(se,le){return se&&le?e(se.__data__,le.__data__):!se-!le}for(var n=this._groups,s=n.length,h=new Array(s),r=0;r<s;++r){for(var w=n[r],A=w.length,F=h[r]=new Array(A),$,K=0;K<A;++K)($=w[K])&&(F[K]=$);F.sort(t)}return new Lo(h,this._parents).order()}function $K(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function $z(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Gz(){return Array.from(this)}function qz(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],h=0,r=s.length;h<r;++h){var w=s[h];if(w)return w}return null}function Zz(){let e=0;for(let t of this)++e;return e}function Wz(){return!this.node()}function Yz(e){for(var t=this._groups,n=0,s=t.length;n<s;++n)for(var h=t[n],r=0,w=h.length,A;r<w;++r)(A=h[r])&&e.call(A,A.__data__,r,h);return this}function GK(e){return function(){this.removeAttribute(e)}}function qK(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ZK(e,t){return function(){this.setAttribute(e,t)}}function WK(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function YK(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function XK(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Xz(e,t){var n=kh(e);if(arguments.length<2){var s=this.node();return n.local?s.getAttributeNS(n.space,n.local):s.getAttribute(n)}return this.each((t==null?n.local?qK:GK:typeof t=="function"?n.local?XK:YK:n.local?WK:ZK)(n,t))}function kw(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function KK(e){return function(){this.style.removeProperty(e)}}function JK(e,t,n){return function(){this.style.setProperty(e,t,n)}}function QK(e,t,n){return function(){var s=t.apply(this,arguments);s==null?this.style.removeProperty(e):this.style.setProperty(e,s,n)}}function Kz(e,t,n){return arguments.length>1?this.each((t==null?KK:typeof t=="function"?QK:JK)(e,t,n??"")):nf(this.node(),e)}function nf(e,t){return e.style.getPropertyValue(t)||kw(e).getComputedStyle(e,null).getPropertyValue(t)}function eJ(e){return function(){delete this[e]}}function tJ(e,t){return function(){this[e]=t}}function nJ(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Jz(e,t){return arguments.length>1?this.each((t==null?eJ:typeof t=="function"?nJ:tJ)(e,t)):this.node()[e]}function Qz(e){return e.trim().split(/^|\s+/)}function b2(e){return e.classList||new e4(e)}function e4(e){this._node=e,this._names=Qz(e.getAttribute("class")||"")}e4.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function t4(e,t){for(var n=b2(e),s=-1,h=t.length;++s<h;)n.add(t[s])}function n4(e,t){for(var n=b2(e),s=-1,h=t.length;++s<h;)n.remove(t[s])}function iJ(e){return function(){t4(this,e)}}function rJ(e){return function(){n4(this,e)}}function oJ(e,t){return function(){(t.apply(this,arguments)?t4:n4)(this,e)}}function i4(e,t){var n=Qz(e+"");if(arguments.length<2){for(var s=b2(this.node()),h=-1,r=n.length;++h<r;)if(!s.contains(n[h]))return!1;return!0}return this.each((typeof t=="function"?oJ:t?iJ:rJ)(n,t))}function sJ(){this.textContent=""}function aJ(e){return function(){this.textContent=e}}function lJ(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function r4(e){return arguments.length?this.each(e==null?sJ:(typeof e=="function"?lJ:aJ)(e)):this.node().textContent}function cJ(){this.innerHTML=""}function uJ(e){return function(){this.innerHTML=e}}function hJ(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function o4(e){return arguments.length?this.each(e==null?cJ:(typeof e=="function"?hJ:uJ)(e)):this.node().innerHTML}function dJ(){this.nextSibling&&this.parentNode.appendChild(this)}function s4(){return this.each(dJ)}function fJ(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function a4(){return this.each(fJ)}function l4(e){var t=typeof e=="function"?e:Ow(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function pJ(){return null}function c4(e,t){var n=typeof e=="function"?e:Ow(e),s=t==null?pJ:typeof t=="function"?t:Ep(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),s.apply(this,arguments)||null)})}function mJ(){var e=this.parentNode;e&&e.removeChild(this)}function u4(){return this.each(mJ)}function gJ(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function _J(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function h4(e){return this.select(e?_J:gJ)}function d4(e){return arguments.length?this.property("__data__",e):this.node().__data__}function yJ(e){return function(t){e.call(this,t,this.__data__)}}function vJ(e){return e.trim().split(/^|\s+/).map(function(t){var n="",s=t.indexOf(".");return s>=0&&(n=t.slice(s+1),t=t.slice(0,s)),{type:t,name:n}})}function xJ(e){return function(){var t=this.__on;if(t){for(var n=0,s=-1,h=t.length,r;n<h;++n)r=t[n],(!e.type||r.type===e.type)&&r.name===e.name?this.removeEventListener(r.type,r.listener,r.options):t[++s]=r;++s?t.length=s:delete this.__on}}}function bJ(e,t,n){return function(){var s=this.__on,h,r=yJ(t);if(s){for(var w=0,A=s.length;w<A;++w)if((h=s[w]).type===e.type&&h.name===e.name){this.removeEventListener(h.type,h.listener,h.options),this.addEventListener(h.type,h.listener=r,h.options=n),h.value=t;return}}this.addEventListener(e.type,r,n),h={type:e.type,name:e.name,value:t,listener:r,options:n},s?s.push(h):this.__on=[h]}}function f4(e,t,n){var s=vJ(e+""),h,r=s.length,w;if(arguments.length<2){var A=this.node().__on;if(A){for(var F=0,$=A.length,K;F<$;++F)for(h=0,K=A[F];h<r;++h)if((w=s[h]).type===K.type&&w.name===K.name)return K.value}return}for(A=t?bJ:xJ,h=0;h<r;++h)this.each(A(s[h],t,n));return this}function p4(e,t,n){var s=kw(e),h=s.CustomEvent;typeof h=="function"?h=new h(t,n):(h=s.document.createEvent("Event"),n?(h.initEvent(t,n.bubbles,n.cancelable),h.detail=n.detail):h.initEvent(t,!1,!1)),e.dispatchEvent(h)}function wJ(e,t){return function(){return p4(this,e,t)}}function CJ(e,t){return function(){return p4(this,e,t.apply(this,arguments))}}function m4(e,t){return this.each((typeof t=="function"?CJ:wJ)(e,t))}function*g4(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],h=0,r=s.length,w;h<r;++h)(w=s[h])&&(yield w)}var w2=[null];function Lo(e,t){this._groups=e,this._parents=t}function _4(){return new Lo([[document.documentElement]],w2)}function MJ(){return this}Lo.prototype=_4.prototype={constructor:Lo,select:Oz,selectAll:Az,selectChild:Rz,selectChildren:kz,filter:Lz,data:zz,enter:Fz,exit:Bz,join:Vz,merge:jz,selection:MJ,order:Uz,sort:Hz,call:$z,nodes:Gz,node:qz,size:Zz,empty:Wz,each:Yz,attr:Xz,style:Kz,property:Jz,classed:i4,text:r4,html:o4,raise:s4,lower:a4,append:l4,insert:c4,remove:u4,clone:h4,datum:d4,on:f4,dispatch:m4,[Symbol.iterator]:g4};var Lh=_4;function Ml(e){return typeof e=="string"?new Lo([[document.querySelector(e)]],[document.documentElement]):new Lo([[e]],w2)}function y4(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Fh(e,t){if(e=y4(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var s=n.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,s=s.matrixTransform(t.getScreenCTM().inverse()),[s.x,s.y]}if(t.getBoundingClientRect){var h=t.getBoundingClientRect();return[e.clientX-h.left-t.clientLeft,e.clientY-h.top-t.clientTop]}}return[e.pageX,e.pageY]}var Lw={capture:!0,passive:!1};function Fw(e){e.preventDefault(),e.stopImmediatePropagation()}function C2(e){var t=e.document.documentElement,n=Ml(e).on("dragstart.drag",Fw,Lw);"onselectstart"in t?n.on("selectstart.drag",Fw,Lw):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function M2(e,t){var n=e.document.documentElement,s=Ml(e).on("dragstart.drag",null);t&&(s.on("click.drag",Fw,Lw),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in n?s.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Nw(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function T2(e,t){var n=Object.create(e.prototype);for(var s in t)n[s]=t[s];return n}function q0(){}var $0=.7,Vw=1/$0,Gg="\\s*([+-]?\\d+)\\s*",G0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ru="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",TJ=/^#([0-9a-f]{3,8})$/,EJ=new RegExp(`^rgb\\(${Gg},${Gg},${Gg}\\)$`),SJ=new RegExp(`^rgb\\(${Ru},${Ru},${Ru}\\)$`),IJ=new RegExp(`^rgba\\(${Gg},${Gg},${Gg},${G0}\\)$`),PJ=new RegExp(`^rgba\\(${Ru},${Ru},${Ru},${G0}\\)$`),DJ=new RegExp(`^hsl\\(${G0},${Ru},${Ru}\\)$`),OJ=new RegExp(`^hsla\\(${G0},${Ru},${Ru},${G0}\\)$`),v4={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Nw(q0,Uc,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:x4,formatHex:x4,formatHex8:AJ,formatHsl:RJ,formatRgb:b4,toString:b4});function x4(){return this.rgb().formatHex()}function AJ(){return this.rgb().formatHex8()}function RJ(){return S4(this).formatHsl()}function b4(){return this.rgb().formatRgb()}function Uc(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=TJ.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?w4(t):n===3?new Za(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?zw(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?zw(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=EJ.exec(e))?new Za(t[1],t[2],t[3],1):(t=SJ.exec(e))?new Za(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=IJ.exec(e))?zw(t[1],t[2],t[3],t[4]):(t=PJ.exec(e))?zw(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=DJ.exec(e))?T4(t[1],t[2]/100,t[3]/100,1):(t=OJ.exec(e))?T4(t[1],t[2]/100,t[3]/100,t[4]):v4.hasOwnProperty(e)?w4(v4[e]):e==="transparent"?new Za(NaN,NaN,NaN,0):null}function w4(e){return new Za(e>>16&255,e>>8&255,e&255,1)}function zw(e,t,n,s){return s<=0&&(e=t=n=NaN),new Za(e,t,n,s)}function kJ(e){return e instanceof q0||(e=Uc(e)),e?(e=e.rgb(),new Za(e.r,e.g,e.b,e.opacity)):new Za}function qg(e,t,n,s){return arguments.length===1?kJ(e):new Za(e,t,n,s??1)}function Za(e,t,n,s){this.r=+e,this.g=+t,this.b=+n,this.opacity=+s}Nw(Za,qg,T2(q0,{brighter(e){return e=e==null?Vw:Math.pow(Vw,e),new Za(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?$0:Math.pow($0,e),new Za(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Za(Ip(this.r),Ip(this.g),Ip(this.b),jw(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:C4,formatHex:C4,formatHex8:LJ,formatRgb:M4,toString:M4}));function C4(){return`#${Sp(this.r)}${Sp(this.g)}${Sp(this.b)}`}function LJ(){return`#${Sp(this.r)}${Sp(this.g)}${Sp(this.b)}${Sp((isNaN(this.opacity)?1:this.opacity)*255)}`}function M4(){let e=jw(this.opacity);return`${e===1?"rgb(":"rgba("}${Ip(this.r)}, ${Ip(this.g)}, ${Ip(this.b)}${e===1?")":`, ${e})`}`}function jw(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ip(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Sp(e){return e=Ip(e),(e<16?"0":"")+e.toString(16)}function T4(e,t,n,s){return s<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new jc(e,t,n,s)}function S4(e){if(e instanceof jc)return new jc(e.h,e.s,e.l,e.opacity);if(e instanceof q0||(e=Uc(e)),!e)return new jc;if(e instanceof jc)return e;e=e.rgb();var t=e.r/255,n=e.g/255,s=e.b/255,h=Math.min(t,n,s),r=Math.max(t,n,s),w=NaN,A=r-h,F=(r+h)/2;return A?(t===r?w=(n-s)/A+(n<s)*6:n===r?w=(s-t)/A+2:w=(t-n)/A+4,A/=F<.5?r+h:2-r-h,w*=60):A=F>0&&F<1?0:w,new jc(w,A,F,e.opacity)}function I4(e,t,n,s){return arguments.length===1?S4(e):new jc(e,t,n,s??1)}function jc(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}Nw(jc,I4,T2(q0,{brighter(e){return e=e==null?Vw:Math.pow(Vw,e),new jc(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?$0:Math.pow($0,e),new jc(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,s=n+(n<.5?n:1-n)*t,h=2*n-s;return new Za(E2(e>=240?e-240:e+120,h,s),E2(e,h,s),E2(e<120?e+240:e-120,h,s),this.opacity)},clamp(){return new jc(E4(this.h),Bw(this.s),Bw(this.l),jw(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=jw(this.opacity);return`${e===1?"hsl(":"hsla("}${E4(this.h)}, ${Bw(this.s)*100}%, ${Bw(this.l)*100}%${e===1?")":`, ${e})`}`}}));function E4(e){return e=(e||0)%360,e<0?e+360:e}function Bw(e){return Math.max(0,Math.min(1,e||0))}function E2(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}function S2(e,t,n,s,h){var r=e*e,w=r*e;return((1-3*e+3*r-w)*t+(4-6*r+3*w)*n+(1+3*e+3*r-3*w)*s+w*h)/6}function P4(e){var t=e.length-1;return function(n){var s=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),h=e[s],r=e[s+1],w=s>0?e[s-1]:2*h-r,A=s<t-1?e[s+2]:2*r-h;return S2((n-s/t)*t,w,h,r,A)}}function D4(e){var t=e.length;return function(n){var s=Math.floor(((n%=1)<0?++n:n)*t),h=e[(s+t-1)%t],r=e[s%t],w=e[(s+1)%t],A=e[(s+2)%t];return S2((n-s/t)*t,h,r,w,A)}}var Z0=e=>()=>e;function FJ(e,t){return function(n){return e+n*t}}function NJ(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(s){return Math.pow(e+s*t,n)}}function O4(e){return(e=+e)==1?Uw:function(t,n){return n-t?NJ(t,n,e):Z0(isNaN(t)?n:t)}}function Uw(e,t){var n=t-e;return n?FJ(e,n):Z0(isNaN(e)?t:e)}var Pp=function e(t){var n=O4(t);function s(h,r){var w=n((h=qg(h)).r,(r=qg(r)).r),A=n(h.g,r.g),F=n(h.b,r.b),$=Uw(h.opacity,r.opacity);return function(K){return h.r=w(K),h.g=A(K),h.b=F(K),h.opacity=$(K),h+""}}return s.gamma=e,s}(1);function A4(e){return function(t){var n=t.length,s=new Array(n),h=new Array(n),r=new Array(n),w,A;for(w=0;w<n;++w)A=qg(t[w]),s[w]=A.r||0,h[w]=A.g||0,r[w]=A.b||0;return s=e(s),h=e(h),r=e(r),A.opacity=1,function(F){return A.r=s(F),A.g=h(F),A.b=r(F),A+""}}}var zJ=A4(P4),BJ=A4(D4);function R4(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,s=t.slice(),h;return function(r){for(h=0;h<n;++h)s[h]=e[h]*(1-r)+t[h]*r;return s}}function k4(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function L4(e,t){var n=t?t.length:0,s=e?Math.min(n,e.length):0,h=new Array(s),r=new Array(n),w;for(w=0;w<s;++w)h[w]=Dp(e[w],t[w]);for(;w<n;++w)r[w]=t[w];return function(A){for(w=0;w<s;++w)r[w]=h[w](A);return r}}function F4(e,t){var n=new Date;return e=+e,t=+t,function(s){return n.setTime(e*(1-s)+t*s),n}}function Rs(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function N4(e,t){var n={},s={},h;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(h in t)h in e?n[h]=Dp(e[h],t[h]):s[h]=t[h];return function(r){for(h in n)s[h]=n[h](r);return s}}var P2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,I2=new RegExp(P2.source,"g");function VJ(e){return function(){return e}}function jJ(e){return function(t){return e(t)+""}}function W0(e,t){var n=P2.lastIndex=I2.lastIndex=0,s,h,r,w=-1,A=[],F=[];for(e=e+"",t=t+"";(s=P2.exec(e))&&(h=I2.exec(t));)(r=h.index)>n&&(r=t.slice(n,r),A[w]?A[w]+=r:A[++w]=r),(s=s[0])===(h=h[0])?A[w]?A[w]+=h:A[++w]=h:(A[++w]=null,F.push({i:w,x:Rs(s,h)})),n=I2.lastIndex;return n<t.length&&(r=t.slice(n),A[w]?A[w]+=r:A[++w]=r),A.length<2?F[0]?jJ(F[0].x):VJ(t):(t=F.length,function($){for(var K=0,se;K<t;++K)A[(se=F[K]).i]=se.x($);return A.join("")})}function Dp(e,t){var n=typeof t,s;return t==null||n==="boolean"?Z0(t):(n==="number"?Rs:n==="string"?(s=Uc(t))?(t=s,Pp):W0:t instanceof Uc?Pp:t instanceof Date?F4:k4(t)?R4:Array.isArray(t)?L4:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?N4:Rs)(e,t)}function D2(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var z4=180/Math.PI,Hw={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function O2(e,t,n,s,h,r){var w,A,F;return(w=Math.sqrt(e*e+t*t))&&(e/=w,t/=w),(F=e*n+t*s)&&(n-=e*F,s-=t*F),(A=Math.sqrt(n*n+s*s))&&(n/=A,s/=A,F/=A),e*s<t*n&&(e=-e,t=-t,F=-F,w=-w),{translateX:h,translateY:r,rotate:Math.atan2(t,e)*z4,skewX:Math.atan(F)*z4,scaleX:w,scaleY:A}}var $w;function B4(e){let t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Hw:O2(t.a,t.b,t.c,t.d,t.e,t.f)}function V4(e){return e==null?Hw:($w||($w=document.createElementNS("http://www.w3.org/2000/svg","g")),$w.setAttribute("transform",e),(e=$w.transform.baseVal.consolidate())?(e=e.matrix,O2(e.a,e.b,e.c,e.d,e.e,e.f)):Hw)}function j4(e,t,n,s){function h($){return $.length?$.pop()+" ":""}function r($,K,se,le,ae,Ze){if($!==se||K!==le){var Ue=ae.push("translate(",null,t,null,n);Ze.push({i:Ue-4,x:Rs($,se)},{i:Ue-2,x:Rs(K,le)})}else(se||le)&&ae.push("translate("+se+t+le+n)}function w($,K,se,le){$!==K?($-K>180?K+=360:K-$>180&&($+=360),le.push({i:se.push(h(se)+"rotate(",null,s)-2,x:Rs($,K)})):K&&se.push(h(se)+"rotate("+K+s)}function A($,K,se,le){$!==K?le.push({i:se.push(h(se)+"skewX(",null,s)-2,x:Rs($,K)}):K&&se.push(h(se)+"skewX("+K+s)}function F($,K,se,le,ae,Ze){if($!==se||K!==le){var Ue=ae.push(h(ae)+"scale(",null,",",null,")");Ze.push({i:Ue-4,x:Rs($,se)},{i:Ue-2,x:Rs(K,le)})}else(se!==1||le!==1)&&ae.push(h(ae)+"scale("+se+","+le+")")}return function($,K){var se=[],le=[];return $=e($),K=e(K),r($.translateX,$.translateY,K.translateX,K.translateY,se,le),w($.rotate,K.rotate,se,le),A($.skewX,K.skewX,se,le),F($.scaleX,$.scaleY,K.scaleX,K.scaleY,se,le),$=K=null,function(ae){for(var Ze=-1,Ue=le.length,ft;++Ze<Ue;)se[(ft=le[Ze]).i]=ft.x(ae);return se.join("")}}}var A2=j4(B4,"px, ","px)","deg)"),R2=j4(V4,", ",")",")");var UJ=1e-12;function U4(e){return((e=Math.exp(e))+1/e)/2}function HJ(e){return((e=Math.exp(e))-1/e)/2}function $J(e){return((e=Math.exp(2*e))-1)/(e+1)}var k2=function e(t,n,s){function h(r,w){var A=r[0],F=r[1],$=r[2],K=w[0],se=w[1],le=w[2],ae=K-A,Ze=se-F,Ue=ae*ae+Ze*Ze,ft,Xe;if(Ue<UJ)Xe=Math.log(le/$)/t,ft=function(rn){return[A+rn*ae,F+rn*Ze,$*Math.exp(t*rn*Xe)]};else{var st=Math.sqrt(Ue),Ut=(le*le-$*$+s*Ue)/(2*$*n*st),Bt=(le*le-$*$-s*Ue)/(2*le*n*st),xt=Math.log(Math.sqrt(Ut*Ut+1)-Ut),yt=Math.log(Math.sqrt(Bt*Bt+1)-Bt);Xe=(yt-xt)/t,ft=function(rn){var Dt=rn*Xe,Tt=U4(xt),ri=$/(n*st)*(Tt*$J(t*Dt+xt)-HJ(xt));return[A+ri*ae,F+ri*Ze,$*Tt/U4(t*Dt+xt)]}}return ft.duration=Xe*1e3*t/Math.SQRT2,ft}return h.rho=function(r){var w=Math.max(.001,+r),A=w*w,F=A*A;return e(w,A,F)},h}(Math.SQRT2,2,4);var Zg=0,X0=0,Y0=0,$4=1e3,Gw,K0,qw=0,Op=0,Zw=0,J0=typeof performance=="object"&&performance.now?performance:Date,G4=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function ev(){return Op||(G4(GJ),Op=J0.now()+Zw)}function GJ(){Op=0}function Q0(){this._call=this._time=this._next=null}Q0.prototype=Ww.prototype={constructor:Q0,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?ev():+n)+(t==null?0:+t),!this._next&&K0!==this&&(K0?K0._next=this:Gw=this,K0=this),this._call=e,this._time=n,L2()},stop:function(){this._call&&(this._call=null,this._time=1/0,L2())}};function Ww(e,t,n){var s=new Q0;return s.restart(e,t,n),s}function q4(){ev(),++Zg;for(var e=Gw,t;e;)(t=Op-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Zg}function H4(){Op=(qw=J0.now())+Zw,Zg=X0=0;try{q4()}finally{Zg=0,ZJ(),Op=0}}function qJ(){var e=J0.now(),t=e-qw;t>$4&&(Zw-=t,qw=e)}function ZJ(){for(var e,t=Gw,n,s=1/0;t;)t._call?(s>t._time&&(s=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Gw=n);K0=e,L2(s)}function L2(e){if(!Zg){X0&&(X0=clearTimeout(X0));var t=e-Op;t>24?(e<1/0&&(X0=setTimeout(H4,e-J0.now()-Zw)),Y0&&(Y0=clearInterval(Y0))):(Y0||(qw=J0.now(),Y0=setInterval(qJ,$4)),Zg=1,G4(H4))}}function Yw(e,t,n){var s=new Q0;return t=t==null?0:+t,s.restart(h=>{s.stop(),e(h+t)},t,n),s}var WJ=V0("start","end","cancel","interrupt"),YJ=[],Y4=0,Z4=1,Kw=2,Xw=3,W4=4,Jw=5,tv=6;function rf(e,t,n,s,h,r){var w=e.__transition;if(!w)e.__transition={};else if(n in w)return;XJ(e,n,{name:t,index:s,group:h,on:WJ,tween:YJ,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:Y4})}function nv(e,t){var n=os(e,t);if(n.state>Y4)throw new Error("too late; already scheduled");return n}function ks(e,t){var n=os(e,t);if(n.state>Xw)throw new Error("too late; already running");return n}function os(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function XJ(e,t,n){var s=e.__transition,h;s[t]=n,n.timer=Ww(r,0,n.time);function r($){n.state=Z4,n.timer.restart(w,n.delay,n.time),n.delay<=$&&w($-n.delay)}function w($){var K,se,le,ae;if(n.state!==Z4)return F();for(K in s)if(ae=s[K],ae.name===n.name){if(ae.state===Xw)return Yw(w);ae.state===W4?(ae.state=tv,ae.timer.stop(),ae.on.call("interrupt",e,e.__data__,ae.index,ae.group),delete s[K]):+K<t&&(ae.state=tv,ae.timer.stop(),ae.on.call("cancel",e,e.__data__,ae.index,ae.group),delete s[K])}if(Yw(function(){n.state===Xw&&(n.state=W4,n.timer.restart(A,n.delay,n.time),A($))}),n.state=Kw,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Kw){for(n.state=Xw,h=new Array(le=n.tween.length),K=0,se=-1;K<le;++K)(ae=n.tween[K].value.call(e,e.__data__,n.index,n.group))&&(h[++se]=ae);h.length=se+1}}function A($){for(var K=$<n.duration?n.ease.call(null,$/n.duration):(n.timer.restart(F),n.state=Jw,1),se=-1,le=h.length;++se<le;)h[se].call(e,K);n.state===Jw&&(n.on.call("end",e,e.__data__,n.index,n.group),F())}function F(){n.state=tv,n.timer.stop(),delete s[t];for(var $ in s)return;delete e.__transition}}function Ap(e,t){var n=e.__transition,s,h,r=!0,w;if(n){t=t==null?null:t+"";for(w in n){if((s=n[w]).name!==t){r=!1;continue}h=s.state>Kw&&s.state<Jw,s.state=tv,s.timer.stop(),s.on.call(h?"interrupt":"cancel",e,e.__data__,s.index,s.group),delete n[w]}r&&delete e.__transition}}function X4(e){return this.each(function(){Ap(this,e)})}function KJ(e,t){var n,s;return function(){var h=ks(this,e),r=h.tween;if(r!==n){s=n=r;for(var w=0,A=s.length;w<A;++w)if(s[w].name===t){s=s.slice(),s.splice(w,1);break}}h.tween=s}}function JJ(e,t,n){var s,h;if(typeof n!="function")throw new Error;return function(){var r=ks(this,e),w=r.tween;if(w!==s){h=(s=w).slice();for(var A={name:t,value:n},F=0,$=h.length;F<$;++F)if(h[F].name===t){h[F]=A;break}F===$&&h.push(A)}r.tween=h}}function K4(e,t){var n=this._id;if(e+="",arguments.length<2){for(var s=os(this.node(),n).tween,h=0,r=s.length,w;h<r;++h)if((w=s[h]).name===e)return w.value;return null}return this.each((t==null?KJ:JJ)(n,e,t))}function Wg(e,t,n){var s=e._id;return e.each(function(){var h=ks(this,s);(h.value||(h.value={}))[t]=n.apply(this,arguments)}),function(h){return os(h,s).value[t]}}function Qw(e,t){var n;return(typeof t=="number"?Rs:t instanceof Uc?Pp:(n=Uc(t))?(t=n,Pp):W0)(e,t)}function QJ(e){return function(){this.removeAttribute(e)}}function eQ(e){return function(){this.removeAttributeNS(e.space,e.local)}}function tQ(e,t,n){var s,h=n+"",r;return function(){var w=this.getAttribute(e);return w===h?null:w===s?r:r=t(s=w,n)}}function nQ(e,t,n){var s,h=n+"",r;return function(){var w=this.getAttributeNS(e.space,e.local);return w===h?null:w===s?r:r=t(s=w,n)}}function iQ(e,t,n){var s,h,r;return function(){var w,A=n(this),F;return A==null?void this.removeAttribute(e):(w=this.getAttribute(e),F=A+"",w===F?null:w===s&&F===h?r:(h=F,r=t(s=w,A)))}}function rQ(e,t,n){var s,h,r;return function(){var w,A=n(this),F;return A==null?void this.removeAttributeNS(e.space,e.local):(w=this.getAttributeNS(e.space,e.local),F=A+"",w===F?null:w===s&&F===h?r:(h=F,r=t(s=w,A)))}}function J4(e,t){var n=kh(e),s=n==="transform"?R2:Qw;return this.attrTween(e,typeof t=="function"?(n.local?rQ:iQ)(n,s,Wg(this,"attr."+e,t)):t==null?(n.local?eQ:QJ)(n):(n.local?nQ:tQ)(n,s,t))}function oQ(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function sQ(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function aQ(e,t){var n,s;function h(){var r=t.apply(this,arguments);return r!==s&&(n=(s=r)&&sQ(e,r)),n}return h._value=t,h}function lQ(e,t){var n,s;function h(){var r=t.apply(this,arguments);return r!==s&&(n=(s=r)&&oQ(e,r)),n}return h._value=t,h}function Q4(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var s=kh(e);return this.tween(n,(s.local?aQ:lQ)(s,t))}function cQ(e,t){return function(){nv(this,e).delay=+t.apply(this,arguments)}}function uQ(e,t){return t=+t,function(){nv(this,e).delay=t}}function eB(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?cQ:uQ)(t,e)):os(this.node(),t).delay}function hQ(e,t){return function(){ks(this,e).duration=+t.apply(this,arguments)}}function dQ(e,t){return t=+t,function(){ks(this,e).duration=t}}function tB(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?hQ:dQ)(t,e)):os(this.node(),t).duration}function fQ(e,t){if(typeof t!="function")throw new Error;return function(){ks(this,e).ease=t}}function nB(e){var t=this._id;return arguments.length?this.each(fQ(t,e)):os(this.node(),t).ease}function pQ(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;ks(this,e).ease=n}}function iB(e){if(typeof e!="function")throw new Error;return this.each(pQ(this._id,e))}function rB(e){typeof e!="function"&&(e=U0(e));for(var t=this._groups,n=t.length,s=new Array(n),h=0;h<n;++h)for(var r=t[h],w=r.length,A=s[h]=[],F,$=0;$<w;++$)(F=r[$])&&e.call(F,F.__data__,$,r)&&A.push(F);return new Sa(s,this._parents,this._name,this._id)}function oB(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,s=t.length,h=n.length,r=Math.min(s,h),w=new Array(s),A=0;A<r;++A)for(var F=t[A],$=n[A],K=F.length,se=w[A]=new Array(K),le,ae=0;ae<K;++ae)(le=F[ae]||$[ae])&&(se[ae]=le);for(;A<s;++A)w[A]=t[A];return new Sa(w,this._parents,this._name,this._id)}function mQ(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function gQ(e,t,n){var s,h,r=mQ(t)?nv:ks;return function(){var w=r(this,e),A=w.on;A!==s&&(h=(s=A).copy()).on(t,n),w.on=h}}function sB(e,t){var n=this._id;return arguments.length<2?os(this.node(),n).on.on(e):this.each(gQ(n,e,t))}function _Q(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function aB(){return this.on("end.remove",_Q(this._id))}function lB(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ep(e));for(var s=this._groups,h=s.length,r=new Array(h),w=0;w<h;++w)for(var A=s[w],F=A.length,$=r[w]=new Array(F),K,se,le=0;le<F;++le)(K=A[le])&&(se=e.call(K,K.__data__,le,A))&&("__data__"in K&&(se.__data__=K.__data__),$[le]=se,rf($[le],t,n,le,$,os(K,n)));return new Sa(r,this._parents,t,n)}function cB(e){var t=this._name,n=this._id;typeof e!="function"&&(e=j0(e));for(var s=this._groups,h=s.length,r=[],w=[],A=0;A<h;++A)for(var F=s[A],$=F.length,K,se=0;se<$;++se)if(K=F[se]){for(var le=e.call(K,K.__data__,se,F),ae,Ze=os(K,n),Ue=0,ft=le.length;Ue<ft;++Ue)(ae=le[Ue])&&rf(ae,t,n,Ue,le,Ze);r.push(le),w.push(K)}return new Sa(r,w,t,n)}var yQ=Lh.prototype.constructor;function uB(){return new yQ(this._groups,this._parents)}function vQ(e,t){var n,s,h;return function(){var r=nf(this,e),w=(this.style.removeProperty(e),nf(this,e));return r===w?null:r===n&&w===s?h:h=t(n=r,s=w)}}function hB(e){return function(){this.style.removeProperty(e)}}function xQ(e,t,n){var s,h=n+"",r;return function(){var w=nf(this,e);return w===h?null:w===s?r:r=t(s=w,n)}}function bQ(e,t,n){var s,h,r;return function(){var w=nf(this,e),A=n(this),F=A+"";return A==null&&(F=A=(this.style.removeProperty(e),nf(this,e))),w===F?null:w===s&&F===h?r:(h=F,r=t(s=w,A))}}function wQ(e,t){var n,s,h,r="style."+t,w="end."+r,A;return function(){var F=ks(this,e),$=F.on,K=F.value[r]==null?A||(A=hB(t)):void 0;($!==n||h!==K)&&(s=(n=$).copy()).on(w,h=K),F.on=s}}function dB(e,t,n){var s=(e+="")=="transform"?A2:Qw;return t==null?this.styleTween(e,vQ(e,s)).on("end.style."+e,hB(e)):typeof t=="function"?this.styleTween(e,bQ(e,s,Wg(this,"style."+e,t))).each(wQ(this._id,e)):this.styleTween(e,xQ(e,s,t),n).on("end.style."+e,null)}function CQ(e,t,n){return function(s){this.style.setProperty(e,t.call(this,s),n)}}function MQ(e,t,n){var s,h;function r(){var w=t.apply(this,arguments);return w!==h&&(s=(h=w)&&CQ(e,w,n)),s}return r._value=t,r}function fB(e,t,n){var s="style."+(e+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;return this.tween(s,MQ(e,t,n??""))}function TQ(e){return function(){this.textContent=e}}function EQ(e){return function(){var t=e(this);this.textContent=t??""}}function pB(e){return this.tween("text",typeof e=="function"?EQ(Wg(this,"text",e)):TQ(e==null?"":e+""))}function SQ(e){return function(t){this.textContent=e.call(this,t)}}function IQ(e){var t,n;function s(){var h=e.apply(this,arguments);return h!==n&&(t=(n=h)&&SQ(h)),t}return s._value=e,s}function mB(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,IQ(e))}function gB(){for(var e=this._name,t=this._id,n=eC(),s=this._groups,h=s.length,r=0;r<h;++r)for(var w=s[r],A=w.length,F,$=0;$<A;++$)if(F=w[$]){var K=os(F,t);rf(F,e,n,$,w,{time:K.time+K.delay+K.duration,delay:0,duration:K.duration,ease:K.ease})}return new Sa(s,this._parents,e,n)}function _B(){var e,t,n=this,s=n._id,h=n.size();return new Promise(function(r,w){var A={value:w},F={value:function(){--h===0&&r()}};n.each(function(){var $=ks(this,s),K=$.on;K!==e&&(t=(e=K).copy(),t._.cancel.push(A),t._.interrupt.push(A),t._.end.push(F)),$.on=t}),h===0&&r()})}var PQ=0;function Sa(e,t,n,s){this._groups=e,this._parents=t,this._name=n,this._id=s}function yB(e){return Lh().transition(e)}function eC(){return++PQ}var Nh=Lh.prototype;Sa.prototype=yB.prototype={constructor:Sa,select:lB,selectAll:cB,selectChild:Nh.selectChild,selectChildren:Nh.selectChildren,filter:rB,merge:oB,selection:uB,transition:gB,call:Nh.call,nodes:Nh.nodes,node:Nh.node,size:Nh.size,empty:Nh.empty,each:Nh.each,on:sB,attr:J4,attrTween:Q4,style:dB,styleTween:fB,text:pB,textTween:mB,remove:aB,tween:K4,delay:eB,duration:tB,ease:nB,easeVarying:iB,end:_B,[Symbol.iterator]:Nh[Symbol.iterator]};function iv(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}function tC(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var DQ={time:null,delay:0,duration:250,ease:tC};function OQ(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function vB(e){var t,n;e instanceof Sa?(t=e._id,e=e._name):(t=eC(),(n=DQ).time=ev(),e=e==null?null:e+"");for(var s=this._groups,h=s.length,r=0;r<h;++r)for(var w=s[r],A=w.length,F,$=0;$<A;++$)(F=w[$])&&rf(F,e,t,$,w,n||OQ(F,t));return new Sa(s,this._parents,e,t)}Lh.prototype.interrupt=X4;Lh.prototype.transition=vB;var rv=e=>()=>e;function F2(e,{sourceEvent:t,target:n,transform:s,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:h}})}function Hc(e,t,n){this.k=e,this.x=t,this.y=n}Hc.prototype={constructor:Hc,scale:function(e){return e===1?this:new Hc(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Hc(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var of=new Hc(1,0,0);N2.prototype=Hc.prototype;function N2(e){for(;!e.__zoom;)if(!(e=e.parentNode))return of;return e.__zoom}function nC(e){e.stopImmediatePropagation()}function Yg(e){e.preventDefault(),e.stopImmediatePropagation()}function AQ(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function RQ(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function xB(){return this.__zoom||of}function kQ(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function LQ(){return navigator.maxTouchPoints||"ontouchstart"in this}function FQ(e,t,n){var s=e.invertX(t[0][0])-n[0][0],h=e.invertX(t[1][0])-n[1][0],r=e.invertY(t[0][1])-n[0][1],w=e.invertY(t[1][1])-n[1][1];return e.translate(h>s?(s+h)/2:Math.min(0,s)||Math.max(0,h),w>r?(r+w)/2:Math.min(0,r)||Math.max(0,w))}function z2(){var e=AQ,t=RQ,n=FQ,s=kQ,h=LQ,r=[0,1/0],w=[[-1/0,-1/0],[1/0,1/0]],A=250,F=k2,$=V0("start","zoom","end"),K,se,le,ae=500,Ze=150,Ue=0,ft=10;function Xe(je){je.property("__zoom",xB).on("wheel.zoom",Dt,{passive:!1}).on("mousedown.zoom",Tt).on("dblclick.zoom",ri).filter(h).on("touchstart.zoom",er).on("touchmove.zoom",ln).on("touchend.zoom touchcancel.zoom",Mt).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}Xe.transform=function(je,At,Ke,mt){var It=je.selection?je.selection():je;It.property("__zoom",xB),je!==It?xt(je,At,Ke,mt):It.interrupt().each(function(){yt(this,arguments).event(mt).start().zoom(null,typeof At=="function"?At.apply(this,arguments):At).end()})},Xe.scaleBy=function(je,At,Ke,mt){Xe.scaleTo(je,function(){var It=this.__zoom.k,en=typeof At=="function"?At.apply(this,arguments):At;return It*en},Ke,mt)},Xe.scaleTo=function(je,At,Ke,mt){Xe.transform(je,function(){var It=t.apply(this,arguments),en=this.__zoom,dn=Ke==null?Bt(It):typeof Ke=="function"?Ke.apply(this,arguments):Ke,Ft=en.invert(dn),Dn=typeof At=="function"?At.apply(this,arguments):At;return n(Ut(st(en,Dn),dn,Ft),It,w)},Ke,mt)},Xe.translateBy=function(je,At,Ke,mt){Xe.transform(je,function(){return n(this.__zoom.translate(typeof At=="function"?At.apply(this,arguments):At,typeof Ke=="function"?Ke.apply(this,arguments):Ke),t.apply(this,arguments),w)},null,mt)},Xe.translateTo=function(je,At,Ke,mt,It){Xe.transform(je,function(){var en=t.apply(this,arguments),dn=this.__zoom,Ft=mt==null?Bt(en):typeof mt=="function"?mt.apply(this,arguments):mt;return n(of.translate(Ft[0],Ft[1]).scale(dn.k).translate(typeof At=="function"?-At.apply(this,arguments):-At,typeof Ke=="function"?-Ke.apply(this,arguments):-Ke),en,w)},mt,It)};function st(je,At){return At=Math.max(r[0],Math.min(r[1],At)),At===je.k?je:new Hc(At,je.x,je.y)}function Ut(je,At,Ke){var mt=At[0]-Ke[0]*je.k,It=At[1]-Ke[1]*je.k;return mt===je.x&&It===je.y?je:new Hc(je.k,mt,It)}function Bt(je){return[(+je[0][0]+ +je[1][0])/2,(+je[0][1]+ +je[1][1])/2]}function xt(je,At,Ke,mt){je.on("start.zoom",function(){yt(this,arguments).event(mt).start()}).on("interrupt.zoom end.zoom",function(){yt(this,arguments).event(mt).end()}).tween("zoom",function(){var It=this,en=arguments,dn=yt(It,en).event(mt),Ft=t.apply(It,en),Dn=Ke==null?Bt(Ft):typeof Ke=="function"?Ke.apply(It,en):Ke,An=Math.max(Ft[1][0]-Ft[0][0],Ft[1][1]-Ft[0][1]),_n=It.__zoom,qi=typeof At=="function"?At.apply(It,en):At,mr=F(_n.invert(Dn).concat(An/_n.k),qi.invert(Dn).concat(An/qi.k));return function(gr){if(gr===1)gr=qi;else{var Ee=mr(gr),on=An/Ee[2];gr=new Hc(on,Dn[0]-Ee[0]*on,Dn[1]-Ee[1]*on)}dn.zoom(null,gr)}})}function yt(je,At,Ke){return!Ke&&je.__zooming||new rn(je,At)}function rn(je,At){this.that=je,this.args=At,this.active=0,this.sourceEvent=null,this.extent=t.apply(je,At),this.taps=0}rn.prototype={event:function(je){return je&&(this.sourceEvent=je),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(je,At){return this.mouse&&je!=="mouse"&&(this.mouse[1]=At.invert(this.mouse[0])),this.touch0&&je!=="touch"&&(this.touch0[1]=At.invert(this.touch0[0])),this.touch1&&je!=="touch"&&(this.touch1[1]=At.invert(this.touch1[0])),this.that.__zoom=At,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(je){var At=Ml(this.that).datum();$.call(je,this.that,new F2(je,{sourceEvent:this.sourceEvent,target:Xe,type:je,transform:this.that.__zoom,dispatch:$}),At)}};function Dt(je,...At){if(!e.apply(this,arguments))return;var Ke=yt(this,At).event(je),mt=this.__zoom,It=Math.max(r[0],Math.min(r[1],mt.k*Math.pow(2,s.apply(this,arguments)))),en=Fh(je);if(Ke.wheel)(Ke.mouse[0][0]!==en[0]||Ke.mouse[0][1]!==en[1])&&(Ke.mouse[1]=mt.invert(Ke.mouse[0]=en)),clearTimeout(Ke.wheel);else{if(mt.k===It)return;Ke.mouse=[en,mt.invert(en)],Ap(this),Ke.start()}Yg(je),Ke.wheel=setTimeout(dn,Ze),Ke.zoom("mouse",n(Ut(st(mt,It),Ke.mouse[0],Ke.mouse[1]),Ke.extent,w));function dn(){Ke.wheel=null,Ke.end()}}function Tt(je,...At){if(le||!e.apply(this,arguments))return;var Ke=je.currentTarget,mt=yt(this,At,!0).event(je),It=Ml(je.view).on("mousemove.zoom",Dn,!0).on("mouseup.zoom",An,!0),en=Fh(je,Ke),dn=je.clientX,Ft=je.clientY;C2(je.view),nC(je),mt.mouse=[en,this.__zoom.invert(en)],Ap(this),mt.start();function Dn(_n){if(Yg(_n),!mt.moved){var qi=_n.clientX-dn,mr=_n.clientY-Ft;mt.moved=qi*qi+mr*mr>Ue}mt.event(_n).zoom("mouse",n(Ut(mt.that.__zoom,mt.mouse[0]=Fh(_n,Ke),mt.mouse[1]),mt.extent,w))}function An(_n){It.on("mousemove.zoom mouseup.zoom",null),M2(_n.view,mt.moved),Yg(_n),mt.event(_n).end()}}function ri(je,...At){if(e.apply(this,arguments)){var Ke=this.__zoom,mt=Fh(je.changedTouches?je.changedTouches[0]:je,this),It=Ke.invert(mt),en=Ke.k*(je.shiftKey?.5:2),dn=n(Ut(st(Ke,en),mt,It),t.apply(this,At),w);Yg(je),A>0?Ml(this).transition().duration(A).call(xt,dn,mt,je):Ml(this).call(Xe.transform,dn,mt,je)}}function er(je,...At){if(e.apply(this,arguments)){var Ke=je.touches,mt=Ke.length,It=yt(this,At,je.changedTouches.length===mt).event(je),en,dn,Ft,Dn;for(nC(je),dn=0;dn<mt;++dn)Ft=Ke[dn],Dn=Fh(Ft,this),Dn=[Dn,this.__zoom.invert(Dn),Ft.identifier],It.touch0?!It.touch1&&It.touch0[2]!==Dn[2]&&(It.touch1=Dn,It.taps=0):(It.touch0=Dn,en=!0,It.taps=1+!!K);K&&(K=clearTimeout(K)),en&&(It.taps<2&&(se=Dn[0],K=setTimeout(function(){K=null},ae)),Ap(this),It.start())}}function ln(je,...At){if(this.__zooming){var Ke=yt(this,At).event(je),mt=je.changedTouches,It=mt.length,en,dn,Ft,Dn;for(Yg(je),en=0;en<It;++en)dn=mt[en],Ft=Fh(dn,this),Ke.touch0&&Ke.touch0[2]===dn.identifier?Ke.touch0[0]=Ft:Ke.touch1&&Ke.touch1[2]===dn.identifier&&(Ke.touch1[0]=Ft);if(dn=Ke.that.__zoom,Ke.touch1){var An=Ke.touch0[0],_n=Ke.touch0[1],qi=Ke.touch1[0],mr=Ke.touch1[1],gr=(gr=qi[0]-An[0])*gr+(gr=qi[1]-An[1])*gr,Ee=(Ee=mr[0]-_n[0])*Ee+(Ee=mr[1]-_n[1])*Ee;dn=st(dn,Math.sqrt(gr/Ee)),Ft=[(An[0]+qi[0])/2,(An[1]+qi[1])/2],Dn=[(_n[0]+mr[0])/2,(_n[1]+mr[1])/2]}else if(Ke.touch0)Ft=Ke.touch0[0],Dn=Ke.touch0[1];else return;Ke.zoom("touch",n(Ut(dn,Ft,Dn),Ke.extent,w))}}function Mt(je,...At){if(this.__zooming){var Ke=yt(this,At).event(je),mt=je.changedTouches,It=mt.length,en,dn;for(nC(je),le&&clearTimeout(le),le=setTimeout(function(){le=null},ae),en=0;en<It;++en)dn=mt[en],Ke.touch0&&Ke.touch0[2]===dn.identifier?delete Ke.touch0:Ke.touch1&&Ke.touch1[2]===dn.identifier&&delete Ke.touch1;if(Ke.touch1&&!Ke.touch0&&(Ke.touch0=Ke.touch1,delete Ke.touch1),Ke.touch0)Ke.touch0[1]=this.__zoom.invert(Ke.touch0[0]);else if(Ke.end(),Ke.taps===2&&(dn=Fh(dn,this),Math.hypot(se[0]-dn[0],se[1]-dn[1])<ft)){var Ft=Ml(this).on("dblclick.zoom");Ft&&Ft.apply(this,arguments)}}}return Xe.wheelDelta=function(je){return arguments.length?(s=typeof je=="function"?je:rv(+je),Xe):s},Xe.filter=function(je){return arguments.length?(e=typeof je=="function"?je:rv(!!je),Xe):e},Xe.touchable=function(je){return arguments.length?(h=typeof je=="function"?je:rv(!!je),Xe):h},Xe.extent=function(je){return arguments.length?(t=typeof je=="function"?je:rv([[+je[0][0],+je[0][1]],[+je[1][0],+je[1][1]]]),Xe):t},Xe.scaleExtent=function(je){return arguments.length?(r[0]=+je[0],r[1]=+je[1],Xe):[r[0],r[1]]},Xe.translateExtent=function(je){return arguments.length?(w[0][0]=+je[0][0],w[1][0]=+je[1][0],w[0][1]=+je[0][1],w[1][1]=+je[1][1],Xe):[[w[0][0],w[0][1]],[w[1][0],w[1][1]]]},Xe.constrain=function(je){return arguments.length?(n=je,Xe):n},Xe.duration=function(je){return arguments.length?(A=+je,Xe):A},Xe.interpolate=function(je){return arguments.length?(F=je,Xe):F},Xe.on=function(){var je=$.on.apply($,arguments);return je===$?Xe:je},Xe.clickDistance=function(je){return arguments.length?(Ue=(je=+je)*je,Xe):Math.sqrt(Ue)},Xe.tapDistance=function(je){return arguments.length?(ft=+je,Xe):ft},Xe}function Rp(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function B2(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function kp(e){let t,n,s;e.length!==2?(t=Rp,n=(A,F)=>Rp(e(A),F),s=(A,F)=>e(A)-F):(t=e===Rp||e===B2?e:NQ,n=e,s=e);function h(A,F,$=0,K=A.length){if($<K){if(t(F,F)!==0)return K;do{let se=$+K>>>1;n(A[se],F)<0?$=se+1:K=se}while($<K)}return $}function r(A,F,$=0,K=A.length){if($<K){if(t(F,F)!==0)return K;do{let se=$+K>>>1;n(A[se],F)<=0?$=se+1:K=se}while($<K)}return $}function w(A,F,$=0,K=A.length){let se=h(A,F,$,K-1);return se>$&&s(A[se-1],F)>-s(A[se],F)?se-1:se}return{left:h,center:w,right:r}}function NQ(){return 0}function V2(e){return e===null?NaN:+e}var bB=kp(Rp),wB=bB.right,zQ=bB.left,BQ=kp(V2).center,j2=wB;var VQ=Math.sqrt(50),jQ=Math.sqrt(10),UQ=Math.sqrt(2);function iC(e,t,n){var s=Math.abs(t-e)/Math.max(0,n),h=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),r=s/h;return r>=VQ?h*=10:r>=jQ?h*=5:r>=UQ&&(h*=2),t<e?-h:h}function CB(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function U2(e){return function(){return e}}function H2(e){return+e}var MB=[0,1];function Xg(e){return e}function $2(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:U2(isNaN(t)?NaN:.5)}function HQ(e,t){var n;return e>t&&(n=e,e=t,t=n),function(s){return Math.max(e,Math.min(t,s))}}function $Q(e,t,n){var s=e[0],h=e[1],r=t[0],w=t[1];return h<s?(s=$2(h,s),r=n(w,r)):(s=$2(s,h),r=n(r,w)),function(A){return r(s(A))}}function GQ(e,t,n){var s=Math.min(e.length,t.length)-1,h=new Array(s),r=new Array(s),w=-1;for(e[s]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++w<s;)h[w]=$2(e[w],e[w+1]),r[w]=n(t[w],t[w+1]);return function(A){var F=j2(e,A,1,s)-1;return r[F](h[F](A))}}function TB(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function qQ(){var e=MB,t=MB,n=Dp,s,h,r,w=Xg,A,F,$;function K(){var le=Math.min(e.length,t.length);return w!==Xg&&(w=HQ(e[0],e[le-1])),A=le>2?GQ:$Q,F=$=null,se}function se(le){return le==null||isNaN(le=+le)?r:(F||(F=A(e.map(s),t,n)))(s(w(le)))}return se.invert=function(le){return w(h(($||($=A(t,e.map(s),Rs)))(le)))},se.domain=function(le){return arguments.length?(e=Array.from(le,H2),K()):e.slice()},se.range=function(le){return arguments.length?(t=Array.from(le),K()):t.slice()},se.rangeRound=function(le){return t=Array.from(le),n=D2,K()},se.clamp=function(le){return arguments.length?(w=le?!0:Xg,K()):w!==Xg},se.interpolate=function(le){return arguments.length?(n=le,K()):n},se.unknown=function(le){return arguments.length?(r=le,se):r},function(le,ae){return s=le,h=ae,K()}}function G2(){return qQ()(Xg,Xg)}function q2(e,t){e=e.slice();var n=0,s=e.length-1,h=e[n],r=e[s],w;return r<h&&(w=n,n=s,s=w,w=h,h=r,r=w),e[n]=t.floor(h),e[s]=t.ceil(r),e}var Z2=new Date,W2=new Date;function br(e,t,n,s){function h(r){return e(r=arguments.length===0?new Date:new Date(+r)),r}return h.floor=function(r){return e(r=new Date(+r)),r},h.ceil=function(r){return e(r=new Date(r-1)),t(r,1),e(r),r},h.round=function(r){var w=h(r),A=h.ceil(r);return r-w<A-r?w:A},h.offset=function(r,w){return t(r=new Date(+r),w==null?1:Math.floor(w)),r},h.range=function(r,w,A){var F=[],$;if(r=h.ceil(r),A=A==null?1:Math.floor(A),!(r<w)||!(A>0))return F;do F.push($=new Date(+r)),t(r,A),e(r);while($<r&&r<w);return F},h.filter=function(r){return br(function(w){if(w>=w)for(;e(w),!r(w);)w.setTime(w-1)},function(w,A){if(w>=w)if(A<0)for(;++A<=0;)for(;t(w,-1),!r(w););else for(;--A>=0;)for(;t(w,1),!r(w););})},n&&(h.count=function(r,w){return Z2.setTime(+r),W2.setTime(+w),e(Z2),e(W2),Math.floor(n(Z2,W2))},h.every=function(r){return r=Math.floor(r),!isFinite(r)||!(r>0)?null:r>1?h.filter(s?function(w){return s(w)%r===0}:function(w){return h.count(0,w)%r===0}):h}),h}var rC=br(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});rC.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?br(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):rC};var EB=rC,ixe=rC.range;var SB=br(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*1e3)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),zh=SB,IB=SB.range;var PB=br(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3)},function(e,t){e.setTime(+e+t*6e4)},function(e,t){return(t-e)/6e4},function(e){return e.getMinutes()}),ov=PB,ZQ=PB.range;var DB=br(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3-e.getMinutes()*6e4)},function(e,t){e.setTime(+e+t*36e5)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),sv=DB,WQ=DB.range;var OB=br(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/864e5,e=>e.getDate()-1),sf=OB,YQ=OB.range;function Np(e){return br(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/6048e5})}var Bh=Np(0),Kg=Np(1),RB=Np(2),kB=Np(3),af=Np(4),LB=Np(5),FB=Np(6),NB=Bh.range,XQ=Kg.range,KQ=RB.range,JQ=kB.range,QQ=af.range,eee=LB.range,tee=FB.range;var zB=br(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),av=zB,nee=zB.range;var X2=br(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});X2.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:br(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};var $c=X2,iee=X2.range;var BB=br(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*6e4)},function(e,t){return(t-e)/6e4},function(e){return e.getUTCMinutes()}),VB=BB,xxe=BB.range;var jB=br(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*36e5)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),UB=jB,Cxe=jB.range;var HB=br(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),Jg=HB,ree=HB.range;function zp(e){return br(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/6048e5})}var Bp=zp(0),Qg=zp(1),$B=zp(2),GB=zp(3),lf=zp(4),qB=zp(5),ZB=zp(6),WB=Bp.range,oee=Qg.range,see=$B.range,aee=GB.range,lee=lf.range,cee=qB.range,uee=ZB.range;var YB=br(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),XB=YB,Dxe=YB.range;var K2=br(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});K2.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:br(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};var Vh=K2,hee=K2.range;function JB(e,t,n,s,h,r){let w=[[zh,1,1e3],[zh,5,5*1e3],[zh,15,15*1e3],[zh,30,30*1e3],[r,1,6e4],[r,5,5*6e4],[r,15,15*6e4],[r,30,30*6e4],[h,1,36e5],[h,3,3*36e5],[h,6,6*36e5],[h,12,12*36e5],[s,1,864e5],[s,2,2*864e5],[n,1,6048e5],[t,1,2592e6],[t,3,3*2592e6],[e,1,31536e6]];function A($,K,se){let le=K<$;le&&([$,K]=[K,$]);let ae=se&&typeof se.range=="function"?se:F($,K,se),Ze=ae?ae.range($,+K+1):[];return le?Ze.reverse():Ze}function F($,K,se){let le=Math.abs(K-$)/se,ae=kp(([,,ft])=>ft).right(w,le);if(ae===w.length)return e.every(iC($/31536e6,K/31536e6,se));if(ae===0)return EB.every(Math.max(iC($,K,se),1));let[Ze,Ue]=w[le/w[ae-1][2]<w[ae][2]/le?ae-1:ae];return Ze.every(Ue)}return[A,F]}var[fee,pee]=JB(Vh,XB,Bp,Jg,UB,VB),[J2,Q2]=JB($c,av,Bh,sf,sv,ov);function eP(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function tP(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function lv(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function nP(e){var t=e.dateTime,n=e.date,s=e.time,h=e.periods,r=e.days,w=e.shortDays,A=e.months,F=e.shortMonths,$=cv(h),K=uv(h),se=cv(r),le=uv(r),ae=cv(w),Ze=uv(w),Ue=cv(A),ft=uv(A),Xe=cv(F),st=uv(F),Ut={a:mt,A:It,b:en,B:dn,c:null,d:r5,e:r5,f:Nee,g:Zee,G:Yee,H:kee,I:Lee,j:Fee,L:c5,m:zee,M:Bee,p:Ft,q:Dn,Q:a5,s:l5,S:Vee,u:jee,U:Uee,V:Hee,w:$ee,W:Gee,x:null,X:null,y:qee,Y:Wee,Z:Xee,"%":s5},Bt={a:An,A:_n,b:qi,B:mr,c:null,d:o5,e:o5,f:ete,g:ute,G:dte,H:Kee,I:Jee,j:Qee,L:h5,m:tte,M:nte,p:gr,q:Ee,Q:a5,s:l5,S:ite,u:rte,U:ote,V:ste,w:ate,W:lte,x:null,X:null,y:cte,Y:hte,Z:fte,"%":s5},xt={a:ri,A:er,b:ln,B:Mt,c:je,d:n5,e:n5,f:Dee,g:t5,G:e5,H:i5,I:i5,j:Eee,L:Pee,m:Tee,M:See,p:Tt,q:Mee,Q:Aee,s:Ree,S:Iee,u:vee,U:xee,V:bee,w:yee,W:wee,x:At,X:Ke,y:t5,Y:e5,Z:Cee,"%":Oee};Ut.x=yt(n,Ut),Ut.X=yt(s,Ut),Ut.c=yt(t,Ut),Bt.x=yt(n,Bt),Bt.X=yt(s,Bt),Bt.c=yt(t,Bt);function yt(on,Zn){return function(gi){var We=[],Nr=-1,hi=0,zr=on.length,Cn,Er,Xo;for(gi instanceof Date||(gi=new Date(+gi));++Nr<zr;)on.charCodeAt(Nr)===37&&(We.push(on.slice(hi,Nr)),(Er=QB[Cn=on.charAt(++Nr)])!=null?Cn=on.charAt(++Nr):Er=Cn==="e"?" ":"0",(Xo=Zn[Cn])&&(Cn=Xo(gi,Er)),We.push(Cn),hi=Nr+1);return We.push(on.slice(hi,Nr)),We.join("")}}function rn(on,Zn){return function(gi){var We=lv(1900,void 0,1),Nr=Dt(We,on,gi+="",0),hi,zr;if(Nr!=gi.length)return null;if("Q"in We)return new Date(We.Q);if("s"in We)return new Date(We.s*1e3+("L"in We?We.L:0));if(Zn&&!("Z"in We)&&(We.Z=0),"p"in We&&(We.H=We.H%12+We.p*12),We.m===void 0&&(We.m="q"in We?We.q:0),"V"in We){if(We.V<1||We.V>53)return null;"w"in We||(We.w=1),"Z"in We?(hi=tP(lv(We.y,0,1)),zr=hi.getUTCDay(),hi=zr>4||zr===0?Qg.ceil(hi):Qg(hi),hi=Jg.offset(hi,(We.V-1)*7),We.y=hi.getUTCFullYear(),We.m=hi.getUTCMonth(),We.d=hi.getUTCDate()+(We.w+6)%7):(hi=eP(lv(We.y,0,1)),zr=hi.getDay(),hi=zr>4||zr===0?Kg.ceil(hi):Kg(hi),hi=sf.offset(hi,(We.V-1)*7),We.y=hi.getFullYear(),We.m=hi.getMonth(),We.d=hi.getDate()+(We.w+6)%7)}else("W"in We||"U"in We)&&("w"in We||(We.w="u"in We?We.u%7:"W"in We?1:0),zr="Z"in We?tP(lv(We.y,0,1)).getUTCDay():eP(lv(We.y,0,1)).getDay(),We.m=0,We.d="W"in We?(We.w+6)%7+We.W*7-(zr+5)%7:We.w+We.U*7-(zr+6)%7);return"Z"in We?(We.H+=We.Z/100|0,We.M+=We.Z%100,tP(We)):eP(We)}}function Dt(on,Zn,gi,We){for(var Nr=0,hi=Zn.length,zr=gi.length,Cn,Er;Nr<hi;){if(We>=zr)return-1;if(Cn=Zn.charCodeAt(Nr++),Cn===37){if(Cn=Zn.charAt(Nr++),Er=xt[Cn in QB?Zn.charAt(Nr++):Cn],!Er||(We=Er(on,gi,We))<0)return-1}else if(Cn!=gi.charCodeAt(We++))return-1}return We}function Tt(on,Zn,gi){var We=$.exec(Zn.slice(gi));return We?(on.p=K.get(We[0].toLowerCase()),gi+We[0].length):-1}function ri(on,Zn,gi){var We=ae.exec(Zn.slice(gi));return We?(on.w=Ze.get(We[0].toLowerCase()),gi+We[0].length):-1}function er(on,Zn,gi){var We=se.exec(Zn.slice(gi));return We?(on.w=le.get(We[0].toLowerCase()),gi+We[0].length):-1}function ln(on,Zn,gi){var We=Xe.exec(Zn.slice(gi));return We?(on.m=st.get(We[0].toLowerCase()),gi+We[0].length):-1}function Mt(on,Zn,gi){var We=Ue.exec(Zn.slice(gi));return We?(on.m=ft.get(We[0].toLowerCase()),gi+We[0].length):-1}function je(on,Zn,gi){return Dt(on,t,Zn,gi)}function At(on,Zn,gi){return Dt(on,n,Zn,gi)}function Ke(on,Zn,gi){return Dt(on,s,Zn,gi)}function mt(on){return w[on.getDay()]}function It(on){return r[on.getDay()]}function en(on){return F[on.getMonth()]}function dn(on){return A[on.getMonth()]}function Ft(on){return h[+(on.getHours()>=12)]}function Dn(on){return 1+~~(on.getMonth()/3)}function An(on){return w[on.getUTCDay()]}function _n(on){return r[on.getUTCDay()]}function qi(on){return F[on.getUTCMonth()]}function mr(on){return A[on.getUTCMonth()]}function gr(on){return h[+(on.getUTCHours()>=12)]}function Ee(on){return 1+~~(on.getUTCMonth()/3)}return{format:function(on){var Zn=yt(on+="",Ut);return Zn.toString=function(){return on},Zn},parse:function(on){var Zn=rn(on+="",!1);return Zn.toString=function(){return on},Zn},utcFormat:function(on){var Zn=yt(on+="",Bt);return Zn.toString=function(){return on},Zn},utcParse:function(on){var Zn=rn(on+="",!0);return Zn.toString=function(){return on},Zn}}}var QB={"-":"",_:" ",0:"0"},Cs=/^\s*\d+/,mee=/^%/,gee=/[\\^$*+?|[\]().{}]/g;function Tr(e,t,n){var s=e<0?"-":"",h=(s?-e:e)+"",r=h.length;return s+(r<n?new Array(n-r+1).join(t)+h:h)}function _ee(e){return e.replace(gee,"\\$&")}function cv(e){return new RegExp("^(?:"+e.map(_ee).join("|")+")","i")}function uv(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function yee(e,t,n){var s=Cs.exec(t.slice(n,n+1));return s?(e.w=+s[0],n+s[0].length):-1}function vee(e,t,n){var s=Cs.exec(t.slice(n,n+1));return s?(e.u=+s[0],n+s[0].length):-1}function xee(e,t,n){var s=Cs.exec(t.slice(n,n+2));return s?(e.U=+s[0],n+s[0].length):-1}function bee(e,t,n){var s=Cs.exec(t.slice(n,n+2));return s?(e.V=+s[0],n+s[0].length):-1}function wee(e,t,n){var s=Cs.exec(t.slice(n,n+2));return s?(e.W=+s[0],n+s[0].length):-1}function e5(e,t,n){var s=Cs.exec(t.slice(n,n+4));return s?(e.y=+s[0],n+s[0].length):-1}function t5(e,t,n){var s=Cs.exec(t.slice(n,n+2));return s?(e.y=+s[0]+(+s[0]>68?1900:2e3),n+s[0].length):-1}function Cee(e,t,n){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return s?(e.Z=s[1]?0:-(s[2]+(s[3]||"00")),n+s[0].length):-1}function Mee(e,t,n){var s=Cs.exec(t.slice(n,n+1));return s?(e.q=s[0]*3-3,n+s[0].length):-1}function Tee(e,t,n){var s=Cs.exec(t.slice(n,n+2));return s?(e.m=s[0]-1,n+s[0].length):-1}function n5(e,t,n){var s=Cs.exec(t.slice(n,n+2));return s?(e.d=+s[0],n+s[0].length):-1}function Eee(e,t,n){var s=Cs.exec(t.slice(n,n+3));return s?(e.m=0,e.d=+s[0],n+s[0].length):-1}function i5(e,t,n){var s=Cs.exec(t.slice(n,n+2));return s?(e.H=+s[0],n+s[0].length):-1}function See(e,t,n){var s=Cs.exec(t.slice(n,n+2));return s?(e.M=+s[0],n+s[0].length):-1}function Iee(e,t,n){var s=Cs.exec(t.slice(n,n+2));return s?(e.S=+s[0],n+s[0].length):-1}function Pee(e,t,n){var s=Cs.exec(t.slice(n,n+3));return s?(e.L=+s[0],n+s[0].length):-1}function Dee(e,t,n){var s=Cs.exec(t.slice(n,n+6));return s?(e.L=Math.floor(s[0]/1e3),n+s[0].length):-1}function Oee(e,t,n){var s=mee.exec(t.slice(n,n+1));return s?n+s[0].length:-1}function Aee(e,t,n){var s=Cs.exec(t.slice(n));return s?(e.Q=+s[0],n+s[0].length):-1}function Ree(e,t,n){var s=Cs.exec(t.slice(n));return s?(e.s=+s[0],n+s[0].length):-1}function r5(e,t){return Tr(e.getDate(),t,2)}function kee(e,t){return Tr(e.getHours(),t,2)}function Lee(e,t){return Tr(e.getHours()%12||12,t,2)}function Fee(e,t){return Tr(1+sf.count($c(e),e),t,3)}function c5(e,t){return Tr(e.getMilliseconds(),t,3)}function Nee(e,t){return c5(e,t)+"000"}function zee(e,t){return Tr(e.getMonth()+1,t,2)}function Bee(e,t){return Tr(e.getMinutes(),t,2)}function Vee(e,t){return Tr(e.getSeconds(),t,2)}function jee(e){var t=e.getDay();return t===0?7:t}function Uee(e,t){return Tr(Bh.count($c(e)-1,e),t,2)}function u5(e){var t=e.getDay();return t>=4||t===0?af(e):af.ceil(e)}function Hee(e,t){return e=u5(e),Tr(af.count($c(e),e)+($c(e).getDay()===4),t,2)}function $ee(e){return e.getDay()}function Gee(e,t){return Tr(Kg.count($c(e)-1,e),t,2)}function qee(e,t){return Tr(e.getFullYear()%100,t,2)}function Zee(e,t){return e=u5(e),Tr(e.getFullYear()%100,t,2)}function Wee(e,t){return Tr(e.getFullYear()%1e4,t,4)}function Yee(e,t){var n=e.getDay();return e=n>=4||n===0?af(e):af.ceil(e),Tr(e.getFullYear()%1e4,t,4)}function Xee(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Tr(t/60|0,"0",2)+Tr(t%60,"0",2)}function o5(e,t){return Tr(e.getUTCDate(),t,2)}function Kee(e,t){return Tr(e.getUTCHours(),t,2)}function Jee(e,t){return Tr(e.getUTCHours()%12||12,t,2)}function Qee(e,t){return Tr(1+Jg.count(Vh(e),e),t,3)}function h5(e,t){return Tr(e.getUTCMilliseconds(),t,3)}function ete(e,t){return h5(e,t)+"000"}function tte(e,t){return Tr(e.getUTCMonth()+1,t,2)}function nte(e,t){return Tr(e.getUTCMinutes(),t,2)}function ite(e,t){return Tr(e.getUTCSeconds(),t,2)}function rte(e){var t=e.getUTCDay();return t===0?7:t}function ote(e,t){return Tr(Bp.count(Vh(e)-1,e),t,2)}function d5(e){var t=e.getUTCDay();return t>=4||t===0?lf(e):lf.ceil(e)}function ste(e,t){return e=d5(e),Tr(lf.count(Vh(e),e)+(Vh(e).getUTCDay()===4),t,2)}function ate(e){return e.getUTCDay()}function lte(e,t){return Tr(Qg.count(Vh(e)-1,e),t,2)}function cte(e,t){return Tr(e.getUTCFullYear()%100,t,2)}function ute(e,t){return e=d5(e),Tr(e.getUTCFullYear()%100,t,2)}function hte(e,t){return Tr(e.getUTCFullYear()%1e4,t,4)}function dte(e,t){var n=e.getUTCDay();return e=n>=4||n===0?lf(e):lf.ceil(e),Tr(e.getUTCFullYear()%1e4,t,4)}function fte(){return"+0000"}function s5(){return"%"}function a5(e){return+e}function l5(e){return Math.floor(+e/1e3)}var e_,t_,f5,p5,m5;iP({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function iP(e){return e_=nP(e),t_=e_.format,f5=e_.parse,p5=e_.utcFormat,m5=e_.utcParse,e_}function pte(e){return new Date(e)}function mte(e){return e instanceof Date?+e:+new Date(+e)}function g5(e,t,n,s,h,r,w,A,F,$){var K=G2(),se=K.invert,le=K.domain,ae=$(".%L"),Ze=$(":%S"),Ue=$("%I:%M"),ft=$("%I %p"),Xe=$("%a %d"),st=$("%b %d"),Ut=$("%B"),Bt=$("%Y");function xt(yt){return(F(yt)<yt?ae:A(yt)<yt?Ze:w(yt)<yt?Ue:r(yt)<yt?ft:s(yt)<yt?h(yt)<yt?Xe:st:n(yt)<yt?Ut:Bt)(yt)}return K.invert=function(yt){return new Date(se(yt))},K.domain=function(yt){return arguments.length?le(Array.from(yt,mte)):le().map(pte)},K.ticks=function(yt){var rn=le();return e(rn[0],rn[rn.length-1],yt??10)},K.tickFormat=function(yt,rn){return rn==null?xt:$(rn)},K.nice=function(yt){var rn=le();return(!yt||typeof yt.range!="function")&&(yt=t(rn[0],rn[rn.length-1],yt??10)),yt?le(q2(rn,yt)):K},K.copy=function(){return TB(K,g5(e,t,n,s,h,r,w,A,F,$))},K}function oC(){return CB.apply(g5(J2,Q2,$c,av,Bh,sf,sv,ov,zh,t_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function _5(e){return e}var aC=1,rP=2,y5=3,sC=4,v5=1e-6;function gte(e){return"translate("+e+",0)"}function _te(e){return"translate(0,"+e+")"}function yte(e){return t=>+e(t)}function vte(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function xte(){return!this.__axis}function bte(e,t){var n=[],s=null,h=null,r=6,w=6,A=3,F=typeof window<"u"&&window.devicePixelRatio>1?0:.5,$=e===aC||e===sC?-1:1,K=e===sC||e===rP?"x":"y",se=e===aC||e===y5?gte:_te;function le(ae){var Ze=s??(t.ticks?t.ticks.apply(t,n):t.domain()),Ue=h??(t.tickFormat?t.tickFormat.apply(t,n):_5),ft=Math.max(r,0)+A,Xe=t.range(),st=+Xe[0]+F,Ut=+Xe[Xe.length-1]+F,Bt=(t.bandwidth?vte:yte)(t.copy(),F),xt=ae.selection?ae.selection():ae,yt=xt.selectAll(".domain").data([null]),rn=xt.selectAll(".tick").data(Ze,t).order(),Dt=rn.exit(),Tt=rn.enter().append("g").attr("class","tick"),ri=rn.select("line"),er=rn.select("text");yt=yt.merge(yt.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),rn=rn.merge(Tt),ri=ri.merge(Tt.append("line").attr("stroke","currentColor").attr(K+"2",$*r)),er=er.merge(Tt.append("text").attr("fill","currentColor").attr(K,$*ft).attr("dy",e===aC?"0em":e===y5?"0.71em":"0.32em")),ae!==xt&&(yt=yt.transition(ae),rn=rn.transition(ae),ri=ri.transition(ae),er=er.transition(ae),Dt=Dt.transition(ae).attr("opacity",v5).attr("transform",function(ln){return isFinite(ln=Bt(ln))?se(ln+F):this.getAttribute("transform")}),Tt.attr("opacity",v5).attr("transform",function(ln){var Mt=this.parentNode.__axis;return se((Mt&&isFinite(Mt=Mt(ln))?Mt:Bt(ln))+F)})),Dt.remove(),yt.attr("d",e===sC||e===rP?w?"M"+$*w+","+st+"H"+F+"V"+Ut+"H"+$*w:"M"+F+","+st+"V"+Ut:w?"M"+st+","+$*w+"V"+F+"H"+Ut+"V"+$*w:"M"+st+","+F+"H"+Ut),rn.attr("opacity",1).attr("transform",function(ln){return se(Bt(ln)+F)}),ri.attr(K+"2",$*r),er.attr(K,$*ft).text(Ue),xt.filter(xte).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===rP?"start":e===sC?"end":"middle"),xt.each(function(){this.__axis=Bt})}return le.scale=function(ae){return arguments.length?(t=ae,le):t},le.ticks=function(){return n=Array.from(arguments),le},le.tickArguments=function(ae){return arguments.length?(n=ae==null?[]:Array.from(ae),le):n.slice()},le.tickValues=function(ae){return arguments.length?(s=ae==null?null:Array.from(ae),le):s&&s.slice()},le.tickFormat=function(ae){return arguments.length?(h=ae,le):h},le.tickSize=function(ae){return arguments.length?(r=w=+ae,le):r},le.tickSizeInner=function(ae){return arguments.length?(r=+ae,le):r},le.tickSizeOuter=function(ae){return arguments.length?(w=+ae,le):w},le.tickPadding=function(ae){return arguments.length?(A=+ae,le):A},le.offset=function(ae){return arguments.length?(F=+ae,le):F},le}function oP(e){return bte(aC,e)}var n_=(()=>{class e{constructor(n){this.sanitizer=n,this.marker="Media",this.breathing=!1,this.outline=!0}ngOnInit(){}ngOnChanges(){this.marker!=="Media"&&(this.type=this.marker),this.update()}static getCodeForType(n,s,h=!1,r=!0){let w={wikipedia:'d="M12.081 12.932C11.301 14.543 10.232 16.724 9.702 17.708C9.189 18.604 8.762 18.484 8.424 17.732C7.252 14.962 4.844 10.107 3.712 7.38499C3.503 6.88299 3.345 6.56199 3.196 6.43499C3.045 6.30999 2.734 6.23499 2.26 6.20799C2.086 6.18899 2 6.14699 2 6.07699V5.69799L2.043 5.65999C2.814 5.65599 6.546 5.65999 6.546 5.65999L6.588 5.69799V6.05999C6.588 6.15999 6.525 6.20699 6.4 6.20699L5.93 6.23099C5.527 6.25699 5.325 6.36799 5.325 6.59599C5.325 6.70799 5.369 6.87099 5.464 7.09699C6.366 9.30299 9.481 15.869 9.481 15.869L9.595 15.908L11.605 11.896L11.203 11.006L9.82 8.28499C9.82 8.28499 9.555 7.73999 9.463 7.55799C8.856 6.35499 8.87 6.29299 8.257 6.21099C8.084 6.19099 7.996 6.16899 7.996 6.08599V5.69599L8.046 5.65899H11.624L11.719 5.68899V6.06499C11.719 6.15299 11.656 6.18999 11.53 6.18999L11.273 6.22899C10.613 6.27999 10.722 6.54699 11.16 7.41499L12.479 10.127L13.944 7.20499C14.188 6.67199 14.138 6.53699 14.037 6.41599C13.979 6.34599 13.782 6.23099 13.36 6.21599L13.192 6.19799C13.1479 6.19805 13.1052 6.18286 13.071 6.15499C13.0534 6.14334 13.039 6.12741 13.0292 6.1087C13.0194 6.08999 13.0145 6.0691 13.015 6.04799V5.69099L13.066 5.65399C14.106 5.64699 16.437 5.65399 16.437 5.65399L16.487 5.69099V6.05499C16.487 6.15599 16.437 6.20299 16.326 6.20299C15.787 6.22699 15.674 6.28199 15.472 6.56899C15.372 6.72299 15.159 7.05899 14.934 7.43399L13.015 10.997L12.961 11.109L15.289 15.872L15.431 15.913L19.096 7.20899C19.225 6.85699 19.203 6.60699 19.043 6.46299C18.878 6.31899 18.754 6.23499 18.327 6.21699L17.977 6.20299C17.9318 6.20459 17.8873 6.19162 17.85 6.16599C17.8328 6.15527 17.8184 6.14061 17.8079 6.12322C17.7975 6.10583 17.7914 6.08622 17.79 6.06599V5.70499L17.839 5.66699H21.976L22.01 5.70499V6.06899C22.01 6.16899 21.948 6.21899 21.836 6.21899C21.295 6.24299 20.896 6.36899 20.633 6.56999C20.37 6.78299 20.168 7.08399 20.019 7.45999C20.019 7.45999 16.648 15.18 15.495 17.749C15.057 18.589 14.617 18.514 14.242 17.723C13.765 16.746 12.764 14.567 12.036 12.962L12.081 12.932Z"',audio:'fill-rule="evenodd" clip-rule="evenodd" d="M20 10.2928V11.9998C21.103 11.9998 22 12.8968 22 13.9998V17.9998C22 19.1028 21.103 19.9998 20 19.9998H18V10.2928C18 6.92082 15.392 4.09882 12.184 4.00282C11.3804 3.97674 10.5798 4.11306 9.83014 4.40362C9.08047 4.69417 8.39712 5.133 7.821 5.69382C7.24245 6.25141 6.78282 6.92041 6.46985 7.66047C6.15688 8.40053 5.99705 9.19631 6 9.99982V19.9998H4C2.897 19.9998 2 19.1028 2 17.9998V13.9998C2 12.8968 2.897 11.9998 4 11.9998V9.99982C3.99623 8.92846 4.2095 7.86743 4.62697 6.88074C5.04444 5.89405 5.65744 5.00214 6.429 4.25882C7.994 2.73882 10.041 1.95182 12.245 2.00282C16.521 2.13182 20 5.85082 20 10.2928ZM9 12H7V20H9V12ZM17 12H15V20H17V12Z"',image:'d="M5 21H19C19.5304 21 20.0391 20.7893 20.4142 20.4142C20.7893 20.0391 21 19.5304 21 19V5C21 4.46957 20.7893 3.96086 20.4142 3.58579C20.0391 3.21071 19.5304 3 19 3H5C4.46957 3 3.96086 3.21071 3.58579 3.58579C3.21071 3.96086 3 4.46957 3 5V19C3 19.5304 3.21071 20.0391 3.58579 20.4142C3.96086 20.7893 4.46957 21 5 21ZM8 14L10.363 16.363L14 11L19 18H5L8 14Z"',instagram:'fill-rule="evenodd" clip-rule="evenodd" d="M20.5271 6.08896C20.7942 6.79773 20.936 7.54758 20.9461 8.30496C21.0018 9.25754 21.0021 9.56909 21.0041 11.9803L21.0041 12.014C21.0041 14.457 20.9911 14.762 20.9481 15.724C20.9331 16.473 20.7921 17.211 20.5291 17.911C20.2972 18.5086 19.9433 19.0515 19.4899 19.5048C19.0366 19.9581 18.4938 20.312 17.8961 20.544C17.1965 20.8066 16.4572 20.9482 15.7101 20.963C14.7551 21.019 14.4421 21.019 12.0001 21.019C9.55809 21.019 9.25309 21.006 8.29009 20.963C7.54147 20.9383 6.80253 20.7862 6.10509 20.513C5.50716 20.2815 4.96407 19.9279 4.51053 19.4747C4.05699 19.0215 3.70297 18.4787 3.47109 17.881C3.20809 17.18 3.06709 16.442 3.05209 15.694C2.99609 14.738 2.99609 14.426 2.99609 11.984C2.99609 9.54196 3.00909 9.23696 3.05209 8.27396C3.06622 7.52707 3.20792 6.78809 3.47109 6.08896C3.70258 5.49102 4.05634 4.94798 4.50973 4.49459C4.96311 4.0412 5.50615 3.68745 6.10409 3.45596C6.80344 3.19343 7.54225 3.05141 8.28909 3.03596C9.24409 2.98096 9.55709 2.98096 11.9991 2.98096C14.4411 2.98096 14.7461 2.99296 15.7081 3.03596C16.4553 3.0513 17.1944 3.19331 17.8941 3.45596C18.4919 3.68761 19.0349 4.04142 19.4883 4.49479C19.9416 4.94816 20.2954 5.49111 20.5271 6.08896ZM7.37009 11.979C7.37009 14.533 9.43909 16.602 11.9931 16.602C13.2192 16.602 14.3951 16.1149 15.262 15.2479C16.129 14.3809 16.6161 13.2051 16.6161 11.979C16.6161 10.7529 16.129 9.57698 15.262 8.71C14.3951 7.84302 13.2192 7.35596 11.9931 7.35596C9.43909 7.35596 7.37009 9.42496 7.37009 11.979ZM15.7221 7.18496C15.7221 7.78096 16.2031 8.26296 16.8001 8.26296C17.3951 8.26296 17.8771 7.78096 17.8771 7.18496C17.8771 7.04346 17.8492 6.90334 17.7951 6.77262C17.7409 6.64189 17.6616 6.5231 17.5615 6.42305C17.4614 6.32299 17.3427 6.24363 17.2119 6.18948C17.0812 6.13533 16.9411 6.10746 16.7996 6.10746C16.6581 6.10746 16.518 6.13533 16.3873 6.18948C16.2565 6.24363 16.1377 6.32299 16.0377 6.42305C15.9376 6.5231 15.8583 6.64189 15.8041 6.77262C15.75 6.90334 15.7221 7.04346 15.7221 7.18496ZM14.9962 11.9791C14.9962 13.6376 13.6517 14.9821 11.9932 14.9821C10.3347 14.9821 8.99023 13.6376 8.99023 11.9791C8.99023 10.3206 10.3347 8.97607 11.9932 8.97607C13.6517 8.97607 14.9962 10.3206 14.9962 11.9791Z"',twitter:'d="M19.633 7.99704C19.646 8.17204 19.646 8.34604 19.646 8.52004C19.646 13.845 15.593 19.981 8.186 19.981C5.904 19.981 3.784 19.32 2 18.172C2.324 18.209 2.636 18.222 2.973 18.222C4.78599 18.2264 6.54765 17.6202 7.974 16.501C7.13342 16.4858 6.31858 16.2085 5.64324 15.7078C4.9679 15.2071 4.46578 14.5079 4.207 13.708C4.456 13.745 4.706 13.77 4.968 13.77C5.329 13.77 5.692 13.72 6.029 13.633C5.11676 13.4489 4.29647 12.9544 3.70762 12.2337C3.11876 11.5131 2.79769 10.6107 2.799 9.68004V9.63004C3.336 9.92904 3.959 10.116 4.619 10.141C4.06609 9.77363 3.61272 9.27507 3.29934 8.68983C2.98596 8.1046 2.82231 7.4509 2.823 6.78704C2.823 6.03904 3.022 5.35304 3.371 4.75504C4.38314 6.00006 5.6455 7.0186 7.07634 7.7447C8.50717 8.4708 10.0746 8.88826 11.677 8.97004C11.615 8.67004 11.577 8.35904 11.577 8.04704C11.5767 7.518 11.6807 6.9941 11.8831 6.50528C12.0854 6.01647 12.3821 5.57232 12.7562 5.19823C13.1303 4.82414 13.5744 4.52745 14.0632 4.32512C14.5521 4.12279 15.076 4.01878 15.605 4.01904C16.765 4.01904 17.812 4.50504 18.548 5.29104C19.4498 5.11666 20.3145 4.78747 21.104 4.31804C20.8034 5.24886 20.1738 6.03815 19.333 6.53804C20.1328 6.44682 20.9144 6.2365 21.652 5.91404C21.1011 6.71714 20.4185 7.42139 19.633 7.99704Z"',video:'d="M21.5914 7.20301C21.4775 6.78041 21.2549 6.39501 20.9457 6.08518C20.6366 5.77534 20.2517 5.55187 19.8294 5.43701C18.2634 5.00701 11.9984 5.00001 11.9984 5.00001C11.9984 5.00001 5.73438 4.99301 4.16738 5.40401C3.7453 5.52415 3.3612 5.75078 3.05194 6.06214C2.74269 6.3735 2.51866 6.75913 2.40138 7.18201C1.98838 8.74801 1.98438 11.996 1.98438 11.996C1.98438 11.996 1.98038 15.26 2.39038 16.81C2.62038 17.667 3.29538 18.344 4.15338 18.575C5.73538 19.005 11.9834 19.012 11.9834 19.012C11.9834 19.012 18.2484 19.019 19.8144 18.609C20.2369 18.4943 20.6221 18.2714 20.932 17.9622C21.2419 17.653 21.4658 17.2682 21.5814 16.846C21.9954 15.281 21.9984 12.034 21.9984 12.034C21.9984 12.034 22.0184 8.76901 21.5914 7.20301ZM9.99438 15.005L9.99938 9.00501L15.2064 12.01L9.99438 15.005Z"',news:'d="M21.691 16.9995C21.691 17.2647 21.5791 17.5191 21.3801 17.7066C21.181 17.8942 20.9111 17.9995 20.6296 17.9995C20.3481 17.9995 20.0781 17.8942 19.8791 17.7066C19.68 17.5191 19.5682 17.2647 19.5682 16.9995V4.99951C19.5682 4.7343 19.4564 4.47994 19.2573 4.29241C19.0583 4.10487 18.7883 3.99951 18.5068 3.99951H3.64733C3.36583 3.99951 3.09586 4.10487 2.89681 4.29241C2.69776 4.47994 2.58594 4.7343 2.58594 4.99951V17.9995C2.58594 18.5299 2.80959 19.0387 3.20769 19.4137C3.60578 19.7888 4.14572 19.9995 4.70872 19.9995H20.6296C22.3851 19.9995 23.8138 18.6535 23.8138 16.9995V6.99951H21.691V16.9995ZM13.1998 6.99951H16.384V8.99951H13.1998V6.99951ZM13.1998 10.9995H16.384V12.9995H13.1998V10.9995ZM5.77011 6.99951H11.0771V12.9995H5.77011V6.99951ZM5.77011 16.9995V14.9995H16.384V16.9995H5.77011Z"',note:'fill-rule="evenodd" clip-rule="evenodd" d="M20 3.99951H4V19.9995H12.5719C13.2549 19.2439 13.5584 18.59 13.7102 17.9286C13.8758 17.2076 13.8741 16.4504 13.8717 15.4025V15.4025L13.8717 15.4008C13.8714 15.2718 13.8711 15.1383 13.8711 15V14H14.8711C16.7548 14 18.4061 13.9799 20 12.5684V3.99951ZM20 13.8357C19.2754 14.3321 18.5399 14.6168 17.8051 14.7802C16.8164 15 15.829 15 14.8711 15C14.8711 15.1382 14.8715 15.2737 14.8719 15.4068V15.4068C14.8726 15.61 14.8732 15.8074 14.8722 16C14.8691 16.6585 14.8479 17.26 14.7481 17.8372C14.6205 18.5749 14.3643 19.273 13.8528 19.9995H14L15.6701 18.3294L18.3138 15.6857L20 13.9995V13.8357Z"',Marker:'fill-rule="evenodd" clip-rule="evenodd" d="M18 12.7052C18 16.0373 15.3137 18.7385 12 18.7385C8.68629 18.7385 6 16.0373 6 12.7052C6 9.37309 8.68629 6.67188 12 6.67188C15.3137 6.67188 18 9.37309 18 12.7052ZM17 12.7052C17 15.482 14.7614 17.733 12 17.733C9.23858 17.733 7 15.482 7 12.7052C7 9.92844 9.23858 7.67743 12 7.67743C14.7614 7.67743 17 9.92844 17 12.7052ZM12 15.7219C13.6569 15.7219 15 14.3713 15 12.7052C15 11.0391 13.6569 9.68854 12 9.68854C10.3431 9.68854 9 11.0391 9 12.7052C9 14.3713 10.3431 15.7219 12 15.7219Z"',Map:'d="M20.4102 5.89L16.4102 4.09H15.5902L12.0002 5.7L8.41024 4.09H8.36024L8.24024 4H7.64024L3.64024 5.8C3.44073 5.87645 3.27095 6.01479 3.15578 6.19474C3.0406 6.3747 2.9861 6.58681 3.00024 6.8V19C3.00052 19.1673 3.04278 19.3319 3.12314 19.4786C3.20351 19.6254 3.31941 19.7496 3.46024 19.84C3.6212 19.944 3.80863 19.9995 4.00024 20C4.14174 19.9993 4.28148 19.9687 4.41024 19.91L8.00024 18.3L11.5902 19.91H11.6402C11.7529 19.9627 11.8758 19.99 12.0002 19.99C12.1247 19.99 12.2475 19.9627 12.3602 19.91H12.4102L16.0002 18.3L19.5902 19.91C19.719 19.9687 19.8587 19.9993 20.0002 20C20.1919 19.9995 20.3793 19.944 20.5402 19.84C20.6811 19.7496 20.797 19.6254 20.8773 19.4786C20.9577 19.3319 21 19.1673 21.0002 19V6.8C20.9998 6.60764 20.944 6.41948 20.8393 6.25807C20.7347 6.09667 20.5857 5.96887 20.4102 5.89ZM9.00024 6.55L11.0002 7.44V17.44L9.00024 16.55V6.55ZM19.0002 17.45L17.0002 16.56V6.56L19.0002 7.45V17.45Z"',None:""}[n];return h?`
      <style>.a {
        transform-origin: 25% 25%;
        animation: 3s ease-out 0s 1 normal forwards running a;
        animation-iteration-count: infinite;
        opacity: 1;
      }
      @keyframes a {
        0% {transform: scaleX(1) scaleY(1);opacity: 0.8;}
        50% {opacity: 0;}
        100% {transform: scaleX(3) scaleY(3);opacity: 0;}
      }
      </style>
      
      <defs>
      <filter id="blur" x="0" y="0" width="24" height="24">
      <feGaussianBlur stdDeviation="0.4"/>
      </filter>
      </defs>
      
      <path ${w} filter="url(#blur)" stroke="white" stroke-width="$" class='a'/>
      <path ${w} fill="${s}" />
      `:r?`
          <path ${w} fill="white" stroke="white" stroke-width="4"/>
          <path ${w} fill="${s}" />
        `:`
          <path ${w} fill="white" stroke="transparent" stroke-width="4"/>
          <path ${w} fill="${s}" />
        `}update(){this.svg=this.sanitizer.bypassSecurityTrustHtml(e.getCodeForType(this.type,this.color,this.breathing,this.outline))}static{this.\u0275fac=function(s){return new(s||e)(Fn(zc))}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-media-icon"]],inputs:{marker:"marker",type:"type",color:"color",breathing:"breathing",outline:"outline"},standalone:!1,features:[Os],decls:2,vars:1,consts:[["width","48","height","48","viewBox","-12 -12 48 48","fill","none","xmlns","http://www.w3.org/2000/svg",3,"innerHtml"]],template:function(s,h){s&1&&(Vo(),ut(0,"svg",0),xn(1,`
>
`),_t()),s&2&&jt("innerHtml",h.svg,Wo)},styles:["[_nghost-%COMP%]{display:inline-block;width:24px;height:24px;overflow:visible}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{margin-top:-12px;margin-left:-12px}"]})}}return e})();var Lu=(()=>{class e{constructor(n){this.el=n}ngAfterViewInit(){let n=this.el.nativeElement;n.style.direction=e.getDirection(this.rtlDetect)}static getDirection(n){return n&&n.match(/^[\s#_*]*[\u0590-\u05FF]/)?"rtl":"ltr"}static{this.\u0275fac=function(s){return new(s||e)(Fn(Po))}}static{this.\u0275dir=Ih({type:e,selectors:[["","rtlDetect",""]],inputs:{rtlDetect:"rtlDetect"},standalone:!1})}}return e})();var wte=["timeLine"],i_=(()=>{class e{constructor(n,s){this.el=n,this.layout=s,this.id="",this.minDate=new Date(1820,0,1),this.maxDate=new Date(2120,0,1),this.showHovers=!0,this.hoverable=!0,this.limitless=!1,this.selected=new go,this.WIDTH=1e3,this.TEXT_HEIGHT=16,this.TICK_HEIGHT=56,this.TICK_HEIGHT_INNER=16,this.CIRCLE_RADIUS_CLUSTERED=12,this.CIRCLE_RADIUS=16,this.ICON_PADDING=4,this.HOVER_HEIGHT=34,this.HEIGHT=this.TEXT_HEIGHT+this.TICK_HEIGHT/2+this.CIRCLE_RADIUS+this.HOVER_HEIGHT,this.RANDOM_CENTERS={},this.tickIndicator=0,this.firstInit=!1,this.zoomK=1,this.zooming=!1,this.controlled=!1,this._changed=new ga(1),this._changeCandidates=new Ii,this._externalChanges=new Ii,this.currentHover=null,this.resizeObserver=new ResizeObserver(()=>{this._changed.next()}),ug(this._changeCandidates,vu).pipe(pi(h=>{this.state?.set(h.state),this.date?.set(h.timestamp),this.includeTime?.set(h.includeTime),this.zooming||(this.zooming=!0)}),yl(500)).subscribe(()=>{this.zooming=!1}),ug(this._externalChanges,vu).pipe(pi(h=>{this.controlled||(this.controlled=!0),this.parseState(h),this.applyState()}),yl(500)).subscribe(()=>{this.controlled=!1}),bl(()=>{let h=this.state?this.state():"";this.zooming||this._externalChanges.next(h||""),this.chronomap.timelineItems()&&this.updateAxis()})}parseState(n){let s=n.split("/");s.length>=2&&(this.zoomX=new Date(parseFloat(s[0])),this.zoomK=parseFloat(s[1])),s.length===4&&(this.firstTickValue=parseFloat(s[2]),this.tickIndicator=parseInt(s[3],10))}ngOnInit(){this.parseState(this.state&&this.state()||"")}ngAfterViewInit(){this.resizeObserver.observe(this.el.nativeElement),this._changed.pipe(DT(Mr(0))).subscribe(()=>{this.WIDTH=this.el.nativeElement.offsetWidth,this.init()})}ngOnChanges(){this._changed.next()}init(){this.timeline.nativeElement.innerHTML="",this.zoomBehaviour=z2();let n=(this.maxDate.getTime()-this.minDate.getTime())/(1e3*10*60);this.limitless?this.zoomBehaviour=this.zoomBehaviour.scaleExtent([0,n]):this.zoomBehaviour=this.zoomBehaviour.scaleExtent([1,n]).translateExtent([[0,0],[this.WIDTH,0]]),this.zoomBehaviour=this.zoomBehaviour.on("zoom",s=>this.onZoom(s)),this.svg=Ml(this.timeline.nativeElement).append("svg").attr("width","100%").attr("height","100%").call(this.zoomBehaviour).call(s=>this.hoverable?s:s.on("wheel.zoom",null)),this.svg.append("rect").attr("transform",`translate(0, ${this.HEIGHT-this.TEXT_HEIGHT})`).attr("width",this.WIDTH).attr("height",this.TEXT_HEIGHT).attr("fill","#fff"),this.hovers=Ml(this.timeline.nativeElement).append("div").attr("class","hovers"),this.g=this.svg.append("g").attr("transform",`translate(0, ${this.HEIGHT-this.TEXT_HEIGHT})`).attr("class","axis axis--x"),this.points=this.svg.append("g").attr("class","points"+(this.hoverable?" hoverable":"")),this.svg.attr("viewBox",`0 0 ${this.WIDTH} ${this.HEIGHT}`),this.x=oC().domain([this.minDate,this.maxDate]).range([0,this.WIDTH]),this.xt=this.x,this.xAxis=oP(this.x).ticks(this.layout.mobile()?12:40).tickSizeInner(this.TICK_HEIGHT).tickFormat((s,h)=>this.tickFormat(s,h)),this.updateAxis(),this.applyState()}applyState(){if(this.zoomX&&this.svg&&this.zoomK){let n=this.x(this.zoomX)*this.zoomK;this.svg.call(this.zoomBehaviour.transform,of.translate(this.WIDTH/2-n,0).scale(this.zoomK))}}zoomBy(n){this.svg.transition().duration(300).ease(iv).call(this.zoomBehaviour.scaleBy,n)}scrollTo(n,s){let h=this.x(n)*this.zoomK;this.svg.transition().duration(1e3).ease(iv).call(this.zoomBehaviour.transform,of.translate(this.WIDTH/2-h,56).scale(this.zoomK)),s.niceTimestamp=this.tickFormat(n,-1)}clusterPoints(n){let s=(A,F)=>{if(A.length){let $=A.reduce((Ue,ft)=>ft.x+Ue,0)/A.length,K=A[0].timestamp,se=A[A.length-1].timestamp,le=this.x(se)-this.x(K),ae=new Date((K.valueOf()+se.valueOf())/2),Ze=1e4;le>0&&(Ze=this.WIDTH/2/le,Ze<1&&(Ze=1)),A.forEach((Ue,ft)=>{Ue.x=$,Ue.centerTimestamp=ae,Ue.k=Ze,Ue.clustered=A.length,Ue.indexes=A.map(Xe=>Xe.index),ft!==A.length-1&&(this.RANDOM_CENTERS[ft]||(this.RANDOM_CENTERS[ft]={cx:Math.random()*3,cy:Math.random()*3}),Object.assign(Ue,this.RANDOM_CENTERS[ft]))}),F.push(...A)}return[]};n.forEach(A=>{A.x=this.xt(A.timestamp),A.cx=0,A.cy=0});let h=[],r=[],w=null;for(let A of n){let F=A.x;w===null||F-w<this.CIRCLE_RADIUS*2||(r=s(r,h)),r.push(A),w=F}return s(r,h),h}onPointClick(n){n.clustered>1?(this.zoomK=n.k,this.scrollTo(n.centerTimestamp,n)):(this.scrollTo(n.timestamp,n),this.selected.next(n))}iconDataUrl(n){let s=n_.getCodeForType(n.type,this.chronomap.primaryColor());return s=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">${s}</svg>`,s="data:image/svg+xml;base64,"+btoa(s),s}updateHovers(n=-1){n!==-1&&(this.currentHover=n),this.showHovers&&this.hovers.selectAll(".hover").style("display",s=>s.index===this.currentHover?"flex":"none").style("transform",s=>`translate(${s.x}px, 0)`),this.updatePoints()}updatePoints(){let n=this.points.selectAll(".point");n.attr("transform",s=>`translate(${s.x}, ${this.CIRCLE_RADIUS+this.HOVER_HEIGHT})`),n.select("circle.point-inactive").attr("cx",s=>s.cx).attr("cy",s=>s.cy).attr("r",s=>s.clustered>1?0:3),n.select("circle.point-bg").attr("cx",s=>s.cx).attr("cy",s=>s.cy).attr("r",s=>s.indexes.indexOf(this.currentHover)<0&&s.clustered>1?this.CIRCLE_RADIUS_CLUSTERED-1:this.CIRCLE_RADIUS-1).style("stroke",s=>s.indexes.indexOf(this.currentHover)>=0?this.chronomap.primaryColor()+"40":s.clustered>1?this.chronomap.primaryColor()+"40":"none").style("fill",s=>s.indexes.indexOf(this.currentHover)>=0||s.clustered>1?"white":"none"),n.select("image").style("display",s=>s.clustered>1?"none":null),n.select(".cluster-size").text(s=>s.clustered).style("display",s=>s.clustered===1?"none":null)}updateAxis(){let n=this.chronomap.timelineItems();if(!this.g)return;this.g.call(this.xAxis.scale(this.xt)).call(A=>A.select(".domain").remove()).call(A=>A.selectAll(".tick line").attr("y2",(F,$)=>(F=F.getTime(),this.updateIndicator(F,$),$%2===this.tickIndicator?-this.TICK_HEIGHT:-this.TICK_HEIGHT_INNER))),this.g.selectAll("text").style("text-anchor","middle").attr("dy",3+this.TEXT_HEIGHT+this.TICK_HEIGHT);let s=this.clusterPoints(n),h=this.points.selectAll(".point").data(s,A=>A.id),r=h.enter().append("g").attr("class",A=>"point"+(A.clustered===1?" single":"")).call(A=>{A.on("click",(F,$)=>{(this.hoverable||$.clustered>1)&&(this.onPointClick($),F.stopPropagation())}).on("mouseenter",(F,$)=>{(this.hoverable||$.clustered>1)&&(this.currentHover!==null&&this.updateHovers(null),this.updateHovers($.index))}).on("mouseleave",(F,$)=>{(this.hoverable||$.clustered>1)&&this.currentHover&&$.indexes.indexOf(this.currentHover)>=0&&this.updateHovers(null)})});r.append("circle").attr("class","point-inactive").attr("r",A=>A.clustered>1?0:3).style("fill",this.chronomap.primaryColor()),r.append("circle").attr("class",A=>"point-bg"+(A.clustered===1?" single":"")).attr("r",A=>A.clustered>1?this.CIRCLE_RADIUS_CLUSTERED-1:this.CIRCLE_RADIUS-1).style("stroke",this.chronomap.primaryColor()+"40").style("fill","#fff");let w=this.hovers.selectAll(".hover").data(s,A=>A.id);w.enter().append("div").attr("class","hover").style("display","none").append("span").style("border-color",this.chronomap.primaryColor()).style("color",this.chronomap.primaryColor()).style("background",`linear-gradient(90deg, ${this.chronomap.primaryColor()}40, ${this.chronomap.primaryColor()}40), #fff`).style("direction",A=>Lu.getDirection(A.title)).text(A=>A.title),w.exit().remove(),r.append("image").attr("x",-(this.CIRCLE_RADIUS-this.ICON_PADDING)).attr("y",-(this.CIRCLE_RADIUS-this.ICON_PADDING)).attr("width",(this.CIRCLE_RADIUS-this.ICON_PADDING)*2).attr("height",(this.CIRCLE_RADIUS-this.ICON_PADDING)*2).attr("xlink:href",A=>this.iconDataUrl(A)),r.append("text").attr("class","cluster-size").style("fill",this.chronomap.primaryColor()).attr("dominant-baseline","middle").attr("text-anchor","middle").attr("dy",1),h.exit().remove(),this.updatePoints(),this.updateHovers()}onZoom(n){if(this.xt=n.transform.rescaleX(this.x),this.zoomX=this.xt.invert(this.WIDTH/2),this.zoomK=n.transform.k,this.updateAxis(),!this.controlled){let s=this.xt.invert(this.WIDTH).getTime()-this.xt.invert(0).getTime()<2592e5;this._changeCandidates.next({state:`${this.zoomX.valueOf()}/${this.zoomK}/${this.firstTickValue}/${this.tickIndicator}`,timestamp:this.xt.invert(this.WIDTH/2),includeTime:s})}}updateIndicator(n,s){s===0&&n!==this.firstTickValue&&(this.firstTickValue=n,this.tickIndicator=1-this.tickIndicator)}tickFormat(n,s){if(s!==-1&&(this.updateIndicator(n.getTime(),s),s%2!==this.tickIndicator))return"";let h=this.xt.invert(this.WIDTH).getTime()-this.xt.invert(0).getTime(),r="",A=n.getMinutes()===0&&n.getSeconds()===0&&n.getMilliseconds()===0&&n.getHours()===0,F=A&&n.getDate()===1&&n.getMonth()===0;return h=h/1e3/60/60,h<5?A?r="%Y %b %-d %H:%M:%S":r="%H:%M:%S":h<7*24?A?r="%Y %b %-d":r="%-I%p":h<5*30*24?F?r="%Y %b %-d":r="%b %-d":h<5*365.25*24?F?r="%b %Y":r="%b":r="%Y",`${t_(r)(n)}`}static{this.\u0275fac=function(s){return new(s||e)(Fn(Po),Fn(tf))}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-time-line"]],viewQuery:function(s,h){if(s&1&&Lr(wte,5),s&2){let r;Dr(r=Or())&&(h.timeline=r.first)}},hostVars:2,hostBindings:function(s,h){s&2&&Do("visible",h.hovered?h.hovered():!0)},inputs:{id:"id",minDate:"minDate",maxDate:"maxDate",chronomap:"chronomap",state:"state",date:"date",includeTime:"includeTime",showHovers:"showHovers",hoverable:"hoverable",limitless:"limitless",hovered:"hovered"},outputs:{selected:"selected"},standalone:!1,features:[Os],decls:10,vars:3,consts:[["timeLine",""],[1,"timeline"],[1,"zoom-controls"],[3,"click"],["width","25","height","24","viewBox","0 0 25 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["x","6.31055","y","11","width","12.4138","height","2","rx","1"],["x","11.4824","y","18","width","12","height","2.06897","rx","1","transform","rotate(-90 11.4824 18)"],["d","M6.31055 12C6.31055 11.4477 6.75826 11 7.31055 11H17.7243C18.2766 11 18.7243 11.4477 18.7243 12C18.7243 12.5523 18.2766 13 17.7243 13H7.31055C6.75826 13 6.31055 12.5523 6.31055 12Z"]],template:function(s,h){if(s&1){let r=Pr();qt(0,"div",1,0),ut(2,"div",2)(3,"div",3),Yn("click",function(A){return Hi(r),h.zoomBy(2),$i(A.stopPropagation())}),Vo(),ut(4,"svg",4),qt(5,"rect",5)(6,"rect",6),_t()(),Wl(),ut(7,"div",3),Yn("click",function(A){return Hi(r),h.zoomBy(.5),$i(A.stopPropagation())}),Vo(),ut(8,"svg",4),qt(9,"path",7),_t()()()}s&2&&(Qe(5),xr("fill",h.chronomap.primaryColor()),Qe(),xr("fill",h.chronomap.primaryColor()),Qe(3),xr("fill",h.chronomap.primaryColor()))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;background:linear-gradient(180deg,#fff0,#fff 86%);display:flex;flex-flow:row;align-items:center;position:relative;padding-bottom:4px}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]{width:100%;display:flex;flex-flow:column;justify-content:flex-end;position:relative}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .tick line{stroke:#e0e0e0}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .tick text{fill:#828282;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:700;font-size:10;stroke:transparent}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .point text{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:800;font-size:12px}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .point:not(.single){cursor:pointer}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .points.hoverable>.point{cursor:pointer}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .hovers .hover{position:absolute;top:0;left:0;display:flex;flex-flow:column;align-items:center;overflow:visible;width:0}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .hovers .hover span{white-space:nowrap;border:1px solid;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:16px;line-height:22px;text-transform:uppercase;padding:4px 8px;border-radius:4px}[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%]{position:absolute;bottom:24px;right:8px;display:flex;flex-flow:column;align-items:center}[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:30px;height:30px;border:1px solid #E0E0E0;background:#fff;cursor:pointer;display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{border-radius:4px 4px 0 0}[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:last-child{border-radius:0 0 4px 4px;margin-top:-1px}@media screen and (max-width: 600px){[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%]{display:none}}[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%], [_nghost-%COMP%]     svg .tick text, [_nghost-%COMP%]     svg .point .point-bg.single, [_nghost-%COMP%]     svg .point image, [_nghost-%COMP%]     svg .point .cluster-size{opacity:0;transition:opacity .3s ease-in;transition-property:opacity,transform}[_nghost-%COMP%]     svg .point .point-inactive{transition:opacity .3s ease-in}.visible[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%], .visible[_nghost-%COMP%]     svg .tick text, .visible[_nghost-%COMP%]     svg .point .point-bg.single, .visible[_nghost-%COMP%]     svg .point image, .visible[_nghost-%COMP%]     svg .point .cluster-size{opacity:1}.visible[_nghost-%COMP%]     svg .point .point-inactive{opacity:0}']})}}return e})();var Cte=["arrowContainer"];function Mte(e,t){if(e&1&&qt(0,"app-time-line",14),e&2){let n=nn();jt("id",n.chronomap.title())("state",n.timelineState)("minDate",n.minDate())("maxDate",n.maxDate())("chronomap",n.chronomap)("showHovers",!1)("hoverable",!1)("limitless",!0)("hovered",n.hovered)}}var w5=(()=>{class e{constructor(n,s){this.data=n,this.router=s,this.alignment=new go,this.marked=On,this.hovered=Ln(!1),this.authorsMsg=tI(()=>{let h=this.chronomap.timelineItems(),r={},w=[],A=0;if(h.forEach($=>{$.authors?.forEach(K=>{r[K.name]=K})}),Object.values(r).forEach($=>{$.status==="Editor"?w.push($.name):$.status==="Contributor"&&A++}),w.length>1){let $=w.pop();w[w.length-1]+=` and ${$}`}let F=w.join(", ");return A>0&&(F.length>0?F+=` +${A} contributors`:F+=`${A} contributor${A>1?"s":""}`),F=`${h.length} perspectives by ${F}`,F}),bl(()=>{let h=this.chronomap.timelineItems();console.log("items",this.chronomap.title(),h),console.log("timelineState",this.timelineState())})}ngOnInit(){this.chronomap.fetchMeta().pipe(Vr(()=>this.chronomap.fetchContent())).subscribe()}ngAfterViewInit(){this.alignment.next(this.arrowContainer.nativeElement.getBoundingClientRect().width-26)}get lastModified(){return(0,b5.default)(this.chronomap.lastModified()).fromNow()}navigate(){this.router.navigate(["/",this.chronomap.directoryId,this.chronomap.slug()])}static{this.\u0275fac=function(s){return new(s||e)(Fn(ef),Fn(qa))}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-directory-item"]],viewQuery:function(s,h){if(s&1&&Lr(Cte,5),s&2){let r;Dr(r=Or())&&(h.arrowContainer=r.first)}},hostBindings:function(s,h){s&1&&Yn("mouseenter",function(){return h.hovered.set(!0)})("mouseleave",function(){return h.hovered.set(!1)})("click",function(){return h.navigate()})},inputs:{chronomap:"chronomap",timelineState:"timelineState",minDate:"minDate",maxDate:"maxDate",arrowRight:"arrowRight"},outputs:{alignment:"alignment"},standalone:!1,decls:21,vars:16,consts:[["arrowContainer",""],[1,"meta"],[3,"src"],[1,"time","layout-mobile"],[1,"titles"],[1,"title"],[1,"arrow-container"],[1,"arrow"],["xmlns","http://www.w3.org/2000/svg","width","1999","height","9","viewBox","0 0 1999 9","fill","none"],["d","M1998.38 4.94371C1998.58 4.74845 1998.58 4.43187 1998.38 4.2366L1995.2 1.05462C1995 0.859362 1994.69 0.859362 1994.49 1.05462C1994.3 1.24989 1994.3 1.56647 1994.49 1.76173L1997.32 4.59016L1994.49 7.41858C1994.3 7.61385 1994.3 7.93043 1994.49 8.12569C1994.69 8.32095 1995 8.32095 1995.2 8.12569L1998.38 4.94371ZM0.0273438 5.09033L1998.03 5.09016L1998.03 4.09016L0.0273437 4.09033L0.0273438 5.09033Z"],[1,"time","layout-desktop"],[1,"subtitle",3,"innerHTML"],[1,"timerange"],[1,"counts"],[3,"id","state","minDate","maxDate","chronomap","showHovers","hoverable","limitless","hovered"]],template:function(s,h){if(s&1&&(ut(0,"div",1),qt(1,"img",2),ut(2,"div",3),xn(3),_t(),ut(4,"div",4)(5,"div",5)(6,"span"),xn(7),_t(),ut(8,"div",6,0)(10,"div",7),Vo(),ut(11,"svg",8),qt(12,"path",9),_t()(),Wl(),ut(13,"div",10),xn(14),_t()()(),qt(15,"div",11),ut(16,"div",12),xn(17),_t(),ut(18,"div",13),xn(19),_t()()(),Mi(20,Mte,1,9,"app-time-line",14)),s&2){let r;Qe(),jt("src",h.chronomap.thumbnail(),jo),Qe(2),As("Updated ",h.lastModified,""),Qe(2),fn("color",h.data.directory.secondaryColor()),Qe(2),rr(h.chronomap.title()),Qe(3),fn("right",h.arrowRight+"px"),Qe(2),xr("fill",h.data.directory.primaryColor()),Qe(2),As("Updated ",h.lastModified,""),Qe(),fn("color",h.data.directory.primaryColor()),jt("innerHTML",h.marked(h.chronomap.subtitle()),Wo),Qe(2),KS("(",(r=h.chronomap.timelineItems()[0])==null||r.post_timestamp==null?null:r.post_timestamp.getFullYear()," - ",(r=h.chronomap.timelineItems()[h.chronomap.timelineItems().length-1])==null||r.post_timestamp==null?null:r.post_timestamp.getFullYear(),")"),Qe(2),rr(h.authorsMsg()),Qe(),Ga(h.chronomap.timelineItems().length>0?20:-1)}},dependencies:[i_],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;position:relative;cursor:pointer;pointer-events:all}@media only screen and (min-width: 1000px){[_nghost-%COMP%]{height:124px}}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]{display:flex;overflow:hidden;width:100%;position:relative;z-index:1;pointer-events:none}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]{flex-flow:row nowrap;gap:16px;height:100%;padding-left:40px;padding-right:16px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]{flex-flow:column nowrap;gap:8px;min-height:233px}}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:12px;font-weight:400;line-height:normal;letter-spacing:.24px}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:cover;flex:0 0 auto}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:192px;padding-bottom:20px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100px;width:100%}}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;gap:0;width:100%}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]{padding-bottom:15px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]{padding:0 16px 19px;flex:1 1 auto}}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;align-items:center;gap:8px;pointer-events:all}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-top:-8px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-top:-1px;margin-bottom:1px}}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-size:18px;font-weight:700;line-height:28px;text-transform:uppercase;white-space:nowrap}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .arrow-container[_ngcontent-%COMP%]{flex:1 1 100%;height:20px;position:relative;overflow:hidden;display:flex;flex-flow:row;align-items:center}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .arrow-container[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;right:800px;transition:right .3s ease-in;top:-1px}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .arrow-container[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{flex:0 0 auto;position:absolute;right:4px;color:#828282;transition:opacity .3s ease-in;opacity:1}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:15px;font-weight:400;line-height:15px;letter-spacing:.15px;margin-top:-2px;margin-bottom:1px}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]     *{display:inline;margin:0}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .timerange[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;opacity:0;transition:opacity .3s ease-in;color:#4f4f4f;font-size:13px;font-weight:300;line-height:23px;letter-spacing:.13px}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%]   .titles[_ngcontent-%COMP%]   .counts[_ngcontent-%COMP%]{margin-top:auto;color:#4f4f4f;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:13px;font-weight:300;line-height:20px;letter-spacing:.13px}@media only screen and (min-width: 1000px){[_nghost-%COMP%]:hover   .meta[_ngcontent-%COMP%] > .titles[_ngcontent-%COMP%] > .title[_ngcontent-%COMP%] > .arrow-container[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{right:0!important}[_nghost-%COMP%]:hover   .meta[_ngcontent-%COMP%] > .titles[_ngcontent-%COMP%] > .title[_ngcontent-%COMP%] > .arrow-container[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{opacity:0}[_nghost-%COMP%]:hover   .meta[_ngcontent-%COMP%] > .titles[_ngcontent-%COMP%] > .timerange[_ngcontent-%COMP%]{opacity:1}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .meta[_ngcontent-%COMP%] > .titles[_ngcontent-%COMP%] > .title[_ngcontent-%COMP%] > .arrow-container[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{right:0!important}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%] > .titles[_ngcontent-%COMP%] > .title[_ngcontent-%COMP%] > .arrow-container[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{opacity:1;color:#fff;position:relative;top:-32px}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%] > .titles[_ngcontent-%COMP%] > .timerange[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]   .meta[_ngcontent-%COMP%] > .time[_ngcontent-%COMP%]{position:absolute;top:82px;right:4px;color:#fff;text-shadow:0px 0px 4px rgba(0,0,0,.75)}}[_nghost-%COMP%]   app-time-line[_ngcontent-%COMP%]{position:absolute;left:0;width:100%}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   app-time-line[_ngcontent-%COMP%]{bottom:0}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   app-time-line[_ngcontent-%COMP%]{bottom:4px}}']})}}return e})();var Ete=["title"],Ste=(e,t)=>t.id;function Ite(e,t){if(e&1){let n=Pr();ut(0,"a",13),Yn("click",function(){Hi(n);let h=nn();return $i(h.fullDescription.set(!0))}),xn(1,"more"),_t()}if(e&2){let n=nn();fn("color",n.data.directory.primaryColor())}}function Pte(e,t){if(e&1){let n=Pr();ut(0,"div",14),qt(1,"span",15),ut(2,"a",13),Yn("click",function(){Hi(n);let h=nn();return $i(h.fullDescription.set(!1))}),xn(3,"less"),_t()()}if(e&2){let n=nn();fn("color",n.data.directory.primaryColor()),Qe(),jt("innerHTML",n.marked(n.data.directory.fullDescription()),Wo)}}function Dte(e,t){if(e&1&&(ut(0,"a",17),qt(1,"img",18),_t()),e&2){let n=t.$implicit,s=t.$index,h=nn(2);jt("href",h.data.directory.logoLinks()[s],jo),Qe(),fn("height","60px"),jt("src",n,jo)}}function Ote(e,t){if(e&1&&(ut(0,"div",16),Hd(1,Dte,2,4,"a",17,vF),_t()),e&2){let n=nn();Qe(),$d(n.data.directory.logos())}}function Ate(e,t){if(e&1){let n=Pr();ut(0,"app-directory-item",19),Yn("alignment",function(h){let r=Hi(n).$implicit,w=nn();return $i(w.align(r.title(),h))}),_t()}if(e&2){let n=t.$implicit,s=nn();jt("chronomap",n)("timelineState",s.timelineState)("minDate",s.minDate)("maxDate",s.maxDate)("arrowRight",s.arrowRight())}}var cC=class aP{constructor(t,n,s){this.data=t,this.layout=n,this.route=s,this.timelineState=Ln(""),this.minDate=Ln(new Date),this.maxDate=Ln(new Date),this.arrowRight=Ln(0),this.alignment={},this.fullDescription=Ln(!1),this.titleOpen=Ln(!1),this.marked=On,s.params.subscribe(h=>{let r=parseInt(h.dbid);this.data.fetchData(r)}),bl(()=>{let h=null,r=null;this.data.directory.chronomaps().forEach(se=>{se.timelineItems().forEach(le=>{le.post_timestamp&&((!h||le.post_timestamp<h)&&(h=le.post_timestamp),(!r||le.post_timestamp>r)&&(r=le.post_timestamp))})}),h=h||new Date,r=r||new Date;let w=(r.getTime()-h.getTime())/10;h=new Date(h.getTime()-w),r=new Date(r.getTime()+w);let A=new Date(this.data.directory.zoomFrom(),0,1),F=new Date(this.data.directory.zoomUntil(),11,31),$=new Date((A.getTime()+F.getTime())/2).getTime(),K=Math.max(0,(r.getTime()-h.getTime())/(F.getTime()-A.getTime()));this.timelineState.set(`${$}/${K}`),this.minDate.set(h),this.maxDate.set(r),this.titleOpen()||this.title?.nativeElement?.scrollTo({top:0,behavior:"smooth"})},{allowSignalWrites:!0})}ngAfterViewInit(){bo(this.title.nativeElement,"scroll").pipe(na(this),yl(0,vu)).subscribe(()=>{this.titleOpen.set(this.title.nativeElement.scrollTop>0),this.title.nativeElement.scrollTop<0&&(this.title.nativeElement.scrollTop=0)}),bo(this.title.nativeElement,"touchstart").pipe(na(this)).subscribe(t=>{this.titleOpen()||(this.titleOpen.set(!0),t.stopPropagation(),this.startY=t.touches[0].clientY,ST(bo(this.title.nativeElement,"touchend"),bo(this.title.nativeElement,"touchmove").pipe(kT(16,vu))).pipe(pi(n=>{if(n.type==="touchmove"){let s=this.startY-n.touches[0].clientY;this.title.nativeElement.scrollTop=s<0?0:s}}),io(n=>n.type==="touchend"),mo()).subscribe(()=>{this.titleOpen.set(this.title.nativeElement.scrollTop>0)}))})}align(t,n){this.alignment[t]=n;let s=Math.min(...Object.values(this.alignment));this.arrowRight.set(s)}get titleBoxShadow(){return`0px 0px 20px 1px ${this.data.directory.primaryColor()}40`}openTitle(){this.layout.mobile()&&this.title.nativeElement.scrollTo({top:1e4,behavior:"smooth"})}static{this.\u0275fac=function(n){return new(n||aP)(Fn(ef),Fn(tf),Fn(Ea))}}static{this.\u0275cmp=Ci({type:aP,selectors:[["app-directory-page"]],viewQuery:function(n,s){if(n&1&&Lr(Ete,5),n&2){let h;Dr(h=Or())&&(s.title=h.first)}},standalone:!1,decls:15,vars:15,consts:[["title",""],[1,"title-container"],[1,"filler",3,"click"],[1,"title"],[1,"handle"],[3,"click","src"],[1,"description"],[1,"short"],["class","toggle",3,"color","click",4,"ngIf"],["class","long",3,"color",4,"ngIf"],["class","logos",4,"ngIf"],[1,"chronomaps"],[3,"chronomap","timelineState","minDate","maxDate","arrowRight"],[1,"toggle",3,"click"],[1,"long"],[3,"innerHTML"],[1,"logos"],["target","_blank",3,"href"],[3,"src"],[3,"alignment","chronomap","timelineState","minDate","maxDate","arrowRight"]],template:function(n,s){if(n&1){let h=Pr();ut(0,"div",1,0)(2,"div",2),Yn("click",function(){return Hi(h),$i(s.titleOpen.set(!1))}),_t(),ut(3,"div",3),qt(4,"div",4),ut(5,"img",5),Yn("click",function(){return Hi(h),$i(s.openTitle())}),_t(),ut(6,"div",6)(7,"div",7),xn(8),Mi(9,Ite,2,2,"a",8),_t(),Mi(10,Pte,4,3,"div",9)(11,Ote,3,0,"div",10),_t()()(),ut(12,"div",11),Hd(13,Ate,1,5,"app-directory-item",12,Ste),_t()}n&2&&(Do("open",s.titleOpen()),Qe(2),fn("background-color",s.titleOpen()?s.data.directory.secondaryColor():null),Qe(),fn("box-shadow",s.titleBoxShadow),Qe(),fn("border-color",s.data.directory.primaryColor()),Qe(),jt("src",s.data.directory.titleImageUrl(),jo),Qe(2),fn("color",s.data.directory.secondaryColor()),Qe(),As(" ",s.data.directory.description()," "),Qe(),jt("ngIf",!s.fullDescription()),Qe(),jt("ngIf",s.fullDescription()||s.layout.mobile()),Qe(),jt("ngIf",s.fullDescription()||s.layout.mobile()),Qe(2),$d(s.data.directory.chronomaps()))},dependencies:[xs,w5],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]   .chronomaps[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;align-items:stretch;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .chronomaps[_ngcontent-%COMP%]{padding:40px 0 200px;gap:20px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .chronomaps[_ngcontent-%COMP%]{padding:16px 0 200px;gap:16px}}[_nghost-%COMP%]   .chronomaps[_ngcontent-%COMP%]   app-directory-item[_ngcontent-%COMP%]{flex:0 0 auto}[_nghost-%COMP%]   .chronomaps[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;width:100%;z-index:2;pointer-events:none}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]{bottom:0;left:0}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]{top:0;left:0;width:100%;height:100%;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .filler[_ngcontent-%COMP%]{transition:background-color .3s ease-in-out;opacity:.3}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .filler[_ngcontent-%COMP%]{display:none}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .filler[_ngcontent-%COMP%]{height:calc(100% - 24px - ((100vw - 32px)*.1875))}}[_nghost-%COMP%]   .title-container.open[_ngcontent-%COMP%]{pointer-events:all}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{pointer-events:all;background:#fff}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{padding:24px 40px;display:flex;flex-flow:row nowrap;justify-content:space-between;gap:40px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{padding:16px;display:flex;flex-flow:column;gap:8px;position:relative}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{position:absolute;top:6px;left:50%;width:20px;height:4px;border-top:1px solid black;border-bottom:1px solid black;transform:translate(-50%)}}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{align-self:flex-start}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto}}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;gap:8px;align-items:stretch}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{align-self:flex-end}}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .short[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:20px;font-weight:400;line-height:28px;letter-spacing:.2px}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .long[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:18px;font-weight:300;line-height:24px;letter-spacing:.18px;display:flex;flex-flow:column nowrap}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .long[_ngcontent-%COMP%]     a{font-weight:500;text-decoration-line:underline;cursor:pointer;color:inherit}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .long[_ngcontent-%COMP%]     p{margin:0 0 .33em}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .toggle[_ngcontent-%COMP%]{align-self:flex-end;font-weight:500;text-decoration-line:underline;cursor:pointer}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .toggle[_ngcontent-%COMP%]{display:none}}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]{margin-top:40px;display:flex;flex-flow:row wrap;align-items:center;gap:32px}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]{justify-content:center}}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:auto}']})}};cC=Hl([Kl()],cC);var hv=class{constructor(t,n,s=null){this.timelineState=t,this.selectedItemId=n,this.replaceUrl=s}},uC=(()=>{class e{constructor(n){this.router=n,this.internalStates=new Ii,this.state=new ga(1),this.internalStates.pipe(_a(0,vu),Ad((s,h)=>s.timelineState===h.timelineState&&s.selectedItemId===h.selectedItemId),pi(s=>{this.state.next(s)}),io(s=>s.replaceUrl!==null),ti(s=>{let h="";return s.timelineState&&(h+=s.timelineState),s.selectedItemId&&(h+=`//${s.selectedItemId}`),s.replaceUrl===!1&&this.router.navigate([],{fragment:h,replaceUrl:!1}),s.replaceUrl===!0?h:null}),yl(250,vu),pi(s=>{s&&this.router.navigate([],{fragment:s,replaceUrl:!0})})).subscribe()}initFromUrl(n,s){let h=n.split("//"),r="",w=null;if(h.length>0&&(r=h[0],h.length>1))try{w=parseInt(h[1],10)||null}catch{w=null}this.timelineState_=r,this.selectedItemId_=w,this.internalStates.next(new hv(r,w))}set timelineState(n){this.timelineState_=n,this.internalStates.next(new hv(n,this.selectedItemId_,!0))}set selectedItemId(n){this.selectedItemId_=n,this.internalStates.next(new hv(this.timelineState_,n,!1))}static{this.\u0275fac=function(s){return new(s||e)(Bn(qa))}}static{this.\u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var M5=(()=>{class e{constructor(n){this.sanitizer=n,this.close=new go,this.marked=On,this.aboutContent_=null}get aboutContent(){if(!this.aboutContent_)if(this.chronomap.infobarContent())this.aboutContent_=this.sanitizer.bypassSecurityTrustHtml(On(this.chronomap.infobarContent()));else return this.sanitizer.bypassSecurityTrustHtml("Loading...");return this.aboutContent_}static{this.\u0275fac=function(s){return new(s||e)(Fn(zc))}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-infobar"]],hostVars:2,hostBindings:function(s,h){s&2&&fn("border-color",h.chronomap.primaryColor()+"40")},inputs:{chronomap:"chronomap"},outputs:{close:"close"},standalone:!1,decls:9,vars:5,consts:[[1,"title"],["width","44","height","44","viewBox","0 0 44 44","fill","none","xmlns","http://www.w3.org/2000/svg",1,"close",3,"click"],["d","M11.3936 11.3936L32.6068 32.6068"],["d","M32.6064 11.3936L11.3932 32.6068"],[3,"innerHtml"]],template:function(s,h){s&1&&(ut(0,"div",0)(1,"h1"),xn(2),_t(),ut(3,"h2"),xn(4),_t(),Vo(),ut(5,"svg",1),Yn("click",function(){return h.close.emit()}),qt(6,"path",2)(7,"path",3),_t()(),Wl(),qt(8,"p",4)),s&2&&(Qe(2),rr(h.chronomap.infobarTitle()),Qe(2),rr(h.chronomap.infobarSubtitle()),Qe(2),xr("stroke",h.chronomap.primaryColor()),Qe(),xr("stroke",h.chronomap.primaryColor()),Qe(),jt("innerHtml",h.aboutContent,Wo))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%;flex-flow:column;justify-content:flex-start;align-items:center;background:#fff;position:relative;z-index:2}@media only screen and (min-width: 1000px){[_nghost-%COMP%]{max-width:360px;padding:16px;border-right:1px solid black}}@media only screen and (max-width: 999px){[_nghost-%COMP%]{max-height:100%;overflow-y:scroll;padding:16px;box-shadow:0 -1px 8px #00000026;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}[_nghost-%COMP%]::-webkit-scrollbar{display:none}}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{position:relative;border-bottom:.5px solid #333333;margin-bottom:20px}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], [_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;max-width:calc(100% - 46px);color:#333}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.02em;text-transform:uppercase;color:#333}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;line-height:21px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:17px;line-height:21px}}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:400;font-size:15px;letter-spacing:-.01em}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px;line-height:21px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px;line-height:21px}}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{cursor:pointer;position:absolute;top:-5px;right:0;width:30px;height:30px}[_nghost-%COMP%]     a, [_nghost-%COMP%]     a:visited, [_nghost-%COMP%]     a:hover{font-weight:500}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:first-child{margin:0 16px -4px}[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:last-child{margin:-4px 16px 0}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:first-child{margin:0 0 -4px}[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:last-child{margin:-4px 0 0}}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;letter-spacing:.01em;color:#333;margin:0 8px}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]{width:100%;background-color:#fff;padding-top:0}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;padding:24px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]{padding:24px 0 0}}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:first-child{border-top:.5px solid #333333}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], [_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .notes[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;width:100%;letter-spacing:.01em;color:#333;border-bottom:.5px solid #BDBDBD;padding:8px 0}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:13px;width:100%;letter-spacing:.02em;color:#333;padding:8px 0;display:flex;align-items:center;flex-flow:row}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]{margin-left:auto;cursor:pointer}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .expander.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:13px;font-weight:400;letter-spacing:.01em;color:#000;margin:0}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;display:block;font-size:13px;font-weight:400;letter-spacing:.01em;color:#2d9cdb;margin:6px 0 0}[_nghost-%COMP%]{overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}[_nghost-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{margin:0}']})}}return e})();var cf=(()=>{class e{constructor(){this.showMapSelector=!1,this.showTimelineSelector=!1,this.selectedGeo={},this.selectedDate="",this.mapResults=new Ii,this.timelineResults=new Ii}submitMapResult(n){n.geo&&(this.selectedGeo=Jl.parseMapView(n.geo)),this.mapResults.next(n)}submitTimelineResult(n,s){this.timelineResults.next(n),this.selectedDate=s}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function kte(e,t){if(e&1){let n=Pr();Vo(),ut(0,"svg",4),Yn("click",function(){Hi(n);let h=nn();return $i(h.slide=h.slide-1)}),qt(1,"path",22),_t()}if(e&2){let n=nn();Qe(),xr("stroke",n.chronomap.primaryColor())}}function Lte(e,t){if(e&1&&qt(0,"h2",23),e&2){let n=nn();jt("innerHtml",n.chronomap.contributeMessage(),Wo)}}function Fte(e,t){if(e&1){let n=Pr();ut(0,"button",24),Yn("click",function(){Hi(n);let h=nn();return $i(h.slide=h.slide+1)}),Vo(),ut(1,"svg",25),qt(2,"path",26)(3,"line",27),_t()()}if(e&2){let n=nn();fn("color",n.chronomap.primaryColor())("border-color",n.chronomap.secondaryColor()+"40"),Qe(2),xr("stroke",n.chronomap.primaryColor()),Qe(),xr("stroke",n.chronomap.primaryColor())}}function Nte(e,t){if(e&1){let n=Pr();ut(0,"button",24),Yn("click",function(){Hi(n);let h=nn();return $i(h.slide=h.slide+1)}),Vo(),ut(1,"svg",25),qt(2,"path",26)(3,"line",27),_t()()}if(e&2){let n=nn();fn("color",n.chronomap.primaryColor())("border-color",n.chronomap.secondaryColor()+"40"),Qe(2),xr("stroke",n.chronomap.primaryColor()),Qe(),xr("stroke",n.chronomap.primaryColor())}}function zte(e,t){if(e&1&&qt(0,"iframe",28),e&2){let n=nn();jt("src",n.iframeSrc,OS)}}function Bte(e,t){if(e&1&&(Du(0),qt(1,"div",29)(2,"div",29)(3,"div",29)(4,"div",29),Ou()),e&2){let n=nn();Qe(),fn("background",n.slide==0?n.chronomap.primaryColor():null),Qe(),fn("background",n.slide==1?n.chronomap.primaryColor():null),Qe(),fn("background",n.slide==2?n.chronomap.primaryColor():null),Qe(),fn("background",n.slide==3?n.chronomap.primaryColor():null)}}var dC=class lP{constructor(t,n,s){this.sanitizer=t,this.mapSelector=n,this.data=s,this.close=new go,this.marked=On,this.contributeMessage="",this.slide_=0,this.contentType="",this.contentTypeName="",this.selectedProperties={},this.mapSubscription=null,this.timelineSubscription=null,this.iframeURL=null,this.subscription=null}ngOnInit(){this.chronomap.ready.pipe(mo()).subscribe(()=>{this.contributeMessage=this.sanitizer.bypassSecurityTrustHtml(On(this.chronomap.contributeMessage()))}),this.nonce=""+Math.floor(Math.random()*1e9)}selectCT(t,n){this.contentType=t,this.contentTypeName=n,this.slide+=1}get iframeSrc(){if(!this.selectedDate&&!this.chronomap.disableTimeline()||!this.contentType||!this.selectedGeo||!this.chronomap.newEntryForm())return null;let t=new URL(this.chronomap.newEntryForm());console.log("PREFILL",this.contentType),t.searchParams.append("prefill_Media Type",this.contentType),t.searchParams.append("hide_Media Type","true"),t.searchParams.append("prefill_Post_Timestamp",this.selectedDate+"T00:00:00.000"),t.searchParams.append("hide_Post_Timestamp","true"),t.searchParams.append("prefill_Geo",this.selectedGeo),t.searchParams.append("hide_Geo","true"),t.searchParams.append("prefill_Nonce",this.nonce),t.searchParams.append("hide_Nonce","true"),t.searchParams.append("prefill_Status","Review"),t.searchParams.append("hide_Status","true"),t.searchParams.append("prefill_Properties",JSON.stringify(this.selectedProperties)),t.searchParams.append("hide_Properties","true");for(let s of Object.keys(this.selectedProperties))t.searchParams.append("hide_"+s,"true"),t.searchParams.append("prefill_"+s,this.selectedProperties[s]);this.iframeURL||this.initPolling();let n=t.toString();return this.iframeURL!==n&&(this.iframeURL=n,this.iframeSafeURL=this.sanitizer.bypassSecurityTrustResourceUrl(this.iframeURL)),this.iframeSafeURL}openMap(){this.mapSelector.showMapSelector=!0,this.mapSubscription?.unsubscribe(),this.mapSubscription=this.mapSelector.mapResults.pipe(na(this)).subscribe(t=>{console.log("GOT GEO",t),t.geo&&(this.selectedGeo=t.geo);for(let n of Object.keys(t))n!=="geo"&&(this.selectedProperties[n]=t[n])})}closeMap(){this.mapSelector.showMapSelector=!1,this.mapSubscription?.unsubscribe(),this.mapSubscription=null}openTimeline(){this.mapSelector.showTimelineSelector=!0,this.timelineSubscription?.unsubscribe(),this.timelineSubscription=this.mapSelector.timelineResults.pipe(na(this)).subscribe(t=>{console.log("GOT DATE",t),t&&(this.selectedDate=t)})}closeTimeline(){this.mapSelector.showTimelineSelector=!1,this.timelineSubscription?.unsubscribe(),this.timelineSubscription=null}closeMe(){this.subscription?.unsubscribe(),this.subscription=null,this.closeMap(),this.closeTimeline(),this.close.emit()}initPolling(){this.subscription=ET(5e3).pipe(Vr(()=>this.chronomap.fetchContent(!0))).subscribe(t=>{this.chronomap.nonces.forEach(n=>{n===this.nonce&&(this.subscription?.unsubscribe(),this.subscription=null,this.slide=4)})})}set slide(t){this.slide_=t,this.slide_===1?this.openMap():this.closeMap(),this.slide_===2?this.chronomap.disableTimeline()?this.slide=3:this.openTimeline():this.closeTimeline()}get slide(){return this.slide_}static{this.\u0275fac=function(n){return new(n||lP)(Fn(zc),Fn(cf),Fn(ef))}}static{this.\u0275cmp=Ci({type:lP,selectors:[["app-add-new-bar"]],hostVars:4,hostBindings:function(n,s){n&2&&(fn("border-color",s.chronomap.primaryColor()+"40"),Do("maximized",s.slide!==1&&s.slide!==2))},inputs:{chronomap:"chronomap"},outputs:{close:"close"},standalone:!1,decls:90,vars:70,consts:[[1,"slides"],[1,"controls"],[1,"control"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",3,"click",4,"ngIf"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",3,"click"],["d","M1.39453 1.39355L22.6077 22.6068"],["d","M22.6074 1.39355L1.39422 22.6068"],[1,"slide"],[1,"header"],[3,"innerHtml",4,"ngIf"],[1,"content-types"],[1,"content-type",3,"click"],[1,"icon"],[3,"type","color"],[1,"name"],[1,"indented"],[1,"bottom"],["class","next-button",3,"color","border-color","click",4,"ngIf"],["frameborder","0","onmousewheel","","width","100%","height","100%",3,"src",4,"ngIf"],[3,"click"],[1,"progress"],[4,"ngIf"],["d","M18 1L7 12.1467L18 23"],[3,"innerHtml"],[1,"next-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none"],["d","M11 23L22 11.8533L11 1","stroke-width","2"],["x1","22","y1","12","x2","2","y2","12","stroke-width","2"],["frameborder","0","onmousewheel","","width","100%","height","100%",3,"src"],[1,"progress-item"]],template:function(n,s){n&1&&(ut(0,"div",0)(1,"div",1)(2,"div",2),Mi(3,kte,2,1,"svg",3),_t(),ut(4,"div",2),Vo(),ut(5,"svg",4),Yn("click",function(){return s.closeMe()}),qt(6,"path",5)(7,"path",6),_t()()(),Wl(),ut(8,"div",7)(9,"div",8)(10,"h1"),xn(11,"Add your perspective"),_t(),Mi(12,Lte,1,1,"h2",9),ut(13,"h2"),xn(14,"Let\u2019s indeed start by choosing the format for this perspective:"),_t()(),ut(15,"div",10)(16,"div",11),Yn("click",function(){return s.selectCT("note","sticky note")}),ut(17,"div",12),qt(18,"app-media-icon",13),_t(),ut(19,"div",14),xn(20,"Sticky Note"),_t()(),ut(21,"div",11),Yn("click",function(){return s.selectCT("audio","audio clip")}),ut(22,"div",12),qt(23,"app-media-icon",13),_t(),ut(24,"div",14),xn(25,"Audio clip"),_t()(),ut(26,"div",11),Yn("click",function(){return s.selectCT("twitter","Tweet")}),ut(27,"div",12),qt(28,"app-media-icon",13),_t(),ut(29,"div",14),xn(30,"Twitter post"),_t()(),ut(31,"div",11),Yn("click",function(){return s.selectCT("instagram","Instagram post")}),ut(32,"div",12),qt(33,"app-media-icon",13),_t(),ut(34,"div",14),xn(35,"Instagram post"),_t()(),ut(36,"div",11),Yn("click",function(){return s.selectCT("video","video clip")}),ut(37,"div",12),qt(38,"app-media-icon",13),_t(),ut(39,"div",14),xn(40,"Youtube video"),_t()(),ut(41,"div",11),Yn("click",function(){return s.selectCT("wikipedia","Wikipedia snippet")}),ut(42,"div",12),qt(43,"app-media-icon",13),_t(),ut(44,"div",14),xn(45,"Wikipedia article"),_t()(),ut(46,"div",11),Yn("click",function(){return s.selectCT("news","news article")}),ut(47,"div",12),qt(48,"app-media-icon",13),_t(),ut(49,"div",14),xn(50,"News"),_t()(),ut(51,"div",11),Yn("click",function(){return s.selectCT("image","image")}),ut(52,"div",12),qt(53,"app-media-icon",13),_t(),ut(54,"div",14),xn(55,"Image"),_t()()()(),ut(56,"div",7)(57,"div",8)(58,"h1",15),xn(59,"Where?"),_t(),ut(60,"h2"),xn(61,"Position the camera on your location of choice"),_t()(),ut(62,"div",16),Mi(63,Fte,4,6,"button",17),_t()(),ut(64,"div",7)(65,"div",8)(66,"h1",15),xn(67,"When?"),_t(),ut(68,"h2"),xn(69),_t()(),ut(70,"div",16),Mi(71,Nte,4,6,"button",17),_t()(),ut(72,"div",7)(73,"div",8)(74,"h1",15),xn(75,"Add The Details"),_t(),ut(76,"h2"),xn(77),_t()(),Mi(78,zte,1,1,"iframe",18),_t(),ut(79,"div",7)(80,"div",8)(81,"h1"),xn(82,"Thank you!"),_t(),ut(83,"h2"),xn(84,"We will review your contribution and email you if it is added to the timeline"),_t()(),ut(85,"div",16)(86,"button",19),Yn("click",function(){return s.closeMe()}),xn(87," close "),_t()()()(),ut(88,"div",20),Mi(89,Bte,5,8,"ng-container",21),_t()),n&2&&(Qe(3),jt("ngIf",s.slide>0&&s.slide<4),Qe(3),xr("stroke",s.chronomap.primaryColor()),Qe(),xr("stroke",s.chronomap.primaryColor()),Qe(),Do("pre",s.slide<0)("post",s.slide>0),Qe(4),jt("ngIf",s.chronomap.contributeMessage()),Qe(3),fn("color",s.chronomap.primaryColor()),Qe(2),fn("border-color",s.chronomap.primaryColor()),Qe(),jt("type","note")("color",s.chronomap.primaryColor()),Qe(4),fn("border-color",s.chronomap.primaryColor()),Qe(),jt("type","audio")("color",s.chronomap.primaryColor()),Qe(4),fn("border-color",s.chronomap.primaryColor()),Qe(),jt("type","twitter")("color",s.chronomap.primaryColor()),Qe(4),fn("border-color",s.chronomap.primaryColor()),Qe(),jt("type","instagram")("color",s.chronomap.primaryColor()),Qe(4),fn("border-color",s.chronomap.primaryColor()),Qe(),jt("type","video")("color",s.chronomap.primaryColor()),Qe(4),fn("border-color",s.chronomap.primaryColor()),Qe(),jt("type","wikipedia")("color",s.chronomap.primaryColor()),Qe(4),fn("border-color",s.chronomap.primaryColor()),Qe(),jt("type","news")("color",s.chronomap.primaryColor()),Qe(4),fn("border-color",s.chronomap.primaryColor()),Qe(),jt("type","image")("color",s.chronomap.primaryColor()),Qe(3),Do("pre",s.slide<1)("post",s.slide>1),Qe(7),jt("ngIf",s.selectedGeo),Qe(),Do("pre",s.slide<2)("post",s.slide>2),Qe(5),As("Drag the timeline left and right to position your ",s.contentTypeName," in time. Zoom the timeline (using the scroll wheel or the + & - buttons) to adjust between years, days, hours and minutes."),Qe(2),jt("ngIf",s.selectedDate),Qe(),Do("pre",s.slide<3)("post",s.slide>3),Qe(5),As("Now that we know time and space, let\u2019s add the details of your ",s.contentTypeName,""),Qe(),jt("ngIf",s.iframeSrc),Qe(),Do("pre",s.slide<4)("post",s.slide>4),Qe(7),fn("color",s.chronomap.primaryColor())("border-color",s.chronomap.secondaryColor()+"40"),Qe(2),fn("border-color",s.chronomap.secondaryColor()),Qe(),jt("ngIf",s.slide>=0&&s.slide<4))},dependencies:[xs,n_],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;display:flex;flex-flow:column;justify-content:flex-start;align-items:stretch;background:#fff;position:relative;z-index:2;overflow:hidden}@media only screen and (min-width: 1000px){[_nghost-%COMP%]{max-width:360px;height:100%;padding:16px;border-right:1px solid black}}@media only screen and (max-width: 999px){[_nghost-%COMP%]{max-height:100%;overflow-y:scroll;padding:16px;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;height:309px}[_nghost-%COMP%]::-webkit-scrollbar{display:none}.maximized[_nghost-%COMP%]{height:80vh}}[_nghost-%COMP%]     a, [_nghost-%COMP%]     a:visited, [_nghost-%COMP%]     a:hover{font-weight:500}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;letter-spacing:.01em;color:#333;margin:0 8px}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:row;justify-content:space-between;align-items:center;position:absolute;top:0;right:0;width:100%;z-index:1}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]{height:100%;width:100%;overflow:hidden;flex:1 1 auto;position:relative}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]{display:flex;flex-flow:column;justify-content:flex-start;align-items:stretch;width:100%;height:100%;transform:translate(0);transition:transform .25s linear;position:absolute;top:0;left:0;overflow:auto}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide.pre[_ngcontent-%COMP%]{transform:translate(100%)}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide.post[_ngcontent-%COMP%]{transform:translate(-100%)}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch;justify-content:flex-start;gap:4px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:700;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#333;margin:0}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1.indented[_ngcontent-%COMP%]{margin-left:40px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:15px;line-height:21px;letter-spacing:-.01em;color:#333;padding-bottom:8px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]:last-child{border-bottom:.5px solid #333333}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]:last-child{margin-bottom:32px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]:last-child{margin-bottom:16px}}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:column;align-items:center;width:100%;margin-top:auto}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]   .next-button[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:24px;border:1px solid black;display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:12px;padding:8px 24px;height:40px;background:#ffffff80;border:1px solid black;border-radius:24px;font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#ce0031;cursor:pointer}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:flex-start;justify-content:flex-start;gap:8px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;justify-content:flex-start;gap:16px;cursor:pointer}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:48px;height:48px;overflow:hidden;border-radius:24px;border:1px solid black;display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px;height:24px;object-fit:contain}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;line-height:23px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .date-selector[_ngcontent-%COMP%]{height:48px;width:100%;position:relative}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .date-selector[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:1px solid black;border-radius:4px;width:100%;height:100%;padding-left:44px;padding-right:16px;color:#000;font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;letter-spacing:.02em;text-transform:uppercase;z-index:1;position:relative;background-color:transparent}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .date-selector[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;left:12px;top:12px;width:24px;height:24px;z-index:0}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%]{margin:0 -32px;width:360px}[_nghost-%COMP%]   .progress[_ngcontent-%COMP%]{flex:0 0 auto;margin-top:16px;padding-top:16px;height:25px;display:flex;flex-flow:row;align-items:stretch;justify-content:stretch;gap:8px;border-top:1px solid black}[_nghost-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-item[_ngcontent-%COMP%]{flex:1 1 auto;height:100%;border-radius:2px;background:#e0e0e0;transition:background .25s linear}']})}};dC=Hl([Kl()],dC);var r_=class{constructor(t,n,s){this.owner=t,this.layout=n,this.chronomap=s,this.maps=[],this.selectorMap=null,this.itemSelected=new Ii,this.itemHovered=new Ii,this.selectorMapMoved=new Ii,this.moveEnd=new Ii,this.markers=[],this.moveEnded=this.moveEnd.pipe(yl(1e3))}init(t,n,s,h){this.baseMapEl=t,this.detailMapEl=n,this.baseMarkersEl=s,this.detailMarkersEl=h,this.maps=this.initMaps(),this.baseMap=this.maps[0],this.detailMap=this.maps[1],this.updateMarkers()}resize(){this.maps.forEach(t=>{this.mapResize(t)}),this.selectorMap&&this.mapResize(this.selectorMap)}flyTo(t){this.mapFlyTo(this.baseMap,t)}applyMapView(t,n=null){let s=Object.assign({},Jl.parseMapView(t.geo),n||{});this.processFlyToOptions(s),this.mapApplyLayers(this.detailMap,t.map_layers,t.off_map_layers),s.duration&&this.pauseSync(s.duration+1),this.mapFlyTo(this.detailMap,s),this.mapFlyTo(this.baseMap,s)}initSelectorMap(t,n,s=!1){this.selectorMap=this.initSelectorMapAux(t,n,s)}clearSelectorMap(){this.selectorMap&&(this.mapRemove(this.selectorMap),this.selectorMap=null)}initMapsComplete(){this.updateMarkers(),Mr(100).pipe(pi(()=>{if(this.chronomap.mapView())this.mapFlyTo(this.baseMap,Jl.parseMapView(this.chronomap.mapView()));else{let t=-90,n=90,s=-180,h=180;this.chronomap.timelineItems().forEach(w=>{let F=Jl.parseMapView(w.geo).center;t=Math.max(t,F.lat),n=Math.min(n,F.lat),s=Math.max(s,F.lon),h=Math.min(h,F.lon)});let r=[[h,n],[s,t]];console.log("FIT BOUNDS",r),this.mapFitBounds(this.baseMap,r)}}),_a(0),pi(()=>{window.dispatchEvent(new Event("resize"))})).subscribe()}mapSyncMoveStart(t,n){if(!this.syncing){this.syncing=!0,this.lastMapState={center:n.center,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing};for(let s of this.maps)t!==s&&this.mapJumpTo(s,n);this.syncing=!1}}mapSyncMoveEnd(){Mr(1e3).subscribe(()=>{this.moveEnd.next()})}selectorMapOnMove(t){let s="https://labs.mapbox.com/location-helper/#"+[t.zoom,t.center?.lat,t.center?.lon,t?.bearing,t?.pitch].map(h=>Number.isFinite(h)?h?.toString():"").join("/");this.selectorMapMoved.next({geo:s,position:t})}updateMarkers(){this.markers.forEach(t=>{this.markerRemove(t)}),Mr(100).subscribe(()=>{let t=[{el:this.baseMarkersEl.nativeElement,map:this.baseMap},{el:this.detailMarkersEl.nativeElement,map:this.detailMap}];for(let n of t){let s=n.el.children;for(let h=0;h<s.length;h++){let r=s[h],w=this.chronomap.timelineItems()[h],F=Jl.parseMapView(w.geo).center,$=r.cloneNode(!0);$.addEventListener("click",()=>{console.log("CLICK",w.title),this.itemSelected.next(w)}),$.addEventListener("mouseenter",()=>{this.itemHovered.next(w)}),$.addEventListener("mouseleave",()=>{this.itemHovered.next(null)}),this.markers.push(this.markerCreate($,F,n.map))}}})}};var ss=fh(E5());(function(){var e={animate:!1,reset:!0,disableViewprereset:!0};L.Sync=function(){},L.Sync.offsetHelper=function(t,n){var s=L.Util.isArray(t)?t:[.5,.5],h=L.Util.isArray(n)?n:[.5,.5];return function(r,w,A,F){var $=A.getSize(),K=F.getSize(),se=A.project(r,w).subtract([(.5-s[0])*$.x,(.5-s[1])*$.y]).add([(.5-h[0])*K.x,(.5-h[1])*K.y]);return A.unproject(se,w)}},L.Map.include({sync:function(t,n){return this._initSync(),n=L.extend({noInitialSync:!1,syncCursor:!1,syncCursorMarkerOptions:{radius:10,fillOpacity:.3,color:"#da291c",fillColor:"#fff"},offsetFn:function(s,h,r,w){return s}},n),this._syncMaps.indexOf(t)===-1&&(this._syncMaps.push(t),this._syncOffsetFns[L.Util.stamp(t)]=n.offsetFn),n.noInitialSync||t.setView(n.offsetFn(this.getCenter(),this.getZoom(),this,t),this.getZoom(),e),n.syncCursor&&(typeof t.cursor>"u"&&(t.cursor=L.circleMarker([0,0],n.syncCursorMarkerOptions).addTo(t)),this._cursors.push(t.cursor),this.on("mousemove",this._cursorSyncMove,this),this.on("mouseout",this._cursorSyncOut,this)),this.on("resize zoomend",this._selfSetView),this.on("moveend",this._syncOnMoveend),this.on("dragend",this._syncOnDragend),this},unsync:function(t){var n=this;return this._cursors&&this._cursors.forEach(function(s,h,r){s===t.cursor&&r.splice(h,1)}),t.cursor&&t.cursor.setLatLng([0,0]),this._syncMaps&&this._syncMaps.forEach(function(s,h){t===s&&(delete n._syncOffsetFns[L.Util.stamp(t)],n._syncMaps.splice(h,1))}),(!this._syncMaps||this._syncMaps.length==0)&&(this.off("resize zoomend",this._selfSetView),this.off("moveend",this._syncOnMoveend),this.off("dragend",this._syncOnDragend)),this},isSynced:function(t){var n=this.hasOwnProperty("_syncMaps")&&Object.keys(this._syncMaps).length>0;return n&&t&&(n=!1,this._syncMaps.forEach(function(s){t==s&&(n=!0)})),n},_cursorSyncMove:function(t){this._cursors.forEach(function(n){n.setLatLng(t.latlng)})},_cursorSyncOut:function(t){this._cursors.forEach(function(n){n.setLatLng([0,0])})},_selfSetView:function(t){this.setView(this.getCenter(),this.getZoom(),e)},_syncOnMoveend:function(t){this._syncDragend&&(this._syncDragend=!1,this._selfSetView(t),this._syncMaps.forEach(function(n){n.fire("moveend")}))},_syncOnDragend:function(t){this._syncDragend=!0},_initSync:function(){if(!this._syncMaps){var t=this;this._syncMaps=[],this._cursors=[],this._syncOffsetFns={},L.extend(t,{setView:function(n,s,h,r){function w(F,$){var K=[],se=h&&h.disableViewprereset&&F&&F._events;se&&(K=F._events.viewprereset,F._events.viewprereset=[]);var le=$(F);return se&&(F._events.viewprereset=K),le}var A=w(this,function(F){return L.Map.prototype.setView.call(F,n,s,h)});return r||t._syncMaps.forEach(function(F){w(F,function($){return F.setView(t._syncOffsetFns[L.Util.stamp(F)](n,s,t,F),s,h,!0)})}),A},panBy:function(n,s,h){return h||t._syncMaps.forEach(function(r){r.panBy(n,s,!0)}),L.Map.prototype.panBy.call(this,n,s)},_onResize:function(n,s){return s||t._syncMaps.forEach(function(h){h._onResize(n,!0)}),L.Map.prototype._onResize.call(this,n)},_stop:function(n){L.Map.prototype._stop.call(this),n||t._syncMaps.forEach(function(s){s._stop(!0)})}}),t.dragging._draggable._updatePosition=function(){L.Draggable.prototype._updatePosition.call(this);var n=this;t._syncMaps.forEach(function(s){L.DomUtil.setPosition(s.dragging._draggable._element,n._newPos),s.eachLayer(function(h){if(h._google!==void 0){var r=t._syncOffsetFns[L.Util.stamp(s)],w=r(t.getCenter(),t.getZoom(),t,s);h._google.setCenter(w)}}),s.fire("move")})}}}})})();var pC=class extends r_{getBgLayer(){let t=this.chronomap.Map_BG(),n=this.chronomap.Map_BG_Bounds();if(!t||!n)return null;let s=n.split(",").map(parseFloat);return ss.imageOverlay(t,[[s[0],s[1]],[s[2],s[3]]])}makeMap(t){let n=ss.map(t,{crs:ss.CRS.Simple,maxBounds:[[-3,-3],[3,5]],center:[0,0],zoom:9,minZoom:9,maxZoom:12,zoomControl:!1,attributionControl:!1});return this.getBgLayer()?.addTo(n),this.layout.desktop()&&n.addControl(ss.control.zoom({position:"topleft"})),n}initMaps(){let t=0;this.baseMap=this.makeMap(this.baseMapEl.nativeElement),this.detailMap=this.makeMap(this.detailMapEl.nativeElement),ss.tileLayer(this.chronomap.mapStyle()).addTo(this.detailMap);let n=[this.baseMap,this.detailMap];return this.baseMap.whenReady(()=>{t+=1,t===2&&this.initMapsComplete()}),this.detailMap.whenReady(()=>{this.detailMap.on("move",()=>{let s=this.detailMap.getCenter();this.lastMapState={center:{lat:s.lat,lon:s.lng},zoom:this.detailMap.getZoom()}}),t+=1,t===2&&(console.log("SYNC MAPS"),this.baseMap.sync(this.detailMap),this.detailMap.sync(this.baseMap),this.initMapsComplete())}),n}mapResize(t){t.invalidateSize()}mapFlyTo(t,n){n=Object.assign({},{center:t.getCenter(),zoom:t.getZoom()},n),t.flyTo({lat:n.center?.lat||0,lng:n.center?.lon||0},n.zoom,n)}mapJumpTo(t,n){n=Object.assign({},{center:t.getCenter(),zoom:t.getZoom()},n),t.flyTo({lat:n.center?.lat||0,lng:n.center?.lon||0},n.zoom,{animate:!1,duration:0})}mapApplyLayers(t,n,s){}mapRemove(t){t.remove()}initSelectorMapAux(t,n,s){let h=new ss.Map(t,{crs:ss.CRS.Simple,center:[n.center?.lat||0,n.center?.lon||0],zoom:n.zoom||9,maxBounds:[[-3,-3],[3,5]],minZoom:9,maxZoom:12,attributionControl:!1,dragging:s,zoomControl:s});return Mr(100).subscribe(()=>{h.invalidateSize()}),this.getBgLayer()?.addTo(h),h.on("load",()=>{this.mapJumpTo(h,n)}),s&&(h.on("click",r=>{console.log("MARKER CLICK",r.latlng)}),h.on("moveend",()=>{let r=h.getCenter(),w={center:{lat:r.lat,lon:r.lng},zoom:h.getZoom()};this.selectorMapOnMove(w)})),h}mapFitBounds(t,n){let s=new ss.LatLngBounds(n[0],n[1]);t.fitBounds(s,{animate:!1,padding:[50,50]})}markerCreate(t,n,s){let h=ss.divIcon({html:t,iconSize:[t.offsetWidth,t.offsetHeight],className:"leaflet-marker"});return ss.marker([n.lat,n.lon],{icon:h}).addTo(s)}markerRemove(t){t.remove()}pauseSync(t){this.baseMap.unsync(this.detailMap),this.detailMap.unsync(this.baseMap),Mr(t*1e3).subscribe(()=>{this.baseMap.sync(this.detailMap,{noInitialSync:!0}),this.detailMap.sync(this.baseMap,{noInitialSync:!0})})}processFlyToOptions(t){if(t.padding?.right&&t.center&&t.zoom){let n={lat:t.center.lat,lng:t.center.lon},s=this.detailMap.project(n,t.zoom).add([t.padding.right/2,0]),h=this.detailMap.unproject(s,t.zoom);t.center={lat:h.lat,lon:h.lng}}}};var D6=fh(S6()),Ql=fh(P6()),CC=class extends r_{initMaps(){Ql.default.accessToken=this.chronomap.mapboxKey();let t=0;this.baseMap=new Ql.default.Map({container:this.baseMapEl.nativeElement,style:this.chronomap.backgroundMapStyle(),minZoom:3,attributionControl:!1,logoPosition:"bottom-right"}),this.baseMap.addControl(new Ql.default.AttributionControl({compact:!0}),"top-right"),this.baseMap.on("style.load",()=>{t+=1,t===2&&this.initMapsComplete()}),this.detailMap=new Ql.default.Map({container:this.detailMapEl.nativeElement,style:this.chronomap.mapStyle(),minZoom:3,attributionControl:!1,logoPosition:"bottom-right"});let n=[this.baseMap,this.detailMap];return this.layout.desktop()&&(this.baseMap.addControl(new Ql.default.NavigationControl,"top-left"),this.detailMap.addControl(new Ql.default.NavigationControl,"top-left")),this.detailMap.on("style.load",()=>{for(let s of this.maps)s.on("move",()=>{let h=s.getCenter(),r=s.getPadding(),w={center:{lat:h.lat,lon:h.lng},zoom:s.getZoom(),pitch:s.getPitch(),bearing:s.getBearing(),padding:{top:r.top||0,bottom:r.bottom||0,left:r.left||0,right:r.right||0}};this.mapSyncMoveStart(s,w)}),s.on("moveend",()=>{this.mapSyncMoveEnd()});t+=1,t===2&&this.initMapsComplete()}),n}mapResize(t){t.resize()}mapFlyTo(t,n){n=Object.assign({},{center:this.baseMap.getCenter(),zoom:this.baseMap.getZoom(),bearing:this.baseMap.getBearing(),pitch:this.baseMap.getPitch()},n),t.flyTo(n)}mapJumpTo(t,n){t.jumpTo(n)}mapApplyLayers(t,n,s){for(let h of n||[])t.getLayer(h)&&t.setLayoutProperty(h,"visibility","visible");for(let h of s||[])t.getLayer(h)&&t.setLayoutProperty(h,"visibility","none")}mapRemove(t){t.remove()}initSelectorMapAux(t,n,s){let h=new Ql.default.Map({container:t,style:this.chronomap.backgroundMapStyle(),minZoom:3,center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch,interactive:s});if(h.on("load",()=>{h.jumpTo(n)}),s){var r=new D6.default({accessToken:Ql.default.accessToken,marker:!1});h.addControl(r),h.addControl(new Ql.default.NavigationControl({visualizePitch:!0}),"top-left"),h.on("moveend",()=>{let w=h.getCenter(),A={center:{lat:w.lat,lon:w.lng},zoom:h.getZoom(),pitch:h.getPitch(),bearing:h.getBearing()};this.selectorMapOnMove(A)})}return h}mapFitBounds(t,n){let s=new Ql.default.LngLatBounds(n[0],n[1]);t.fitBounds(s,{animate:!1,padding:50})}markerCreate(t,n,s){return new Ql.default.Marker(t).setLngLat(n).addTo(s)}markerRemove(t){t.remove()}pauseSync(t){}processFlyToOptions(t){}};function O6(e,t,n){return n.mapboxKey()?new CC(e,t,n):new pC(e,t,n)}function Mie(e,t){if(e&1&&qt(0,"div",5),e&2){let n=nn();fn("background-color",n.chronomap.primaryColor())}}var A6=(()=>{class e{constructor(){this.visited=!1,this.bgColor="",this.altBgColor="",this.imgHeight="fit-content"}ngOnChanges(){this.visited=this.visited||this.breathing,this.breathing?(this.bgColor=this.chronomap.primaryColor(),this.altBgColor=this.chronomap.primaryColor()):(this.bgColor=this.visited?this.chronomap.secondaryColor():this.chronomap.primaryColor(),this.altBgColor=this.visited?this.chronomap.primaryColor():this.chronomap.secondaryColor())}updateHeight(n){let s=n.target;Mr(0).subscribe(()=>{let h=s.height/s.width*60+4;this.imgHeight=h+"px",console.log("IMG",s,s.height,"->",this.imgHeight)})}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-image-icon"]],inputs:{item:"item",breathing:"breathing",chronomap:"chronomap"},features:[Os],decls:5,vars:8,consts:[[1,"container"],[1,"bg"],[1,"img-container"],[3,"load","src"],[1,"breathing",3,"background-color"],[1,"breathing"]],template:function(s,h){s&1&&(ut(0,"div",0),qt(1,"div",1),ut(2,"div",2)(3,"img",3),Yn("load",function(w){return h.updateHeight(w)}),_t()(),Mi(4,Mie,1,2,"div",4),_t()),s&2&&(fn("background-color",h.altBgColor)("height",h.imgHeight),Qe(),fn("background-color",h.bgColor),Qe(2),jt("src",h.item.image,jo),Qe(),Ga(h.breathing?4:-1))},styles:[".container[_ngcontent-%COMP%]{width:64px;height:fit-content;position:relative;border-radius:2px;overflow:hidden}.container[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]{position:relative;width:100%;height:fit-content;z-index:1;padding:2px}.container[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:contain;width:100%;height:auto}.container[_ngcontent-%COMP%]   .breathing[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .bg[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#000;z-index:2}.container[_ngcontent-%COMP%]   .bg[_ngcontent-%COMP%]{z-index:0}.container[_ngcontent-%COMP%]   .breathing[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_breathing 1s infinite}.container[_ngcontent-%COMP%]:hover   .bg[_ngcontent-%COMP%]{display:none}@keyframes _ngcontent-%COMP%_breathing{0%{opacity:0}50%{opacity:.8}to{opacity:0}}"]})}}return e})();var yr=11102230246251565e-32,Yo=134217729,mv=(3+8*yr)*yr;function Hp(e,t,n,s,h){let r,w,A,F,$=t[0],K=s[0],se=0,le=0;K>$==K>-$?(r=$,$=t[++se]):(r=K,K=s[++le]);let ae=0;if(se<e&&le<n)for(K>$==K>-$?(w=$+r,A=r-(w-$),$=t[++se]):(w=K+r,A=r-(w-K),K=s[++le]),r=w,A!==0&&(h[ae++]=A);se<e&&le<n;)K>$==K>-$?(w=r+$,F=w-r,A=r-(w-F)+($-F),$=t[++se]):(w=r+K,F=w-r,A=r-(w-F)+(K-F),K=s[++le]),r=w,A!==0&&(h[ae++]=A);for(;se<e;)w=r+$,F=w-r,A=r-(w-F)+($-F),$=t[++se],r=w,A!==0&&(h[ae++]=A);for(;le<n;)w=r+K,F=w-r,A=r-(w-F)+(K-F),K=s[++le],r=w,A!==0&&(h[ae++]=A);return(r!==0||ae===0)&&(h[ae++]=r),ae}function gv(e,t){let n=t[0];for(let s=1;s<e;s++)n+=t[s];return n}function Kt(e){return new Float64Array(e)}var Eie=(3+16*yr)*yr,Sie=(2+12*yr)*yr,Iie=(9+64*yr)*yr*yr,l_=Kt(4),R6=Kt(8),k6=Kt(12),L6=Kt(16),Pa=Kt(4);function Pie(e,t,n,s,h,r,w){let A,F,$,K,se,le,ae,Ze,Ue,ft,Xe,st,Ut,Bt,xt,yt,rn,Dt,Tt=e-h,ri=n-h,er=t-r,ln=s-r;Bt=Tt*ln,le=Yo*Tt,ae=le-(le-Tt),Ze=Tt-ae,le=Yo*ln,Ue=le-(le-ln),ft=ln-Ue,xt=Ze*ft-(Bt-ae*Ue-Ze*Ue-ae*ft),yt=er*ri,le=Yo*er,ae=le-(le-er),Ze=er-ae,le=Yo*ri,Ue=le-(le-ri),ft=ri-Ue,rn=Ze*ft-(yt-ae*Ue-Ze*Ue-ae*ft),Xe=xt-rn,se=xt-Xe,l_[0]=xt-(Xe+se)+(se-rn),st=Bt+Xe,se=st-Bt,Ut=Bt-(st-se)+(Xe-se),Xe=Ut-yt,se=Ut-Xe,l_[1]=Ut-(Xe+se)+(se-yt),Dt=st+Xe,se=Dt-st,l_[2]=st-(Dt-se)+(Xe-se),l_[3]=Dt;let Mt=gv(4,l_),je=Sie*w;if(Mt>=je||-Mt>=je||(se=e-Tt,A=e-(Tt+se)+(se-h),se=n-ri,$=n-(ri+se)+(se-h),se=t-er,F=t-(er+se)+(se-r),se=s-ln,K=s-(ln+se)+(se-r),A===0&&F===0&&$===0&&K===0)||(je=Iie*w+mv*Math.abs(Mt),Mt+=Tt*K+ln*A-(er*$+ri*F),Mt>=je||-Mt>=je))return Mt;Bt=A*ln,le=Yo*A,ae=le-(le-A),Ze=A-ae,le=Yo*ln,Ue=le-(le-ln),ft=ln-Ue,xt=Ze*ft-(Bt-ae*Ue-Ze*Ue-ae*ft),yt=F*ri,le=Yo*F,ae=le-(le-F),Ze=F-ae,le=Yo*ri,Ue=le-(le-ri),ft=ri-Ue,rn=Ze*ft-(yt-ae*Ue-Ze*Ue-ae*ft),Xe=xt-rn,se=xt-Xe,Pa[0]=xt-(Xe+se)+(se-rn),st=Bt+Xe,se=st-Bt,Ut=Bt-(st-se)+(Xe-se),Xe=Ut-yt,se=Ut-Xe,Pa[1]=Ut-(Xe+se)+(se-yt),Dt=st+Xe,se=Dt-st,Pa[2]=st-(Dt-se)+(Xe-se),Pa[3]=Dt;let At=Hp(4,l_,4,Pa,R6);Bt=Tt*K,le=Yo*Tt,ae=le-(le-Tt),Ze=Tt-ae,le=Yo*K,Ue=le-(le-K),ft=K-Ue,xt=Ze*ft-(Bt-ae*Ue-Ze*Ue-ae*ft),yt=er*$,le=Yo*er,ae=le-(le-er),Ze=er-ae,le=Yo*$,Ue=le-(le-$),ft=$-Ue,rn=Ze*ft-(yt-ae*Ue-Ze*Ue-ae*ft),Xe=xt-rn,se=xt-Xe,Pa[0]=xt-(Xe+se)+(se-rn),st=Bt+Xe,se=st-Bt,Ut=Bt-(st-se)+(Xe-se),Xe=Ut-yt,se=Ut-Xe,Pa[1]=Ut-(Xe+se)+(se-yt),Dt=st+Xe,se=Dt-st,Pa[2]=st-(Dt-se)+(Xe-se),Pa[3]=Dt;let Ke=Hp(At,R6,4,Pa,k6);Bt=A*K,le=Yo*A,ae=le-(le-A),Ze=A-ae,le=Yo*K,Ue=le-(le-K),ft=K-Ue,xt=Ze*ft-(Bt-ae*Ue-Ze*Ue-ae*ft),yt=F*$,le=Yo*F,ae=le-(le-F),Ze=F-ae,le=Yo*$,Ue=le-(le-$),ft=$-Ue,rn=Ze*ft-(yt-ae*Ue-Ze*Ue-ae*ft),Xe=xt-rn,se=xt-Xe,Pa[0]=xt-(Xe+se)+(se-rn),st=Bt+Xe,se=st-Bt,Ut=Bt-(st-se)+(Xe-se),Xe=Ut-yt,se=Ut-Xe,Pa[1]=Ut-(Xe+se)+(se-yt),Dt=st+Xe,se=Dt-st,Pa[2]=st-(Dt-se)+(Xe-se),Pa[3]=Dt;let mt=Hp(Ke,k6,4,Pa,L6);return L6[mt-1]}function SP(e,t,n,s,h,r){let w=(t-r)*(n-h),A=(e-h)*(s-r),F=w-A,$=Math.abs(w+A);return Math.abs(F)>=Eie*$?F:-Pie(e,t,n,s,h,r,$)}var mCe=(7+56*yr)*yr,gCe=(3+28*yr)*yr,_Ce=(26+288*yr)*yr*yr,yCe=Kt(4),vCe=Kt(4),xCe=Kt(4),bCe=Kt(4),wCe=Kt(4),CCe=Kt(4),MCe=Kt(4),TCe=Kt(4),ECe=Kt(4),SCe=Kt(8),ICe=Kt(8),PCe=Kt(8),DCe=Kt(4),OCe=Kt(8),ACe=Kt(8),RCe=Kt(8),kCe=Kt(12),LCe=Kt(192),FCe=Kt(192);var BCe=(10+96*yr)*yr,VCe=(4+48*yr)*yr,jCe=(44+576*yr)*yr*yr,UCe=Kt(4),HCe=Kt(4),$Ce=Kt(4),GCe=Kt(4),qCe=Kt(4),ZCe=Kt(4),WCe=Kt(4),YCe=Kt(4),XCe=Kt(8),KCe=Kt(8),JCe=Kt(8),QCe=Kt(8),eMe=Kt(8),tMe=Kt(8),nMe=Kt(8),iMe=Kt(8),rMe=Kt(8),oMe=Kt(4),sMe=Kt(4),aMe=Kt(4),lMe=Kt(8),cMe=Kt(16),uMe=Kt(16),hMe=Kt(16),dMe=Kt(32),fMe=Kt(32),pMe=Kt(48),mMe=Kt(64),gMe=Kt(1152),_Me=Kt(1152);var bMe=(16+224*yr)*yr,wMe=(5+72*yr)*yr,CMe=(71+1408*yr)*yr*yr,MMe=Kt(4),TMe=Kt(4),EMe=Kt(4),SMe=Kt(4),IMe=Kt(4),PMe=Kt(4),DMe=Kt(4),OMe=Kt(4),AMe=Kt(4),RMe=Kt(4),kMe=Kt(24),LMe=Kt(24),FMe=Kt(24),NMe=Kt(24),zMe=Kt(24),BMe=Kt(24),VMe=Kt(24),jMe=Kt(24),UMe=Kt(24),HMe=Kt(24),$Me=Kt(1152),GMe=Kt(1152),qMe=Kt(1152),ZMe=Kt(1152),WMe=Kt(1152),YMe=Kt(2304),XMe=Kt(2304),KMe=Kt(3456),JMe=Kt(5760),QMe=Kt(8),eTe=Kt(8),tTe=Kt(8),nTe=Kt(16),iTe=Kt(24),rTe=Kt(48),oTe=Kt(48),sTe=Kt(96),aTe=Kt(192),lTe=Kt(384),cTe=Kt(384),uTe=Kt(384),hTe=Kt(768);var dTe=Kt(96),fTe=Kt(96),pTe=Kt(96),mTe=Kt(1152);function N6(e,t){var n,s,h=0,r,w,A,F,$,K,se,le=e[0],ae=e[1],Ze=t.length;for(n=0;n<Ze;n++){s=0;var Ue=t[n],ft=Ue.length-1;if(K=Ue[0],K[0]!==Ue[ft][0]&&K[1]!==Ue[ft][1])throw new Error("First and last coordinates in a ring must be the same");for(w=K[0]-le,A=K[1]-ae,s;s<ft;s++){if(se=Ue[s+1],F=se[0]-le,$=se[1]-ae,A===0&&$===0){if(F<=0&&w>=0||w<=0&&F>=0)return 0}else if($>=0&&A<=0||$<=0&&A>=0){if(r=SP(w,F,A,$,0,0),r===0)return 0;(r>0&&$>0&&A<=0||r<0&&$<=0&&A>0)&&h++}K=se,A=$,w=F}}return h%2!==0}var Tl=63710088e-1,OTe={centimeters:Tl*100,centimetres:Tl*100,degrees:360/(2*Math.PI),feet:Tl*3.28084,inches:Tl*39.37,kilometers:Tl/1e3,kilometres:Tl/1e3,meters:Tl,metres:Tl,miles:Tl/1609.344,millimeters:Tl*1e3,millimetres:Tl*1e3,nauticalmiles:Tl/1852,radians:1,yards:Tl*1.0936};function B6(e,t,n={}){let s={type:"Feature"};return(n.id===0||n.id)&&(s.id=n.id),n.bbox&&(s.bbox=n.bbox),s.properties=t||{},s.geometry=e,s}function V6(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!z6(e[0])||!z6(e[1]))throw new Error("coordinates must contain numbers");return B6({type:"Point",coordinates:e},t,n)}function j6(e,t,n={}){for(let h of e){if(h.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(h[h.length-1].length!==h[0].length)throw new Error("First and last Position are not equivalent.");for(let r=0;r<h[h.length-1].length;r++)if(h[h.length-1][r]!==h[0][r])throw new Error("First and last Position are not equivalent.")}return B6({type:"Polygon",coordinates:e},t,n)}function z6(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function U6(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return[...e.geometry.coordinates];if(e.type==="Point")return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function H6(e){return e.type==="Feature"?e.geometry:e}function Oie(e,t,n={}){if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");let s=U6(e),h=H6(t),r=h.type,w=t.bbox,A=h.coordinates;if(w&&Aie(s,w)===!1)return!1;r==="Polygon"&&(A=[A]);let F=!1;for(var $=0;$<A.length;++$){let K=N6(s,A[$]);if(K===0)return!n.ignoreBoundary;K&&(F=!0)}return F}function Aie(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}var $6=Oie;var Rie=["mapEl"],MC=class IP{constructor(t,n){this.mapSelector=t,this.el=n}ngAfterViewInit(){this.chronomap.ready.subscribe(()=>{console.log("IIIII",this.mapEl.nativeElement,this.position),this.mapHandler.initSelectorMap(this.mapEl.nativeElement,this.position,!0),this.mapHandler.selectorMapMoved.pipe(na(this)).subscribe(t=>{let n={geo:t.geo},s=this.chronomap.HotSpotsGeoJson();if(console.log("GEOJSON",s),console.log("CENTER",t.position.center),t.position.center&&s){let h=V6([t.position.center.lon,t.position.center.lat]),r=s.features.filter(w=>$6(h,j6(w.geometry.coordinates)));Object.assign(n,...r.map(w=>w.properties))}console.log("SELECTED MAP",n),this.mapSelector.submitMapResult(n)})}),this.resizeObserver?.disconnect(),this.resizeObserver=new ResizeObserver(()=>{Mr(0).subscribe(()=>{this.mapHandler.resize()})}),this.resizeObserver.observe(this.el.nativeElement)}ngOnDestroy(){this.resizeObserver?.disconnect(),this.mapHandler.clearSelectorMap()}static{this.\u0275fac=function(n){return new(n||IP)(Fn(cf),Fn(Po))}}static{this.\u0275cmp=Ci({type:IP,selectors:[["app-map-selector"]],viewQuery:function(n,s){if(n&1&&Lr(Rie,7),n&2){let h;Dr(h=Or())&&(s.mapEl=h.first)}},inputs:{chronomap:"chronomap",mapHandler:"mapHandler",position:"position"},standalone:!1,decls:5,vars:0,consts:[["mapEl",""],[1,"map"],[1,"container"],[1,"crosshair"]],template:function(n,s){n&1&&(ut(0,"div",1)(1,"div",2),qt(2,"div",null,0),_t(),qt(4,"div",3),_t())},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{display:block;position:relative;width:100%;height:100%;background-color:#fff;z-index:1}[_nghost-%COMP%]   .map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}[_nghost-%COMP%]   .map[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .map[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .map[_ngcontent-%COMP%]   .crosshair[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-repeat:no-repeat;background-position:center;background-size:contain;width:80px;height:80px;background-size:80px;background-image:url("./media/crosshair-RMTMU5ME.svg")}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]{position:absolute;bottom:24px;right:24px;z-index:10;display:flex;flex-flow:row;align-items:center;gap:32px}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;padding:8px 24px;height:40px;background:#ffffff80;border:1px solid rgba(252,13,28,.25);border-radius:24px;font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#ce0031;cursor:pointer}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{color:#333;border-color:#333}']})}};MC=Hl([Kl()],MC);var Lie=["mapEl"],G6=(()=>{class e{constructor(n){this.mapSelector=n,this.date=Ln(new Date),this.includeTime=Ln(!1),bl(()=>{if(console.log("SELECTED DATE",this.date().toISOString()),this.includeTime()){let s=this.date();s.setSeconds(0),s.setMilliseconds(0);let h=this.date().toISOString(),r=this.date().toLocaleString();r=r.substring(0,r.length-3),this.mapSelector.submitTimelineResult(h,r)}else{let s=this.date().toISOString().split("T")[0],h=this.date().toLocaleDateString();this.mapSelector.submitTimelineResult(s,h)}})}ngOnInit(){let n=this.chronomap.minDate(),s=this.chronomap.maxDate(),h=s.getTime()-n.getTime()+1e3*60*60*24;this.minDate=new Date(n.getTime()-h),this.maxDate=new Date(s.getTime()+h)}ngAfterViewInit(){this.chronomap.ready.subscribe(()=>{console.log("ININININI1",this.mapEl.nativeElement,this.position),this.mapHandler.initSelectorMap(this.mapEl.nativeElement,this.position)})}static{this.\u0275fac=function(s){return new(s||e)(Fn(cf))}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-timeline-selector"]],viewQuery:function(s,h){if(s&1&&Lr(Lie,7),s&2){let r;Dr(r=Or())&&(h.mapEl=r.first)}},inputs:{chronomap:"chronomap",mapHandler:"mapHandler",position:"position"},standalone:!1,decls:9,vars:10,consts:[["mapEl",""],[1,"map"],[1,"container"],[1,"date-display"],[1,"date"],["xmlns","http://www.w3.org/2000/svg","width","7","height","151","viewBox","0 0 7 151","fill","none"],["d","M3.5 150.667C4.97276 150.667 6.16667 149.473 6.16667 148C6.16667 146.527 4.97276 145.333 3.5 145.333C2.02724 145.333 0.833333 146.527 0.833333 148C0.833333 149.473 2.02724 150.667 3.5 150.667ZM4 148L4 147L3 147L3 148L4 148ZM4 145L4 143L3 143L3 145L4 145ZM4 141L4 139L3 139L3 141L4 141ZM4 137L4 135L3 135L3 137L4 137ZM4 133L4 131L3 131L3 133L4 133ZM4 129L4 127L3 127L3 129L4 129ZM4 125L4 123L3 123L3 125L4 125ZM4 121L4 119L3 119L3 121L4 121ZM4 117L4 115L3 115L3 117L4 117ZM4 113L4 111L3 111L3 113L4 113ZM4 109L4 107L3 107L3 109L4 109ZM4 105L4 103L3 103L3 105L4 105ZM4 101L4 99L3 99L3 101L4 101ZM4 97L4 95L3 95L3 97L4 97ZM4 93L4 91L3 91L3 93L4 93ZM4 89L4 87L3 87L3 89L4 89ZM4 85L4 83L3 83L3 85L4 85ZM4 81L4 79L3 79L3 81L4 81ZM4 77L4 75L3 75L3 77L4 77ZM4 73L4 71L3 71L3 73L4 73ZM4 69L4 67L3 67L3 69L4 69ZM4 65L4 63L3 63L3 65L4 65ZM4 61L4 59L3 59L3 61L4 61ZM4 57L4 55L3 55L3 57L4 57ZM4 53L4 51L3 51L3 53L4 53ZM4 49L4 47L3 47L3 49L4 49ZM4 45L4 43L3 43L3 45L4 45ZM4 41L4 39L3 39L3 41L4 41ZM4 37L4 35L3 35L3 37L4 37ZM4.00001 33L4.00001 31L3.00001 31L3.00001 33L4.00001 33ZM4.00001 29L4.00001 27L3.00001 27L3.00001 29L4.00001 29ZM4.00001 25L4.00001 23L3.00001 23L3.00001 25L4.00001 25ZM4.00001 21L4.00001 19L3.00001 19L3.00001 21L4.00001 21ZM4.00001 17L4.00001 15L3.00001 15L3.00001 17L4.00001 17ZM4.00001 13L4.00001 11L3.00001 11L3.00001 13L4.00001 13ZM4.00001 9L4.00001 7L3.00001 7L3.00001 9L4.00001 9ZM4.00001 5L4.00001 3L3.00001 3L3.00001 5L4.00001 5ZM4.00001 1L4.00001 2.18557e-08L3.00001 -2.18557e-08L3.00001 1L4.00001 1Z"],[3,"minDate","maxDate","chronomap","date","includeTime","limitless"]],template:function(s,h){s&1&&(ut(0,"div",1),qt(1,"div",2,0),_t(),ut(3,"div",3)(4,"div",4),xn(5),_t(),Vo(),ut(6,"svg",5),qt(7,"path",6),_t()(),Wl(),qt(8,"app-time-line",7)),s&2&&(Qe(4),fn("background-color",h.chronomap.primaryColor()),Qe(),rr(h.mapSelector.selectedDate),Qe(2),xr("fill",h.chronomap.primaryColor()),Qe(),jt("minDate",h.minDate)("maxDate",h.maxDate)("chronomap",h.chronomap)("date",h.date)("includeTime",h.includeTime)("limitless",!0))},dependencies:[i_],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{display:flex;position:relative;width:100%;height:100%;flex-flow:column;align-items:center}[_nghost-%COMP%]   .map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}[_nghost-%COMP%]   .map[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   app-time-line[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}[_nghost-%COMP%]   .date-display[_ngcontent-%COMP%]{position:absolute;bottom:12px;z-index:1;pointer-events:none;display:flex;flex-flow:column;align-items:center}[_nghost-%COMP%]   .date-display[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;color:#fff;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:18px;font-weight:600;line-height:23px;letter-spacing:.18px}']})}}return e})();var _v=class{constructor(){this.visible$=new Ii,this.detected=this.visible$.pipe(Ad()),this.visible$.next(!1)}initVisibilityDetector(t,n,s){let h={active:"0% -50% 0% -50%",visible:"100% 0% 100% 0%"}[s],r={root:n,rootMargin:h,threshold:0};this.observer=new IntersectionObserver(w=>{this.visible$.next(w[0].isIntersecting)},r),this.observer.observe(t)}};var TC=class{constructor(t,n){this.url=t,this.playerService=n,this.subscriptions=[],this.playing=new po(!1),this.ready=new po(!1),this.hiResTimestamp=new po(0),this.textTimestamp=new po("-00:00"),this.position=new po(0),this.ended=new Ii,this.audio=new Audio(t),bo(this.audio,"canplaythrough").pipe(mo()).subscribe(()=>{this.ready.next(!0),this.updateTextTimestamp()}),this.subscriptions.push(bo(this.audio,"play").subscribe(()=>{this.playing.next(!0)}),bo(this.audio,"pause").subscribe(()=>{this.playing.next(!1)}),bo(this.audio,"ended").subscribe(()=>{this.ended.next(null),this.playing.next(!1),this.audio&&(this.audio.currentTime=0)}),bo(this.audio,"timeupdate").pipe(ti(()=>{if(this.audio!==null){let s=Math.floor(this.audio.currentTime*10),h=this.hiResTimestamp.getValue();if(s!==h)if(h<s&&s-h<20)for(let w=h+1;w<=s;w++)this.hiResTimestamp.next(w);else this.hiResTimestamp.next(s);let r=Math.floor(this.audio.currentTime);return this.updateTextTimestamp(),Math.round(this.audio.currentTime/this.audio.duration*1e3)}return 0}),Ad()).subscribe(s=>{this.position.next(s)})),this.playing.next(!1),this.audio.load()}seek(t){this.audio&&(this.audio.currentTime=this.audio.duration*t)}seekTime(t){return this.ready.pipe(io(n=>n),mo(),pi(()=>{this.audio!==null&&(this.audio.currentTime=t)})).toPromise()}play(){this.playing.getValue()||this.ready.pipe(io(t=>t),mo()).subscribe(()=>{this.audio&&this.audio.play().then(()=>{this.playerService.playing(this)}).catch(()=>{console.log("FAILED TO PLAY...")})})}pause(){this.playing.getValue()&&this.audio&&(this.audio.pause(),this.playerService.stopped(this))}toggle(){this.playing.getValue()?this.pause():this.play()}cleanup(){for(this.audio!==null&&(this.pause(),this.audio.remove(),this.audio=null);this.subscriptions.length>0;)this.subscriptions.shift()?.unsubscribe()}updateTextTimestamp(){if(!this.audio||!Number.isFinite(this.audio.duration))return;let t=Math.floor(this.audio.duration-this.audio.currentTime),n=""+t%60;n.length<2&&(n="0"+n),n=Math.floor(t/60)+":"+n,n.length<5&&(n="0"+n),n="-"+n,n!==this.textTimestamp.getValue()&&this.textTimestamp.next(n)}};var q6=(()=>{class e{constructor(){this.current=null,this.clock=new ga(1),this.clockSub=null,this.playingSub=null,this.isPlaying=new po(!1),this.last=null,bo(window,"keyup").subscribe(n=>{n.code==="Space"&&(this.current!==null?this.current.toggle():this.last!==null&&(this.last.toggle(),this.last=null))})}playing(n){this.current!==n&&(this.current!==null&&this.current.pause(),this.current=n,this.clockSub&&this.clockSub.unsubscribe(),this.clockSub=n.textTimestamp.subscribe(s=>{this.clock.next(s)}),this.playingSub&&this.playingSub.unsubscribe(),this.playingSub=n.playing.subscribe(s=>{this.isPlaying.next(s)}))}stopped(n){this.current===n&&(this.last=n,this.current=null,this.isPlaying.next(!1),this.clockSub&&(this.clockSub.unsubscribe(),this.clockSub=null),this.playingSub&&(this.playingSub.unsubscribe(),this.playingSub=null))}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=wn({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var zie=["handle"],Bie=["component"];function Vie(e,t){e&1&&qt(0,"img",12)}function jie(e,t){e&1&&qt(0,"img",13)}function Uie(e,t){if(e&1){let n=Pr();Du(0),ut(1,"div",8,1),Yn("mousedown",function(){Hi(n);let h=nn();return $i(h.drag())}),_t(),Mi(3,Vie,1,0,"img",9),Bb(4,"async"),Mi(5,jie,1,0,"img",10),Bb(6,"async"),ut(7,"span",11),xn(8),Bb(9,"async"),_t(),Ou()}if(e&2){let n=nn();Qe(),fn("left",n.handleX+"px")("top",n.handleY+"px")("background",n.color),Qe(2),jt("ngIf",Vb(4,9,n.player.playing)),Qe(2),jt("ngIf",!Vb(6,11,n.player.playing)),Qe(3),rr(Vb(9,13,n.player.textTimestamp))}}var EC=(()=>{class e{constructor(n,s){this.playerService=n,this.el=s,this.size=280,this.PADDING=2,this.BAR_WIDTH=4,this.player=null,this.progressBarPath=""}ngOnInit(){}ngAfterViewInit(){}drag(){let n=this.component.nativeElement.getBoundingClientRect();bo(window,"mousemove").pipe(sp(bo(window,"mouseup")),pi(s=>{let h=s,r=h.clientX-n.left-this.size/2,w=h.clientY-n.top-this.size/2,A=Math.atan(w/r)+Math.PI/2+(r<0?Math.PI:0);this.player?.seek(A/2/Math.PI)}),kd(1)).subscribe(s=>{})}click(n){if(!this.player)return!1;let s=n.offsetX-this.size/2,h=n.offsetY-this.size/2,r=Math.atan(h/s)+Math.PI/2+(s<0?Math.PI:0),w=Math.sqrt(s*s+h*h);return Math.abs(w-this.size/2)<10?this.player.seek(r/2/Math.PI):w<this.size/2&&this.player.toggle(),!0}createPlayer(){this.audio&&(this.player=new TC(this.audio,this.playerService),this.positionSub=this.player.position.subscribe(n=>{this.calculateProgressBarPath(n/1e3*2*Math.PI)}))}cleanupPlayer(){this.player!==null&&(this.player.cleanup(),this.positionSub.unsubscribe(),this.player=null,this.progressBarPath="")}ngOnChanges(){this.cleanupPlayer(),this.createPlayer()}ngOnDestroy(){this.cleanupPlayer()}calculateProgressBarPath(n){let s=this.size/2,h=(this.size-this.BAR_WIDTH)/2,r=s+h*Math.sin(n),w=s-h*Math.cos(n),A=n>=Math.PI?"1 1":"0 1";this.progressBarPath=`M${s} ${s-h} A ${h} ${h} 0 ${A} ${r} ${w}`,this.handleX=r,this.handleY=w}static{this.\u0275fac=function(s){return new(s||e)(Fn(q6),Fn(Po))}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-audio-player"]],viewQuery:function(s,h){if(s&1&&(Lr(zie,7),Lr(Bie,7)),s&2){let r;Dr(r=Or())&&(h.handle=r.first),Dr(r=Or())&&(h.component=r.first)}},inputs:{audio:"audio",image:"image",color:"color",size:"size"},standalone:!1,features:[Os],decls:7,vars:16,consts:[["component",""],["handle",""],[1,"wrapper"],[1,"component"],["viewport","0 0 280 280",3,"click"],["stroke","#dedede","stroke-width","4","fill","none"],["stroke-width","4","fill","none"],[4,"ngIf"],[1,"handle",3,"mousedown"],["src","assets/img/player-control-pause.svg",4,"ngIf"],["src","assets/img/player-control-play.svg",4,"ngIf"],[1,"timestamp"],["src","assets/img/player-control-pause.svg"],["src","assets/img/player-control-play.svg"]],template:function(s,h){if(s&1){let r=Pr();ut(0,"div",2)(1,"div",3),Vo(),ut(2,"svg",4,0),Yn("click",function(A){return Hi(r),$i(h.click(A))}),qt(4,"circle",5)(5,"path",6),_t(),Mi(6,Uie,10,15,"ng-container",7),_t()()}s&2&&(fn("width",h.size+4+"px")("height",h.size+4+"px")("padding","2px"),Qe(),fn("background-image","url("+h.image+")")("border-radius",h.size/2+"px"),Qe(3),xr("cx",h.size/2)("cy",h.size/2)("r",h.size/2-2),Qe(),xr("d",h.progressBarPath)("stroke",h.color),Qe(),jt("ngIf",h.player))},dependencies:[xs,UF],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{display:flex;flex-flow:column;align-items:center;position:relative}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column;align-items:center;justify-content:center;background-repeat:no-repeat;background-position:center;background-size:cover;position:relative;cursor:pointer;overflow:visible}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60px;height:60px}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:100%;width:100%;overflow:visible}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:6px;border:2px solid white;background:#0ab239;transform:translate(-50%) translateY(-50%);position:absolute;pointer-events:all;z-index:1}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;color:#fff;display:block;line-height:16px;text-shadow:0px 0px 6px #000000;height:0px}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-weight:700;font-size:16px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-weight:400;font-size:12px}}']})}}return e})();function $ie(e,t){if(e&1){let n=Pr();ut(0,"a",6),Yn("mouseover",function(){Hi(n);let h=nn(2);return $i(h.linkHover=!0)})("mouseleave",function(){Hi(n);let h=nn(2);return $i(h.linkHover=!1)}),xn(1),_t()}if(e&2){let n=nn(2);fn("color",n.chronomap.primaryColor()),jt("href",n.item.link_domain,jo),Qe(),rr(n.item.link_title)}}function Gie(e,t){if(e&1){let n=Pr();ut(0,"a",7),Yn("mouseover",function(){Hi(n);let h=nn(2);return $i(h.linkHover=!0)})("mouseleave",function(){Hi(n);let h=nn(2);return $i(h.linkHover=!1)}),xn(1),_t()}if(e&2){let n=nn(2);fn("background-color",n.chronomap.primaryColor()),jt("href",n.item.link_domain,jo),Qe(),rr(n.item.link_title)}}function qie(e,t){if(e&1&&(ut(0,"div",2)(1,"div",3),Mi(2,$ie,2,4,"a",4)(3,Gie,2,4,"a",5),_t()()),e&2){let n=nn();Qe(2),jt("ngIf",!n.linkHover),Qe(),jt("ngIf",n.linkHover)}}var Z6=(()=>{class e{constructor(){this.linkHover=!1}ngOnInit(){}ngOnChanges(){this.update()}ngAfterViewInit(){this.update()}update(){this.player&&this.player.player&&(this.activeItem===this.item?this.player.player.play():this.player.player.pause())}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-content-audio"]],viewQuery:function(s,h){if(s&1&&Lr(EC,7),s&2){let r;Dr(r=Or())&&(h.player=r.first)}},inputs:{item:"item",activeItem:"activeItem",chronomap:"chronomap"},standalone:!1,features:[Os],decls:3,vars:4,consts:[[3,"audio","image","color"],["class","link",4,"ngIf"],[1,"link"],[1,"link-container"],["target","blank","class","link-title",3,"href","color","mouseover","mouseleave",4,"ngIf"],["target","blank","class","link-title hover",3,"href","background-color","mouseover","mouseleave",4,"ngIf"],["target","blank",1,"link-title",3,"mouseover","mouseleave","href"],["target","blank",1,"link-title","hover",3,"mouseover","mouseleave","href"]],template:function(s,h){s&1&&(ut(0,"div"),qt(1,"app-audio-player",0),Mi(2,qie,4,2,"div",1),_t()),s&2&&(Qe(),jt("audio",h.item.audio)("image",h.item.image)("color",h.chronomap.primaryColor()),Qe(),jt("ngIf",h.item.link_title))},dependencies:[xs,EC],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{margin-top:auto;margin-bottom:auto}@media only screen and (min-width: 1000px){app-player[_ngcontent-%COMP%]{align-items:flex-start}}.link-container[_ngcontent-%COMP%]{z-index:1;position:relative;bottom:70px;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;text-transform:uppercase;font-size:14px;font-weight:700;text-align:center}.link-container[_ngcontent-%COMP%]   a.link-title[_ngcontent-%COMP%]{padding:4px 16px;border-radius:16px;text-decoration:none;background:#fff}.link-container[_ngcontent-%COMP%]   a.link-title.hover[_ngcontent-%COMP%]{background:#ce0031;color:#fff}']})}}return e})();var Wie=["frame"],W6=(()=>{class e{constructor(n,s,h){this.sanitizer=n,this.http=s,this.el=h,this.playerReady=new ga(1),this.initialize=new Ii,this.initialize.pipe(Vr(()=>this.http.get("https://www.youtube.com/oembed",{params:{url:this.item.youtube_video_id,format:"json"}})),pi(()=>{this.frame.nativeElement.innerHTML=""}),_a(0)).subscribe(r=>{let w=this.el.nativeElement,A=Math.min(w.offsetWidth,640),F=A*3/4;console.log("INIT YOUTUBE",this.frame.nativeElement,this.item.youtube_video_id,A,this.el.nativeElement.offsetWidth);let $=r.html||"",K=$.indexOf('src="');if(K!==-1){let se=new URL($.slice(K).split('"')[1]),le=se.pathname.split("/").pop(),ae=parseInt(se.searchParams.get("start")||"0",10),Ze=this.frame.nativeElement;this.player=new YT.Player(Ze.appendChild(document.createElement("div")),{videoId:le,height:F+"px",width:A+"px",events:{onReady:()=>{this.playerReady.next(),this.playerReady.complete()}},playerVars:{enablejsapi:1,start:ae}})}})}ngOnInit(){}ngOnChanges(){let n=this.activeItem===this.item;n?this.playerReady.pipe(mo()).subscribe(()=>{n&&this.player?.getPlayerState&&this.player.getPlayerState()!==YT.PlayerState.PLAYING&&this.player.playVideo()}):this.playerReady.pipe(mo()).subscribe(()=>{!n&&this.player?.getPlayerState&&this.player.getPlayerState()!==YT.PlayerState.PAUSED&&this.player.getPlayerState()!==YT.PlayerState.ENDED&&this.player.pauseVideo()})}ngAfterViewInit(){this.resizeObserver?.disconnect(),this.resizeObserver=new ResizeObserver(n=>{console.log("RESIZE",this.item.youtube_video_id,n),this.initialize.next()}),this.resizeObserver.observe(this.el.nativeElement)}ngOnDestroy(){this.resizeObserver?.disconnect()}static{this.\u0275fac=function(s){return new(s||e)(Fn(zc),Fn(d0),Fn(Po))}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-content-video"]],viewQuery:function(s,h){if(s&1&&Lr(Wie,7),s&2){let r;Dr(r=Or())&&(h.frame=r.first)}},inputs:{item:"item",activeItem:"activeItem",chronomap:"chronomap"},standalone:!1,features:[Os],decls:2,vars:0,consts:[["frame",""]],template:function(s,h){s&1&&qt(0,"div",null,0)},styles:["[_nghost-%COMP%] > div[_ngcontent-%COMP%]{display:flex;flex-flow:row;justify-content:center}"]})}}return e})();var Y6=(()=>{class e{constructor(){}ngOnInit(){}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-content-image"]],inputs:{item:"item",chronomap:"chronomap"},standalone:!1,decls:1,vars:1,consts:[[3,"src"]],template:function(s,h){s&1&&qt(0,"img",0),s&2&&jt("src",h.item.image,jo)},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:auto;display:flex;flex-flow:column;align-items:center;padding-bottom:8px}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{object-fit:contain;max-width:100%;max-height:100vh}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   img[_ngcontent-%COMP%]{object-position:left;max-width:min(600px,100%);max-height:75vh}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   img[_ngcontent-%COMP%]{width:100%;max-height:100vh}}']})}}return e})();var X6=(()=>{class e{constructor(){}ngOnInit(){}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-content-news"]],inputs:{item:"item",chronomap:"chronomap"},standalone:!1,decls:1,vars:1,consts:[[3,"src"]],template:function(s,h){s&1&&qt(0,"img",0),s&2&&jt("src",h.item.image,jo)},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:auto;display:flex;flex-flow:column;align-items:center;padding-bottom:8px}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{object-fit:contain;max-width:100%;max-height:100vh}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   img[_ngcontent-%COMP%]{object-position:left;max-width:min(600px,100%);max-height:75vh}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   img[_ngcontent-%COMP%]{width:100%;max-height:100vh}}']})}}return e})();var K6=fh(B0());function Jie(e,t){if(e&1&&qt(0,"div",18),e&2){let n=nn();fn("background-image","url("+n.item.image+")")}}function Qie(e,t){if(e&1&&qt(0,"div",24),e&2){let n=nn(2);fn("background-image","url("+n.item.image+")")}}function ere(e,t){if(e&1&&(ut(0,"div",19),Mi(1,Qie,1,2,"div",20),ut(2,"div",21)(3,"div",22),xn(4),_t(),ut(5,"div",23),xn(6),_t()()()),e&2){let n=nn();Qe(),jt("ngIf",n.item.image),Qe(3),rr(n.item.link_title),Qe(2),rr(n.item.link_domain)}}var J6=(()=>{class e{constructor(){this.marked=On}ngOnInit(){}get timestamp(){return(0,K6.default)(this.item.post_timestamp).format("h:mm A - MMM D, YYYY")}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-content-twitter"]],inputs:{item:"item",chronomap:"chronomap"},standalone:!1,decls:23,vars:11,consts:[[1,"card"],[1,"header"],[1,"profile-image"],[1,"user"],[1,"name"],[1,"username"],["src","assets/img/spectours-twitter-logo.svg",1,"twitter-logo"],[1,"caption",3,"innerHtml","rtlDetect"],["class","image",3,"background-image",4,"ngIf"],["class","link",4,"ngIf"],[1,"deets"],[1,"timestamp"],["src","assets/img/spectours-twitter-info-icon.svg",1,"info"],[1,"social"],["src","assets/img/spectours-twitter-heart-icon.svg",1,"heart","icon"],[1,"like","count"],["src","assets/img/spectours-twitter-comment-icon.svg",1,"comment","icon"],[1,"comment","count"],[1,"image"],[1,"link"],["class","link-image",3,"background-image",4,"ngIf"],[1,"link-container"],[1,"link-title"],[1,"link-domain"],[1,"link-image"]],template:function(s,h){s&1&&(ut(0,"div",0)(1,"div",1),qt(2,"div",2),ut(3,"div",3)(4,"div",4),xn(5),_t(),ut(6,"div",5),xn(7),_t()(),qt(8,"img",6),_t(),qt(9,"div",7),Mi(10,Jie,1,2,"div",8)(11,ere,7,3,"div",9),ut(12,"div",10)(13,"div",11),xn(14),_t(),qt(15,"img",12),_t(),ut(16,"div",13),qt(17,"img",14),ut(18,"div",15),xn(19),_t(),qt(20,"img",16),ut(21,"div",17),xn(22),_t()()()),s&2&&(Qe(2),fn("background-image","url("+h.item.profile_image+")"),Qe(3),rr(h.item.name),Qe(2),As("@",h.item.username,""),Qe(2),jt("innerHtml",h.marked(h.item.content),Wo)("rtlDetect",h.item.content),Qe(),jt("ngIf",!h.item.link_title&&h.item.image),Qe(),jt("ngIf",h.item.link_title),Qe(3),rr(h.timestamp),Qe(5),rr(h.item.like_count),Qe(3),rr(h.item.comment_count))},dependencies:[xs,Lu],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}.twitter-font[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid #C5D0D8;box-sizing:border-box;border-radius:16px;padding:16px;display:flex;flex-flow:column;align-items:stretch;max-width:344px;width:100%}.card[_ngcontent-%COMP%]     a, .card[_ngcontent-%COMP%]     a:hover, .card[_ngcontent-%COMP%]     a:visited{color:#1b97f0}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;margin-bottom:8px}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .profile-image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:24px;background-position:center;background-size:cover;background-repeat:no-repeat}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{margin:0 10px}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal;font-weight:700;font-size:15px;line-height:18px;color:#141719}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal;font-weight:500;font-size:12px;line-height:15px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .twitter-logo[_ngcontent-%COMP%]{width:23px;height:19px;align-self:flex-start;margin:6px 0 6px auto}.card[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:400;font-size:19px;line-height:23px;color:#141719;margin-bottom:8px}.card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%;height:250px;background-position:center;background-size:cover;background-repeat:no-repeat;border-radius:16px;margin:0 0 8px}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{height:250px;display:flex;flex-flow:column;border:1px solid #C5D0D8;box-sizing:border-box;border-radius:2px;margin:8px 0}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-image[_ngcontent-%COMP%]{flex:1 1 auto;background-position:center;background-size:cover;background-repeat:no-repeat;width:100%}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-container[_ngcontent-%COMP%]{padding:8px;flex:0 0 auto}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-container[_ngcontent-%COMP%]   .link-title[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-weight:500;font-size:16px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-container[_ngcontent-%COMP%]   .link-domain[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-weight:400;font-size:14px;line-height:17px;color:#828282;margin-top:2px}.card[_ngcontent-%COMP%]   .deets[_ngcontent-%COMP%]{border-bottom:1px solid #C5D0D8;padding-bottom:8px;display:flex;flex-flow:row;align-items:center}.card[_ngcontent-%COMP%]   .deets[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:500;font-size:15px;line-height:18px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .deets[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{margin-left:auto;width:20px;height:20px}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;padding-top:8px}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-weight:500;font-size:15px;line-height:18px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:6px;width:20px;max-height:20px}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   .icon.comment[_ngcontent-%COMP%]{margin-left:16px}']})}}return e})();var Q6=(()=>{class e{constructor(){}ngOnInit(){}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-content-instagram"]],inputs:{item:"item",chronomap:"chronomap"},standalone:!1,decls:21,vars:9,consts:[[1,"card"],[1,"header"],[1,"profile-image"],[1,"user"],[1,"name"],[1,"image"],[1,"buttons"],["src","assets/img/spectours-ig-heart-icon.svg",1,"heart","icon"],["src","assets/img/spectours-ig-comment-icon.svg",1,"comment","icon"],["src","assets/img/spectours-ig-share-icon.svg",1,"share","icon"],["src","assets/img/spectours-ig-save-icon.svg",1,"save","icon"],[1,"social"],[1,"comments"],[1,"username"],[1,"comment",3,"rtlDetect"],[1,"footer"],["src","assets/img/spectours-ig-logo.svg",1,"logo"]],template:function(s,h){s&1&&(ut(0,"div",0)(1,"div",1),qt(2,"div",2),ut(3,"div",3)(4,"div",4),xn(5),_t()()(),qt(6,"div",5),ut(7,"div",6),qt(8,"img",7)(9,"img",8)(10,"img",9)(11,"img",10),_t(),ut(12,"div",11),xn(13),_t(),ut(14,"div",12)(15,"div",13),xn(16),_t(),ut(17,"div",14),xn(18),_t()(),ut(19,"div",15),qt(20,"img",16),_t()()),s&2&&(Qe(2),fn("background-image","url("+h.item.profile_image+")"),Qe(3),rr(h.item.name),Qe(),fn("background-image","url("+h.item.image+")"),Qe(7),As(" ",h.item.like_count," likes "),Qe(3),rr(h.item.username),Qe(),jt("rtlDetect",h.item.content),Qe(),rr(h.item.content))},dependencies:[Lu],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}.ig-font[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal}.card[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch;background:#fff;border:1px solid #D6D6D6;border-radius:3px}@media only screen and (min-width: 1000px){.card[_ngcontent-%COMP%]{width:344px}}@media only screen and (max-width: 999px){.card[_ngcontent-%COMP%]{width:100%}}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;padding:12px;width:100%}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .profile-image[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:15px;background-size:cover;background-repeat:no-repeat;background-position:center;margin-right:8px}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{display:block}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:600;font-size:12px;line-height:14px;color:#000}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .followers[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:500;font-size:12px;line-height:14px;color:#848484}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .ig-view-profile[_ngcontent-%COMP%]{margin-left:auto}.card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%;height:100%;padding-bottom:100%;background-size:cover;background-repeat:no-repeat;background-position:center}.card[_ngcontent-%COMP%]   .view-more[_ngcontent-%COMP%]{margin:0 16px;padding:13px 0;font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:700;font-size:12px;line-height:14px;color:#008af5;border-bottom:1px solid #EFEFEF}.card[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;margin:0 16px;padding:8px 0}.card[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:14px}.card[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:last-child{margin-left:auto;margin-right:0}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]{margin:0 16px;padding:0 0 8px;font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:700;font-size:12px;line-height:14px;color:#000}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]{margin:0 16px 2px;padding:12px 0;border-bottom:1px solid #EFEFEF}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-size:12px;line-height:14px;color:#000}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-weight:700}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]{margin-top:6px;font-weight:400}.card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;justify-content:flex-end;margin:8px 16px}']})}}return e})();function ire(e,t){if(e&1&&qt(0,"div",8),e&2){let n=nn();fn("background-image","url("+n.item.image+")")}}var ej=(()=>{class e{constructor(){this.marked=On}ngOnInit(){}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-content-wikipedia"]],inputs:{item:"item",chronomap:"chronomap"},standalone:!1,decls:13,vars:5,consts:[[1,"article"],[1,"title"],[1,"content"],[1,"text"],[1,"excerpt",3,"innerHtml","rtlDetect"],["class","image",3,"background-image",4,"ngIf"],[1,"bottom"],["target","_blank",1,"link",3,"href"],[1,"image"]],template:function(s,h){s&1&&(ut(0,"div",0)(1,"div",1)(2,"h1"),xn(3),_t(),ut(4,"h2"),xn(5,"From Wikipedia, the free encyclopedia"),_t()(),ut(6,"div",2)(7,"div",3),qt(8,"div",4),_t(),Mi(9,ire,1,2,"div",5),ut(10,"div",6)(11,"a",7),xn(12,"Learn more at the English Wikipedia"),_t()()()()),s&2&&(Qe(3),rr(h.item.title),Qe(5),jt("innerHtml",h.marked(h.item.content),Wo)("rtlDetect",h.item.content),Qe(),jt("ngIf",h.item.image&&h.item.image.length),Qe(2),jt("href",h.item.link_domain,jo))},dependencies:[xs,Lu],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}.font-wikipedia-georgia[_ngcontent-%COMP%]{font-family:Linux Libertine,Georgia,Times,serif;font-style:normal}.font-wikipedia-sans-serif[_ngcontent-%COMP%]{font-family:sans-serif;font-style:normal}.article[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch;max-width:400px;width:100%;background:#fff;padding:8px 10px}.article[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Linux Libertine,Georgia,Times,serif;font-style:normal;font-weight:400;font-size:32px;line-height:36px;color:#000;border-bottom:1px solid #a2a2a2;margin:0 0 9px}.article[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:sans-serif;font-style:normal;font-weight:400;font-size:13px;line-height:15px;color:#000}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{flex:0 0 auto;width:100%;height:0px;padding-bottom:66%;background-position:center;background-size:cover;background-repeat:no-repeat}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .excerpt[_ngcontent-%COMP%]{font-family:sans-serif;font-style:normal;font-weight:400;font-size:18px;line-height:21px;color:#000;margin-bottom:6px;text-align:justify}.article[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{background-image:url("./media/spectours-wikipedia-logo-WLQFTBG2.png");background-repeat:no-repeat;background-position:bottom 4px right 4px;background-size:66px 64px;padding-top:47px;margin-top:-37px;padding-bottom:8px;margin-right:-10px}.article[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .article[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .article[_ngcontent-%COMP%]   a.visited[_ngcontent-%COMP%]{font-family:Linux Libertine,Georgia,Times,serif;font-style:normal;font-weight:400;font-size:15px;line-height:17px;color:#36b;text-decoration:none}.article[_ngcontent-%COMP%]   a.link[_ngcontent-%COMP%]{margin-bottom:30px}.article[_ngcontent-%COMP%]   a.source-link[_ngcontent-%COMP%]{margin-bottom:10px}']})}}return e})();var tj=(()=>{class e{constructor(){this.marked=On}ngOnInit(){}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-content-note"]],inputs:{item:"item",chronomap:"chronomap"},standalone:!1,decls:2,vars:3,consts:[["note",""],[1,"note",3,"innerHTML"]],template:function(s,h){if(s&1&&qt(0,"div",1,0),s&2){let r=zb(1);fn("height",r.offsetWidth,"px"),jt("innerHTML",h.marked(h.item.title),Wo)}},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{height:100%;width:100%;display:flex;flex-flow:column;justify-content:center;align-items:center}[_nghost-%COMP%]   .note[_ngcontent-%COMP%]{background:linear-gradient(335deg,#0000001a 10.14%,#ffffff0d 93.12%),#fff5c0;box-shadow:0 40px 40px #00000040;padding:16px;overflow:auto;display:flex;flex-flow:column;justify-content:center;color:#000000d9;text-align:center;font-family:Just Another Hand,cursive;font-style:normal;font-size:76px;font-weight:400;line-height:normal;max-width:400px;width:100%}[_nghost-%COMP%]   .note[_ngcontent-%COMP%]     *{margin:0}']})}}return e})();function sre(e,t){if(e&1&&qt(0,"app-content-audio",3),e&2){let n=nn(2);jt("chronomap",n.chronomap)("item",n.content)("activeItem",n.activeItem)}}function are(e,t){if(e&1&&qt(0,"app-content-video",3),e&2){let n=nn(2);jt("chronomap",n.chronomap)("item",n.content)("activeItem",n.activeItem)}}function lre(e,t){if(e&1&&qt(0,"app-content-image",4),e&2){let n=nn(2);jt("chronomap",n.chronomap)("item",n.content)}}function cre(e,t){if(e&1&&qt(0,"app-content-news",4),e&2){let n=nn(2);jt("chronomap",n.chronomap)("item",n.content)}}function ure(e,t){if(e&1&&qt(0,"app-content-note",4),e&2){let n=nn(2);jt("chronomap",n.chronomap)("item",n.content)}}function hre(e,t){if(e&1&&qt(0,"app-content-twitter",4),e&2){let n=nn(2);jt("chronomap",n.chronomap)("item",n.content)}}function dre(e,t){if(e&1&&qt(0,"app-content-instagram",4),e&2){let n=nn(2);jt("chronomap",n.chronomap)("item",n.content)}}function fre(e,t){if(e&1&&qt(0,"app-content-wikipedia",4),e&2){let n=nn(2);jt("chronomap",n.chronomap)("item",n.content)}}function pre(e,t){if(e&1&&(Du(0),Mi(1,sre,1,3,"app-content-audio",1)(2,are,1,3,"app-content-video",1)(3,lre,1,2,"app-content-image",2)(4,cre,1,2,"app-content-news",2)(5,ure,1,2,"app-content-note",2)(6,hre,1,2,"app-content-twitter",2)(7,dre,1,2,"app-content-instagram",2)(8,fre,1,2,"app-content-wikipedia",2),Ou()),e&2){let n=nn();Qe(),jt("ngIf",n.contentType==="audio"),Qe(),jt("ngIf",n.contentType==="video"),Qe(),jt("ngIf",n.contentType==="image"),Qe(),jt("ngIf",n.contentType==="news"),Qe(),jt("ngIf",n.contentType==="note"),Qe(),jt("ngIf",n.contentType==="twitter"),Qe(),jt("ngIf",n.contentType==="instagram"),Qe(),jt("ngIf",n.contentType==="wikipedia")}}var nj=(()=>{class e{constructor(n){this.el=n,this.mapView=new go,this.activated=new go,this.contentVisible=!1,this.visibleDetector=new _v,this.activeDetector=new _v}ngOnInit(){this.activeDetector.detected.subscribe(n=>{n&&this.activated.next(this.content)}),this.visibleDetector.detected.subscribe(n=>{this.contentVisible=this.contentVisible||n})}ngAfterViewInit(){let n=this.el.nativeElement;this.visibleDetector.initVisibilityDetector(n,this.parentElement,"visible"),this.activeDetector.initVisibilityDetector(n,this.parentElement,"active")}static{this.\u0275fac=function(s){return new(s||e)(Fn(Po))}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-content-item"]],inputs:{content:"content",contentType:"contentType",activeItem:"activeItem",parentElement:"parentElement",chronomap:"chronomap"},outputs:{mapView:"mapView",activated:"activated"},standalone:!1,decls:1,vars:1,consts:[[4,"ngIf"],[3,"chronomap","item","activeItem",4,"ngIf"],[3,"chronomap","item",4,"ngIf"],[3,"chronomap","item","activeItem"],[3,"chronomap","item"]],template:function(s,h){s&1&&Mi(0,pre,9,8,"ng-container",0),s&2&&jt("ngIf",h.contentVisible)},dependencies:[xs,Z6,W6,Y6,X6,J6,Q6,ej,tj],styles:["[_nghost-%COMP%]{width:100%;padding:0 16px}"]})}}return e})();var gre=["baseMapEl"],_re=["detailMapEl"],yre=["timeLine"],vre=["scroller"],xre=["baseMarkers"],bre=["detailMarkers"],wre=["description"],Cre=["detail"],Mre=["contentFiller"],Tre=["contentItem"],Ere=["contentDescription"],Sre=["contentRoot"],ij=(e,t)=>t.id,Ire=(e,t)=>t[0];function Pre(e,t){if(e&1&&qt(0,"app-map-selector",28),e&2){let n=nn();jt("chronomap",n.chronomap)("mapHandler",n.mapHandler)("position",n.mapHandler.lastMapState)}}function Dre(e,t){if(e&1&&qt(0,"app-timeline-selector",28),e&2){let n=nn();jt("chronomap",n.chronomap)("mapHandler",n.mapHandler)("position",n.mapSelector.selectedGeo)}}function Ore(e,t){if(e&1){let n=Pr();ut(0,"app-time-line",30,8),Yn("selected",function(h){Hi(n);let r=nn(2);return $i(r.itemSelected(h))}),_t()}if(e&2){let n=nn(2);jt("minDate",n.chronomap.minDate())("maxDate",n.chronomap.maxDate())("chronomap",n.chronomap)("state",n.timelineState)}}function Are(e,t){if(e&1&&Mi(0,Ore,2,4,"app-time-line",29),e&2){let n=nn();jt("ngIf",n.timelineState()!==null)}}function Rre(e,t){if(e&1){let n=Pr();ut(0,"app-content-item",33),Yn("activated",function(h){Hi(n);let r=nn(2);return $i(r.itemActivated(h))}),_t()}if(e&2){let n=nn().$implicit,s=nn(),h=zb(22);jt("content",n)("contentType",n.type)("activeItem",s.currentItem)("parentElement",h)("chronomap",s.chronomap),xr("data-id",n.id)}}function kre(e,t){if(e&1&&(ut(0,"div",31),Mi(1,Rre,1,6,"app-content-item",32),_t()),e&2){let n=t.$implicit,s=nn();fn("width",s.detailWidthPx),Do("current",n===s.currentItem),Qe(),jt("ngIf",s.contentVisible&&s.currentItem)}}function Lre(e,t){if(e&1&&(ut(0,"div",54),xn(1),_t()),e&2){let n=t.$implicit,s=nn(2);fn("background-color",s.chronomap.primaryColor()+"40"),Qe(),rr(n)}}function Fre(e,t){if(e&1&&(ut(0,"div",55)(1,"strong"),xn(2),_t(),xn(3),_t()),e&2){let n=t.$implicit;Qe(2),rr(n[0]),Qe(),As(": ",n[1]," ")}}function Nre(e,t){if(e&1&&Hd(0,Fre,4,2,"div",55,Ire),e&2){let n=nn(2);$d(n.currentItem.extraProperties)}}function zre(e,t){if(e&1&&qt(0,"div",47),e&2){let n=nn(2);jt("innerHTML",n.marked(n.currentItem.notes),Wo)("rtlDetect",n.currentItem.notes)}}function Bre(e,t){if(e&1){let n=Pr();ut(0,"div",58),Yn("click",function(){let h=Hi(n).$implicit,r=nn(3);return $i(r.itemSelected(h))}),ut(1,"div",59)(2,"div",60),qt(3,"app-media-icon",61),_t(),ut(4,"div",62),xn(5),_t()(),ut(6,"div",63),xn(7),_t()()}if(e&2){let n=t.$implicit,s=nn(3);Qe(3),jt("type",n.type)("color",s.chronomap.primaryColor())("outline",!1),Qe(),fn("color",s.chronomap.primaryColor()),Qe(),rr(n.formattedPostTimestamp),Qe(2),rr(n.title)}}function Vre(e,t){if(e&1&&(ut(0,"div",56),xn(1,"RELATED POSTS"),_t(),Hd(2,Bre,8,7,"div",57,ij)),e&2){let n=nn(2);Qe(2),$d(n.currentItem.relatedItems)}}function jre(e,t){if(e&1){let n=Pr();ut(0,"div",64),Yn("click",function(){Hi(n);let h=nn(2);return $i(h.state.selectedItemId=h.currentItem.prev.id)}),_t()}}function Ure(e,t){if(e&1){let n=Pr();ut(0,"div",65),Yn("click",function(){Hi(n);let h=nn(2);return $i(h.state.selectedItemId=h.currentItem.next.id)}),_t()}}function Hre(e,t){if(e&1){let n=Pr();ut(0,"div",66),Yn("click",function(){Hi(n);let h=nn(2);return $i(h.state.selectedItemId=h.currentItem.prev.id)}),qt(1,"app-media-icon",67),_t()}if(e&2){let n=nn(2);Qe(),jt("type",n.currentItem.prev.type)("outline",!1)}}function $re(e,t){if(e&1){let n=Pr();ut(0,"div",68),Yn("click",function(){Hi(n);let h=nn(2);return $i(h.state.selectedItemId=h.currentItem.next.id)}),qt(1,"app-media-icon",67),_t()}if(e&2){let n=nn(2);Qe(),jt("type",n.currentItem.next.type)("outline",!1)}}function Gre(e,t){if(e&1){let n=Pr();ut(0,"div",34,9),qt(2,"app-media-icon",35),_t(),ut(3,"div",36)(4,"div",37),Yn("click",function(){Hi(n);let h=nn();return $i(h.toggleDescriptionMode())}),_t(),ut(5,"div",38),xn(6),_t(),qt(7,"div",39),_t(),ut(8,"div",40,10)(10,"div",41)(11,"div",42)(12,"div",43),xn(13),_t(),ut(14,"div",44),xn(15,"Created by "),ut(16,"strong"),xn(17),_t()(),ut(18,"div",45),Hd(19,Lre,2,3,"div",46,xF),_t(),Mi(21,Nre,2,0)(22,zre,1,2,"div",47),ut(23,"div",48),xn(24),_t()(),qt(25,"div",49),Mi(26,Vre,4,0),_t()(),Mi(27,jre,1,0,"div",50)(28,Ure,1,0,"div",51)(29,Hre,2,2,"div",52)(30,$re,2,2,"div",53)}if(e&2){let n=nn();Qe(2),jt("type",n.currentItem.type)("color",n.chronomap.primaryColor()),Qe(),fn("border-color",n.chronomap.primaryColor()),Qe(),Do("more",n.mapMode==="More"),Qe(2),rr(n.currentItem.formattedPostTimestamp),Qe(4),fn("border-color",n.chronomap.primaryColor()),Qe(2),jt("rtlDetect",n.currentItem.title),Qe(),rr(n.currentItem.title),Qe(),fn("color",n.chronomap.primaryColor()),Qe(3),rr(n.currentItem.formattedAuthors),Qe(2),$d(n.currentItem.tags),Qe(2),Ga(n.currentItem.extraProperties?21:-1),Qe(),Ga(n.currentItem.notes?22:-1),Qe(2),As("Last Edited: ",n.currentItem.lastModified.toLocaleDateString(),""),Qe(),fn("border-color",n.chronomap.primaryColor()),Qe(),Ga(n.currentItem.relatedItems!=null&&n.currentItem.relatedItems.length?26:-1),Qe(),jt("ngIf",n.currentItem.prev),Qe(),jt("ngIf",n.currentItem.next),Qe(),jt("ngIf",n.currentItem.prev),Qe(),jt("ngIf",n.currentItem.next)}}function qre(e,t){if(e&1&&qt(0,"app-image-icon",69),e&2){let n=nn().$implicit,s=nn();jt("item",n)("chronomap",s.chronomap)("breathing",n===s.currentItem)}}function Zre(e,t){if(e&1&&(ut(0,"div",71),qt(1,"app-media-icon",72),_t()),e&2){let n=nn().$implicit,s=nn();fn("border-color",s.chronomap.primaryColor()),Qe(),jt("type",n.type)("color",s.markerColor())("breathing",n===s.currentItem)}}function Wre(e,t){if(e&1&&(Du(0),Mi(1,qre,1,3,"app-image-icon",69)(2,Zre,2,5,"div",70),Ou()),e&2){let n=t.$implicit,s=nn();Qe(),Ga(s.chronomap.imageItemMarkers()&&n.type==="image"?1:2)}}function Yre(e,t){if(e&1&&qt(0,"app-image-icon",69),e&2){let n=nn().$implicit,s=nn();jt("item",n)("chronomap",s.chronomap)("breathing",n===s.currentItem)}}function Xre(e,t){if(e&1&&(ut(0,"div",71),qt(1,"app-media-icon",72),_t()),e&2){let n=nn().$implicit,s=nn();fn("border-color",s.chronomap.primaryColor()),Qe(),jt("type",n.type)("color",s.markerColor())("breathing",n===s.currentItem)}}function Kre(e,t){if(e&1&&(Du(0),Mi(1,Yre,1,3,"app-image-icon",69)(2,Xre,2,5,"div",70),Ou()),e&2){let n=t.$implicit,s=nn();Qe(),Ga(s.chronomap.imageItemMarkers()&&n.type==="image"?1:2)}}var SC=class PP{constructor(t,n,s,h,r,w){this.titleSvc=t,this.sanitizer=n,this.mapSelector=s,this.state=h,this.layout=r,this.el=w,this.timelineState=Ln(""),this.currentItem=null,this.selectedItemId=null,this.itemActivations=new Ii,this.mapMode="Media",this.mapModeSetter=new Ii,this.fragmentChanger=new Ii,this.baseWidthPx="100%",this.detailWidthPx="50%",this.changing=0,this.marked=On,this.itemActivations.pipe(na(this),io(()=>this.changing===0),yl(1e3)).subscribe(A=>{console.log("ACTIVATED",A.title),this.itemSelected(A)}),bl(()=>{let A=this.timelineState();A&&(this.zoomState=A,this.state.timelineState=A),this.titleSvc.setTitle(this.chronomap.title())},{allowSignalWrites:!0}),this.mapModeSetter.pipe(na(this),yl(1e3)).subscribe(A=>{this.mapMode=A})}ngOnInit(){this.chronomap.fetchContent().subscribe(),this.backdropBackground=this.sanitizer.bypassSecurityTrustStyle(`linear-gradient(180deg, ${this.chronomap.primaryColor()}00 10.32%, ${this.chronomap.primaryColor()}80 35.85%)`)}ngAfterViewInit(){this.chronomap.ready.subscribe(()=>{this.mapHandler=O6(this,this.layout,this.chronomap),this.resizeObserver=new ResizeObserver(()=>{Mr(0).subscribe(()=>{this.syncWidths(),this.mapHandler.resize()})}),this.mapHandler.itemHovered.pipe(na(this)).subscribe(t=>{this.timeLineComponent?.updateHovers(t?.index||null)}),this.mapHandler.itemSelected.pipe(na(this)).subscribe(t=>{this.itemSelected(t)}),this.mapHandler.init(this.baseMapEl,this.detailMapEl,this.baseMarkersElement,this.detailMarkersElement),this.resizeObserver.observe(this.el.nativeElement),Mr(0).subscribe(()=>{this.syncWidths(),this.initialize()})})}ngOnDestroy(){this.resizeObserver?.disconnect()}get baseWidth(){return this.baseMapEl?.nativeElement?.offsetWidth}syncWidths(){this.baseWidthPx=this.baseWidth+"px",this.detailWidth=Math.min(this.baseWidth,Math.max(450,this.baseWidth/2)),this.detailWidthPx=this.detailWidth+"px",this.detailOpen&&this.scrollerComponent.nativeElement.querySelector(".current")?.scrollIntoView({behavior:"auto",inline:"center"})}getDetailWidth(){return this.detailOpen?this.mapMode==="Map"?"100%":this.detailWidthPx:"0px"}goto(t){this.timelineState.set(t.timelineState);let n=this.chronomap.timelineItems().find(s=>s.id===t.selectedItemId)||null;console.log("GOTO",t,n),this.itemSelected(n)}itemActivated(t){t&&this.itemActivations.next(t)}itemSelected(t){if(console.log("SELECTING ITEM?",t),t===this.currentItem)return;if(console.log("SELECTING ITEM",t),this.state.selectedItemId=t?.id||null,!t){this.selectedItemId=null,this.currentItem=null,this.actionSub?.unsubscribe(),this.actionSub=Mr(0).pipe(pi(()=>{this.detailOpen&&this.mapHandler.flyTo({padding:{top:0,bottom:0,left:0,right:0},duration:1e3}),this.detailOpen=!1}),_a(1e3)).subscribe(()=>{this.contentVisible=!1,this.mapHandler.updateMarkers(),this.actionSub=null,this.observer?.disconnect()});return}this.currentItem=t,this.selectedItemId=t.id,this.changing+=1,this.actionSub?.unsubscribe();let n="smooth";this.actionSub=Mr(0).pipe(pi(()=>{this.timeLineComponent?.scrollTo(t.timestamp,t)}),Vr(()=>{let s=this.scrollerComponent.nativeElement;n=this.detailOpen?"smooth":"auto";let h=s.querySelector(".current");return h&&(h.scrollIntoView({behavior:n,inline:"center",block:"center"}),this.detailOpen)?bo(s,"scrollend").pipe(Qs(1)):cr([!0])}),_a(0),Vr(()=>{let s=[cr([!0])];this.detailOpen?this.contentItem.nativeElement?.scrollIntoView({behavior:"smooth"}):(this.mapMode="SmallMap",this.contentItem.nativeElement?.scrollIntoView({behavior:"smooth"}),s.push(bo(this.detail.nativeElement,"transitionend").pipe(Qs(1)))),this.detailOpen=!0,this.contentVisible=!0;let h={duration:2,padding:{top:0,bottom:0,left:0,right:this.layout.mobile()?0:this.detailWidth}};return this.mapHandler.applyMapView(t,h),this.mapHandler.updateMarkers(),Ay(s)}),_a(1e3),pi(()=>{let h=this.scrollerComponent.nativeElement.querySelector(".current");h&&h.scrollIntoView({behavior:n,inline:"center"})}),_a(3e3),pi(()=>{this.changing-=1})).subscribe(()=>{this.observer?.disconnect(),this.observer=new IntersectionObserver(s=>{s=s.filter(w=>w.isIntersecting).sort((w,A)=>A.intersectionRatio-w.intersectionRatio);let h=s[0],r=null;h&&h.isIntersecting&&(h.target===this.contentItem?.nativeElement?r="Media":h.target===this.contentDescription?.nativeElement?r="More":h.target===this.contentFiller?.nativeElement&&(r="Map"),console.log("INTERSECTING",s.length,h.isIntersecting,h.intersectionRatio,r),r&&this.mapModeSetter.next(r))},{threshold:.75,root:this.contentRoot.nativeElement}),console.log("INTERSECTING start"),this.observer.observe(this.contentItem.nativeElement),this.observer.observe(this.contentDescription.nativeElement),this.observer.observe(this.contentFiller.nativeElement),this.actionSub=null})}markerColor(){return this.chronomap.primaryColor()}toggleMapMode(){this.mapMode==="Map"||this.mapMode==="SmallMap"?this.contentItem.nativeElement?.scrollIntoView({behavior:"smooth"}):this.contentFiller.nativeElement?.scrollIntoView({behavior:"smooth"})}toggleDescriptionMode(){this.mapMode==="More"?this.contentItem.nativeElement?.scrollIntoView({behavior:"smooth"}):this.contentDescription.nativeElement?.scrollIntoView({behavior:"smooth"})}initialize(){this.chronomap.ready.pipe(na(this),Vr(()=>this.state.state)).subscribe(t=>{this.goto(t)})}updateLocation(t,n=!1){n?location.replace(location.pathname+"#"+t):location.hash=t}static{this.\u0275fac=function(n){return new(n||PP)(Fn(Qb),Fn(zc),Fn(cf),Fn(uC),Fn(tf),Fn(Po))}}static{this.\u0275cmp=Ci({type:PP,selectors:[["app-chronomap"]],viewQuery:function(n,s){if(n&1&&(Lr(gre,7),Lr(_re,7),Lr(yre,5),Lr(vre,5),Lr(xre,5),Lr(bre,5),Lr(wre,5),Lr(Cre,5),Lr(Mre,5),Lr(Tre,5),Lr(Ere,5),Lr(Sre,5)),n&2){let h;Dr(h=Or())&&(s.baseMapEl=h.first),Dr(h=Or())&&(s.detailMapEl=h.first),Dr(h=Or())&&(s.timeLineComponent=h.first),Dr(h=Or())&&(s.scrollerComponent=h.first),Dr(h=Or())&&(s.baseMarkersElement=h.first),Dr(h=Or())&&(s.detailMarkersElement=h.first),Dr(h=Or())&&(s.descriptionElement=h.first),Dr(h=Or())&&(s.detail=h.first),Dr(h=Or())&&(s.contentFiller=h.first),Dr(h=Or())&&(s.contentItem=h.first),Dr(h=Or())&&(s.contentDescription=h.first),Dr(h=Or())&&(s.contentRoot=h.first)}},inputs:{chronomap:"chronomap"},standalone:!1,decls:33,vars:32,consts:[["baseMapEl",""],["detail",""],["detailMapEl",""],["contentRoot",""],["contentFiller",""],["scroller","","contentItem",""],["baseMarkers",""],["detailMarkers",""],["timeLine",""],["targetIcon",""],["contentDescription",""],[1,"wrapper"],[1,"base-map"],[1,"main-map"],[3,"chronomap","mapHandler","position",4,"ngIf"],[3,"minDate","maxDate","chronomap","state"],[1,"detail-bg"],[1,"detail"],[1,"detail-map"],[1,"content"],[1,"button-close",3,"click"],[1,"filler"],[1,"map-toggle"],[3,"click"],[1,"scroller"],[1,"scroll-card",3,"width","current"],[2,"display","none"],[4,"ngFor","ngForOf"],[3,"chronomap","mapHandler","position"],[3,"minDate","maxDate","chronomap","state","selected",4,"ngIf"],[3,"selected","minDate","maxDate","chronomap","state"],[1,"scroll-card"],[3,"content","contentType","activeItem","parentElement","chronomap","activated",4,"ngIf"],[3,"activated","content","contentType","activeItem","parentElement","chronomap"],[1,"target-icon"],[3,"type","color"],[1,"description-toggle"],[1,"description-toggle-button",3,"click"],[1,"date"],[1,"backdrop"],[1,"description"],[1,"description-content"],[1,"inner"],[1,"title",3,"rtlDetect"],[1,"authors"],[1,"tags"],[1,"tag",3,"background-color"],[1,"notes",3,"innerHTML","rtlDetect"],[1,"last-updated"],[1,"separator"],["class","arrow",3,"click",4,"ngIf"],["class","arrow rev",3,"click",4,"ngIf"],["class","arrow-icon",3,"click",4,"ngIf"],["class","arrow-icon rev",3,"click",4,"ngIf"],[1,"tag"],[1,"extra-property"],[1,"title","related"],[1,"related"],[1,"related",3,"click"],[1,"related-header"],[1,"related-icon"],[3,"type","color","outline"],[1,"related-date"],[1,"related-title"],[1,"arrow",3,"click"],[1,"arrow","rev",3,"click"],[1,"arrow-icon",3,"click"],["color","white",3,"type","outline"],[1,"arrow-icon","rev",3,"click"],[1,"mapmarker",3,"item","chronomap","breathing"],[1,"mapmarker","media-icon",3,"border-color"],[1,"mapmarker","media-icon"],[3,"type","color","breathing"]],template:function(n,s){if(n&1){let h=Pr();ut(0,"div",11)(1,"div",12)(2,"div",13),qt(3,"div",null,0),_t(),Mi(5,Pre,1,3,"app-map-selector",14)(6,Dre,1,3,"app-timeline-selector",14),_t(),Mi(7,Are,1,1,"app-time-line",15),ut(8,"div",16)(9,"div",17,1)(11,"div",18),qt(12,"div",null,2),_t(),ut(14,"div",19,3)(16,"div",20),Yn("click",function(){return Hi(h),$i(s.itemSelected(null))}),_t(),qt(17,"div",21,4),ut(19,"div",22)(20,"div",23),Yn("click",function(){return Hi(h),$i(s.toggleMapMode())}),_t()(),ut(21,"div",24,5),Hd(24,kre,2,5,"div",25,ij),_t(),Mi(26,Gre,31,24),_t()()()(),ut(27,"div",26,6),Mi(29,Wre,3,1,"ng-container",27),_t(),ut(30,"div",26,7),Mi(32,Kre,3,1,"ng-container",27),_t()}n&2&&(Qe(5),jt("ngIf",s.mapSelector.showMapSelector),Qe(),jt("ngIf",s.mapSelector.showTimelineSelector),Qe(),Ga(s.chronomap.disableTimeline()?-1:7),Qe(2),fn("width",s.getDetailWidth())("border-color",s.chronomap.primaryColor()),Do("open",s.detailOpen)("map-mode",s.mapMode==="Map"),Qe(2),fn("width",s.baseWidthPx),Qe(3),fn("background-color",s.mapMode==="Map"?"#00000000":s.chronomap.primaryColor()+"66"),Do("map-mode",s.mapMode==="Map")("small-map-mode",s.mapMode==="SmallMap")("media-mode",s.mapMode==="Media")("description-mode",s.mapMode==="More"),Qe(5),fn("border-color",s.chronomap.primaryColor()),Qe(),Do("map",s.mapMode==="Map"),Qe(),fn("width",s.detailWidthPx),Qe(3),$d(s.chronomap.timelineItems()),Qe(2),Ga(s.currentItem?26:-1),Qe(3),jt("ngForOf",s.chronomap.timelineItems()),Qe(3),jt("ngForOf",s.chronomap.timelineItems()))},dependencies:[jF,xs,A6,MC,G6,i_,nj,n_,Lu],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%;display:flex;overflow:hidden}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;display:block}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .base-map[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:0}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .base-map[_ngcontent-%COMP%]   .main-map[_ngcontent-%COMP%]{width:100%;height:100%;z-index:0;position:relative}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .base-map[_ngcontent-%COMP%]   .main-map[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]{position:absolute;z-index:2;top:0;left:0;width:100%;height:100%;pointer-events:none;display:flex;flex-flow:column}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]{align-items:flex-end}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]{align-items:center}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]{width:0vw;transition:width .35s ease-in-out;height:100%;overflow:hidden;display:flex;flex-flow:column;align-items:center;pointer-events:all;position:relative}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .detail-map[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%;z-index:0}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .detail-map[_ngcontent-%COMP%]{right:0}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .detail-map[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%;display:flex;flex-flow:column;align-items:center;pointer-events:none;transition:background-color .35s ease-in-out;overflow:scroll;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;scroll-snap-type:y mandatory;scroll-snap-stop:always}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .filler[_ngcontent-%COMP%]{flex:0 0 auto;width:100%;scroll-snap-align:start}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .filler[_ngcontent-%COMP%]{height:calc(100% - 128px)}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .filler[_ngcontent-%COMP%]{height:calc(100% - 104px)}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:column;align-items:center;justify-content:center;scroll-snap-align:start;border-bottom:1px solid black;width:100%}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%]{height:88px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%]{height:64px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{pointer-events:all;width:48px;height:48px;background-repeat:no-repeat;background-position:center;background-size:contain;background-image:url("./media/icon-map-fullscreen-CVRSFRPF.svg");cursor:pointer}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content.map-mode[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-image:url("./media/icon-map-exit-fullscreen-QBZJO7DC.svg")}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content.small-map-mode[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%]{border:none}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content.small-map-mode[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{opacity:0}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:row;align-items:flex-start;overflow-x:scroll;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;width:50%;overflow-y:hidden;overscroll-behavior-x:contain;overscroll-behavior-y:auto;scroll-behavior:smooth;scroll-snap-type:x mandatory}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]{height:calc(100% - 280px)}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]{height:calc(100% - 140px)}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:column;align-items:center;justify-content:center;scroll-snap-align:center;height:100%;overflow-y:scroll;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;opacity:0;transition:opacity .35s ease-in-out}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card.current[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]     app-content-item{display:flex;flex-flow:column;justify-content:flex-start;align-items:center;width:100%;height:100%}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]     app-content-item{padding:0 24px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]     app-content-item{width:100%;padding:16px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]     app-content-item app-content-video{width:100%;height:100%}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .button-close[_ngcontent-%COMP%]{flex:0 0 auto;pointer-events:all;width:24px;height:24px;background-image:url("./media/detail-button-close-3IXJMMAA.svg");background-repeat:no-repeat;background-size:contain;background-position:center;cursor:pointer;position:sticky;top:16px;margin-right:16px;align-self:flex-end;margin-bottom:-24px;transition-delay:0s;transition-duration:.35s;transition-timing-function:ease-out;transition-property:right}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description-toggle[_ngcontent-%COMP%]{flex:0 0 auto;width:100%;display:flex;flex-flow:column;align-items:center;justify-content:center;position:relative;border-top:1px solid black}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description-toggle[_ngcontent-%COMP%]{height:192px;padding-top:72px;padding-bottom:72px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description-toggle[_ngcontent-%COMP%]{height:76px;padding-top:20px;padding-bottom:8px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description-toggle[_ngcontent-%COMP%]   .description-toggle-button[_ngcontent-%COMP%]{pointer-events:all;width:48px;height:48px;background-repeat:no-repeat;background-position:center;background-size:contain;background-image:url("./media/icon-scroll-down-YUSCVZNM.svg");cursor:pointer;z-index:1}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description-toggle[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{position:absolute;color:#e0e0e0;text-align:center;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;line-height:normal;text-transform:uppercase;z-index:1}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description-toggle[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{bottom:40px;font-size:16px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description-toggle[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{bottom:56px;font-size:13px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description-toggle[_ngcontent-%COMP%]   .backdrop[_ngcontent-%COMP%]{display:block;position:absolute;bottom:0;left:0;width:100%;height:100%;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);background:linear-gradient(180deg,#0000,#00000080)}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content.description-mode[_ngcontent-%COMP%]   .description-toggle[_ngcontent-%COMP%]   .description-toggle-button[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{width:100%;display:flex;flex-flow:column;align-items:center;justify-content:flex-start;flex:0 0 auto;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);background-color:#00000080;padding:0 16px;scroll-snap-align:end}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{height:calc(100% - 232px)}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{height:calc(100% - 116px)}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{padding-bottom:10px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]{overflow-y:auto;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;border-top:1px solid black;width:100%;display:flex;flex-flow:column;align-items:center;justify-content:flex-start;padding:16px 0}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:center;color:#fff;gap:8px}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{width:100%;max-width:360px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .tags[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;align-items:center;justify-content:center;gap:4px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .tags[_ngcontent-%COMP%]   .tag[_ngcontent-%COMP%]{padding:0 12px;height:32px;display:flex;flex-flow:row;align-items:center;justify-content:center;white-space:nowrap;color:#fff;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:15px;font-weight:400;line-height:23px;letter-spacing:.15px;text-transform:lowercase;border-radius:4px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .authors[_ngcontent-%COMP%]{text-align:center;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:15px;font-weight:400;line-height:23px;letter-spacing:.15px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .authors[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .extra-property[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:16px;font-weight:400;line-height:normal;align-self:flex-start}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .extra-property[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .notes[_ngcontent-%COMP%]{color:#fff;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-size:15px;font-style:normal;font-weight:400;line-height:23px;letter-spacing:.15px;align-self:flex-start;width:100%}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .notes[_ngcontent-%COMP%]     *{margin:0;color:inherit}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .last-updated[_ngcontent-%COMP%]{color:#828282;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:15px;font-weight:400;line-height:23px;letter-spacing:.15px;align-self:flex-start}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#e0e0e0;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:16px;font-weight:700;line-height:normal;text-transform:uppercase;text-align:center}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin:16px 0;height:0;width:100%;border-bottom:1px solid black}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .related[_ngcontent-%COMP%]{display:flex;flex-flow:column;margin:16px 0;cursor:pointer}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .related[_ngcontent-%COMP%]{width:100%;max-width:360px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .related[_ngcontent-%COMP%]   .related-header[_ngcontent-%COMP%]{display:flex;flex-flow:row;gap:8px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .related[_ngcontent-%COMP%]   .related-header[_ngcontent-%COMP%]   .related-icon[_ngcontent-%COMP%]{width:24px;height:24px;flex:0 0 auto}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .related[_ngcontent-%COMP%]   .related-header[_ngcontent-%COMP%]   .related-date[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:15px;font-weight:400;line-height:23px;letter-spacing:.15px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .description-content[_ngcontent-%COMP%]   .related[_ngcontent-%COMP%]   .related-title[_ngcontent-%COMP%]{color:#fff;font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:15px;font-weight:400;line-height:23px;letter-spacing:.15px;text-align:left;width:100%}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{pointer-events:all;width:33px;height:14px;background-image:url("./media/arrow-next-4X5GCU22.svg");background-repeat:no-repeat;background-size:contain;background-position:center;cursor:pointer;position:absolute;z-index:1;transition-delay:0s;transition-duration:.35s;transition-timing-function:ease-out}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{top:calc(200% - 231px)}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{top:calc(200% - 149px)}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:not(.rev){transition-property:left}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:not(.rev){left:-200px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:not(.rev){left:-200px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow.rev[_ngcontent-%COMP%]{transition-property:right;transform:scaleX(-1)}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow.rev[_ngcontent-%COMP%]{right:-200px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow.rev[_ngcontent-%COMP%]{right:-200px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{pointer-events:all;cursor:pointer;position:absolute;height:24px;width:24px;z-index:1;transition-delay:0s;transition-duration:.35s;transition-timing-function:ease-out}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{top:calc(200% - 236px)}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{top:calc(200% - 154px)}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]:not(.rev){transition-property:left;left:-200px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon.rev[_ngcontent-%COMP%]{transition-property:right;right:-200px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .target-icon[_ngcontent-%COMP%]{position:absolute;transition:top .35s ease-in-out;z-index:1;opacity:0;transition-property:opacity,top}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content.small-map-mode[_ngcontent-%COMP%]   .target-icon[_ngcontent-%COMP%]{opacity:1;top:50%}}@media only screen and (min-width: 1000px) and only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content.media-mode[_ngcontent-%COMP%]   .target-icon[_ngcontent-%COMP%]{top:calc(200% - 296px)}}@media only screen and (min-width: 1000px) and only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content.media-mode[_ngcontent-%COMP%]   .target-icon[_ngcontent-%COMP%]{top:calc(200% - 156px)}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{transition-delay:2s}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:not(.rev){left:40px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:not(.rev){left:16px}}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow.rev[_ngcontent-%COMP%]{right:40px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow.rev[_ngcontent-%COMP%]{right:16px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{transition-delay:2s}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]:not(.rev){left:56px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon.rev[_ngcontent-%COMP%]{right:56px}}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]:not(.rev){left:80px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon.rev[_ngcontent-%COMP%]{right:80px}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open.map-mode[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{width:100%;bottom:0;padding-bottom:40px;padding-top:16px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open.map-mode[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .backdrop[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]:not(.map-mode){border-left:1px solid;border-right:1px solid}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]:not(.map-mode)   .content[_ngcontent-%COMP%]{pointer-events:all}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]:not(.map-mode)   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]{opacity:1}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]:not(.map-mode)   .content[_ngcontent-%COMP%]   .backdrop[_ngcontent-%COMP%]{display:block}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   app-time-line[_ngcontent-%COMP%]{position:absolute;width:100%;bottom:0;left:0}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .mapmarker[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .mapmarker.media-icon[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:16px;border:1px solid;background:#fff;display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   app-map-selector[_ngcontent-%COMP%], [_nghost-%COMP%]   app-timeline-selector[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;top:0;left:0;z-index:21;background-color:#fff}[_nghost-%COMP%]     .leaflet-marker{border:none;background-color:transparent}']})}};SC=Hl([Kl()],SC);var Qre=e=>["/",e];function eoe(e,t){if(e&1){let n=Pr();ut(0,"app-infobar",26),Yn("close",function(){Hi(n);let h=nn(2);return $i(h.info=!1)}),_t()}if(e&2){let n=nn(2);Do("open",n.info)("open",n.infoOpen),jt("chronomap",n.chronomap_)}}function toe(e,t){if(e&1){let n=Pr();ut(0,"app-add-new-bar",26),Yn("close",function(){Hi(n);let h=nn(2);return $i(h.addNew=!1)}),_t()}if(e&2){let n=nn(2);Do("open",n.addNewOpen),jt("chronomap",n.chronomap_)}}function noe(e,t){if(e&1){let n=Pr();ut(0,"div",1)(1,"div",2),qt(2,"app-chronomap",3),Mi(3,eoe,1,5,"app-infobar",4)(4,toe,1,3,"app-add-new-bar",5),_t(),ut(5,"div",6)(6,"div",7)(7,"div",8),Yn("click",function(){Hi(n);let h=nn();return h.sortFilter=!0,$i(h.mobileMenu=!1)}),ut(8,"span"),xn(9,"Sort & Filter"),_t()(),ut(10,"div",8),Yn("click",function(){Hi(n);let h=nn();return h.addNew=!0,$i(h.mobileMenu=!1)}),ut(11,"span"),xn(12,"Add your perspective"),_t()(),ut(13,"div",8),Yn("click",function(){Hi(n);let h=nn();return h.info=!0,$i(h.mobileMenu=!1)}),ut(14,"span"),xn(15,"About"),_t()()(),ut(16,"div",9)(17,"a",10),qt(18,"img",11)(19,"img",12),_t(),ut(20,"div",13)(21,"div",14)(22,"h1"),xn(23),_t(),qt(24,"h2",15),_t()(),ut(25,"div",16)(26,"img",17),Yn("click",function(){Hi(n);let h=nn();return $i(h.addNew=!0)}),_t(),Vo(),ut(27,"svg",18),Yn("click",function(){Hi(n);let h=nn();return $i(h.info=!0)}),qt(28,"path",19)(29,"path",20)(30,"path",21),_t()(),Wl(),ut(31,"div",22),Vo(),ut(32,"svg",23),Yn("click",function(){Hi(n);let h=nn();return $i(h.mobileMenu=!h.mobileMenu)}),ut(33,"g",24),qt(34,"path",25),_t()()()()()()}if(e&2){let n,s,h,r,w,A,F,$,K,se,le,ae,Ze,Ue,ft,Xe,st=nn();Qe(2),jt("chronomap",st.chronomap_),Qe(),jt("ngIf",st.info),Qe(),jt("ngIf",st.addNew),Qe(),Do("mobile-visible",st.mobileMenu),Qe(),fn("color",(n=st.chronomap())==null?null:n.secondaryColor()),Qe(),fn("border-color",((s=st.chronomap())==null?null:s.secondaryColor())+"40"),Qe(3),fn("border-color",((h=st.chronomap())==null?null:h.secondaryColor())+"40"),Qe(3),fn("border-color",((r=st.chronomap())==null?null:r.secondaryColor())+"40"),Qe(3),fn("border-color",(w=st.chronomap())==null?null:w.secondaryColor()),Qe(),jt("routerLink",bF(30,Qre,(A=st.chronomap())==null?null:A.directoryId)),Qe(),jt("src",(F=st.chronomap())==null?null:F.logo(),jo),Qe(),jt("src",($=st.chronomap())==null?null:$.logo(),jo),Qe(3),fn("color",(K=st.chronomap())==null?null:K.primaryColor()),Qe(),rr((se=st.chronomap())==null?null:se.title()),Qe(),fn("color",(le=st.chronomap())==null?null:le.primaryColor()),jt("innerHTML",st.marked(((ae=st.chronomap())==null?null:ae.subtitle())||""),Wo),Qe(4),xr("stroke",(Ze=st.chronomap())==null?null:Ze.primaryColor()),Qe(),xr("fill",(Ue=st.chronomap())==null?null:Ue.primaryColor()),Qe(),xr("fill",(ft=st.chronomap())==null?null:ft.primaryColor()),Qe(),fn("transform",st.mobileMenu?null:"rotate(180deg)"),Qe(3),xr("fill",(Xe=st.chronomap())==null?null:Xe.primaryColor())}}var IC=class DP{constructor(t,n,s,h,r){this.data=t,this.route=n,this.router=s,this.state=h,this.layout=r,this.LOCAL_STORAGE_KEY="chronomap-info-",this.slug=null,this.chronomap=Ln(null),this._info=!1,this._addNew=!1,this._sortFilter=!1,this.infoOpen=!1,this.addNewOpen=!1,this.sortFilterOpen=!1,this.mobileMenu=!1,this.marked=On,this.route.params.pipe(mo(),pi(w=>{let A=parseInt(w.dbid);this.data.fetchData(A),this.slug=w.slug,this.loadChronomap(this.data.directory.chronomaps(),this.slug)}),_a(3e3)).subscribe(()=>{this.info=localStorage.getItem(this.storageKey)!=="opened"}),bl(()=>{let w=this.data.directory.chronomaps();this.loadChronomap(w,this.slug)},{allowSignalWrites:!0}),this.router.events.pipe(na(this),io(w=>w instanceof Xl),ti(w=>{let A=w,F=new URL("http://example.com"+A.url),$=Object.fromEntries(F.searchParams);return{fragment:F.hash.slice(1),params:$}})).subscribe(({fragment:w,params:A})=>{this.state.initFromUrl(w,A)})}loadChronomap(t,n){if(n&&t.length>0){let s=t.find(h=>h.slug()===n);s&&s.fetchMeta().pipe(Vr(()=>s.fetchContent())).subscribe(()=>{this.chronomap.set(s)})}}get info(){return this._info}set info(t){console.log("INFO=",t),this._addNew=!1,this._sortFilter=!1,localStorage.setItem(this.storageKey,"opened"),t?(this._info=t,Mr(0).subscribe(()=>{this.infoOpen=t})):(this.infoOpen=t,Mr(300).subscribe(()=>{this._info=t}))}get addNew(){return this._addNew}set addNew(t){this._info=!1,this._sortFilter=!1,t?(this._addNew=t,Mr(0).subscribe(()=>{this.addNewOpen=t})):(this.addNewOpen=t,Mr(300).subscribe(()=>{this._addNew=t}))}get sortFilter(){return this._sortFilter}set sortFilter(t){this._info=!1,this._addNew=!1,t?(this._sortFilter=t,Mr(0).subscribe(()=>{this._sortFilter=t})):(this._sortFilter=t,Mr(300).subscribe(()=>{this._sortFilter=t}))}get chronomap_(){let t=this.chronomap();return t||{}}get storageKey(){return this.LOCAL_STORAGE_KEY+this.slug}static{this.\u0275fac=function(n){return new(n||DP)(Fn(ef),Fn(Ea),Fn(qa),Fn(uC),Fn(tf))}}static{this.\u0275cmp=Ci({type:DP,selectors:[["app-chronomap-page"]],standalone:!1,decls:1,vars:1,consts:[["class","layout",4,"ngIf"],[1,"layout"],[1,"content"],[3,"chronomap"],[3,"open","chronomap","close",4,"ngIf"],[3,"chronomap","open","close",4,"ngIf"],[1,"headers"],[1,"mobile-menu","layout-mobile"],[1,"mobile-menu-item",3,"click"],[1,"header"],[3,"routerLink"],[1,"logo","layout-mobile",3,"src"],[1,"logo","layout-desktop",3,"src"],[1,"text"],[1,"header-title"],[3,"innerHTML"],[1,"controls","layout-desktop"],["src","assets/img/icon-add-new.svg",1,"add-new",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"info",3,"click"],["d","M6.86098 4.30891C8.38213 3.2925 10.1705 2.75 12 2.75C13.2147 2.75 14.4176 2.98926 15.5398 3.45411C16.6621 3.91897 17.6818 4.60032 18.5407 5.45926C19.3997 6.3182 20.081 7.33792 20.5459 8.46018C21.0107 9.58244 21.25 10.7853 21.25 12C21.25 13.8295 20.7075 15.6179 19.6911 17.139C18.6747 18.6602 17.23 19.8458 15.5398 20.5459C13.8496 21.246 11.9897 21.4292 10.1954 21.0723C8.4011 20.7154 6.7529 19.8344 5.45927 18.5407C4.16563 17.2471 3.28465 15.5989 2.92774 13.8046C2.57083 12.0103 2.75401 10.1504 3.45412 8.46018C4.15423 6.76996 5.33982 5.32531 6.86098 4.30891Z","stroke-width","1.5"],["d","M12 9C12.5523 9 13 8.55228 13 8C13 7.44772 12.5523 7 12 7C11.4477 7 11 7.44772 11 8C11 8.55228 11.4477 9 12 9Z"],["d","M12 10C11.7348 10 11.4804 10.1054 11.2929 10.2929C11.1054 10.4804 11 10.7348 11 11V16C11 16.2652 11.1054 16.5196 11.2929 16.7071C11.4804 16.8946 11.7348 17 12 17C12.2652 17 12.5196 16.8946 12.7071 16.7071C12.8946 16.5196 13 16.2652 13 16V11C13 10.7348 12.8946 10.4804 12.7071 10.2929C12.5196 10.1054 12.2652 10 12 10Z"],[1,"controls","layout-mobile"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"mobileMenu",3,"click"],["id","media-type"],["id","Vector","d","M11.9998 8.49981C12.1314 8.49905 12.2619 8.52428 12.3837 8.57404C12.5056 8.62381 12.6164 8.69713 12.7098 8.78981L16.7098 12.7898C16.8031 12.8831 16.877 12.9937 16.9275 13.1156C16.9779 13.2374 17.0039 13.368 17.0039 13.4998C17.0039 13.6317 16.9779 13.7622 16.9275 13.8841C16.877 14.0059 16.8031 14.1166 16.7098 14.2098C16.6166 14.3031 16.5059 14.377 16.3841 14.4275C16.2622 14.4779 16.1317 14.5039 15.9998 14.5039C15.868 14.5039 15.7374 14.4779 15.6156 14.4275C15.4937 14.377 15.3831 14.3031 15.2898 14.2098L11.9998 10.8998L8.69981 14.0798C8.60782 14.1821 8.49572 14.2643 8.3705 14.3213C8.24529 14.3783 8.10967 14.4088 7.97211 14.411C7.83456 14.4132 7.69803 14.387 7.57108 14.334C7.44412 14.281 7.32947 14.2024 7.23428 14.103C7.1391 14.0037 7.06543 13.8858 7.01789 13.7567C6.97034 13.6276 6.94995 13.4901 6.95798 13.3528C6.966 13.2154 7.00228 13.0812 7.06454 12.9586C7.1268 12.8359 7.21371 12.7274 7.31981 12.6398L11.3198 8.77981C11.5027 8.6035 11.7458 8.50339 11.9998 8.49981Z"],[3,"close","chronomap"]],template:function(n,s){n&1&&Mi(0,noe,35,32,"div",0),n&2&&jt("ngIf",s.chronomap())},dependencies:[xs,sz,M5,dC,SC],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,Assistant,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.font-cursive[_ngcontent-%COMP%]{font-family:Just Another Hand,cursive;font-weight:400;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media only screen and (max-width: 999px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 1000px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%;display:flex;overflow:hidden}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]{width:100%;max-width:100%;height:100%;display:flex;align-items:stretch;overflow:hidden;position:relative}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]{flex-flow:row}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]{flex-flow:column-reverse}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;-moz-overflow:hidden;clip-path:inset(0)}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-flow:row}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-flow:column}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-infobar[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-layers-bar[_ngcontent-%COMP%]{transition-property:transform margin-left;transition-duration:.5s;z-index:20}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-infobar[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-layers-bar[_ngcontent-%COMP%]{top:0;height:100%;transform:translate(100%);width:360px;margin-left:-360px;flex:0 0 auto}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-infobar.open[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-add-new-bar.open[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-layers-bar.open[_ngcontent-%COMP%]{margin-left:4px;transform:translate(0)}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-infobar[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-layers-bar[_ngcontent-%COMP%]{flex:0 0 auto;width:100%;transform:translateY(100%)}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-infobar.open[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-add-new-bar.open[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-layers-bar.open[_ngcontent-%COMP%]{transform:translateY(0)}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   app-layers-bar[_ngcontent-%COMP%]{min-height:80vh}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]{z-index:2;background-color:#fff}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]{height:64px;overflow-y:visible}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .mobile-menu[_ngcontent-%COMP%]{transform:translateY(-192px);transition:transform .3s ease-in-out}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers.mobile-visible[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers.mobile-visible[_ngcontent-%COMP%]   .mobile-menu[_ngcontent-%COMP%]{transform:translateY(0)}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .mobile-menu[_ngcontent-%COMP%]{padding:0 8px;display:flex;flex-flow:column;align-items:stretch;background-color:#fff}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .mobile-menu[_ngcontent-%COMP%]   .mobile-menu-item[_ngcontent-%COMP%]{width:100%;height:64px;border-bottom:1px solid black;font-family:Source Code Pro,monospace;font-style:normal;font-size:14px;font-weight:400;line-height:21px;text-transform:uppercase;display:flex;align-items:center;justify-content:center;cursor:pointer}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;align-items:center;background-color:#fff}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{width:96px;min-width:96px;height:100%;flex-flow:column;padding:16px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{width:100%;overflow:hidden;height:64px;min-height:64px;flex-flow:row;padding:8px 8px 8px 0;border-bottom:solid 1px black;gap:4px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header.layout-mobile[_ngcontent-%COMP%]{border-bottom:1px solid var(--primary-025-trans, rgba(252, 13, 28, .25))}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{flex:0 0 auto;margin:0;object-fit:contain;cursor:pointer}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:80px;height:64px;margin-bottom:0}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:60px;height:48px;margin-top:12px;overflow:hidden}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{transform:rotate(90deg);transform-origin:96px/2 96px/2;flex-flow:row;align-items:center;width:96px;height:96px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex:1 1 auto;flex-flow:column;align-items:flex-start;margin-right:12px;overflow:hidden}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]{overflow:hidden;width:100%}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1, [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h2{font-family:Source Code Pro,monospace;font-style:normal;margin:0;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1{font-weight:700;text-transform:uppercase}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1{font-size:30px}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1{font-size:14px;line-height:18px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h2{font-weight:500}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h2{font-size:14px;line-height:18px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h2   *{margin:0;text-overflow:ellipsis;overflow:hidden}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;align-items:center;gap:8px}@media only screen and (min-width: 1000px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]{flex-flow:column;margin-top:auto}}@media only screen and (max-width: 999px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]{flex-flow:row;margin-left:auto}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:48px;height:48px;cursor:pointer}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:20px;height:20px}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .mobileMenu[_ngcontent-%COMP%]{width:20px;height:20px}']})}};IC=Hl([Kl()],IC);function ioe(e,t){e&1&&qt(0,"img",0)}var rj=(()=>{class e{constructor(n){this.route=n,this.found=!0,n.params.subscribe(s=>{console.log("params",s);try{let h=parseInt(s.dbid);this.found=h>0}catch{this.found=!1}})}static{this.\u0275fac=function(s){return new(s||e)(Fn(Ea))}}static{this.\u0275cmp=Ci({type:e,selectors:[["app-homepage"]],decls:1,vars:1,consts:[["src","assets/img/404.png"]],template:function(s,h){s&1&&Mi(0,ioe,1,0,"img",0),s&2&&Ga(h.found?-1:0)},styles:["[_nghost-%COMP%]{display:flex;flex-flow:row;justify-content:center;align-items:center;width:100%;height:100%}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{max-width:80%;height:50%}"]})}}return e})();var roe=[{path:":dbid/:slug",component:IC},{path:":dbid",component:cC},{path:"",component:rj}],oj=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=Ta({type:e})}static{this.\u0275inj=wa({imports:[u2.forRoot(roe),u2]})}}return e})();var lj=fh(sj()),cj=fh(aj()),FP=fh(B0());FP.default.extend(lj.default);FP.default.extend(cj.default);var PC=class LP{constructor(t){this.route=t,this.found=!0;let n=new On.Renderer,s=n.link;n.link=(h,r,w)=>{let A=h.startsWith(`${location.protocol}//${location.hostname}`),F=s.call(n,h,r,w);return A?F:F.replace(/^<a /,'<a target="_blank" rel="noreferrer noopener nofollow" ')},On.use({renderer:n})}static{this.\u0275fac=function(n){return new(n||LP)(Fn(Ea))}}static{this.\u0275cmp=Ci({type:LP,selectors:[["app-root"]],standalone:!1,decls:1,vars:0,template:function(n,s){n&1&&qt(0,"router-outlet")},dependencies:[r2],encapsulation:2})}};PC=Hl([Kl()],PC);var ooe={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},eSe=lr(cn({},ooe),{"[class.ng-submitted]":"isSubmitted"});var soe=new Hn("CallSetDisabledState",{providedIn:"root",factory:()=>uj}),uj="always";var aoe=(()=>{class e{static \u0275fac=function(s){return new(s||e)};static \u0275mod=Ta({type:e});static \u0275inj=wa({})}return e})();var hj=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:soe,useValue:n.callSetDisabledState??uj}]}}static \u0275fac=function(s){return new(s||e)};static \u0275mod=Ta({type:e});static \u0275inj=wa({imports:[aoe]})}return e})();var dj=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=Ta({type:e,bootstrap:[PC]})}static{this.\u0275inj=wa({providers:[rN(oN())],imports:[_N,hj,oj]})}}return e})();var fj={production:!0};fj.production&&void 0;gN().bootstrapModule(dj).catch(e=>console.error(e));
